Skip to content
Search or jump to‚Ä¶
Pull requests
Issues
Marketplace
Explore
 
@gilagilagila 
gilagilagila
/
pribadi
Private
Code
Issues
Pull requests
Actions
Projects
Security
Insights
Settings
pribadi/onok.txt
@gilagilagila
gilagilagila 23juli
Latest commit 42517bb 11 days ago
 History
 2 contributors
@sibagariang@gilagilagila
2262 lines (1366 sloc)  65.8 KB

file untuk penjelasan github: https://www.niagahoster.co.id/blog/git-tutorial-dasar/

daftar kebutuhan bulan agustus:
parfum
hand sanitizer
sabun
detergen
kaos hitam polos
------------------------------------
jumat,6 agustus =>meeting dengan bu felicia
		  materi=>pph
		  


paket bronze=> kamar boleh pilih

halaman 30

hal 32

minggu depan bahas prucinta

sabtu 7 agustus ada training gp0ne

belajar ttg jaringan, dan rdc

-----------------------------

lagu youtube akustik https://www.youtube.com/watch?v=wyuCFMPY-DE

--------------------------------

pcb dan prucinta ga ada investasi=> ga ada investasi

training prucinta=>uang premi dibalikin tapi investasi tidak, kebalikan pgb
ada surplus underwriting kayak bagi dividen

tradisional=prtucinta pcb, ada diskon 1 bulan utk bayar 1 tahun

cairnya setelah 20 tahun

umur terakhir masuk 60 tahun


https://binomo-investment.com/trading

---------------------------------------
14 agustus

pru critical pcb 88
beda dgn prucinta-> ada santunan utnuk sakit kritis
bayarnya 5,10,15
semua yang tradisional ada diskon 1 bulan
 
password wifi: office1234

---------------------------------------
18 agustus

-baca ttg pgb apakah ada manfaat kecelakaan, cacat, meninggal
-tes my first case masih gagal


command lx
cat /proc/cpuinfo

link belajar lx
https://www.geekswarrior.com/

--------------------------
20 agustus 

verif shopee

---------------------------
25 agus
https://linktr.ee/handokotantra => shopee affiliate


kalo dah gajian, bayar extended domain vardshop.my.id

-------------------------------
26 agus

drive mp4 survey dll: 
https://drive.google.com/drive/u/0/folders/1MO3_LYMNQCgUY8CosIHsSwUQrAxGIWLz

-------------------------------
27 agustus

-zoom dgn bu felicia
-materi market survey

pengecualian, masa tunggu pph
prucinta, pcb88 lbh gampang

--------------------------------
28 agustus

jual asus hp yang murah
https://shopee.co.id/ASUS-ZENFONE-C-GOLD-BEKAS-i.162638254.8476778029

----------------------------------
30 agustus

akun github baru:
user: gila01@aol.com | gilagilagila
pass: sama dengan vardnews/digimarketing

Git init : untuk membuat repository pada file lokal yang nantinya ada folder .git
Git status : untuk mengetahui status dari repository lokal
Git add : menambahkan file baru pada repository yang dipilih
Git commit : untuk menyimpan perubahan yang dilakukan, tetapi tidak ada perubahan pada remote repository.
Git push : untuk mengirimkan perubahan file setelah di commit ke remote repository.
Git branch : melihat seluruh branch yang ada pada repository
Git checkout : menukar branch yang aktif dengan branchyang dipilih
GIt merge : untuk menggabungkan branch yang aktif dan branch yang dipilih
Git clone : membuat Salinan repository lokal



-belajar tentang remote git dan fetch


---------------------------------------
31 agustus

-pelajarin tentang cara fern wifi cracker

contoh landing page:
https://www.allianz.co.id/?utm_source=Google&utm_medium=Paid_Search&utm_campaign=Allianz_SEM_Brand_Jan-Dec_2021&utm_content=Allianz_SEM_Brand_Jan-Dec_2021

---------------------------------

1 september

membuat akun gmail emuskik@gmail.com

memakai no hp im3 085813487856

membuat akun infinityfree:
email:emuskik@gmail.com
pass: sama dgn vardnews


http://asuransi.epizy.com/wp-admin/


-----------------------------

2 september 
cari tahu tanggal kapan vaksin kedua

pedulilindungi:
13 September 2021
Puskesmas Kec Matraman Pos2


link drive prudential:
cutt.ly/folderpru

besok agenda zoom meeting dgn bu feli
-market survey


pdf prucinta:
https://www.prudential.co.id/export/sites/prudential-id/id/.galleries/pdf/product/prucinta-brosur-200217.pdf

pdf pcb88
https://www.prudential.co.id/export/sites/prudential-id/id/.galleries/pdf/product/prucritical-benefit-88-brosur-190418.pdf

pgb/psgb pdf 
https://www.prudential.co.id/export/sites/prudential-id/id/.galleries/pdf/product/prulink-generasi-baru-brosur-180831.pdf

-------------------------------------
3 september 

todo list:
-zoom meeting dgn bu feli


artikel,

pengantar oke
case

max usia prucinta 60
pgb 70

pengecekan underwriting 

pengecekan sakit riwayat jantung darah tinggi diabet wasir tumor benjolan katarak lambung =>PGB dan pss bisa=>klaim 1 tahun
penyakit biasa =>pgb=>1 thn

kecuali covid dan kecelakaan=>bisa langsung klaim=>bisa langsung freepass

sakit kritis=> masa tunggu klaim 3 bulan

minimal up ALL=>300 rb


prucinta&pcb: masa tenggang 30 hari
pgb=> harus bayar dlm masa tenggang selama 2 tahun.=>setelahnya bisa pakai saver(investasi)


cari bayaran preimi=>hitung dari next usia

pss
bronze indo doang
silver asia kecuali singapur jepang hongkong
gold semua asia
platinum semua dunia kecuali amrik
diamond semua


referensi pru: 
https://kompasmu.github.io/coretan/post/brosur-prudential-syariah/



komplain kritik alfamart:
1500959 
sms:0817111234

no kontak alfa bkt gold mediterania (081294655393)
------------------------------------
4 september

-username rek BRI sama dengan email utama
-belajar flashing android
-cari tau jenis CPU polytron

https://androidmtk.com/download-polytron-stock-rom-for-all-models

https://androidmtk.com/flash-stock-rom-using-smart-phone-flash-tool

firmware
https://www.mediafire.com/file/t4yoqqbhbmku4je/Polytron_R2508_MT6580_20160607_6.0.zip/file

--------------------------------------------------
6 september

-nulis artikel pru

RAM Memory Samsung SQ45S70S 1GB,2GB (PC2-5300 (DDR2-667)) Laptop Memory OFFTEK

cmd cek ram:
wmic MemoryChip get BankLabel, Capacity, MemoryType, TypeDetail, Speed, Tag


install ipcalc:
sudo apt-get install ipcalc

ubah ip:
ifconfig eth0 10.0.0.5 netmask 255.255.255.0

ubah default gateway:
route add default gw 10.0.0.1

#penting, untuk mendapatkan alamat IP dari layanan DHCP dari eth0 (NIC berkabel default), kita dapat melakukan hal 

berikut:
dhclient eth0 


ubah nameserver(dns):
echo "nameserver 8.8.8.8" > /etc/resolv.conf


---------------------------------------------------
11 september

-8.15=zoom meeting dgn bu felicia


hasil zoom meeting:
-pembahasan pgb
-buat ilustrasi pcb88

-pph dan pss itu sama, cuma bedanya pss ga pake investasi
-riders payor itu pembebasan premi
-maksimal pengajuan pcb88 usia 60 tahun





-------------------------------------------------
12 sept

-minta sharelok dari patuan tempat vaksin
-izin ke bu dewi untuk vaksin 1 hari

-----------------------------------------------
13 sept 
-vaksin


----------------------------------
15 september

tutorial xss inject cookies: https://www.youtube.com/watch?v=RkTrT437MP0



----------------------------------
17 september

-meeting dgn bu feli

pcb88=pgb kritis
prucinta=pgb jiwa


üè• Daftar Rumah Sakit/Klinik Rekanan PMN di Indonesia
https://bit.ly/3xDBqsP

Daftar Rumah Sakit/Klinik Rekanan PMN di Luar Negeri
https://bit.ly/3gGoFbu

Daftar rekanan dokter/klinik International Assistance di Rumah Sakit wilayah Singapore
https://bit.ly/3cT5FVv

Pre-Admission Form Rumah Sakit Luar Negeri
https://bit.ly/3eeN5WR

‚òé 1500085 PRU Medical Network (PMN)
Layanan untuk Tenaga Pemasar: tekan 0, kemudian tekan 2

‚òé 08118253322 CHA (Cashless Hospitalization Assistance) 
Senin-Jumat (hari kerja), pukul 17.00 - 24.00 WIB

üè• Daftar Rumah Sakit Rekanan Internasional SOS
Daftar Rumah Sakit/Klinik Rekanan Internasional SOS di Indonesia
https://bit.ly/2UmEBab

Daftar Rumah Sakit/Klinik Rekanan Internasional SOS di Luar Negeri
https://bit.ly/3egeZS3

‚òé 021 7590 0086

Update per 17 Juni 2021


ig: id_prudential>testimoni




==================================
link zoom meeting bu feli:
Felicia Theodora is inviting you to a scheduled Zoom meeting. 

Time: July 27, 2021 8:00 AM Jakarta 

Topic: regular meeting

Join Zoom Meeting 
https://us04web.zoom.us/j/2890747128?pwd=TGthd1ArdEhqdisrQmFhWmhTaWFWdz09 

Meeting ID: 289 074 7128 
Password: WHCEZ
====================================




4010466551 rek BCA Sarwono

pruforce Utk username nya sarwono0805
Password Sar111121

Jl. Marina Raya Rukan Exclusive Bukit Golf Mediterania Blok E No 12 RT/RW 007/002. Penjaringan, Jakarta Utara



Rek 353001032762535 a/n ruslan parhusip



--------------------------------------------- 
19 sept

email baru 
emuskik2@gmail.com 
emuskik3@gmail.com
pass: sama semua dgn vardnews dan digimarketing



pass lsi forum:
sama dgn kali



--------------------------------------------
23 sept
-bikin artikel pru setelah selesai kerja
-upload di lsi artikel
-bikin sheets dari book1pru

run command:
mstsc
services.msc
gpedit.msc


-------------------------------------
baca apa itu produk prucinta?
apa itu pcb88?
yang mana uang balik dan yang tidak?

bikin ilustrasi buat trivia



----------------------------------

27 september

PGB
accident cover booster= dapat tambahan UP 100% jika di awal nilai UP min 200 juta (kecelakaan dan meninggal) => <70 thn

premi topup berkala itu apa? (prusaver)
cara memilih epolicy dan autodebit gimana? kok gada pilihannya?
halaman ringkasan manfaat asumsi nilai tunai masa depan maksudnya gimana? kok ada 3 usia?
premi backdate itu apa?
apa yg harus di isi dengan uang pertanggungan? 
pru prime saver itu apa?
apakah perokok bisa daftar asuransi?
selama bayar premi dalam 10 tahun prucinta, apabila saya meninggal dunia karena sakit akan keluar klaim 1 milyar?


daftar gambar utk lsi artikel pru
https://cutt.ly/gbrpru1

----------------DAFTAR GAMBAR LSI ARTIKEL----------------------




<center><a style="width:100px" href="https://bit.ly/konsulpru" class="image featured"><img src="https://i.imgur.com/bq84JPM.jpg" alt="" /></a></center>
katadata.co.id


<center><a style="width:100px" href="https://bit.ly/konsulpru" class="image featured"><img src="https://i.imgur.com/SY2vMKQ.jpg" alt="" /></a></center>
katadata.co.id

<center><a style="width:100px" href="https://bit.ly/konsulpru" class="image featured"><img src="https://i.imgur.com/JW0kJlp.png" alt="" /></a></center>
sumber:melex.id

<center><a style="width:100px" href="https://bit.ly/konsulpru" class="image featured"><img src="https://i.imgur.com/Yk1rBm9.gif" alt="" /></a></center>
sumber:https://1.bp.blogspot.com/

<center><a style="width:100px" href="https://bit.ly/konsulpru" class="image featured"><img src="https://i.imgur.com/fIiuMul.jpg" alt="" /></a></center>
sumber:webbisnis.net

<center><a style="width:100px" href="https://bit.ly/konsulpru" class="image featured"><img src="https://i.imgur.com/W0frhIe.jpg" alt="" /></a></center>
sumber:prupriority.com


<center><a style="width:100px" href="https://bit.ly/konsulpru" class="image featured"><img src="https://i.imgur.com/XIGszwk.jpg" alt="" /></a></center>
sumber:https://id.carousell.com/


https://i.imgur.com/LgSFU27.png
sumber:wikipedia

-----------------------------------------
28september

lsi artikel pru

28
https://www.radikaltechnologies.com/forum/profile/27540/
https://www.radikaltechnologies.com/forum/profile/27543/
https://www.pas.ec/community/profile/vrdnd/
https://www.pas.ec/community/profile/srwstr9/
https://www.radikaltechnologies.com/forum/profile/27545/

backlink


tentang pdf email dan jaringan:
https://media.neliti.com/media/publications/276262-analisis-keamanan-aplikasi-email-bawaan-425230d4.pdf


fb agen Prudential Financial Advisor: https://www.facebook.com/AgenPrudentialBekasiSragen/

-------------------------------------------------------------
30september

link DDOS
https://github.com/MHProDev/MHDDoS

----------------------------------------------------
1 oktober

-bayar domain vardshop.my.id
-siapkan iklan prudential
-pasang iklan pru


----------------------------------------------------

15 oktober


todo list
-membaca aturan pru
-minta pdf ke bu feli
-tanya jawab seputar masalah viral
-

-kalo ada diagnosa apa2 harus di confirm dulu
-diagnosa dokter
cek ulang 
------------------------------------------

login evermos:
username:6281910467527
pass:sarwonosatrio


------------------------------------------------
24 oktober

template pesan
Dear Mr Sarwonk Satrio

Perkenalkan Saya Felicia dari PT GPS United. 
Saya menerima rekomendasi CV Anda dari jobs.id, karena skill dan background pekerjaan anda sebelumnya sesuai kriteria seleksi awal kami 

Saat ini perusahaan kami sedang mencari kandidat MDP untuk Posisi sebagai 
1. Associate
2. Senior Asociate 

Untuk program MDP di 1 tahun pertama akan di educate utk menjadi Profesional Financial Planner, untuk menghasilkan kandidat MDP berkelas international, consulting trainer kami datangkan dari holding company kami dari Hongkong & Singapore serta juga ada trainer2 dari Indonesia.

Jika lolos MDP ini, maka tahun kedua akan di challenge menjadi Associate Director/Team Leader untuk mengembangkan Business Unit perusahaan.

Penjelasan lebih detail nya nanti akan kami sampaikan melalui interview awal via Zoom meeting (krn saat ini kami masih WFH).

Untuk detailnya akan dijelaskan di interview. 

Apakah anda berminat untuk menghadiri interview?
Mohon konfirmasinya. 

Regards 

Felicia A
GPS UNITED







Dear Mrs Shelly Saputri

Perkenalkan Saya Sarwono, Financial Advisor dari GPS United. 
Saya menerima informasi bahwa anda mengisi formulir Konsultasi seputar Asuransi Prudential. Untuk itu saya bermaksud untuk mengundang anda mengikuti konsultasi via Zoom meeting agar bisa melakukan diskusi lebih lanjut. 

Untuk detailnya akan dijelaskan di zoom meeting. 

Apakah anda berminat untuk menghadiri zoom meeting?
Mohon konfirmasinya. 

Regards 

Sarwono S
GPS UNITED
-------_---------------------------------------------
25 oktober


Indopremiere
SARWONO8
Password sama dgn email 7
pass lagi: triple bri

BRI rek
username sarwonosatrio7@gmail.com
pass: sama dgn bri lama

BCA rek
username wono00
pass: sama dgn bri

tokocrypto
username: sarwonosatrio9
pass: sama dgn email 9



-membuat link zoom meeting jam 8.15 selasa
-chat ke shelly dan bu feli link nya
-minta CV nya

-----------------------------
27 oktober

apk bot
https://drive.google.com/file/d/1SNpypQOg13_7ozoid_4UkYrV7dYJjwU2/view



----------------------------------------------

28 oktober

todo list:
-follow up rini dan sassy


start chrome --incognito "http://www.iot.qa/2018/02/narrowband-iot.html"

tasklist : cek semua apk berjalan
tskill : mematikan apk

https://qastack.id/programming/5487473/how-to-create-an-infinite-loop-in-windows-batch-file


pru: form pengalihan 

lokasi python
C:\Users\USER\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\Scripts



-pelajari prucinta dan unit link


<<<<<<< HEAD
=======
--------------------------------------------------------
31 oktober

excel calon nasabah
https://docs.google.com/spreadsheets/d/1MGvEwjPL3G-hs0WGMukArbexe69dl-61778bwQyPLVE/edit?resourcekey#gid=527940270


pruforce Utk username nya sarwono0805
Password Sar111121

bit.ly/konsulpru
bit.ly/responpru
cutt.ly/folder-pru

>>>>>>> 5a4f865369cd6645ff012c0296b813df5cac40bf


------------------------------------------------
1 nov 

adobe fill n sign utk tanda tangan elektronik


------------------------------------------
8 november 

cara ngitung up

<object>	
[10.54, 8/11/2021] Bu Felicia Asuransi: Saver itu basicnya utk investasi
[10.54, 8/11/2021] Bu Felicia Asuransi: Jd saver itu yg akan dimasukan ke invest
[10.55, 8/11/2021] Sarwono Sibagariang: Nasabah ngecek premi yg sudah dibayar melalui apa ya bu?
[10.55, 8/11/2021] Sarwono Sibagariang: Ok bu
[10.56, 8/11/2021] Bu Felicia Asuransi: Akan ada sms klo pembyran premi sudah diterima dan tiap bulan akan dikirim ke email surat pernyataan transaksinya spt klo kita punya rek koran
[11.09, 8/11/2021] Sarwono Sibagariang: Step nya setelah buat esqs apa lagi ya bu kalo nasabah udah tertarik?
[11.14, 8/11/2021] Bu Felicia Asuransi: Nanti setelah jd esqs kan muncul illustrasi
[11.14, 8/11/2021] Bu Felicia Asuransi: Nah itu diinfo ke nasabah d zoom
[11.14, 8/11/2021] Bu Felicia Asuransi: Ini misla 500rb dpt nya mnfaatnya apa saja
[11.14, 8/11/2021] Bu Felicia Asuransi: Lalu klo ud ok lgs trial closing
[11.16, 8/11/2021] Bu Felicia Asuransi: Ga semua org bs masuk ke pru, ada yg krn misal tdk sehat lg atau ada riwayat sakit
[11.16, 8/11/2021] Bu Felicia Asuransi: Km tentunya mau tau yahh apakah bs diterima atau ga
[11.17, 8/11/2021] Bu Felicia Asuransi: Kita coba dl yahh, bole send ktp ny
[11.21, 8/11/2021] Sarwono Sibagariang: ini bu saya blm paham.. apa kriteria nya dari setiap produk bu untuk nasabah lolos?
[11.22, 8/11/2021] Bu Felicia Asuransi: Yg pasti ga ada penyakit penyerta seperti diabetes, jantung, kanker dll
[11.22, 8/11/2021] Bu Felicia Asuransi: Intinya mau produk apapun ya itu
[11.22, 8/11/2021] Bu Felicia Asuransi: Haru SEHAT
[11.22, 8/11/2021] Sarwono Sibagariang: beda beda kan ya tiap produk untuk kriteria dan persyaratannya bu?
[11.23, 8/11/2021] Bu Felicia Asuransi: Kriteria nya sbnrnya intinya sehat wono
[11.23, 8/11/2021] Bu Felicia Asuransi: Klo utk umur kamu bs liat d tabel yg kmrn Natalis bikin
[11.23, 8/11/2021] Sarwono Sibagariang: iya bu sudah saya baca.. tp itu ringkasan saja bu
[11.23, 8/11/2021] Bu Felicia Asuransi: Sama aja kog mau ambil misal jiwa atau kesehatan klo ud ada riwayat jantung ya ga bisa
[11.24, 8/11/2021] Bu Felicia Asuransi: Iya nah d sana buat reminder aja
[11.24, 8/11/2021] Sarwono Sibagariang: kok ibu medi ga kena underwriting kesehatan bu?
[11.24, 8/11/2021] Bu Felicia Asuransi: Krn dia sehat2 dan masih muda juga Wono
[11.25, 8/11/2021] Bu Felicia Asuransi: Medical itu biasa kena kalau salah satu terpenuhi
1. Ada riwayat
2. Umur di atas 50 tahun
3. Ambil uang pertanggungan besar
[11.25, 8/11/2021] Sarwono Sibagariang: underwriting bisa secara lisan aja bu? ga harus medical checkup?
[11.25, 8/11/2021] Bu Felicia Asuransi: Step pertama ya secara tertulis via submit dr pruforce
[11.26, 8/11/2021] Bu Felicia Asuransi: Kalau hasil submissionnya ada yg hrs diselidiki lebi lanjut.. misal obesitas atau berumur
[11.26, 8/11/2021] Bu Felicia Asuransi: Ya pasti akan ada lanjutan diperintahkan medical lagi
</object>


----------------------------------------------
9 november
cara mendirikan PT perorangan murah https://www.youtube.com/watch?v=wdVwrfgsHhM


reff prita asuransi https://www.youtube.com/watch?v=0S_7eb1u3rg

plan:
-fokus ke kerjaan, investasi biarkan berkembang sendiri
-second income dari prudential, atur waktu malam hari untuk belajar dan buat artikel dan posting

1.saat kapan terjadi pembebasan premi?
2.apakah semua produk pru masa tunggunya sama 1 bulan?
3.Withdrawal dari Saldo Unit Premi Berkala  apa bisa?
4.Nasabah Surrender maksudnya apa?
5.berapa santunan ketika meninggal di pgb?
6.apakah pph menanggung sakit kritis?
7.apa beda riders chc dan pph?
8.Penilaian keamanan dan modifikasi rumah (stroke) apakah pgb membiayainya? bagaimana ketentuannya?
9.PRUcritical hospital cover ini mengcover sakit kritis? apa aja? 
10.Lump Sum itu apa ya?

1. Kalau nasabah terkena kondisi kritis atau klo di polis anak kalau ortu meninggal
2. Jiwa tdk ada masa tunggu, sakit kritis 90 hari, rs 1 bulan
3. Bisa asal disisakan min 2 jt
4. Tutup polis
5. Tergantung di set nya brp, min 20 jt
6. Iya..ridernya ESCC dan CCB 61
7. Chc khusus 12 sakit kritis aja...pph semua diagnosa
8. Iya di chc ya.. ketentuan diperlukan oleh nasabah..misal tdnya nasabah d lt bwh tdk ada kamar smntara krn sakit jd tdk bs naik tangga
9. Ada d trainingnya Wono 12, spt kanker, lupa jg detailnya coba d cek ya
10. Sekaligus.. jd misal pertanggungan sakit kritis 500jt, ya dikasi 500jt sekaligus, beda dgn pph.. kan dikeluarkannya ya sedikit2 sesuai biaya pas masuk rs brp


geneve@une.ch




----------------------------------------------------
10 november

[21.04, 9/11/2021] Sarwono Sibagariang: malam bu, saya ada beberapa pertanyaan bu, mohon bantuannya ya bu üôè

1.PRUlink total & permanent disablement dan PRUlink total & permanent disablement syariah (TPD) ini riders ya?
2.apa perbedaan  Saldo Unit premi Top Up dan  Saldo Unit premi berkala?
3.apa itu  account Premi Suspend?
4.maksud dari withdrawal saldo itu gimana? apakah karena nasabah mau berhenti makanya withdrawal semua uangnya yang sudah dibayar?
5.apa itu Fund PRUlink? bedanya dgn saldo unit premi berkala apa?
6.Fasilitas switching maksudnya gimana?
7.apakah sering terjadi kenaikan biaya asuransi? bukankah setiap bulan premi selalu sama bayarnya?
8.biaya administrasi itu apa dan liatnya dimana ya?






1. Iya betul, untuk cacat tetap dan total
2. Premi berkala yg tiap bulan dibayar. Top up yg sewaktu2 dilakukan. Misal lg ada uang nganggur mau ditabung ya di top up d bagian investasi nya aja
3. Ini kalo kelebihan bayar premi..cth kaya kmrn nasabahbyg salah bayar..dia bayara kan 400 rb, pdhl premi cmn 350rb, nahb50 rb nya msk suspend.. kaya disimpen gt, jd nextny dia cm byr sisa nya aja 200rb
4. Ga hrs, misal lg ada kebutuhan dadakan, ya bs aja withdraw dr nilai tunai dia
5. Fund itu jenis imvestasinya, premi berkala akan dimasukin ke sini.. 
6. Switching itu ubah jenis investasi, misal tdnya managed fund skrg mau ubah jd equity fund, ya pake fasilitas form switching
7. Biaya asuransi itu spt biaya modal.. merupakan komponen dr premi berkala, nambahnya sesuai usia
8. Administrasi ya kaya biaya layanan dr pru kali yah.. bsrny 27.500, tp klo misal semua dipakein e policy, e correspondenxe n autodebit biaya admin nya dihapuskan



ultraviewer kantor
DESKTOP-KAKM7BC

allow remote control
your ID: 45 457 641
pass: 7761


unattended access:
pass: 39393939



membuat email sementara 
https://temp-mail.org/


keyword asuransi dan pru
cutt.ly/keywordpru





tombol daftar disini:
https://i.imgur.com/M7bAzgA.gif

pakaloy699@datakop.com
pass: turboturbo atau @Turbo39

-------------------------------------------------------

11 november

bot instagram dm python: https://www.youtube.com/watch?v=b_jDC70MLxM&ab_channel=Gunther



-----------------------------------------------------
12 november

-apa beda pph, pph plus?
-pph skrg yg dijual adalah pph plus
-liat saldo premi nasabah di informasi
-payor riders premi pembebasan jika nasabah sakit kritis
-nilai tunai dibentuk setelah tahun 1?
-limit pph/pss itu 3 milyar
-kelebihan pru: biaya teman jaga 600 rb 


1. produk prudential apa saja yang uang premi pasti kembali selain pcb88?
2. apa yang membedakan escc dengan pcb88?
3. maksudnya 60 kondisi kritis tahap akhir apa? apakah pcb88 hanya mengcover tahap akhir saja?
4. dalam pcb, jika tertanggung meninggal karena sakit biasa apakah uang kembali?
5. angioplasty itu gimana?
6. apa saja syarat agar uang premi pcb bisa kembali? apakah harus menunggu dulu sampe umur 89 tahun?
7. bagaimana proses underwiting di pcb88?
8. maksudnya pembayaran 5 tahun, 10 tahun, 15 tahun pcb itu gimana?
9. jika tertanggung pernah mengklaim sakit kritis di pcb88, apakah dia masih dapat uang pertanggungan full ketika dia meninggal?
10. Pengembalian premi 100% bisa ambil tahun ke-20, Perlindungan berakhir.jika setelah 20 tahun nasabah pcb tidak ambil preminya, apakah perlindungan tetap berakhir?
11. jika nasabah meninggal di usia 75 tahun karena kecelakaan apakah pemegang polis mendapatkan santunan 200% UP? dan jika nasabah meninggal di usia 75 tahun karena sakit biasa apakah pemegang polis mendapatkan santunan 200% UP?
12. saat meeting tadi bu feli menjelaskan ada keuntungan tambahan jika tertanggung menggunakan PGB dengan UP minimal 200 juta. Apa saja itu?
13. jika pakai PCB, apakah bisa di klaim sakit kritisnya berkali kali? Apakah sakit angioplasty hanya bisa diklaim 1 kali saja?
14. apa itu CCB plus 61? bedanya dgn pcb88 apa ya?
15. apakah perlindungan pcb cuma 20 tahun?
16. apakah escc dan pcb masa tunggunya sama yaitu 90 hari?
17. pcb88 ini termasuk produk jiwa + kesehatan ya?



1. Prucinta, prucerah
2. Escc unit link bs cover sakit kritis tahap awal, pcb 88 itu tradisional, cover sakit kritis tahap akhir
3. Jadi kalau sudah stadium lanjut, misal klo cancer ud stadium 3 k atas
4. Kalau meninggal sakit biasa keluar up pcb ny
5. Itu pasang baalon atau ring jantung
6. Klo cm premi nya balik d taun ke 20 ud balik. Dinusia 88 cair pertanggungannya
7. Ada tabelnya.. jd utk usia dan besar pertanggungan tertantu hrs medical. Selain itu cukup isi riwayat kesehatan aja
8. Pilih mau bayar premi nya dicicil 5, 10 apa 15 taun
9. Ngga.. krn ud keluar pertanggungan sakit kritisny
10. Ngga klo ga diambil perlindungan smp 88
11  tidak hrs sblm 70
12. Klo kecelakaan sblm usia 70 dpt 2x up
13, sakit kritis hanya 1x aja yam angioplasty jg 1x
14. Sama aja cm 1 unit link 1 lg tradisional
15. Sampe usia 88
16. Iya sama
17. Jiwa dan sakit kritis ya

pgb sampai halaman 45
pcb sampai halaman 40/74



-----------------------------------------------------------------
14 november

menambahkan github untuk folder lsi
membuat akun imgur dari akun fb wono


membuka file folder dengan batch file:
start %SystemRoot%\explorer.exe "C:\Users\USER\Desktop\qqturbo code\catatan\Book2.xlsx"
------------------------------------------------------------------
16 november

1.apa yang dimaksud dengan harga unit? (contoh kasus surender)
2.bagaimana proses terbentuknya nilai tunai dari pcb88?
3.Polis akan berakhir jika Penebusan Polis disetujui oleh Penanggung; maksudnya bagaimana?
4.berapa rupiah limit klaim sakit di pcb88?
5.apa step-step yang harus dilakukan agen untuk pendaftaran calon klien?
6.apa step-step yang harus dilakukan agen untuk Pengajuan klaim klien?
7."Surat Berita Acara Kepolisian" bentuknya seperti apa? ini dipakai untuk klaim kan?
8.adakah batasan waktu Pengajuan klaim harus diserahkan ke Prudential? apakah sama antara satu produk dengan yang lainnya?
9.apakah sertifikat aasi dan aaji berlaku seumur hidup?
10. 100% Santunan Asuransi = 100% uang pertanggungan =100% saldo premi berkala?
11. jika tidak ada investasi, apakah ada nilai tunai? bagaimana perhitunga nilai tunai jika UP misal 100 juta dan premi 300rb?
12. berapa umur nasabah maksimal untuk mendaftar di pgb, pcb, dan prucinta?


1. Sama kaya saham tiap fund itu ada hrgnya... satuannya unit. Misal 1 unit equity fund = 15rb
2. Itu dr pembagian keuntungan dr pru krn tradisional
3. Klo pru approve surrendernya ya ud brarti polis selesai
4. Dia lump sum, tergantung mau bikinnya brp (kebutuhan nasabah brp)
5. Isi data2 sesuai arahan e spaj d pruforce
6. Surat ket dokter, form claim, ktp, buku tab klo reimburse.. klo cashless koordinasi dgn pihak PMN
7. Surat dr polisi, biasa utk kasus kecelakaan. Klo msk rs ya ga perlu dr polisi
8. Biasa 3 bln dr kejadian
9. Ngga, diperpanjang tiap 2 taun
10. Ngga, up dan santunan sama, tp premi pstnya lebi kecil
11. Produknya apa? Klo unit link ya spt d tabel.. taun 1 80%dr premi berkala - biaya asuransi, akuisisi, admin
12. Pgb 70, pcb pru cinta 60 (semua next year birthday)


python capture tombol
locateCenterOnScreen("capture.png")


---------------------------------------------------------------
pip install pywin32
pip install keyboard
pip install opencv-python
pip install pyautogui



1.prucinta itu bayar 10 tahun, dicovernya 20 tahun?
2.bagaimana cara calon nasabah menandatangani Surat Pengajuan
  Asuransi Jiwa Syariah?
3. apakah nilai tunai didapat dari surplus underwriting pada prucinta? ini sumbernya dari Iuran
   Tabarru‚Äô?
4.berapa persen Pajak yang dikenakan atas penebusan Polis? apakah setiap pembayaran premi dikenakan pajak?
5.apakah ujrah berbeda dengan premi?
6.Hal apa saja yang dapat menyebabkan Klaim menjadi tidak dibayarkan?

#prucinta sampai hal 10



1. Betul
2. Kalau ketemu lgs sm kita mrk lgs ttd di tablet or hp, klo online kita cukup foto video call kita dgn mereka.. nantj pru akan kirim sms konfirmasi ke mrk dan mrk tinggal ok kan dan fotokan ktp
3. Iya dr dana pengelolaan dan surplus underwriting
4. Ga kena pajak Wono, tp tetap hrs dicantumkan dalam spt ya utk pembyran premj dan nilai tunai. Krn kita bayar premi kan dr penghasilan bersih yg sudah dikenakan pajak sblmnya
5. Sama aja, cm istilahnya
6. Ada riwayat (pre exsisting condition yg tdk diinfo dan pru tahu), sedang dlm masa tunggu, polis perna lapsed jd masa tunggu ngulang, dokumen tdk lengkap



----------------------------------------------------------
18 november

Ruko Beach Theme Park Bik E no 103 golf island, pantai indah kapuk st, 11470 (Kantor btp e103) penjaringan kota jakarta utara, DKI Jakakrta

<<<<<<< HEAD
-----------------------------------------------------------

19 november

=======
Ruko Beach Theme Park Blk E no 103 golf island, Pantai Indah Kapuk St, 11470
>>>>>>> 8d65af1795a133f12652303cb6fbb01026221da6


------------------------------------------------------------
20 november


https://joy.link/prudential


----------------------------------------
25 november 

script bot instagram meningkatkan followers real people
https://github.com/InstaPy/instapy-quickstart#basic-quickstart-file

-------------------------------------------
26 November
ascii huruf
http://patorjk.com/


-------------------------------------------
30 november

instagram gloria salon
Username: gloria_salon_medan
Pw: gloria2508



--------------------------------------------
2 desember

alamat trivia
jalan kasuari V blok p no 59, RT.15/RW.7, Mekarmukti, cikarang utara(kost orenji)
cikarang utara, kab. bekasi, jawa barat



----------------------------------------------
3 desember

instal update pruforce:
https://install.appcenter.ms/users/plamobileapps/apps/pruforce-android/distribution_groups/pruforcebyprudential

bot komen tp masih belum jalan
https://github.com/redianmarku/YT-Comment-Bot



----------------------------------------------
4 desember

alamat anthony
Jl. Gading Surya Blok A No.6
RT.1/RW.8, Klp. Gading Tim.
Kec. Klp. Gading
Kota Jkt Utara
Daerah Khusus Ibukota Jakarta 14240

----------------------------------------------
6 desember 

Rincian Informasi Login asuransimu.id

Username: asuransi
Password: 4ylcS)86UA)Fd3


sewa server rdp https://shopee.co.id/RDP-2-CPU-4-GB-RAM-Remote-Desktop-Protocol-i.470984935.10012755413

wp admin
admin@asuransimu.id
admin
turboturbo123@@

WordPress has been successfully installed at :
https://asuransimu.id
Administrative URL : https://asuransimu.id/wp-admin/


softaculous
https://asuransimu.id:2083/cpsess1983665300/frontend/paper_lantern/softaculous/index.live.php?act=software&soft=26

https://archive.org/web/



02492833 gps

link download apk prudential
https://portals.prudential.co.id/application/download



--------------------------------------------------
8 desember

-berapa gajinya
-kontrak sampai brp lama
-setelan bisa pakai kaos?
-aturan perusahaan apa aja
-website masih jelek

 



----------------------------------------------
9 desember

keyword


materi asuransi 
jasa asuransi adalah 
asuransi kesehatan 
asuransi di indonesia 
asuransi jiwa 
asuransi prudential 
biaya asuransi prudential 
pertanyaan tentang asuransi 
asuransi kesehatan terbaik 
asuransi kesehatan prudential 
asuransi kesehatan syariah 
asuransi kesehatan di indonesia 
asuransi kesehatan terbaik selain bpjs 
asuransi kesehatan prudential pph
harga asuransi kesehatan 
asuransi kesehatan terbaik di indonesia 
asuransi kesehatan terbaik 2021 
asuransi kesehatan terbaik 2020 
asuransi kesehatan prudential 
cara daftar asuransi kesehatan 



asuransi kesehatan cashless terbaik
asuransi kesehatan terbaik 2020
asuransi kesehatan terbaik di indonesia
biaya asuransi kesehatan
asuransi kesehatan terbaik 2021
pengalaman asuransi kesehatan




cara daftar asuransi kesehatan prudential 
cara daftar asuransi kesehatan online 
biaya asuransi kesehatan 
cara daftar asuransi kesehatan pru 
harga asuransi kesehatan prudential 
premi asuransi kesehatan prudential 
cara daftar asuransi kesehatan 
macam-macam asuransi kesehatan 
tabel premi asuransi kesehatan prudential 
asuransi kesehatan terbaik di indonesia 
asuransi kesehatan cashless 

berhenti asuransi prudential apakah uang kembali 
uang pertanggungan asuransi prudential 
unit link setelah 10 tahun 
cara klaim asuransi pendidikan prudential 
penarikan dana prudential setelah 5 tahun 
ilustrasi prudential premi 500 ribu 
asuransi jiwa prudential 
premi asuransi prudential 350 ribu 
daftar asuransi kesehatan terbaik di indonesia 
cara daftar asuransi kesehatan 
daftar asuransi kesehatan online 
daftar asuransi kesehatan prudential 
daftar asuransi kesehatan syariah 
biaya asuransi kesehatan prudential 
daftar asuransi kesehatan murah 

asuransi kesehatan 
asuransi syariah 
fungsi asuransi 
asuransi jiwa 
macam-macam asuransi 
asuransi di indonesia 
premi asuransi adalah 
asuransi prudential 
asuransi kesehatan di indonesia 
asuransi kesehatan terbaik di indonesia 
asuransi kesehatan prudential 
asuransi kesehatan terbaik 
asuransi kesehatan syariah 
asuransi kesehatan Prudential 2021 
asuransi kesehatan terbaik 2020 
asuransi kesehatan terbaik di indonesia 
asuransi kesehatan prudential 
asuransi kesehatan syariah 
asuransi kesehatan cashless 
apa itu asuransi kesehatan 
manfaat asuransi kesehatan 


jasa asuransi adalah
premi asuransi adalah
asuransi prudential


asuransi kesehatan di indonesia
asuransi kesehatan terbaik 2020
asuransi kesehatan terbaik
asuransi kesehatan prudential
harga asuransi kesehatan
biaya asuransi kesehatan prudential


tabel premi asuransi kesehatan prudential
premi asuransi prudential 350 ribu
kejelekan prudential
asuransi kesehatan prudential 500 ribu
prudential black card harga
ilustrasi prudential premi 500 ribu
berhenti asuransi prudential apakah uang kembali


------------------------------------------------------------

11 desember
keyword tool
https://keywordtool.io/search/keywords/instagram/19091982?category&keyword=slot&country=GLB&language=id#hashtags


----------------------------------------------------------

12 desember

todo list:
-mengumpulkan blog dari tulisan orang yg udah doesnt exist--
-cek 100% unique di plagiarim checker
-posting dan edit situs asuransimu.id


akun 1text fibirey137@kingsready.com

skema dan metode backlink
https://www.indrak.eu.org/2020/04/Skema-metode-backlinks.html

post generator pro
thespinnertext
expiredomains.net
plagiarism checker





----------------------------------------------------------------

14 desember

linksearching
wosgroup
gsa

redirect link google : https://bit.ly/34ghzDj backlink link building



--------------------------------------------------

18 desember

youtube backlink generator 
https://syndicationapp.com/


--------------------------------------------------
19 desember

backlink generator link : https://sitechecker.pro/backlinks-generator/

file manager untuk asuransimu.id tanggal 19 desember di htdocs asuransimu




-------------------------------------------------
20 desember


link telescrapper
https://github.com/termuxprofessor/Telegram-Scraper-Adder




------------------------------------------------
25 desember

dotnet new console -o helloworld(ini nama folder)
 dotnet run --project natal.csproj(ini nama file project)


eror ketika buka program.cs
solusi:
This error also occurs if .Net Core is not installed on your machine. To verify it, please run the command dotnet --help from Windows PowerShell or VS Code terminal. If .Net Core is installed then you will see the output, else the same error. If you see the same error then:

Please download and install it from here.
Then close the CLI or Code editor you are using.
Re-open it again, run the following command:

dotnet new webApp -o aspnetcoreapp


---------------------------------------------

27 desember

daftar saham yang profit besar:
SRTG, INDR, MLIA, ISSP, KICI, SMMT


import requests

proxies = {
    'https': 'https://122.15.131.65:57873'
}


requests.get("https://bit.ly/streamer39", proxies=proxies)
# print(response.json()['country'])
# print(response.json()['region'])




# response = requests.get("https://google.com")
# print(response.text)

-------------------------------------------''
28 Desember

*Salam Natal & Tahun Baru dari GLORIA SALON*

Sambut Tahun baru dengan hati yang terbuka dan semangat yang membara. Tinggalkan yang lama, rayakan yang baru. Semoga Tahun Baru memberimu kemakmuran dan keberuntungan. Kami dari Keluarga "GLORIA SALON" Mengucapkan Selamat Natal dan Selamat menyambut Tahun Baru 2022. Semoga tahun ini diisi dengan petualangan baru dan keberuntungan dengan penuh berkat dari Tuhan. 

Salam hangat,

*Ruslan Parhusip,* 
**GLORIA SALON**


-------------------------------------------

29 desember

pedulilindungi

sertifikat@pedulilindungi.id
perbaikan data sertifikat vaksin covid 19
Ganda Mana Sibagariang
1271171301620001
13 januari 1962
6281262393245


1. Nama Lengkap: Ganda Mana Sibagariang

2. NIK salah 

3. NIK benar 1271171301620001

4. Tanggal Lahir: 
Medan, 13 Januari 1962

5. Nomor HP yang benar : 081262393245

6. Nomor HP yang salah : 082165368510

7. Alamat: Jl. Sei seruai No. 12 Medan

8. Kode Batch Vaksin: 24.001.221

9. Jenis Vaksin: sinovac

10. Status Vaksinasi : sudah vaksin 1 dan 2

11. Email : sarwonosatrio7@gmail.com (anak)


-------------------------------------------------

30 desember

its very hard to get a good deal from bad people



------------------------------------------------------
1 januari 

todo list:
-packing barang untuk pindahan besok ke 
-bongkar komputer hari minggu untuk pindah
-kartu sim register dibawa
-sendok
-laptop
-lampu tidur bawa
-sweeter merah
-botol minum
-tas kecil
-hp evercross 


--------------------------------------------------------

4 januari 

ultraviewer:
45 457 641
2286

ultraviewer pc bawah
47630203 pass: 5545


---------------------------------------------------------

5 januari

todo list:
-login ke channel ytb streamer


----------------------------------------------------

7 januari

cmd: sysdm.cpl : untuk environment variables


masuk ke pengaturan gpedit

cmd: gpedit.msc 


cara konek ke rdp:
You can also disable Network Level Authentication (NLA) using the Local Group Policy editor ‚Äì gpedit.msc (you can run the gpedit.msc in Windows 10 Home edition like this) or using the domain group policy management console ‚Äì GPMC.msc. In the policy editor go to the section Computer Configuration ‚Äì> Administrative Templates ‚Äì> Windows Components ‚Äì> Remote Desktop Services ‚Äì> Remote Desktop Session Host ‚Äì> Security, find and disable the policy ‚ÄúRequire user authentication for remote connections by using Network Level Authentication‚Äú.


disable password REMOTE DESKTOP
You can disable blank password restrictions by using a policy. To locate and change this policy:

-Click Start, point to Run, type gpedit.msc, and then click OK to start the Group Policy Editor.
-Open Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Limit local account use of blank passwords to console logon only.
-Double-click Limit local account use of blank passwords to consol logon only.
-Click Disabled, and then click OK.
-Quit Group Policy Editor.

gpupdate /force


--------------------------------------------------
11 Januari

Surat mengundurkan diri Pru


-----------------------------------------------
15 januari

cmd untuk buka rdp: mstsc


---------------------------------------------
19 januari

VARDSHOP invest:

saratoga 4 lot harga 2720 total: 1.088.000
antam 1 lot harga 1725 total: 172.500


url link vardindo proxy
https://www.youtube.com/watch?v=i2Sz93hZVdk


----------------------------------------
21 januari

secret recovery phrase metamask
wise dynamic typical museum steak race pyramid ahead foster script lift that
metamask wallet address account1: 0x73C71Bb26C4920CB4649D9797E98B5e38117b07a
password metamask: muskmusk

Wallet address:
0x73c71bb26c4920cb4649d9797e98b5e38117b07a

Nonce:
517904


password coinbase @sibagariang
muskmusk123

link nft story of life: 
https://opensea.io/assets/matic/0x2953399124f0cbb46d2cbacd8a89cf0599974963/52367771310392213898923323942064206096431756042914496230400177026601999925249/

atau https://bit.ly/33BGogw

73C71B

i have nft on the polygon blockchain!!





-------------------------------------------

25 januari

referal dewabiz:
https://dewabiz.com/affiliate/
https://my.dewabiz.com/affiliates.php


dewabiz sarwono
https://my.dewabiz.com/aff.php?aff=689&key=VPS Windows RDP
https://my.dewabiz.com/aff.php?aff=689&key=Cloud_VPS
https://my.dewabiz.com/aff.php?aff=689&key=Web_Hosting_Unlimited
https://my.dewabiz.com/aff.php?aff=689&key=DewaBiz.com


affiliate:
binance
dewabiz
binomo


--------------------------------------
26 januari

free ebook html
gutenberg.org


-------------------------------------
29 januari

pass dewabiz: sama dgn vardnews

<a href="https://my.dewabiz.com/aff.php?aff=689"><img src="https://dewabiz.com/assets/images/300X250.jpg" width="300" height="300" border="0"></a>


<a href="https://my.dewabiz.com/aff.php?aff=689"><img src="https://dewabiz.com/assets/images/468X60.jpg" width="468" height="60" border="0"></a>




Special Promotion 50% Recurring
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com


DewaVPN 10% Recurring
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

Cloud Hosting 40% One Time
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

Hosting Super 40% One Time
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

Developer Hosting 40% One Time
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

Semi Dedicated 10% Recurring
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

VPS Pro Max 10% Recurring
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

Dedicated Server IDR 200.000 One Time
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

Colocation Server IDR 200.000 One Time
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

SEO Service 10% One Time
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

VPS Tunnel / VPN  10% Recurring
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

Email Zimbra 10% Recurring 
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

VPS Windows / RDP 10% One Time
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com

VPS Super Compute 10% Recurring
https://my.dewabiz.com/aff.php?aff=689&redirectto=https://my.dewabiz.com



-----------------------------------------------------
31 januari

menambahkan webbrowser python untuk chrome:
import webbrowser
chrome_path = 'C:/Program Files (x86)/Google/Chrome/Application/chrome.exe %s'
webbrowser.get(chrome_path).open('http://docs.python.org/')

-----------------------------------------------------

6 februari

akun shopee  andromax emuskik5@gmail.com pass: kayak vardnews tapi awal huruf kapital


--------------------------------------------------------
9 februari


Yth.
Bp/Ibu

Selamat pagi
Terima kasih atas kepercayaannya terhadap produk Polytron dan telah menghubungi kami melalui email.
Mohon maaf atas ketidaknyamanannya terkait hal ini.

Mengenai perihal tersebut, kami informasikan terlebih dahulu bahwa untuk kebutuhan sparepart tipe tersebut sudah sulit untuk dipenuhi. Namun kami sarankan bp/ibu bisa membawa unitnya ke service center kami apakah unit masih bisa diperbaiki atau tidak. Berikut alamat service center terdekat berada di Jl. KS Tubun Raya No. 62A rt 1 rw 1 slipi kec palmerah - Jakarta Barat 11410.

Jam Operasional Service Polytron kecuali hari libur Nasional :
08.30-16.30 (Senin-Jumat)
08.30-14.30 (Sabtu)

Untuk Informasi alamat POLYTRON Service Center, tertulis di KARTU GARANSI atau hubungi POLYTRON hotline di nomor 1500-833 atau kunjungi
POLYTRON website : www.polytron.co.id, sekaligus untuk mengetahui informasi mengenai produk ‚Äì produk POLYTRON.

Best Regard

Y A N T I

Customer Care




Jl. KS Tubun Raya No. 62A rt 1 rw 1 slipi kec palmerah - Jakarta Barat 11410
1500-833


------------------------------------------------------

10 februari

https://www.penerbituwais.com/

Irvan Taufik
691 subscriber



--------------------------------------------------------
21 februari 

Adobe Illustrator & Photoshop
3D Software (Sketchup / Blender / Autocad)



-------------------------------------------------------

1 maret 

evermos vardshop:
nama: vardshop
no telp: 6281381500579
pass: vard1780
notif dari wa biasanya


jilbab
*Modesee Qanza Vala Dress M Lavender* Modesee Qanza Vala Dress Dress yang satu ini value for money banget, desain everlasting ga kemak... Harga: *Rp135.000* *Produk 100% original* Klik disini untuk beli produk: https://berikhtiar.com/vardshop.ca2/product/modesee-qanza-vala-dress



referal gabung member
Ayo bergabung dengan *Reseller Evermos* lewat link ini dan memulai bisnis anda sendiri seperti vardshop. Dapatkan sd *30%* komisi di setiap penjualan dan reward langsung seperti *Umroh!* Klik untuk join yaa: https://evms.in?linkType=referral&timeout=5000&referralId=vardshop.ca2


---------------------------------------------------------

2 maret

Rukan Golf Island Boulevard, Jl. Pantai Indah Kapuk No.C.15, Daerah Khusus Ibukota Jakarta 14460

RUKAN GOLF ISLAND C15 GOLF ISLAND, Jl. Pantai Indah Kapuk, Daerah Khusus Ibukota Jakarta 14460
(disebelah UNIBIKE.ID dan di dekat urban farm pik)



----------------------------------------------------------
3 maret 

untuk level lebih tinggi dari administrator di regedit
psexec -s -i regedit.exe



indr, kdsi, kici, lpli, lpps, mlia, srtg

-----------------------------------------------------
7 maret

gila01@gmail.com  | email recovery: edosinaga103 pass: adakue1234!!

pass gila sama dengan vardnews@gmail.com



<center><img style="width: 100%" src="https://rebrand.ly/gbr1" alt=""></center>
<br><br>








investasi saham:
ISSP:
entry Rp 448 x 42 lot = Rp 1.881.600


DIVA: 
entry Rp 1195 x 5 lot = Rp 597.500

-----------------------------------

11 maret

investasi saham:
SRTG:
entry Rp 2730 x 15 lot = Rp 4.095.000




------------------------------------
12 maret

mama
+62 821-6092-7618

trivia
62 815-7268-5325

trivia2
+62 858-6773-0460

kak loli
+62 878-9373-5924




login binance:
sama seperti BRI (exact match)
------------------------------------------





-------------------------------
15 maret

quotes
"any men finds a good woman, he's gonna have a good change"


------------------------------------

23 maret

random nft 1001 

https://tinyurl.com/randomnft1001
https://opensea.io/assets/matic/0x2953399124f0cbb46d2cbacd8a89cf0599974963/52367771310392213898923323942064206096431756042914496230400177027701511553025/


https://tinyurl.com/randomnft1002

https://tinyurl.com/randomnft1003
https://opensea.io/assets/matic/0x2953399124f0cbb46d2cbacd8a89cf0599974963/52367771310392213898923323942064206096431756042914496230400177029900534808577



-----------------------------------------------------------
24 maret

https://tinyurl.com/randomnft1004
https://tinyurl.com/randomnft1005
https://tinyurl.com/randomnft1006
https://tinyurl.com/randomnft1007


kartu keluarga: 025003/01/05469 atau 0250030805940002  1271171702050011


Daftar Kantor Pelayanan Pajak Kanwil DJP Jakarta Utara
July 21, 2021

1. Kode Kantor        :120
   Unit Kerja            :Kanwil DJP Jakarta Utara
   Alamat                :Gedung KPP Madya Jakarta Lantai 8-9 Jalan M.I. Ridwan Rais No.5A-7, Jakarta Pusat 10110
   Nomor Telepon    : 021- 3442473, 3505640
   Nomor Faksimili   : 021- 3442762
2. Kode Kantor        :46
   Unit Kerja            :Kantor Pelayanan Pajak (KPP) Madya Jakarta Utara
   Alamat                :Gedung Merpati Lt. M2 dan 5, Kemayoran, Jl. Angkasa Blok B 15 Kav. 2 No. 3
   Nomor Faksimili        :6544330, 65701146
3. Kode Kantor        :41
   Unit Kerja            :Kantor Pelayanan Pajak (KPP) Pratama Jakarta Penjaringan
   Alamat                :Jl. Lada No.3
   Nomor Faksimili        :6904408
4. Kode Kantor        :44
   Unit Kerja            :Kantor Pelayanan Pajak (KPP) Pratama Jakarta Pademangan
   Alamat                :Jl. Cempaka No.2 Tanjung Priok
   Nomor Faksimili        :43932812
5. Kode Kantor        :42
   Unit Kerja            :Kantor Pelayanan Pajak (KPP) Pratama Jakarta Tanjung Priok
   Alamat                :Jl. Enggano No.2
   Nomor Faksimili        :4357437
6. Kode Kantor        :45
   Unit Kerja            :Kantor Pelayanan Pajak (KPP) Pratama Jakarta Koja
   Alamat                :Jl. Raya Plumpang Semper No. 10A
   Nomor Faksimili        :43922085
7. Kode Kantor        :43
   Unit Kerja            :Kantor Pelayanan Pajak (KPP) Pratama Jakarta Kelapa Gading
   Alamat                :Jl. Walang Baru No.10 Semper
   Nomor Faksimili        :4373836
8. Kode Kantor        :47
   Unit Kerja            :Kantor Pelayanan Pajak (KPP) Pratama Jakarta Pluit
   Alamat                :Jl. Lodan No. 3, Ancol
   Nomor Faksimili        :6908454
9. Kode Kantor        :48
   Unit Kerja            :Kantor Pelayanan Pajak (KPP) Pratama Jakarta Sunter
   Alamat                :Jl. Walang Baru No.10 Plumpang Semper
   Nomor Faksimili        :4373842
10. Kode Kantor        :
   Unit Kerja            :KP2KP Pulau Pramuka
   Alamat                :Jl. Cempaka No.2 Tanjung Priok
   Nomor Faksimili        :6542523



 npwp pajak:
 email sarwonosatrio7@gmail.com
 pass sama dgn email asli


 email gantung di vivo
 sarwonosatrio7
 sarwonosatrio9
 onlinetalento
 vardindo
 emuskik


 nick sleep dan qais zakaria
 joel greenblatt
 mohnish pabrai
 chuck akre
 pat dorsey
 

 ----------------------------------------------

 27 maret

 baliyo tas
 https://www.lazada.co.id/products/baliyo-tas-ransel-serut-mikro-saku-depan-best-seller-i3059190038-s5429860850.html?spm=a2o4j.tm80140113.9933553330.119.61137cd5hQ8Rvr&clickTrackInfo=%7B%22rs%22%3A%2220.0997%22%2C%22app_bztag%22%3A%22%22%2C%22pageTypeTwo%22%3A%22Customize+Rule+Base%22%2C%22spma%22%3A%22a2o4j%22%2C%22moduleUUID%22%3A%229933553330%22%2C%22spmb%22%3A%22tm80140113%22%2C%22type%22%3A%22itemFall%22%2C%22pageTypeTop%22%3A%22Hot+Theme%22%2C%22userid%22%3A%220%22%2C%22platform%22%3A%22pc%22%2C%22itemid%22%3A%223059190038%22%2C%22gmv%22%3A%220.0%22%2C%22bs%22%3A%220.017000000923871994%22%2C%22ctr_score%22%3A%220.2016447%22%2C%22ts2%22%3A%221.403449296951294%22%2C%22ccr_score%22%3A%220.1505192%22%2C%22pvid%22%3A%22b7adec61-a7b2-4918-8ddf-ed350ae97bb7%22%2C%22pos%22%3A9%2C%22cvr_score%22%3A%220.0118338%22%2C%22juno_layer_bucket%22%3A%22%22%2C%22scm%22%3A%221007.24053.277753%22%2C%22bztag%22%3A%22%22%2C%22pageTypeOne%22%3A%22Curated+Deals%22%2C%22linkInfo%22%3A%22null%22%2C%22enable_smui_template%22%3A%22%22%2C%22ms%22%3A%220.017%22%2C%22mt%22%3A%22SWI2I%22%2C%22i14d%22%3A%220.019315464422106743%22%2C%22is%22%3A%222244%22%2C%22tr_id%22%3A%221069906567%22%2C%22traffic_source%22%3A%22cp%22%2C%22venture%22%3A%22ID%22%2C%22i30d%22%3A%220.021002890542149544%22%2C%22smui_template%22%3A%22-1%22%2C%22domain%22%3A%22bumblebee%22%2C%22pg%22%3A%2280140113%22%2C%22i7d%22%3A%220.003545617451891303%22%2C%22ids%22%3A%220%22%2C%22rank1_score%22%3A%220.0997305%22%2C%22i3d%22%3A%221.1814722432310238E-17%22%2C%22config%22%3A%2223132072%22%2C%22i1d%22%3A%220.0%22%2C%22enable_smui%22%3A%22false%22%7D

https://www.lazada.co.id/products/baliyo-new-stringbag-kpop-tas-ransel-serut-love-i915706439-s1365622626.html?&search=pdp_same_topselling?spm=a2o4j.pdp_revamp.recommendation_1.1.7039db08q8Uthc&mp=1&scm=1007.16389.126158.0&clickTrackInfo=a10c944d-6963-4c40-8180-fc57737d3610__915706439__17939__trigger2i__224806__0.077__0.077__0.0__0.0__0.0__0.077__0__null__null__null__null__null__null____45000.0__0.7177777777777778__4.690566037735849__265__12700.0__140929,127620,135300,89487,157196,89491,87961,128153,76703,147229,116641,67747,141862,76456,105517,78901,167604,97208,160828,157504,157510,71236,142021,110025,116939,110026,96849,80979,95187,110035,141264,141270,59226,87773,142175,97119,95331,12005,116454,110317,156012,160749,162160,75762,82420,88564,59383,156021,156024,140927,116735__null__null__null__3650.16544_955.3632__null__13426__null__0.0__0.0________null__null


https://www.lazada.co.id/products/bayar-di-tempat-tas-ransel-pria-tas-kerja-tas-kuliah-tas-back-ransel-pria-tas-ransel-import-tas-punggung-tas-ransel-laptop-kerja-backpack-tas-ranselp-pria-kanvas-tebal-tren-backpack-fashion-pria-kapasitas-besar-tas-laptop-tas-sekolah-outdoor-hiking-cbg-i4209614360-s7103172080.html?spm=a2o4j.tm80140113.9933553330.56.61137cd5hQ8Rvr&clickTrackInfo=%7B%22rs%22%3A%2220.1171%22%2C%22app_bztag%22%3A%22%22%2C%22pageTypeTwo%22%3A%22Customize+Rule+Base%22%2C%22spma%22%3A%22a2o4j%22%2C%22moduleUUID%22%3A%229933553330%22%2C%22spmb%22%3A%22tm80140113%22%2C%22type%22%3A%22itemFall%22%2C%22pageTypeTop%22%3A%22Hot+Theme%22%2C%22userid%22%3A%220%22%2C%22platform%22%3A%22pc%22%2C%22itemid%22%3A%224209614360%22%2C%22gmv%22%3A%220.0%22%2C%22bs%22%3A%220.1940000057220459%22%2C%22ctr_score%22%3A%220.3353024%22%2C%22ts2%22%3A%222.808734655380249%22%2C%22ccr_score%22%3A%220.1650814%22%2C%22pvid%22%3A%2210fb8d68-26f2-4c2d-9e97-7cf285bc68f9%22%2C%22pos%22%3A18%2C%22cvr_score%22%3A%220.0116423%22%2C%22juno_layer_bucket%22%3A%22%22%2C%22scm%22%3A%221007.24053.269069%22%2C%22bztag%22%3A%22%22%2C%22pageTypeOne%22%3A%22Curated+Deals%22%2C%22linkInfo%22%3A%22null%22%2C%22enable_smui_template%22%3A%22%22%2C%22ms%22%3A%220.194%22%2C%22mt%22%3A%22SWI2I%22%2C%22i14d%22%3A%220.030051957815885544%22%2C%22is%22%3A%222026%22%2C%22tr_id%22%3A%225484536989%22%2C%22traffic_source%22%3A%22cp%22%2C%22venture%22%3A%22ID%22%2C%22i30d%22%3A%220.02947140857577324%22%2C%22smui_template%22%3A%22-1%22%2C%22domain%22%3A%22bumblebee%22%2C%22pg%22%3A%2280140113%22%2C%22i7d%22%3A%220.019367419183254242%22%2C%22ids%22%3A%220%22%2C%22rank1_score%22%3A%220.117075%22%2C%22i3d%22%3A%220.024026164785027504%22%2C%22config%22%3A%2223132072%22%2C%22i1d%22%3A%220.0%22%2C%22enable_smui%22%3A%22false%22%7D






----------------------------------------------------

10 april

laba
profit margin
laba per saham
modal
nilai buku per saham
pbv
hutang
hutang dolar
hutang rupiah
kas
fee utang
fee utang macet
fee utang afiliasi
persediaan


aksi korporasi bei


--------------------------------------------------

15 april

Berkat Tech (toko)
shopee emuskik5@gmail.com
pass: Jujurberani999
handphone: 0579
username emuskik
nama emuskik


https://www.youtube.com/watch?v=LBof8oeJV4E



mining 
1) Instal File Minernya
$ wget https://github.com/hellcatz/luckpool/raw/master/miners/hellminer_cpu_linux.tar.gz

2) Masuk ke dalam folder miner
$ tar xf hellminer_cpu_linux.tar.gz

3) jalankan minernya
$ ./hellminer -c stratum+tcp://ap.luckpool.net:3956#xnsub -u wallet.workename -p x --cpu 2


Thanks for watching, jangan lupa like,share dan subscribe üòä
Yuk yang mau gabung grub Telegram dan yang mau daftar linknya di bawah üëá

YouTube channel
‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™
‚Ä¢ Cara Mining Sugarchain :https://youtu.be/srxk1B_lCoM

‚Ä¢ Cara Mining Coin MBC :https://youtu.be/MMreevRKX9I

‚Ä¢ Buat RDP Part 1 :https://youtu.be/N4oDQmDG2WY

‚Ä¢ Buat RDP Part 2 :https://youtu.be/LBof8oeJV4E


‚úìüéÅ Saweran üéÅ
‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™
‚úìsemoga berkah =http://bit.ly/Bang__android

üîπLink Download
‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™‚ñ™

üîπlink 1 : https://bit.ly/3dEDgBy

üîπlink 2 :https://bit.ly/3bIfcy0

üîπ Scribd veruscoin vps :https://bit.ly/3tkcK6N

üîπMedia Share



---------------------------------

5 mei 



konfirmasi GAGAL



https://jualhape.myshopify.com/admin/account_setup
edosinaga103@gmail.com


https://tinyurl.com/bisnisgede


<center><a style="width:300px" href="https://berikhtiar.com/tarow.ca6/product/ecentio-stainless-steel-tableware-sets-3pcs-st3e-8501" class="image featured"><img src="https://dl.kaskus.id/idcloudhost.com/wp-content/uploads/2016/12/Beli-Sekarang-Button-Promo-IDclouddHost.png" alt=" " /></a></center><br><br>

rdp server
 IP: 20.213.143.42
Username : kiwari
Password : Rafaasokardp!123



domainesia gozali rdp
gzxdjjem@candassociates.com
pass turboturbo



shopee tarow.id
username tarow.id
pass: sama dgn vardshop keknya 
pin: 131131

edisinaga103@gmail.com
pass:turboturbo



----------------------------------------------

7 mei

facebook dan instagram akun edisinaga 
email edisinaga103@gmail.com
pass: @Turboturbo39 (ig)
@Turboturbo391 (fb)



---------------------------------------
10 mei


tautan wa.me
%20 = spasi
%0A = enter


https://wa.me/6281572685325?text=Halo%20Kak%20:)%0ASaya%20mau%20beli%20produk%20HDI%20Honeybee%20PollenS%203.%0A+%0Aberikut%20alamat%20saya:%0ANama%20Penerima:%0AAlamat%20lengkap:%0AKecamatan:%0AKota/Kabupaten:%0AKodepos:%0AJumlah%20Produk%0A+%0ATrimakasih:)





HDI Trimee II bekerja secara alamiah karena mengandung bahan-bahan alamiah pula, yakni :

Chitosan, yaitu serat makanan yang berasal dari chitin. Chitin adalah sejenis polisakarida yang terdapat di cangkang kerang, udang, lobster, atau kepiting. Secara kimiawi, chitosan serupa dengan serat tumbuhan. Perbedaannya, chitosan mampu mengikat molekul lemak secara signifikan dan mengubahnya menjadi bentuk yang tidak dapat diserap oleh tubuh manusia. Bahkan, jumlah lemak yang dikeluarkan oleh chitosan adalah 7 kali lebih banyak daripada yang dikeluarkan oleh serat-serat lain. Chitosan juga memiliki efektivitas yang sama dengan dengan cholestryramine (obat penurun kolesterol) dalam menurunkan kadar kolesterol, namun tanpa efek samping seperti yang ditimbulkan oleh obat tersebut.

Vitamin C untuk meningkatkan pengeluaran lemak.

Asam sitratuntuk meningkatkan efek mengembang chitosan sehingga akan menimbulkan rasa kenyang.

HDI Trimee II terbukti dapat :

Mengikat molekul lemak yang terdapat dalam makanan sehingga dapat menurunkan penyerapan lemak oleh tubuh.

Meningkatkan jumlah lemak yang dibuang oleh tubuh hingga 7 kali lebih banyak daripada serat lain.

Membantu menurunkan kadar kolesterol dalam darah.

Membantu menurunkan berat badan.

Membantu mengurangi risiko terkena penyakit jantung.



-------------------------------------------------
21 mei

film money
client 9
infiltrator
narcos

------------------------------

30 mei

rdp server
 IP: 20.248.161.238
Username : edosinaga
Password : edosinaga!123


edisinaga300@aol.com
pass @Turboturbo39
082119930039


isman genero
081280811650


-----------------------------------

4 juni
 
login akun gmail rickardi di pc betle hem akses vardnews



Selamat datang di channel VIANO TRAVELING, tempat dimana kalian bisa menikmati pemandangan indah dari mulai jalan lokal hingga 10 tempat wisata di jakarta hanya dari handphone kalian. Tujuan dari pembuatan channel ini untuk mengeksplorasi pemandangan alam indonesia, pemandangan gunung, pemandangan pantai, pemandangan alam asli, tempat-tempat wisata di jakarta yang sudah buka, wisata bogor, wisata terdekat dari tempat kalian, an ataupun jalanan kota yang akan kami sorot sehingga menggambarkan status jalan yang sering kalian lewati mungkin.  Untuk tetap bisa mendapatkan informasi hiburan ataupun yang terupdate kalian bisa mencoba untuk subscribe di channel ini karena kita akan berbagi video view  yang akan membuat kalian terpesona dengan pemandangan alam yang indah di bumi indonesia.





pemandangan alam, pemandangan indah, pemandangan yang indah dan elok, pemandangan pasir timbul raja ampat, pemandangan sawah setelah hujan, pemandangan dari atas bukit, pemandangan gunung terindah, pemandangan di kawasan tokyo, pemandangan indah ladang gandum, pemandangan alam, pedesaan, desa, pemandangan indah, suasana pedesaan, indah, sunda, pedesaan indonesia, alam pedesaan, sawah, lucu, jungle, rain, river, switzerland, suasana desa di swiss, swiss, vlog di swiss, garut selatan, bersih, jawa barat, pegunungan, tasikmalaya, suasana desa, sawah indah, tempat terindah di dunia, wisata alam, makan, mewah, viral, anak sma, suasana, santai, pemandangan indah sepanjang jalan, wisata dieng, wisata jawa tengah, pemandangan gunung, jalan viral temanggung, jalan viral.wonosobo, negeri diatas awan, solo camping, camping rain, rain jungle, camping cooking, cooking, camping, survive camping, survivel, primitive, mountain, beach, tempat populer di swiss, fenomena alam di dunia, orang indonesia di swiss

file sharing dr gmail rickardi
https://tinyurl.com/vianofile



segalanya yg kuberika semuanya dr padamu
trimakasih ayah dan ibu kasih sayangmu padaku


-------------------------------------------------------

12 juni

discounted cash flow : prediksi present Free Cash Flow di waktu yang akan datang

DCF berfungsi untuk menentukan present value suatu aktiva


CKPN : cadangan kerugian bank, karena Non Performing loan tinggi
LDR: loan deposit Ratio, normalnya diatas satu karena harusnya lebih bagus loan tinggi agar aktifitas operasi bank tumbuh


discount rate:   


-------------------------------------------------
13 juni


investasi saham:
SRTG:
entry Rp 2940 x 14 lot = Rp 4.160.000

rdp server
 IP: 20.5.40.38
Username : pulih
Password : tokopedia.com123

--------------------------------------------
17 juni

6288972300401
lolipop123@

elly_mehhrrr

Lolipop25082

gloria_ak1992@yahoo.co.id
Lolipop2508

Password FB : laudya

https://youtu.be/qJ-d6FRmOhQ

Lolipop25083


_xxpirate_kingxx_
marcojulitalabarthe

-------------------------------------
18 juni

indikator saham lapkeu

-asset turn over tinggi
-inventory turn over tinggi
-saldo laba > modal disetor
-pajak = 25%
-revenue = kas masuk, laba bersih = kas operasi

https://www.youtube.com/watch?v=G60jSMKajvc
menit= 46:38
-------------------------------
23 juni

template kerjasama di wa
Halo Digimarketing
Kami dari aplikasi Suwun ingin mengundang Bpk/Ibu untuk bergabung sebagai Mitra.

Manfaatkan platform aplikasi utk mendapat ORDER dan CUSTOMER baru di sekitar lokasi Anda.
Gratis! Buat profile Anda untuk kategori jasa yg sesuai bidang Anda di platform digital marketplace jasa lokal di Indonesia (suwun.co.id).

Caranya mudah, cukup install dan daftar sebagai Mitra melalui aplikasi Suwun Mitra di Playstore / Appstore.

onelink.to/suwunmitra

Apabila ada pertanyaan atau kendala dalam proses pendaftaran, mohon hubungi WA CS Suwun di 08111160708 ( wa.me/628111160708 ) atau telp 021-31141213


--------------------------------
24 juni 

spinner: http://tools.satyapratisna.id/?tools=spinner

----------------------------------
8 juli

https://salonglorya.wixsite.com/site

-------------------------
13 juli

09:46:34	09:46:34	AVIA	Sell	955	22	0	22	Full Matched	WEB	
10:05:41	10:05:41	ANTM	Sell	1,750	1	1	0	Open	WEB	 
10:16:30	10:16:30	SRTG	Buy		2,380	9	9	0	Open	WEB



investasi saham:
SRTG:
entry Rp 2380 x 9 lot = Rp 2.142.000


-----------------------------------
17 juli

virtual machine virtual box di pc kantor
desktop2 pass: sama dengan nft


------------------------------------

20 juli

blackhat seo:
beli link,footer link, hidden link, comment spam, anchor text berlebihan, malicious backlink, PBN

-------------------------------------
21 juli

Perkenalkan, saya Frans dari MDI Ventures, VC arm dari Telkom Indonesia.

Mohon izin saya menginfokan program yang sedang kami jalankan.
Pendaftaran terakhir hari ini, silahkan bagi teman-teman startup founders yang tertarik üëç

Apabila ada kendala dalam melakukan registrasi, bisa mengirimkan file2 yang dipersyaratkan via email ke info@hub.id.
Terima kasih
Apabila ada kendala dalam melakukan registrasi, bisa secara manual mengirimkan email hendak mengikuti program beserta file-file berikut:
- logo startup (format png)
- pitch deck (format pdf)
- CV founders (format pdf)

Ke info@hub.id








program new tab batch file


@echo off

::: $$$$$$\   $$$$$$\  $$$$$$$\  $$\      $$\  $$$$$$\  $$\   $$\  $$$$$$\  
:::$$  __$$\ $$  __$$\ $$  __$$\ $$ | $\  $$ |$$  __$$\ $$$\  $$ |$$  __$$\ 
:::$$ /  \__|$$ /  $$ |$$ |  $$ |$$ |$$$\ $$ |$$ /  $$ |$$$$\ $$ |$$ /  $$ |
:::\$$$$$$\  $$$$$$$$ |$$$$$$$  |$$ $$ $$\$$ |$$ |  $$ |$$ $$\$$ |$$ |  $$ |
::: \____$$\ $$  __$$ |$$  __$$< $$$$  _$$$$ |$$ |  $$ |$$ \$$$$ |$$ |  $$ |
:::$$\   $$ |$$ |  $$ |$$ |  $$ |$$$  / \$$$ |$$ |  $$ |$$ |\$$$ |$$ |  $$ |
:::\$$$$$$  |$$ |  $$ |$$ |  $$ |$$  /   \$$ | $$$$$$  |$$ | \$$ | $$$$$$  |
::: \______/ \__|  \__|\__|  \__|\__/     \__| \______/ \__|  \__| \______/ 
:::
:::
:::           CREATED BY: SARWONO SEO
:::
:::
:::
:::
:::
:::
:::
:::

for /f "delims=: tokens=*" %%A in ('findstr /b ::: "%~f0"') do @echo(%%A

set /p id="Enter URL YOUTUBE: "


start "Chrome" "C:\Program Files\Google\Chrome\Application\chrome.exe" --profile-directory="Profile 1" %id%
start "Chrome" "C:\Program Files\Google\Chrome\Application\chrome.exe" --profile-directory="Profile 2" %id%


<<<<<<< HEAD
-----------------------------------








-----------------------------------
>>>>>>> 42517bb659c8e1bf0c9ec662577f9d4db253ccc9




Profil bisnis usaha

Usaha bergerak di bidang kuliner yang menyajikan produk ayam crispy yang bisa dipadukan dengan nasi untuk lauk sebagai ciri khas orang indonesia yang ingin kenyang dengan harga murah. Apalagi di saat sekarang ini banyak orang yang mencari alternatif makanan yang mudah di terima dari cita rasa yang juga mempunyai harga murah. Kemudian nanti akan diberikan berbagai topping khusus yang bisa dipilih oleh para pembeli.



Target market

Saat ini usaha ayam crispy memang ditujukan kepada orang-orang yang ingin jajan namun juga sekaligus ingin kenyang untuk teman nasi sehingga mereka bisa mendapatkan makanan murah yang tersedia di jalanan sambil mereka melanjutkan perjalanan.  Orang-orang yang membeli memang berkisar antara menengah ke bawah sehingga nantinya harga yang akan dipatok akan menyesuaikan dengan kemampuan pembelian mereka.





Tempat jualan

 Di pinggir jalan,   di depan indomaret ataupun di kios-kios yang di sewa dan mempunyai pengunjung yang cukup banyak menengah ke bawah setiap harinya



Target penjualan

Setiap hari di targetkan penjualan minimal 50 porsi dengan laba bersih sekitar rp7.000. Perhitungan ini akan membuat laba per hari sekitar rp350.000. 



Gambaran detail produk

Produk merupakan ayam crispy yang tidak bertulang sehingga setiap orang bisa langsung mengunyah makanan dan bisa menjadikannya sebagai teman lauk untuk nasi. Bentuknya seperti shilin  ayam goreng yang tanpa tulang dengan tepung khusus,  dan ditaburi bumbu bubuk yang meningkatkan cita rasa.  Juga nanti akan disediakan minuman botol yang siap sedia seperti teh botol sosro coca-cola dan sebagainya.



Peralatan yang dibutuhkan

Booth  untuk jualan,  wijen penggorengan,   peralatan dapur untuk memasak,  gunting-gunting,  sarung tangan,  apron koki,  handphone,  bahan baku makanan,  ayam yang sudah di fillet,  bubuk penyedap,  kemasan dalam berbagai ukuran



Kebutuhan lainnya

Tempat strategis untuk berjualan dengan minimal pengunjung sekitar 1000 orang per hari, banner jualan,  menu makanan



Anggaran dan investasi

Sewa tempat satu juta/ bulan, booth  dan bahan baku 2 juta





PT. ANUGRAH JAYA TRIMAR
Alamat	:	TAMAN CIBODAS JL. MELATI II BLOK F2 NO.01 KEL. SANGIANG JAYA KEC. PERIUK

Taman Cibodas Blok F2 No.1 RT.02 RW.09 Kel, Sangiang Jaya, Periuk, Kota Tangerang, Banten 15132
Email. anugrah_jayatrimar@yahoo.com


powder bubuk 25gr rp 1375
gula pasir 15gr rp 200
skm 15gr rp 363
uht freshmilk 50ml rp 833
cup dll rp 500





domainesia emuskik2@gmail.com pass sama dgn digimarketing



domainesia
sarwonosatrio9@gmail.com
pass sama digitalmarketing





--------------------------------------------

12 agustus

security question indopremier

nama bapak gandamana
nama ibu ruslan
nama pembimbing handarto



Nama file PDF: Tes Gambar_Nama_Posisi yang dilamar

Kirimkan ke Link Gform
https://bit.ly/mkmtesgambar 

Apabila link tidak bisa diakses bisa kirimkan ke alamat email kami talent.acquisition@kcngroup.co.id


tko auth HBWW6ZCQMNKGE5JX



sarankan untuk input kode email terlabih dahulu lalu kode otentifikasi SMS dan juga kami sarankan untuk instal ulang kambali aplikasi google otentifkasi dan ikuti panduan berikut
Berikut adalah mengaktifkan Google Authenticator :

1. Pastikan sudah mengunduh aplikasi Google Authenticator di Playstore atau di App Store
2. Mengakses akun Tokocrypto > pilih ‚ÄúProfil‚Äù pada pojok kanan atas > pilih ‚ÄúKeamanan‚Äù > pilih ‚ÄúOtentikasi Google‚Äù > pilih aktifkan ‚Äúmati‚Äù atau off‚Äù
3. Selanjutnya akan muncul notifikasi ‚ÄúPastikan sudah download Google Authenticator‚Äù lalu pilih ‚ÄúLanjutkan‚Äù
4. Selanjutnya akan muncul Kode QR dan dibawahnya terdapat kode sebanyak 16 digit terdiri kombinasi angka dan huruf yang dapat disimpan untuk cadangan apabila sewaktu-waktu ada kendala di aplikasi Google Authenticator
5. Masuk ke aplikasi Google Authenticator
6. Pilih tanda (+) di pojok kanan bawah
7. Pilih ‚ÄúEnter a new set up key‚Äù atau ‚ÄúTambahkan kode kunci‚Äù
8. Pada kolom ‚ÄúAccount Name‚Äù atau ‚ÄúNama Akun‚Äù dapat di isi dengan ‚ÄúTokocrypto‚Äù atau nama lain sesuai keinginan
9. Pilih ‚ÄúAdd‚Äù atau ‚ÄúTambahkan‚Äù
10. Pilih simbol titik 3 di pojok kanan atas lalu pilih ‚ÄúSync Now‚Äù
11. Kembali ke aplikasi Tokocrypto lalu lakukan permintaan kode OTP SMS, email dan kode Google Authenticator (secara berurutan)
Berikut panduan untuk mengaktifkan Google Authenticator dalam bentuk artikel dan video:
- Artikel: https://support.tokocrypto.com/hc/id/articles/360053178571-Cara-Mengaktifkan-2FA-Google-Authenticator-di-Tokocrypto
- Video: https://www.youtube.com/watch?v=ULup4l92wmM




Apabila memang anda tetap ingin dilakukan proses offline, silakan ke alamat Tokocrypto: AXA Tower 37th Floor Jl. Prof. DR. Satrio RT.14/RW.4, RT.11/RW.4, Kuningan, Karet Kuningan, Kecamatan Setiabudi, Kota Jakarta Selatan, Daerah Khusus Ibukota Jakarta 12940, Indonesia. Namun kami informasikan kembali bahwa kami masih menerapkan sistem WFH, jadi kami tetap menyarankan Bapak untuk mencoba kembali secara berkala dan secara mandiri untuk proses aktivasi 2FA Googlenya




----------------------------------------

14 oktober

Durensisu merupakan Toko minuman kekinian segar Es Kocok Durian Susu yang hits di Kota Tangerang. Dengan resep es durian kocok rahasia yang sangat digemari anak muda. Minuman dingin yang ditawarkan bervariasi diantaranya ada menu Orisisu (es durian kocok), Redsisu (es durian + red velvet cream), Tarosisu (es durian + taro cream), Goodsisu ( es durian + Dancow Cream) dan masih banyak menu lainnya. Kedepannya Durensisu akan membuka kemitraan franchise minuman dalam waktu dekat untuk melebarkan sayap bisnisnya. Harga minuman kekinian ini bervariasi mulai dari 10 ribu rupiah saja sudah bisa menikmati sensasi duren sampai ke ujung lidah.



--------------------------------
17 okt

daftar tiktok vardindo@gmail.com
no 3

tele durensisu pake no 3z


-----------------------
31 okt 
pass durensisu instagram: lupuslupus


---------------------------------------
17 november

‚Ä¢ Restoran Selera Asia
‚Ä¢ Nama :Sarwono sibagariang
‚Ä¢ Usia :28
‚Ä¢ Pendidikan Terakhir :S1 Teknik Pertanian
‚Ä¢ Alamat :Jl Hanila 1 no 2 Tangerang Cibodas
‚Ä¢ Posisi yang Ingin Di lamar: Staff Administrasi



Perkenalkan saya Sarwono Sibagariang, seorang lulusan Universitas Padjadjaran. lewat email ini saya ingin menyampaikan lamaran pekerjaan saya di perusahaan Anda. Saya percaya bahwa saya dapat memberikan kontribusi terbaik bagi perusahaan Bapak. Jika Bapak/ibu tertarik mohon membalas email ini melalui nomor whatsapp 081910467527. Terimakasih atas perhatian Bapak/Ibu.



berikut usaha minuman durensisu pak

Mau usaha Es Durian (minuman)
Luas space 1,2m
Pemakaian listrik sekitar 40 watt/hari
Menggunakan both lipat



-----------------------------------

26 nov

Perkenalkan nama saya Sarwono Sibagariang. Saya adalah alumni Universitas Padjadjaran Jatinangor, jurusan Teknik Pertanian. Saya memiliki pengalaman bekerja sebagai web programmer di PT Graha Mitra Teguh. Saya juga pernah menjalani magang di PT Padasa Enam Utama pada saat berkuliah. Saya memiliki keterampilan digital marketing yang saya pelajari secara otodidak berupa Search Engine Optimation (SEO), Google ads, FB ads, dan IG ads. Saya juga memiliki pengalaman berwirausaha di bidang online giftshop dan minuman kekinian.
Saya memiliki kemampuan public speaking yang tak perlu diragukan lagi. Saya memiliki motivasi kerja yang tinggi, optimis, jujur, tekun, mampu berkomunikasi dengan baik, dan mampu mempersuasi orang lain. Saya mampu bekerja secara individu maupun dalam tim. 

Jika Bapak/ibu tertarik mohon membalas email ini. Terimakasih atas perhatian Bapak/Ibu.



-----------------------------
2 des

pass pt reska (KAI)
sarwonosatrio7
lupuslupus


expired domain emuskik
emuskik2@gmail.com
muskikelon



sejarah expired domain smartial.net wayback



---------------------------------
6 des
sarwonosatrio7@gmail.com
@Lupuslupus123 BUMN dan DPI




no kk 1271171702050011


---------------------------------

17 desember


[18.50, 15/12/2022] Sarwono: Terima kasih telah bersedia mengikuti tes online PT Sahabat Abadi Sejahtera. Berdasarkan hasil tes online tsb, kami mengundang Anda untuk tes psikotest pada:

 

Waktu                  : Senin, 19 Desember 2022

Pkl.                        : 08:45 WIB

Tempat                : Kantor PT Sahabat Abadi Sejahtera

Alamat                 : Jalan Indo Karya 3 Blok F No. 1-2, Sunter, Jakarta Utara 14340

 

Lokasi via Google Maps: http://bit.ly/PTSASSunter.

 

Sertakan kelengkapan dokumen: CV dan surat lamaran kerja. Bawa alat tulis pulpen tinta (non gel) dan kalkulator pribadi (kalkulator handphone juga boleh).

 

Note :

Wajib Menggunakan Masker KN95/KF94

Mengutamakan Domisili JABODETABEK

Mohon abaikan pesan ini jika anda pernah tes psikotest di perusahaan ka‚Ä¶
[10.13, 17/12/2022] Sarwono: Semangat pagi SARWONO TAMBA SATRIA SIBAGARIANG

Selamat Saudara/i dinyatakan Dapat Melanjutkan seleksi rekrutmen bersama Tahun 2022 Batch 2. Selanjutnya Saudara/i diundang untuk mengikuti tahap Seleksi Online Tes Kemampuan Dasar (TKD) dan Core Values BUMN.


NAMA LENGKAP

:

SARWONO TAMBA SATRIA SIBAGARIANG
EMAIL

:

sarwonosatrio7@gmail.com

PASSWORD



:

166823

MATERI SELEKSI 
TES ONLINE 

JADWAL

HARI

DURASI TES

WAKTU MULAI PELAKSANAAN TES

LINK TES

Trial Test & Registrasi dan Perekaman Wajah

Senin, 19 Desember 2022

30 Menit

11:30:00 WIB

klik disini

Tes Online Tes Kompotensi Dasar (TKD) dan Core Values BUMN

Rabu, 28 Desember 2022

120 Menit

09:15:00 WIB

klik disini




Berikut beberapa hal yang harus diperhatikan:

Waktu pelaksanaan tes adalah Waktu Indonesia Barat (WIB). Bagi Saudara/i yang berada di luar wilayah WIB, mohon menyesuaikan waktu.
Saudara/i disarankan mengakses tautan tes melalui email agar menghindari antrian akses login website rekrutmen. Akses melalui website tetap dapat dilakukan jika email belum didapatkan atau apabila terjadi kendala dalam mengakses link tes melalui email, dengan cara masuk pada halaman Lamaran Saya tombol Detail Jadwal/Jadwal Hari Ini.
Saudara/i WAJIB menggunakan perangkat dan menyalakan kamera laptop/PC selama tes berlangsung. Kamera akan mengawasi aktivitas Saudara/i, sehingga tidak diperkenankan untuk didampingi dan/atau dibantu orang lain selama pelaksanaan tes. Setiap peserta diharapkan mengerjakan tes secara mandiri dan jujur. Apabila kamera tidak aktif dan tidak dapat mendeteksi aktivitas kandidat dalam mengerjakan tes, maka akan mempengaruhi hasil penilaian. 
Gunakan tautan tes di atas untuk mengakses trial test dan pelaksanaan online test.
Saudara/i hanya dapat memulai test pada jadwal yang telah ditentukan, yaitu waktu mulai sampai dengan waktu berakhir.
Silahkan masuk ke tautan tes dengan menggunakan username dan password di atas
Materi tes adalah milik Panitia Rekrutmen Bersama BUMN. Saudara/i dilarang memberikan atau menyebarluaskan materi tes dalam bentuk apa pun dan kepada siapa pun.
Saudara/i wajib mempersiapkan perangkat tes 15 (lima belas) menit sebelum waktu yang ditetapkan.
Perangkat yang digunakan pada saat pelaksanaan Tes Online harus sama dengan perangkat yang digunakan saat mengerjakan Trial Test. Pastikan menggunakan jaringan internet dan listrik yang stabil, serta gunakan jaringan internet yang sama pada saat pelaksanaan tes selanjutnya. 
Untuk kenyamanan Saudara/i  dalam pengerjaan tes, Panitia mewajibkan penggunaan PC/laptop dengan Processor Core i3 atau setara, serta RAM minimum 4GB untuk kehandalan perangkat dalam pelaksanaan tes.  Panitia tidak menyarankan penggunaan perangkat HP/tablet pada saat pelaksanaan tes. Gunakan browser Mozilla Firefox atau Google Chrome versi terbaru. Tes Online hanya dapat diakses dengan kedua browser tersebut.
Peserta dapat mempelajari petunjuk berikut sebelum menghadapi Trial Test dan Tes Online: (klik di sini)
Panitia tidak bertanggung jawab terhadap segala bentuk risiko yang disebabkan oleh kelalaian peserta dalam keterlambatan mengakses tes atau kendala lainnya, seperti kualitas jaringan internet dan listrik atau perangkat yang dapat mengganggu proses pelaksanaan seleksi ini.

Untuk menjadi perhatian bahwa peserta yg lolos pada tahapan seleksi ini adalah mereka yang memiliki nilai akhir dengan ranking Nilai Akhir teratas, berdasarkan Job Position pada BUMN yang dipilih oleh peserta.

Untuk informasi / pertanyaan, hubungi Help Desk pada saat jadwal seleksi berlangsung.

Help Desk:
WA: +628118954320
Email: rekrutbersama@fhcibumn.id
Telegram: https://t.me/BumnFHCI_bot

Mari belajar, bertumbuh, dan berkontribusi untuk Indonesia!



Salam, 
Panitia Rekrutmen Bersama BUMN 2022







-----------------------------------------------------

22 des

-bikin program python lamar otomatis


--------------------------------------------
3 januari 2023

karir.com pasword lupuslupus email emuskik2



------------------------------------------
13 januari

device manager cmd devmgmt.msc
system properties sysdm.cpl

------------------------------------
18 januari

create a new repository on the command line

echo "# gilagila" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M main
git remote add origin https://github.com/sibagariang/gilagila.git
git push -u origin main






sarwonosatrio9 github
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

-------------------------------

10 feb

tar -xvf (nama deb)

msfvenom:membuat virus, payload,trojan
meterpreter: untuk mengontrol target


hr 63 960 326 3011

----------------------------

15 feb

eval:


-botol ga bisa dibuka
-cup nya meleleh pas di sealer
-banner patah
-pelanggan kabur krn botol ga kebuka
-pada saat mau makan malam gada yg jaga(sebaiknya beli cctv)
-banner harus berlampu biar org rame

============post shift============

REPORT POST SHIFT
Senin, 10 Januari 2023
Jam Buka : 
Jam Tutup : 

LAPORAN SALES HARIAN

1. Offline Sales
(Ini bisa dilihat di Apps bukukas, karena semua orderan wajib diinput ke cebukukas) 
- Orisisu : ....cup (kalau ada topping tambahan, tulis)
- Tarosisu : 
- .....
- Es Ketan Duren Sumsum :
Total :
Total Omset :

2. Online Sales
(Selain tercatat di apps shoppe, gofood, dan grab, orderan online juga harus diinput ke bukukas supaya bisa hitung total pemasukan, tulis note di bukukasnya "shopee/grab/gofood")
- Orisisu : ....cup
- Tarosisu : 
- .....
- Es Ketan Duren Sumsum :
Total omset : 

SEMUA PEMASUKAN HARUS DICATAT DI BUKU KAS

LAPORAN PENGELUARAN
- Jumlah pengeluaran : 
- SEMUA PENGELUARAN HARUS DICATAT DI BUKUKAS

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
Tulis jenis bahan baku yang hampir habis dan warning utk segera dibeli, cek juga token listrik, plastik, batre, dll

EVALUASI
Tulis apapun yg menjadi evaluasi hari ini, misalnya komplain pelanggan, problem, dll untuk perbaikan kedepannya
Token beli dimana?
alfamart
Nanti kita tetapkan safety stock tiap bahan
Tokennya brp
km mau ngga kasih gratisan atau bonus ke pelanggan yang share di story IGnya
brapa aja
oya lupa pengeluaran


==================================post shift===========






REPORT POST SHIFT
15 feb 2023
Jam Buka : 9.30
Jam Tutup : 21.00

LAPORAN SALES HARIAN

1. Offline Sales
(Ini bisa dilihat di Apps bukukas, karena semua orderan wajib diinput ke bukukas) 
- Orisisu : 9
-topping duren:1
Total :9
Total Omset :90.000

2. Online Sales
Total omset : -


LAPORAN PENGELUARAN
- Jumlah pengeluaran : -



LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
tissue habis

EVALUASI
-botol ga bisa dibuka
-cup nya meleleh pas di sealer
-banner patah
-pelanggan kabur krn botol ga kebuka
-pada saat mau makan malam gada yg jaga(sebaiknya beli cctv)
-banner harus berlampu biar org rame

----------------------
17 februari

-beli beras
-beli abon


-saran beli horden
-papan holder utk akrilik

kartu tri aktif
https://shopee.co.id/Kartu-perdana-tri-Aon-2GB-sudah-aktif(TINGGAL-PAKAI)-i.63553416.11646004715?sp_atk=a2c1d55a-c5ba-4971-b713-7849e81a9c3c&xptdk=a2c1d55a-c5ba-4971-b713-7849e81a9c3c


----------------------
18 februari

stand wedding
https://shopee.co.id/STAND-FOTO-FOR-WEDDING-i.288648995.11006830397?sp_atk=76a77d18-10e4-4ab5-986c-c625f175ff72&xptdk=76a77d18-10e4-4ab5-986c-c625f175ff72

https://shopee.co.id/MINI-STAND-FOTO-TERMURAH-i.274557599.10901633049?sp_atk=dbcde27c-37ea-49cd-beac-314896edde45&xptdk=dbcde27c-37ea-49cd-beac-314896edde45


warna ruko kuang menarik
meja dilapisi walpaper kayu
dinding lapisi walpaper kayu
dinding dikasi stiker
banner depan stand walpaper
kasi tanaman di depan
token
tisu
stiker es duren kocok diganti
cat gerobak hitam
ketan durian



felhan sweet cream 75 ribu (masukin buku kas)

pengeluaran durensisu:
-22000 beli tissue (trivia yg beli buat pecah uang)

eval:
-lalat banyak, harus semprot baygon
-hand sanitizer dah mau habis
-td hectic jadinya mengocok durian beku. soalnya durian pertama sudah habis.
-cari alternatif gimana cara memanaskan durian beku


---------------------
20 februari

-post shift masukkan tugas: 
input durian ke freezer
cuci alat
masukkan bangku
hitung stok


kalo beli pake shopee, di buku kas ngeprint nya gmn?

neon standing 
https://www.tokopedia.com/afamartstore/neon-box-standing-1-5-m?extParam=ivf%3Dfalse%26src%3Dsearch

buat stiker
-ES DURIAN KOCOK
-LOGO 




REPORT POST SHIFT
20feb2023
Jam Buka : 10.00
Jam Tutup : 23.22

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 7
extra duren 1
toping keju 1



Total :7
Total Omset :76000


LAPORAN PENGELUARAN
- Jumlah pengeluaran : 

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
Hand sanitizer mau habis
Dancow tinggal setengah
keju dah mau habis

EVALUASI
posting di tiktok banyakin
gandeng influencer tiktok
banner jalan + lampu anti hujan
rencanakan tiktok ads (bisa mulai 33rb)


--------------------------------
21 februari

To do list :
1. Tolong tambahin ekstra topping di shopee sama grab-- (gabisa kalo gada gambar sendiri)
2. Sama buku kas juga dilengkapin dgn harga topping dan harga grab++
3. Tempelin adaptor dan solder++
4. Profpic shopee food dan grabfood
5. Tiktok posting setiap hari
6. Beli dancow, handsanitizer, keju di alfamart (harga diskon lebih bagus)

7. Tolong bikinin es duren nanti siang : orisisu 1 (es kurangin 20 gram, duren tambah jd 25 gram, dancow tambah 2 gr ), chizisu 1. Pastiin cup sealernya kamu priksa dulu sebelum dikasih ke customer


kertas termal terakhir


tiktok durensisu
http://bit.ly/3lUVu9P



------------------
24 feb

REPORT POST SHIFT
24 feb
Jam Buka : 
Jam Tutup : 

LAPORAN SALES HARIAN

1. Offline Sales
milosisu 2
orisisu 2
arensisu 1
dancowsisu 1
oreosisu 1

Total :7
Total Omset :94000

2. Online Sales

 

LAPORAN PENGELUARAN
- Jumlah pengeluaran : 50000 (uang makan sarwono potong gaji)


LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
keju mau habis
es mau habis
dancow 1/4 lagi

EVALUASI
-harus riset lagi es duren kompetitor gmn cara bikinnya
-riset gmn biar ga kurang manis dan mirip es teh (cair tp tetap manis)

-----------------------
25 feb

REPORT POST SHIFT
25 feb
Jam Buka : 10.14
Jam Tutup : 23.28

LAPORAN SALES HARIAN

1. Offline Sales
chezisu 1
orisisu 1
extra dancow 1

Total :2
Total Omset :29000

2. Online Sales

 

LAPORAN PENGELUARAN
- Jumlah pengeluaran : hand sanitizer + cheese maggy 43000


LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
trashbag

EVALUASI
-harus ada makanan berat
-riset cuanki yg enak
-cari toko yg sukses jualan bakso/cuanki
-perlu iklan di jalan sprt bendera durensisu atau apa (banyak yg masih blm tau krn gada iklan di jalan)


----------------------------
26 februari

bikin fb, ig, pinterest
cek sweet ori
bikin lampu sorot ke logo durensisu

instagram durensisu @durensisu.id
pass: redsisu
+62 896-6197-4219


---------------------------
27 feb



REPORT POST SHIFT
27 feb 2023
Jam Buka : 10.13
Jam Tutup : 21.00

LAPORAN SALES HARIAN

1. Offline online Sales
(Ini bisa dilihat di Apps bukukas, karena semua orderan wajib diinput ke bukukas) 
- Orisisu : 9
milosisu 3
dancowsisu 1
oreosisu1
cheesisu 1
tarosisu 1
extra keju 2
extraduren 1

Total :16
Total Omset :206.000




LAPORAN PENGELUARAN
- Jumlah pengeluaran : -



LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
dancow mau habis

EVALUASI 
-harus dapat database pelanggan (no hp dan email)




-nyuci beras dan teplon
-bikin video tiktok suasana malam


qris
28000 ko billy 26 feb
13000 20feb
21000 trivia 26feb
16000 vardshop 12feb
55000 stefan limki




-------------------------
28 feb



REPORT POST SHIFT
28feb2023
Jam Buka : 10.00
Jam Tutup : 23.22

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 7
milosisu 1
cheesisu 1
extra duren 4

total 9
omset 113.000



Total :7
Total Omset :76000


LAPORAN PENGELUARAN
- Jumlah pengeluaran : 

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
dancow (sisa 1/9)
sweet cream (sisa 1/2)
token tinggal 2rb an (dah mau bunyi)


EVALUASI
-harus pasang bell selamat datang di durensisu di teras(cek di shopee)









--------------------------
1 mar


REPORT POST SHIFT
1 mar 2023
Jam Buka : 10.00
Jam Tutup : 22.44

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 3
redsisu 2
milosisu 1
cheezisu 1
extra duren 1



Total :7
Total Omset :89000


LAPORAN PENGELUARAN
- Jumlah pengeluaran : gaji -700.000

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
dancow (sisa 1/10)
sweet cream (sisa 1/4)
token tinggal 2rb an (dah mau bunyi)


EVALUASI
-harus pasang bell selamat datang di durensisu di teras(cek di shopee)
-harus endorse/tiktok ads
-bikin lesehan 





ip addr
iwconfig
cat /etc/os-release 






sarung tangan
tisu
dancow





REPORT POST SHIFT
2 mar 2023
Jam Buka : 10.00
Jam Tutup : 22.00

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 4
cheezisu 1
extra duren 1
extra keju 1



Total :5
Total Omset :62000


LAPORAN PENGELUARAN

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
dancow (sisa 1/10)
token 1700 kwh


EVALUASI
-harus pasang bell selamat datang di durensisu di teras(cek di shopee)
-pasang banner di jalan pake gambar opa korea (target cewek)





----------------------------


REPORT POST SHIFT
5mar 2023
Jam Buka : 10.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
cheesisu 4
orisisu 5
arensisu 1
dancowsisu 1
extra duren 1
extra keju 1



Total :11
Total Omset :150000


LAPORAN PENGELUARAN
skm 44700
meg keju 10500
kresek 500
total 55700

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
token 1700 kwh
keju tinggal dikit
skm tinggal 1


EVALUASI
-harus pake banner jalan
-arensisu kenapa ga arennya jadi extra toping aja?


62 857-1044-4951 adityas mau minta frenchise

lapkeu foodiz https://drive.google.com/file/d/19oguJJ1YeNk964bDNJuLe4AOCmBhRuq8/view

-------------------------
5 maret

REPORT POST SHIFT
9mar 2023
Jam Buka : 10.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 2
redsisu 1
dancowsisu 1




Total :4
Total Omset :50000


LAPORAN PENGELUARAN
skm 44700
meg keju 10500
kresek 500
total 55700

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
es serut 18rb

EVALUASI
-bang yuza bilang pike bayar meja lampu bangku sapu di ruko. aku bilang ga ada. jd pike penipu
-pike memarkup semua biaya gerobak roti bakar, gas kompor wajan sisa martabak di jual ke bang yuzak pake harga baru padahal bekas
-pike bukan partner bisnis yg bagus


--------------------
8 maret

bang yuza utang 3rb 


3774-6414-3378-1726-2863


-----------------------
9 maret

-menghitung kas
-membuat lap keu
-memasang taplak meja




5 maret

REPORT POST SHIFT
5mar 2023
Jam Buka : 10.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
cheesisu 4
orisisu 5
arensisu 1
dancowsisu 1
extra duren 1
extra keju 1



Total :11
Total Omset :150000


LAPORAN PENGELUARAN
skm 44700
meg keju 10500
kresek 500
total 55700

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
token 1700 kwh
keju tinggal dikit
skm tinggal 1


EVALUASI
-lain kali kalo stok dikit harus lgsg beli
-dikasi masukan sama pelanggan katanya sedotannya harusnya ada sendoknya krn susah makan eskrimnya td padahal enak


---------------------
10 MARET


 

REPORT POST SHIFT
10mar 2023
Jam Buka : 10.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 2
arensisu 1
milosisu 1
redsisu 1


Total :5
Total Omset :66000


LAPORAN PENGELUARAN
skm 45000


LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS



EVALUASI
-lain kali kalo stok dikit harus lgsg beli
-konsep free wifi coba colab dgn roti bakar, banyak yg mau nobar ML


--------------------------------
15 maret



REPORT POST SHIFT
15mar 2023
Jam Buka : 16.00
Jam Tutup : 22.00

LAPORAN SALES HARIAN!

1. Offline Sales
 arensisu 1
 


Total :1
Total Omset :13000


LAPORAN PENGELUARAN
 


LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
ketan


EVALUASI
-tolong secepatnya acc ketan duren
-harus ada meja cafe



---------------------------
15 MARET


 

REPORT POST SHIFT
15mar 2023
Jam Buka : 11.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 4
oreosisu 2
arensisu 1
dancowsisu 1
milosisu 1


Total :9
Total Omset :115.000

LAPORAN PENGELUARAN


LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
kertas print
durian


EVALUASI
-sabtu harus cobain ketan duren

----------------------
16 mar



REPORT POST SHIFT
16mar 2023
Jam Buka : 11.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 4 
Total :4
Total Omset 40000

LAPORAN PENGELUARAN


LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
durian


EVALUASI
-fix kan harus ketan atau cendol durian


--------------------------
18 mar


REPORT POST SHIFT
15mar 2023
Jam Buka : 11.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 10
cheesisu 2
extra duren 1
extra dancow 1

Total :9
Total Omset :137.000

LAPORAN PENGELUARAN
skm 44700

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
skm


EVALUASI
-coba bikin robot untuk pemesanan durensisu
-harus ada led banner di jalan biar orang ngeliat krn ditutup oleh gerobak roti

-----------------------
19 mar


REPORT POST SHIFT
19mar 2023
Jam Buka : 16.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 5
milosisu 2
oreosisu 1
cheesisu 1
redsisu 1
extra duren 1
extra dancow 1

Total :10
Total Omset :136.000

LAPORAN PENGELUARAN


LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
skm
galon (habis)
token
tisu(habis)

EVALUASI 
-besok pasang neon box buatan onok
-fixkan ketan durian dan cara simpan
-besok beli galon krn habis



----------------------
21 mar


REPORT POST SHIFT
19mar 2023
Jam Buka : 16.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
orisisu 8
milosisu 1
cheesisu 1
extra duren 1


Total :10
Total Omset :114.000

LAPORAN PENGELUARAN
skm 15000

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
skm
token

EVALUASI 
-banner jalan yg durian cukup efektif
-bikin lampu banner jalan


------------------------


25 maret

=================================================
| PAKET TAKJIL DURENSISU |

    Paket Takjil Es Durian
        Harga: Rp 10.000/cup
        Isi: es durian, susu kental manis, sweet cream

    Paket Takjil Ketan Durian
        Harga: Rp 20.000/porsi
        Isi: ketan durian, keju, susu kental manis

    Paket Takjil Es Durian + Ketan Durian
        Harga: Rp 30.000
        Isi: kombinasi dari paket takjil es durian dan paket takjil ketan durian

=================================================
| LOKASI DAN KONTAK KAMI |

Lokasi: DurenSisu, Jl. Raya Industri No.RT.002, Pasirgombong, Kec. Cikarang Utara, Kabupaten Bekasi, Jawa Barat 17530 (sebelah es teh indonesia)
Kontak: 085771035182 (WhatsApp)
TikTok: @durensisu


Nikmati sensasi manis dan legit dari Durian dan Ketan Durian di Durensisu! Segera dapatkan Paket Takjil Es Durian dan Ketan Durian kami yang menyegarkan untuk menemani berbuka puasa kamu. Dengan cita rasa yang autentik dan berkualitas, takjil kami akan memenuhi kebutuhanmu akan hidangan penutup yang lezat. Dapatkan segera di Durensisu dan nikmati kelezatannya!

Terima kasih telah memilih DurenSisu sebagai tempat pembelian takjil Anda!






//////////////perintah kali linux dasar///////////


Berikut adalah beberapa perintah dasar Linux yang sering digunakan:

    ls: Menampilkan daftar file dan direktori di dalam direktori saat ini.
    cd: Mengubah direktori kerja saat ini.
    pwd: Menampilkan direktori kerja saat ini.
    mkdir: Membuat direktori baru.
    rm: Menghapus file atau direktori.
    cp: Menyalin file atau direktori.
    mv: Memindahkan atau mengganti nama file atau direktori.
    cat: Menampilkan isi file ke layar.
    grep: Mencari teks tertentu dalam file atau output.
    tar: Membuat atau mengekstrak arsip tar.
    chmod: Mengubah izin akses file atau direktori.
    sudo: Menjalankan perintah dengan hak akses superuser.
    ps: Menampilkan daftar proses yang sedang berjalan.
    kill: Menghentikan proses yang sedang berjalan.
    ifconfig: Menampilkan informasi konfigurasi jaringan.

Ini hanyalah beberapa perintah dasar Linux. Ada banyak lagi perintah yang dapat Anda gunakan tergantung pada apa yang ingin Anda lakukan di Linux.
sarwono satrio
lanjut

Berikut ini adalah beberapa perintah Linux dasar tambahan:

    ping: Mengirim paket ke host tertentu untuk menguji konektivitas jaringan.
    ssh: Menghubungkan ke server jarak jauh menggunakan protokol Secure Shell (SSH).
    scp: Menyalin file ke atau dari server jarak jauh melalui SSH.
    wget: Mengunduh file dari internet.
    curl: Mengirim permintaan HTTP dan menampilkan respons dari server.
    df: Menampilkan informasi ruang disk yang tersedia.
    du: Menampilkan ukuran file dan direktori.
    top: Menampilkan daftar proses yang sedang berjalan dan penggunaan sumber daya sistem.
    free: Menampilkan penggunaan memori dan swap.
    history: Menampilkan daftar perintah yang telah dijalankan.
    man: Menampilkan manual penggunaan untuk suatu perintah.
    uname: Menampilkan informasi tentang sistem operasi.
    whoami: Menampilkan nama pengguna saat ini.

Ada banyak perintah Linux lainnya yang dapat Anda pelajari, tergantung pada kebutuhan Anda. Penting untuk diingat bahwa banyak perintah memiliki opsi dan argumen yang berbeda, sehingga Anda harus membaca manual atau menguji perintah tersebut terlebih dahulu sebelum menggunakannya.


////////////////////////////////////////////////////

------------------

27 maret

21 mar


REPORT POST SHIFT
27mar 2023
Jam Buka : 16.00
Jam Tutup : 23.00

LAPORAN SALES HARIAN!

1. Offline Sales
arensisu 1
milosisu 1
oreosisu 1


Total :3
Total Omset :44.000

LAPORAN PENGELUARAN
garam 11500

LAPORAN STOK BAHAN BAKU/PERLENGKAPAN HAMPIR HABIS
token

EVALUASI 
-kupon itu harus hubungi tim BD katanya kasi id store 
-ga bisa jual ketan kalo hujan krn gada tenda





------------------------------------
28 maret

[Header dengan logo dan nama perusahaan]
[Alamat dan kontak perusahaan]

Jasa Pembuatan Website

Apakah Anda membutuhkan website untuk bisnis Anda? Kami siap membantu Anda. Kami menyediakan jasa pembuatan website profesional dan terjangkau untuk semua jenis bisnis dan organisasi.

Keuntungan menggunakan layanan kami:

    Desain website yang kreatif dan menarik
    Responsif dan mudah digunakan pada perangkat mobile
    Fitur-fitur modern dan canggih, seperti formulir kontak, live chat, dan galeri gambar
    Optimasi SEO untuk membantu website Anda lebih mudah ditemukan di mesin pencari
    Layanan hosting dan maintenance

Kami melayani pembuatan website untuk:

    Toko Online
    Website Bisnis
    Blog pribadi atau organisasi
    Website Edukasi
    dan lain-lain

Kami berkomitmen memberikan hasil terbaik dengan harga yang terjangkau. Hubungi kami untuk mendapatkan penawaran harga dan konsultasi gratis mengenai kebutuhan website Anda.

[Footer dengan logo dan kontak perusahaan]

<<<<<<< HEAD
Terima kasih telah memilih jasa pembuatan website kami. Kami berharap dapat bekerja sama dengan Anda dalam waktu dekat.
=======
Terima kasih telah memilih jasa pembuatan website kami. Kami berharap dapat bekerja sama dengan Anda dalam waktu dekat.
>>>>>>> 48f8928 (29 maret)






emuskik2@gmail.com

token github gilagila github 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 no expired ya
=======

ok

------------------------------
2 april


Ada beberapa kemungkinan mengapa adapter Bluetooth di Kali Linux tidak berfungsi:

    Driver tidak terinstal: Pastikan driver adapter Bluetooth diinstal dan terdeteksi oleh sistem operasi Kali Linux. Anda dapat menggunakan perintah "lsusb" untuk memeriksa apakah adapter Bluetooth terdeteksi.

    Service Bluetooth tidak berjalan: Pastikan layanan Bluetooth diaktifkan dan berjalan dengan benar. Anda dapat memeriksa dengan perintah "systemctl status bluetooth".

    Konflik dengan perangkat lain: Ada kemungkinan adapter Bluetooth mengalami konflik dengan perangkat lain yang terhubung ke sistem. Pastikan tidak ada perangkat lain yang mengganggu koneksi Bluetooth.

    Masalah perangkat keras: Jika adapter Bluetooth tidak berfungsi bahkan setelah memeriksa hal-hal di atas, maka masalahnya mungkin ada pada perangkat keras. Ada kemungkinan adapter Bluetooth rusak atau tidak cocok dengan sistem Anda.

Untuk mengatasi masalah ini, coba periksa terlebih dahulu kemungkinan penyebabnya dan lakukan pemecahan masalah yang sesuai. Jika tidak berhasil, Anda dapat mencoba menggunakan adapter Bluetooth yang berbeda atau menghubungi produsen adapter untuk mendapatkan bantuan lebih lanjut.



sweet cream
keju
token
aqua

---------------------------------
4 april

expired domain emuskik@gmail.com pass sama dgn digimarketing



----------------------------
5 april

plastik penutup cup dah mau habis

tasklist di kali : top, ps -f

netstat -ant


===========nmap dan apache2==================
nmap kali linux cara gunakannya gimana

Nmap adalah salah satu tools yang biasanya digunakan oleh para ethical hacker untuk melakukan pemindaian jaringan dan mengidentifikasi host, port, dan layanan yang tersedia di dalam jaringan tersebut. Berikut adalah cara menggunakan Nmap di Kali Linux:

    Buka terminal di Kali Linux.
    Ketikkan perintah nmap diikuti dengan opsi-opsi yang ingin Anda gunakan. Contohnya, untuk melakukan pemindaian cepat terhadap host yang terhubung ke jaringan lokal, ketikkan perintah nmap -F <alamat_IP>.
    Tunggu beberapa saat hingga proses pemindaian selesai. Hasil pemindaian akan ditampilkan di layar terminal.
    Jika ingin menyimpan hasil pemindaian dalam file teks, Anda dapat menambahkan opsi -oN diikuti dengan nama file yang ingin Anda gunakan. Contohnya, nmap -F <alamat_IP> -oN hasil_pemindaian.txt.

Perlu diingat bahwa penggunaan Nmap untuk melakukan pemindaian jaringan yang tidak sah tanpa izin dari pemilik jaringan adalah tindakan yang ilegal dan dapat berdampak buruk bagi Anda secara hukum. Pastikan untuk hanya menggunakan Nmap untuk keperluan yang sah dan dengan izin dari pemilik jaringan.
sarwono satrio
cara lihat alamat ip yang terhubung di kali linux

Untuk melihat alamat IP yang terhubung di Kali Linux, Anda dapat menggunakan perintah netstat. Berikut adalah cara penggunaannya:

    Buka terminal di Kali Linux.
    Ketikkan perintah netstat -a. Perintah ini akan menampilkan semua koneksi jaringan yang sedang terbuka pada sistem, baik itu koneksi yang aktif maupun tidak aktif.
    Jika Anda hanya ingin melihat koneksi yang aktif saja, tambahkan opsi -t (untuk koneksi TCP) atau -u (untuk koneksi UDP). Contohnya, netstat -at akan menampilkan semua koneksi TCP yang aktif pada sistem.
    Anda juga dapat menambahkan opsi -n untuk menampilkan alamat IP dan nomor port dalam format numerik. Contohnya, netstat -ant akan menampilkan semua koneksi TCP yang aktif pada sistem beserta alamat IP dan nomor port dalam format numerik.

Selain menggunakan netstat, Anda juga dapat menggunakan perintah ss untuk melihat koneksi jaringan yang aktif. Perintah ini memiliki format yang mirip dengan netstat, tetapi lebih cepat dan efisien dalam menampilkan hasilnya. Contohnya, ss -ant akan menampilkan semua koneksi TCP yang aktif pada sistem beserta alamat IP dan nomor port dalam format numerik.

Perlu diingat bahwa untuk menggunakan perintah netstat atau ss pada Kali Linux, Anda harus menjalankan terminal sebagai superuser (root) atau menggunakan hak akses sudo.
sarwono satrio
cara tasklist di kali linux

Perintah untuk menampilkan daftar proses (task list) di Kali Linux adalah ps. Berikut adalah cara penggunaannya:

    Buka terminal di Kali Linux.
    Ketikkan perintah ps. Perintah ini akan menampilkan daftar proses yang sedang berjalan pada sistem secara default.
    Jika Anda ingin menampilkan informasi lebih detail tentang setiap proses, tambahkan opsi -f. Contohnya, ps -f akan menampilkan daftar proses beserta informasi seperti username, nomor PID (Process ID), nomor PPID (Parent Process ID), waktu mulai, dan sebagainya.
    Jika Anda ingin menampilkan daftar proses secara real-time, gunakan perintah top. Perintah ini akan menampilkan daftar proses secara dinamis, diurutkan berdasarkan penggunaan CPU. Untuk keluar dari perintah top, tekan tombol q.

Selain ps dan top, Anda juga dapat menggunakan perintah htop untuk menampilkan task list di Kali Linux. Perintah ini memiliki tampilan yang lebih interaktif dan mudah dipahami. Untuk menggunakan perintah htop, pastikan Anda sudah menginstalnya terlebih dahulu melalui paket manajer seperti apt-get.

Perlu diingat bahwa untuk menggunakan perintah ps, top, atau htop pada Kali Linux, Anda harus menjalankan terminal sebagai superuser (root) atau menggunakan hak akses sudo.
sarwono satrio
cara menggunakan nmap

Nmap (Network Mapper) adalah sebuah tool open-source yang digunakan untuk melakukan pemindaian jaringan dan mengidentifikasi host, port, dan layanan yang tersedia di dalam jaringan tersebut. Berikut adalah langkah-langkah untuk menggunakan Nmap:

    Buka terminal di Linux atau Command Prompt di Windows.

    Ketikkan perintah nmap diikuti dengan alamat IP atau nama host yang ingin Anda pindai. Contohnya, nmap 192.168.0.1 atau nmap www.example.com.

    Tunggu beberapa saat hingga proses pemindaian selesai. Nmap akan menampilkan hasil pemindaian pada layar terminal.

    Anda dapat menambahkan opsi-opsi lain pada perintah nmap untuk mengkustomisasi pemindaian sesuai kebutuhan. Beberapa opsi yang sering digunakan antara lain:
        -p : Untuk memindai port tertentu. Contohnya, nmap -p 80 192.168.0.1 akan memindai port 80 pada alamat IP tersebut.
        -sS : Untuk melakukan pemindaian SYN. Opsi ini akan menentukan apakah port terbuka atau tidak dengan mengirimkan SYN packet. Contohnya, nmap -sS 192.168.0.1 akan melakukan pemindaian SYN pada alamat IP tersebut.
        -sU : Untuk melakukan pemindaian UDP. Opsi ini akan menentukan apakah port UDP terbuka atau tidak dengan mengirimkan packet ke port tersebut. Contohnya, nmap -sU 192.168.0.1 akan melakukan pemindaian UDP pada alamat IP tersebut.

Perlu diingat bahwa penggunaan Nmap untuk melakukan pemindaian jaringan yang tidak sah tanpa izin dari pemilik jaringan adalah tindakan yang ilegal dan dapat berdampak buruk bagi Anda secara hukum. Pastikan untuk hanya menggunakan Nmap untuk keperluan yang sah dan dengan izin dari pemilik jaringan.
sarwono satrio
kenapa bisa ada nyamuk berkaki panjang lebih dari normal

Nyamuk yang berkaki panjang lebih dari normal mungkin adalah jenis nyamuk yang disebut dengan nama Crane Fly atau Daddy Longlegs. Crane Fly adalah jenis serangga yang memiliki tubuh mirip dengan nyamuk, namun memiliki kaki panjang dan ramping yang terlihat seperti kaki lidi.

Penyebab kaki panjang pada serangga seperti Crane Fly mungkin adalah adaptasi evolusi yang berkaitan dengan fungsi kaki mereka. Kaki yang panjang dapat membantu mereka untuk menjelajahi area-area yang lebih luas dan menjangkau sumber makanan yang tersembunyi. Selain itu, kaki yang panjang juga dapat membantu mereka dalam beradaptasi dengan lingkungan hidup yang berbeda, seperti lingkungan yang lebih lembap atau dengan tanaman yang tinggi.

Namun, ada juga kemungkinan bahwa kaki panjang pada serangga tersebut tidak memiliki fungsi yang jelas atau terkait dengan adaptasi lingkungan. Beberapa penelitian menunjukkan bahwa panjang kaki serangga seperti Daddy Longlegs mungkin dipengaruhi oleh faktor genetik atau kondisi lingkungan tertentu yang memengaruhi pertumbuhan mereka.

Secara umum, panjang atau pendeknya kaki serangga dapat bervariasi antara individu yang sama maupun antara spesies yang berbeda, tergantung pada berbagai faktor seperti genetik, lingkungan, dan adaptasi evolusi.
sarwono satrio
apa makanannya

Makanan nyamuk bervariasi tergantung pada jenis dan tahap perkembangan mereka. Namun, secara umum, nyamuk dewasa betina mengambil nektar dan cairan manis dari tanaman sebagai sumber energi. Mereka menggunakan cairan manis ini sebagai sumber karbohidrat untuk memenuhi kebutuhan energi mereka, sementara protein dan nutrisi lainnya diperoleh dari darah yang diambil dari mamalia, termasuk manusia.

Sementara itu, larva nyamuk hidup di air dan memakan berbagai bahan organik, seperti mikroorganisme dan sisa-sisa organik lainnya yang ditemukan di dalam air. Beberapa jenis larva nyamuk, seperti larva Aedes aegypti yang menyebarkan virus Zika dan dengue, memakan alga dan bakteri di permukaan air. Beberapa jenis larva nyamuk juga memakan hewan kecil seperti kutu air atau serangga lainnya yang ditemukan di dalam air.

Penting untuk diingat bahwa nyamuk betina yang mengisap darah dari manusia melakukannya untuk memperoleh nutrisi tambahan yang diperlukan untuk memproduksi telur, bukan untuk memenuhi kebutuhan nutrisi sehari-hari mereka. Oleh karena itu, nyamuk betina dapat bertahan hidup tanpa mengisap darah manusia, namun keberadaan manusia dan hewan peliharaan yang tinggal di sekitar mereka dapat meningkatkan jumlah populasi nyamuk.
sarwono satrio
nyamuk crane maksudnya

Maaf, saya salah mengerti sebelumnya. Nyamuk Crane atau dalam bahasa Inggris disebut dengan Crane Fly adalah serangga yang berkaki panjang dan ramping seperti kaki lidi, bukan jenis nyamuk. Serangga ini dikenal juga dengan nama Daddy Longlegs atau Mosquito Hawk.

Crane Fly biasanya hidup di daerah-daerah yang lembap seperti hutan, taman, dan lingkungan yang berdekatan dengan air. Makanan mereka sebagian besar berupa nektar dan cairan manis dari tanaman. Larva Crane Fly biasanya hidup di lingkungan yang lembap seperti di bawah permukaan tanah atau di air, dan memakan akar atau tumbuhan lainnya.

Meskipun sering dianggap sebagai nyamuk besar atau penghisap darah, Crane Fly sebenarnya tidak menghisap darah manusia dan tidak mengancam kesehatan manusia seperti nyamuk yang dapat menularkan penyakit.
sarwono satrio
apa makanan crane

Crane Fly atau Daddy Longlegs adalah serangga yang makanannya terutama berasal dari nektar dan cairan manis yang diambil dari tanaman. Seperti yang saya sebutkan sebelumnya, Crane Fly bukanlah jenis serangga yang menghisap darah manusia atau hewan lainnya, sehingga mereka tidak terlibat dalam penyebaran penyakit.

Selain nektar dan cairan manis dari tanaman, larva Crane Fly yang hidup di bawah permukaan tanah atau di dalam air biasanya memakan akar atau tumbuhan lainnya. Namun, makanan yang diperlukan oleh
sarwono satrio
cara install vmware

Berikut ini adalah langkah-langkah untuk menginstal VMware di sistem operasi Windows:

    Pertama, unduh installer VMware dari situs resmi VMware.

    Setelah unduhan selesai, klik dua kali file instalasi VMware yang telah diunduh. Ini akan membuka wizard instalasi.

    Pilih bahasa yang ingin Anda gunakan dan klik "OK".

    Baca dan terima persyaratan lisensi. Klik "Next".

    Pilih jenis instalasi yang diinginkan. "Typical" adalah pilihan standar yang menginstal program di lokasi default. "Custom" memungkinkan Anda memilih lokasi instalasi dan fitur tambahan yang ingin diinstal.

    Pilih folder instalasi. Pilih folder di mana Anda ingin program diinstal.

    Jika Anda memilih opsi "Custom" pada langkah sebelumnya, pilih fitur tambahan yang ingin diinstal.

    Klik "Install" untuk memulai proses instalasi.

    Tunggu hingga proses instalasi selesai. Ini mungkin memakan waktu beberapa menit tergantung pada kecepatan sistem Anda.

    Setelah selesai, klik "Finish" untuk menyelesaikan instalasi.

Setelah instalasi selesai, VMware siap digunakan dan Anda dapat memulai membuat dan menjalankan mesin virtual di dalamnya. Namun, pastikan bahwa sistem Anda memenuhi persyaratan sistem minimum untuk menjalankan VMware dengan baik.
sarwono satrio
Err:8 https://download.virtualbox.org/virtualbox/debian kali-rolling Release            
  404  Not Found [IP: 23.35.20.88 443]

Pesan error "404 Not Found" menunjukkan bahwa sistem Anda tidak dapat menemukan repositori yang diminta di URL yang telah diakses. Hal ini dapat terjadi karena beberapa alasan, seperti:

    Alamat URL yang diakses salah atau tidak valid.
    Repositori yang diminta tidak lagi tersedia di server.
    Masalah jaringan atau koneksi internet yang buruk.

Untuk memperbaiki masalah ini, Anda dapat mencoba beberapa hal berikut:

    Pastikan bahwa alamat URL yang dimasukkan benar. Periksa kembali apakah ada kesalahan penulisan atau tanda baca yang kurang.

    Coba akses URL yang sama di browser web untuk memastikan bahwa repositori masih tersedia dan dapat diakses.

    Periksa koneksi internet Anda untuk memastikan bahwa tidak ada masalah dengan jaringan Anda. Anda dapat mencoba mengakses situs web atau URL lain untuk memastikan koneksi internet Anda berfungsi dengan baik.

    Jika masalah ini terjadi saat mencoba menginstal VirtualBox di Kali Linux, pastikan bahwa Anda telah menambahkan repositori VirtualBox ke dalam file sources.list. Anda dapat melakukan ini dengan menambahkan baris berikut ke file /etc/apt/sources.list:

    deb [arch=amd64] https://download.virtualbox.org/virtualbox/debian kali-rolling contrib

    Setelah itu, lakukan update repositori dan instal VirtualBox dengan perintah berikut di terminal:

    sudo apt update
    sudo apt install virtualbox

    Jika pesan error masih muncul, coba periksa kembali koneksi internet Anda dan pastikan bahwa repositori VirtualBox masih tersedia dan dapat diakses.

sarwono satrio
cara install local server di android

Untuk menginstal local server di Android, Anda dapat mengikuti langkah-langkah berikut ini:

    Unduh dan instal aplikasi "Termux" dari Google Play Store.

    Setelah aplikasi terinstal, buka aplikasi dan ketik perintah "pkg update && pkg upgrade" untuk memperbarui semua paket.

    Selanjutnya, instal Apache web server dengan menjalankan perintah "pkg install apache".

    Setelah instalasi selesai, jalankan server Apache dengan perintah "apachectl start".

    Sekarang server Apache telah berjalan dan Anda dapat membuka browser di Android Anda dan mengetikkan alamat "http://localhost" atau "http://127.0.0.1" untuk mengakses halaman default Apache.

    Anda dapat memasukkan file HTML atau PHP ke dalam direktori "/data/data/com.termux/files/usr/share/apache2/default-site/htdocs" di Android Anda dan mengaksesnya melalui browser dengan mengetikkan "http://localhost/nama_file.html" atau "http://localhost/nama_file.php".

Dengan mengikuti langkah-langkah ini, Anda telah berhasil menginstal local server di Android Anda dan dapat mulai mengembangkan aplikasi web. Namun, perlu diingat bahwa instalasi local server di Android dapat memakan banyak sumber daya dan dapat mempengaruhi kinerja perangkat Anda.
sarwono satrio
instal web server di kali linux

Anda dapat menginstal web server Apache di Kali Linux dengan mengikuti langkah-langkah berikut:

    Buka terminal di Kali Linux.

    Perbarui daftar paket di sistem Anda dengan perintah berikut:

    sudo apt update

    Instal server Apache dengan perintah berikut:

    sudo apt install apache2

    Setelah selesai menginstal Apache, Anda dapat memeriksa apakah Apache berjalan dengan benar atau tidak dengan membuka browser web dan mengetikkan alamat "http://localhost" atau "http://127.0.0.1" di bilah alamat. Jika Apache telah terpasang dan berjalan dengan benar, halaman "Apache2 Debian Default Page" akan muncul.

    Jika Anda ingin mengonfigurasi atau menyesuaikan server Apache Anda, Anda dapat mengedit berkas konfigurasi di "/etc/apache2/" menggunakan editor teks seperti nano atau vim.

    Anda juga dapat menambahkan konten web Anda ke dalam direktori "/var/www/html/" di sistem Anda. Setelah itu, Anda dapat membuka konten web Anda melalui browser dengan mengetikkan alamat "http://localhost/nama_file.html".

Dengan mengikuti langkah-langkah ini, Anda telah berhasil menginstal web server Apache di Kali Linux dan dapat mulai mengembangkan aplikasi web atau menampilkan konten web Anda di server Apache.
sarwono satrio
sudah install dan ketik localhost di web browser tapi gagal

Jika Anda telah menginstal web server di Kali Linux dan mencoba membuka halaman web lokal di browser, tetapi tidak dapat mengakses halaman web tersebut, kemungkinan ada beberapa hal yang perlu diperiksa:

    Pastikan server Apache berjalan dengan benar. Anda dapat memeriksa status Apache dengan menjalankan perintah berikut di terminal:

    sudo systemctl status apache2

    Jika Apache berjalan dengan benar, statusnya akan ditampilkan sebagai "active (running)".

    Pastikan direktori root Apache diatur dengan benar. Secara default, direktori root Apache di Kali Linux adalah "/var/www/html/". Pastikan file atau folder yang ingin Anda tampilkan melalui web server disimpan di direktori ini.

    Pastikan izin akses pada file atau folder yang ingin Anda tampilkan diatur dengan benar. Anda dapat memeriksa izin akses dengan menjalankan perintah berikut di terminal:

    ls -l /var/www/html

    Pastikan file atau folder memiliki izin akses yang sesuai, seperti izin baca dan eksekusi.

    Pastikan tidak ada firewall atau perangkat lunak keamanan lain yang menghalangi koneksi ke server Apache. Pastikan port 80 (atau port yang digunakan oleh Apache) tidak diblokir oleh firewall.

    Pastikan tidak ada kesalahan sintaks atau kesalahan konfigurasi pada berkas konfigurasi Apache (/etc/apache2/apache2.conf). Anda dapat menguji konfigurasi dengan menjalankan perintah berikut di terminal:

    sudo apache2ctl configtest

    Jika ada kesalahan konfigurasi, perbaiki dan restart server Apache.

    Jika Anda menggunakan browser lain selain Chrome atau Firefox, coba buka halaman web lokal di salah satu dari kedua browser tersebut.

Dengan memeriksa dan memperbaiki beberapa hal di atas, Anda seharusnya dapat membuka halaman web lokal di browser setelah menginstal web server di Kali Linux.
sarwono satrio
sudo systemctl status apache2         
‚óã apache2.service - The Apache HTTP Server
     Loaded: loaded (/lib/systemd/system/apache2.service; disabled; preset: disabled)
     Active: inactive (dead)
       Docs: https://httpd.apache.org/docs/2.4/

Status yang Anda berikan menunjukkan bahwa layanan Apache tidak sedang berjalan saat ini, dan ditandai sebagai "inactive (dead)". Anda perlu memulai layanan Apache terlebih dahulu dengan menjalankan perintah berikut di terminal:

sudo systemctl start apache2

Setelah itu, periksa status Apache lagi dengan menjalankan perintah:

sudo systemctl status apache2

Jika Apache telah berhasil dimulai, statusnya akan ditampilkan sebagai "active (running)". Setelah itu, Anda dapat mencoba membuka halaman web lokal di browser kembali.
ChatGPT Mar 23 Version. Free Research Preview. ChatGPT may produce inaccurate information about people, places, or facts
============================================


------------------------------
6 april

tiket.com email sarwonosatrio9@gmail.com no hp XL pass sama dgn digimarketing (awal huruf besar)

sudo mysql -u root


=================
cara menggunakan maria db use database di kali linux

Untuk menggunakan MariaDB di Kali Linux, ikuti langkah-langkah berikut:

    Pastikan bahwa MariaDB sudah terinstal di Kali Linux Anda. Jika belum, Anda dapat menginstalnya dengan perintah:

    sql

sudo apt-get update
sudo apt-get install mariadb-server

Setelah berhasil menginstal, jalankan perintah:

sudo mysql -u root

Ini akan membuka shell MariaDB dan mengizinkan Anda untuk memasukkan perintah SQL.

Sekarang, pilih database yang ingin Anda gunakan dengan perintah:

USE nama_database;

Ganti "nama_database" dengan nama database yang ingin Anda gunakan.

Anda sekarang siap untuk melakukan perintah SQL pada database yang telah Anda pilih.

Misalnya, Anda dapat membuat tabel baru dengan perintah:

sql

CREATE TABLE nama_tabel (
   kolom_1 jenis_data,
   kolom_2 jenis_data,
   ...
);

Ganti "nama_tabel", "kolom_1", "kolom_2", dan "jenis_data" dengan nama dan tipe data yang sesuai untuk tabel yang ingin Anda buat.

Setelah selesai menggunakan database, Anda dapat keluar dari shell MariaDB dengan perintah:

bash

    exit;

    Ini akan mengakhiri sesi MariaDB dan mengembalikan Anda ke shell Kali Linux.

Sekarang Anda sudah tahu cara menggunakan MariaDB di Kali Linux dan dapat mulai menggunakan database Anda.
==================




11 april

domainesia
xxgzuotrpmkuh@eurokool.com
@Turboturbo123



Server
Equinix SG3 - Singapore
Nameserver
srv1.arenhost.com
srv2.arenhost.com
IP
41.216.185.51






=======================
<?php
// Koneksi ke database
$host = "localhost"; // ganti dengan nama host database Anda
$user = "mediafak_dua"; // ganti dengan nama user database Anda
$password = "@Rootroot123"; // ganti dengan password database Anda
$database = "mediafak_satu"; // ganti dengan nama database Anda

$conn = mysqli_connect($host, $user, $password, $database);
if (!$conn) {
    die("Koneksi gagal: " . mysqli_connect_error());
}

// Ambil data user dengan iduser=10
$iduser = 10;
$sql = "SELECT * FROM user WHERE iduser = $iduser";
$result = mysqli_query($conn, $sql);

if (mysqli_num_rows($result) > 0) {
    // Output data dari setiap baris
    while($row = mysqli_fetch_assoc($result)) {
        echo "ID: " . $row["iduser"]. " - Nama: " . $row["nama"]. " - Email: " . $row["email"]. "<br>";
    }
} else {
    echo "Tidak ada data yang ditemukan";
}

mysqli_close($conn);
?>
===================




<?php
	$single = true;
/**
 * CodeIgniter
 *
 * An open source application development framework for PHP
 *
 * This content is released under the MIT License (MIT)
 *
 * Copyright (c) 2014 - 2015, British Columbia Institute of Technology
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @package	CodeIgniter
 * @author	EllisLab Dev Team
 * @copyright	Copyright (c) 2008 - 2014, EllisLab, Inc. (http://ellislab.com/)
 * @copyright	Copyright (c) 2014 - 2015, British Columbia Institute of Technology (http://bcit.ca/)
 * @license	http://opensource.org/licenses/MIT	MIT License
 * @link	http://codeigniter.com
 * @since	Version 1.0.0
 * @filesource
 */

/*
 *---------------------------------------------------------------
 * APPLICATION ENVIRONMENT
 *---------------------------------------------------------------
 *
 * You can load different configurations depending on your
 * current environment. Setting the environment also influences
 * things like logging and error reporting.
 *
 * This can be set to anything, but default usage is:
 *
 *     development
 *     testing
 *     production
 *
 * NOTE: If you change these, also change the error_reporting() code below
 */
	define('ENVIRONMENT', isset($_SERVER['CI_ENV']) ? $_SERVER['CI_ENV'] : 'development');

/*
 *---------------------------------------------------------------
 * ERROR REPORTING
 *---------------------------------------------------------------
 *
 * Different environments will require different levels of error reporting.
 * By default development will show errors but testing and live will hide them.
 */
switch (ENVIRONMENT)
{
	case 'development':
		error_reporting(-1);
		ini_set('display_errors', 1);
	break;

	case 'testing':
	case 'production':
		ini_set('display_errors', 0);
		if (version_compare(PHP_VERSION, '5.3', '>='))
		{
			error_reporting(E_ALL & ~E_NOTICE & ~E_DEPRECATED & ~E_STRICT & ~E_USER_NOTICE & ~E_USER_DEPRECATED);
		}
		else
		{
			error_reporting(E_ALL & ~E_NOTICE & ~E_STRICT & ~E_USER_NOTICE);
		}
	break;

	default:
		header('HTTP/1.1 503 Service Unavailable.', TRUE, 503);
		echo 'The application environment is not set correctly.';
		exit(1); // EXIT_ERROR
}

/*
 *---------------------------------------------------------------
 * SYSTEM FOLDER NAME
 *---------------------------------------------------------------
 *
 * This variable must contain the name of your "system" folder.
 * Include the path if the folder is not in the same directory
 * as this file.
 */
	$system_path = dirname(dirname(dirname(dirname(__FILE__)))).'/system';
	if ($single) {
		$system_path = 'system';
	}

/*
 *---------------------------------------------------------------
 * APPLICATION FOLDER NAME
 *---------------------------------------------------------------
 *
 * If you want this front controller to use a different "application"
 * folder than the default one you can set its name here. The folder
 * can also be renamed or relocated anywhere on your server. If
 * you do, use a full server path. For more info please see the user guide:
 * http://codeigniter.com/user_guide/general/managing_apps.html
 *
 * NO TRAILING SLASH!
 */

	include("data.php");
	$app_app = $app_data["app"];
	$app_code = $app_data["code"];
	$application_folder = dirname(dirname(dirname(dirname(__FILE__)))).'/application/'.$app_app.'/'.$app_code;
	if ($single) {
		$application_folder = 'application/'.$app_app.'/'.$app_code;
	}

	define('AZAPP', 'application/'.$app_app.'/'.$app_code.'/');

/*
 *---------------------------------------------------------------
 * VIEW FOLDER NAME
 *---------------------------------------------------------------
 *
 * If you want to move the view folder out of the application
 * folder set the path to the folder here. The folder can be renamed
 * and relocated anywhere on your server. If blank, it will default
 * to the standard location inside your application folder. If you
 * do move this, use the full server path to this folder.
 *
 * NO TRAILING SLASH!
 */
	$view_folder = '';


/*
 * --------------------------------------------------------------------
 * DEFAULT CONTROLLER
 * --------------------------------------------------------------------
 *
 * Normally you will set your default controller in the routes.php file.
 * You can, however, force a custom routing by hard-coding a
 * specific controller class/function here. For most applications, you
 * WILL NOT set your routing here, but it's an option for those
 * special instances where you might want to override the standard
 * routing in a specific front controller that shares a common CI installation.
 *
 * IMPORTANT: If you set the routing here, NO OTHER controller will be
 * callable. In essence, this preference limits your application to ONE
 * specific controller. Leave the function name blank if you need
 * to call functions dynamically via the URI.
 *
 * Un-comment the $routing array below to use this feature
 */
	// The directory name, relative to the "controllers" folder.  Leave blank
	// if your controller is not in a sub-folder within the "controllers" folder
	// $routing['directory'] = '';

	// The controller class file name.  Example:  mycontroller
	// $routing['controller'] = '';

	// The controller function you wish to be called.
	// $routing['function']	= '';


/*
 * -------------------------------------------------------------------
 *  CUSTOM CONFIG VALUES
 * -------------------------------------------------------------------
 *
 * The $assign_to_config array below will be passed dynamically to the
 * config class when initialized. This allows you to set custom config
 * items or override any default config values found in the config.php file.
 * This can be handy as it permits you to share one application between
 * multiple front controller files, with each file containing different
 * config values.
 *
 * Un-comment the $assign_to_config array below to use this feature
 */
	// $assign_to_config['name_of_config_item'] = 'value of config item';



// --------------------------------------------------------------------
// END OF USER CONFIGURABLE SETTINGS.  DO NOT EDIT BELOW THIS LINE
// --------------------------------------------------------------------

/*
 * ---------------------------------------------------------------
 *  Resolve the system path for increased reliability
 * ---------------------------------------------------------------
 */
	// Set the current directory correctly for CLI requests
	if (defined('STDIN'))
	{
		chdir(dirname(__FILE__));
	}

	if (($_temp = realpath($system_path)) !== FALSE)
	{
		$system_path = $_temp.'/';
	}
	else
	{
		// Ensure there's a trailing slash
		$system_path = rtrim($system_path, '/').'/';
	}


	// Is the system path correct?
	if ( ! is_dir($system_path))
	{
		header('HTTP/1.1 503 Service Unavailable.', TRUE, 503);
		echo 'Your system folder path does not appear to be set correctly. Please open the following file and correct this: '.pathinfo(__FILE__, PATHINFO_BASENAME);
		exit(3); // EXIT_CONFIG
	}
/*
 * -------------------------------------------------------------------
 *  Now that we know the path, set the main path constants
 * -------------------------------------------------------------------
 */
	// The name of THIS file
	define('SELF', pathinfo(__FILE__, PATHINFO_BASENAME));

	if ($single) {
		define('DEFPATH', dirname(__FILE__).'/application/'.$app_app.'/default/');
		define('DEFVIEWPATH', dirname(__FILE__).'/application/'.$app_app.'/default/views/');
	}
	else {
		define('DEFPATH', dirname(dirname(dirname(dirname(__FILE__)))).'/application/'.$app_app.'/default/');
		define('DEFVIEWPATH', dirname(dirname(dirname(dirname(__FILE__)))).'/application/'.$app_app.'/default/views/');
	}

	// Path to the system folder
	define('BASEPATH', str_replace('\\', '/', $system_path));

	define('AZPATH', dirname(str_replace('\\', '/', $system_path)));

	// Path to the system folder
	define('SYSVIEWPATH', str_replace('\\', '/', $system_path).'views/');

	// Path to the front controller (this file)
	define('FCPATH', dirname(__FILE__).'/');
	
	// Name of the "system folder"
	define('SYSDIR', trim(strrchr(trim(BASEPATH, '/'), '/'), '/'));

	// The path to the "application" folder
	if (is_dir($application_folder))
	{
		if (($_temp = realpath($application_folder)) !== FALSE)
		{
			$application_folder = $_temp;
		}

		define('APPPATH', $application_folder.DIRECTORY_SEPARATOR);
	}
	else
	{
		if ( ! is_dir(BASEPATH.$application_folder.DIRECTORY_SEPARATOR))
		{
			header('HTTP/1.1 503 Service Unavailable.', TRUE, 503);
			echo 'Your application folder path does not appear to be set correctly. Please open the following file and correct this: '.SELF;
			exit(3); // EXIT_CONFIG
		}

		define('APPPATH', BASEPATH.$application_folder.DIRECTORY_SEPARATOR);
	}

	// The path to the "views" folder
	if ( ! is_dir($view_folder))
	{
		if ( ! empty($view_folder) && is_dir(APPPATH.$view_folder.DIRECTORY_SEPARATOR))
		{
			$view_folder = APPPATH.$view_folder;
		}
		elseif ( ! is_dir(APPPATH.'views'.DIRECTORY_SEPARATOR))
		{
			header('HTTP/1.1 503 Service Unavailable.', TRUE, 503);
			echo 'Your view folder path does not appear to be set correctly. Please open the following file and correct this: '.SELF;
			exit(3); // EXIT_CONFIG
		}
		else
		{
			$view_folder = APPPATH.'views';
		}
	}

	if (($_temp = realpath($view_folder)) !== FALSE)
	{
		$view_folder = $_temp.DIRECTORY_SEPARATOR;
	}
	else
	{
		$view_folder = rtrim($view_folder, '/\\').DIRECTORY_SEPARATOR;
	}

	define('VIEWPATH', $view_folder);

/*
 * --------------------------------------------------------------------
 * LOAD THE BOOTSTRAP FILE
 * --------------------------------------------------------------------
 *
 * And away we go...
 */
require_once BASEPATH.'core/CodeIgniter.php';
================

<?php
defined('BASEPATH') OR exit('No direct script access allowed');

$active_group = 'default';
$query_builder = TRUE;

$db['default'] = array(
	'dsn'	=> '',
	'hostname' => 'localhost',
	'username' => 'mediafak_dua',
	'password' => '@Rootroot123',
	'database' => 'mediafak_satu',
	'dbdriver' => 'mysqli',
	'dbprefix' => '',
	'pconnect' => FALSE,
	'db_debug' => (ENVIRONMENT !== 'production'),
	// 'db_debug' => FALSE,
	'cache_on' => FALSE,
	'cachedir' => '',
	'char_set' => 'utf8',
	'dbcollat' => 'utf8_general_ci',
	'swap_pre' => '',
	'encrypt' => FALSE,
	'compress' => FALSE,
	'stricton' => FALSE,
	'failover' => array(),
	'save_queries' => TRUE
);



----------------------------------------
12 april


memanggil maria db mysql di kali linux

sudo mysql -u root -p

lalu panggil database: SHOW databases;
lalu pilih database: USE nama_database;


CREATE TABLE nama_tabel (
   kolom1 TIPEDATA,
   kolom2 TIPEDATA,
   kolom3 TIPEDATA,
   ...
);



INSERT INTO nama_tabel (kolom1, kolom2, kolom3, ...) VALUES (nilai1, nilai2, nilai3, ...);




SELECT * FROM nama_tabel;



IMPORT DATA SQL:
source /home/mixue/Downloads/laundrymulti.sql



/////////////////////////////////////
Pada tampilan MariaDB yang Anda tunjukkan, Anda sudah masuk ke prompt MariaDB. Berikut adalah beberapa perintah dasar yang dapat Anda gunakan untuk berinteraksi dengan database:

1. Memilih database: Anda dapat memilih database yang ingin Anda gunakan dengan perintah `USE <nama_database>`. Misalnya, jika Anda ingin memilih database "laundrymulti", Anda dapat mengetikkan `USE laundrymulti;`.

2. Menampilkan database: Untuk melihat daftar database yang tersedia, Anda dapat menggunakan perintah `SHOW DATABASES;`. Ini akan menampilkan daftar nama database yang ada.

3. Membuat database: Jika Anda ingin membuat database baru, Anda dapat menggunakan perintah `CREATE DATABASE <nama_database>;`. Misalnya, jika Anda ingin membuat database baru dengan nama "mydatabase", Anda dapat mengetikkan `CREATE DATABASE mydatabase;`.

4. Menghapus database: Jika Anda ingin menghapus database yang tidak diperlukan, Anda dapat menggunakan perintah `DROP DATABASE <nama_database>;`. Pastikan untuk berhati-hati saat menggunakan perintah ini, karena akan menghapus seluruh data di dalam database tersebut. Misalnya, untuk menghapus database "laundrymulti", Anda dapat mengetikkan `DROP DATABASE laundrymulti;`.

Setelah memilih database yang ingin Anda gunakan, Anda dapat menggunakan perintah-perintah SQL lainnya seperti membuat tabel (`CREATE TABLE`), menyisipkan data (`INSERT INTO`), memperbarui data (`UPDATE`), menghapus data (`DELETE`), dan lain-lain untuk berinteraksi dengan database Anda.

Pastikan Anda memiliki pengetahuan dasar tentang SQL (Structured Query Language) untuk dapat menggunakan database dengan lebih efektif.

cek kali linux versi version 
lsb_release -a


cara liat table di db botonok
show tables;

cara bikin table
CREATE TABLE botonok (
  id INT PRIMARY KEY AUTO_INCREMENT,
  nama VARCHAR(50),
  usia INT,
  alamat VARCHAR(100)
);

Untuk melihat daftar kolom dalam tabel "botonok", Anda dapat menggunakan perintah `DESCRIBE` atau `SHOW COLUMNS FROM`. Berikut adalah contoh penggunaannya:

```sql
DESCRIBE botonok;
```

atau

```sql
SHOW COLUMNS FROM botonok;
```

Perintah ini akan menampilkan informasi tentang kolom-kolom yang ada dalam tabel "botonok", seperti nama kolom, tipe data, panjang, dan atribut lainnya.

Jika Anda mendapatkan pesan "Empty set" saat menjalankan perintah di atas, itu berarti tabel "botonok" tidak memiliki data atau tabel tersebut belum dibuat. Pastikan tabel "botonok" sudah dibuat dan memiliki data sebelum menjalankan perintah untuk melihat isi kolomnya.




Untuk melihat isi tabel atau data di dalam database "botonok", Anda perlu menggunakan perintah SQL SELECT. Berikut adalah langkah-langkahnya:

1. Masuk ke prompt MariaDB dengan perintah `mysql -u username -p`. Gantilah "username" dengan nama pengguna yang memiliki akses ke database "botonok" dan Anda akan diminta memasukkan kata sandi.

2. Setelah berhasil masuk, pilih database "botonok" dengan perintah `USE botonok;`.

3. Gunakan perintah SELECT untuk melihat isi tabel atau data dalam database. Misalnya, jika Anda ingin melihat semua data dalam tabel "nama_tabel", Anda dapat menggunakan perintah `SELECT * FROM nama_tabel;`. Jika Anda ingin melihat hanya beberapa kolom tertentu, gantilah tanda asterisk (*) dengan nama kolom yang diinginkan, misalnya `SELECT kolom1, kolom2 FROM nama_tabel;`.

4. Setelah mengetikkan perintah SELECT, tekan Enter untuk melihat hasilnya. Data dalam tabel akan ditampilkan dalam bentuk tabel dengan kolom dan baris yang sesuai.

Pastikan Anda telah memilih database yang tepat dan mengetahui nama tabel yang ingin Anda lihat isinya.
////////////////////////////////////
mematikan firewall di cmd
netsh advfirewall set allprofiles state off





bisa pake sudo service?

Ya, Anda juga dapat menggunakan perintah "sudo service" untuk mengelola server MariaDB di Kali Linux. Berikut adalah contoh perintah untuk mengelola server MariaDB dengan menggunakan perintah "sudo service":

    Untuk memeriksa status server:

    lua

sudo service mysql status

Untuk memulai server:

sql

sudo service mysql start

Untuk menghentikan server:

arduino

sudo service mysql stop

Untuk merestart server:

sudo service mysql restart

Untuk menjalankan perintah dalam shell MySQL:

    sudo service mysql shell

Namun, perintah "sudo systemctl" juga dapat digunakan untuk mengelola server di Kali Linux dan umumnya lebih disarankan karena lebih modern dan lebih kompatibel dengan sistem operasi Linux yang lebih baru.

====================
Pesan kesalahan tersebut menunjukkan bahwa fungsi open() telah dideklarasikan kembali pada baris 138 di file Session_files_driver.php. Anda harus memeriksa apakah fungsi tersebut sudah ada di dalam file tersebut atau di file lain yang di-include atau di-require. Jika iya, maka Anda harus menghapus salah satu deklarasi fungsi tersebut agar tidak terjadi duplikasi.

Namun, jika Anda memang perlu menambahkan fungsi open() pada file Session_files_driver.php, pastikan bahwa Anda memberikan nama fungsi dan tipe kembalian yang benar dan sesuai dengan SessionHandlerInterface. Jangan lupa juga untuk mengubah tipe kembalian fungsi close() jika Anda menambahkan atribut #[\ReturnTypeWillChange] pada fungsi open().
==================


------------------------------------
13 april


Berikut adalah kerangka singkat untuk poin-poin jalur belajar cyber security dari awal:

    Dasar-dasar teknologi informasi dan jaringan

    Hardware
    Software
    Protokol jaringan
    Sistem operasi

    Dasar-dasar keamanan jaringan

    Keamanan fisik
    Keamanan sistem
    Keamanan data
    Keamanan akses

    Keamanan web

    Serangan web
    Keamanan aplikasi web
    Keamanan basis data

    Kriptografi

    Enkripsi
    Dekripsi
    Teknik-teknik kriptografi

    Keamanan sistem operasi

    Keamanan file sistem
    Pengelolaan hak akses
    Perlindungan terhadap malware

    Keamanan jaringan dan akses

    Teknologi firewall
    IDS/IPS
    VPN
    Two-factor authentication

    Audit keamanan

    Metode audit keamanan
    Pengujian penetrasi
    Analisis rentang kerentanan
    Pelaporan keamanan

    Keamanan cloud

    Proteksi data
    Pengelolaan akses

    Praktek

    Keamanan sistem
    Pengujian penetrasi
    Metode audit keamanan

    Sertifikasi

    CompTIA Security+
    Certified Ethical Hacker (CEH)
    Certified Information Systems Security Professional (CISSP)

    Tetap memperbarui pengetahuan

    Membaca sumber-sumber terpercaya
    Mengikuti seminar atau konferensi terbaru



==================
<?php
defined('BASEPATH') OR exit('No direct script access allowed');

$active_group = 'default';
$query_builder = TRUE;

$db['default'] = array(
	'dsn'	=> '',
	'hostname' => 'localhost',
	'username' => 'happylau_dua',
	'password' => '@Rootroot123',
	'database' => 'happylau_satu',
	'dbdriver' => 'mysqli',
	'dbprefix' => '',
	'pconnect' => FALSE,
	'db_debug' => (ENVIRONMENT !== 'production'),
	// 'db_debug' => FALSE,
	'cache_on' => FALSE,
	'cachedir' => '',
	'char_set' => 'utf8',
	'dbcollat' => 'utf8_general_ci',
	'swap_pre' => '',
	'encrypt' => FALSE,
	'compress' => FALSE,
	'stricton' => FALSE,
	'failover' => array(),
	'save_queries' => TRUE
);
====================

-----------------------------------

14 april

aplikasi bang iwan evaluasi:
base url diganti dgn domain 
data base diganti dengan 	'hostname' => 'localhost',
	'username' => 'happylau_dua',
	'password' => '@Rootroot123',
	'database' => 'happylau_satu',

masalah ga konek antara domain ke server:
-tidak ada record di zone editor (manage/kelola)
-nameserver belum di arahkan seperti arahan hosting
-htacces masih hidden





_----------------------------------
8 Mei

cara instal Kali Linux di termux

pkg install curl
curl -LO https://raw.githubusercontent.com/Hax4us/Nethunter-In-Termux/master/kalinethunter
chmod +x kalinethunter
./kalinethunter



Assistance Requested.


User
Tes

ChatGPT
Hello! Is there anything specific you would like me to assist you with?




User
Install kali Linux di termux

ChatGPT
Unfortunately, it is not possible to install Kali Linux on Termux as Kali Linux is a full-fledged Linux distribution and requires a lot more resources than what Termux can provide.

However, you can install a minimal version of Kali Linux on Termux called "Kali NetHunter". Here are the steps to do so:

Install Termux from the Google Play Store or from F-Droid.

Open Termux and run the following command to update the package list:

sql
Copy code
pkg update
Install the "proot" package by running the following command:

Copy code
pkg install proot
Now, create a new directory to store the Kali NetHunter file system by running the following command:

arduino
Copy code
mkdir kali
Download the Kali NetHunter rootless installation script by running the following command:

bash
Copy code
curl -LO https://raw.githubusercontent.com/Hax4us/Nethunter-In-Termux/master/kalinethunter
Give execute permission to the installation script by running the following command:

bash
Copy code
chmod +x kalinethunter
Run the installation script by running the following command:

bash
Copy code
./kalinethunter
Follow the on-screen instructions to complete the installation.

Note that the Kali NetHunter installation may take a while to complete, and you will need a stable internet connection for the pr ocess.

Once the installation is complete, you can start Kali NetHunter by running the following command:

bash
Copy code
./startkali.sh
This will start Kali NetHunter in a new terminal window within Termux.

I hope this helps! Let me know if you have any further questions.




ini yg bisa dipake buat install kali

pkg update -y && pkg install wget curl proot tar -y && wget https://raw.githubusercontent.com/AndronixApp/AndronixOrigin/master/Installer/Kali/kali.sh -O kali.sh && chmod +x kali.sh && bash kali.sh



berikut adalah hasil dari elektrolit Bapak di tanggal 2 Mei


Maaf mendengar tentang kondisi Bapak Anda. Berikut adalah interpretasi umum dari hasil tes yang Anda berikan:

Hemoglobin (Hb) 11,8 g/dL: Ini adalah tingkat hemoglobin dalam darah. Meskipun di bawah normal, angka ini tidak terlalu rendah. Namun, jika terus menurun, bisa menunjukkan anemia.

Leukosit 5,11 x10^9/L: Ini adalah jumlah sel darah putih. Angka ini dalam kisaran normal, yang menunjukkan tidak adanya infeksi atau peradangan yang signifikan.

Eritrosit 3,41 x10^12/L: Ini adalah jumlah sel darah merah. Angka ini dalam kisaran normal, meskipun sedikit rendah.

Trombosit 57 x10^9/L: Ini adalah jumlah trombosit dalam darah. Angka ini sangat rendah dan bisa menunjukkan risiko perdarahan yang lebih besar.

Hematokrit (Ht) 31,1%: Ini adalah persentase volume sel darah merah dalam darah. Angka ini sedikit rendah, yang menunjukkan kemungkinan anemia.

Mean Platelet Volume (MPV) 10,2 fL: Ini adalah ukuran rata-rata dari ukuran trombosit dalam darah. Angka ini normal.

Red Cell Distribution Width (RDW) 13,9%: Ini adalah ukuran variasi ukuran sel darah merah. Angka ini normal.

Hemoglobin Distribution Width (HDW) 2,51%: Ini adalah ukuran variasi dalam kandungan hemoglobin dalam sel darah merah. Angka ini normal.

Platelet Distribution Width (PDW) 47,7 fL: Ini adalah ukuran variasi ukuran trombosit dalam darah. Angka ini normal.

Mean Corpuscular Volume (MCV) 91,3 fL: Ini adalah ukuran rata-rata dari ukuran sel darah merah. Angka ini normal.

Mean Corpuscular Hemoglobin (MCH) 34,5 pg: Ini adalah ukuran rata-r


==========.===.===....



interpretasi umum dari hasil tes elektrolit bapak:

Hemoglobin (Hb) 11,8 g/dL: Ini adalah tingkat hemoglobin dalam darah. Meskipun di bawah normal, angka ini tidak terlalu rendah. Namun, jika terus menurun, bisa menunjukkan anemia.

Leukosit 5,11 x10^9/L: Ini adalah jumlah sel darah putih. Angka ini dalam kisaran normal, yang menunjukkan tidak adanya infeksi atau peradangan yang signifikan.

Eritrosit 3,41 x10^12/L: Ini adalah jumlah sel darah merah. Angka ini dalam kisaran normal, meskipun sedikit rendah.

Trombosit 57 x10^9/L: Ini adalah jumlah trombosit dalam darah. Angka ini sangat rendah dan bisa menunjukkan risiko perdarahan yang lebih besar.

Hematokrit (Ht) 31,1%: Ini adalah persentase volume sel darah merah dalam darah. Angka ini sedikit rendah, yang menunjukkan kemungkinan anemia.

Mean Platelet Volume (MPV) 10,2 fL: Ini adalah ukuran rata-rata dari ukuran trombosit dalam darah. Angka ini normal.

Red Cell Distribution Width (RDW) 13,9%: Ini adalah ukuran variasi ukuran sel darah merah. Angka ini normal.

Hemoglobin Distribution Width (HDW) 2,51%: Ini adalah ukuran variasi dalam kandungan hemoglobin dalam sel darah merah. Angka ini normal.

Platelet Distribution Width (PDW) 47,7 fL: Ini adalah ukuran variasi ukuran trombosit dalam darah. Angka ini normal.

Mean Corpuscular Volume (MCV) 91,3 fL: Ini adalah ukuran rata-rata dari ukuran sel darah merah. Angka ini normal.

Mean Corpuscular Hemoglobin (MCH) 34,5 pg: Ini adalah ukuran rata-rata dari kandungan hemoglobin dalam sel darah merah. Angka ini normal.

Mean Corpuscular Hemoglobin Concentration (MCHC) 37,8 g/dL: Ini adalah ukuran rata-rata dari kandungan hemoglobin dalam sel darah merah. Angka ini normal.

Eosinofil 0,7%: Ini adalah jenis sel darah putih yang terlibat dalam respons alergi dan infeksi parasit. Angka ini dalam kisaran normal.

Basofil 0,3%: Ini adalah jenis sel darah putih yang terlibat dalam respons alergi. Angka ini dalam kisaran normal.

Neutrofil 74,0%: Ini adalah jenis sel darah putih yang membantu melawan infeksi bakteri. Angka ini dalam kisaran normal.

Limfosit 10,8%: Ini adalah jenis sel darah putih yang membantu melawan infeksi virus dan bakteri. Angka ini dalam kisaran normal.

Monosit 14,2%: Ini adalah jenis sel darah putih yang terlibat dalam respons imun terhadap infeksi. Angka ini dalam kisaran normal.

Liver function: AST (SGOT) 155 U/L dan ALT (SGPT)

147 U/L: Ini adalah dua enzim hati yang meningkat dalam kondisi kerusakan hati. Angka ini menunjukkan bahwa Bapak Anda mengalami kerusakan hati yang signifikan.

Urea 66 mg/dL: Ini adalah produk limbah dari metabolisme protein yang diekskresikan oleh ginjal. Angka ini dalam kisaran normal.

Kreatinin 1,47 mg/dL: Ini adalah produk limbah dari metabolisme otot yang diekskresikan oleh ginjal. Angka ini sedikit meningkat, yang bisa menunjukkan penurunan fungsi ginjal.

Natrium 108 mmol/L: Ini adalah elektrolit yang memainkan peran penting dalam keseimbangan cairan dalam tubuh. Angka ini rendah dan bisa menunjukkan dehidrasi atau masalah ginjal.

Kalium 6,5 mmol/L: Ini adalah elektrolit yang memainkan peran penting dalam fungsi otot dan jantung. Angka ini sangat tinggi dan bisa menunjukkan kerusakan sel dan masalah ginjal.

Berdasarkan hasil tes ini, tampak bahwa Bapak Anda mengalami kerusakan hati yang signifikan dan kemungkinan masalah ginjal. Penting untuk mendiskusikan hasil tes ini dengan dokter dan mengikuti saran dan pengobatan yang direkomendasikan untuk kondisi kesehatan yang mendasar.



--------------------------
20 mei

jika terjadi eror pada saat commit dan push biasanya itu karena ada perbedaan commmit antara branch di main lokal dengan branch di origin main remote jadi harus di push dulu di terminal supaya bisa nanti di samakan dengan remote nya

Surat Perjanjian Pembagian Saham Salon Gloria Medan

Alamat: Jl. K.H. Wahid Hasyim No.1, Merdeka, Kec. Medan Baru, Kota Medan, Sumatera Utara 20222
Tanggal: 20 Mei 2023

Kami, yang bertanda tangan di bawah ini:

Pihak 1. Ruslan Parhusip Nainggolan, dengan alamat tempat tinggal di Vila Nusa Setiabudi, Jl. Perjuangan Blok B16 Medan, Sumatera Utara, dan

Pihak 2. Sarwono Tamba Satria Sibagariang, dengan alamat tempat tinggal di Vila Nusa Setiabudi, Jl. Perjuangan Blok B16 Medan, Sumatera Utara

selanjutnya disebut sebagai "Para Pihak" secara bersama-sama, dan "Pihak Pertama dan Pihak Kedua" secara sendiri-sendiri.

Mengingat:

1. Para Pihak bersama-sama ingin menjalankan usaha salon kecantikan dengan nama usaha "Salon Gloria".

2. Para Pihak sepakat untuk menjalankan dan mengelola Perusahaan berdasarkan kesepakatan ini.

Maka, dengan ini Para Pihak menyepakati dan menyetujui perjanjian sebagai berikut:

1. Pembagian Saham

   a. Pembagian saham Usaha/Perusahaan akan dibagi sebagai berikut:

      - Ruslan Parhusip Nainggolan: 55% saham
      - Sarwono Tamba Satria Sibagariang: 45% saham

      Jumlah total saham yang dibagi adalah 100%.

   b. Para Pihak setuju bahwa hak suara atas saham akan sesuai dengan kepemilikan saham masing-masing.

2. Pembagian Keuntungan dan Kerugian

   a. Para Pihak setuju bahwa keuntungan dan kerugian Perusahaan akan dibagi secara proporsional berdasarkan kepemilikan saham masing-masing.

   b. Pembagian keuntungan dan kerugian akan dilakukan setiap bulan fiskal Perusahaan atau pada saat Perusahaan melakukan pembagian dividen atau pada saat kedua pihak membuat kesepakatan di luar dari perjanjian ini.

3. Keterlibatan dan Tanggung Jawab

   a. Para Pihak sepakat bahwa setiap Pihak akan terlibat secara aktif dalam pengelolaan dan pengambilan keputusan yang berhubungan dengan Perusahaan.

   b. Setiap Pihak akan bertanggung jawab atas tindakan dan keputusan yang diambil dalam lingkup tugas dan tanggung jawab masing-masing.

   c. Pihak Pertama bertanggung jawab terhadap operasional usaha, dan Pihak Kedua bertanggung jawab terhadap manajemen, keuangan, investasi, dan public relation.

   d. Jika salah satu pihak berhalangan dalam pekerjaan, maka pihak lain dapat saling silang tanggung jawab mengisi tugas pihak berhalangan selama disetujui pihak yang bertanggung jawab, kecuali terdapat ketentuan lain.

4. Penjualan atau Perubahan Pemilikan Saham

   a. Jika salah satu Pihak berniat untuk menjual atau mentransfer sahamnya kepada pihak ketiga, Pihak tersebut harus memberi tahu Pihak lainnya secara tertulis dan memberikan kesempatan kepada Pihak lainnya untuk membeli saham tersebut terlebih dahulu dengan harga yang adil.

   b. Jika Pihak lainnya tidak berminat atau tidak dapat membeli saham yang ditawarkan, Pihak yang berniat menjual saham dapat melanjutkan transaksi dengan pihak ketiga setelah mendapatkan persetujuan.

5. Durasi Perjanjian
   Perjanjian ini akan berlaku sejak tanggal ditandatangani dan akan berakhir jika terjadi salah satu dari para pihak melakukan hal berikut ini:

   i. Para Pihak sepakat untuk mengakhiri Perjanjian ini secara tertulis dengan persetujuan kedua belah pihak.

   ii. Terjadi likuidasi atau pembubaran Perusahaan sesuai dengan hukum yang berlaku.

6. Penyelesaian Sengketa

   a. Jika terjadi perselisihan antara Para Pihak terkait dengan Perjanjian ini, Para Pihak sepakat untuk menyelesaikan sengketa tersebut melalui negosiasi dan mediasi secara baik-baik dan saling menghormati.

   b. Jika negosiasi dan mediasi tidak mencapai kesepakatan, sengketa akan dirujuk ke pengadilan yang berwenang di wilayah hukum tempat Perusahaan beroperasi.

7. Ketentuan Umum

   a. Perjanjian ini menggantikan semua perjanjian sebelumnya, baik lisan maupun tertulis, antara Para Pihak terkait dengan Perusahaan.

   b. Perjanjian ini tidak dapat diubah atau dimodifikasi kecuali dengan persetujuan tertulis dari Para Pihak.

   c. Jika ada ketentuan dalam Perjanjian ini yang ditemukan tidak sah atau tidak dapat dilaksanakan oleh pengadilan yang berwenang, ketentuan tersebut akan dihapus dan ketentuan lainnya tetap berlaku.

8. Hukum yang Berlaku

   Perjanjian ini akan diatur dan ditafsirkan sesuai dengan hukum yang berlaku di Indonesia tanpa memperhatikan konflik prinsip hukum.

Para Pihak menyatakan bahwa mereka telah membaca dan memahami seluruh isi Perjanjian ini, dan dengan sukarela setuju untuk terikat oleh ketentuan-ketentuannya.

Para Pihak setuju untuk menandatangani Perjanjian ini dalam dua salinan yang sama dan mempunyai kekuatan hukum yang sama.

Ditetapkan pada tanggal yang disebutkan di atas.

Pihak Pertama:                             Pihak Kedua:
[Paraf]                                                             [Paraf]




cara scan nmap jaringan siapa aja yang pake wifi
‚îå‚îÄ‚îÄ(root„âøkali)-[/home/mixue]
‚îî‚îÄ# sudo nmap -sn 192.168.1.8/24   

untuk scan port terbuka
‚îå‚îÄ‚îÄ(root„âøkali)-[/home/mixue]
‚îî‚îÄ# sudo nmap -sS 192.168.1.2/24

----------------------------------------

22 mei 

TARGET SPECIFICATION:
  Can pass hostnames, IP addresses, networks, etc.
  Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254
  -iL <inputfilename>: Input from list of hosts/networks
  -iR <num hosts>: Choose random targets
  --exclude <host1[,host2][,host3],...>: Exclude hosts/networks
  --excludefile <exclude_file>: Exclude list from file
HOST DISCOVERY:
  -sL: List Scan - simply list targets to scan
  -sn: Ping Scan - disable port scan
  -Pn: Treat all hosts as online -- skip host discovery
  -PS/PA/PU/PY[portlist]: TCP SYN/ACK, UDP or SCTP discovery to given ports
  -PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes
  -PO[protocol list]: IP Protocol Ping
  -n/-R: Never do DNS resolution/Always resolve [default: sometimes]
  --dns-servers <serv1[,serv2],...>: Specify custom DNS servers
  --system-dns: Use OS's DNS resolver
  --traceroute: Trace hop path to each host
SCAN TECHNIQUES:
  -sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
  -sU: UDP Scan
  -sN/sF/sX: TCP Null, FIN, and Xmas scans
  --scanflags <flags>: Customize TCP scan flags
  -sI <zombie host[:probeport]>: Idle scan
  -sY/sZ: SCTP INIT/COOKIE-ECHO scans
  -sO: IP protocol scan
  -b <FTP relay host>: FTP bounce scan
PORT SPECIFICATION AND SCAN ORDER:
  -p <port ranges>: Only scan specified ports
    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9
  --exclude-ports <port ranges>: Exclude the specified ports from scanning
  -F: Fast mode - Scan fewer ports than the default scan
  -r: Scan ports sequentially - don't randomize
  --top-ports <number>: Scan <number> most common ports
  --port-ratio <ratio>: Scan ports more common than <ratio>
SERVICE/VERSION DETECTION:
  -sV: Probe open ports to determine service/version info
  --version-intensity <level>: Set from 0 (light) to 9 (try all probes)
  --version-light: Limit to most likely probes (intensity 2)
  --version-all: Try every single probe (intensity 9)
  --version-trace: Show detailed version scan activity (for debugging)
SCRIPT SCAN:
  -sC: equivalent to --script=default
  --script=<Lua scripts>: <Lua scripts> is a comma separated list of
           directories, script-files or script-categories
  --script-args=<n1=v1,[n2=v2,...]>: provide arguments to scripts
  --script-args-file=filename: provide NSE script args in a file
  --script-trace: Show all data sent and received
  --script-updatedb: Update the script database.
  --script-help=<Lua scripts>: Show help about scripts.
           <Lua scripts> is a comma-separated list of script-files or
           script-categories.
OS DETECTION:
  -O: Enable OS detection
  --osscan-limit: Limit OS detection to promising targets
  --osscan-guess: Guess OS more aggressively
TIMING AND PERFORMANCE:
  Options which take <time> are in seconds, or append 'ms' (milliseconds),
  's' (seconds), 'm' (minutes), or 'h' (hours) to the value (e.g. 30m).
  -T<0-5>: Set timing template (higher is faster)
  --min-hostgroup/max-hostgroup <size>: Parallel host scan group sizes
  --min-parallelism/max-parallelism <numprobes>: Probe parallelization
  --min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout <time>: Specifies
      probe round trip time.
  --max-retries <tries>: Caps number of port scan probe retransmissions.
  --host-timeout <time>: Give up on target after this long
  --scan-delay/--max-scan-delay <time>: Adjust delay between probes
  --min-rate <number>: Send packets no slower than <number> per second
  --max-rate <number>: Send packets no faster than <number> per second
FIREWALL/IDS EVASION AND SPOOFING:
  -f; --mtu <val>: fragment packets (optionally w/given MTU)
  -D <decoy1,decoy2[,ME],...>: Cloak a scan with decoys
  -S <IP_Address>: Spoof source address
  -e <iface>: Use specified interface
  -g/--source-port <portnum>: Use given port number
  --proxies <url1,[url2],...>: Relay connections through HTTP/SOCKS4 proxies
  --data <hex string>: Append a custom payload to sent packets
  --data-string <string>: Append a custom ASCII string to sent packets
  --data-length <num>: Append random data to sent packets
  --ip-options <options>: Send packets with specified ip options
  --ttl <val>: Set IP time-to-live field
  --spoof-mac <mac address/prefix/vendor name>: Spoof your MAC address
  --badsum: Send packets with a bogus TCP/UDP/SCTP checksum
OUTPUT:
  -oN/-oX/-oS/-oG <file>: Output scan in normal, XML, s|<rIpt kIddi3,
     and Grepable format, respectively, to the given filename.
  -oA <basename>: Output in the three major formats at once
  -v: Increase verbosity level (use -vv or more for greater effect)
  -d: Increase debugging level (use -dd or more for greater effect)
  --reason: Display the reason a port is in a particular state
  --open: Only show open (or possibly open) ports
  --packet-trace: Show all packets sent and received
  --iflist: Print host interfaces and routes (for debugging)
  --append-output: Append to rather than clobber specified output files
  --resume <filename>: Resume an aborted scan
  --noninteractive: Disable runtime interactions via keyboard
  --stylesheet <path/URL>: XSL stylesheet to transform XML output to HTML
  --webxml: Reference stylesheet from Nmap.Org for more portable XML
  --no-stylesheet: Prevent associating of XSL stylesheet w/XML output
MISC:
  -6: Enable IPv6 scanning
  -A: Enable OS detection, version detection, script scanning, and traceroute
  --datadir <dirname>: Specify custom Nmap data file location
  --send-eth/--send-ip: Send using raw ethernet frames or IP packets
  --privileged: Assume that the user is fully privileged
  --unprivileged: Assume the user lacks raw socket privileges
  -V: Print version number
  -h: Print this help summary page.
EXAMPLES:
  nmap -v -A scanme.nmap.org
  nmap -v -sn 192.168.0.0/16 10.0.0.0/8
  nmap -v -iR 10000 -Pn -p 80
SEE THE MAN PAGE (https://nmap.org/book/man.html) FOR MORE OPTIONS AND EXAMPLES
Scantype u not supported








Dijual Tanah Siap Bangun di Komplek Cigadung, Lingkungan Asri dan Nyaman

Miliki tanah siap bangun di komplek Cigadung yang memiliki lingkungan asri dan nyaman. Tanah ini memiliki luas 238 M¬≤ dengan dimensi 10x23.8 M¬≤ dan sudah dibenteng. Selain itu, tanah ini juga sudah tersedia listrik sebesar 2200 watt dan memiliki sertifikat hak milik (SHM). Air di lingkungan tersebut juga baik dan tersedia dari jet pump.

Lokasi tanah ini sangat strategis karena dekat dengan beberapa tempat penting seperti Dago Atas, Dago Resor, tempat kuliner, universitas seperti ITB, Unpad, Unikom, dan beberapa jalan utama seperti Tubagus Ismail, Pahlawan, dan Cikutra. Selain itu, tanah ini juga dekat dengan pusat perbelanjaan seperti Indomart, Alfa, Borma, dan Griya.

Tanah ini cocok untuk dibangun sebagai tempat tinggal atau investasi properti seperti kos-kosan. Lingkungan sekitar yang tenang dan aman juga cocok untuk berolahraga pagi seperti jogging.

Jangan lewatkan kesempatan memiliki tanah siap bangun dengan lokasi strategis di komplek Cigadung. Hubungi kami segera untuk informasi lebih lanjut dan jangan sampai kehabisan!






**Tanah Siap Bangun di Komplek Cigadung: Lingkungan Asri dan Nyaman**

Apakah Anda sedang mencari tanah siap bangun dengan lingkungan yang asri dan nyaman? Jika iya, ada kabar baik untuk Anda. Di komplek Cigadung, terdapat tanah yang siap bangun dengan berbagai fasilitas yang memenuhi kebutuhan Anda.

Tanah ini memiliki luas 238 meter persegi dengan dimensi 10x23.8 meter persegi. Selain itu, tanah tersebut sudah dibenteng, memberikan keamanan dan privasi bagi pemiliknya. Anda tidak perlu khawatir tentang pasokan listrik, karena tanah ini sudah tersedia dengan listrik sebesar 2200 watt. Keberadaan sertifikat hak milik (SHM) juga menambah nilai dan kepercayaan terhadap tanah ini.

Salah satu faktor penting yang perlu dipertimbangkan ketika membeli tanah adalah ketersediaan air. Lingkungan komplek Cigadung memiliki pasokan air yang baik, yang dapat diakses melalui jet pump. Ini adalah keuntungan tambahan yang akan Anda nikmati ketika memilih untuk memiliki tanah di komplek ini.

Lokasi tanah ini sangat strategis, dengan akses mudah ke beberapa tempat penting di sekitarnya. Dago Atas dan Dago Resor, yang terkenal dengan keindahan alamnya, berjarak dekat dari komplek Cigadung. Anda juga dapat menikmati berbagai pilihan kuliner di sekitar area ini. Bagi mereka yang tertarik dengan pendidikan, beberapa universitas terkemuka seperti ITB, Unpad, dan Unikom juga berada di dekat komplek ini.

Selain itu, akses ke beberapa jalan utama seperti Tubagus Ismail, Pahlawan, dan Cikutra sangat mudah dari komplek Cigadung. Ini akan memudahkan perjalanan Anda menuju pusat kota atau daerah sekitarnya. Jika Anda gemar berbelanja, Anda akan senang mengetahui bahwa komplek Cigadung juga dekat dengan pusat perbelanjaan seperti Indomart, Alfa, Borma, dan Griya.

Tanah ini sangat cocok untuk dibangun sebagai tempat tinggal pribadi atau sebagai investasi properti seperti kos-kosan. Lingkungan sekitar yang tenang dan aman juga memberikan keuntungan bagi mereka yang menyukai aktivitas fisik seperti jogging di pagi hari. Anda dapat menikmati udara segar dan pemandangan yang indah di sekitar komplek ini.

Jangan sia-siakan kesempatan memiliki tanah siap bangun dengan lokasi strategis di komplek Cigadung. Pastikan Anda menghubungi kami segera untuk informasi lebih lanjut. Tanah seperti ini biasanya diminati oleh banyak orang, jadi jangan sampai Anda kehabisan kesempatan untuk memiliki properti yang memenuhi keinginan Anda. Jadikan impian Anda memiliki hunian yang nyaman dan asri menjadi kenyataan dengan tanah di komplek Cigadung.

---------------------------------
24 mei

website tanah via

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Tanah Siap Bangun di Komplek Cigadung</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Custom Google font-->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    </head>
    <body class="d-flex flex-column h-100">
        <main class="flex-shrink-0">
            <!-- Navigation-->
            <nav class="navbar navbar-expand-lg navbar-light bg-white py-3">
                <div class="container px-5">
                    <a class="navbar-brand" href="index.html"><span class="fw-bolder text-primary">PROPERTI BANDUNG</span></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav ms-auto mb-2 mb-lg-0 small fw-bolder">
                            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                          
                            <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- Header-->



<header class="py-5">

    <div class="container px-5 pb-5">
        <div class="row gx-5 align-items-center">
            <div class="col-xxl-5">
                <!-- Header text content-->
                <div class="text-center text-xxl-start">
                    <div class="badge bg-gradient-primary-to-secondary text-white mb-4"><div class="text-uppercase">Design &middot; Development &middot; Marketing</div></div>
                    <div class="fs-3 fw-light text-muted">Apakah Anda sedang mencari tanah siap bangun dengan lingkungan yang asri dan nyaman? Jika iya, ada kabar baik untuk Anda.</div>
                    <h1 class="display-5 fw-bolder">Tanah Siap Bangun di Komplek Cigadung</h1>
                    <div class="d-grid gap-3 d-sm-flex justify-content-sm-center justify-content-xxl-start mt-3">
                        <a class="btn btn-primary btn-lg px-4 me-sm-3" href="#contact">Hubungi Kami</a>
                        <a class="btn btn-outline-primary btn-lg px-4" href="#features">Lihat Fasilitas</a>
                    </div>
                </div>
            </div>
            


          

        </div>
    </div>
</header>
            <center>
              <div class=" col-md-4 d-flex justify-content-center">

                <div>
                    <img src="https://i.imgur.com/dRzZ6yz.jpeg" class="float-start" alt="Paris" width="100%" height="100%"> 
                </div>
            </div>
            </center>



            <!-- Features section-->
            <section class="py-5" id="features">
                <div class="container px-5 my-5">
                    <div class="row gx-5">
                        <div class="col-lg-4 mb-5 mb-lg-0">
                            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-collection"></i></div>
                            <h2 class="h4 fw-bolder">Luas Tanah 238m<sup>2</sup></h2>
                            <p>Tanah ini memiliki luas 238 meter persegi dengan dimensi 10x23.8 meter persegi.</p>
                        </div>
                        <div class="col-lg-4 mb-5 mb-lg-0">
                            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-building"></i></div>
                            <h2 class="h4 fw-bolder">Dibenteng &amp; Aman</h2>
                            <p>Tanah tersebut sudah dibenteng, memberikan keamanan dan privasi bagi pemiliknya.</p>
                        </div>
                        <div class="col-lg-4">
                            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-lightning-charge"></i></div>
                            <h2 class="h4 fw-bolder">Listrik Tersedia</h2>
                            <p>Tanah ini sudah tersedia dengan listrik sebesar 2200 watt.</p>
                        </div>
                        <div class="col-lg-4 mb-5">
                            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-file-earmark"></i></div>
                            <h2 class="h4 fw-bolder">Sertifikat Hak Milik (SHM)</h2>
                            <p>Keberadaan sertifikat hak milik (SHM) juga menambah nilai dan kepercayaan terhadap tanah ini.</p>
                        </div>
                        <div class="col-lg-4 mb-5">
                            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-droplet-half"></i></div>
                            <h2 class="h4 fw-bolder">Pasokan Air yang Baik</h2>
                            <p>Lingkungan komplek Cigadung memiliki pasokan air yang baik, yang dapat diakses melalui jet pump.</p>
                        </div>
                        <div class="col-lg-4">
                            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-geo-alt"></i></div>
                            <h2 class="h4 fw-bolder">Lokasi Strategis</h2>
                            <p>Lokasi tanah ini sangat strategis, dengan akses mudah ke beberapa tempat penting di sekitarnya.</p>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Contact section-->
            <section class="py-5 bg-light" id="contact">
                <div class="container px-5 my-5">
                    <div class="text-center mb-5">
                        <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-envelope"></i></div>
                        <h2 class="fw-bolder">Hubungi Kami</h2>
                        <p class="lead fw-normal text-muted mb-0">Untuk informasi lebih lanjut atau mengatur kunjungan, hubungi kami di bawah ini.</p>
                    </div>
                    <div class="row gx-5 justify-content-center">
                        <div class="col-lg-6">
                            <!-- Contact form-->
                            <form>
                                <div class="form-floating mb-3">
                                    <input class="form-control" id="name" type="text" placeholder="Enter your name..." />
                                    <label for="name">Nama Anda</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input class="form-control" id="email" type="email" placeholder="Enter your email..." />
                                    <label for="email">Alamat Email</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="message" placeholder="Enter your message here..." style="height: 10rem"></textarea>
                                    <label for="message">Pesan Anda</label>
                                </div>
                                <div class="d-grid"><button class="btn btn-primary btn-lg" type="submit">Kirim Pesan</button></div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <!-- Footer-->
        <footer class="bg-light py-4">
            <div class="container px-5">
                <div class="row gx-5 justify-content-center">
                    <div class="col-lg-6 text-center text-lg-start">
                       
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
<!-- ----------------- -->
                        <div class="col-xxl-7">
                            <!-- Header profile picture-->
                            <div class="d-flex justify-content-center mt-5 mt-xxl-0">
                                <div class="profile bg-gradient-primary-to-secondary">
                                    <!-- TIP: For best results, use a photo with a transparent background like the demo example below-->
                                    <!-- Watch a tutorial on how to do this on YouTube (link)-->
 
<center>                                 <img style="max-width:30%;" class="profile-img" src="https://cdn.pixabay.com/photo/2022/03/01/08/11/call-center-7040784_1280.png" alt="..." />
</center>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- About Section-->
            <section class="bg-light py-5">
                <div class="container px-5">
                    <div class="row gx-5 justify-content-center">
                        <div class="col-xxl-8">
                            <div class="text-center my-5">
                                <h2 class="display-5 fw-bolder"><span class="text-gradient d-inline">Tentang kami</span></h2>
                                <p class="lead fw-light mb-4">Kami merupakan Ahli Pemasaran Properti yang inovatif dan kampanye online menggunakan strategi pemasaran canggih untuk memaksimalkan visibilitas properti Anda. </p>
                                <p class="text-muted">Tim ahli kami terdiri dari agen properti berdedikasi yang akan melakukan segala upaya untuk mempromosikan properti Anda secara efektif. Mereka akan bekerja sama dengan Anda untuk memahami kebutuhan dan preferensi Anda, serta memberikan saran berharga untuk meningkatkan daya tarik properti Anda. </p>
                                <div class="d-flex justify-content-center fs-2 gap-4">
                                    <a class="text-gradient" href="#!"><i class="bi bi-twitter"></i></a>
                                    <a class="text-gradient" href="#!"><i class="bi bi-linkedin"></i></a>
                                    <a class="text-gradient" href="#!"><i class="bi bi-github"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <!-- Footer-->
        <footer class="bg-white py-4 mt-auto">
            <div class="container px-5">
                <div class="row align-items-center justify-content-between flex-column flex-sm-row">
                    <div class="col-auto"><div class="small m-0">Copyright &copy; PROPERTI BANDUNG 2023</div></div>
                    <div class="col-auto">
                        <a class="small" href="#!">Privacy</a>
                        <span class="mx-1">&middot;</span>
                        <a class="small" href="#!">Terms</a>
                        <span class="mx-1">&middot;</span>
                        <a class="small" href="#!">Contact</a>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var form = document.querySelector("form");
    form.addEventListener("submit", function(event) {
      event.preventDefault(); // Mencegah form dikirim secara normal
      
      var name = document.getElementById("name").value;
      var email = document.getElementById("email").value;
      var message = document.getElementById("message").value;
      
      // Menggabungkan data ke dalam URL
      var url = "https://wa.me/6285867730460?text=" + encodeURIComponent(name) + "+" + encodeURIComponent(email) + "+" + encodeURIComponent(message) + "%0A%0A" + encodeURIComponent("Saya berminat untuk menanyakan tentang tanah yang diiklankan. Boleh saya hubungi lebih lanjut?");
      
      // Buka URL dalam tab baru
      window.open(url, "_blank");
    });
  });
</script>
08126577207




------------------













<div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-lightning-charge"></i></div>

///////////////////animasi css saat scroll///////////////

Untuk meluncurkan animasi saat Anda menggulir halaman dan mencapai elemen yang ditentukan, Anda dapat menggunakan JavaScript dan CSS. Berikut ini adalah contoh potongan kode yang dapat Anda gunakan:

HTML:
```html
<div class="feature bg-primary bg-gradient text-white rounded-3 mb-3" style="font-size: 30px; width: 100px; height: 50px;">
  <i class="bi bi-collection"></i>
</div>
```

CSS:
```css
.animated {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s ease-out, transform 0.5s ease-out;
}

.visible {
  opacity: 1;
  transform: translateY(0);
}
```

JavaScript:
```javascript
function isElementInViewport(el) {
  var rect = el.getBoundingClientRect();
  return (
    rect.top >= 0 &&
    rect.left >= 0 &&
    rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
    rect.right <= (window.innerWidth || document.documentElement.clientWidth)
  );
}

function handleScrollAnimation() {
  var element = document.querySelector('.feature');
  if (isElementInViewport(element)) {
    element.classList.add('visible');
  }
}

window.addEventListener('scroll', handleScrollAnimation);
```

Pada CSS, kita mendefinisikan dua kelas: `.animated` dan `.visible`. Kelas `.animated` mengatur status awal elemen yang disembunyikan dengan opacity 0 dan transform translateY untuk memindahkannya ke bawah 20 piksel. Kelas `.visible` diterapkan saat elemen berada dalam viewport, menjadikannya terlihat dengan opacity 1 dan mengembalikan transformasi.

Pada JavaScript, ada dua fungsi. `isElementInViewport` memeriksa apakah elemen saat ini berada dalam viewport. `handleScrollAnimation` adalah penangan acara yang menambahkan kelas `.visible` ke elemen saat berada dalam viewport.

Ketika Anda menggulir halaman dan mencapai elemen yang ditentukan, itu akan memicu animasi dan membuat elemen menjadi terlihat. Anda mungkin perlu menyesuaikan kode dan kelas CSS sesuai dengan kebutuhan spesifik Anda.



///////////////////animasi css saat scroll///////////////

///////ganti warna termux///////
Maaf atas kekeliruan sebelumnya. Jika Anda tidak menemukan baris PS1='\$ ' di berkas .bashrc, Anda dapat menambahkan baris berikut di akhir berkas:

bash
Copy code
export PS1="\[\e[1;32m\]\u@\h \[\e[1;34m\]\w \$ \[\e[0m\]"
Baris ini akan mengatur warna prompt menjadi hijau untuk nama pengguna (\u), biru untuk direktori saat ini (\w), dan warna teks kembali ke default setelah prompt (\[\e[0m\]).

Setelah menambahkan baris tersebut, tekan Ctrl+X untuk keluar dari editor nano dan pilih Y untuk menyimpan perubahan.

Selanjutnya, ketikkan perintah berikut untuk memuat ulang konfigurasi Termux:

bash
Copy code
source ~/.bashrc
Warna prompt di Termux sekarang akan berubah sesuai dengan konfigurasi yang telah Anda tambahkan. Mohon maaf atas kebingungan sebelumnya dan terima kasih atas pemahaman Anda.





Send a message...



----------------------------
25 mei
 


GloriaSalon.com:

fiturnya: salon booking app, salon comunity platform, salon loyalty program, beauty tips consultant

1. "Salon Booking App": situs/apps yang bikin mereka bisa booking jasa perawatan di semua salon di Medan secara online. mereka bisa pilih layanan yang mau mereka coba, cek jadwal yang lagi kosong, dan langsung booking lewat situs/apps ini. Ada juga info harga, review, dan portofolio para beauty expert di salon-salon itu.

2. "Beauty Tips consultant": mereka bisa tanya-tanya sama beauty expert dan dapetin tips kecantikan yang oke. mereka bisa belajar cara merawat kulit, rambut, dan kuku dengan bener. Ada juga step-by-step buat makeup, manikur, pedikur, dan perawatan kecantikan lainnya.

3. "Salon Community Platform": situs/apps ini nyambungin mereka sama komunitas salon Medan. mereka bisa cerita pengalaman, kasih ulasan, dan rekomen salon-salon yang pernah mereka kunjungi. Ada juga forum buat tanya-tanya dan sharing tips kecantikan sama pengguna lainnya. jadi ada kontrol sosial di sini agar salon salon di medan bisa dapat kritik saran serta bersaing sehat.

4. "Salon Loyalty Program": bagi-bagi program loyalitas buat pelanggan salon. mereka bisa kumpulin poin atau dapetin diskon spesial tiap kali pakai jasa salon. Situs/apps ini juga bikin mereka gampang ngecek jumlah poin, dapet penawaran eksklusif, dan reminder jadwal perawatan.

5. "Virtual Hair Makeover": mereka bisa cobain berbagai model dan warna rambut secara virtual sebelum dicoba beneran. mereka bisa upload foto sendiri atau pake foto model di situs/apps ini buat nyoba gaya rambut yang berbeda dan dapet rekomendasi dari para ahli kecantikan. ini agak berat butuh orang machine learning 


Aliran database untuk website GloriaSalon.com terdiri dari beberapa tabel utama. Tabel "Users" menyimpan informasi pengguna seperti user_id (Primary Key), username, email, password, dan registration_date. Tabel "Salons" berisi detail salon seperti salon_id (Primary Key), salon_name, salon_address, salon_phone, salon_email, dan salon_description.

Layanan salon diatur dalam tabel "Services" dengan service_id (Primary Key), service_name, service_description, service_price, dan salon_id (Foreign Key). Tabel "Packages" menyimpan paket perawatan dengan package_id (Primary Key), package_name, package_description, package_price, dan salon_id (Foreign Key). 

Konsultasi kecantikan diajukan melalui tabel "Consultations" dengan consultation_id (Primary Key), user_id (Foreign Key), consultation_date, dan consultation_question. 

Tips kecantikan tersedia dalam tabel "BeautyTips" dengan tip_id (Primary Key), tip_title, dan tip_content. 

Interaksi pengguna dalam komunitas salon tercatat dalam tabel "ForumPosts" dengan post_id (Primary Key), user_id (Foreign Key), post_content, dan post_date. 

Ulasan pengguna tentang salon disimpan dalam tabel "Reviews" dengan review_id (Primary Key), user_id (Foreign Key), salon_id (Foreign Key), review_content, dan review_date. 

Program loyalitas pelanggan terdaftar dalam tabel "LoyaltyProgram" dengan program_id (Primary Key), program_name, dan program_description. Poin pelanggan dikelola melalui tabel "Points" dengan point_id (Primary Key), user_id (Foreign Key), program_id (Foreign Key), points_amount, dan points_date.



Data Flow Diagram (DFD) untuk aliran data dalam website GloriaSalon.com:

Level 0 DFD:

```
    +---------------------------------------+
    |             GloriaSalon.com            |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |          User Registration/Login       |
    +---------------------------------------+
                    |         |
                    v         v
    +---------------------------------------+
    |        Salon Booking Process           |
    +---------------------------------------+
                    |         |
                    v         v
    +---------------------------------------+
    |       Consultation & Beauty Tips       |
    +---------------------------------------+
                    |         |
                    v         v
    +---------------------------------------+
    |         Salon Community Platform       |
    +---------------------------------------+
                    |         |
                    v         v
    +---------------------------------------+
    |        Salon Loyalty Program           |
    +---------------------------------------+
                    | Output
```

Level 1 DFD - User Registration/Login:

```
    +---------------------------------------+
    |           User Registration            |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |              User Login                |
    +---------------------------------------+
                    | Output
```

Level 1 DFD - Salon Booking Process:

```
    +---------------------------------------+
    |          Salon Booking App             |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |            Salon Availability          |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |             Reservation                |
    +---------------------------------------+
                    | Output
```

Level 1 DFD - Consultation & Beauty Tips:

```
    +---------------------------------------+
    |          Beauty Tips Consultant        |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |           Consultation Request         |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |            Beauty Tips Display         |
    +---------------------------------------+
                    | Output
```

Level 1 DFD - Salon Community Platform:

```
    +---------------------------------------+
    |         Salon Community Platform       |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |          User Interactions             |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |          Salon Recommendations         |
    +---------------------------------------+
                    | Output
```

Level 1 DFD - Salon Loyalty Program:

```
    +---------------------------------------+
    |         Salon Loyalty Program          |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |            Points Accumulation         |
    +---------------------------------------+
                    | Input/Output
    +---------------------------------------+
    |          Loyalty Program Benefits      |
    +---------------------------------------+
                    | Output
```


 






Kerangka kerja/ diagram konseptual untuk website GloriaSalon.com:

    Halaman Beranda:

    Header: Logo GloriaSalon.com, menu navigasi (Beranda, Layanan, Paket, Konsultasi, Komunitas, Program Loyalitas, Kontak)
    Banner: Gambar menarik dan tagline yang menampilkan keunggulan GloriaSalon.com
    Cari Salon: Kotak pencarian untuk memilih lokasi, jenis layanan, dan tanggal pemesanan
    Fitur Unggulan: Sekilas tentang fitur-fitur utama seperti Salon Booking App, Beauty Tips Consultant, Salon Community Platform, dan Salon Loyalty Program
    Testimoni Pelanggan: Ulasan dan testimoni dari pelanggan yang puas
    Tautan Cepat: Tautan cepat ke layanan populer, penawaran khusus, atau artikel terbaru

    Halaman Layanan:

    Daftar Layanan: Daftar jenis layanan yang ditawarkan oleh salon-salon terkait dengan informasi dan harga yang terkait
    Pencarian Lanjutan: Filter lanjutan untuk mencari layanan berdasarkan jenis, harga, dan lokasi salon
    Detail Layanan: Halaman dengan deskripsi, foto, dan ulasan tentang layanan tertentu

    Halaman Paket:

    Daftar Paket: Daftar paket perawatan khusus yang ditawarkan oleh salon-salon dengan informasi dan harga yang terkait
    Pencarian Lanjutan: Filter lanjutan untuk mencari paket berdasarkan jenis, harga, dan lokasi salon
    Detail Paket: Halaman dengan deskripsi, foto, dan ulasan tentang paket perawatan tertentu

    Halaman Konsultasi:

    Konsultasi Kecantikan: Formulir untuk mengajukan pertanyaan dan permintaan konsultasi kecantikan kepada para ahli seperti alodokter 
    Beauty Tips dan Tutorial: Artikel, video, atau panduan tentang tips kecantikan dan tutorial perawatan diri

    Halaman Komunitas:

    Forum Diskusi: Forum tempat pengguna atau para pelanggan salon salon di medan dapat berbagi pengalaman, bertanya, dan berinteraksi dengan pengguna lainnya 
    Ulasan Salon: Halaman dengan daftar salon-salon yang dapat diulas dan dinilai oleh pengguna

    Halaman Program Loyalitas:

    Poin dan Diskon: Informasi tentang cara mengumpulkan poin dan manfaat diskon yang didapatkan oleh pelanggan setia
    Riwayat Poin: Pelanggan dapat melihat jumlah poin yang mereka kumpulkan dan sejarah penggunaan poin

    Halaman Kontak:

    Informasi Kontak: Alamat, nomor telepon, dan email untuk menghubungi tim GloriaSalon.com
    Formulir Kontak: Formulir untuk mengirimkan pertanyaan atau masukan kepada tim GloriaSalon.com

































    

aliran database untuk website GloriaSalon.com:

    Tabel "Users":

    user_id (Primary Key)
    username
    email
    password
    registration_date

    Tabel "Salons":

    salon_id (Primary Key)
    salon_name
    salon_address
    salon_phone
    salon_email
    salon_description

    Tabel "Services":

    service_id (Primary Key)
    service_name
    service_description
    service_price
    salon_id (Foreign Key)

    Tabel "Packages":

    package_id (Primary Key)
    package_name
    package_description
    package_price
    salon_id (Foreign Key)

    Tabel "Consultations":

    consultation_id (Primary Key)
    user_id (Foreign Key)
    consultation_date
    consultation_question

    Tabel "BeautyTips":

    tip_id (Primary Key)
    tip_title
    tip_content

    Tabel "ForumPosts":

    post_id (Primary Key)
    user_id (Foreign Key)
    post_content
    post_date

    Tabel "Reviews":

    review_id (Primary Key)
    user_id (Foreign Key)
    salon_id (Foreign Key)
    review_content
    review_date

    Tabel "LoyaltyProgram":

    program_id (Primary Key)
    program_name
    program_description

    Tabel "Points":

    point_id (Primary Key)
    user_id (Foreign Key)
    program_id (Foreign Key)
    points_amount
    points_date

    -----------------------------------------

    24 mei 2023
cara remote kali linux secara desktop di android tanpa apk seperti teamviewer
ChatGPT

Untuk mengakses desktop Kali Linux dari perangkat Android tanpa menggunakan aplikasi seperti TeamViewer, Anda dapat menggunakan protokol VNC (Virtual Network Computing). Berikut adalah langkah-langkah umum untuk melakukan ini:

    Pastikan desktop Kali Linux Anda sudah terinstall dan sudah terhubung ke jaringan yang sama dengan perangkat Android Anda.

    Di desktop Kali Linux, pastikan Anda sudah mengaktifkan server VNC. Anda dapat menggunakan perintah sudo apt-get install vino untuk menginstal server VNC jika belum ada. Kemudian, jalankan perintah vino-preferences untuk mengatur preferensi VNC, seperti password dan izin akses.

    Pastikan firewall di desktop Kali Linux tidak memblokir port yang digunakan oleh VNC (biasanya port 5900).

    Di perangkat Android, unduh dan instal aplikasi VNC Viewer dari Play Store. Beberapa aplikasi VNC Viewer yang populer adalah RealVNC, TightVNC, atau bVNC.

    Buka aplikasi VNC Viewer di perangkat Android dan buat koneksi baru. Masukkan alamat IP atau nama host desktop Kali Linux, serta nomor port VNC jika menggunakan port selain port default (5900).

    Jika Anda telah mengatur password saat mengonfigurasi server VNC di Kali Linux, Anda akan diminta memasukkan password tersebut di aplikasi VNC Viewer di perangkat Android.

    Setelah terhubung, Anda seharusnya dapat melihat tampilan desktop Kali Linux dan mengontrolnya melalui perangkat Android.

Pastikan untuk menjaga keamanan koneksi VNC dengan menggunakan password yang kuat dan hanya mengaktifkan akses VNC pada jaringan yang dipercaya. Selain itu, penting juga untuk memperhatikan kebijakan keamanan dan privasi perangkat Android Anda saat mengakses desktop Kali Linux secara jarak jauh.
User
‚îÄ(mixue„âøkali)-[~]
‚îî‚îÄ$ vino-preferences
vino-preferences: perintah tidak ditemukan
                                                                   
ChatGPT

Jika perintah "vino-preferences" tidak ditemukan di desktop Kali Linux Anda, kemungkinan besar server VNC tidak terinstal atau tidak tersedia di sistem Anda.

Anda dapat menginstal server VNC di Kali Linux dengan langkah-langkah berikut:

    Buka terminal di Kali Linux Anda.

    Jalankan perintah berikut untuk menginstal server VNC:

    arduino

sudo apt-get install vino

Setelah proses instalasi selesai, jalankan perintah berikut untuk mengonfigurasi preferensi VNC:

    vino-preferences

    Perintah ini akan membuka jendela preferensi VNC, di mana Anda dapat mengatur password dan izin akses.

Jika Anda masih mengalami masalah setelah mengikuti langkah-langkah di atas, pastikan Anda telah memperbarui dan memperbaiki repositori Kali Linux Anda dengan menjalankan perintah sudo apt-get update di terminal sebelum mencoba menginstal ulang server VNC.
User
sudah sudo apt-get install vino
ChatGPT

Jika Anda sudah menjalankan perintah sudo apt-get install vino dan server VNC sudah terinstal, tetapi perintah vino-preferences masih tidak ditemukan, ada beberapa kemungkinan yang bisa terjadi:

    Cek Variasi Perintah: Beberapa distribusi Linux memiliki variasi dalam perintah yang digunakan untuk mengonfigurasi preferensi VNC. Sebagai alternatif, Anda dapat mencoba perintah berikut:

vino-preferences &

Jika perintah ini tidak bekerja, Anda dapat mencoba perintah berikut:

bash

/usr/lib/vino/vino-server --sm-disable

Versi Kali Linux: Pastikan Anda menggunakan versi Kali Linux yang kompatibel dengan paket vino. Terkadang, ada perbedaan dalam paket yang tersedia di berbagai versi Kali Linux. Pastikan Anda menggunakan versi terbaru dan paling stabil.

Instalasi yang Tidak Berhasil: Ada kemungkinan bahwa instalasi server VNC tidak berhasil atau tidak lengkap. Anda dapat mencoba menghapus dan menginstal ulang paket vino dengan perintah berikut:

sql

    sudo apt-get purge vino
    sudo apt-get update
    sudo apt-get install vino

    Setelah menginstal ulang, coba jalankan perintah vino-preferences lagi untuk mengonfigurasi preferensi VNC.

Jika semua upaya di atas tetap tidak berhasil, mungkin ada masalah lain di sistem Anda yang mempengaruhi akses ke server VNC. Anda dapat mencari dokumentasi atau forum dukungan Kali Linux untuk mendapatkan bantuan lebih lanjut dalam mengatasi masalah ini.
User
ini hasilnya 
25/05/2023 21:36:51 Autoprobing TCP port in (all) network interface
25/05/2023 21:36:51 Listening IPv6://[::]:5900
25/05/2023 21:36:51 Listening IPv4://0.0.0.0:5900
25/05/2023 21:36:51 Autoprobing selected port 5900
25/05/2023 21:36:51 Advertising security type: 'TLS' (18)
25/05/2023 21:36:51 Re-binding socket to listen for VNC connections on TCP port 5900 in (all) interface
25/05/2023 21:36:51 Listening IPv6://[::]:5900
25/05/2023 21:36:51 Listening IPv4://0.0.0.0:5900
25/05/2023 21:36:51 Clearing securityTypes
25/05/2023 21:36:51 Advertising security type: 'TLS' (18)
25/05/2023 21:36:51 Clearing securityTypes
25/05/2023 21:36:51 Advertising security type: 'TLS' (18)
25/05/2023 21:36:51 Advertising authentication type: 'No Authentication' (1)
25/05/2023 21:36:53 Re-binding socket to listen for VNC connections on TCP port 5900 in (all) interface
25/05/2023 21:36:53 Listening IPv6://[::]:5900
25/05/2023 21:36:53 Listening IPv4://0.0.0.0:5900

ChatGPT

Keluaran yang Anda berikan menunjukkan bahwa server VNC (vino) telah berhasil diaktifkan dan sedang mendengarkan koneksi pada port 5900 di semua antarmuka jaringan. Dalam hal ini, server VNC siap menerima koneksi dari aplikasi VNC Viewer.

Untuk mengakses desktop Kali Linux dari perangkat Android menggunakan VNC Viewer, lakukan langkah-langkah berikut:

    Pastikan perangkat Android Anda terhubung ke jaringan yang sama dengan desktop Kali Linux.

    Buka aplikasi VNC Viewer di perangkat Android.

    Buat koneksi baru di aplikasi VNC Viewer. Masukkan alamat IP desktop Kali Linux dan nomor port 5900 (jika Anda tidak mengubah port VNC default).

    Jika Anda mengatur password saat mengonfigurasi preferensi VNC di desktop Kali Linux, Anda akan diminta memasukkan password tersebut di aplikasi VNC Viewer di perangkat Android.

    Setelah terhubung, Anda seharusnya dapat melihat dan mengontrol desktop Kali Linux melalui perangkat Android Anda.

Pastikan untuk menjaga keamanan koneksi VNC dengan menggunakan password yang kuat dan hanya mengaktifkan akses VNC pada jaringan yang dipercaya. Selain itu, penting juga untuk memperhatikan kebijakan keamanan dan privasi perangkat Android Anda saat mengakses desktop Kali Linux secara jarak jauh.
User
kata vnc viewernya the authentication mechanism rwquested cannot be provided b the computer
ChatGPT

Pesan "The authentication mechanism requested cannot be provided by the computer" menunjukkan bahwa mekanisme autentikasi yang diminta oleh komputer tidak dapat dipenuhi oleh server VNC di desktop Kali Linux. Untuk mengatasi masalah ini, Anda dapat mencoba langkah-langkah berikut:

    Pastikan Anda telah mengatur preferensi VNC di desktop Kali Linux dengan benar. Buka terminal dan jalankan perintah vino-preferences untuk memeriksa pengaturan autentikasi VNC. Pastikan autentikasi diatur ke "No Authentication" atau pilih metode autentikasi yang didukung oleh VNC Viewer Anda.

    Jika autentikasi sudah diatur dengan benar, cobalah mengubah preferensi autentikasi menjadi metode yang berbeda, seperti menggunakan password atau metode autentikasi lainnya. Lalu coba sambungkan kembali dengan VNC Viewer di perangkat Android.

    Jika masalah masih berlanjut, cobalah untuk menggunakan aplikasi VNC Viewer yang berbeda di perangkat Android Anda. Beberapa aplikasi VNC Viewer yang populer adalah RealVNC, TightVNC, atau bVNC. Mungkin aplikasi ini memiliki dukungan autentikasi yang lebih baik dengan server VNC di desktop Kali Linux.

    Periksa juga konfigurasi firewall di desktop Kali Linux. Pastikan port yang digunakan oleh VNC (biasanya port 5900) tidak diblokir oleh firewall. Anda dapat memeriksa pengaturan firewall menggunakan perintah sudo ufw status di terminal.

Jika masalah tetap berlanjut setelah mencoba langkah-langkah di atas, mungkin ada masalah lain dengan konfigurasi server VNC atau kompatibilitas antara VNC Viewer dan server VNC di desktop Kali Linux. Dalam kasus seperti itu, saya sarankan untuk mencari dokumentasi atau forum dukungan Kali Linux untuk mendapatkan bantuan lebih lanjut.
User
padahal sudah install tapi vino-preferences ga ditemukan katanya
ChatGPT

Jika Anda telah menginstal server VNC (vino) di Kali Linux dan perintah vino-preferences tidak ditemukan, ada kemungkinan ada perubahan atau perbedaan dalam versi terbaru dari Kali Linux yang mempengaruhi perintah tersebut.

Untuk mengkonfigurasi preferensi VNC dalam versi terbaru Kali Linux, Anda dapat mencoba langkah-langkah berikut:

    Buka Terminal di Kali Linux.

    Jalankan perintah berikut untuk mengedit file konfigurasi VNC:

    javascript

sudo nano ~/.vnc/config

Jika file konfigurasi tidak ada, perintah di atas akan membuatnya.

Di dalam editor teks, masukkan preferensi VNC berikut ini sebagai contoh:

csharp

    [desktop]
    geometry=1920x1080
    alwaysshared=true

    Di sini, "geometry" mengatur resolusi tampilan desktop yang ingin Anda gunakan, dan "alwaysshared" menentukan apakah desktop harus selalu dibagi dengan pengguna lokal saat ada koneksi VNC.

    Anda dapat menyesuaikan preferensi lain sesuai kebutuhan Anda.

    Simpan perubahan dengan menekan "Ctrl + X", lalu "Y" untuk mengonfirmasi, dan "Enter" untuk menulis ulang file konfigurasi.

Setelah menyimpan konfigurasi, restart server VNC dengan menjalankan perintah vncserver -kill :1 untuk menghentikan server VNC yang sedang berjalan, lalu jalankan perintah vncserver untuk memulai ulang server dengan konfigurasi baru.

Sekarang, coba sambungkan dari perangkat Android menggunakan aplikasi VNC Viewer dan lihat apakah Anda dapat mengakses desktop Kali Linux melalui perangkat Android.

Jika Anda masih mengalami masalah atau memiliki pertanyaan lebih lanjut, disarankan untuk mencari sumber daya resmi atau forum dukungan Kali Linux untuk mendapatkan bantuan yang lebih terperinci dan sesuai dengan versi Kali Linux yang Anda gunakan.
User
      [ Galat saat menulis /root/.vnc/config: Tidak ada berkas atau direktori seperti itu ]
ChatGPT

Maaf atas kebingungan sebelumnya. Sepertinya ada kesalahan dalam langkah-langkah yang diberikan sebelumnya terkait konfigurasi VNC di Kali Linux.

Untuk mengonfigurasi preferensi VNC di Kali Linux, Anda dapat mengikuti langkah-langkah berikut:

    Buka Terminal di Kali Linux.

    Jalankan perintah berikut untuk mengedit file konfigurasi VNC:

    javascript

nano ~/.vnc/xstartup

Di dalam editor teks, temukan dan hapus tanda "#" di awal baris berikut (jika ada):

shell

# unset SESSION_MANAGER

Setelah itu, tambahkan baris berikut di bawah baris yang dihapus:

bash

unset DBUS_SESSION_BUS_ADDRESS

Hasilnya, bagian awal dari file xstartup akan terlihat seperti ini:

bash

    #!/bin/sh
    unset SESSION_MANAGER
    unset DBUS_SESSION_BUS_ADDRESS
    xrdb $HOME/.Xresources
    xsetroot -solid grey
    ...

    Pastikan baris unset SESSION_MANAGER tidak ada tanda "#" di awalnya, dan baris unset DBUS_SESSION_BUS_ADDRESS ditambahkan di bawahnya.

    Simpan perubahan dengan menekan "Ctrl + X", lalu "Y" untuk mengonfirmasi, dan "Enter" untuk menulis ulang file konfigurasi.

Setelah menyimpan konfigurasi, restart server VNC dengan menjalankan perintah vncserver -kill :1 untuk menghentikan server VNC yang sedang berjalan, lalu jalankan perintah vncserver untuk memulai ulang server dengan konfigurasi baru.

Sekarang, coba sambungkan dari perangkat Android menggunakan aplikasi VNC Viewer dan lihat apakah Anda dapat mengakses desktop Kali Linux melalui perangkat Android.

Jika Anda masih mengalami masalah atau memiliki pertanyaan lebih lanjut, disarankan untuk mencari sumber daya resmi atau forum dukungan Kali Linux untuk mendapatkan bantuan yang lebih terperinci dan sesuai dengan versi Kali Linux yang Anda gunakan.
User
direktori TIDAK ADA katanya setelah masukkan ini nano ~/.vnc/xstartup
ChatGPT

Maaf atas kesalahan sebelumnya. Jika direktori ~/.vnc tidak ada, itu berarti server VNC (vino) belum menghasilkan direktori konfigurasi. Anda dapat mencoba langkah-langkah berikut untuk mengonfigurasi VNC di Kali Linux:

    Buka Terminal di Kali Linux.

    Jalankan perintah berikut untuk membuat direktori .vnc:

    bash

mkdir ~/.vnc

Setelah membuat direktori, jalankan perintah berikut untuk membuat file xstartup di dalam direktori .vnc:

javascript

nano ~/.vnc/xstartup

Di dalam editor teks, masukkan konfigurasi berikut sebagai contoh:

bash

#!/bin/bash
xrdb $HOME/.Xresources
startxfce4 &

Pastikan Anda menyesuaikan konfigurasi sesuai dengan lingkungan desktop yang Anda gunakan. Dalam contoh di atas, kami menggunakan XFCE sebagai lingkungan desktop. Jika Anda menggunakan lingkungan desktop yang berbeda, ubahlah perintah startxfce4 sesuai dengan lingkungan desktop yang Anda gunakan.

Simpan perubahan dengan menekan "Ctrl + X", lalu "Y" untuk mengonfirmasi, dan "Enter" untuk menulis ulang file konfigurasi.

Setelah menyimpan konfigurasi, jalankan perintah berikut untuk memberikan izin eksekusi pada file xstartup:

bash

chmod +x ~/.vnc/xstartup

Sekarang, Anda dapat memulai server VNC dengan menjalankan perintah berikut:

    vncserver

    Server VNC akan memulai sesi VNC baru dan memberikan informasi tentang nomor sesi (misalnya, :1) yang akan Anda gunakan saat terhubung dengan VNC Viewer.

Setelah menjalankan server VNC, coba sambungkan dari perangkat Android menggunakan aplikasi VNC Viewer dan masukkan alamat IP dan nomor sesi yang sesuai. Misalnya, jika nomor sesi adalah :1 dan alamat IP Kali Linux adalah 192.168.0.100, Anda harus memasukkan 192.168.0.100:1 di VNC Viewer.

Saya mohon maaf atas kebingungan sebelumnya, dan harap langkah-langkah ini membantu Anda mengonfigurasi VNC di Kali Linux.
User
‚îå‚îÄ‚îÄ(root„âøkali)-[/home/mixue]
‚îî‚îÄ# vncserver


You will require a password to access your desktops.

Password: 
ChatGPT

Saat menjalankan perintah vncserver, Anda diminta untuk mengatur kata sandi untuk mengakses desktop VNC. Anda perlu memasukkan kata sandi yang kuat untuk melindungi akses ke desktop Kali Linux Anda melalui VNC.

Berikut adalah langkah-langkah yang dapat Anda ikuti untuk mengatur kata sandi VNC:

    Ketika diminta, masukkan kata sandi yang ingin Anda gunakan. Kata sandi tidak akan terlihat saat Anda mengetikkannya.

    Setelah memasukkan kata sandi, Anda akan diminta untuk memasukkan ulang kata sandi sebagai konfirmasi.

    Pastikan untuk mengingat kata sandi yang Anda masukkan, karena Anda akan membutuhkannya saat terhubung ke desktop Kali Linux menggunakan VNC Viewer.

Setelah mengatur kata sandi, server VNC akan memulai sesi VNC baru. Anda akan diberikan informasi tentang nomor sesi (misalnya, :1) yang akan Anda gunakan saat terhubung dengan VNC Viewer.

Sekarang, Anda dapat menggunakan aplikasi VNC Viewer di perangkat Android Anda dan memasukkan alamat IP Kali Linux dan nomor sesi (contohnya, 192.168.0.100:1) untuk terhubung ke desktop Kali Linux melalui VNC. Setelah itu, Anda akan diminta memasukkan kata sandi yang telah Anda atur saat memulai server VNC.

Pastikan untuk menggunakan kata sandi yang kuat dan aman untuk melindungi akses ke desktop Kali Linux melalui VNC.

Saya berharap ini membantu! Jika Anda memiliki pertanyaan lebih lanjut, jangan ragu untuk bertanya.
User
Would you like to enter a view-only password (y/n)? 
 APA NI
ChatGPT

Saat Anda ditanya "Would you like to enter a view-only password (y/n)?" setelah mengatur kata sandi VNC, itu berarti server VNC memberikan opsi untuk mengatur kata sandi "view-only".

Kata sandi "view-only" memungkinkan pengguna untuk melihat desktop VNC tanpa memiliki kontrol atau akses untuk berinteraksi dengan aplikasi atau file di desktop tersebut. Ini digunakan ketika Anda ingin membagikan tampilan desktop dengan orang lain secara pasif, tanpa memberikan mereka kemampuan untuk mengontrol atau mengubah sesuatu pada desktop.

Jika Anda ingin mengatur kata sandi "view-only", Anda dapat mengetik "y" dan kemudian mengikuti langkah-langkah yang sama seperti saat mengatur kata sandi reguler. Masukkan kata sandi view-only yang ingin Anda gunakan dan konfirmasikan ulang.

Namun, jika Anda tidak ingin mengatur kata sandi "view-only" dan hanya ingin memasukkan kata sandi reguler untuk akses penuh ke desktop, Anda dapat mengetik "n" dan melanjutkan tanpa mengatur kata sandi "view-only".

Pilihlah opsi yang sesuai dengan kebutuhan Anda.
User
saya mau android bisa mengontrol komputer saya dari jarak jauh
ChatGPT

Untuk mengontrol komputer Anda dari jarak jauh menggunakan perangkat Android, Anda dapat menggunakan aplikasi remote desktop seperti TeamViewer, AnyDesk, atau VNC Viewer.

Berikut adalah langkah-langkah umum untuk mengontrol komputer Anda dari jarak jauh menggunakan TeamViewer sebagai contoh:

    Pertama, unduh dan instal aplikasi TeamViewer pada perangkat Android Anda melalui Google Play Store.

    Selanjutnya, di komputer Anda, unduh dan instal aplikasi TeamViewer versi desktop yang sesuai dengan sistem operasi yang Anda gunakan. Anda dapat mengunduhnya dari situs web resmi TeamViewer (https://www.teamviewer.com).

    Setelah instalasi selesai, buka aplikasi TeamViewer di komputer Anda dan catat ID Partner yang ditampilkan di jendela aplikasi.

    Kemudian, buka aplikasi TeamViewer di perangkat Android Anda dan masukkan ID Partner yang telah Anda catat sebelumnya.

    Setelah itu, tekan tombol "Remote Control" atau "Connect" di aplikasi TeamViewer di perangkat Android Anda untuk memulai sesi remote desktop.

    Pada komputer Anda, Anda akan menerima permintaan koneksi yang ditampilkan oleh aplikasi TeamViewer. Terima permintaan koneksi tersebut untuk memulai sesi remote desktop.

Setelah langkah-langkah ini, Anda akan dapat
User
ya trus yang view only tadi gimana
ChatGPT

Jika Anda ingin mengizinkan akses "view-only" ke komputer Anda dari perangkat Android, Anda dapat menggunakan aplikasi VNC (Virtual Network Computing) seperti VNC Viewer. Berikut adalah langkah-langkah umum untuk mengatur akses "view-only" menggunakan VNC Viewer:

    Pastikan Anda telah menginstal server VNC (seperti vino) di komputer Anda. Anda dapat menginstalnya menggunakan manajer paket yang sesuai dengan distribusi Linux yang Anda gunakan.

    Pastikan server VNC sudah aktif dan berjalan di komputer Anda. Anda dapat memeriksa status server VNC dengan menjalankan perintah berikut di Terminal:

    vncserver -list

    Perintah ini akan menampilkan daftar sesi VNC yang sedang berjalan di komputer Anda.

    Buka aplikasi VNC Viewer di perangkat Android Anda.

    Masukkan alamat IP komputer Anda di bidang "Address" pada aplikasi VNC Viewer. Jika perlu, masukkan juga nomor port yang sesuai jika port VNC yang digunakan tidak standar (biasanya 5900).

    Aktifkan opsi "View only" atau "View mode" di aplikasi VNC Viewer. Caranya mungkin berbeda-beda

User
Would you like to enter a view-only password (y/n)? 
jika saya pilih yes maka artinya apa
ChatGPT

Jika Anda memilih "yes" saat ditanya "Would you like to enter a view-only password (y/n)?" saat menggunakan aplikasi VNC Viewer, itu berarti Anda ingin mengatur kata sandi "view-only" untuk sesi remote desktop.

Kata sandi "view-only" digunakan untuk memberikan akses hanya untuk melihat tampilan desktop secara pasif, tanpa memberikan kemampuan untuk mengontrol atau berinteraksi dengan aplikasi atau file di desktop tersebut.

Dengan mengatur kata sandi "view-only", orang lain yang terhubung ke komputer Anda melalui sesi VNC Viewer akan hanya dapat melihat apa yang terjadi di desktop tanpa bisa mengontrolnya.

Jika Anda memilih "yes", Anda akan diminta memasukkan kata sandi "view-only" yang ingin Anda gunakan. Masukkan kata sandi yang Anda inginkan dan konfirmasikan.

Setelah itu, saat orang lain terhubung ke desktop Anda melalui VNC Viewer, mereka akan diminta memasukkan kata sandi "view-only" yang telah Anda atur sebelum mereka dapat melihat tampilan desktop.

Jadi, dengan memilih "yes" dan mengatur kata sandi "view-only", Anda memberikan akses "hanya baca" ke komputer Anda melalui sesi VNC Viewer.
User
jika saya pilih no
ChatGPT

Jika Anda memilih "no" saat ditanya "Would you like to enter a view-only password (y/n)?" saat menggunakan aplikasi VNC Viewer, itu berarti Anda tidak ingin mengatur kata sandi "view-only" untuk sesi remote desktop.

Dengan memilih "no", orang yang terhubung ke komputer Anda melalui sesi VNC Viewer akan memiliki akses penuh dan dapat mengontrol serta berinteraksi dengan aplikasi dan file di desktop Anda.

Jadi, jika Anda memilih "no", tidak akan ada kata sandi "view-only" yang diperlukan untuk terhubung ke desktop Anda melalui VNC Viewer. Pengguna yang terhubung akan memiliki akses penuh dan dapat mengontrol komputer Anda.
User
Starting applications specified in /root/.vnc/xstartup
Log file is /root/.vnc/kali:1.log

artinya apa
ChatGPT

Pesan "Starting applications specified in /root/.vnc/xstartup" menunjukkan bahwa VNC Server sedang memulai aplikasi yang ditentukan dalam file konfigurasi xstartup di direktori .vnc di dalam direktori root (/root) pada sesi VNC yang memiliki nomor kali:1.

"Log file is /root/.vnc/kali:1.log" berarti VNC Server telah membuat file log untuk sesi VNC dengan nomor kali:1. File log ini akan berisi informasi tentang aktivitas dan kejadian yang terjadi dalam sesi VNC tersebut.

Anda dapat membuka file log tersebut dengan menggunakan perintah seperti:

bash

cat /root/.vnc/kali:1.log

Ini akan menampilkan isi file log pada terminal.

File log ini berguna untuk melacak dan mendiagnosis masalah yang mungkin terjadi selama sesi VNC, seperti pesan kesalahan atau informasi debug. Jika Anda mengalami masalah saat menggunakan sesi VNC, melihat file log dapat membantu Anda memahami dan memecahkan masalah tersebut.
User
sekarang menggunakan remote ke androidnya gimana
ChatGPT

Untuk mengontrol perangkat Android Anda dari komputer secara jarak jauh, Anda dapat menggunakan aplikasi remote desktop seperti TeamViewer atau AnyDesk. Berikut adalah langkah-langkah umum untuk mengontrol perangkat Android Anda dari komputer:

    Unduh dan instal aplikasi remote desktop di kedua perangkat, yaitu komputer Anda dan perangkat Android Anda. Misalnya, Anda dapat mengunduh dan menginstal TeamViewer di komputer dan perangkat Android.

User
saya sudah instal vino dan sudah atur preferensi selanjjutnya gmn
ChatGPT

Setelah Anda menginstal Vino dan mengatur preferensinya, langkah selanjutnya adalah mengaktifkan server VNC dan terhubung ke perangkat Android menggunakan aplikasi VNC Viewer. Berikut adalah langkah-langkah yang perlu Anda ikuti:

    Jalankan perintah berikut di Terminal untuk mengaktifkan server VNC:

    vncserver

    Anda akan diminta untuk memasukkan kata sandi VNC yang telah Anda atur sebelumnya. Masukkan kata sandi yang sesuai.

    Setelah server VNC aktif, Anda akan melihat nomor sesi VNC yang sedang berjalan, misalnya :1. Catat nomor sesi ini, karena Anda akan membutuhkannya untuk terhubung menggunakan VNC Viewer di perangkat Android.

    Selanjutnya, unduh dan instal aplikasi VNC Viewer di perangkat Android Anda melalui Google Play Store.

    Buka aplikasi VNC Viewer di perangkat Android Anda.

    Masukkan alamat IP komputer yang menjalankan server VNC dan nomor sesi VNC yang telah Anda catat sebelumnya dalam format IP_Komputer:Nomor_Sesi. Misalnya, 192.168.0.100:1.

    Tekan tombol "Connect" atau "Connect to Server" di aplikasi VNC Viewer.

    Anda akan diminta untuk memasukkan kata sandi VNC. Masukkan kata sandi yang telah Anda atur sebelumnya saat mengkonfigurasi Vino.

Setelah langkah-langkah ini, VNC Viewer akan terhubung ke server VNC di komputer Anda dan menampilkan desktop Kali Linux secara jarak jauh pada perangkat Android Anda.

Sekarang, Anda dapat mengontrol desktop Kali Linux menggunakan perangkat Android Anda melalui aplikasi VNC Viewer.

Perlu diingat bahwa untuk menggunakan VNC Viewer dari jaringan yang berbeda (misalnya, perangkat Android menggunakan jaringan seluler), Anda mungkin perlu mengonfigurasi port forwarding atau memastikan bahwa komputer Anda dapat diakses dari luar jaringan lokal Anda.
User
sudah masukin password yang sebenarnya dan masih authentcation failed
ChatGPT

Jika Anda mengalami masalah dengan autentikasi yang gagal saat mencoba menghubungkan VNC Viewer ke server VNC di komputer Anda, berikut adalah beberapa langkah yang dapat Anda coba:

    Pastikan bahwa Anda memasukkan kata sandi yang benar saat diminta oleh VNC Viewer. Pastikan tidak ada kesalahan pengetikan atau karakter yang terlewat.

    Periksa kembali pengaturan keamanan VNC pada server. Buka terminal dan jalankan perintah berikut untuk mengedit file konfigurasi VNC:

    javascript

    sudo nano ~/.vnc/config

    Periksa apakah opsi "Authentication" diatur dengan benar. Pastikan bahwa Anda menggunakan opsi yang sesuai dengan preferensi keamanan yang telah Anda atur sebelumnya.

    Periksa firewall di komputer Anda. Pastikan bahwa port yang digunakan oleh VNC (biasanya port 5900) tidak diblokir oleh firewall. Anda mungkin perlu mengonfigurasi firewall untuk mengizinkan koneksi VNC.

    Pastikan bahwa komputer Anda memiliki koneksi jaringan yang stabil. Jika koneksi jaringan tidak stabil atau terputus, itu dapat menyebabkan masalah autentikasi.

    Ulangi proses konfigurasi Vino dan pastikan bahwa Anda mengikuti langkah-langkah dengan benar. Jika terjadi kesalahan dalam pengaturan, itu dapat menyebabkan masalah autentikasi.

Jika Anda masih mengalami masalah autentikasi setelah mencoba langkah-langkah di atas, mungkin ada masalah lain yang perlu diperiksa, seperti versi perangkat lunak yang tidak kompatibel atau konflik dengan konfigurasi sistem lainnya. Dalam kasus seperti itu, Anda dapat mencari panduan yang lebih rinci atau mencari bantuan dari komunitas pengguna Kali Linux atau forum dukungan resmi VNC.
User
authentication failed padahal log nya seperti ini ‚îî‚îÄ# cat /root/.vnc/kali:3.log

25/05/23 22:04:31 Xvnc version TightVNC-1.3.10
25/05/23 22:04:31 Copyright (C) 2000-2009 TightVNC Group
25/05/23 22:04:31 Copyright (C) 1999 AT&T Laboratories Cambridge
25/05/23 22:04:31 All Rights Reserved.
25/05/23 22:04:31 See http://www.tightvnc.com/ for information on TightVNC
25/05/23 22:04:31 Desktop name 'X' (kali:3)
25/05/23 22:04:31 Protocol versions supported: 3.3, 3.7, 3.8, 3.7t, 3.8t
25/05/23 22:04:31 Listening for VNC connections on TCP port 5903
xrdb: No such file or directory
xrdb: can't open file '/root/.Xresources'
/usr/bin/startxfce4: X server already running on display :3

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.463: XSync extension too old (3.0).

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.463: The display does not support the XRender extension.

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.463: The display does not support the XRandr extension.

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.463: The display does not support the XRes extension.

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.463: The display does not support the XComposite extension.

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.463: The display does not support the XDamage extension.

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.463: The display does not support the XFixes extension.

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.464: The display does not support the XPresent extension.

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.464: Compositing manager disabled.
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Super>Down' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Super>Up' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Super>Tab' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Primary><Super>Down' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Super>Left' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Super>Right' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Primary><Super>Up' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Primary><Super>1' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Primary><Super>2' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Primary><Super>3' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Primary><Super>4' tidak didukung
xfwm4-Message: 22:04:36.945: Modifikasi papan tik '<Primary><Super>5' tidak didukung
xfwm4-Message: 22:04:36.946: Modifikasi papan tik '<Primary><Super>6' tidak didukung
xfwm4-Message: 22:04:36.946: Modifikasi papan tik '<Primary><Super>7' tidak didukung
xfwm4-Message: 22:04:36.946: Modifikasi papan tik '<Primary><Super>8' tidak didukung
xfwm4-Message: 22:04:36.946: Modifikasi papan tik '<Primary><Super>9' tidak didukung
xfwm4-Message: 22:04:36.946: Modifikasi papan tik '<Primary><Super>0' tidak didukung
xfwm4-Message: 22:04:36.961: Modifikasi papan tik '<Super>' tidak didukung

(xfwm4:9749): xfwm4-WARNING **: 22:04:36.962: Cannot find visual format on screen 0

(xfwm4:9749): GLib-CRITICAL **: 22:04:36.962: g_hash_table_destroy: assertion 'hash_table != NULL' failed

(xfsettingsd:9799): xfsettingsd-CRITICAL **: 22:04:37.102: No RANDR extension found in display :3. Display settings won't be applied.
Xlib:  extension "XInputExtension" missing on display ":3".

(xfsettingsd:9799): xfsettingsd-CRITICAL **: 22:04:37.102: XI is not present.

(xfsettingsd:9799): xfsettingsd-CRITICAL **: 22:04:37.102: Failed to initialize the Xkb extension.

(xfsettingsd:9799): xfsettingsd-CRITICAL **: 22:04:37.102: Failed to initialize the Accessibility extension.
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Super>Down' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Super>Up' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Super>Tab' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Primary><Super>Down' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Super>Left' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Super>Right' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Primary><Super>Up' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Primary><Super>1' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Primary><Super>2' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Primary><Super>3' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Primary><Super>4' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Primary><Super>5' tidak didukung
xfwm4-Message: 22:04:37.298: Modifikasi papan tik '<Primary><Super>6' tidak didukung
xfwm4-Message: 22:04:37.299: Modifikasi papan tik '<Primary><Super>7' tidak didukung
xfwm4-Message: 22:04:37.299: Modifikasi papan tik '<Primary><Super>8' tidak didukung
xfwm4-Message: 22:04:37.299: Modifikasi papan tik '<Primary><Super>9' tidak didukung
xfwm4-Message: 22:04:37.299: Modifikasi papan tik '<Primary><Super>0' tidak didukung
xfwm4-Message: 22:04:37.351: Modifikasi papan tik '<Super>' tidak didukung

** (wrapper-2.0:9848): WARNING **: 22:04:39.141: Binding 'XF86AudioLowerVolume' failed!

(wrapper-2.0:9848): pulseaudio-plugin-WARNING **: 22:04:39.141: Could not have grabbed volume control keys. Is another volume control application (xfce4-volumed) running?

** (wrapper-2.0:9848): WARNING **: 22:04:39.141: Binding 'XF86AudioPlay' failed!

(wrapper-2.0:9848): pulseaudio-plugin-WARNING **: 22:04:39.141: Could not have grabbed multimedia control keys.

** (wrapper-2.0:9850): WARNING **: 22:04:39.379: No XRANDR extension found
Xlib:  extension "RECORD" missing on display ":3.0".
Failed to obtain xrecord version
Kegagalan koneksi: Koneksi ditolak
pa_context_connect() gagal: Koneksi ditolak
Jurik notifikasi lain sedang berjalan, keluar

** (xiccd:9997): CRITICAL **: 22:04:40.173: RandR extension is not working on display :3.0
Xlib:  extension "DPMS" missing on display ":3.0".

(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.351: Monitor is not DPMS capable

(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ff2a to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ffa8 to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ffa7 to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ff2f to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ff02 to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ff03 to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ff93 to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ff05 to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: could not map keysym 1008ff06 to keycode


(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.671: No idle counter.

** (xfce4-power-manager:9965): WARNING **: 22:04:40.675: No XRANDR extension found

** (light-locker:10010): ERROR **: 22:04:40.693: Environment variable XDG_SESSION_PATH not set. Is LightDM running?

(xfce4-power-manager:9965): xfce4-power-manager-WARNING **: 22:04:40.701: Failed to get keyboard max brightness level : GDBus.Error:org.freedesktop.DBus.Error.UnknownMethod: Objek tidak ada di path "/org/freedesktop/UPower/KbdBacklight"
Cannot register authentication agent: GDBus.Error:org.freedesktop.PolicyKit1.Error.Failed: An authentication agent already exists for the given subject
blueman-applet 22.04.41 WARNING  PluginManager:151 __load_plugin: Not loading PPPSupport because its conflict has higher priority
blueman-applet 22.04.41 WARNING  PluginManager:151 __load_plugin: Not loading DhcpClient because its conflict has higher priority

25/05/23 22:04:48 Got connection from client 192.168.1.7
25/05/23 22:04:48 Using protocol version 3.8
25/05/23 22:05:16 rfbVncAuthProcessResponse: authentication failed from 192.168.1.7
25/05/23 22:05:16 Client 192.168.1.7 gone
25/05/23 22:05:16 Statistics:
25/05/23 22:05:16   framebuffer updates 0, rectangles 0, bytes 0

25/05/23 22:05:19 Got connection from client 192.168.1.7
25/05/23 22:05:19 Using protocol version 3.8
ChatGPT

Berdasarkan log yang Anda berikan, tampaknya ada masalah dengan proses otentikasi pada VNC
 server. Log tersebut mencatat bahwa autentikasi gagal dari alamat IP 192.168.1.7. Ini menunjukkan bahwa VNC server menolak koneksi karena masalah autentikasi.

Beberapa hal yang dapat Anda coba untuk mengatasi masalah ini:

    Pastikan bahwa Anda menggunakan password yang benar saat mencoba melakukan autentikasi. Periksa kembali password yang Anda gunakan dan pastikan tidak ada kesalahan pengetikan.

    Pastikan bahwa pengguna yang Anda gunakan untuk masuk ke VNC server memiliki izin yang benar. Kadang-kadang masalah autentikasi dapat terjadi jika pengguna tidak memiliki izin yang cukup untuk mengakses VNC server.

    Periksa pengaturan keamanan VNC server. Mungkin ada pengaturan keamanan yang membatasi akses atau memerlukan konfigurasi tambahan untuk autentikasi yang berhasil. Periksa dokumentasi VNC server yang Anda gunakan untuk informasi lebih lanjut tentang pengaturan keamanan.

Jika Anda sudah mencoba langkah-langkah di atas dan masih mengalami masalah autentikasi, mungkin ada masalah lain yang perlu diidentifikasi. Anda dapat mencoba mencari solusi di forum atau sumber daya komunitas lainnya yang berfokus pada VNC server yang Anda gunakan atau menghubungi tim dukungan teknis mereka untuk mendapatkan bantuan lebih lanjut.
User
bantu saya poin no 2 dan no 3
ChatGPT

Tentu! Berikut adalah bantuan untuk poin nomor 2 dan 3:

    "xfce4 power manager failed" - Ini menunjukkan adanya masalah dengan manajer daya XFCE4. Beberapa pesan kesalahan yang Anda lihat menunjukkan bahwa beberapa fungsi dan pengaturan tidak dapat diinisialisasi atau tidak didukung. Untuk memperbaikinya, Anda dapat mencoba langkah-langkah berikut:
        Pastikan Anda menggunakan versi yang kompatibel dari manajer daya XFCE4 dengan sistem operasi Kali Linux Anda. Anda dapat memeriksa pembaruan dan memperbarui paket xfce4-power-manager jika diperlukan.
        Periksa apakah ada kesalahan konfigurasi dalam pengaturan manajer daya. Anda dapat membuka pengaturan daya XFCE4 dan memeriksa pengaturan seperti jadwal mati otomatis, pengaturan layar, dan pengaturan daya lainnya.
        Periksa apakah ada konflik dengan aplikasi lain yang mengendalikan manajemen daya. Anda dapat memeriksa daftar aplikasi yang berjalan dan memastikan tidak ada aplikasi lain yang mengganggu fungsi manajer daya XFCE4.
        Coba restart manajer daya XFCE4 atau restart sistem secara keseluruhan untuk memperbarui pengaturan dan mengatasi masalah yang mungkin terjadi.

    "Authentication failed" - Pesan kesalahan ini muncul ketika ada kegagalan autentikasi saat mencoba menghubungkan ke VNC server. Beberapa alasan umum untuk kegagalan autentikasi adalah:
        Username dan/atau password yang salah: Pastikan Anda menggunakan username dan password yang benar saat mencoba mengautentikasi. Periksa kembali username dan password yang telah Anda atur dan pastikan tidak ada kesalahan pengetikan atau karakter yang tidak sesuai.
        Konfigurasi autentikasi yang salah: Periksa pengaturan autentikasi VNC server Anda dan pastikan Anda telah mengkonfigurasi autentikasi yang benar, seperti menggunakan metode autentikasi yang didukung oleh VNC server dan klien yang Anda gunakan.
        Firewall atau aturan jaringan yang memblokir koneksi: Pastikan tidak ada aturan firewall atau konfigurasi jaringan lain yang memblokir koneksi ke VNC server. Periksa pengaturan firewall atau jaringan Anda dan pastikan akses ke port yang benar (dalam kasus ini, port 5903) tidak diblokir.
        Masalah pada server VNC: Ada kemungkinan ada masalah pada server VNC itu sendiri. Pastikan server VNC berjalan dengan benar dan tidak ada masalah konfigurasi atau izin yang menghalangi autentikasi yang berhasil.

Harap dicatat bahwa pesan log yang Anda berikan hanya mencantumkan autentikasi yang gagal sebagai informasi terkait masalah autentikasi. Jika masalah persisten setelah memeriksa langkah-langkah di atas, Anda mungkin perlu memeriksa konfigurasi VNC server secara lebih rinci dan melihat log yang lebih lengkap untuk mendapatkan pemahaman yang lebih baik tentang masalahnya.
User
cek username
ChatGPT

Maaf, sebagai model bahasa AI, saya tidak memiliki akses langsung ke sistem atau informasi pribadi pengguna. Oleh karena itu, saya tidak dapat memeriksa atau memvalidasi username Anda. Periksa kembali username yang Anda masukkan untuk memastikan bahwa itu adalah username yang benar dan sesuai dengan sistem yang Anda gunakan. Jika Anda mengalami masalah autentikasi, pastikan Anda memasukkan username dan password dengan benar sesuai dengan akun yang telah Anda daftarkan. Jika Anda masih mengalami kesulitan, disarankan untuk menghubungi administrator sistem atau penyedia layanan yang relevan untuk mendapatkan bantuan lebih lanjut.
User
kamu bilang tadi cek username gimana caranya
ChatGPT

Maaf atas kekeliruan saya sebelumnya. Jika Anda ingin memeriksa apakah username tertentu tersedia atau valid, Anda dapat mencoba beberapa langkah berikut:

    Cek di sistem lokal: Jika Anda ingin memeriksa apakah username tersebut tersedia di sistem tempat Anda sedang berada, Anda bisa mencoba menggunakan perintah "grep" di terminal dengan menjalankan perintah berikut:

    bash

grep 'username' /etc/passwd

Ganti 'username' dengan username yang ingin Anda periksa. Jika perintah tersebut tidak menampilkan hasil apa pun, itu berarti username tersebut tidak ditemukan di sistem lokal.

Cek di database pengguna: Jika Anda menggunakan sistem manajemen pengguna seperti database pengguna, Anda dapat menggunakan perintah SQL untuk memeriksa keberadaan username. Perintah SQL berikut dapat Anda gunakan:

sql

    SELECT * FROM users WHERE username = 'username';

    Ganti 'users' dengan nama tabel pengguna yang sesuai dan 'username' dengan username yang ingin Anda periksa.

    Cek di layanan online: Beberapa layanan online menyediakan alat untuk memeriksa ketersediaan username di platform mereka. Misalnya, beberapa platform media sosial atau situs web komunitas memiliki fitur pengecekan ketersediaan username. Anda dapat mencari layanan semacam itu dan menggunakan alat mereka untuk memeriksa username yang Anda inginkan.

Perlu diingat bahwa cara untuk memeriksa username dapat bervariasi tergantung pada sistem atau layanan yang Anda gunakan. Jika Anda mengalami kesulitan atau memerlukan bantuan lebih lanjut, disarankan untuk menghubungi administrator sistem atau penyedia layanan yang relevan untuk mendapatkan panduan yang tepat.
User
yang ini gimana cara cek usernamenya di terminal "Authentication failed" - Pesan kesalahan ini muncul ketika ada kegagalan autentikasi saat mencoba menghubungkan ke VNC server. Beberapa alasan umum untuk kegagalan autentikasi adalah:

    Username dan/atau password yang salah: Pastikan Anda menggunakan username dan password yang benar saat mencoba mengautentikasi. Periksa kembali username dan password yang telah Anda atur dan pastikan tidak ada kesalahan pengetikan atau karakter yang tidak sesuai.
ChatGPT

Untuk memeriksa apakah username dan password yang Anda gunakan benar saat mencoba mengautentikasi di VNC server, Anda dapat melakukan beberapa langkah berikut di terminal:

    Pastikan Anda mengetikkan username dan password dengan benar: Periksa kembali username dan password yang Anda masukkan. Pastikan tidak ada kesalahan pengetikan atau karakter yang salah. Pastikan juga Anda menggunakan huruf kapital dan huruf kecil dengan benar, karena autentikasi biasanya bersifat case-sensitive.

    Coba masuk dengan username dan password yang dikenal: Jika Anda memiliki informasi akun pengguna yang valid, coba masuk menggunakan username dan password tersebut. Misalnya, jika Anda memiliki akun root atau akun pengguna lain yang dikenal, coba gunakan informasi tersebut untuk autentikasi.

    Periksa kebijakan keamanan: Beberapa sistem memiliki kebijakan keamanan yang membatasi autentikasi yang berhasil dari jarak jauh. Pastikan bahwa VNC server diizinkan untuk menerima koneksi dan autentikasi dari komputer Anda. Anda mungkin perlu memeriksa konfigurasi firewall, izin akses, atau peng

User
bagaimana cara cek username di terminal utk vnc
ChatGPT

Untuk memeriksa daftar username yang tersedia di VNC server melalui terminal, Anda dapat menggunakan perintah vncserverlist. Berikut adalah langkah-langkahnya:

    Buka terminal di sistem Anda.

    Ketik perintah berikut dan tekan Enter:

    vncserverlist

    Perintah ini akan menampilkan daftar username yang memiliki sesi VNC aktif pada server.

Jika Anda menghadapi masalah autentikasi dan ingin memeriksa apakah username yang Anda gunakan terdaftar, perintah ini dapat memberikan informasi tentang username yang sedang aktif pada server VNC. Namun, perintah ini mungkin memerlukan izin superuser (root) untuk dijalankan, tergantung pada pengaturan dan konfigurasi server Anda.
User
‚îî‚îÄ# vncserverlist

vncserverlist: perintah tidak ditemukan
gimana solusi
ChatGPT

Jika perintah vncserverlist tidak ditemukan, mungkin itu bukan perintah yang tersedia di sistem Anda. Beberapa distribusi Linux menggunakan perintah yang berbeda untuk mengelola server VNC.

Anda dapat mencoba menggunakan perintah ps untuk memeriksa daftar proses yang terkait dengan server VNC. Berikut adalah langkah-langkahnya:

    Buka terminal di sistem Anda.

    Ketik perintah berikut dan tekan Enter:

    perl

    ps -ef | grep Xtightvnc

    Perintah ini akan menampilkan daftar proses yang terkait dengan server VNC.

    Jika Anda menggunakan server VNC lainnya, seperti TigerVNC, perintahnya bisa sedikit berbeda. Misalnya, jika Anda menggunakan TigerVNC, Anda dapat mengganti Xtightvnc dengan Xvnc dalam perintah di atas.

    Jika tidak ada output yang ditampilkan setelah menjalankan perintah di atas, kemungkinan besar tidak ada sesi VNC yang sedang berjalan di sistem Anda.

Harap dicatat bahwa perintah di atas hanya memberikan informasi tentang proses server VNC yang berjalan. Untuk autentikasi username dan password yang digunakan dalam VNC, Anda mungkin perlu mengacu pada dokumentasi spesifik dari server VNC yang Anda gunakan atau menghubungi administrator sistem yang bertanggung jawab atas pengaturan VNC di server Anda.
User
 
‚îå‚îÄ‚îÄ(root„âøkali)-[/home/mixue]
‚îî‚îÄ# ps -ef | grep Xtightvnc

root      3445 22244  0 22:15 pts/1    00:00:00 grep --color=auto Xtightvnc
root      9554     1  8 22:04 pts/1    00:00:57 Xtightvnc :3 -desktop X -auth /home/mixue/.Xauthority -geometry 1024x768 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5903 -fp /usr/share/fonts/X11/misc/,/usr/share/fonts/X11/Type1/,/usr/share/fonts/X11/75dpi/,/usr/share/fonts/X11/100dpi/ -co /etc/X11/rgb
root     28471     1  8 21:56 pts/1    00:01:36 Xtightvnc :1 -desktop X -auth /home/mixue/.Xauthority -geometry 1024x768 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5901 -fp /usr/share/fonts/X11/misc/,/usr/share/fonts/X11/Type1/,/usr/share/fonts/X11/75dpi/,/usr/share/fonts/X11/100dpi/ -co /etc/X11/rgb
root     31358     1  7 21:58 pts/1    00:01:21 Xtightvnc :2 -desktop X -auth /home/mixue/.Xauthority -geometry 1024x768 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5902 -fp /usr/share/fonts/X11/misc/,/usr/share/fonts/X11/Type1/,/usr/share/fonts/X11/75dpi/,/usr/share/fonts/X11/100dpi/ -co /etc/X11/rgb
itu hasilnya, mana usernamenya
ChatGPT

Berdasarkan output yang Anda berikan, terdapat tiga sesi VNC yang sedang berjalan dengan username "root". Setiap sesi VNC ditampilkan dengan baris yang dimulai dengan Xtightvnc.

Berikut adalah detail dari setiap sesi VNC:

    Sesuaikan dengan nomor sesi VNC yang Anda inginkan:
        Sesuaikan dengan nomor :3: root 9554 1 8 22:04 pts/1 00:00:57 Xtightvnc :3 -desktop X -auth /home/mixue/.Xauthority -geometry 1024x768 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5903 -fp /usr/share/fonts/X11/misc/,/usr/share/fonts/X11/Type1/,/usr/share/fonts/X11/75dpi/,/usr/share/fonts/X11/100dpi/ -co /etc/X11/rgb
        Sesuaikan dengan nomor :1: root 28471 1 8 21:56 pts/1 00:01:36 Xtightvnc :1 -desktop X -auth /home/mixue/.Xauthority -geometry 1024x768 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5901 -fp /usr/share/fonts/X11/misc/,/usr/share/fonts/X11/Type1/,/usr/share/fonts/X11/75dpi/,/usr/share/fonts/X11/100dpi/ -co /etc/X11/rgb
        Sesuaikan dengan nomor :2: root 31358 1 7 21:58 pts/1 00:01:21 Xtightvnc :2 -desktop X -auth /home/mixue/.Xauthority -geometry 1024x768 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5902 -fp /usr/share/fonts/X11/misc/,/usr/share/fonts/X11/Type1/,/usr/share/fonts/X11/75dpi/,/usr/share/fonts/X11/100dpi/ -co /etc/X11/rgb

Dalam hal ini, username yang digunakan adalah "root" untuk setiap sesi VNC yang berjalan.
User
cara matikan sesi vncserver
ChatGPT

Untuk mematikan sesi VNC server, Anda dapat menggunakan perintah vncserver -kill :<nomor_sesi>. Nomor sesi tersebut harus sesuai dengan sesi VNC yang ingin Anda matikan.

Dalam contoh yang Anda berikan sebelumnya, Anda memiliki tiga sesi VNC dengan nomor :3, :1, dan :2. Jadi, berikut adalah perintah untuk mematikan setiap sesi:

    Matikan sesi VNC :3:

    bash

vncserver -kill :3

Matikan sesi VNC :1:

bash

vncserver -kill :1

Matikan sesi VNC :2:

bash

    vncserver -kill :2

Pastikan Anda menjalankan perintah di terminal dengan hak akses yang sesuai (misalnya, sebagai pengguna root atau dengan menggunakan sudo). Perintah ini akan menghentikan sesi VNC yang terkait dan menghentikan server VNC untuk sesi tersebut.
Free Research Preview. ChatGPT may produce inaccurate information about people, places, or facts. ChatGPT May 12 Version




//////////vnc server mixue////
username bebas
pass sama dgn mixue tapi huruf kapital

jangan lupa port log nya misal :1 atau :2
-------------------------------------



Untuk menyimpan kredensial Git di Kali Linux agar tidak perlu memasukkan password setiap saat, Anda dapat menggunakan utilitas yang disebut "git credential store" atau "git credential helper". Ini akan menyimpan kredensial Git Anda dalam penyimpanan yang aman dan mengambilnya secara otomatis saat diperlukan. Berikut adalah langkah-langkahnya:

1. Pastikan Anda telah menginstal Git di Kali Linux. Jika belum, Anda dapat menginstalnya dengan perintah berikut:

   
   sudo apt update
   sudo apt install git
   

2. Selanjutnya, Anda perlu mengatur git credential helper untuk menyimpan kredensial. Salah satu pilihan yang umum adalah menggunakan `git-credential-store` dengan perintah berikut:

   
   git config --global credential.helper store
   

   Perintah ini mengatur git-credential-store sebagai helper yang akan digunakan untuk menyimpan dan mengambil kredensial.

3. Setelah itu, Anda dapat melakukan push atau pull pada repositori Git tanpa diminta password. Git akan menyimpan kredensial Anda di penyimpanan lokal yang aman.

   
   git push
   git pull
   

   Ketika Anda melakukan operasi ini untuk pertama kalinya setelah mengatur git credential helper, Git akan meminta Anda untuk memasukkan kredensial Anda (nama pengguna dan kata sandi). Setelah itu, kredensial akan disimpan dan diambil secara otomatis untuk operasi selanjutnya.

Dengan langkah-langkah di atas, kredensial Git Anda akan disimpan secara aman di Kali Linux, dan Anda tidak perlu memasukkan password setiap kali melakukan operasi Git




-------------
3 juni


npwp terbaru sarwonosatrio9@gmail.com 
pasword @Lupuslupus123

.



Notifikasi NPWP 
Anda telah terdaftar sebagai Wajib Pajak di Direktorat Jenderal Pajak dengan Nomor Pokok Wajib Pajak(NPWP) 391359148124000
di KPP Pratama Medan Petisah
KPP tempat terdaftar Anda akan segera menelit kebenaran dan kelengkapan dokumen persyaratan yang Anda sampaikan. Apabila terdapat data dan dokumen yang masih memerlukan penjelasan dan/atau kelengkapan, KPP tempat terdaftar Anda akan menyampaikan permberitahuan.
Informasi di atas juga dikirimkan via e-mail sesual dengan alamat e-mail yang terdaftar di aplikasi ini.
Username anda telah diganti menjadi 391359148124000
untuk meningkatkan layanan kami, dimohon kesediaannya mengikuti survey onlinei layanan pendaftaran
Lewatkan
Ikut Survel




github gandamana pass: sama dengan github gilagilagila



-----------------------------------
14 juli 2023

doorsmeerhappy@gmail.com
04Juli2018




pemilik laptop sebelumnya
www.tiktok.com/@mimoyyzz



---------


sudo apt update
sudo apt install python3-pip
sudo apt install git
sudo apt install python3-dev

cara harve

04Juli2018




-------------------------


ChatGPT
Saya tidak melihat kesalahan sintaksis yang jelas dalam program tersebut. Namun, ada beberapa hal yang perlu diperhatikan:

Pastikan Anda telah memastikan bahwa file config_connect.php ada dan berisi koneksi yang valid ke database.

Pastikan format tanggal yang digunakan dalam klausa LIKE adalah format yang benar. Misalnya, jika format tanggal di kolom "tglmasuk" adalah "YYYY-MM-DD", maka Anda harus memastikan bahwa variabel $bulansekarang dan $harisekarang memiliki format "MM" dan "DD" yang valid. Anda dapat memeriksa nilai yang disimpan dalam variabel tersebut dengan echo $bulansekarang; dan echo $harisekarang; untuk memastikan formatnya benar.

Pastikan tabel dan kolom yang digunakan dalam kueri SQL sudah sesuai dengan struktur database Anda. Jika terjadi perubahan pada struktur database, pastikan kueri SQL yang Anda gunakan masih sesuai.

Pastikan tabel dan kolom yang digunakan dalam kueri SQL sudah ada dan berisi data. Jika tabel atau kolom yang diacu tidak ada atau kosong, maka kueri SQL tidak akan mengembalikan hasil yang diharapkan.

Pastikan Anda telah melakukan sanitasi input dan memastikan bahwa nilai yang digunakan dalam kueri SQL aman untuk menghindari serangan SQL injection.

Untuk menemukan kesalahan yang lebih spesifik, Anda dapat menambahkan pernyataan echo mysqli_error($conn); setelah setiap pemanggilan mysqli_query() untuk menampilkan pesan kesalahan dari database jika ada. Dengan cara ini, Anda dapat memperoleh informasi yang lebih rinci tentang masalah yang mungkin terjadi dalam kueri SQL.



----------------------------------
24 juli





















-------------------
31 agustus 

akun oss gandatech 

sarwonosatrio7@gmail.com
pass (seperti biasa turbo turbo)






-------------------
2 september

brimo Mama 
ruslanparhusip123
pass: Villanusab17




==================
8sept 2024

github gandamanasibagaring@gmail.com pass jujurberani999
instagram gandatech_solution pass: redsisu





----------------------
21 november
akun kemenaker 
sarwonosatrio7@gmail.com pass @Tturboturbo123

akun npwp djp
NIK + @Lupuslupus123


ssh-keygen -b 4096




--------------------
14 desember

report harian: 
-tidak ada pelanggan
-ada truk parkir karena mogok di depan kantor  makanya tertutup usaha di pagi hari
-marketing masih perlu di pikirkan seperti selebaran atau ads 
-sedang memperbaiki web gandatech.shop tp terkendala di akses server ssh jadi lg di pelajari

Solusi: Berikut adalah beberapa solusi  
    Tidak Ada Pelanggan:
        Fokus pada pemasaran untuk menarik lebih banyak pelanggan. Bisa mencoba promosi online melalui media sosial, iklan Google, atau bahkan membagikan selebaran di area strategis.
        Menyusun program referral atau diskon untuk pelanggan yang merekomendasikan layanan Anda kepada orang lain.

    Truk Mogok di Depan Kantor:
        Cobalah berkomunikasi dengan pihak yang memiliki truk tersebut untuk segera mengatasi masalahnya, atau cari cara untuk mengatur jalur akses alternatif ke kantor Anda.
        Jika masalah terus berlanjut, bisa mempertimbangkan untuk mencari lokasi lain untuk parkir yang tidak menghalangi akses kantor.

    Marketing Masih Perlu Perhatian:
        Selain selebaran, coba untuk membuat iklan online melalui Google Ads atau Facebook Ads yang bisa lebih tertarget.
        Kolaborasi dengan bisnis lokal atau influencer untuk meningkatkan visibilitas usaha Anda.
        Membangun konten blog atau tutorial di website untuk mendatangkan traffic yang lebih banyak.

    Perbaikan Website dan Akses SSH:
        Untuk masalah SSH, pastikan bahwa IP atau domain server yang Anda tuju benar dan Anda memiliki akses jaringan yang stabil.
        Jika akses SSH terus bermasalah, Anda bisa mencoba memeriksa firewall atau meminta bantuan dari penyedia layanan hosting.
        Gunakan juga metode lain untuk mengakses server, seperti menggunakan panel kontrol hosting jika ada.




-----------------------------------
23 desember

-belajar java aps development desktop
-cara dual booting di latop

---------------------------
2 januari

Berikut langkah-langkah untuk menginstal **Balena Etcher** di Ubuntu menggunakan terminal:

### 1. Tambahkan Repository Balena Etcher
Balena Etcher menyediakan repositori APT resmi yang memudahkan instalasi dan pembaruan.

#### a. Tambahkan Kunci GPG
```bash
sudo apt update
sudo apt install -y wget apt-transport-https
wget -qO - https://balena.io/etcher/gpg.key | sudo gpg --dearmor -o /usr/share/keyrings/balena-etcher.gpg
```

#### b. Tambahkan Repositori ke Daftar Sumber
```bash
echo "deb [signed-by=/usr/share/keyrings/balena-etcher.gpg] https://deb.etcher.io stable etcher" | sudo tee /etc/apt/sources.list.d/balena-etcher.list
```

### 2. Perbarui Daftar Paket
```bash
sudo apt update
```

### 3. Instal Balena Etcher
```bash
sudo apt install -y balena-etcher-electron
```

### 4. Verifikasi Instalasi
Setelah instalasi selesai, Anda dapat menjalankan **Balena Etcher** dengan mengetik:
```bash
balena-etcher-electron
```

Jika ikon aplikasi tidak muncul, Anda juga bisa mencari **"Etcher"** melalui menu aplikasi.

### Alternatif: Instal melalui File AppImage
Jika tidak ingin menambahkan repositori, Anda bisa menggunakan file AppImage:
1. Unduh file AppImage terbaru dari [situs resmi Balena Etcher](https://balena.io/etcher).
2. Ubah izin file agar dapat dieksekusi:
   ```bash
   chmod +x balena-etcher-*.AppImage
   ```
3. Jalankan aplikasi:
   ```bash
   ./balena-etcher-*.AppImage
   ```

Selamat mencoba! üéâ


--------------------------------------
21 januari 2025

pembuatan program visual basic untuk gkpi

-harus tau file file yg terhubung
-harus tau kode tiap mata anggaran


-(JURNAL PENGELUARAN JEMAAT) jika bulan baru akan membuat field baru
-(BUKU BESAR PENGELUARAN JEMAAT) harus tau logika if bulan baru pasti membuat template baru jadi harus di copas, jika kolom next month kosong maka field nya harus terisi otomatis
-harus tau lokasi atau xy masing masing yang mau di tarik dari mana dan kemana



Buku Pengeluaran Jemaat
opsi mata anggaran: 
200. ADMINISTRASI GEREJA
200.01. Tunjangan & Pengganti Transport
01.01. Pendeta Pimpinan Jemaat
01.02. Vicaris dan Pendeta Khusus
01.03. Guru Jemaat
01.04. Sekretaris dan Bendahara
01.05. Pegawai Kantor
01.06. Pegawai Kebersihan & Keamanan
400. BIAYA OPERASIONAL
400.01. Biaya Listrik, Air & Telepon
400.02. Biaya ATK & Fotocopy
400.03. Biaya Pemeliharaan Inventaris
400.04. Biaya Pemeliharaan Gedung
400.05. Biaya Rapat-rapat
400.06. Biaya Transportasi & BBM
400.07. Biaya Konsumsi
400.08. Biaya Pengadaan Inventaris
400.09. Biaya Internet
400.10. Biaya Asuransi
400.11. Biaya Bank
400.12. Biaya Lain-lain
600. PELAYANAN
600.01. Pelayanan Ibadah
01.01. Ibadah Minggu
01.02. Ibadah Kategorial
01.03. Ibadah Khusus
600.02. Pelayanan Pastoral
600.03. Pelayanan Perkunjungan
600.04. Pelayanan Diakonia
600.05. Pelayanan Pembinaan
600.06. Pelayanan Musik Gereja
600.07. Pelayanan Multimedia
600.08. Pelayanan Hari-hari Besar Gereja
600.09. Pelayanan Sosial
600.10. Dana Partisipasi
800. BINGKISAN/TUNJANGAN HARI RAYA
800.01. Bingkisan Natal
01.01. Pendeta
01.02. Penatua
01.03. Pegawai
01.04. Guru Sekolah Minggu
01.05. Pemusik
01.06. Songleader
01.07. Petugas Lainnya
800.02. Tunjangan Hari Raya
800.03. Bingkisan untuk Petugas/Pelayan





admingandatech
password: @Turboturbo123


---------------------
23 januari 2025


untuk this workbook file vba:
Private Sub Workbook_Open()
    ' Masukkan kode yang ingin dijalankan saat workbook dibuka
    MsgBox "Selamat datang! Program VBA sedang berjalan!"
    ' Contoh jika ingin memanggil subrutin dari module
    Call CopyDataToSheet2 ' Sesuaikan dengan subrutin Anda
End Sub








input_form.py:



import tkinter as tk
from tkinter import ttk, messagebox
from datetime import datetime
import os
import win32com.client as win32

class InputForm:
    def __init__(self, root):
        self.root = root
        self.root.title("Form Input & Pencarian Pengeluaran")
        
        # Data Kategori
        self.kategori = {
            "200 - ADMINISTRASI GEREJA": [
                "200.01.01 - Pendeta Pimpinan Jemaat",
                "200.01.02 - Vicaris dan Pendeta Khusus",
                "200.01.03 - Guru Jemaat", 
                "200.01.04 - Sekretaris dan Bendahara Jemaat",
                "200.01.05.a - Pegawai Kantor (Administrasi): 2 orang",
                "200.01.06.a - Pegawai Kebersihan Gedung Gereja: 1 orang",
                "200.01.06.b - Pegawai Kebersihan Pekarangan Gereja: 1 orang",
                "200.01.06.c1 - Pegawai Supir Mobil Dinas & Ambulance",
                "200.01.06.c2 - Pegawai Jaga Malam",
                "200.01.06.d - Pegawai Kebersihan Gedung Multifungsi",
                "200.01.06.e - Pegawai Soundman",
                "200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)",
                "200.01.08 - Pengawas Parkir Gereja (Minggu & Hari Besar)",
                "200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan",
                "200.02.02 - Rapat dan Pertemuan Majelis Jemaat",
                "200.02.03 - Insentif/Lembur Pegawai",
                "200.02.04.a - Minum & Konsumsi Kantor, Jemaat",
                "200.02.04.b - Biaya Makan Tamu Gereja",
                "200.02.04.c - Biaya Snack untuk Pemusik & Songleader",
                "200.02.05 - Penyediaan Kolportase",
                "200.02.06 - Transport, Kurir, Benda Pos",
                "200.03.01.a - Snack dan minuman sermon penatua",
                "200.03.01.b - Penyediaan makanan pembukaan dan penutupan sermon penatua",
                "200.03.02 - Dana Pembinaan untuk Paduan Suara",
                "200.03.03.a - Syukuran Awal Tahun (Jemaat & Pendeta)",
                "200.03.03.b - Snack Kebaktian Awal Tahun Gereja",
                "200.03.03.c - Snack Paskah dan Buha-Buha Ijuk",
                "200.03.04 - Krans Bunga Dukacita bagi Anggota Jemaat",
                "200.03.05 - Bantuan Dukacita bagi Anggota Jemaat",
                "200.03.06.a - Bunga altar pada Kebaktian Minggu",
                "200.03.06.b - Dekorasi pada Kebaktian Hari Besar Kristen",
                "200.03.07 - Keamanan Acara Hari Besar Kristen",
                "200.03.08.a - Kontribusi & Registrasi Peserta Rapat Pendeta",
                "200.03.08.b - Perjalanan Dinas Peserta Rapat Pendeta (2 pendeta)",
                "200.03.09 - Perjalanan Dinas atas undangan Kantor Pusat",
                "200.03.10 - Sidang Umum Jemaat",
                "200.03.11.a - Biaya Tak Terduga (Pengurusan Sertifikat Tanah)",
                "200.03.11.b - Biaya Tak Terduga/Insidentil",
                "200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan",
                "200.04.02 - Inventaris Gereja",
                "200.05.01.a - Kijang Innova, Plat BK 1757 EJ",
                "200.05.01.b - Pajak Kendaraan Kijang Innova",
                "200.05.02.a - HIACE BK.7866 DP",
                "200.05.02.b - Pajak Kendaraan HIACE",
                "200.05.03.a - Roda 2: 1 unit, Plat BK. 5440 AGG",
                "200.05.03.b - Pajak Kendaraan Roda 2",
                "200.06.01 - Telepon, Speedy, MyRepublik dan WA",
                "200.07.01 - Jubah Penatua (Upah Jahit)",
                "200.07.02 - Peralatan & Perlengkapan Inventaris Gereja",
                "200.07.03 - Dekorasi dan Persiapan Natal"
            ],
            
            "400 - PELAYANAN IBADAH": [
                "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI",
                "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota",
                "400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota",
                "400.01.04 - Pengkhotbah Minggu: Di Rumah Duka (Oleh Pendeta)",
                "400.01.05 - Pengkhotbah Minggu: Remaja",
                "400.02.01 - Pengkhotbah Kebaktian di Lingkungan (Wijk)",
                "400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi/Remaja & GSM",
                "400.02.03 - Pengkhotbah Kebaktian Koor Ibu-Ibu",
                "400.02.04 - Pengkhotbah Kebaktian Ibu Hanna",
                "400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)",
                "400.03.01 - Pengkhotbah Perjanjian/Pemberkatan Nikah",
                "400.03.02 - Pengkhotbah Penguburan Jenazah",
                "400.03.03 - Pengkhotbah di Rumah Duka (Oleh Penatua)",
                "400.04.01 - Minggu Pagi 08.00 WIB (@ 13 Orang)",
                "400.04.02 - Minggu Sore: Pukul 18.00 WIB (@ 13 Orang)",
                "400.04.03 - Sekolah Minggu dan Remaja",
                "400.04.04 - Perjanjian/Pemberkatan Pernikahan",
                "400.04.05 - Kebaktian pemberangkatan jenazah",
                "400.04.06 - Minggu Di Rumah Duka",
                "400.04.07 - Pelayanan di Rumah Duka",
                "400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)",
                "400.04.09 - Latihan Pemusik dan Songleader",
                "400.04.10 - Petugas Penghitung Kebaktian Minggu",
                "400.05.01 - Perjamuan Kudus di Gereja",
                "400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi",
                "400.06.01 - Perayaan HUT Jemaat"
            ],

            "600 - PEMBINAAN & PELAYANAN": [
                "600.01.01 - Pendidikan Lanjutan untuk Pendeta",
                "600.01.02 - Penghargaan untuk Penatua",
                "600.01.03 - Pembinaan & Pelatihan Pelajar Sidi",
                "600.01.04 - Pembinaan Penatua se Resort Medan Barat",
                "600.02.01 - Pembinaan & Pelayan Rohani (PPR)",
                "600.02.02 - Pekabaran Injil",
                "600.02.03 - Diakoni Sosial",
                "600.02.04 - Musik, Nyanyian & Koor (MNK)",
                "600.02.05 - Sekolah Minggu",
                "600.02.06 - Remaja",
                "600.02.07 - Pemuda",
                "600.02.08 - Perempuan",
                "600.02.09 - Pria",
                "600.02.10 - Lansia",
                "600.02.11 - Kesehatan",
                "600.02.12 - Pendidikan",
                "600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)",
                "600.02.14 - Sarana & Prasarana",
                "600.02.15 - Natal Gabungan Seksi-Seksi (Natal II)",
                "600.03.01 - Target Ke Kantor Pusat GKPI",
                "600.03.02 - Biaya Tahun Renstra GKPI 2023",
                "600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)",
                "600.04.01 - Target Ke GKPI Resort Medan Barat"
            ],

            "800 - BANTUAN & TUNJANGAN": [
                "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam",
                "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka",
                "800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI",
                "800.01.04 - Bantuan untuk PA. Mamre dan Yapentra",
                "800.01.05 - Bantuan Ke GKPI Lainnya",
                "800.01.06 - Bantuan Kepada Masyarakat di sekitar",
                "800.02.01 - Sekolah Minggu",
                "800.02.02 - Penatua Purna Bakti",
                "800.02.03 - Penatua Aktif",
                "800.02.04 - Calon Penatua Aktif",
                "800.02.05 - Pendeta GKPI Resort Medan Barat",
                "800.02.06 - Anggota Majelis Jemaat: Ketua Seksi & Penasehat",
                "800.02.07 - Guru-Guru Koor di Jemaat",
                "800.02.08 - Guru-Guru Sekolah Minggu",
                "800.02.09 - Pemusik: Pianis, Organis dan Saxophonis",
                "800.02.10 - Songleader",
                "800.02.11 - Petugas Live Streaming"
            ]
        }
        
        # Excel file path
        self.excel_file = 'JURNAL PENGELUARAN JEMAAT 2024.xls'
        self.sheet_name = 'JUR PENGEL JEMAAT 2024'
        
        # Tambahkan sheet untuk pencarian
        self.sheet_pencarian = 'BUKU BESAR'
        
        self.create_widgets()
        
    def create_widgets(self):
        # Buat notebook/tab untuk memisahkan form input dan pencarian
        self.notebook = ttk.Notebook(self.root)
        self.notebook.grid(row=0, column=0, padx=5, pady=5)
        
        # Tab untuk input data
        self.input_frame = ttk.Frame(self.notebook)
        self.notebook.add(self.input_frame, text='Input Data')
        
        # Tab untuk pencarian
        self.search_frame = ttk.Frame(self.notebook)
        self.notebook.add(self.search_frame, text='Pencarian')
        
        # Buat widget form input seperti sebelumnya tapi gunakan input_frame sebagai parent
        self.create_input_widgets()
        
        # Buat widget pencarian
        self.create_search_widgets()

    def create_input_widgets(self):
        # Tanggal
        ttk.Label(self.input_frame, text="Tanggal (DD-MMM-YY):").grid(row=0, column=0, padx=5, pady=5, sticky='w')
        self.tanggal_entry = ttk.Entry(self.input_frame, width=40)
        self.tanggal_entry.grid(row=0, column=1, padx=5, pady=5)
        self.tanggal_entry.insert(0, datetime.now().strftime('%d-%b-%y'))
        
        # Nomor KW
        ttk.Label(self.input_frame, text="Nomor KW:").grid(row=1, column=0, padx=5, pady=5, sticky='w')
        self.kw_entry = ttk.Entry(self.input_frame, width=40)
        self.kw_entry.grid(row=1, column=1, padx=5, pady=5)
        
        # Uraian
        ttk.Label(self.input_frame, text="Uraian:").grid(row=2, column=0, padx=5, pady=5, sticky='w')
        self.uraian_entry = ttk.Entry(self.input_frame, width=40)
        self.uraian_entry.grid(row=2, column=1, padx=5, pady=5)
        
        # Jumlah (KAS)
        ttk.Label(self.input_frame, text="Jumlah (KAS):").grid(row=3, column=0, padx=5, pady=5, sticky='w')
        self.jumlah_entry = ttk.Entry(self.input_frame, width=40)
        self.jumlah_entry.grid(row=3, column=1, padx=5, pady=5)
        
        # Uang yang disetor
        ttk.Label(self.input_frame, text="Uang yang disetor:").grid(row=4, column=0, padx=5, pady=5, sticky='w')
        self.setor_entry = ttk.Entry(self.input_frame, width=40)
        self.setor_entry.grid(row=4, column=1, padx=5, pady=5)
        
        # Kategori
        ttk.Label(self.input_frame, text="Kategori:").grid(row=5, column=0, padx=5, pady=5, sticky='w')
        self.kategori_cb = ttk.Combobox(self.input_frame, values=["-- Pilih Kategori --"] + list(self.kategori.keys()), width=37)
        self.kategori_cb.set("-- Pilih Kategori --")
        self.kategori_cb.grid(row=5, column=1, padx=5, pady=5)
        self.kategori_cb.bind('<<ComboboxSelected>>', self.on_kategori_change)
        
        # Sub Kategori
        ttk.Label(self.input_frame, text="Sub Kategori:").grid(row=6, column=0, padx=5, pady=5, sticky='w')
        self.sub_kategori_cb = ttk.Combobox(self.input_frame, values=["-- Pilih Sub Kategori --"], width=37)
        self.sub_kategori_cb.set("-- Pilih Sub Kategori --")
        self.sub_kategori_cb.grid(row=6, column=1, padx=5, pady=5)
        
        # Tombol Simpan
        ttk.Button(self.input_frame, text="Simpan", command=self.save_data).grid(row=7, column=1, padx=5, pady=10)

    def create_search_widgets(self):
        # Label dan combobox untuk kategori
        ttk.Label(self.search_frame, text="Kategori:").grid(row=0, column=0, padx=5, pady=5, sticky='w')
        self.search_kategori_cb = ttk.Combobox(self.search_frame, values=["-- Pilih Kategori --"] + list(self.kategori.keys()), width=37)
        self.search_kategori_cb.set("-- Pilih Kategori --")
        self.search_kategori_cb.grid(row=0, column=1, padx=5, pady=5)
        self.search_kategori_cb.bind('<<ComboboxSelected>>', self.on_search_kategori_change)
        
        # Label dan combobox untuk sub kategori
        ttk.Label(self.search_frame, text="Sub Kategori:").grid(row=1, column=0, padx=5, pady=5, sticky='w')
        self.search_sub_kategori_cb = ttk.Combobox(self.search_frame, values=["-- Pilih Sub Kategori --"], width=37)
        self.search_sub_kategori_cb.set("-- Pilih Sub Kategori --")
        self.search_sub_kategori_cb.grid(row=1, column=1, padx=5, pady=5)
        
        # Tombol Cari
        ttk.Button(self.search_frame, text="Cari", command=self.search_data).grid(row=2, column=1, padx=5, pady=5)
        
        # Treeview untuk menampilkan hasil
        self.result_tree = ttk.Treeview(self.search_frame, columns=('Tanggal', 'KW', 'Uraian', 'Jumlah'), show='headings')
        self.result_tree.grid(row=3, column=0, columnspan=2, padx=5, pady=5)
        
        # Set heading treeview
        self.result_tree.heading('Tanggal', text='Tanggal')
        self.result_tree.heading('KW', text='No KW')
        self.result_tree.heading('Uraian', text='Uraian')
        self.result_tree.heading('Jumlah', text='Jumlah')
        
        # Set lebar kolom
        self.result_tree.column('Tanggal', width=100)
        self.result_tree.column('KW', width=100)
        self.result_tree.column('Uraian', width=200)
        self.result_tree.column('Jumlah', width=150)

    def on_kategori_change(self, event=None):
        kategori = self.kategori_cb.get()
        self.sub_kategori_cb.set("-- Pilih Sub Kategori --")
        if kategori in self.kategori:
            self.sub_kategori_cb['values'] = ["-- Pilih Sub Kategori --"] + self.kategori[kategori]
        else:
            self.sub_kategori_cb['values'] = ["-- Pilih Sub Kategori --"]

    def validate_input(self):
        try:
            datetime.strptime(self.tanggal_entry.get(), '%d-%b-%y')
        except ValueError:
            messagebox.showerror("Error", "Format tanggal salah! Gunakan format DD-MMM-YY\nContoh: 05-Jan-24")
            return False
        
        if not self.kw_entry.get().strip():
            messagebox.showerror("Error", "Nomor KW wajib diisi!")
            return False
            
        if not self.uraian_entry.get().strip():
            messagebox.showerror("Error", "Uraian harus diisi!")
            return False
            
        try:
            jumlah = float(self.jumlah_entry.get().strip())
            if jumlah <= 0:
                messagebox.showerror("Error", "Jumlah harus lebih besar dari 0!")
                return False
        except ValueError:
            messagebox.showerror("Error", "Jumlah harus berupa angka!")
            return False
            
        # Validasi uang yang disetor (boleh kosong)
        setor_str = self.setor_entry.get().strip()
        if setor_str:  # Hanya validasi jika ada isinya
            try:
                setor = float(setor_str)
                # Hapus pengecekan nilai negatif karena setor bisa 0
            except ValueError:
                messagebox.showerror("Error", "Uang yang disetor harus berupa angka!")
                return False
            
        if self.kategori_cb.get() == "-- Pilih Kategori --":
            messagebox.showerror("Error", "Pilih kategori terlebih dahulu!")
            return False
            
        if self.sub_kategori_cb.get() == "-- Pilih Sub Kategori --":
            messagebox.showerror("Error", "Pilih sub kategori terlebih dahulu!")
            return False
            
        return True

    def create_monthly_header(self, ws, tanggal):
        # Cari baris terakhir
        last_row = ws.Cells(ws.Rows.Count, "A").End(-4162).Row
        
        # Inisialisasi variabel
        found_same_month = False
        first_row_of_month = 1
        next_row = last_row + 1
        
        # Cari dari atas ke bawah untuk menemukan data bulan yang sama
        for row in range(1, last_row + 1):
            cell_value = ws.Cells(row, 1).Value
            if cell_value and isinstance(cell_value, str) is False:
                try:
                    # Langsung gunakan datetime dari Excel
                    if isinstance(cell_value, datetime):
                        date_value = cell_value
                        if date_value.month == tanggal.month and date_value.year == tanggal.year:
                            found_same_month = True
                            first_row_of_month = row
                            # Cari baris terakhir dari bulan ini
                            for r in range(row, last_row + 1):
                                next_date = ws.Cells(r, 1).Value
                                if next_date and isinstance(next_date, str) is False:
                                    try:
                                        if isinstance(next_date, datetime):
                                            if next_date.month != date_value.month or next_date.year != date_value.year:
                                                next_row = r
                                                break
                                    except:
                                        continue
                            break
                except:
                    continue
        
        # Jika tidak ketemu bulan yang sama, buat header baru
        if not found_same_month:
            header_row = last_row + 2  # Tambah 2 baris kosong setelah data terakhir
            
            # Tulis header bulan baru
            ws.Cells(header_row, 1).Value = " BULAN " + tanggal.strftime("%B %Y").upper()
            
            # Header kolom
            header_row += 1
            ws.Cells(header_row, 1).Value = "TGL"
            ws.Cells(header_row, 2).Value = "KW"
            ws.Cells(header_row, 3).Value = "URAIAN"
            ws.Cells(header_row, 4).Value = "KAS"
            ws.Cells(header_row, 5).Value = "200"
            ws.Cells(header_row, 7).Value = "400"
            ws.Cells(header_row, 9).Value = "600"
            ws.Cells(header_row, 11).Value = "800"
            ws.Cells(header_row, 13).Value = "SETOR"
            
            first_row_of_month = header_row + 1  # Set first_row_of_month untuk bulan baru
            
            return header_row + 1, first_row_of_month  # Return tuple dengan kedua nilai
        else:
            return next_row, first_row_of_month  # Return tuple dengan kedua nilai

    def save_data(self):
        if not self.validate_input():
            return
        
        try:
            excel = win32.Dispatch('Excel.Application')
            excel.Visible = False
            excel.DisplayAlerts = False
            
            try:
                wb = excel.Workbooks.Open(os.path.abspath(self.excel_file))
                ws = wb.Worksheets(self.sheet_name)
                
                # Ambil tanggal input
                input_date = datetime.strptime(self.tanggal_entry.get(), '%d-%b-%y')
                
                # Dapatkan baris untuk data baru dan informasi bulan
                next_row, first_row_of_month = self.create_monthly_header(ws, input_date)
                
                # Format dan tulis data baru
                jumlah = float(self.jumlah_entry.get().strip())
                
                # Tulis data dasar
                ws.Cells(next_row, 1).Value = self.tanggal_entry.get()
                ws.Cells(next_row, 2).Value = self.kw_entry.get()
                ws.Cells(next_row, 3).Value = self.uraian_entry.get()
                
                # Tulis jumlah di kolom KAS
                ws.Cells(next_row, 4).NumberFormat = "#.##0,00"
                ws.Cells(next_row, 4).Value = jumlah
                
                # Tulis uang yang disetor jika ada
                setor_str = self.setor_entry.get().strip()
                if setor_str:
                    setor = float(setor_str)
                    ws.Cells(next_row, 13).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 13).Value = setor

                # Tulis ke kolom kategori yang sesuai
                kode = self.sub_kategori_cb.get().split(' - ')[0]
                kategori = self.kategori_cb.get()
                
                # Reset semua kolom kategori ke kosong dulu
                for col in [5, 6, 7, 8, 9, 10, 11, 12]:
                    ws.Cells(next_row, col).Value = None
                
                # Tulis kode dan jumlah hanya untuk kategori yang dipilih
                if "200" in kategori:
                    ws.Cells(next_row, 5).Value = kode
                    ws.Cells(next_row, 6).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 6).Value = jumlah
                elif "400" in kategori:
                    ws.Cells(next_row, 7).Value = kode
                    ws.Cells(next_row, 8).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 8).Value = jumlah
                elif "600" in kategori:
                    ws.Cells(next_row, 9).Value = kode
                    ws.Cells(next_row, 10).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 10).Value = jumlah
                elif "800" in kategori:
                    ws.Cells(next_row, 11).Value = kode
                    ws.Cells(next_row, 12).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 12).Value = jumlah

                # Cek apakah ada data untuk bulan berikutnya
                next_month_exists = False
                for row in range(next_row + 1, ws.Cells(ws.Rows.Count, "A").End(-4162).Row + 1):
                    cell_value = ws.Cells(row, 1).Value
                    if cell_value and isinstance(cell_value, str) is False:
                        try:
                            if isinstance(cell_value, datetime):
                                if cell_value.month != input_date.month or cell_value.year != input_date.year:
                                    next_month_exists = True
                                    break
                        except:
                            continue

                # Jika tidak ada data bulan berikutnya, tambahkan total
                if not next_month_exists:
                    total_row = next_row + 1
                    
                    # Hapus total sebelumnya jika ada
                    if ws.Cells(total_row - 1, 3).Value and "SUM TOTAL" in str(ws.Cells(total_row - 1, 3).Value):
                        total_row -= 1
                    
                    # Tulis total baru
                    ws.Cells(total_row, 3).Value = f"SUM TOTAL ({input_date.strftime('%B %Y').upper()})"
                    
                    # Set format dan formula untuk total
                    columns = ['D', 'F', 'H', 'J', 'L', 'M']
                    for col in columns:
                        ws.Cells(total_row, ord(col)-64).NumberFormat = "#.##0,00"
                        ws.Cells(total_row, ord(col)-64).Formula = f"=SUM({col}{first_row_of_month}:{col}{next_row})"
                
                # Simpan dan tutup
                wb.Save()
                wb.Close()
                excel.Quit()
                
                messagebox.showinfo("Sukses", "Data berhasil disimpan!")
                self.clear_form()
                
            except Exception as e:
                wb.Close(SaveChanges=False)
                excel.Quit()
                raise e
                
        except PermissionError:
            messagebox.showerror("Error", "File Excel sedang dibuka. Mohon tutup file terlebih dahulu.")
        except Exception as e:
            messagebox.showerror("Error", f"Terjadi kesalahan: {str(e)}")

    def clear_form(self):
        self.tanggal_entry.delete(0, tk.END)
        self.tanggal_entry.insert(0, datetime.now().strftime('%d-%b-%y'))
        self.kw_entry.delete(0, tk.END)
        self.uraian_entry.delete(0, tk.END)
        self.jumlah_entry.delete(0, tk.END)
        self.setor_entry.delete(0, tk.END)
        self.kategori_cb.set("-- Pilih Kategori --")
        self.sub_kategori_cb.set("-- Pilih Sub Kategori --")

    def on_search_kategori_change(self, event=None):
        kategori = self.search_kategori_cb.get()
        self.search_sub_kategori_cb.set("-- Pilih Sub Kategori --")
        if kategori in self.kategori:
            self.search_sub_kategori_cb['values'] = ["-- Pilih Sub Kategori --"] + self.kategori[kategori]
        else:
            self.search_sub_kategori_cb['values'] = ["-- Pilih Sub Kategori --"]
            
    def search_data(self):
        # Hapus data lama di treeview
        for item in self.result_tree.get_children():
            self.result_tree.delete(item)
            
        try:
            excel = win32.Dispatch('Excel.Application')
            excel.Visible = False
            
            wb = excel.Workbooks.Open(os.path.abspath(self.excel_file))
            ws = wb.Worksheets(self.sheet_pencarian)
            
            # Ambil kode dari sub kategori yang dipilih
            sub_kategori = self.search_sub_kategori_cb.get()
            if sub_kategori == "-- Pilih Sub Kategori --":
                messagebox.showerror("Error", "Pilih sub kategori terlebih dahulu!")
                return
                
            kode = sub_kategori.split(' - ')[0]
            
            # Cari data yang sesuai
            last_row = ws.Cells(ws.Rows.Count, "A").End(-4162).Row
            found_data = []
            
            for row in range(1, last_row + 1):
                cell_value = str(ws.Cells(row, 1).Value)
                if kode in str(cell_value):
                    tanggal = ws.Cells(row, 2).Value
                    kw = ws.Cells(row, 3).Value
                    uraian = ws.Cells(row, 4).Value
                    jumlah = ws.Cells(row, 5).Value
                    
                    if all([tanggal, kw, uraian, jumlah]):  # Pastikan semua data ada
                        found_data.append((tanggal, kw, uraian, jumlah))
            
            # Tampilkan hasil di treeview
            for data in found_data:
                formatted_jumlah = "{:,.2f}".format(float(data[3])).replace(',', '_').replace('.', ',').replace('_', '.')
                self.result_tree.insert('', 'end', values=(data[0], data[1], data[2], formatted_jumlah))
            
            wb.Close(SaveChanges=False)
            excel.Quit()
            
            if not found_data:
                messagebox.showinfo("Info", "Tidak ada data yang ditemukan")
                
        except Exception as e:
            messagebox.showerror("Error", f"Terjadi kesalahan: {str(e)}")
            try:
                wb.Close(SaveChanges=False)
                excel.Quit()
            except:
                pass

if __name__ == "__main__":
    root = tk.Tk()
    app = InputForm(root)
    root.mainloop()




    input_form2.py:

    import tkinter as tk
from tkinter import ttk, messagebox
from datetime import datetime
import os
import win32com.client as win32

class InputForm:
    def __init__(self, root):
        self.root = root
        self.root.title("Form Input & Pencarian Pengeluaran")
        
        # Data Kategori
        self.kategori = {
            "200 - ADMINISTRASI GEREJA": [
                "200.01.01 - Pendeta Pimpinan Jemaat",
                "200.01.02 - Vicaris dan Pendeta Khusus",
                "200.01.03 - Guru Jemaat", 
                "200.01.04 - Sekretaris dan Bendahara Jemaat",
                "200.01.05.a - Pegawai Kantor (Administrasi): 2 orang",
                "200.01.06.a - Pegawai Kebersihan Gedung Gereja: 1 orang",
                "200.01.06.b - Pegawai Kebersihan Pekarangan Gereja: 1 orang",
                "200.01.06.c1 - Pegawai Supir Mobil Dinas & Ambulance",
                "200.01.06.c2 - Pegawai Jaga Malam",
                "200.01.06.d - Pegawai Kebersihan Gedung Multifungsi",
                "200.01.06.e - Pegawai Soundman",
                "200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)",
                "200.01.08 - Pengawas Parkir Gereja (Minggu & Hari Besar)",
                "200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan",
                "200.02.02 - Rapat dan Pertemuan Majelis Jemaat",
                "200.02.03 - Insentif/Lembur Pegawai",
                "200.02.04.a - Minum & Konsumsi Kantor, Jemaat",
                "200.02.04.b - Biaya Makan Tamu Gereja",
                "200.02.04.c - Biaya Snack untuk Pemusik & Songleader",
                "200.02.05 - Penyediaan Kolportase",
                "200.02.06 - Transport, Kurir, Benda Pos",
                "200.03.01.a - Snack dan minuman sermon penatua",
                "200.03.01.b - Penyediaan makanan pembukaan dan penutupan sermon penatua",
                "200.03.02 - Dana Pembinaan untuk Paduan Suara",
                "200.03.03.a - Syukuran Awal Tahun (Jemaat & Pendeta)",
                "200.03.03.b - Snack Kebaktian Awal Tahun Gereja",
                "200.03.03.c - Snack Paskah dan Buha-Buha Ijuk",
                "200.03.04 - Krans Bunga Dukacita bagi Anggota Jemaat",
                "200.03.05 - Bantuan Dukacita bagi Anggota Jemaat",
                "200.03.06.a - Bunga altar pada Kebaktian Minggu",
                "200.03.06.b - Dekorasi pada Kebaktian Hari Besar Kristen",
                "200.03.07 - Keamanan Acara Hari Besar Kristen",
                "200.03.08.a - Kontribusi & Registrasi Peserta Rapat Pendeta",
                "200.03.08.b - Perjalanan Dinas Peserta Rapat Pendeta (2 pendeta)",
                "200.03.09 - Perjalanan Dinas atas undangan Kantor Pusat",
                "200.03.10 - Sidang Umum Jemaat",
                "200.03.11.a - Biaya Tak Terduga (Pengurusan Sertifikat Tanah)",
                "200.03.11.b - Biaya Tak Terduga/Insidentil",
                "200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan",
                "200.04.02 - Inventaris Gereja",
                "200.05.01.a - Kijang Innova, Plat BK 1757 EJ",
                "200.05.01.b - Pajak Kendaraan Kijang Innova",
                "200.05.02.a - HIACE BK.7866 DP",
                "200.05.02.b - Pajak Kendaraan HIACE",
                "200.05.03.a - Roda 2: 1 unit, Plat BK. 5440 AGG",
                "200.05.03.b - Pajak Kendaraan Roda 2",
                "200.06.01 - Telepon, Speedy, MyRepublik dan WA",
                "200.07.01 - Jubah Penatua (Upah Jahit)",
                "200.07.02 - Peralatan & Perlengkapan Inventaris Gereja",
                "200.07.03 - Dekorasi dan Persiapan Natal"
            ],
            
            "400 - PELAYANAN IBADAH": [
                "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI",
                "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota",
                "400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota",
                "400.01.04 - Pengkhotbah Minggu: Di Rumah Duka (Oleh Pendeta)",
                "400.01.05 - Pengkhotbah Minggu: Remaja",
                "400.02.01 - Pengkhotbah Kebaktian di Lingkungan (Wijk)",
                "400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi/Remaja & GSM",
                "400.02.03 - Pengkhotbah Kebaktian Koor Ibu-Ibu",
                "400.02.04 - Pengkhotbah Kebaktian Ibu Hanna",
                "400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)",
                "400.03.01 - Pengkhotbah Perjanjian/Pemberkatan Nikah",
                "400.03.02 - Pengkhotbah Penguburan Jenazah",
                "400.03.03 - Pengkhotbah di Rumah Duka (Oleh Penatua)",
                "400.04.01 - Minggu Pagi 08.00 WIB (@ 13 Orang)",
                "400.04.02 - Minggu Sore: Pukul 18.00 WIB (@ 13 Orang)",
                "400.04.03 - Sekolah Minggu dan Remaja",
                "400.04.04 - Perjanjian/Pemberkatan Pernikahan",
                "400.04.05 - Kebaktian pemberangkatan jenazah",
                "400.04.06 - Minggu Di Rumah Duka",
                "400.04.07 - Pelayanan di Rumah Duka",
                "400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)",
                "400.04.09 - Latihan Pemusik dan Songleader",
                "400.04.10 - Petugas Penghitung Kebaktian Minggu",
                "400.05.01 - Perjamuan Kudus di Gereja",
                "400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi",
                "400.06.01 - Perayaan HUT Jemaat"
            ],

            "600 - PEMBINAAN & PELAYANAN": [
                "600.01.01 - Pendidikan Lanjutan untuk Pendeta",
                "600.01.02 - Penghargaan untuk Penatua",
                "600.01.03 - Pembinaan & Pelatihan Pelajar Sidi",
                "600.01.04 - Pembinaan Penatua se Resort Medan Barat",
                "600.02.01 - Pembinaan & Pelayan Rohani (PPR)",
                "600.02.02 - Pekabaran Injil",
                "600.02.03 - Diakoni Sosial",
                "600.02.04 - Musik, Nyanyian & Koor (MNK)",
                "600.02.05 - Sekolah Minggu",
                "600.02.06 - Remaja",
                "600.02.07 - Pemuda",
                "600.02.08 - Perempuan",
                "600.02.09 - Pria",
                "600.02.10 - Lansia",
                "600.02.11 - Kesehatan",
                "600.02.12 - Pendidikan",
                "600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)",
                "600.02.14 - Sarana & Prasarana",
                "600.02.15 - Natal Gabungan Seksi-Seksi (Natal II)",
                "600.03.01 - Target Ke Kantor Pusat GKPI",
                "600.03.02 - Biaya Tahun Renstra GKPI 2023",
                "600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)",
                "600.04.01 - Target Ke GKPI Resort Medan Barat"
            ],

            "800 - BANTUAN & TUNJANGAN": [
                "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam",
                "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka",
                "800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI",
                "800.01.04 - Bantuan untuk PA. Mamre dan Yapentra",
                "800.01.05 - Bantuan Ke GKPI Lainnya",
                "800.01.06 - Bantuan Kepada Masyarakat di sekitar",
                "800.02.01 - Sekolah Minggu",
                "800.02.02 - Penatua Purna Bakti",
                "800.02.03 - Penatua Aktif",
                "800.02.04 - Calon Penatua Aktif",
                "800.02.05 - Pendeta GKPI Resort Medan Barat",
                "800.02.06 - Anggota Majelis Jemaat: Ketua Seksi & Penasehat",
                "800.02.07 - Guru-Guru Koor di Jemaat",
                "800.02.08 - Guru-Guru Sekolah Minggu",
                "800.02.09 - Pemusik: Pianis, Organis dan Saxophonis",
                "800.02.10 - Songleader",
                "800.02.11 - Petugas Live Streaming"
            ]
        }
        
        # Excel file path
        self.excel_file = 'JURNAL PENGELUARAN JEMAAT 2024.xls'
        self.sheet_name = 'JUR PENGEL JEMAAT 2024'
        
        # Tambahkan sheet untuk pencarian
        self.sheet_pencarian = 'BUKU BESAR'
        
        self.create_widgets()
        
    def create_widgets(self):
        # Buat notebook/tab untuk memisahkan form input dan pencarian
        self.notebook = ttk.Notebook(self.root)
        self.notebook.grid(row=0, column=0, padx=5, pady=5)
        
        # Tab untuk input data
        self.input_frame = ttk.Frame(self.notebook)
        self.notebook.add(self.input_frame, text='Input Data')
        
        # Tab untuk pencarian
        self.search_frame = ttk.Frame(self.notebook)
        self.notebook.add(self.search_frame, text='Pencarian')
        
        # Buat widget form input seperti sebelumnya tapi gunakan input_frame sebagai parent
        self.create_input_widgets()
        
        # Buat widget pencarian
        self.create_search_widgets()

    def create_input_widgets(self):
        # Tanggal
        ttk.Label(self.input_frame, text="Tanggal (DD-MMM-YY):").grid(row=0, column=0, padx=5, pady=5, sticky='w')
        self.tanggal_entry = ttk.Entry(self.input_frame, width=40)
        self.tanggal_entry.grid(row=0, column=1, padx=5, pady=5)
        self.tanggal_entry.insert(0, datetime.now().strftime('%d-%b-%y'))
        
        # Nomor KW
        ttk.Label(self.input_frame, text="Nomor KW:").grid(row=1, column=0, padx=5, pady=5, sticky='w')
        self.kw_entry = ttk.Entry(self.input_frame, width=40)
        self.kw_entry.grid(row=1, column=1, padx=5, pady=5)
        
        # Uraian
        ttk.Label(self.input_frame, text="Uraian:").grid(row=2, column=0, padx=5, pady=5, sticky='w')
        self.uraian_entry = ttk.Entry(self.input_frame, width=40)
        self.uraian_entry.grid(row=2, column=1, padx=5, pady=5)
        
        # Jumlah (KAS)
        ttk.Label(self.input_frame, text="Jumlah (KAS):").grid(row=3, column=0, padx=5, pady=5, sticky='w')
        self.jumlah_entry = ttk.Entry(self.input_frame, width=40)
        self.jumlah_entry.grid(row=3, column=1, padx=5, pady=5)
        
        # Uang yang disetor
        ttk.Label(self.input_frame, text="Uang yang disetor:").grid(row=4, column=0, padx=5, pady=5, sticky='w')
        self.setor_entry = ttk.Entry(self.input_frame, width=40)
        self.setor_entry.grid(row=4, column=1, padx=5, pady=5)
        
        # Kategori
        ttk.Label(self.input_frame, text="Kategori:").grid(row=5, column=0, padx=5, pady=5, sticky='w')
        self.kategori_cb = ttk.Combobox(self.input_frame, values=["-- Pilih Kategori --"] + list(self.kategori.keys()), width=37)
        self.kategori_cb.set("-- Pilih Kategori --")
        self.kategori_cb.grid(row=5, column=1, padx=5, pady=5)
        self.kategori_cb.bind('<<ComboboxSelected>>', self.on_kategori_change)
        
        # Sub Kategori
        ttk.Label(self.input_frame, text="Sub Kategori:").grid(row=6, column=0, padx=5, pady=5, sticky='w')
        self.sub_kategori_cb = ttk.Combobox(self.input_frame, values=["-- Pilih Sub Kategori --"], width=37)
        self.sub_kategori_cb.set("-- Pilih Sub Kategori --")
        self.sub_kategori_cb.grid(row=6, column=1, padx=5, pady=5)
        
        # Tombol Simpan
        ttk.Button(self.input_frame, text="Simpan", command=self.save_data).grid(row=7, column=1, padx=5, pady=10)

    def create_search_widgets(self):
        # Label dan combobox untuk kategori
        ttk.Label(self.search_frame, text="Kategori:").grid(row=0, column=0, padx=5, pady=5, sticky='w')
        self.search_kategori_cb = ttk.Combobox(self.search_frame, values=["-- Pilih Kategori --"] + list(self.kategori.keys()), width=37)
        self.search_kategori_cb.set("-- Pilih Kategori --")
        self.search_kategori_cb.grid(row=0, column=1, padx=5, pady=5)
        self.search_kategori_cb.bind('<<ComboboxSelected>>', self.on_search_kategori_change)
        
        # Label dan combobox untuk sub kategori
        ttk.Label(self.search_frame, text="Sub Kategori:").grid(row=1, column=0, padx=5, pady=5, sticky='w')
        self.search_sub_kategori_cb = ttk.Combobox(self.search_frame, values=["-- Pilih Sub Kategori --"], width=37)
        self.search_sub_kategori_cb.set("-- Pilih Sub Kategori --")
        self.search_sub_kategori_cb.grid(row=1, column=1, padx=5, pady=5)
        
        # Tombol Cari
        ttk.Button(self.search_frame, text="Cari", command=self.search_data).grid(row=2, column=1, padx=5, pady=5)
        
        # Treeview untuk menampilkan hasil
        self.result_tree = ttk.Treeview(self.search_frame, columns=('Tanggal', 'KW', 'Uraian', 'Jumlah'), show='headings')
        self.result_tree.grid(row=3, column=0, columnspan=2, padx=5, pady=5)
        
        # Set heading treeview
        self.result_tree.heading('Tanggal', text='Tanggal')
        self.result_tree.heading('KW', text='No KW')
        self.result_tree.heading('Uraian', text='Uraian')
        self.result_tree.heading('Jumlah', text='Jumlah')
        
        # Set lebar kolom
        self.result_tree.column('Tanggal', width=100)
        self.result_tree.column('KW', width=100)
        self.result_tree.column('Uraian', width=200)
        self.result_tree.column('Jumlah', width=150)

    def on_kategori_change(self, event=None):
        kategori = self.kategori_cb.get()
        self.sub_kategori_cb.set("-- Pilih Sub Kategori --")
        if kategori in self.kategori:
            self.sub_kategori_cb['values'] = ["-- Pilih Sub Kategori --"] + self.kategori[kategori]
        else:
            self.sub_kategori_cb['values'] = ["-- Pilih Sub Kategori --"]

    def validate_input(self):
        try:
            datetime.strptime(self.tanggal_entry.get(), '%d-%b-%y')
        except ValueError:
            messagebox.showerror("Error", "Format tanggal salah! Gunakan format DD-MMM-YY\nContoh: 05-Jan-24")
            return False
        
        if not self.kw_entry.get().strip():
            messagebox.showerror("Error", "Nomor KW wajib diisi!")
            return False
            
        if not self.uraian_entry.get().strip():
            messagebox.showerror("Error", "Uraian harus diisi!")
            return False
            
        # Validasi jumlah (KAS) - mengizinkan kosong
        jumlah_str = self.jumlah_entry.get().strip()
        if jumlah_str:  # Hanya validasi jika ada isinya
            try:
                jumlah = float(jumlah_str)
                if jumlah <= 0:
                    messagebox.showerror("Error", "Jumlah harus lebih besar dari 0!")
                    return False
            except ValueError:
                messagebox.showerror("Error", "Jumlah harus berupa angka!")
                return False
            
        # Validasi uang yang disetor (boleh kosong)
        setor_str = self.setor_entry.get().strip()
        if setor_str:  # Hanya validasi jika ada isinya
            try:
                setor = float(setor_str)
            except ValueError:
                messagebox.showerror("Error", "Uang yang disetor harus berupa angka!")
                return False
            
        # Kategori tidak wajib diisi
        # if self.kategori_cb.get() == "-- Pilih Kategori --":
        #     messagebox.showerror("Error", "Pilih kategori terlebih dahulu!")
        #     return False
        
        # Sub Kategori harus dipilih jika kategori dipilih
        if self.kategori_cb.get() != "-- Pilih Kategori --" and self.sub_kategori_cb.get() == "-- Pilih Sub Kategori --":
            messagebox.showerror("Error", "Pilih sub kategori terlebih dahulu!")
            return False
            
        return True

    def create_monthly_header(self, ws, tanggal):
        # Cari baris terakhir
        last_row = ws.Cells(ws.Rows.Count, "A").End(-4162).Row
        
        # Inisialisasi variabel
        found_same_month = False
        first_row_of_month = 1
        next_row = last_row + 1
        
        # Cari dari atas ke bawah untuk menemukan data bulan yang sama
        for row in range(1, last_row + 1):
            cell_value = ws.Cells(row, 1).Value
            if cell_value and isinstance(cell_value, str) is False:
                try:
                    # Langsung gunakan datetime dari Excel
                    if isinstance(cell_value, datetime):
                        date_value = cell_value
                        if date_value.month == tanggal.month and date_value.year == tanggal.year:
                            found_same_month = True
                            first_row_of_month = row
                            # Cari baris terakhir dari bulan ini
                            for r in range(row, last_row + 1):
                                next_date = ws.Cells(r, 1).Value
                                if next_date and isinstance(next_date, str) is False:
                                    try:
                                        if isinstance(next_date, datetime):
                                            if next_date.month != date_value.month or next_date.year != date_value.year:
                                                next_row = r
                                                break
                                    except:
                                        continue
                            break
                except:
                    continue
        
        # Jika tidak ketemu bulan yang sama, buat header baru
        if not found_same_month:
            header_row = last_row + 2  # Tambah 2 baris kosong setelah data terakhir
            
            # Tulis header bulan baru
            ws.Cells(header_row, 1).Value = " BULAN " + tanggal.strftime("%B %Y").upper()
            
            # Header kolom
            header_row += 1
            ws.Cells(header_row, 1).Value = "TGL"
            ws.Cells(header_row, 2).Value = "KW"
            ws.Cells(header_row, 3).Value = "URAIAN"
            ws.Cells(header_row, 4).Value = "KAS"
            ws.Cells(header_row, 5).Value = "200"
            ws.Cells(header_row, 7).Value = "400"
            ws.Cells(header_row, 9).Value = "600"
            ws.Cells(header_row, 11).Value = "800"
            ws.Cells(header_row, 13).Value = "SETOR"
            
            first_row_of_month = header_row + 1  # Set first_row_of_month untuk bulan baru
            
            return header_row + 1, first_row_of_month  # Return tuple dengan kedua nilai
        else:
            return next_row, first_row_of_month  # Return tuple dengan kedua nilai

    def save_data(self):
        if not self.validate_input():
            return
        
        try:
            excel = win32.Dispatch('Excel.Application')
            excel.Visible = False
            excel.DisplayAlerts = False
            
            try:
                wb = excel.Workbooks.Open(os.path.abspath(self.excel_file))
                ws = wb.Worksheets(self.sheet_name)
                
                # Ambil tanggal input
                input_date = datetime.strptime(self.tanggal_entry.get(), '%d-%b-%y')
                
                # Dapatkan baris untuk data baru dan informasi bulan
                next_row, first_row_of_month = self.create_monthly_header(ws, input_date)
                
                # Ambil dan format data baru
                jumlah_str = self.jumlah_entry.get().strip()
                jumlah = float(jumlah_str) if jumlah_str else 0  # Mengizinkan kosong, set ke 0 jika kosong
                
                setor_str = self.setor_entry.get().strip()
                setor = float(setor_str) if setor_str else 0  # Mengizinkan kosong, set ke 0 jika kosong
                
                # Hitung total KAS sebagai jumlah + setoran
                total_kas = jumlah + setor
                
                # Tulis data dasar
                ws.Cells(next_row, 1).Value = self.tanggal_entry.get()
                ws.Cells(next_row, 2).Value = self.kw_entry.get()
                ws.Cells(next_row, 3).Value = self.uraian_entry.get()
                
                # Tulis total KAS di kolom KAS
                ws.Cells(next_row, 4).NumberFormat = "#.##0,00"
                ws.Cells(next_row, 4).Value = total_kas  # Menulis total KAS
                
                # Tulis uang yang disetor jika ada
                ws.Cells(next_row, 13).NumberFormat = "#.##0,00"
                ws.Cells(next_row, 13).Value = setor

                # Tulis ke kolom kategori yang sesuai jika dipilih
                kode = self.sub_kategori_cb.get().split(' - ')[0] if self.sub_kategori_cb.get() != "-- Pilih Sub Kategori --" else None
                kategori = self.kategori_cb.get()
                
                # Reset semua kolom kategori ke kosong dulu
                for col in [5, 6, 7, 8, 9, 10, 11, 12]:
                    ws.Cells(next_row, col).Value = None
                
                # Tulis kode dan jumlah hanya untuk kategori yang dipilih
                if kategori == "-- Pilih Kategori --":
                    # Jika kategori tidak dipilih, tidak perlu menulis kode
                    pass
                elif "200" in kategori:
                    ws.Cells(next_row, 5).Value = kode
                    ws.Cells(next_row, 6).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 6).Value = jumlah
                elif "400" in kategori:
                    ws.Cells(next_row, 7).Value = kode
                    ws.Cells(next_row, 8).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 8).Value = jumlah
                elif "600" in kategori:
                    ws.Cells(next_row, 9).Value = kode
                    ws.Cells(next_row, 10).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 10).Value = jumlah
                elif "800" in kategori:
                    ws.Cells(next_row, 11).Value = kode
                    ws.Cells(next_row, 12).NumberFormat = "#.##0,00"
                    ws.Cells(next_row, 12).Value = jumlah

                # Cek apakah ada data untuk bulan berikutnya
                next_month_exists = False
                for row in range(next_row + 1, ws.Cells(ws.Rows.Count, "A").End(-4162).Row + 1):
                    cell_value = ws.Cells(row, 1).Value
                    if cell_value and isinstance(cell_value, str) is False:
                        try:
                            if isinstance(cell_value, datetime):
                                if cell_value.month != input_date.month or cell_value.year != input_date.year:
                                    next_month_exists = True
                                    break
                        except:
                            continue

                # Jika tidak ada data bulan berikutnya, tambahkan total
                if not next_month_exists:
                    total_row = next_row + 1
                    
                    # Hapus total sebelumnya jika ada
                    if ws.Cells(total_row - 1, 3).Value and "SUM TOTAL" in str(ws.Cells(total_row - 1, 3).Value):
                        total_row -= 1
                    
                    # Tulis total baru
                    ws.Cells(total_row, 3).Value = f"SUM TOTAL ({input_date.strftime('%B %Y').upper()})"
                    
                    # Set format dan formula untuk total
                    columns = ['D', 'F', 'H', 'J', 'L', 'M']
                    for col in columns:
                        ws.Cells(total_row, ord(col)-64).NumberFormat = "#.##0,00"
                        ws.Cells(total_row, ord(col)-64).Formula = f"=SUM({col}{first_row_of_month}:{col}{next_row})"
                
                # Simpan dan tutup
                wb.Save()
                wb.Close()
                excel.Quit()
                
                messagebox.showinfo("Sukses", "Data berhasil disimpan!")
                self.clear_form()
                
            except Exception as e:
                wb.Close(SaveChanges=False)
                excel.Quit()
                raise e
                
        except PermissionError:
            messagebox.showerror("Error", "File Excel sedang dibuka. Mohon tutup file terlebih dahulu.")
        except Exception as e:
            messagebox.showerror("Error", f"Terjadi kesalahan: {str(e)}")

    def clear_form(self):
        self.tanggal_entry.delete(0, tk.END)
        self.tanggal_entry.insert(0, datetime.now().strftime('%d-%b-%y'))
        self.kw_entry.delete(0, tk.END)
        self.uraian_entry.delete(0, tk.END)
        self.jumlah_entry.delete(0, tk.END)
        self.setor_entry.delete(0, tk.END)
        self.kategori_cb.set("-- Pilih Kategori --")
        self.sub_kategori_cb.set("-- Pilih Sub Kategori --")

    def on_search_kategori_change(self, event=None):
        kategori = self.search_kategori_cb.get()
        self.search_sub_kategori_cb.set("-- Pilih Sub Kategori --")
        if kategori in self.kategori:
            self.search_sub_kategori_cb['values'] = ["-- Pilih Sub Kategori --"] + self.kategori[kategori]
        else:
            self.search_sub_kategori_cb['values'] = ["-- Pilih Sub Kategori --"]
            
    def search_data(self):
        # Hapus data lama di treeview
        for item in self.result_tree.get_children():
            self.result_tree.delete(item)
            
        try:
            excel = win32.Dispatch('Excel.Application')
            excel.Visible = False
            
            wb = excel.Workbooks.Open(os.path.abspath(self.excel_file))
            ws = wb.Worksheets(self.sheet_pencarian)
            
            # Ambil kode dari sub kategori yang dipilih
            sub_kategori = self.search_sub_kategori_cb.get()
            if sub_kategori == "-- Pilih Sub Kategori --":
                messagebox.showerror("Error", "Pilih sub kategori terlebih dahulu!")
                return
                
            kode = sub_kategori.split(' - ')[0]
            
            # Cari data yang sesuai
            last_row = ws.Cells(ws.Rows.Count, "A").End(-4162).Row
            found_data = []
            
            for row in range(1, last_row + 1):
                cell_value = str(ws.Cells(row, 1).Value)
                if kode in str(cell_value):
                    tanggal = ws.Cells(row, 2).Value
                    kw = ws.Cells(row, 3).Value
                    uraian = ws.Cells(row, 4).Value
                    jumlah = ws.Cells(row, 5).Value
                    
                    if all([tanggal, kw, uraian, jumlah]):  # Pastikan semua data ada
                        found_data.append((tanggal, kw, uraian, jumlah))
            
            # Tampilkan hasil di treeview
            for data in found_data:
                formatted_jumlah = "{:,.2f}".format(float(data[3])).replace(',', '_').replace('.', ',').replace('_', '.')
                self.result_tree.insert('', 'end', values=(data[0], data[1], data[2], formatted_jumlah))
            
            wb.Close(SaveChanges=False)
            excel.Quit()
            
            if not found_data:
                messagebox.showinfo("Info", "Tidak ada data yang ditemukan")
                
        except Exception as e:
            messagebox.showerror("Error", f"Terjadi kesalahan: {str(e)}")
            try:
                wb.Close(SaveChanges=False)
                excel.Quit()
            except:
                pass

if __name__ == "__main__":
    root = tk.Tk()
    app = InputForm(root)
    root.mainloop()



vba untuk h0:
    Sub GroupDataByHobby()
    Dim ws1 As Worksheet, ws2 As Worksheet
    Dim lastRow1 As Long, currentRow As Long
    Dim i As Long
    Dim hobby As String
    
    ' Inisialisasi Sheet1 dan Sheet2
    Set ws1 = ThisWorkbook.Sheets("Sheet1")
    Set ws2 = ThisWorkbook.Sheets("Sheet2")
    
    ' Hapus isi Sheet2
    ws2.Cells.Clear
    
    ' Set baris awal
    currentRow = 1
    
    ' Tambahkan header untuk kategori H01
    ws2.Cells(currentRow, 1).Value = "Membaca Buku (H01)"
    currentRow = currentRow + 1
    ws2.Cells(currentRow, 1).Resize(1, 3).Value = Array("Nama", "Alamat", "Usia")
    currentRow = currentRow + 1
    
    ' Cari baris terakhir di Sheet1
    lastRow1 = ws1.Cells(ws1.Rows.Count, "A").End(xlUp).Row
    
    ' Tulis data untuk H01
    For i = 2 To lastRow1
        If ws1.Cells(i, 3).Value = "H01" Then
            ws2.Cells(currentRow, 1).Value = ws1.Cells(i, 1).Value ' Nama
            ws2.Cells(currentRow, 2).Value = ws1.Cells(i, 2).Value ' Alamat
            ws2.Cells(currentRow, 3).Value = ws1.Cells(i, 4).Value ' Usia
            currentRow = currentRow + 1
        End If
    Next i
    
    ' Tambah 2 baris kosong
    currentRow = currentRow + 2
    
    ' Tambahkan header untuk kategori H02
    ws2.Cells(currentRow, 1).Value = "Menonton Film (H02)"
    currentRow = currentRow + 1
    ws2.Cells(currentRow, 1).Resize(1, 3).Value = Array("Nama", "Alamat", "Usia")
    currentRow = currentRow + 1
    
    ' Tulis data untuk H02
    For i = 2 To lastRow1
        If ws1.Cells(i, 3).Value = "H02" Then
            ws2.Cells(currentRow, 1).Value = ws1.Cells(i, 1).Value
            ws2.Cells(currentRow, 2).Value = ws1.Cells(i, 2).Value
            ws2.Cells(currentRow, 3).Value = ws1.Cells(i, 4).Value
            currentRow = currentRow + 1
        End If
    Next i
    
    ' Tambah 2 baris kosong
    currentRow = currentRow + 2
    
    ' Tambahkan header untuk kategori H03
    ws2.Cells(currentRow, 1).Value = "Olahraga (H03)"
    currentRow = currentRow + 1
    ws2.Cells(currentRow, 1).Resize(1, 3).Value = Array("Nama", "Alamat", "Usia")
    currentRow = currentRow + 1
    
    ' Tulis data untuk H03
    For i = 2 To lastRow1
        If ws1.Cells(i, 3).Value = "H03" Then
            ws2.Cells(currentRow, 1).Value = ws1.Cells(i, 1).Value
            ws2.Cells(currentRow, 2).Value = ws1.Cells(i, 2).Value
            ws2.Cells(currentRow, 3).Value = ws1.Cells(i, 4).Value
            currentRow = currentRow + 1
        End If
    Next i
    
    ' Tambah 2 baris kosong
    currentRow = currentRow + 2
    
    ' Tambahkan header untuk kategori H04
    ws2.Cells(currentRow, 1).Value = "Musik (H04)"
    currentRow = currentRow + 1
    ws2.Cells(currentRow, 1).Resize(1, 3).Value = Array("Nama", "Alamat", "Usia")
    currentRow = currentRow + 1
    
    ' Tulis data untuk H04
    For i = 2 To lastRow1
        If ws1.Cells(i, 3).Value = "H04" Then
            ws2.Cells(currentRow, 1).Value = ws1.Cells(i, 1).Value
            ws2.Cells(currentRow, 2).Value = ws1.Cells(i, 2).Value
            ws2.Cells(currentRow, 3).Value = ws1.Cells(i, 4).Value
            currentRow = currentRow + 1
        End If
    Next i
    
    ' Format tabel
    With ws2
        .Columns("A:C").AutoFit
    End With
    
    MsgBox "Data berhasil dipindahkan ke Sheet2!"
End Sub




-kode terbaru h0:

--------------
Sub GroupDataByHobby()
    Dim ws1 As Worksheet, ws2 As Worksheet
    Dim lastRow1 As Long, currentRow As Long
    Dim i As Long
    Dim hobby As String
    Dim nameBox As Range, nextNameBox As Range
    
    ' Inisialisasi Sheet1 dan Sheet2
    Set ws1 = ThisWorkbook.Sheets("Sheet1")
    Set ws2 = ThisWorkbook.Sheets("Sheet2")
    
    ' Hapus isi Sheet2
    ws2.Cells.Clear
    
    ' Cari baris terakhir di Sheet1
    lastRow1 = ws1.Cells(ws1.Rows.Count, "A").End(xlUp).Row
    
    ' Array untuk menyimpan kode hobi dan namebox
    Dim hobbyCodes() As Variant
    hobbyCodes = Array("H01", "H02", "H03", "H04")
    Dim hobbyNames() As Variant
    hobbyNames = Array("Membaca Buku", "Menonton Film", "Olahraga", "Musik")
    
    For h = 0 To UBound(hobbyCodes)
        ' Set namebox saat ini dan berikutnya
        Set nameBox = ws2.Range("kode" & hobbyCodes(h))
        If h < UBound(hobbyCodes) Then
            Set nextNameBox = ws2.Range("kode" & hobbyCodes(h + 1))
        Else
            Set nextNameBox = Nothing
        End If
        
        ' Tulis header
        ws2.Cells(nameBox.Row, nameBox.Column).Value = hobbyNames(h) & " (" & hobbyCodes(h) & ")"
        currentRow = nameBox.Row + 1
        ws2.Cells(currentRow, nameBox.Column).Resize(1, 3).Value = Array("Nama", "Alamat", "Usia")
        currentRow = currentRow + 1
        
        ' Tulis data
        Dim dataCount As Long
        dataCount = 0
        For i = 2 To lastRow1
            If ws1.Cells(i, 3).Value = hobbyCodes(h) Then
                ws2.Cells(currentRow, nameBox.Column).Value = ws1.Cells(i, 1).Value
                ws2.Cells(currentRow, nameBox.Column + 1).Value = ws1.Cells(i, 2).Value
                ws2.Cells(currentRow, nameBox.Column + 2).Value = ws1.Cells(i, 4).Value
                currentRow = currentRow + 1
                dataCount = dataCount + 1
            End If
        Next i
        
        ' Periksa jarak ke namebox berikutnya
        If Not nextNameBox Is Nothing Then
            Dim requiredRows As Long
            requiredRows = dataCount + 2 ' Header + kolom judul
            Dim availableRows As Long
            availableRows = nextNameBox.Row - nameBox.Row
            
            ' Jika jarak kurang dari minimal (data + header + 4 baris kosong)
            If availableRows < (requiredRows + 4) Then
                ' Geser namebox berikutnya dan semua namebox setelahnya
                Dim rowsToAdd As Long
                rowsToAdd = (requiredRows + 4) - availableRows
                
                ' Geser semua namebox berikutnya
                For j = h + 1 To UBound(hobbyCodes)
                    Dim boxToMove As Range
                    Set boxToMove = ws2.Range("kode" & hobbyCodes(j))
                    boxToMove.Offset(rowsToAdd, 0).Name = "kode" & hobbyCodes(j)
                Next j
            End If
        End If
    Next h
    
    ' Format tabel
    With ws2
        .Columns("A:C").AutoFit
    End With
    
    MsgBox "Data berhasil dipindahkan ke Sheet2!"
End Sub
----------



Dim headersSheet1 As Variant
headers = Array( _
    "TGL.", "KW", "URAIAN", "KREDIT - KAS", _
    "200 (Kode)", "200 (Nilai)", _
    "400 (Kode)", "400 (Nilai)", _
    "600 (Kode)", "600 (Nilai)", _
    "800 (Kode)", "800 (Nilai)", _
    "Uang yang di setor" _
)

Dim headersSheet2 As Variant
headersSheet2 = Array("TGL.", "BKK", "URAIAN", "Jumlah")



----------------------------
kode.gs (sudah bagus untuk form iput. tinggal sum dan header)
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu('Form Input')
      .addItem('Buka Form', 'showInputForm')
      .addToUi();
}

function showInputForm() {
  var html = HtmlService.createHtmlOutputFromFile('InputForm')
      .setWidth(400)
      .setHeight(600);
  SpreadsheetApp.getUi().showModalDialog(html, 'Form Input & Pencarian Pengeluaran');
}

function saveData(data) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('JUR PENGEL JEMAAT 2024');
  var lastRow = sheet.getLastRow() + 1;

  // Menyimpan data dasar ke sheet
  var tanggal = new Date(data.tanggal);
  
  // Set format sel untuk setiap kolom
  sheet.getRange(lastRow, 1).setValue(tanggal).setNumberFormat("dd-mmm-yy"); // Format tanggal
  sheet.getRange(lastRow, 2).setValue(data.kw);
  sheet.getRange(lastRow, 3).setValue(data.uraian);
  sheet.getRange(lastRow, 4).setValue(data.jumlah).setNumberFormat("#,##0.00"); // Format angka
  sheet.getRange(lastRow, 13).setValue(data.setor).setNumberFormat("#,##0.00"); // Kolom setoran (M)

  // Ambil kode dari sub kategori
  var kodeSub = data.subKategori.split(' - ')[0];
  
  // Set format sel sebagai teks untuk kolom kode anggaran
  if (data.kategori.includes("200")) {
    sheet.getRange(lastRow, 5).setValue(kodeSub).setNumberFormat("@"); // Kolom E sebagai teks
    sheet.getRange(lastRow, 6).setValue(data.jumlah).setNumberFormat("#,##0.00");
  } else if (data.kategori.includes("400")) {
    sheet.getRange(lastRow, 7).setValue(kodeSub).setNumberFormat("@"); // Kolom G sebagai teks
    sheet.getRange(lastRow, 8).setValue(data.jumlah).setNumberFormat("#,##0.00");
  } else if (data.kategori.includes("600")) {
    sheet.getRange(lastRow, 9).setValue(kodeSub).setNumberFormat("@"); // Kolom I sebagai teks
    sheet.getRange(lastRow, 10).setValue(data.jumlah).setNumberFormat("#,##0.00");
  } else if (data.kategori.includes("800")) {
    sheet.getRange(lastRow, 11).setValue(kodeSub).setNumberFormat("@"); // Kolom K sebagai teks
    sheet.getRange(lastRow, 12).setValue(data.jumlah).setNumberFormat("#,##0.00");
  }


  // Menghitung total nilai untuk kolom D
  var kolomF = sheet.getRange(lastRow, 6).getValue() || 0;
  var kolomH = sheet.getRange(lastRow, 8).getValue() || 0;
  var kolomJ = sheet.getRange(lastRow, 10).getValue() || 0;
  var kolomL = sheet.getRange(lastRow, 12).getValue() || 0;
  var kolomM = sheet.getRange(lastRow, 13).getValue() || 0;
  
  var totalKas = kolomF + kolomH + kolomJ + kolomL + kolomM;

  // Menyimpan total ke kolom D
  sheet.getRange(lastRow, 4).setValue(totalKas).setNumberFormat("#,##0.00");
  
  return "Data berhasil disimpan!";
}

function searchData(subKategori) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('BUKU BESAR');
  var data = sheet.getDataRange().getValues();
  var results = [];

  for (var i = 1; i < data.length; i++) {
    if (data[i][2] === subKategori) { // Asumsi subKategori ada di kolom ketiga
      results.push(data[i]);
    }
  }
  
  return results;
}

function getSubCategories(kategori) {
  var subCategories = {
    "200 - ADMINISTRASI GEREJA": [
      "200.01.01 - Pendeta Pimpinan Jemaat",
      "200.01.02 - Vicaris dan Pendeta Khusus",
      "200.01.03 - Guru Jemaat", 
      "200.01.04 - Sekretaris dan Bendahara Jemaat",
      "200.01.05.a - Pegawai Kantor (Administrasi): 2 orang",
      "200.01.06.a - Pegawai Kebersihan Gedung Gereja: 1 orang",
      "200.01.06.b - Pegawai Kebersihan Pekarangan Gereja: 1 orang",
      "200.01.06.c1 - Pegawai Supir Mobil Dinas & Ambulance",
      "200.01.06.c2 - Pegawai Jaga Malam",
      "200.01.06.d - Pegawai Kebersihan Gedung Multifungsi",
      "200.01.06.e - Pegawai Soundman",
      "200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)",
      "200.01.08 - Pengawas Parkir Gereja (Minggu & Hari Besar)",
      "200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan",
      "200.02.02 - Rapat dan Pertemuan Majelis Jemaat",
      "200.02.03 - Insentif/Lembur Pegawai",
      "200.02.04.a - Minum & Konsumsi Kantor, Jemaat",
      "200.02.04.b - Biaya Makan Tamu Gereja",
      "200.02.04.c - Biaya Snack untuk Pemusik & Songleader",
      "200.02.05 - Penyediaan Kolportase",
      "200.02.06 - Transport, Kurir, Benda Pos",
      "200.03.01.a - Snack dan minuman sermon penatua",
      "200.03.01.b - Penyediaan makanan pembukaan dan penutupan sermon penatua",
      "200.03.02 - Dana Pembinaan untuk Paduan Suara",
      "200.03.03.a - Syukuran Awal Tahun (Jemaat & Pendeta)",
      "200.03.03.b - Snack Kebaktian Awal Tahun Gereja",
      "200.03.03.c - Snack Paskah dan Buha-Buha Ijuk",
      "200.03.04 - Krans Bunga Dukacita bagi Anggota Jemaat",
      "200.03.05 - Bantuan Dukacita bagi Anggota Jemaat",
      "200.03.06.a - Bunga altar pada Kebaktian Minggu",
      "200.03.06.b - Dekorasi pada Kebaktian Hari Besar Kristen",
      "200.03.07 - Keamanan Acara Hari Besar Kristen",
      "200.03.08.a - Kontribusi & Registrasi Peserta Rapat Pendeta",
      "200.03.08.b - Perjalanan Dinas Peserta Rapat Pendeta (2 pendeta)",
      "200.03.09 - Perjalanan Dinas atas undangan Kantor Pusat",
      "200.03.10 - Sidang Umum Jemaat",
      "200.03.11.a - Biaya Tak Terduga (Pengurusan Sertifikat Tanah)",
      "200.03.11.b - Biaya Tak Terduga/Insidentil",
      "200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan",
      "200.04.02 - Inventaris Gereja",
      "200.05.01.a - Kijang Innova, Plat BK 1757 EJ",
      "200.05.01.b - Pajak Kendaraan Kijang Innova",
      "200.05.02.a - HIACE BK.7866 DP",
      "200.05.02.b - Pajak Kendaraan HIACE",
      "200.05.03.a - Roda 2: 1 unit, Plat BK. 5440 AGG",
      "200.05.03.b - Pajak Kendaraan Roda 2",
      "200.06.01 - Telepon, Speedy, MyRepublik dan WA",
      "200.07.01 - Jubah Penatua (Upah Jahit)",
      "200.07.02 - Peralatan & Perlengkapan Inventaris Gereja",
      "200.07.03 - Dekorasi dan Persiapan Natal"
    ],
    
    "400 - PELAYANAN IBADAH": [
      "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI",
      "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota",
      "400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota",
      "400.01.04 - Pengkhotbah Minggu: Di Rumah Duka (Oleh Pendeta)",
      "400.01.05 - Pengkhotbah Minggu: Remaja",
      "400.02.01 - Pengkhotbah Kebaktian di Lingkungan (Wijk)",
      "400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi/Remaja & GSM",
      "400.02.03 - Pengkhotbah Kebaktian Koor Ibu-Ibu",
      "400.02.04 - Pengkhotbah Kebaktian Ibu Hanna",
      "400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)",
      "400.03.01 - Pengkhotbah Perjanjian/Pemberkatan Nikah",
      "400.03.02 - Pengkhotbah Penguburan Jenazah",
      "400.03.03 - Pengkhotbah di Rumah Duka (Oleh Penatua)",
      "400.04.01 - Minggu Pagi 08.00 WIB (@ 13 Orang)",
      "400.04.02 - Minggu Sore: Pukul 18.00 WIB (@ 13 Orang)",
      "400.04.03 - Sekolah Minggu dan Remaja",
      "400.04.04 - Perjanjian/Pemberkatan Pernikahan",
      "400.04.05 - Kebaktian pemberangkatan jenazah",
      "400.04.06 - Minggu Di Rumah Duka",
      "400.04.07 - Pelayanan di Rumah Duka",
      "400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)",
      "400.04.09 - Latihan Pemusik dan Songleader",
      "400.04.10 - Petugas Penghitung Kebaktian Minggu",
      "400.05.01 - Perjamuan Kudus di Gereja",
      "400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi",
      "400.06.01 - Perayaan HUT Jemaat"
    ],

    "600 - PEMBINAAN & PELAYANAN": [
      "600.01.01 - Pendidikan Lanjutan untuk Pendeta",
      "600.01.02 - Penghargaan untuk Penatua",
      "600.01.03 - Pembinaan & Pelatihan Pelajar Sidi",
      "600.01.04 - Pembinaan Penatua se Resort Medan Barat",
      "600.02.01 - Pembinaan & Pelayan Rohani (PPR)",
      "600.02.02 - Pekabaran Injil",
      "600.02.03 - Diakoni Sosial",
      "600.02.04 - Musik, Nyanyian & Koor (MNK)",
      "600.02.05 - Sekolah Minggu",
      "600.02.06 - Remaja",
      "600.02.07 - Pemuda",
      "600.02.08 - Perempuan",
      "600.02.09 - Pria",
      "600.02.10 - Lansia",
      "600.02.11 - Kesehatan",
      "600.02.12 - Pendidikan",
      "600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)",
      "600.02.14 - Sarana & Prasarana",
      "600.02.15 - Natal Gabungan Seksi-Seksi (Natal II)",
      "600.03.01 - Target Ke Kantor Pusat GKPI",
      "600.03.02 - Biaya Tahun Renstra GKPI 2023",
      "600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)",
      "600.04.01 - Target Ke GKPI Resort Medan Barat"
    ],

    "800 - BANTUAN & TUNJANGAN": [
      "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam",
      "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka",
      "800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI",
      "800.01.04 - Bantuan untuk PA. Mamre dan Yapentra",
      "800.01.05 - Bantuan Ke GKPI Lainnya",
      "800.01.06 - Bantuan Kepada Masyarakat di sekitar",
      "800.02.01 - Sekolah Minggu",
      "800.02.02 - Penatua Purna Bakti",
      "800.02.03 - Penatua Aktif",
      "800.02.04 - Calon Penatua Aktif",
      "800.02.05 - Pendeta GKPI Resort Medan Barat",
      "800.02.06 - Anggota Majelis Jemaat: Ketua Seksi & Penasehat",
      "800.02.07 - Guru-Guru Koor di Jemaat",
      "800.02.08 - Guru-Guru Sekolah Minggu",
      "800.02.09 - Pemusik: Pianis, Organis dan Saxophonis",
      "800.02.10 - Songleader",
      "800.02.11 - Petugas Live Streaming"
    ]
  };

  return subCategories[kategori] || [];
}

--------------------------------


Private Sub Worksheet_Change(ByVal Target As Range)
    Dim WatchColumn As Integer
    Dim NewRowPosition As Long

    ' Kolom yang ingin diawasi (misal kolom ke-5 / kolom E)
    WatchColumn = 5 

    ' Pastikan perubahan ada di kolom yang diawasi
    If Not Intersect(Target, Me.Columns(WatchColumn)) Is Nothing Then
        Application.EnableEvents = False
        On Error Resume Next
        
        ' Dapatkan baris baru di bawah data yang diubah
        NewRowPosition = Target.Row + 1
        
        ' Tambahkan baris baru
        Me.Rows(NewRowPosition).Insert Shift:=xlDown

        Application.EnableEvents = True
        On Error GoTo 0
    End If
End Sub



-------------------------
function kelompokkanData() {
  // Mendapatkan spreadsheet aktif dan sheet sumber serta tujuan
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheetSumber = ss.getSheetByName('JUR PENGEL JEMAAT 2024');
  var sheetTujuan = ss.getSheetByName('BUKU BESAR PENGEL JEMAAT 2024');

  if (!sheetSumber || !sheetTujuan) {
    Browser.msgBox('Sheet tidak ditemukan. Pastikan nama sheet benar.');
    return;
  }

  // Mengambil semua data dari sheet sumber
  var data = sheetSumber.getDataRange().getValues();
  
  if (data.length < 2) {
    Browser.msgBox('Tidak ada data untuk diproses.');
    return;
  }

  // Objek untuk menyimpan data berdasarkan kode subkategori
  var kelompok = {};

  // Proses setiap baris data dari sheet sumber
  for (var i = 1; i < data.length; i++) {
    var tgl = data[i][0]; // Kolom A
    var kw = data[i][1]; // Kolom B
    var uraian = data[i][2]; // Kolom C
    var kas = data[i][3]; // Kolom D
    var kodeSub = data[i][4]; // Kolom E sebagai kode subkategori

    if (!tgl || !kodeSub) continue; // Lewati jika tidak ada tanggal atau kode subkategori

    // Jika kode subkategori belum ada, inisialisasi array baru
    if (!kelompok[kodeSub]) {
      kelompok[kodeSub] = [];
    }

    // Simpan data berdasarkan kode subkategori
    kelompok[kodeSub].push([tgl, kw, uraian, kas, kodeSub]);
  }

  // Hapus isi sheet tujuan sebelum menulis data baru
  sheetTujuan.clear();

  var startRow = 1;
  var header = [['Tanggal', 'Kwitansi', 'Uraian', 'Kas', 'Kode Sub']];

  // Menulis data ke sheet tujuan berdasarkan kode subkategori
  for (var kodeSub in kelompok) {
    var subHeader = "Kode Sub: " + kodeSub;
    sheetTujuan.getRange(startRow, 1).setValue(subHeader);
    startRow++;

    sheetTujuan.getRange(startRow, 1, 1, 5).setValues(header);
    startRow++;

    var dataKodeSub = kelompok[kodeSub];

    // Urutkan berdasarkan tanggal (opsional, bisa dihapus jika tidak dibutuhkan)
    dataKodeSub.sort((a, b) => new Date(a[0]) - new Date(b[0]));

    sheetTujuan.getRange(startRow, 1, dataKodeSub.length, 5).setValues(dataKodeSub);
    startRow += dataKodeSub.length + 2; // Tambahkan spasi 2 baris antara kelompok
  }

  Browser.msgBox('Data berhasil dikelompokkan berdasarkan kode subkategori.');
}
-----------------------
3 februari

function kelompokkanData() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var wsSumber = ss.getSheetByName("JUR PENGEL JEMAAT 2024");
  var wsTujuan = ss.getSheetByName("REKAP PENGEL JEMAAT 2024");

  if (!wsSumber || !wsTujuan) {
      Logger.log("Sheet tidak ditemukan. Pastikan 'JUR PENGEL JEMAAT 2024' dan 'REKAP PENGEL JEMAAT 2024' tersedia.");
      return;
  }

  var data = wsSumber.getDataRange().getValues();
  
  if (data.length < 4) {
      Logger.log("Tidak ada data untuk diproses.");
      return;
  }

  var kelompok = {}; // Dictionary untuk menyimpan hasil pengelompokan
  
  Logger.log("Mulai membaca data sumber...");
  
  // Loop melalui data sumber dan mengelompokkan berdasarkan kategori & subkategori
  for (var i = 3; i < data.length; i++) { // Mulai dari baris ke-4
      var tgl = data[i][0]; // Kolom A (Tanggal)
      var kas = data[i][3]; // Kolom D (Kas)
      var kodeKategori = String(data[i][4]).trim(); // Kolom F (Kode Kategori)
      var kodeSubKategori = String(data[i][6]).trim(); // Kolom H (Kode Sub Kategori)
      var kategori = String(data[i][5]).trim(); // Kolom G (Kategori)
      var subKategori = String(data[i][7]).trim(); // Kolom I (Sub Kategori)
      
      var bulan = (tgl instanceof Date) ? "Bulan " + (tgl.getMonth() + 1) : "Undef";

      var key = kodeKategori + "-" + kodeSubKategori;

      if (!kelompok[key]) {
          kelompok[key] = {
              kodeKategori: kodeKategori,
              kodeSubKategori: kodeSubKategori,
              kategori: kategori,
              subKategori: subKategori,
              kasPerBulan: {}
          };
      }

      if (!kelompok[key].kasPerBulan[bulan]) {
          kelompok[key].kasPerBulan[bulan] = 0;
      }

      if (!isNaN(kas) && kas !== "") {
          kelompok[key].kasPerBulan[bulan] += parseFloat(kas);
      }
  }

  Logger.log("Selesai membaca data sumber. Total kategori ditemukan: " + Object.keys(kelompok).length);

  // Hapus semua isi di sheet tujuan sebelum menulis data baru
  wsTujuan.clear();

  var startRow = 1, startCol = 1;

  // Header
  wsTujuan.getRange(startRow, startCol).setValue("REALISASI PENGELUARAN GEREJA SELAMA JANUARI - DES 2024");
  startRow++;
  wsTujuan.getRange(startRow, startCol).setValue("M.A.");
  wsTujuan.getRange(startRow, startCol + 1).setValue("KEGIATAN");
  wsTujuan.getRange(startRow, startCol + 2).setValue("URAIAN KEGIATAN");

  // Header Bulanan
  for (var bulanIndex = 1; bulanIndex <= 12; bulanIndex++) {
      wsTujuan.getRange(startRow, startCol + 2 + bulanIndex).setValue(getBulanNama(bulanIndex));
  }
  wsTujuan.getRange(startRow, startCol + 15).setValue("Total");
  startRow++;

  // Struktur Tabel Kategori & Subkategori
  var struktur = [
  // Administrasi Gereja
  ["200.01", "Administrasi Gereja", "Pendeta Pimpinan Jemaat"],
  ["200.01", "Administrasi Gereja", "Pendeta Khusus / Vikaris"],
  ["200.01", "Administrasi Gereja", "Guru Jemaat"],
  ["200.01", "Administrasi Gereja", "Sekretaris dan Bendahara Jemaat"],
  ["200.01", "Administrasi Gereja", "Pegawai Administrasi: Kantor GKPI Medan Kota"],
  ["200.01", "Administrasi Gereja", "Pegawai Kebersihan & Teknisi"],
  ["200.01", "Administrasi Gereja", "Gedung Gereja"],
  ["200.01", "Administrasi Gereja", "Pekarangan & Taman Gereja"],
  ["200.01", "Administrasi Gereja", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"],
  ["200.01", "Administrasi Gereja", "Jaga Malam"],
  ["200.01", "Administrasi Gereja", "Gedung Multifungsi"],
  ["200.01", "Administrasi Gereja", "Soundman"],
  ["200.01", "Administrasi Gereja", "Administrasi Guru Sekolah Minggu (dan Remaja)"],
  ["200.01", "Administrasi Gereja", "Pengawas Parkir (Minggu & Hari Besar)"],

  // Administrasi Kantor
  ["200.02", "Administrasi Kantor", "Alat Tulis Kantor, Penggandaan dan Cetakan"],
  ["200.02", "Administrasi Kantor", "Rapat dan Pertemuan Majelis Jemaat"],
  ["200.02", "Administrasi Kantor", "Insentif / Lembur Pegawai"],
  ["200.02", "Administrasi Kantor", "Minum & Konsumsi Kantor, Jemaat & Tamu"],
  ["200.02", "Administrasi Kantor", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"],
  ["200.02", "Administrasi Kantor", "Transport, Kurir, Benda pos"],

  // Administrasi & Umum
  ["200.03", "Administrasi & Umum", "Sermon Penatua"],
  ["200.03", "Administrasi & Umum", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"],
  ["200.03", "Administrasi & Umum", "Syukuran Awal Tahun (Jemaat & Pendeta)"],

  // Pemeliharaan Rutin Gereja
  ["200.04", "Pemeliharaan Rutin Gereja", "Inventaris Gereja"],

  // Eksploitasi - Kendaraan Dinas Gereja
  ["200.05", "Eksploitasi - Kendaraan Dinas Gereja", "Roda 4(Empat) : Kijang Innova, Plat BK 1757 EJ"],
  ["200.05", "Eksploitasi - Kendaraan Dinas Gereja", "Pajak Kenderaan Kijang Innova, Plat BK 1757 EJ"],
  ["200.05", "Eksploitasi - Kendaraan Dinas Gereja", "Roda 4(Empat) : HIACE BK.7866 DP"],
  ["200.05", "Eksploitasi - Kendaraan Dinas Gereja", "Pajak Kenderaan Roda 4(Empat) : HIACE BK.7866 DP"],
  ["200.05", "Eksploitasi - Kendaraan Dinas Gereja", "Roda 2(dua) : 1 unit, Plat BK. 5440 AGG"],
  ["200.05", "Eksploitasi - Kendaraan Dinas Gereja", "Pajak Kendaraan Roda 2(dua) : 1 unit, Plat BK. 5440 AGG"],

  // Daya & Jasa
  ["200.06", "Daya & Jasa", "Telepon Kantor (Gereja / Jemaat) : (061) 453-4521, Speedy, My republik dan Wa"],

  // Pengadaan Inventaris Gereja
  ["200.07", "Pengadaan Inventaris Gereja", "Jubah Penatua"],
  ["200.07", "Pengadaan Inventaris Gereja", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"],
  ["200.07", "Pengadaan Inventaris Gereja", "Dekorasi dan Persiapan Natal"],

  // Ibadah Minggu
  ["400.01", "Ibadah Minggu", "Pengkhotbah Minggu : Di Rumah Duka"],
  ["400.01", "Ibadah Minggu", "Pengkhotbah Minggu : Remaja"],

  // Ibadah / Persekutuan Doa / Kebaktian
  ["400.02", "Ibadah / Persekutuan Doa / Kebaktian", "Pengkhotbah Kebaktian Lingkungan"],
  ["400.02", "Ibadah / Persekutuan Doa / Kebaktian", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"],
  ["400.02", "Ibadah / Persekutuan Doa / Kebaktian", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"],
  ["400.02", "Ibadah / Persekutuan Doa / Kebaktian", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"],
  ["400.02", "Ibadah / Persekutuan Doa / Kebaktian", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"],

  // Ibadah Khusus
  ["400.03", "Ibadah Khusus", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"],
  ["400.03", "Ibadah Khusus", "Pengkhotbah Kebak. Penguburan Jenazah"],
  ["400.03", "Ibadah Khusus", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"],

  // Pendidikan & Pembinaan
  ["600.01", "Pendidikan & Pembinaan", "Pendidikan Lanjutan Untuk Pendeta"],
  ["600.01", "Pendidikan & Pembinaan", "Penghargaan Untuk Penatua"],
  ["600.01", "Pendidikan & Pembinaan", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"],
  ["600.01", "Pendidikan & Pembinaan", "Pembinaan Penatua se Resort Medan Barat"],

  // Program Kerja Seksi
  ["600.02", "Program Kerja Seksi", "Pembinaan & Pelayanan Rohani (PPR)"],
  ["600.02", "Program Kerja Seksi", "Pekabaran Injil (PI)"],
  ["600.02", "Program Kerja Seksi", "Diakoni"],
  ["600.02", "Program Kerja Seksi", "Musik, Nyanyian & Koor (MNK)"],
  ["600.02", "Program Kerja Seksi", "Sekolah Minggu"],
  ["600.02", "Program Kerja Seksi", "Remaja"],
  ["600.02", "Program Kerja Seksi", "Pemuda"],
  ["600.02", "Program Kerja Seksi", "Perempuan"],
  ["600.02", "Program Kerja Seksi", "Pria"],
  ["600.02", "Program Kerja Seksi", "Lansia"],
  ["600.02", "Program Kerja Seksi", "Kesehatan"],
  ["600.02", "Program Kerja Seksi", "Pendidikan"],
  ["600.02", "Program Kerja Seksi", "Usaha & Pengembangan Sumber Daya (UPSD)"],
  ["600.02", "Program Kerja Seksi", "Sarana & Prasarana"],
  ["600.02", "Program Kerja Seksi", "Natal Gabungan Seksi-seksi (Natal II)"]
  ["600.03", "Bakti Bulanan / Target ke Kantor Pusat", "Target Ke Kantor Pusat GKPI"],
  ["600.03", "Bakti Bulanan / Target ke Kantor Pusat", "Biaya Tahun Renstra GKPI 2023"],
  ["600.03", "Bakti Bulanan / Target ke Kantor Pusat", "Kantor Sinode GKPI (Persembahan Kedua)"],
  ["600.04", "Target Ke GKPI Ressort Medan Barat", "Target Ke GKPI Ressort Medan Barat"],


  ["800.01", "Bantuan Kemanusiaan / Jemaat", "Bantuan ke Jemaat untuk musibah/bencana alam"],
  ["800.01", "Bantuan Kemanusiaan / Jemaat", "Akomodasi Acara Penghiburan ke rumah duka"],
  ["800.01", "Bantuan Kemanusiaan / Jemaat", "Bantuan untuk Dana Pensiun Pendeta GKPI"],
  ["800.01", "Bantuan Kemanusiaan / Jemaat", "Bantuan untuk PA. Mamre dan Yapentra"],
  ["800.01", "Bantuan Kemanusiaan / Jemaat", "Bantuan Ke GKPI Lainnya"],
  ["800.02", "Bingkisan Natal", "Anak - Anak Sekolah Minggu"],
  ["800.02", "Bingkisan Natal", "Penatua Purnabakti"],
  ["800.02", "Bingkisan Natal", "Penatua Aktif"],
  ["800.02", "Bingkisan Natal", "Calon Penatua"],
  ["800.02", "Bingkisan Natal", "Pendeta GKPI Ressort Medan Barat"],
  ["800.02", "Bingkisan Natal", "Anggota Majelis Jemaat : Ketua Seksi, Penasehat, PHBK"],
  ["800.02", "Bingkisan Natal", "Guru-Guru Koor di Jemaat GKPI Medan Kota"],
  ["800.02", "Bingkisan Natal", "Guru-Guru Sekolah Minggu"],
  ["800.02", "Bingkisan Natal", "Pemusik : (Organis, Pianis dan Saxophonis)"],
  ["800.02", "Bingkisan Natal", "Songleader (Pemandu Lagu)"],
  ["800.02", "Bingkisan Natal", "Petugas Live Streaming Minggu"]
];

  // Pastikan struktur terdefinisi dan memiliki elemen
  if (!Array.isArray(struktur) || struktur.length === 0) {
      Logger.log("Struktur tidak terdefinisi atau kosong.");
      return;
  }

  // Tulis Struktur Kategori & Subkategori
  for (var i = 0; i < struktur.length; i++) {
      if (!Array.isArray(struktur[i]) || struktur[i].length < 3) {
          Logger.log("Data tidak lengkap atau tidak valid pada indeks: " + i);
          continue; // Lewati iterasi jika data tidak lengkap atau tidak valid
      }

      wsTujuan.getRange(startRow, startCol).setValue(struktur[i][0]); // Kode Kategori
      wsTujuan.getRange(startRow, startCol + 1).setValue(struktur[i][1]); // Nama Kategori
      wsTujuan.getRange(startRow, startCol + 2).setValue(struktur[i][2]); // Uraian

      var totalPerRow = 0;
      for (var bulanIndex = 1; bulanIndex <= 12; bulanIndex++) {
          var key = struktur[i][0] + "-" + struktur[i][1];
          var kasBulan = (kelompok[key]?.kasPerBulan["Bulan " + bulanIndex]) || 0;
          Logger.log("Menulis kas untuk " + key + " bulan " + bulanIndex + ": " + kasBulan);
          wsTujuan.getRange(startRow, startCol + 2 + bulanIndex).setValue(kasBulan);
          totalPerRow += kasBulan;
      }

      wsTujuan.getRange(startRow, startCol + 15).setValue(totalPerRow);
      startRow++;
  }

  Logger.log("Selesai menulis data ke sheet tujuan.");
  Logger.log("Proses pengelompokan data selesai.");
}

/**
* Fungsi untuk mendapatkan nama bulan dalam bahasa Indonesia
*/
function getBulanNama(index) {
  var bulan = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
  return bulan[index - 1];
}
-------------------------------
array lengkap: function getPengeluaranGereja() {
  const pengeluaranGereja = [
    {
      kategori: "ADMINISTRASI GEREJA",
      subkategori: [
        {
          kode: "200.01",
          nama: "TUNJANGAN & PENGGANTI TRANSPORT",
          kegiatan: [
            { no: 1, nama: "Pendeta Pimpinan Jemaat" },
            { no: 2, nama: "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)" },
            { no: 3, nama: "Guru Jemaat" },
            { no: 4, nama: "Sekretaris dan Bendahara Jemaat" },
            { no: 5, nama: "Pegawai Administrasi: Kantor GKPI Medan Kota" },
            { no: 6, nama: "Pegawai Kebersihan & Teknisi" },
            {
              no: 7,
              nama: "Kegiatan Kebersihan & Teknisi",
              sub_kegiatan: [
                { no: 'a', nama: "Gedung Gereja" },
                { no: 'b', nama: "Pekarangan & Taman Gereja" },
                { no: 'c', nama: "Supir Mobil Dinas & Ambulance GKPI Medan Kota" },
                { no: 'd', nama: "Jaga Malam" },
                { no: 'e', nama: "Gedung Multifungsi" },
                { no: 'f', nama: "Soundman" }
              ]
            },
            { no: 8, nama: "Administrasi Guru Sekolah Minggu (dan Remaja)" },
            { no: 9, nama: "Pengawas Parkir (Minggu & Hari Besar)" }
          ]
        },
        {
          kode: "200.02",
          nama: "ADMINISTRASI KANTOR",
          kegiatan: [
            { no: 1, nama: "Alat Tulis Kantor, Penggandaan dan Cetakan" },
            { no: 2, nama: "Rapat dan Pertemuan Majelis Jemaat" },
            { no: 3, nama: "Insentif / Lembur Pegawai" },
            { no: 4, nama: "Minum & Konsumsi Kantor, Jemaat & Tamu" },
            {
              no: 5,
              nama: "Minum & Konsumsi Kantor, Jemaat",
              sub_kegiatan: [
                { no: 'a', nama: "Minum & Konsumsi Kantor, Jemaat" },
                { no: 'b', nama: "Biaya Makan Tamu Gereja" },
                { no: 'c', nama: "Biaya Snack untuk Pemusik & Songleader" }
              ]
            },
            { no: 6, nama: "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)" },
            { no: 7, nama: "Transport, Kurir, Benda pos" }
          ]
        },
        {
          kode: "200.03",
          nama: "ADMINISTRASI & UMUM",
          kegiatan: [
            { no: 1, nama: "Sermon Penatua" },
            {
              no: 2,
              nama: "Snack dan Minuman Sermon Penatua",
              sub_kegiatan: [
                { no: 'a', nama: "Snack dan Minuman" },
                { no: 'b', nama: "Penyediaan Makanan Pembukaan dan Penutupan" }
              ]
            },
            { no: 3, nama: "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota" },
            {
              no: 4,
              nama: "Syukuran Awal Tahun (Jemaat & Pendeta)",
              sub_kegiatan: [
                { no: 'a', nama: "Snack Kebaktian Pembukaan dan Tutup Tahun Gereja" },
                { no: 'b', nama: "Snack Paskah dan Buha - Buha Ijuk" }
              ]
            },
            { no: 5, nama: "Krans Bunga Dukacita bagi Anggota Jemaat" },
            { no: 6, nama: "Bantuan Dukacita bagi Anggota Jemaat" },
            {
              no: 7,
              nama: "Bunga untuk Altar",
              sub_kegiatan: [
                { no: 'a', nama: "Bunga altar pada Kebaktian Minggu" },
                { no: 'b', nama: "Dekorasi pada Kebaktian Hari Besar Kristen" }
              ]
            },
            { no: 8, nama: "Keamanan Acara Hari Besar Kristen" },
            {
              no: 9,
              nama: "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023",
              sub_kegiatan: [
                { no: 'a', nama: "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023" },
                { no: 'b', nama: "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023" }
              ]
            },
            { no: 10, nama: "Perjalanan Dinas atas undangan Kantor Pusat GKPI" },
            { no: 11, nama: "Sidang Umum Jemaat GKPI Medan Kota" },
            { no: 12, nama: "Biaya Tak Terduga / Insidentil" }
          ]
        },
        {
          kode: "200.04",
          nama: "PEMELIHARAAN RUTIN GEREJA",
          kegiatan: [
            { no: 1, nama: "Gedung Gereja, Rumah Dinas & Pekarangan" },
            { no: 2, nama: "Inventaris Gereja" }
          ]
        },
        {
          kode: "200.05",
          nama: "EKSPLOITASI - KENDARAAN DINAS GEREJA",
          kegiatan: [
            {
              no: 1,
              nama: "Roda 4(Empat)",
              sub_kegiatan: [
                { no: 'a', nama: "Kijang Innova, Plat BK 1757 EJ" },
                { no: 'b', nama: "Pajak Kenderaan Kijang Innova, Plat BK 1757 EJ" }
              ]
            },
            {
              no: 2,
              nama: "Roda 4(Empat)",
              sub_kegiatan: [
                { no: 'a', nama: "HIACE BK.7866 DP" },
                { no: 'b', nama: "Pajak Kenderaan Roda 4(Empat): HIACE BK.7866 DP" }
              ]
            },
            {
              no: 3,
              nama: "Roda 2(dua)",
              sub_kegiatan: [
                { no: 'a', nama: "1 unit, Plat BK. 5440 AGG" },
                { no: 'b', nama: "Pajak Kendaraan Roda 2(dua): 1 unit, Plat BK. 5440 AGG" }
              ]
            }
          ]
        },
        {
          kode: "200.06",
          nama: "DAYA & JASA",
          kegiatan: [
            { no: 1, nama: "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My republik dan Wa" }
          ]
        },
        {
          kode: "200.07",
          nama: "PENGADAAN INVENTARIS GEREJA",
          kegiatan: [
            { no: 1, nama: "Jubah Penatua" },
            { no: 2, nama: "Pengadaan Peralatan & Perlengkapan Inventaris Gereja" },
            { no: 3, nama: "Dekorasi dan Persiapan Natal" }
          ]
        }
      ]
    },
    {
      kategori: "BIDANG APOSTOLAT",
      subkategori: [
        {
          kode: "400.01",
          nama: "IBADAH MINGGU",
          kegiatan: [
            { no: 1, nama: "Pengkhotbah Minggu: Pimpinan Sinode GKPI" },
            { no: 2, nama: "Pengkhotbah Minggu: Dari Luar Kota" },
            { no: 3, nama: "Pengkhotbah Minggu: Dari Dalam Kota" },
            { no: 4, nama: "Pengkhotbah Minggu: Di Rumah Duka" },
            { no: 5, nama: "Pengkhotbah Minggu: Remaja" }
          ]
        },
        {
          kode: "400.02",
          nama: "IBADAH / PERSEKUTUAN DOA / KEBAKTIAN",
          kegiatan: [
            { no: 1, nama: "Pengkhotbah Kebaktian Lingkungan" },
            { no: 2, nama: "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM" },
            { no: 3, nama: "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu" },
            { no: 4, nama: "Pengkhotbah Kebaktian Ibu Hanna & Diakoni" },
            { no: 5, nama: "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)" }
          ]
        },
        {
          kode: "400.03",
          nama: "IBADAH KHUSUS",
          kegiatan: [
            { no: 1, nama: "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah" },
            { no: 2, nama: "Pengkhotbah Kebak. Penguburan Jenazah" },
            { no: 3, nama: "Pengkhotbah Kebak. di Rumah Duka oleh Penatua" }
          ]
        },
        {
          kode: "400.04",
          nama: "PETUGAS KEBAKTIAN",
          kegiatan: [
            { no: 1, nama: "Minggu Pagi: Pukul 08.00 WIB" },
            { no: 2, nama: "Minggu Sore: Pukul 18.00 WIB" },
            { no: 3, nama: "Sekolah Minggu & Remaja" },
            { no: 4, nama: "Perjanjian / Pemberkatan Nikah" },
            { no: 5, nama: "Kebaktian pemberangkatan jenazah (pemusik & songleader)" },
            { no: 6, nama: "Kebaktian di Rumah Duka" },
            { no: 7, nama: "Pelayanan di Rumah Duka" },
            { no: 8, nama: "Guru Sekolah Minggu (Sermon & Mengajar)" },
            { no: 9, nama: "Latihan Pemusik dan Songleader" },
            { no: 10, nama: "Petugas Penghitung Kebaktian Minggu" }
          ]
        },
        {
          kode: "400.05",
          nama: "PELAYANAN SAKRAMEN",
          kegiatan: [
            { no: 1, nama: "Perjamuan Kudus di Gereja" },
            { no: 2, nama: "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021" }
          ]
        },
        {
          kode: "400.06",
          nama: "HUT GKPI MEDAN KOTA",
          kegiatan: []
        }
      ]
    },
    {
      kategori: "BIDANG PASTORAT",
      subkategori: [
        {
          kode: "600.01",
          nama: "PENDIDIKAN & PEMBINAAN",
          kegiatan: [
            { no: 1, nama: "Pendidikan Lanjutan Untuk Pendeta" },
            { no: 2, nama: "Penghargaan Untuk Penatua" },
            { no: 3, nama: "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota" },
            { no: 4, nama: "Pembinaan Penatua se Resort Medan Barat" }
          ]
        },
        {
          kode: "600.02",
          nama: "PROGRAM KERJA SEKSI",
          kegiatan: [
            { no: 1, nama: "Pembinaan & Pelayanan Rohani (PPR)" },
            { no: 2, nama: "Pekabaran Injil (PI)" },
            { no: 3, nama: "Diakoni" },
            { no: 4, nama: "Musik, Nyanyian & Koor (MNK)" },
            { no: 5, nama: "Sekolah Minggu" },
            { no: 6, nama: "Remaja" },
            { no: 7, nama: "Pemuda" },
            { no: 8, nama: "Perempuan" },
            { no: 9, nama: "Pria" },
            { no: 10, nama: "Lansia" },
            { no: 11, nama: "Kesehatan" },
            { no: 12, nama: "Pendidikan" },
            { no: 13, nama: "Usaha & Pengembangan Sumber Daya (UPSD)" },
            { no: 14, nama: "Sarana & Prasarana" },
            { no: 15, nama: "Natal Gabungan Seksi-seksi (Natal II)" }
          ]
        },
        {
          kode: "600.03",
          nama: "BAKTI BULANAN / TARGET KE KANTOR PUSAT",
          kegiatan: [
            { no: 1, nama: "Target Ke Kantor Pusat GKPI" },
            { no: 2, nama: "Biaya Tahun Renstra GKPI 2023" },
            { no: 3, nama: "Kantor Sinode GKPI (Persembahan Kedua)" }
          ]
        },
        {
          kode: "600.04",
          nama: "Target Ke GKPI Ressort Medan Barat",
          kegiatan: [
            { no: 1, nama: "Target Ke GKPI Ressort Medan Barat" }
          ]
        }
      ]
    },
    {
      kategori: "BIDANG DIAKONAT",
      subkategori: [
        {
          kode: "800.01",
          nama: "BANTUAN KEMANUSIAAN / JEMAAT",
          kegiatan: [
            { no: 1, nama: "Bantuan ke Jemaat untuk musibah/bencana alam" },
            { no: 2, nama: "Akomodasi Acara Penghiburan ke rumah duka" },
            { no: 3, nama: "Bantuan untuk Dana Pensiun Pendeta GKPI" },
            { no: 4, nama: "Bantuan untuk PA. Mamre dan Yapentra" },
            { no: 5, nama: "Bantuan Ke GKPI Lainnya" }
          ]
        },
        {
          kode: "800.02",
          nama: "BINGKISAN NATAL",
          kegiatan: [
            { no: 1, nama: "Anak - Anak Sekolah Minggu" },
            { no: 2, nama: "Penatua Purnabakti" },
            { no: 3, nama: "Penatua Aktif" },
            { no: 4, nama: "Calon Penatua" },
            { no: 5, nama: "Pendeta GKPI Ressort Medan Barat" },
            { no: 6, nama: "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK" },
            { no: 7, nama: "Guru-Guru Koor di Jemaat GKPI Medan Kota" },
            { no: 8, nama: "Guru-Guru Sekolah Minggu" },
            { no: 9, nama: "Pemusik: (Organis, Pianis dan Saxophonis)" },
            { no: 10, nama: "Songleader (Pemandu Lagu)" },
            { no: 11, nama: "Petugas Live Streaming Minggu" }
          ]
        }
      ]
    }
  ];
  
  return pengeluaranGereja;
}
-------------------

kak Sitanggang +62 838-7020-6424


Maya Simbolon istrinya tukang +62 895-6220-50003


---------------------------
14 feb
program sheet 2 yang udah terbentuk format kode yg benar:
Sub kelompokkanData()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    Set wsSumber = wb.Sheets("JUR PENGEL JEMAAT 2024")
    Set wsTujuan = wb.Sheets("REKAP PENGEL JEMAAT 2024")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan 'JUR PENGEL JEMAAT 2024' dan 'REKAP PENGEL JEMAAT 2024' tersedia."
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    If UBound(data, 1) < 3 Then
        MsgBox "Tidak ada data untuk diproses."
        Exit Sub
    End If
    
    Dim kelompok As Object
    Set kelompok = CreateObject("Scripting.Dictionary")
    
    Dim i As Integer, j As Integer
    Dim tgl As Variant, kwitansi As Variant, uraian As Variant, kas As Variant
    Dim kodeSub As String, bulan As String
    
    For i = 4 To UBound(data, 1) ' Mulai dari baris ke-4
        tgl = data(i, 1)
        kwitansi = data(i, 2)
        uraian = data(i, 3)
        kas = data(i, 4)
        
        If IsDate(tgl) Then
            bulan = "Bulan " & Month(tgl)
        Else
            bulan = "Undef"
        End If
        
        kodeSub = Trim(data(i, 5) & data(i, 7) & data(i, 9) & data(i, 11))
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        If Not kelompok.exists(bulan) Then
            kelompok.Add bulan, CreateObject("Scripting.Dictionary")
        End If
        
        If Not kelompok(bulan).exists(kodeSub) Then
            kelompok(bulan).Add kodeSub, Array()
        End If
        
        Dim tempArray As Variant
        tempArray = kelompok(bulan)(kodeSub)
        ReDim Preserve tempArray(UBound(tempArray) + 1)
        tempArray(UBound(tempArray)) = Array(tgl, kwitansi, uraian, kas, kodeSub)
        kelompok(bulan)(kodeSub) = tempArray
    Next i
    
    wsTujuan.Cells.Clear
    
    Dim startRow As Integer, startCol As Integer
    startCol = 1
    Dim colSpacing As Integer
    colSpacing = 3
    
    Dim bulanKey As Variant, kodeSubKey As Variant
    For Each bulanKey In kelompok.keys
        startRow = 1
        wsTujuan.Cells(startRow, startCol).Value = bulanKey
        startRow = startRow + 1
        
        For Each kodeSubKey In kelompok(bulanKey).keys
            wsTujuan.Cells(startRow, startCol).Value = "Subkategori: " & kodeSubKey
            startRow = startRow + 1
            
            wsTujuan.Cells(startRow, startCol).Resize(1, 5).Value = Array("Tanggal", "Kwitansi", "Uraian", "Kas", "Kode Subkategori")
            startRow = startRow + 1
            
            Dim dataKodeSub As Variant
            dataKodeSub = kelompok(bulanKey)(kodeSubKey)
            
            Dim sortedData() As Variant
            sortedData = dataKodeSub
            
            Dim r As Integer, c As Integer
            Dim totalKas As Double
            totalKas = 0
            
            For r = LBound(sortedData) To UBound(sortedData)
                If UBound(sortedData(r)) >= 3 Then
                    If Not IsEmpty(sortedData(r)(3)) And IsNumeric(sortedData(r)(3)) Then
                        totalKas = totalKas + CDbl(sortedData(r)(3))
                    End If
                End If
                For c = LBound(sortedData(r)) To UBound(sortedData(r))
                    wsTujuan.Cells(startRow + r, startCol + c).Value = sortedData(r)(c)
                Next c
            Next r
            
            startRow = startRow + UBound(sortedData) + 1
            
            ' Menampilkan total kas
            wsTujuan.Cells(startRow, startCol).Value = "Total Kas " & kodeSubKey
            wsTujuan.Cells(startRow, startCol + 3).Value = totalKas
            startRow = startRow + 2
        Next kodeSubKey
        
        startCol = startCol + 7 + colSpacing
    Next bulanKey
    
    MsgBox "Pengecekan kode sub, pengelompokan data, dan perhitungan total kas selesai."
End Sub

--------------------------
vba sheet3:
Sub KelompokkanData()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("2")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan 'JUR PENGEL JEMAAT 2024' dan 'REKAP PENGEL JEMAAT 2024' tersedia."
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    If UBound(data, 1) < 3 Then
        MsgBox "Tidak ada data untuk diproses."
        Exit Sub
    End If
    
    Dim kelompok As Object
    Set kelompok = CreateObject("Scripting.Dictionary")
    
    Dim i As Integer, j As Integer
    Dim tgl As Variant, kwitansi As Variant, uraian As Variant, kas As Variant
    Dim kodeSub As String, bulan As String
    
    For i = 4 To UBound(data, 1) ' Mulai dari baris ke-4
        tgl = data(i, 1)
        kwitansi = data(i, 2)
        uraian = data(i, 3)
        kas = data(i, 4)
        
        If IsDate(tgl) Then
            bulan = "Bulan " & Month(tgl)
        Else
            bulan = "Undef"
        End If
        
        kodeSub = Trim(data(i, 5) & data(i, 7) & data(i, 9) & data(i, 11))
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        If Not kelompok.exists(bulan) Then
            kelompok.Add bulan, CreateObject("Scripting.Dictionary")
        End If
        
        If Not kelompok(bulan).exists(kodeSub) Then
            kelompok(bulan).Add kodeSub, Array()
        End If
        
        Dim tempArray As Variant
        tempArray = kelompok(bulan)(kodeSub)
        ReDim Preserve tempArray(UBound(tempArray) + 1)
        tempArray(UBound(tempArray)) = Array(tgl, kwitansi, uraian, kas, kodeSub)
        kelompok(bulan)(kodeSub) = tempArray
    Next i
    
    wsTujuan.Cells.Clear
    
    Dim startRow As Integer, startCol As Integer
    startCol = 1
    Dim colSpacing As Integer
    colSpacing = 3
    
    Dim bulanKey As Variant, kodeSubKey As Variant
    For Each bulanKey In kelompok.keys
        startRow = 1
        wsTujuan.Cells(startRow, startCol).Value = bulanKey
        startRow = startRow + 1
        
        For Each kodeSubKey In kelompok(bulanKey).keys
            wsTujuan.Cells(startRow, startCol).Value = "Subkategori: " & kodeSubKey
            startRow = startRow + 1
            
            wsTujuan.Cells(startRow, startCol).Resize(1, 5).Value = Array("Tanggal", "Kwitansi", "Uraian", "Kas", "Kode Subkategori")
            startRow = startRow + 1
            
            Dim dataKodeSub As Variant
            dataKodeSub = kelompok(bulanKey)(kodeSubKey)
            
            Dim sortedData() As Variant
            sortedData = dataKodeSub
            
            Dim r As Integer, c As Integer
            Dim totalKas As Double
            totalKas = 0
            
            For r = LBound(sortedData) To UBound(sortedData)
                If UBound(sortedData(r)) >= 3 Then
                    If Not IsEmpty(sortedData(r)(3)) And IsNumeric(sortedData(r)(3)) Then
                        totalKas = totalKas + CDbl(sortedData(r)(3))
                    End If
                End If
                For c = LBound(sortedData(r)) To UBound(sortedData(r))
                    wsTujuan.Cells(startRow + r, startCol + c).Value = sortedData(r)(c)
                Next c
            Next r
            
            startRow = startRow + UBound(sortedData) + 1
            
            ' Menampilkan total kas
            wsTujuan.Cells(startRow, startCol).Value = "Total Kas " & kodeSubKey
            wsTujuan.Cells(startRow, startCol + 3).Value = totalKas
            startRow = startRow + 2
        Next kodeSubKey
        
        startCol = startCol + 7 + colSpacing
    Next bulanKey
    
    MsgBox "Pengecekan kode sub, pengelompokan data, dan perhitungan total kas selesai."
End Sub


---------------------
sheet 2:
Sub KelompokkanData()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("2")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan 'JUR PENGEL JEMAAT 2024' dan 'REKAP PENGEL JEMAAT 2024' tersedia."
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    If UBound(data, 1) < 3 Then
        MsgBox "Tidak ada data untuk diproses."
        Exit Sub
    End If
    
    Dim kelompok As Object
    Set kelompok = CreateObject("Scripting.Dictionary")
    
    Dim i As Integer, j As Integer
    Dim tgl As Variant, kwitansi As Variant, uraian As Variant, kas As Variant
    Dim kodeSub As String, bulan As String
    
    For i = 4 To UBound(data, 1) ' Mulai dari baris ke-4
        tgl = data(i, 1)
        kwitansi = data(i, 2)
        uraian = data(i, 3)
        kas = data(i, 4)
        
        If IsDate(tgl) Then
            bulan = "Bulan " & Month(tgl)
        Else
            bulan = "Undef"
        End If
        
        kodeSub = Trim(data(i, 5) & data(i, 7) & data(i, 9) & data(i, 11))
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        If Not kelompok.exists(bulan) Then
            kelompok.Add bulan, CreateObject("Scripting.Dictionary")
        End If
        
        If Not kelompok(bulan).exists(kodeSub) Then
            kelompok(bulan).Add kodeSub, Array()
        End If
        
        Dim tempArray As Variant
        tempArray = kelompok(bulan)(kodeSub)
        ReDim Preserve tempArray(UBound(tempArray) + 1)
        tempArray(UBound(tempArray)) = Array(tgl, kwitansi, uraian, kas, kodeSub)
        kelompok(bulan)(kodeSub) = tempArray
    Next i
    
    wsTujuan.Cells.Clear
    
    Dim startRow As Integer, startCol As Integer
    startCol = 1
    Dim colSpacing As Integer
    colSpacing = 3
    
    Dim bulanKey As Variant, kodeSubKey As Variant
    For Each bulanKey In kelompok.keys
        startRow = 1
        wsTujuan.Cells(startRow, startCol).Value = bulanKey
        startRow = startRow + 1
        
        For Each kodeSubKey In kelompok(bulanKey).keys
            wsTujuan.Cells(startRow, startCol).Value = "Subkategori: " & kodeSubKey
            startRow = startRow + 1
            
            wsTujuan.Cells(startRow, startCol).Resize(1, 5).Value = Array("Tanggal", "Kwitansi", "Uraian", "Kas", "Kode Subkategori")
            startRow = startRow + 1
            
            Dim dataKodeSub As Variant
            dataKodeSub = kelompok(bulanKey)(kodeSubKey)
            
            Dim sortedData() As Variant
            sortedData = dataKodeSub
            
            Dim r As Integer, c As Integer
            Dim totalKas As Double
            totalKas = 0
            
            For r = LBound(sortedData) To UBound(sortedData)
                If UBound(sortedData(r)) >= 3 Then
                    If Not IsEmpty(sortedData(r)(3)) And IsNumeric(sortedData(r)(3)) Then
                        totalKas = totalKas + CDbl(sortedData(r)(3))
                    End If
                End If
                For c = LBound(sortedData(r)) To UBound(sortedData(r))
                    wsTujuan.Cells(startRow + r, startCol + c).Value = sortedData(r)(c)
                Next c
            Next r
            
            startRow = startRow + UBound(sortedData) + 1
            
            ' Menampilkan total kas
            wsTujuan.Cells(startRow, startCol).Value = "Total Kas " & kodeSubKey
            wsTujuan.Cells(startRow, startCol + 3).Value = totalKas
            startRow = startRow + 2
        Next kodeSubKey
        
        startCol = startCol + 7 + colSpacing
    Next bulanKey
    
    MsgBox "Pengecekan kode sub, pengelompokan data, dan perhitungan total kas selesai."
End Sub


-----------------------------
Kode mata anggaran yang lengkap:
1. ADMINISTRASI GEREJA
   TUNJANGAN & PENGGANTI TRANSPORT (Kode: 200.01)

   200.01.01 - Pendeta Pimpinan Jemaat
   200.01.02 - Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)
   200.01.03 - Guru Jemaat
   200.01.04 - Sekretaris dan Bendahara Jemaat
   200.01.05 - Pegawai Administrasi: Kantor GKPI Medan Kota
   200.01.06 - Pegawai Kebersihan & Teknisi
   200.01.06a - Gedung Gereja
   200.01.06b - Pekarangan & Taman Gereja
   200.01.06c - Supir Mobil Dinas & Ambulance GKPI Medan Kota
   200.01.06d - Jaga Malam
   200.01.06e - Gedung Multifungsi
   200.01.06f - Soundman
   200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)
   200.01.08 - Pengawas Parkir (Minggu & Hari Besar)

2. ADMINISTRASI KANTOR (Kode: 200.02)

   200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan
   200.02.02 - Rapat dan Pertemuan Majelis Jemaat
   200.02.03 - Insentif / Lembur Pegawai
   200.02.04 - Minum & Konsumsi Kantor, Jemaat & Tamu
   200.02.04a - Minum & Konsumsi Kantor, Jemaat
   200.02.04b - Biaya Makan Tamu Gereja
   200.02.04c - Biaya Snack untuk Pemusik & Songleader
   200.02.05 - Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)
   200.02.06 - Transport, Kurir, Benda pos

3. ADMINISTRASI & UMUM (Kode: 200.03)

   200.03.01 - Sermon Penatua
   200.03.02 - Snack dan Minuman Sermon Penatua
   200.03.02a - Snack dan Minuman
   200.03.02b - Penyediaan Makanan Pembukaan dan Penutupan
   200.03.03 - Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota
   200.03.04 - Syukuran Awal Tahun (Jemaat & Pendeta)
   200.03.04a - Snack Kebaktian Pembukaan dan Tutup Tahun Gereja
   200.03.04b - Snack Paskah dan Buha - Buha Ijuk
   200.03.05 - Krans Bunga Dukacita bagi Anggota Jemaat
   200.03.06 - Bantuan Dukacita bagi Anggota Jemaat
   200.03.07 - Bunga untuk Altar
   200.03.07a - Bunga altar pada Kebaktian Minggu
   200.03.07b - Dekorasi pada Kebaktian Hari Besar Kristen
   200.03.08 - Keamanan Acara Hari Besar Kristen
   200.03.09 - Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023
   200.03.09a - Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023
   200.03.09b - Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023
   200.03.10 - Perjalanan Dinas atas undangan Kantor Pusat GKPI
   200.03.11 - Sidang Umum Jemaat GKPI Medan Kota
   200.03.12 - Biaya Tak Terduga / Insidentil

4. PEMELIHARAAN RUTIN GEREJA (Kode: 200.04)

   200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan
   200.04.02 - Inventaris Gereja

5. EKSPLOITASI - KENDARAAN DINAS GEREJA (Kode: 200.05)

   200.05.01 - Roda 4 (Empat)
   200.05.01a - Kijang Innova, Plat BK 1757 EJ
   200.05.01b - Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ
   200.05.02 - Roda 4 (Empat)
   200.05.02a - HIACE BK.7866 DP
   200.05.02b - Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP
   200.05.03 - Roda 2 (Dua)
   200.05.03a - 1 unit, Plat BK. 5440 AGG
   200.05.03b - Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG

6. DAYA & JASA (Kode: 200.06)

   200.06.01 - Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA

7. PENGADAAN INVENTARIS GEREJA (Kode: 200.07)

   200.07.01 - Jubah Penatua
   200.07.02 - Pengadaan Peralatan & Perlengkapan Inventaris Gereja
   200.07.03 - Dekorasi dan Persiapan Natal

8. BIDANG APOSTOLAT (Kode: 400.01)

   400.01.01 - Pengkhotbah Minggu: Pimpinan Sinode GKPI
   400.01.02 - Pengkhotbah Minggu: Dari Luar Kota
   400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota
   400.01.04 - Pengkhotbah Minggu: Di Rumah Duka
   400.01.05 - Pengkhotbah Minggu: Remaja

9. IBADAH / PERSEKUTUAN DOA / KEBAKTIAN (Kode: 400.02)

   400.02.01 - Pengkhotbah Kebaktian Lingkungan
   400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi & GSM
   400.02.03 - Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu
   400.02.04 - Pengkhotbah Kebaktian Ibu Hanna & Diakoni
   400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)

10. IBADAH KHUSUS (Kode: 400.03)

   400.03.01 - Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah
   400.03.02 - Pengkhotbah Kebak. Penguburan Jenazah
   400.03.03 - Pengkhotbah Kebak. di Rumah Duka oleh Penatua

11. PETUGAS KEBAKTIAN (Kode: 400.04)

   400.04.01 - Minggu Pagi: Pukul 08.00 WIB
   400.04.02 - Minggu Sore: Pukul 18.00 WIB
   400.04.03 - Sekolah Minggu & Remaja
   400.04.04 - Perjanjian / Pemberkatan Nikah
   400.04.05 - Kebaktian pemberangkatan jenazah (pemusik & songleader)
   400.04.06 - Kebaktian di Rumah Duka
   400.04.07 - Pelayanan di Rumah Duka
   400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)
   400.04.09 - Latihan Pemusik dan Songleader
   400.04.10 - Petugas Penghitung Kebaktian Minggu

12. PELAYANAN SAKRAMEN (Kode: 400.05)

   400.05.01 - Perjamuan Kudus di Gereja
   400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021

13. HUT GKPI MEDAN KOTA (Kode: 400.06)

   400.06.01 - (Tidak ada kegiatan)

14. BIDANG PASTORAT (Kode: 600.01)

   600.01.01 - Pendidikan Lanjutan Untuk Pendeta
   600.01.02 - Penghargaan Untuk Penatua
   600.01.03 - Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota
   600.01.04 - Pembinaan Penatua se Resort Medan Barat

15. PROGRAM KERJA SEKSI (Kode: 600.02)

   600.02.01 - Pembinaan & Pelayanan Rohani (PPR)
   600.02.02 - Pekabaran Injil (PI)
   600.02.03 - Diakoni
   600.02.04 - Musik, Nyanyian & Koor (MNK)
   600.02.05 - Sekolah Minggu
   600.02.06 - Remaja
   600.02.07 - Pemuda
   600.02.08 - Perempuan
   600.02.09 - Pria
   600.02.10 - Lansia
   600.02.11 - Kesehatan
   600.02.12 - Pendidikan
   600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)
   600.02.14 - Sarana & Prasarana
   600.02.15 - Natal Gabungan Seksi-seksi (Natal II)

16. BAKTI BULANAN / TARGET KE KANTOR PUSAT (Kode: 600.03)

   600.03.01 - Target Ke Kantor Pusat GKPI
   600.03.02 - Biaya Tahun Renstra GKPI 2023
   600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)

17. Target Ke GKPI Ressort Medan Barat (Kode: 600.04)

   600.04.01 - Target Ke GKPI Ressort Medan Barat

18. BIDANG DIAKONAT (Kode: 800.01)

   800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam
   800.01.02 - Akomodasi Acara Penghiburan ke rumah duka
   800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI
   800.01.04 - Bantuan untuk PA. Mamre dan Yapentra
   800.01.05 - Bantuan Ke GKPI Lainnya

19. BINGKISAN NATAL (Kode: 800.02)

   800.02.01 - Anak - Anak Sekolah Minggu
   800.02.02 - Penatua Purnabakti
   800.02.03 - Penatua Aktif
   800.02.04 - Calon Penatua
   800.02.05 - Pendeta GKPI Ressort Medan Barat
   800.02.06 - Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK
   800.02.07 - Guru-Guru Koor di Jemaat GKPI Medan Kota
   800.02.08 - Guru-Guru Sekolah Minggu
   800.02.09 - Pemusik: (Organis, Pianis dan Saxophonis)
   800.02.10 - Songleader (Pemandu Lagu)
   800.02.11 - Petugas Live Streaming Minggu


   ------------------------
   Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    Dim totalKas As Object, uraianDict As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Definisi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, bulan As String
    
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Debugging: Cetak kodeSub untuk memeriksa nilainya
        Debug.Print "Kode Subkategori: " & kodeSub
        
        If Not allBulan.exists(bulan) Then allBulan.Add bulan, Nothing
        
        Dim uniqueKey As String
        uniqueKey = kodeSub & "|" & bulan
        
        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
    Next i
    
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 2).Value = "Uraian"
    
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 3
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    Dim rowIndex As Long
    rowIndex = 2
    Dim kodeDict As Object
    Set kodeDict = CreateObject("Scripting.Dictionary")
    
    Dim dictKey As Variant
    For Each dictKey In totalKas.keys
        Dim splitKey() As String
        splitKey = Split(dictKey, "|")
        
        If Not kodeDict.exists(splitKey(0)) Then
            kodeDict.Add splitKey(0), rowIndex
            wsTujuan.Cells(rowIndex, 1).Value = splitKey(0)
            If uraianDict.exists(splitKey(0)) Then
                wsTujuan.Cells(rowIndex, 2).Value = uraianDict(splitKey(0))
            Else
                wsTujuan.Cells(rowIndex, 2).Value = "Uraian Tidak Diketahui"
            End If
            rowIndex = rowIndex + 1
        End If
    Next dictKey
     
    For Each dictKey In totalKas.keys
        Dim keySplit() As String
        keySplit = Split(dictKey, "|")
        
        Dim kodeRow As Long, bulanColumn As Long
        kodeRow = kodeDict(keySplit(0))
        bulanColumn = bulanCol(keySplit(1))
        
        wsTujuan.Cells(kodeRow, bulanColumn).Value = totalKas(dictKey)
    Next dictKey
    
    MsgBox "Total kas berhasil disalin dalam format horizontal ke Sheet '3' dengan uraian kode subkategori.", vbInformation
End Sub

Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".") ' Ubah koma menjadi titik
    kode = Trim(kode) ' Hilangkan spasi ekstra
    If Left(kode, 1) = "." Then kode = Mid(kode, 2) ' Hilangkan titik di awal jika ada
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1) ' Hilangkan titik di akhir jika ada
    CleanCode = kode
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"
    dict.Add "400.06.01", "(Tidak ada kegiatan)"
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub


-------------------------
kode untuk sheet3 udah berurutan modul2.2
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    Dim totalKas As Object, uraianDict As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Definisi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, bulan As String
    
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Mengambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Pengondisian untuk menangani format kode
        If Not uraianDict.exists(kodeSub) Then
            ' Cek jika kode memiliki spasi tambahan atau format lain yang tidak cocok
            If InStr(kodeSub, " ") > 0 Then
                
                tempKode = Replace(kodeSub, " ", "") ' Hapus spasi di dalam kode
                If uraianDict.exists(tempKode) Then
                    kodeSub = tempKode
                ElseIf Right(kodeSub, 1) = " " Then
                    tempKode = Left(kodeSub, Len(kodeSub) - 1) ' Hapus spasi terakhir
                    If uraianDict.exists(tempKode) Then kodeSub = tempKode
                ElseIf Left(kodeSub, 1) = "0" Then
                    tempKode = Mid(kodeSub, 2) ' Hapus angka nol di awal jika ada
                    If uraianDict.exists(tempKode) Then kodeSub = tempKode
                ElseIf Right(kodeSub, 1) Like "[a-zA-Z] " Then
                    tempKode = Trim(kodeSub) ' Hapus spasi setelah huruf
                    If uraianDict.exists(tempKode) Then kodeSub = tempKode
                End If
                
                tempKode = Replace(kodeSub, " ", "") ' Hapus spasi di dalam kode
                If uraianDict.exists(tempKode) Then
                    kodeSub = tempKode
                ElseIf Right(kodeSub, 1) = " " Then
                    tempKode = Left(kodeSub, Len(kodeSub) - 1) ' Hapus spasi terakhir
                    If uraianDict.exists(tempKode) Then kodeSub = tempKode
                ElseIf Left(kodeSub, 1) = "0" Then
                    tempKode = Mid(kodeSub, 2) ' Hapus angka nol di awal jika ada
                    If uraianDict.exists(tempKode) Then kodeSub = tempKode
                End If
            End If
            If InStr(kodeSub, " ") > 0 Then
                
                tempKode = Replace(kodeSub, " ", "") ' Menghapus spasi
                If uraianDict.exists(tempKode) Then
                    kodeSub = tempKode
                End If
            End If
        End If
        
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Debugging: Cetak kodeSub untuk memeriksa nilainya
        Debug.Print "Kode Subkategori: " & kodeSub
        
        If Not allBulan.exists(bulan) Then allBulan.Add bulan, Nothing
        
        Dim uniqueKey As String
        uniqueKey = kodeSub & "|" & bulan
        
        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
    Next i
    
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 2).Value = "Uraian"
    
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 3
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    Dim rowIndex As Long
    rowIndex = 2
    Dim kodeDict As Object
    Set kodeDict = CreateObject("Scripting.Dictionary")
    
    Dim sortedKeys() As String
    Dim keyIndex As Long
    keyIndex = 0
    ReDim sortedKeys(totalKas.Count - 1)
    
    For Each dictKey In totalKas.keys
        sortedKeys(keyIndex) = dictKey
        keyIndex = keyIndex + 1
    Next dictKey
    
    ' Urutkan kunci
    Call BubbleSort(sortedKeys)
    
    ' Tulis ke dalam sheet berdasarkan urutan kunci
    rowIndex = 2 ' Mulai dari baris kedua
    For Each dictKey In sortedKeys
        Dim keySplit() As String
        keySplit = Split(dictKey, "|")
        
        Dim kodeRow As Long, bulanColumn As Long
        If Not kodeDict.exists(keySplit(0)) Then
            kodeDict.Add keySplit(0), rowIndex
            wsTujuan.Cells(rowIndex, 1).Value = keySplit(0)
            If uraianDict.exists(keySplit(0)) Then
                wsTujuan.Cells(rowIndex, 2).Value = uraianDict(keySplit(0))
            Else
                wsTujuan.Cells(rowIndex, 2).Value = "Uraian Tidak Diketahui"
            End If
            rowIndex = rowIndex + 1
        End If
        
        ' Tulis total kas ke dalam sheet
        bulanColumn = bulanCol(keySplit(1))
        wsTujuan.Cells(kodeDict(keySplit(0)), bulanColumn).Value = totalKas(dictKey)
    Next dictKey
    
    MsgBox "Total kas berhasil disalin dalam format horizontal ke Sheet '3' dengan uraian kode subkategori.", vbInformation
End Sub

Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".") ' Ubah koma menjadi titik
    kode = Trim(kode) ' Hilangkan spasi ekstra
    If Left(kode, 1) = "." Then kode = Mid(kode, 2) ' Hilangkan titik di awal jika ada
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1) ' Hilangkan titik di akhir jika ada
    CleanCode = kode
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"
    dict.Add "400.06.01", "(Tidak ada kegiatan)"
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub




---------------
ini modul1.2
Sub kelompokkanData()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("2")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '2' tersedia."
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    If UBound(data, 1) < 3 Then
        MsgBox "Tidak ada data untuk diproses."
        Exit Sub
    End If
    
    Dim kelompok As Object
    Set kelompok = CreateObject("Scripting.Dictionary")
    
    Dim i As Integer
    Dim tgl As Variant, kwitansi As Variant, uraian As Variant, kas As Variant
    Dim kodeSub As String, bulan As String
    
    For i = 4 To UBound(data, 1) ' Mulai dari baris ke-4
        tgl = data(i, 1)
        kwitansi = data(i, 2)
        uraian = data(i, 3)
        kas = data(i, 4)
        
        If IsDate(tgl) Then
            bulan = "Bulan " & Month(tgl)
        Else
            bulan = "Undef"
        End If
        
        kodeSub = Trim(data(i, 5) & data(i, 7) & data(i, 9) & data(i, 11))
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        If Not kelompok.exists(bulan) Then
            kelompok.Add bulan, CreateObject("Scripting.Dictionary")
        End If
        
        If Not kelompok(bulan).exists(kodeSub) Then
            kelompok(bulan).Add kodeSub, Array()
        End If
        
        Dim tempArray As Variant
        tempArray = kelompok(bulan)(kodeSub)
        ReDim Preserve tempArray(UBound(tempArray) + 1)
        tempArray(UBound(tempArray)) = Array(tgl, kwitansi, uraian, kas, kodeSub)
        kelompok(bulan)(kodeSub) = tempArray
    Next i
    
    wsTujuan.Cells.Clear
    
    Dim startRow As Integer, startCol As Integer
    startCol = 1
    Dim colSpacing As Integer
    colSpacing = 3
    
    Dim bulanKey As Variant, kodeSubKey As Variant
    For Each bulanKey In kelompok.keys
        startRow = 1
        wsTujuan.Cells(startRow, startCol).Value = bulanKey
        startRow = startRow + 1
        
        ' Mengumpulkan dan mengurutkan kode subkategori
        Dim sortedKodeSubKeys() As String
        Dim kodeSubIndex As Long
        kodeSubIndex = 0
        ReDim sortedKodeSubKeys(0 To kelompok(bulanKey).Count - 1)
        
        For Each kodeSubKey In kelompok(bulanKey).keys
            sortedKodeSubKeys(kodeSubIndex) = kodeSubKey
            kodeSubIndex = kodeSubIndex + 1
        Next kodeSubKey
        
        ' Urutkan kode subkategori
        Call BubbleSort(sortedKodeSubKeys)
        
        For Each kodeSubKey In sortedKodeSubKeys
            wsTujuan.Cells(startRow, startCol).Value = "Subkategori: " & kodeSubKey
            startRow = startRow + 1
            
            wsTujuan.Cells(startRow, startCol).Resize(1, 5).Value = Array("Tanggal", "Kwitansi", "Uraian", "Kas", "Kode Subkategori")
            startRow = startRow + 1
            
            Dim dataKodeSub As Variant
            dataKodeSub = kelompok(bulanKey)(kodeSubKey)
            
            Dim r As Integer
            Dim totalKas As Double
            totalKas = 0
            
            For r = LBound(dataKodeSub) To UBound(dataKodeSub)
                If UBound(dataKodeSub(r)) >= 3 Then
                    If Not IsEmpty(dataKodeSub(r)(3)) And IsNumeric(dataKodeSub(r)(3)) Then
                        totalKas = totalKas + CDbl(dataKodeSub(r)(3))
                    End If
                End If
                For c = LBound(dataKodeSub(r)) To UBound(dataKodeSub(r))
                    wsTujuan.Cells(startRow + r, startCol + c).Value = dataKodeSub(r)(c)
                Next c
            Next r
            
            startRow = startRow + UBound(dataKodeSub) + 1
            
            ' Menampilkan total kas
            wsTujuan.Cells(startRow, startCol).Value = "Total Kas " & kodeSubKey
            wsTujuan.Cells(startRow, startCol + 3).Value = totalKas
            startRow = startRow + 2
        Next kodeSubKey
        
        startCol = startCol + 7 + colSpacing
    Next bulanKey
    
    MsgBox "Pengecekan kode sub, pengelompokan data, dan perhitungan total kas selesai."
End Sub









-----------------------
program vba sheet 3 udah ada total sum per kategori

Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    Dim totalKas As Object, uraianDict As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    Dim allBulan As Object, kategoriDict As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Definisi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
        If Len(kodeSub) >= 6 Then
            kategori = Left(kodeSub, 6)
        Else
            kategori = kodeSub
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2
    
    Dim kategoriKey As Variant
    For Each kategoriKey In kategoriDict.keys
        Dim firstRowInCategory As Long
        firstRowInCategory = rowIndex
        
        Dim dictKey As Variant
        For Each dictKey In totalKas.keys
            Dim keySplit() As String
            keySplit = Split(dictKey, "|")
            
            ' Pastikan kategori cocok dengan iterasi saat ini
            If keySplit(0) = kategoriKey Then
                ' Tulis data kategori dan subkategori
                wsTujuan.Cells(rowIndex, 1).Value = keySplit(0) ' Kategori
                wsTujuan.Cells(rowIndex, 2).Value = keySplit(1) ' Kode Subkategori
                
                ' Tambahkan uraian jika tersedia
                If uraianDict.exists(keySplit(1)) Then
                    wsTujuan.Cells(rowIndex, 3).Value = uraianDict(keySplit(1))
                Else
                    wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
                End If
                
                ' Tulis total per bulan
                Dim bulanColumn As Long
                bulanColumn = bulanCol(keySplit(2))
                wsTujuan.Cells(rowIndex, bulanColumn).Value = totalKas(dictKey)
                
                rowIndex = rowIndex + 1
            End If
        Next dictKey
        
        ' Tambahkan baris total setelah kategori selesai
        Dim totalRow As Long
        totalRow = rowIndex
        
        wsTujuan.Cells(totalRow, 1).Value = "Total " & kategoriKey
        wsTujuan.Cells(totalRow, 1).Font.Bold = True
        
        ' Menjumlahkan total per bulan untuk kategori ini
        For Each bulanKey In bulanCol.keys
            Dim sumRange As Range
            Set sumRange = wsTujuan.Range(wsTujuan.Cells(firstRowInCategory, bulanCol(bulanKey)), wsTujuan.Cells(totalRow - 1, bulanCol(bulanKey)))
            
            If WorksheetFunction.CountA(sumRange) > 0 Then
                wsTujuan.Cells(totalRow, bulanCol(bulanKey)).Formula = "=SUM(" & sumRange.Address & ")"
                wsTujuan.Cells(totalRow, bulanCol(bulanKey)).Font.Bold = True
            End If
        Next bulanKey
        
        rowIndex = rowIndex + 1 ' Tambahkan baris kosong setelah total
    Next kategoriKey
    
    MsgBox "Total kas berhasil disalin dalam format horizontal ke Sheet '3' dengan total per kategori.", vbInformation
End Sub

' Membersihkan format kode
Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Menyediakan uraian untuk setiap kode
Sub InisialisasiUraian(dict As Object)
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"
    dict.Add "400.06.01", "(Tidak ada kegiatan)"
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub

---------------
password bpjs kak loli Gloria123



---------------------------

Berdasarkan outline yang kamu berikan, berikut adalah total halaman yang dapat diidentifikasi berdasarkan kategori yang ada:

1. *Halaman Publik (3 Halaman)*
   - Halaman Utama
   - Tentang Kami
   - Hubungi Kami

2. *Halaman Pengguna (Penawar) (7 Halaman)*
   - Login
   - Registrasi
   - Profil
   - Ubah Kata Sandi
   - Daftar Tender
   - Detail Tender
   - Ajukan Penawaran
   - Riwayat Penawaran

3. *Halaman Admin (6 Halaman)*
   - Dashboard
   - Kelola Tender
   - Kelola Penawaran
   - Evaluasi Penawaran
   - Tetapkan Pemenang
   - Buat Laporan
   - Manajemen Pengguna

*Total Halaman: 3 (Publik) + 7 (Pengguna) + 6 (Admin) = 16 Halaman*

Jadi, total ada *16 halaman* yang teridentifikasi dalam outline aplikasi tender ini. 

Jika ada bagian lain yang perlu diperjelas atau jika ada elemen lain yang ingin kamu tambahkan ke dalam aplikasi, beri tahu saya!



-----------------------------
ini kode sheet3 udah ada kelompok sum per subkategori + kategori yg sama tp masih berantakan urutannya dan uraian ada yg ga diketahui

Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    Dim allBulan As Object, kategoriDict As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Definisi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
        If Len(kodeSub) >= 6 Then
            kategori = Left(kodeSub, 6)
        Else
            kategori = kodeSub
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2
    
    Dim kategoriKey As Variant
    For Each kategoriKey In kategoriDict.keys
        Dim firstRowInCategory As Long
        firstRowInCategory = rowIndex
        
        Dim subKategoriKey As Variant
        For Each subKategoriKey In subKategoriDict(kategoriKey).keys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
            
            ' Tambahkan uraian jika tersedia
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            Dim bulanColumn As Long
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tambahkan baris kosong setelah kategori
        rowIndex = rowIndex + 1
    Next kategoriKey
    
    MsgBox "Total kas berhasil disalin dalam format horizontal ke Sheet '3' dengan total per kategori.", vbInformation
End Sub

' Membersihkan format kode
Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Menyediakan uraian untuk setiap kode
Sub InisialisasiUraian(dict As Object)
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"
    dict.Add "400.06.01", "(Tidak ada kegiatan)"
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub



----------------------
vb sheet 3 udah berurutan kategori dan sub nya :
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    Dim allBulan As Object, kategoriDict As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Definisi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
        If Len(kodeSub) >= 6 Then
            kategori = Left(kodeSub, 6)
        Else
            kategori = kodeSub
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2
    
    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    For Each kategoriKey In sortedKategoriKeys
        Dim firstRowInCategory As Long
        firstRowInCategory = rowIndex
        
        ' Urutkan subkategori
        Dim sortedSubKategoriKeys As Variant
        sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
        
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
            
            ' Tambahkan uraian jika tersedia
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            Dim bulanColumn As Long
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tambahkan baris kosong setelah kategori
        rowIndex = rowIndex + 1
    Next kategoriKey
End Sub

Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Add keys to collection
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Sort the collection based on dictionary order
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Sort the keys numerically
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Membersihkan format kode
Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Menyediakan uraian untuk setiap kode
Sub InisialisasiUraian(dict As Object)
dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"
    dict.Add "400.06.01", "(Tidak ada kegiatan)"
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub




izinkan semua pengguna akses rdp

Add-LocalGroupMember -Group "Remote Desktop Users" -Member "Everyone"

--------------------


cara setting rdp di windows 10 pake powershellUntuk mengatur **Remote Desktop** agar dapat diakses oleh komputer dalam satu jaringan **tanpa autentikasi dan password**, Anda perlu melakukan beberapa konfigurasi pada sistem Windows. Namun, perlu diingat bahwa menghilangkan autentikasi dan password dapat membahayakan keamanan sistem Anda. Pastikan Anda memahami risiko keamanan sebelum melanjutkan.

Berikut adalah langkah-langkah untuk mengaktifkan Remote Desktop tanpa autentikasi dan password menggunakan **PowerShell**:

---

### **1. Aktifkan Remote Desktop**
Anda perlu mengaktifkan fitur Remote Desktop di Windows. Jalankan perintah berikut di PowerShell (sebagai Administrator):

```powershell
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
```

Perintah ini akan mengaktifkan Remote Desktop dengan mengubah nilai registry `fDenyTSConnections` menjadi `0`.

---

### **2. Nonaktifkan Network Level Authentication (NLA)**
Network Level Authentication (NLA) adalah lapisan keamanan yang memerlukan autentikasi sebelum koneksi Remote Desktop dibuat. Untuk menonaktifkan NLA, jalankan perintah berikut:

```powershell
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "UserAuthentication" -Value 0
```

Perintah ini akan menonaktifkan NLA dengan mengubah nilai registry `UserAuthentication` menjadi `0`.

---

### **3. Izinkan Pengguna untuk Login Tanpa Password**
Untuk memungkinkan pengguna login tanpa password, Anda perlu mengubah kebijakan keamanan lokal. Jalankan perintah berikut:

```powershell
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Lsa" -Name "LimitBlankPasswordUse" -Value 0
```

Perintah ini akan mengizinkan pengguna dengan akun tanpa password untuk login.

---

### **4. Nonaktifkan Persyaratan Password untuk Akun Pengguna**
Anda juga perlu menonaktifkan persyaratan password untuk akun pengguna tertentu. Jalankan perintah berikut:

```powershell
Set-LocalUser -Name "NamaPengguna" -PasswordNeverExpires $true -PasswordNotRequired $true
```

Ganti `NamaPengguna` dengan nama akun pengguna yang ingin Anda izinkan login tanpa password.

---

### **5. Izinkan Remote Desktop di Firewall**
Pastikan firewall mengizinkan koneksi Remote Desktop. Jalankan perintah berikut:

```powershell
Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
```

Perintah ini akan mengaktifkan aturan firewall untuk Remote Desktop.

---

### **6. Restart Komputer**
Setelah melakukan perubahan, restart komputer untuk menerapkan konfigurasi:

```powershell
Restart-Computer -Force
```

---

### **7. Akses Remote Desktop Tanpa Password**
Setelah restart, Anda dapat mengakses komputer tersebut dari komputer lain dalam jaringan yang sama menggunakan Remote Desktop tanpa perlu memasukkan password.

---

### **Catatan Penting**
1. **Risiko Keamanan**:
   - Menonaktifkan autentikasi dan password membuat sistem Anda rentan terhadap serangan. Pastikan Anda hanya melakukan ini di lingkungan yang aman dan terpercaya.
   - Jangan pernah menggunakan konfigurasi ini di jaringan publik atau tidak terpercaya.

2. **Hanya untuk Penggunaan Lokal**:
   - Konfigurasi ini hanya direkomendasikan untuk penggunaan di jaringan lokal (LAN) yang aman.

3. **Alternatif yang Lebih Aman**:
   - Jika memungkinkan, gunakan autentikasi dan password untuk melindungi sistem Anda. Anda dapat menggunakan fitur seperti **Windows Hello** atau **akun Microsoft** untuk meningkatkan keamanan.

--- -----------------------


Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
        If Len(kodeSub) >= 6 Then
            kategori = Left(kodeSub, 6)
        Else
            kategori = kodeSub
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2
    
    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    For Each kategoriKey In sortedKategoriKeys
        Dim firstRowInCategory As Long
        firstRowInCategory = rowIndex
        
        ' Urutkan subkategori
        Dim sortedSubKategoriKeys As Variant
        sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
        
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
            
            ' Tambahkan uraian jika tersedia
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            Dim bulanColumn As Long
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total per kategori dan bulan setelah semua subkategori selesai
        wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        For Each bulanKey In bulanCol.keys
            totalKey = kategoriKey & "|" & bulanKey
            If totalPerKategoriBulan.exists(totalKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
            End If
        Next bulanKey
        
        rowIndex = rowIndex + 1
    Next kategoriKey
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub


kode dah ada total dah ada utk module sheet3



--------------------------------

sheet 3 vb udah ada total kelompok tapi masih di atas :
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String ' Deklarasikan variabel kelompokKey di sini (sekali saja)
    Dim kelompokTotalKey As String ' Deklarasikan variabel kelompokTotalKey di sini (sekali saja)
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
        If Len(kodeSub) >= 6 Then
            kategori = Left(kodeSub, 6)
        Else
            kategori = kodeSub
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan kelompok yang sudah diproses
    Dim processedKelompok As Object
    Set processedKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    For Each kategoriKey In sortedKategoriKeys
        Dim firstRowInCategory As Long
        firstRowInCategory = rowIndex

        ' Urutkan subkategori
        Dim sortedSubKategoriKeys As Variant
        sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
        
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
            
            ' Tambahkan uraian jika tersedia
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            Dim bulanColumn As Long
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total per kategori dan bulan setelah semua subkategori selesai
        wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        For Each bulanKey In bulanCol.keys
            totalKey = kategoriKey & "|" & bulanKey
            If totalPerKategoriBulan.exists(totalKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
            End If
        Next bulanKey
        
        rowIndex = rowIndex + 1

        ' Tulis total per kelompok mata anggaran (3 angka pertama)
        kelompokKey = Left(kategoriKey, 3) ' Gunakan variabel kelompokKey yang sudah dideklarasikan

        If Not processedKelompok.exists(kelompokKey) Then
            ' Tulis total per kelompok
            wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""

            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey ' Gunakan variabel kelompokTotalKey yang sudah dideklarasikan

                If totalPerKelompok.exists(kelompokTotalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKelompok(kelompokTotalKey)
                End If
            Next bulanKey

            rowIndex = rowIndex + 1
            processedKelompok.Add kelompokKey, Nothing
        End If
    Next kategoriKey
End Sub

' ... (Fungsi dan subrutin lainnya tetap sama)

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub







Berikut adalah contoh sederhana yang menunjukkan bagaimana totalKas, totalPerKategoriBulan, dan totalPerKelompok bekerja dalam skrip VBA Anda. Misalkan kita memiliki data seperti ini:

Format key: kategori|subkategori|bulan

Contoh isi:

Copy
"200.01|200.01.01|Januari 2023" = 100
"200.01|200.01.02|Januari 2023" = 200
"200.01|200.01.01|Februari 2023" = 150
"200.02|200.02.01|Februari 2023" = 300
"200.01|200.01.01|Maret 2023" = 50
"200.02|200.02.01|Maret 2023" = 100



------------------------------------------
3 maret
 


sudah ada di bagian akhir total kelompoknya:
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
        If Len(kodeSub) >= 6 Then
            kategori = Left(kodeSub, 6)
        Else
            kategori = kodeSub
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan total sementara per kelompok
    Dim tempTotalPerKelompok As Object
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        Dim firstRowInCategory As Long
        firstRowInCategory = rowIndex

        ' Ambil 3 angka pertama dari kategori sebagai kelompokKey
        kelompokKey = Left(kategoriKey, 3)

        ' Jika kelompok ini belum diproses, inisialisasi total sementara
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori
        Dim sortedSubKategoriKeys As Variant
        sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
        
        ' Loop melalui setiap subkategori dalam kategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
            
            ' Tambahkan uraian jika tersedia
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            Dim bulanColumn As Long
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    
                    ' Akumulasi total sementara per kelompok dan bulan
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total per kategori dan bulan setelah semua subkategori selesai
        wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        For Each bulanKey In bulanCol.keys
            totalKey = kategoriKey & "|" & bulanKey
            If totalPerKategoriBulan.exists(totalKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
            End If
        Next bulanKey
        
        rowIndex = rowIndex + 1

        ' Cek apakah ini adalah kategori terakhir dalam kelompok
        Dim isLastKategoriInKelompok As Boolean
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini adalah kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            ' Tulis total per kelompok
            wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""

            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                End If
            Next bulanKey

            rowIndex = rowIndex + 1
        End If
    Next kategoriKey
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub
----------------------

ininudah ada warna sheet 3 unntuk kelompok nya

Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default
        If kodeSub = "" Then kodeSub = "Uang Setoran"
        
        ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
        If Len(kodeSub) >= 6 Then
            kategori = Left(kodeSub, 6)
        Else
            kategori = kodeSub
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan total sementara per kelompok
    Dim tempTotalPerKelompok As Object
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        Dim firstRowInCategory As Long
        firstRowInCategory = rowIndex

        ' Ambil 3 angka pertama dari kategori sebagai kelompokKey
        kelompokKey = Left(kategoriKey, 3)

        ' Jika kelompok ini belum diproses, inisialisasi total sementara
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori
        Dim sortedSubKategoriKeys As Variant
        sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
        
        ' Loop melalui setiap subkategori dalam kategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
            
            ' Tambahkan uraian jika tersedia
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            Dim bulanColumn As Long
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    
                    ' Akumulasi total sementara per kelompok dan bulan
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total per kategori dan bulan setelah semua subkategori selesai
        wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        For Each bulanKey In bulanCol.keys
            totalKey = kategoriKey & "|" & bulanKey
            If totalPerKategoriBulan.exists(totalKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                ' Beri warna hijau pada sel yang berisi nilai
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
            End If
        Next bulanKey
        
        rowIndex = rowIndex + 1

        ' Cek apakah ini adalah kategori terakhir dalam kelompok
        Dim isLastKategoriInKelompok As Boolean
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini adalah kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            ' Tulis total per kelompok
            wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""

            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                    ' Beri warna kuning pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Warna kuning
                End If
            Next bulanKey

            rowIndex = rowIndex + 1
        End If
    Next kategoriKey
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub
--------------------------
Sheet 3 dari file "JURNAL PENGELUARAN JEMAAT 2024.xls" memiliki struktur yang terorganisir dengan baik dan berisi catatan pengeluaran jemaat untuk tahun 2024. Berikut adalah analisis struktur dan konten dari sheet tersebut:

### 1. **Header dan Metadata**
   - **Judul Sheet**: "JUR PENGEL JEMAAT 2024" (Jurnal Pengeluaran Jemaat 2024).
   - **Header Kolom**: 
     - **Kolom A**: Tanggal (TGL.)
     - **Kolom B**: Kode (KW)
     - **Kolom C**: Uraian (URAIAN)
     - **Kolom D**: Kredit (KREDIT)
     - **Kolom E**: Debet (DEBET)
     - **Kolom F**: KAS
     - **Kolom G**: MATA ANGGARAN (kode anggaran)
     - **Kolom H**: Jumlah yang disetor (Uang yang di setor)

### 2. **Struktur Data**
   - **Baris 1**: Judul sheet, yaitu "JURNAL PENGELUARAN JEMAAT 2024".
   - **Baris 2**: Header kolom yang menjelaskan isi dari setiap kolom.
   - **Baris 3**: Keterangan kolom untuk kode anggaran (200, 400, 600, 800).
   - **Baris 4 dan seterusnya**: Data transaksi pengeluaran jemaat.

### 3. **Kolom dan Deskripsi**
   - **Kolom A (TGL.)**: Menunjukkan tanggal transaksi pengeluaran.
   - **Kolom B (KW)**: Kode transaksi atau nomor referensi.
   - **Kolom C (URAIAN)**: Deskripsi atau penjelasan mengenai transaksi pengeluaran.
   - **Kolom D (KREDIT)**: Jumlah uang yang dikeluarkan (dalam rupiah).
   - **Kolom E (DEBET)**: Biasanya kosong, karena ini adalah jurnal pengeluaran.
   - **Kolom F (KAS)**: Jumlah uang yang dikeluarkan dari kas.
   - **Kolom G (MATA ANGGARAN)**: Kode anggaran yang terkait dengan pengeluaran tersebut (misalnya, 200, 400, 600, 800).
   - **Kolom H (Uang yang di setor)**: Jumlah uang yang disetor ke bank atau rekening tertentu.

### 4. **Kode Anggaran**
   - **200**: Kemungkinan besar terkait dengan pengeluaran operasional sehari-hari (seperti konsumsi, transportasi, dll).
   - **400**: Kemungkinan terkait dengan pengeluaran untuk kegiatan ibadah atau pelayanan (seperti transportasi petugas ibadah, pengkhotbah, dll).
   - **600**: Kemungkinan terkait dengan pengeluaran untuk kegiatan sosial atau diakonia (seperti bantuan kepada penerima beras, kunjungan kasih, dll).
   - **800**: Kemungkinan terkait dengan pengeluaran untuk kontribusi atau bantuan ke organisasi lain (seperti dana pensiun, PA Mamre, Yapentra, dll).

### 5. **Contoh Data**
   - **Contoh 1**:
     - **Tanggal**: 2024-01-05
     - **Kode**: 16702
     - **Uraian**: "Transp. Petugas Live Streaming Kebak. Minggu tgl. 01 Jan 2024 (10,00 WIB)"
     - **Kredit**: 200000
     - **KAS**: 200000
     - **Mata Anggaran**: 400,04,01
     - **Uang yang di setor**: Kosong
   - **Contoh 2**:
     - **Tanggal**: 2024-01-05
     - **Kode**: 16801
     - **Uraian**: "Transp. Petugas Kebak. Tahun Baru tgl. 01 Jan 2024 (10,00 WIB)"
     - **Kredit**: 350000
     - **KAS**: 350000
     - **Mata Anggaran**: 400,04,01
     - **Uang yang di setor**: Kosong

### 6. **Total Pengeluaran**
   - Di bagian bawah sheet, terdapat total pengeluaran untuk setiap bulan (misalnya, "JANUARI 2024", "FEBRUARI 2024", dst).
   - Total pengeluaran dihitung berdasarkan jumlah kredit yang dikeluarkan selama bulan tersebut.

### 7. **Kesimpulan Struktur**
   - Sheet ini berfungsi sebagai **jurnal pengeluaran** yang mencatat semua transaksi pengeluaran jemaat selama tahun 2024.
   - Setiap transaksi memiliki **tanggal, kode, uraian, jumlah kredit, kode anggaran**, dan **jumlah yang disetor** (jika ada).
   - Kode anggaran digunakan untuk mengkategorikan pengeluaran berdasarkan jenis kegiatan atau tujuan pengeluaran.

Dengan struktur ini, sheet 3 memungkinkan pelacakan dan pengelolaan keuangan jemaat secara terperinci dan terorganisir.


-------------------------
kode sheet 3 udah bagus uang setoran: 
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default "Uang Setoran"
        If kodeSub = "" Then
            kodeSub = "Uang Setoran"
            kategori = "Uang Setoran" ' Khusus untuk "Uang Setoran", kategori sama dengan kodeSub
        Else
            ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan total sementara per kelompok
    Dim tempTotalPerKelompok As Object
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Jika kategori adalah "Uang Setoran", tulis sebagai kategori terpisah
        If kategoriKey = "Uang Setoran" Then
            wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            ' Tulis total per bulan untuk "Uang Setoran"
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Else
            ' Lanjutkan dengan logika yang sudah ada untuk kategori lainnya
            Dim firstRowInCategory As Long
            firstRowInCategory = rowIndex

            ' Ambil 3 angka pertama dari kategori sebagai kelompokKey
            kelompokKey = Left(kategoriKey, 3)

            ' Jika kelompok ini belum diproses, inisialisasi total sementara
            If Not tempTotalPerKelompok.exists(kelompokKey) Then
                tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
            End If

            ' Urutkan subkategori
            Dim sortedSubKategoriKeys As Variant
            sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
            
            ' Loop melalui setiap subkategori dalam kategori
            For Each subKategoriKey In sortedSubKategoriKeys
                ' Tulis data kategori dan subkategori
                wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
                wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
                
                ' Tambahkan uraian jika tersedia
                If uraianDict.exists(subKategoriKey) Then
                    wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
                Else
                    wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
                End If
                
                ' Tulis total per bulan
                Dim bulanColumn As Long
                For Each bulanKey In bulanCol.keys
                    uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                    If totalKas.exists(uniqueKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                        
                        ' Akumulasi total sementara per kelompok dan bulan
                        kelompokTotalKey = kelompokKey & "|" & bulanKey
                        If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                            tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                        Else
                            tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                        End If
                    End If
                Next bulanKey
                
                rowIndex = rowIndex + 1
            Next subKategoriKey
            
            ' Tulis total per kategori dan bulan setelah semua subkategori selesai
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1

            ' Cek apakah ini adalah kategori terakhir dalam kelompok
            Dim isLastKategoriInKelompok As Boolean
            isLastKategoriInKelompok = True
            For Each k In sortedKategoriKeys
                If Left(k, 3) = kelompokKey And k > kategoriKey Then
                    isLastKategoriInKelompok = False
                    Exit For
                End If
            Next k

            ' Jika ini adalah kategori terakhir dalam kelompok, tulis total kelompok
            If isLastKategoriInKelompok Then
                ' Tulis total per kelompok
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        ' Beri warna kuning pada sel yang berisi nilai
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Warna kuning
                    End If
                Next bulanKey

                rowIndex = rowIndex + 1
            End If
        End If
    Next kategoriKey
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    ' Jika kode adalah "Uang Setoran", kembalikan langsung tanpa perubahan
    If Trim(kode) = "Uang Setoran" Then
        CleanCode = "Uang Setoran"
        Exit Function
    End If
    
    ' Lanjutkan pembersihan kode untuk kasus lainnya
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub
---------------

sheet 3 udah ada total keseluruhan: 
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Dictionary untuk menyimpan total keseluruhan per bulan
    Dim totalKeseluruhanPerBulan As Object
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default "Uang Setoran"
        If kodeSub = "" Then
            kodeSub = "Uang Setoran"
            kategori = "Uang Setoran" ' Khusus untuk "Uang Setoran", kategori sama dengan kodeSub
        Else
            ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0 ' Inisialisasi total keseluruhan per bulan
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan total sementara per kelompok
    Dim tempTotalPerKelompok As Object
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Jika kategori adalah "Uang Setoran", tulis sebagai kategori terpisah
        If kategoriKey = "Uang Setoran" Then
            wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            ' Tulis total per bulan untuk "Uang Setoran"
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Else
            ' Lanjutkan dengan logika yang sudah ada untuk kategori lainnya
            Dim firstRowInCategory As Long
            firstRowInCategory = rowIndex

            ' Ambil 3 angka pertama dari kategori sebagai kelompokKey
            kelompokKey = Left(kategoriKey, 3)

            ' Jika kelompok ini belum diproses, inisialisasi total sementara
            If Not tempTotalPerKelompok.exists(kelompokKey) Then
                tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
            End If

            ' Urutkan subkategori
            Dim sortedSubKategoriKeys As Variant
            sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
            
            ' Loop melalui setiap subkategori dalam kategori
            For Each subKategoriKey In sortedSubKategoriKeys
                ' Tulis data kategori dan subkategori
                wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
                wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
                
                ' Tambahkan uraian jika tersedia
                If uraianDict.exists(subKategoriKey) Then
                    wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
                Else
                    wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
                End If
                
                ' Tulis total per bulan
                Dim bulanColumn As Long
                For Each bulanKey In bulanCol.keys
                    uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                    If totalKas.exists(uniqueKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                        
                        ' Akumulasi total sementara per kelompok dan bulan
                        kelompokTotalKey = kelompokKey & "|" & bulanKey
                        If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                            tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                        Else
                            tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                        End If
                    End If
                Next bulanKey
                
                rowIndex = rowIndex + 1
            Next subKategoriKey
            
            ' Tulis total per kategori dan bulan setelah semua subkategori selesai
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1

            ' Cek apakah ini adalah kategori terakhir dalam kelompok
            Dim isLastKategoriInKelompok As Boolean
            isLastKategoriInKelompok = True
            For Each k In sortedKategoriKeys
                If Left(k, 3) = kelompokKey And k > kategoriKey Then
                    isLastKategoriInKelompok = False
                    Exit For
                End If
            Next k

            ' Jika ini adalah kategori terakhir dalam kelompok, tulis total kelompok
            If isLastKategoriInKelompok Then
                ' Tulis total per kelompok
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        ' Beri warna kuning pada sel yang berisi nilai
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Warna kuning
                    End If
                Next bulanKey

                rowIndex = rowIndex + 1
            End If
        End If
    Next kategoriKey

    ' Tulis Total Keseluruhan di baris terakhir
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        ' Beri warna biru pada sel yang berisi nilai
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Warna biru
    Next bulanKey
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    ' Jika kode adalah "Uang Setoran", kembalikan langsung tanpa perubahan
    If Trim(kode) = "Uang Setoran" Then
        CleanCode = "Uang Setoran"
        Exit Function
    End If
    
    ' Lanjutkan pembersihan kode untuk kasus lainnya
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub
-----------------------
sudah bisa hilang 2 kolom kanan terakhir:
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Dictionary untuk menyimpan total keseluruhan per bulan
    Dim totalKeseluruhanPerBulan As Object
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default "Uang Setoran"
        If kodeSub = "" Then
            kodeSub = "Uang Setoran"
            kategori = "Uang Setoran" ' Khusus untuk "Uang Setoran", kategori sama dengan kodeSub
        Else
            ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0 ' Inisialisasi total keseluruhan per bulan
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Pastikan array bulan diurutkan dengan benar
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Tambahkan kolom Total di sebelah kanan
    wsTujuan.Cells(1, colIndex).Value = "Total"
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan total sementara per kelompok
    Dim tempTotalPerKelompok As Object
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Jika kategori adalah "Uang Setoran", tulis sebagai kategori terpisah
        If kategoriKey = "Uang Setoran" Then
            wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            ' Tulis total per bulan untuk "Uang Setoran"
            Dim totalUangSetoran As Double
            totalUangSetoran = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalUangSetoran = totalUangSetoran + totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total Uang Setoran di kolom Total
            wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
            
            rowIndex = rowIndex + 1
        Else
            ' Lanjutkan dengan logika yang sudah ada untuk kategori lainnya
            Dim firstRowInCategory As Long
            firstRowInCategory = rowIndex

            ' Ambil 3 angka pertama dari kategori sebagai kelompokKey
            kelompokKey = Left(kategoriKey, 3)

            ' Jika kelompok ini belum diproses, inisialisasi total sementara
            If Not tempTotalPerKelompok.exists(kelompokKey) Then
                tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
            End If

            ' Urutkan subkategori
            Dim sortedSubKategoriKeys As Variant
            sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
            
            ' Loop melalui setiap subkategori dalam kategori
            For Each subKategoriKey In sortedSubKategoriKeys
                ' Tulis data kategori dan subkategori
                wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
                wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
                
                ' Tambahkan uraian jika tersedia
                If uraianDict.exists(subKategoriKey) Then
                    wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
                Else
                    wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
                End If
                
                ' Tulis total per bulan
                Dim bulanColumn As Long
                Dim totalSubKategori As Double
                totalSubKategori = 0
                For Each bulanKey In bulanCol.keys
                    uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                    If totalKas.exists(uniqueKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                        totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                        
                        ' Akumulasi total sementara per kelompok dan bulan
                        kelompokTotalKey = kelompokKey & "|" & bulanKey
                        If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                            tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                        Else
                            tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                        End If
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey
                
                ' Tulis total subkategori di kolom Total
                wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                
                rowIndex = rowIndex + 1
            Next subKategoriKey
            
            ' Tulis total per kategori dan bulan setelah semua subkategori selesai
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            Dim totalKategori As Double
            totalKategori = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total kategori di kolom Total
            wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
            
            rowIndex = rowIndex + 1

            ' Cek apakah ini adalah kategori terakhir dalam kelompok
            Dim isLastKategoriInKelompok As Boolean
            isLastKategoriInKelompok = True
            For Each k In sortedKategoriKeys
                If Left(k, 3) = kelompokKey And k > kategoriKey Then
                    isLastKategoriInKelompok = False
                    Exit For
                End If
            Next k

            ' Jika ini adalah kategori terakhir dalam kelompok, tulis total kelompok
            If isLastKategoriInKelompok Then
                ' Tulis total per kelompok
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                Dim totalKelompok As Double
                totalKelompok = 0
                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                        ' Beri warna kuning pada sel yang berisi nilai
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Warna kuning
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey

                ' Tulis total kelompok di kolom Total
                wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0) ' Warna kuning

                rowIndex = rowIndex + 1
            End If
        End If
    Next kategoriKey

    ' Tulis Total Keseluruhan di baris terakhir
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    Dim totalKeseluruhan As Double
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        ' Beri warna biru pada sel yang berisi nilai
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Warna biru
    Next bulanKey
    
    ' Tulis total keseluruhan di kolom Total
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240) ' Warna biru
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    ' Jika kode adalah "Uang Setoran", kembalikan langsung tanpa perubahan
    If Trim(kode) = "Uang Setoran" Then
        CleanCode = "Uang Setoran"
        Exit Function
    End If
    
    ' Lanjutkan pembersihan kode untuk kasus lainnya
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Pastikan arr(j) dan arr(i) adalah tanggal yang valid sebelum membandingkan
            If IsDate(arr(j)) And IsDate(arr(i)) Then
                If CDate(arr(j)) < CDate(arr(i)) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika bukan tanggal yang valid, abaikan atau beri pesan debug
                Debug.Print "Nilai tidak valid: arr(" & j & ") = " & arr(j) & ", arr(" & i & ") = " & arr(i)
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub
--------------------------
udah bisa sheet 3 nya tanpa ada spasi pada kategori :
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Dictionary untuk menyimpan total keseluruhan per bulan
    Dim totalKeseluruhanPerBulan As Object
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default "Uang Setoran"
        If kodeSub = "" Then
            kodeSub = "Uang Setoran"
            kategori = "Uang Setoran" ' Khusus untuk "Uang Setoran", kategori sama dengan kodeSub
        Else
            ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan ke daftar bulan jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0 ' Inisialisasi total keseluruhan per bulan
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Pastikan array bulan diurutkan dengan benar
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Tambahkan kolom Total di sebelah kanan
    wsTujuan.Cells(1, colIndex).Value = "Total"
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan total sementara per kelompok
    Dim tempTotalPerKelompok As Object
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Jika kategori adalah "Uang Setoran", tulis sebagai kategori terpisah
        If kategoriKey = "Uang Setoran" Then
            wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            ' Tulis total per bulan untuk "Uang Setoran"
            Dim totalUangSetoran As Double
            totalUangSetoran = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalUangSetoran = totalUangSetoran + totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total Uang Setoran di kolom Total
            wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
            
            rowIndex = rowIndex + 1
        Else
            ' Lanjutkan dengan logika yang sudah ada untuk kategori lainnya
            Dim firstRowInCategory As Long
            firstRowInCategory = rowIndex

            ' Ambil 3 angka pertama dari kategori sebagai kelompokKey
            kelompokKey = Left(kategoriKey, 3)

            ' Jika kelompok ini belum diproses, inisialisasi total sementara
            If Not tempTotalPerKelompok.exists(kelompokKey) Then
                tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
            End If

            ' Urutkan subkategori
            Dim sortedSubKategoriKeys As Variant
            sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
            
            ' Loop melalui setiap subkategori dalam kategori
            For Each subKategoriKey In sortedSubKategoriKeys
                ' Tulis data kategori dan subkategori
                wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
                wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
                
                ' Tambahkan uraian jika tersedia
                If uraianDict.exists(subKategoriKey) Then
                    wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
                Else
                    wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
                End If
                
                ' Tulis total per bulan
                Dim bulanColumn As Long
                Dim totalSubKategori As Double
                totalSubKategori = 0
                For Each bulanKey In bulanCol.keys
                    uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                    If totalKas.exists(uniqueKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                        totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                        
                        ' Akumulasi total sementara per kelompok dan bulan
                        kelompokTotalKey = kelompokKey & "|" & bulanKey
                        If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                            tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                        Else
                            tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                        End If
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey
                
                ' Tulis total subkategori di kolom Total
                wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                
                rowIndex = rowIndex + 1
            Next subKategoriKey
            
            ' Tulis total per kategori dan bulan setelah semua subkategori selesai
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            Dim totalKategori As Double
            totalKategori = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total kategori di kolom Total
            wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
            
            rowIndex = rowIndex + 1

            ' Cek apakah ini adalah kategori terakhir dalam kelompok
            Dim isLastKategoriInKelompok As Boolean
            isLastKategoriInKelompok = True
            For Each k In sortedKategoriKeys
                If Left(k, 3) = kelompokKey And k > kategoriKey Then
                    isLastKategoriInKelompok = False
                    Exit For
                End If
            Next k

            ' Jika ini adalah kategori terakhir dalam kelompok, tulis total kelompok
            If isLastKategoriInKelompok Then
                ' Tulis total per kelompok
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                Dim totalKelompok As Double
                totalKelompok = 0
                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                        ' Beri warna kuning pada sel yang berisi nilai
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Warna kuning
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey

                ' Tulis total kelompok di kolom Total
                wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0) ' Warna kuning

                rowIndex = rowIndex + 1
            End If
        End If
    Next kategoriKey

    ' Tulis Total Keseluruhan di baris terakhir
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    Dim totalKeseluruhan As Double
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        ' Beri warna biru pada sel yang berisi nilai
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Warna biru
    Next bulanKey
    
    ' Tulis total keseluruhan di kolom Total
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240) ' Warna biru
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    ' Menghapus semua spasi dari kode
    kode = Replace(kode, " ", "") ' Menghapus semua spasi
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Pastikan arr(j) dan arr(i) adalah tanggal yang valid sebelum membandingkan
            If IsDate(arr(j)) And IsDate(arr(i)) Then
                If CDate(arr(j)) < CDate(arr(i)) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika bukan tanggal yang valid, abaikan atau beri pesan debug
                Debug.Print "Nilai tidak valid: arr(" & j & ") = " & arr(j) & ", arr(" & i & ") = " & arr(i)
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub

---------------------------

kode sheet 3 untuk tiadakan kolom tidak diketahui utk bulan:
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Dictionary untuk menyimpan total keseluruhan per bulan
    Dim totalKeseluruhanPerBulan As Object
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal (hanya jika tanggal valid)
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
            
            ' Tambahkan ke daftar bulan jika belum ada
            If Not allBulan.exists(bulan) Then
                allBulan.Add bulan, Nothing
                totalKeseluruhanPerBulan.Add bulan, 0 ' Inisialisasi total keseluruhan per bulan
            End If
        Else
            ' Jika tanggal tidak valid, skip ke iterasi berikutnya
            GoTo NextIteration
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default "Uang Setoran"
        If kodeSub = "" Then
            kodeSub = "Uang Setoran"
            kategori = "Uang Setoran" ' Khusus untuk "Uang Setoran", kategori sama dengan kodeSub
        Else
            ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan total sementara per kelompok
    Dim tempTotalPerKelompok As Object
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Jika kategori adalah "Uang Setoran", tulis sebagai kategori terpisah
        If kategoriKey = "Uang Setoran" Then
            wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            ' Tulis total per bulan untuk "Uang Setoran"
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1
        Else
            ' Lanjutkan dengan logika yang sudah ada untuk kategori lainnya
            Dim firstRowInCategory As Long
            firstRowInCategory = rowIndex

            ' Ambil 3 angka pertama dari kategori sebagai kelompokKey
            kelompokKey = Left(kategoriKey, 3)

            ' Jika kelompok ini belum diproses, inisialisasi total sementara
            If Not tempTotalPerKelompok.exists(kelompokKey) Then
                tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
            End If

            ' Urutkan subkategori
            Dim sortedSubKategoriKeys As Variant
            sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
            
            ' Loop melalui setiap subkategori dalam kategori
            For Each subKategoriKey In sortedSubKategoriKeys
                ' Tulis data kategori dan subkategori
                wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
                wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
                
                ' Tambahkan uraian jika tersedia
                If uraianDict.exists(subKategoriKey) Then
                    wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
                Else
                    wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
                End If
                
                ' Tulis total per bulan
                For Each bulanKey In bulanCol.keys
                    uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                    If totalKas.exists(uniqueKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                        
                        ' Akumulasi total sementara per kelompok dan bulan
                        kelompokTotalKey = kelompokKey & "|" & bulanKey
                        If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                            tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                        Else
                            tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                        End If
                    End If
                Next bulanKey
                
                rowIndex = rowIndex + 1
            Next subKategoriKey
            
            ' Tulis total per kategori dan bulan setelah semua subkategori selesai
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                End If
            Next bulanKey
            
            rowIndex = rowIndex + 1

            ' Cek apakah ini adalah kategori terakhir dalam kelompok
            Dim isLastKategoriInKelompok As Boolean
            isLastKategoriInKelompok = True
            For Each k In sortedKategoriKeys
                If Left(k, 3) = kelompokKey And k > kategoriKey Then
                    isLastKategoriInKelompok = False
                    Exit For
                End If
            Next k

            ' Jika ini adalah kategori terakhir dalam kelompok, tulis total kelompok
            If isLastKategoriInKelompok Then
                ' Tulis total per kelompok
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        ' Beri warna kuning pada sel yang berisi nilai
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Warna kuning
                    End If
                Next bulanKey

                rowIndex = rowIndex + 1
            End If
        End If
    Next kategoriKey
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    ' Jika kode adalah "Uang Setoran", kembalikan langsung tanpa perubahan
    If Trim(kode) = "Uang Setoran" Then
        CleanCode = "Uang Setoran"
        Exit Function
    End If
    
    ' Lanjutkan pembersihan kode untuk kasus lainnya
    kode = Replace(kode, ",", ".")
    kode = Trim(kode)
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub




------------------------------
sheet 3 udah handle kategori dengna spasi:
Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Dictionary untuk menyimpan total keseluruhan per bulan
    Dim totalKeseluruhanPerBulan As Object
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal (hanya jika tanggal valid)
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
            
            ' Tambahkan ke daftar bulan jika belum ada
            If Not allBulan.exists(bulan) Then
                allBulan.Add bulan, Nothing
                totalKeseluruhanPerBulan.Add bulan, 0 ' Inisialisasi total keseluruhan per bulan
            End If
        Else
            ' Jika tanggal tidak valid, skip ke iterasi berikutnya
            GoTo NextIteration
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default "Uang Setoran"
        If kodeSub = "" Then
            kodeSub = "Uang Setoran"
            kategori = "Uang Setoran" ' Khusus untuk "Uang Setoran", kategori sama dengan kodeSub
        Else
            ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Tambahkan kolom "Total Keseluruhan" di kolom terakhir
    wsTujuan.Cells(1, colIndex).Value = "Total Keseluruhan"
    
    ' Proses menuliskan data ke sheet 3 berdasarkan kategori dan subkategori
    Dim rowIndex As Long
    rowIndex = 2

    ' Dictionary untuk menyimpan total sementara per kelompok
    Dim tempTotalPerKelompok As Object
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dan subkategori
    Dim sortedKategoriKeys As Variant
    sortedKategoriKeys = SortKeysByDictionaryOrder(kategoriDict.keys)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Jika kategori adalah "Uang Setoran", tulis sebagai kategori terpisah
        If kategoriKey = "Uang Setoran" Then
            wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            ' Tulis total per bulan untuk "Uang Setoran"
            Dim totalUangSetoran As Double
            totalUangSetoran = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalUangSetoran = totalUangSetoran + totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                End If
            Next bulanKey
            
            ' Tulis total keseluruhan untuk "Uang Setoran"
            wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
            
            rowIndex = rowIndex + 1
        Else
            ' Lanjutkan dengan logika yang sudah ada untuk kategori lainnya
            Dim firstRowInCategory As Long
            firstRowInCategory = rowIndex

            ' Ambil 3 angka pertama dari kategori sebagai kelompokKey
            kelompokKey = Left(kategoriKey, 3)

            ' Jika kelompok ini belum diproses, inisialisasi total sementara
            If Not tempTotalPerKelompok.exists(kelompokKey) Then
                tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
            End If

            ' Urutkan subkategori
            Dim sortedSubKategoriKeys As Variant
            sortedSubKategoriKeys = SortKeysByDictionaryOrder(subKategoriDict(kategoriKey).keys)
            
            ' Loop melalui setiap subkategori dalam kategori
            For Each subKategoriKey In sortedSubKategoriKeys
                ' Tulis data kategori dan subkategori
                wsTujuan.Cells(rowIndex, 1).Value = kategoriKey ' Kategori
                wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey ' Kode Subkategori
                
                ' Tambahkan uraian jika tersedia
                If uraianDict.exists(subKategoriKey) Then
                    wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
                Else
                    wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
                End If
                
                ' Tulis total per bulan
                Dim totalSubKategori As Double
                totalSubKategori = 0
                For Each bulanKey In bulanCol.keys
                    uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                    If totalKas.exists(uniqueKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                        totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                        
                        ' Akumulasi total sementara per kelompok dan bulan
                        kelompokTotalKey = kelompokKey & "|" & bulanKey
                        If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                            tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                        Else
                            tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                        End If
                    End If
                Next bulanKey
                
                ' Tulis total keseluruhan untuk subkategori
                wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                
                rowIndex = rowIndex + 1
            Next subKategoriKey
            
            ' Tulis total per kategori dan bulan setelah semua subkategori selesai
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            Dim totalKategori As Double
            totalKategori = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                    ' Beri warna hijau pada sel yang berisi nilai
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Warna hijau
                End If
            Next bulanKey
            
            ' Tulis total keseluruhan untuk kategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Warna hijau
            
            rowIndex = rowIndex + 1

            ' Cek apakah ini adalah kategori terakhir dalam kelompok
            Dim isLastKategoriInKelompok As Boolean
            isLastKategoriInKelompok = True
            For Each k In sortedKategoriKeys
                If Left(k, 3) = kelompokKey And k > kategoriKey Then
                    isLastKategoriInKelompok = False
                    Exit For
                End If
            Next k

            ' Jika ini adalah kategori terakhir dalam kelompok, tulis total kelompok
            If isLastKategoriInKelompok Then
                ' Tulis total per kelompok
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                Dim totalKelompok As Double
                totalKelompok = 0
                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                        ' Beri warna kuning pada sel yang berisi nilai
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Warna kuning
                    End If
                Next bulanKey

                ' Tulis total keseluruhan untuk kelompok
                wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0) ' Warna kuning

                rowIndex = rowIndex + 1
            End If
        End If
    Next kategoriKey
End Sub

' Fungsi untuk mengurutkan kunci dictionary
Function SortKeysByDictionaryOrder(keys As Variant) As Variant
    Dim sortedList As Collection
    Set sortedList = New Collection
    Dim key As Variant
    
    ' Tambahkan kunci ke koleksi
    For Each key In keys
        sortedList.Add key
    Next key
    
    ' Urutkan koleksi berdasarkan urutan kamus
    Dim sortedKeys() As String
    ReDim sortedKeys(0 To sortedList.Count - 1)
    Dim i As Long
    For i = 1 To sortedList.Count
        sortedKeys(i - 1) = sortedList(i)
    Next i
    
    ' Urutkan kunci secara numerik
    Call BubbleSort(sortedKeys)
    
    SortKeysByDictionaryOrder = sortedKeys
End Function

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    ' Jika kode adalah "Uang Setoran", kembalikan langsung tanpa perubahan
    If Trim(kode) = "Uang Setoran" Then
        CleanCode = "Uang Setoran"
        Exit Function
    End If
    
    ' Hilangkan spasi di awal dan akhir
    kode = Trim(kode)
    
    ' Ganti koma dengan titik
    kode = Replace(kode, ",", ".")
    
    ' Hilangkan spasi di antara angka dan huruf (misal: "200.01.02 f" menjadi "200.01.02f")
    kode = Replace(kode, " ", "")
    
    ' Pastikan tidak ada titik di awal atau akhir kode
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02f", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03a", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub




-------------------------------kode yg udah ada uraian lengkap tp masih nol semua
Option Explicit

Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Loop melalui data sumber untuk mengumpulkan bulan yang ada
    Dim i As Long
    For i = 4 To UBound(data, 1)
        Dim tgl As Variant
        tgl = data(i, 1)
        If IsDate(tgl) Then
            Dim bulan As String
            bulan = Format(tgl, "mmmm yyyy")
            If Not allBulan.exists(bulan) Then
                allBulan.Add bulan, Nothing
            End If
        End If
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Tambahkan kolom "Total Keseluruhan" di kolom terakhir
    wsTujuan.Cells(1, colIndex).Value = "Total Keseluruhan"
    
    ' Proses menuliskan data ke sheet 3 berdasarkan uraian yang ada di InisialisasiUraian
    Dim rowIndex As Long
    rowIndex = 2
    
    ' Loop melalui semua uraian yang ada di InisialisasiUraian
    Dim kodeSub As Variant
    For Each kodeSub In uraianDict.keys
        ' Tulis kategori, kode subkategori, dan uraian
        wsTujuan.Cells(rowIndex, 1).Value = Left(kodeSub, 6) ' Ambil 6 karakter pertama sebagai kategori
        wsTujuan.Cells(rowIndex, 2).Value = kodeSub
        wsTujuan.Cells(rowIndex, 3).Value = uraianDict(kodeSub)
        
        ' Loop melalui semua bulan untuk mengisi nilai (jika ada)
        For Each bulanKey In bulanCol.keys
            Dim uniqueKey As String
            uniqueKey = Left(kodeSub, 6) & "|" & kodeSub & "|" & bulanKey
            If totalKas.exists(uniqueKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0 ' Jika tidak ada data, isi dengan 0
            End If
        Next bulanKey
        
        ' Tulis total keseluruhan untuk subkategori
        Dim totalSubKategori As Double
        totalSubKategori = 0
        For Each bulanKey In bulanCol.keys
            uniqueKey = Left(kodeSub, 6) & "|" & kodeSub & "|" & bulanKey
            If totalKas.exists(uniqueKey) Then
                totalSubKategori = totalSubKategori + totalKas(uniqueKey)
            End If
        Next bulanKey
        wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
        
        rowIndex = rowIndex + 1
    Next kodeSub
End Sub

Function CleanCode(kode As String) As String
    ' Jika kode adalah "Uang Setoran", kembalikan langsung tanpa perubahan
    If Trim(kode) = "Uang Setoran" Then
        CleanCode = "Uang Setoran"
        Exit Function
    End If
    
    ' Hilangkan spasi di awal dan akhir
    kode = Trim(kode)
    
    ' Ganti koma dengan titik
    kode = Replace(kode, ",", ".")
    
    ' Hilangkan spasi di antara angka dan huruf (misal: "200.01.02 f" menjadi "200.01.02f")
    kode = Replace(kode, " ", "")
    
    ' Pastikan tidak ada titik di awal atau akhir kode
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    
    CleanCode = kode
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02f", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03a", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub






----------------------------------
ini sheet 3 udah ada semua uraian tp total totalnya kacau


Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori dan bulan
    Dim totalPerKategoriBulan As Object
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok 3 angka sama di depan
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Dictionary untuk menyimpan total keseluruhan per bulan
    Dim totalKeseluruhanPerBulan As Object
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")

    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    Dim kelompokTotalKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal (hanya jika tanggal valid)
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
            
            ' Tambahkan ke daftar bulan jika belum ada
            If Not allBulan.exists(bulan) Then
                allBulan.Add bulan, Nothing
                totalKeseluruhanPerBulan.Add bulan, 0 ' Inisialisasi total keseluruhan per bulan
            End If
        Else
            ' Jika tanggal tidak valid, skip ke iterasi berikutnya
            GoTo NextIteration
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default "Uang Setoran"
        If kodeSub = "" Then
            kodeSub = "Uang Setoran"
            kategori = "Uang Setoran" ' Khusus untuk "Uang Setoran", kategori sama dengan kodeSub
        Else
            ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        kelompokTotalKey = kelompokKey & "|" & bulan
        If totalPerKelompok.exists(kelompokTotalKey) Then
            totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
        Else
            totalPerKelompok.Add kelompokTotalKey, kas
        End If

        ' Akumulasi total per kategori dan bulan
        Dim totalKey As String
        totalKey = kategori & "|" & bulan
        If totalPerKategoriBulan.exists(totalKey) Then
            totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
        Else
            totalPerKategoriBulan.Add totalKey, kas
        End If
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As String, idx As Long
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    Dim bulanKey As Variant
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Tambahkan kolom "Total Keseluruhan" di kolom terakhir
    wsTujuan.Cells(1, colIndex).Value = "Total Keseluruhan"
    
    ' Panggil fungsi TulisUraianKeSheet untuk menulis uraian ke sheet tujuan
    Call TulisUraianKeSheet(wsTujuan, uraianDict, totalKas, bulanCol, colIndex)
End Sub

' Fungsi untuk menulis uraian ke sheet tujuan
Sub TulisUraianKeSheet(wsTujuan As Worksheet, uraianDict As Object, totalKas As Object, bulanCol As Object, colIndex As Long)
    Dim rowIndex As Long
    rowIndex = 2 ' Mulai dari baris kedua setelah header

    Dim kodeSub As Variant
    For Each kodeSub In uraianDict.keys
        ' Tulis kategori, kode subkategori, dan uraian
        wsTujuan.Cells(rowIndex, 1).Value = Left(kodeSub, 6) ' Ambil 6 karakter pertama sebagai kategori
        wsTujuan.Cells(rowIndex, 2).Value = kodeSub
        wsTujuan.Cells(rowIndex, 3).Value = uraianDict(kodeSub) ' Tulis uraian dari dictionary
        
        ' Loop melalui semua bulan untuk mengisi nilai jika ada
        Dim bulanKey As Variant
        For Each bulanKey In bulanCol.keys
            Dim uniqueKey As String
            uniqueKey = Left(kodeSub, 6) & "|" & kodeSub & "|" & bulanKey
            If totalKas.exists(uniqueKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0 ' Jika tidak ada data, isi dengan 0
            End If
        Next bulanKey
        
        ' Tulis total keseluruhan untuk subkategori
        Dim totalSubKategori As Double
        totalSubKategori = 0
        For Each bulanKey In bulanCol.keys
            uniqueKey = Left(kodeSub, 6) & "|" & kodeSub & "|" & bulanKey
            If totalKas.exists(uniqueKey) Then
                totalSubKategori = totalSubKategori + totalKas(uniqueKey)
            End If
        Next bulanKey
        wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
        
        rowIndex = rowIndex + 1
    Next kodeSub
End Sub

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    ' Jika kode adalah "Uang Setoran", kembalikan langsung tanpa perubahan
    If Trim(kode) = "Uang Setoran" Then
        CleanCode = "Uang Setoran"
        Exit Function
    End If
    
    ' Hilangkan spasi di awal dan akhir
    kode = Trim(kode)
    
    ' Ganti koma dengan titik
    kode = Replace(kode, ",", ".")
    
    ' Hilangkan spasi di antara angka dan huruf (misal: "200.01.02 f" menjadi "200.01.02f")
    kode = Replace(kode, " ", "")
    
    ' Pastikan tidak ada titik di awal atau akhir kode
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    
    CleanCode = kode
End Function

' Sub untuk mengurutkan array bulan
Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02f", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03a", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub
--------------------------------
ini adalah sheet terakhir yg belum di kasi total total 

Sub SalinTotalKeSheet3_Horizontal()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    Dim data As Variant
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Dictionary untuk menyimpan total kas per kategori, subkategori, dan bulan
    Dim totalKas As Object
    Set totalKas = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan uraian kode subkategori
    Dim uraianDict As Object
    Set uraianDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan subkategori per kategori
    Dim subKategoriDict As Object
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua bulan yang ada
    Dim allBulan As Object
    Set allBulan = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan semua kategori yang ada
    Dim kategoriDict As Object
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kelompok (3 angka pertama kode)
    Dim totalPerKelompok As Object
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total per kategori
    Dim totalPerKategori As Object
    Set totalPerKategori = CreateObject("Scripting.Dictionary")
    
    ' Dictionary untuk menyimpan total keseluruhan per bulan
    Dim totalKeseluruhanPerBulan As Object
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    Dim i As Long
    Dim tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String
    
    ' Loop melalui data sumber
    For i = 4 To UBound(data, 1)
        tgl = data(i, 1)
        kas = 0
        
        ' Ambil nilai kas dari kolom 4
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Ambil bulan dari tanggal (hanya jika tanggal valid)
        If IsDate(tgl) Then
            bulan = Format(tgl, "mmmm yyyy")
            
            ' Tambahkan ke daftar bulan jika belum ada
            If Not allBulan.exists(bulan) Then
                allBulan.Add bulan, Nothing
                totalKeseluruhanPerBulan.Add bulan, 0 ' Inisialisasi total keseluruhan per bulan
            End If
        Else
            ' Jika tanggal tidak valid, skip ke iterasi berikutnya
            GoTo NextIteration
        End If
        
        ' Ambil kode subkategori dari kolom yang valid
        kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
        
        ' Jika kode tidak ditemukan, beri default "Uang Setoran"
        If kodeSub = "" Then
            kodeSub = "Uang Setoran"
            kategori = "Uang Setoran" ' Khusus untuk "Uang Setoran", kategori sama dengan kodeSub
        Else
            ' Ambil kategori utama (6 karakter awal kode, misalnya '200.01')
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
        End If
        
        ' Tambahkan ke daftar kategori jika belum ada
        If Not kategoriDict.exists(kategori) Then
            kategoriDict.Add kategori, Nothing
            subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Buat key unik berdasarkan kategori, kode subkategori, dan bulan
        Dim uniqueKey As String
        uniqueKey = kategori & "|" & kodeSub & "|" & bulan
        
        ' Akumulasi total kas per kategori dan subkategori
        If Not subKategoriDict(kategori).exists(kodeSub) Then
            subKategoriDict(kategori).Add kodeSub, Nothing
        End If

        If totalKas.exists(uniqueKey) Then
            totalKas(uniqueKey) = totalKas(uniqueKey) + kas
        Else
            totalKas.Add uniqueKey, kas
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
        ' Ambil 3 angka pertama dari kode subkategori
        If Len(kodeSub) >= 3 Then
            kelompokKey = Left(kodeSub, 3)
        Else
            kelompokKey = kodeSub
        End If

        ' Akumulasi total per kelompok
        If totalPerKelompok.exists(kelompokKey) Then
            totalPerKelompok(kelompokKey) = totalPerKelompok(kelompokKey) + kas
        Else
            totalPerKelompok.Add kelompokKey, kas
        End If

        ' Akumulasi total per kategori
        If totalPerKategori.exists(kategori) Then
            totalPerKategori(kategori) = totalPerKategori(kategori) + kas
        Else
            totalPerKategori.Add kategori, kas
        End If
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan sebelum menulis data baru
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    Dim bulanList() As Variant
    bulanList = allBulan.keys
    Call BubbleSort(bulanList)
    
    Dim bulanCol As Object
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    Dim colIndex As Long
    colIndex = 4
    For Each bulanKey In bulanList
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next bulanKey
    
    ' Tambahkan kolom "Total Keseluruhan", "Total Kategori", dan "Total Kelompok"
    wsTujuan.Cells(1, colIndex).Value = "Total Keseluruhan"
    wsTujuan.Cells(1, colIndex + 1).Value = "Total Kategori"
    wsTujuan.Cells(1, colIndex + 2).Value = "Total Kelompok"
    
    ' Panggil fungsi TulisUraianKeSheet untuk menulis uraian ke sheet tujuan
    Call TulisUraianKeSheet(wsTujuan, uraianDict, totalKas, bulanCol, colIndex, totalPerKelompok, totalPerKategori, totalKeseluruhanPerBulan)
End Sub

' Fungsi untuk menulis uraian ke sheet tujuan
Sub TulisUraianKeSheet(wsTujuan As Worksheet, uraianDict As Object, totalKas As Object, bulanCol As Object, colIndex As Long, totalPerKelompok As Object, totalPerKategori As Object, totalKeseluruhanPerBulan As Object)
    Dim rowIndex As Long
    rowIndex = 2 ' Mulai dari baris kedua setelah header

    ' Konversi keys dari Dictionary ke array
    Dim kodeSubList() As Variant
    kodeSubList = uraianDict.keys

    ' Urutkan kode subkategori dari terkecil ke terbesar
    Call BubbleSort(kodeSubList)

    ' Tulis data subkategori
    Dim kodeSub As Variant
    For Each kodeSub In kodeSubList
        ' Tulis kategori, kode subkategori, dan uraian
        wsTujuan.Cells(rowIndex, 1).Value = Left(kodeSub, 6) ' Ambil 6 karakter pertama sebagai kategori
        wsTujuan.Cells(rowIndex, 2).Value = kodeSub
        wsTujuan.Cells(rowIndex, 3).Value = uraianDict(kodeSub) ' Tulis uraian dari dictionary
        
        ' Loop melalui semua bulan untuk mengisi nilai jika ada
        Dim bulanKey As Variant
        Dim totalSubKategori As Double
        totalSubKategori = 0 ' Inisialisasi total subkategori
        For Each bulanKey In bulanCol.keys
            Dim uniqueKey As String
            uniqueKey = Left(kodeSub, 6) & "|" & kodeSub & "|" & bulanKey
            If totalKas.exists(uniqueKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                totalSubKategori = totalSubKategori + totalKas(uniqueKey) ' Tambahkan ke total subkategori
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0 ' Jika tidak ada data, isi dengan 0
            End If
        Next bulanKey
        
        ' Tulis total keseluruhan untuk subkategori
        wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori ' Tulis total keseluruhan untuk subkategori
        
        ' Tulis total per kategori (menggunakan total dari totalPerKategori)
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = totalPerKategori(Left(kodeSub, 6)) ' Total per kategori
        
        ' Tulis total per kelompok (menggunakan total dari totalPerKelompok)
        wsTujuan.Cells(rowIndex, colIndex + 2).Value = totalPerKelompok(Left(kodeSub, 3)) ' Total per kelompok
        
        rowIndex = rowIndex + 1
    Next kodeSub
    
    ' Tulis total per kelompok
    wsTujuan.Cells(rowIndex, 1).Value = "Total Per Kelompok"
    rowIndex = rowIndex + 1
    
    ' Konversi keys dari Dictionary ke array
    Dim kelompokList() As Variant
    kelompokList = totalPerKelompok.keys

    ' Urutkan kelompok dari terkecil ke terbesar
    Call BubbleSort(kelompokList)
    
    For Each kelompokKey In kelompokList
        wsTujuan.Cells(rowIndex, 1).Value = kelompokKey
        wsTujuan.Cells(rowIndex, 2).Value = totalPerKelompok(kelompokKey)
        rowIndex = rowIndex + 1
    Next kelompokKey
    
    ' Tulis total per kategori
    wsTujuan.Cells(rowIndex, 1).Value = "Total Per Kategori"
    rowIndex = rowIndex + 1
    
    ' Konversi keys dari Dictionary ke array
    Dim kategoriList() As Variant
    kategoriList = totalPerKategori.keys

    ' Urutkan kategori dari terkecil ke terbesar
    Call BubbleSort(kategoriList)
    
    For Each kategoriKey In kategoriList
        wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
        wsTujuan.Cells(rowIndex, 2).Value = totalPerKategori(kategoriKey)
        rowIndex = rowIndex + 1
    Next kategoriKey
    
    ' Tulis total keseluruhan per bulan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan Per Bulan"
    rowIndex = rowIndex + 1
    
    ' Konversi keys dari Dictionary ke array
    Dim bulanList() As Variant
    bulanList = totalKeseluruhanPerBulan.keys

    ' Urutkan bulan dari terkecil ke terbesar
    Call BubbleSort(bulanList)
    
    For Each bulanKey In bulanList
        wsTujuan.Cells(rowIndex, 1).Value = bulanKey
        wsTujuan.Cells(rowIndex, 2).Value = totalKeseluruhanPerBulan(bulanKey)
        rowIndex = rowIndex + 1
    Next bulanKey
End Sub

' Fungsi untuk membersihkan format kode
Function CleanCode(kode As String) As String
    ' Jika kode adalah "Uang Setoran", kembalikan langsung tanpa perubahan
    If Trim(kode) = "Uang Setoran" Then
        CleanCode = "Uang Setoran"
        Exit Function
    End If
    
    ' Hilangkan spasi di awal dan akhir
    kode = Trim(kode)
    
    ' Ganti koma dengan titik
    kode = Replace(kode, ",", ".")
    
    ' Hilangkan spasi di antara angka dan huruf (misal: "200.01.02 f" menjadi "200.01.02f")
    kode = Replace(kode, " ", "")
    
    ' Pastikan tidak ada titik di awal atau akhir kode
    If Left(kode, 1) = "." Then kode = Mid(kode, 2)
    If Right(kode, 1) = "." Then kode = Left(kode, Len(kode) - 1)
    
    CleanCode = kode
End Function

' Sub untuk mengurutkan array
Sub BubbleSort(arr() As Variant)
    Dim i As Long, j As Long
    Dim temp As Variant
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(j) < arr(i) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

' Sub untuk menginisialisasi uraian kode subkategori
Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02f", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03a", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub

------------------
kode sheet 3 udah ada ttal keseluruhan dan  uang setoran

Option Explicit

Sub SalinTotalKeSheet3_Horizontal()
    ' Deklarasi semua variabel
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Dim data As Variant
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Dim allBulan As Object, kategoriDict As Object, totalPerKategoriBulan As Object
    Dim totalPerKelompok As Object, totalKeseluruhanPerBulan As Object, uangSetoranDict As Object
    Dim tempTotalPerKelompok As Object, bulanCol As Object
    Dim i As Long, tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String, kelompokTotalKey As String, uniqueKey As String, totalKey As String
    Dim bulanList() As String, idx As Long, colIndex As Long, rowIndex As Long
    Dim bulanKey As Variant, key As Variant
    Dim totalUangSetoran As Double, totalSubKategori As Double, totalKategori As Double
    Dim totalKelompok As Double, totalKeseluruhan As Double
    Dim lastCol As Long
    Dim firstRowInCategory As Long
    Dim isLastKategoriInKelompok As Boolean
    Dim k As Variant, kategoriKey As Variant, subKategoriKey As Variant
    Dim sortedKategoriKeys() As Variant, sortedSubKategoriKeys() As Variant
    
    ' Set workbook dan worksheet
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    ' Ambil data dari sheet sumber
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    Set uangSetoranDict = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    ' Proses data sumber
    For i = 4 To UBound(data, 1)
        ' Ambil nilai kas dari kolom 4
        kas = 0
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Skip jika tidak ada nilai kas
        If kas = 0 Then
            GoTo NextIteration
        End If
        
        ' Ambil bulan dari tanggal (kolom 1)
        If IsDate(data(i, 1)) Then
            bulan = Format(data(i, 1), "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Tambahkan bulan ke dictionary jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0
        End If
        
        ' Identifikasi apakah ini Uang Setoran
        If IsUangSetoran(data, i) Then
            ' Proses khusus untuk Uang Setoran
            kategori = "Uang Setoran"
            kodeSub = "Uang Setoran"
            
            ' Akumulasi total Uang Setoran per bulan
            If uangSetoranDict.exists(bulan) Then
                uangSetoranDict(bulan) = uangSetoranDict(bulan) + kas
            Else
                uangSetoranDict.Add bulan, kas
            End If
        Else
            ' Proses untuk kategori lainnya
            kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
            
            ' Skip jika kode subkategori kosong
            If kodeSub = "" Then
                GoTo NextIteration
            End If
            
            ' Ambil kategori utama (6 karakter pertama)
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
            
            ' Tambahkan ke dictionary kategori jika belum ada
            If Not kategoriDict.exists(kategori) Then
                kategoriDict.Add kategori, Nothing
                subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
            End If
            
            ' Buat key unik untuk total kas
            uniqueKey = kategori & "|" & kodeSub & "|" & bulan
            
            ' Akumulasi total kas per subkategori
            If Not subKategoriDict(kategori).exists(kodeSub) Then
                subKategoriDict(kategori).Add kodeSub, Nothing
            End If

            If totalKas.exists(uniqueKey) Then
                totalKas(uniqueKey) = totalKas(uniqueKey) + kas
            Else
                totalKas.Add uniqueKey, kas
            End If
            
            ' Ambil 3 angka pertama untuk kelompok
            If Len(kodeSub) >= 3 Then
                kelompokKey = Left(kodeSub, 3)
            Else
                kelompokKey = kodeSub
            End If

            ' Akumulasi total per kelompok
            kelompokTotalKey = kelompokKey & "|" & bulan
            If totalPerKelompok.exists(kelompokTotalKey) Then
                totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
            Else
                totalPerKelompok.Add kelompokTotalKey, kas
            End If

            ' Akumulasi total per kategori
            totalKey = kategori & "|" & bulan
            If totalPerKategoriBulan.exists(totalKey) Then
                totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
            Else
                totalPerKategoriBulan.Add totalKey, kas
            End If
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan dan siapkan header
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Urutkan bulan secara kronologis
    Call BubbleSort(bulanList)
    
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    colIndex = 4
    For idx = LBound(bulanList) To UBound(bulanList)
        bulanKey = bulanList(idx)
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next idx
    
    ' Tambahkan kolom Total
    wsTujuan.Cells(1, colIndex).Value = "Total"
    
    ' Mulai menulis data ke sheet tujuan
    rowIndex = 2

    ' Tulis Uang Setoran terlebih dahulu jika ada
    If uangSetoranDict.Count > 0 Then
        wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalUangSetoran = 0
        
        For Each bulanKey In bulanCol.keys
            If uangSetoranDict.exists(bulanKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = uangSetoranDict(bulanKey)
                totalUangSetoran = totalUangSetoran + uangSetoranDict(bulanKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(200, 255, 200) ' Hijau muda
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        ' Tulis total
        wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(200, 255, 200)
        
        rowIndex = rowIndex + 1
    End If

    ' Proses kategori lainnya
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori
    sortedKategoriKeys = GetSortedKeys(kategoriDict)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Skip Uang Setoran jika sudah diproses
        If kategoriKey = "Uang Setoran" Then
            GoTo NextKategori
        End If
        
        firstRowInCategory = rowIndex

        ' Ambil kelompok dari 3 angka pertama kategori
        kelompokKey = Left(kategoriKey, 3)

        ' Inisialisasi total sementara per kelompok
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori
        sortedSubKategoriKeys = GetSortedKeys(subKategoriDict(kategoriKey))
        
        ' Loop melalui subkategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey
            
            ' Tambahkan uraian jika ada
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            totalSubKategori = 0
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                    
                    ' Akumulasi total kelompok
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total subkategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Hijau
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total kategori
        wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalKategori = 0
        For Each bulanKey In bulanCol.keys
            totalKey = kategoriKey & "|" & bulanKey
            If totalPerKategoriBulan.exists(totalKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Hijau
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80)
        
        rowIndex = rowIndex + 1

        ' Cek apakah ini kategori terakhir dalam kelompok
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""

            totalKelompok = 0
            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                    totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Kuning
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey

            wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0)
            
            rowIndex = rowIndex + 1
        End If
        
NextKategori:
    Next kategoriKey

    ' Tulis Total Keseluruhan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Biru
    Next bulanKey
    
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240)
    
    ' Format angka sebagai currency
    lastCol = wsTujuan.Cells(1, wsTujuan.Columns.Count).End(xlToLeft).Column
    wsTujuan.Range(wsTujuan.Cells(2, 4), wsTujuan.Cells(rowIndex, lastCol)).NumberFormat = "#,##0"
    
    ' Auto fit kolom
    wsTujuan.Columns.AutoFit
    
    MsgBox "Proses selesai. Data berhasil disalin ke Sheet 3.", vbInformation
End Sub

Function GetSortedKeys(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    
    ' Ambil semua kunci dari dictionary
    keys = dict.keys
    
    ' Urutkan kunci menggunakan bubble sort
    For i = LBound(keys) To UBound(keys) - 1
        For j = i + 1 To UBound(keys)
            If keys(i) > keys(j) Then
                temp = keys(i)
                keys(i) = keys(j)
                keys(j) = temp
            End If
        Next j
    Next i
    
    GetSortedKeys = keys
End Function

Function IsUangSetoran(data As Variant, rowIndex As Long) As Boolean
    ' Cek 1: Jika semua kolom kode kosong (5,7,9,11) dan kolom nilai (4) terisi
    If Trim(data(rowIndex, 5) & data(rowIndex, 7) & data(rowIndex, 9) & data(rowIndex, 11)) = "" And _
       Not IsEmpty(data(rowIndex, 4)) Then
        IsUangSetoran = True
        Exit Function
    End If
    
    ' Cek 2: Jika ada keterangan "Uang Setoran" di kolom 13
    If Not IsEmpty(data(rowIndex, 13)) Then
        If InStr(1, CStr(data(rowIndex, 13)), "Uang Setoran", vbTextCompare) > 0 Then
            IsUangSetoran = True
            Exit Function
        End If
    End If
    
    IsUangSetoran = False
End Function

Function CleanCode(kode As String) As String
    ' Hapus spasi dan karakter khusus
    Dim result As String
    Dim i As Long
    
    result = ""
    For i = 1 To Len(kode)
        Dim c As String
        c = Mid(kode, i, 1)
        
        If c Like "[0-9]" Or c Like "[a-zA-Z]" Or c = "." Then
            result = result & c
        End If
    Next i
    
    CleanCode = result
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Coba konversi ke tanggal untuk perbandingan
            Dim date1 As Date, date2 As Date
            On Error Resume Next
            date1 = CDate(arr(i))
            date2 = CDate(arr(j))
            On Error GoTo 0
            
            ' Jika bisa dikonversi ke tanggal, bandingkan sebagai tanggal
            If IsDate(arr(i)) And IsDate(arr(j)) Then
                If date1 > date2 Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika tidak, bandingkan sebagai string
                If arr(i) > arr(j) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub


---------------------------------
26 maret

ini sheet3 udah ada anggaran pendapatannya

Option Explicit

Sub SalinTotalKeSheet3_Horizontal()
    ' Deklarasi semua variabel
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Dim data As Variant
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Dim allBulan As Object, kategoriDict As Object, totalPerKategoriBulan As Object
    Dim totalPerKelompok As Object, totalKeseluruhanPerBulan As Object, uangSetoranDict As Object
    Dim tempTotalPerKelompok As Object, bulanCol As Object
    Dim i As Long, tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String, kelompokTotalKey As String, uniqueKey As String, totalKey As String
    Dim bulanList() As String, idx As Long, colIndex As Long, rowIndex As Long
    Dim bulanKey As Variant, key As Variant
    Dim totalUangSetoran As Double, totalSubKategori As Double, totalKategori As Double
    Dim totalKelompok As Double, totalKeseluruhan As Double
    Dim lastCol As Long
    Dim firstRowInCategory As Long
    Dim isLastKategoriInKelompok As Boolean
    Dim k As Variant, kategoriKey As Variant, subKategoriKey As Variant
    Dim sortedKategoriKeys() As Variant, sortedSubKategoriKeys() As Variant
    Dim anggaranDict As Object, selisih As Double
    
    ' Set workbook dan worksheet
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    ' Ambil data dari sheet sumber
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    Set uangSetoranDict = CreateObject("Scripting.Dictionary")
    Set anggaranDict = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    ' Inisialisasi data anggaran
    Call InisialisasiAnggaran(anggaranDict)
    
    ' Proses data sumber
    For i = 4 To UBound(data, 1)
        ' Ambil nilai kas dari kolom 4
        kas = 0
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Skip jika tidak ada nilai kas
        If kas = 0 Then
            GoTo NextIteration
        End If
        
        ' Ambil bulan dari tanggal (kolom 1)
        If IsDate(data(i, 1)) Then
            bulan = Format(data(i, 1), "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Tambahkan bulan ke dictionary jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0
        End If
        
        ' Identifikasi apakah ini Uang Setoran
        If IsUangSetoran(data, i) Then
            ' Proses khusus untuk Uang Setoran
            kategori = "Uang Setoran"
            kodeSub = "Uang Setoran"
            
            ' Akumulasi total Uang Setoran per bulan
            If uangSetoranDict.exists(bulan) Then
                uangSetoranDict(bulan) = uangSetoranDict(bulan) + kas
            Else
                uangSetoranDict.Add bulan, kas
            End If
        Else
            ' Proses untuk kategori lainnya
            kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
            
            ' Skip jika kode subkategori kosong
            If kodeSub = "" Then
                GoTo NextIteration
            End If
            
            ' Ambil kategori utama (6 karakter pertama)
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
            
            ' Tambahkan ke dictionary kategori jika belum ada
            If Not kategoriDict.exists(kategori) Then
                kategoriDict.Add kategori, Nothing
                subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
            End If
            
            ' Buat key unik untuk total kas
            uniqueKey = kategori & "|" & kodeSub & "|" & bulan
            
            ' Akumulasi total kas per subkategori
            If Not subKategoriDict(kategori).exists(kodeSub) Then
                subKategoriDict(kategori).Add kodeSub, Nothing
            End If

            If totalKas.exists(uniqueKey) Then
                totalKas(uniqueKey) = totalKas(uniqueKey) + kas
            Else
                totalKas.Add uniqueKey, kas
            End If
            
            ' Ambil 3 angka pertama untuk kelompok
            If Len(kodeSub) >= 3 Then
                kelompokKey = Left(kodeSub, 3)
            Else
                kelompokKey = kodeSub
            End If

            ' Akumulasi total per kelompok
            kelompokTotalKey = kelompokKey & "|" & bulan
            If totalPerKelompok.exists(kelompokTotalKey) Then
                totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
            Else
                totalPerKelompok.Add kelompokTotalKey, kas
            End If

            ' Akumulasi total per kategori
            totalKey = kategori & "|" & bulan
            If totalPerKategoriBulan.exists(totalKey) Then
                totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
            Else
                totalPerKategoriBulan.Add totalKey, kas
            End If
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan dan siapkan header
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Urutkan bulan secara kronologis
    Call BubbleSort(bulanList)
    
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    colIndex = 4
    For idx = LBound(bulanList) To UBound(bulanList)
        bulanKey = bulanList(idx)
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next idx
    
    ' Tambahkan kolom Total, Anggaran Pendapatan, dan Selisih
    wsTujuan.Cells(1, colIndex).Value = "Total"
    wsTujuan.Cells(1, colIndex + 1).Value = "Anggaran Pendapatan"
    wsTujuan.Cells(1, colIndex + 2).Value = "Selisih"
    
    ' Mulai menulis data ke sheet tujuan
    rowIndex = 2

    ' Tulis Uang Setoran terlebih dahulu jika ada
    If uangSetoranDict.Count > 0 Then
        wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalUangSetoran = 0
        
        For Each bulanKey In bulanCol.keys
            If uangSetoranDict.exists(bulanKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = uangSetoranDict(bulanKey)
                totalUangSetoran = totalUangSetoran + uangSetoranDict(bulanKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(200, 255, 200) ' Hijau muda
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        ' Tulis total
        wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(200, 255, 200)
        
        ' Tulis anggaran dan selisih
        If anggaranDict.exists("Uang Setoran") Then
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict("Uang Setoran")
            selisih = totalUangSetoran - anggaranDict("Uang Setoran")
            wsTujuan.Cells(rowIndex, colIndex + 2).Value = selisih
            ' Beri warna berdasarkan surplus/deficit
            If selisih >= 0 Then
                wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(146, 208, 80) ' Hijau untuk surplus
            Else
                wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(255, 0, 0) ' Merah untuk defisit
            End If
        Else
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
            wsTujuan.Cells(rowIndex, colIndex + 2).Value = totalUangSetoran
        End If
        
        rowIndex = rowIndex + 1
    End If

    ' Proses kategori lainnya
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori
    sortedKategoriKeys = GetSortedKeys(kategoriDict)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Skip Uang Setoran jika sudah diproses
        If kategoriKey = "Uang Setoran" Then
            GoTo NextKategori
        End If
        
        firstRowInCategory = rowIndex

        ' Ambil kelompok dari 3 angka pertama kategori
        kelompokKey = Left(kategoriKey, 3)

        ' Inisialisasi total sementara per kelompok
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori
        sortedSubKategoriKeys = GetSortedKeys(subKategoriDict(kategoriKey))
        
        ' Loop melalui subkategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey
            
            ' Tambahkan uraian jika ada
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            totalSubKategori = 0
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                    
                    ' Akumulasi total kelompok
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total subkategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Hijau
            
            ' Tulis anggaran dan selisih untuk subkategori
            If anggaranDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict(subKategoriKey)
                selisih = totalSubKategori - anggaranDict(subKategoriKey)
                wsTujuan.Cells(rowIndex, colIndex + 2).Value = selisih
                ' Beri warna berdasarkan surplus/deficit
                If selisih >= 0 Then
                    wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(146, 208, 80) ' Hijau untuk surplus
                Else
                    wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(255, 0, 0) ' Merah untuk defisit
                End If
            Else
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
                wsTujuan.Cells(rowIndex, colIndex + 2).Value = totalSubKategori
            End If
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total kategori
        wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalKategori = 0
        For Each bulanKey In bulanCol.keys
            totalKey = kategoriKey & "|" & bulanKey
            If totalPerKategoriBulan.exists(totalKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Hijau
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80)
        
        ' Tulis anggaran dan selisih untuk kategori
        If anggaranDict.exists(kategoriKey) Then
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict(kategoriKey)
            selisih = totalKategori - anggaranDict(kategoriKey)
            wsTujuan.Cells(rowIndex, colIndex + 2).Value = selisih
            ' Beri warna berdasarkan surplus/deficit
            If selisih >= 0 Then
                wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(146, 208, 80) ' Hijau untuk surplus
            Else
                wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(255, 0, 0) ' Merah untuk defisit
            End If
        Else
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
            wsTujuan.Cells(rowIndex, colIndex + 2).Value = totalKategori
        End If
        
        rowIndex = rowIndex + 1

        ' Cek apakah ini kategori terakhir dalam kelompok
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""

            totalKelompok = 0
            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                    totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Kuning
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey

            wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0)
            
            ' Tulis anggaran dan selisih untuk kelompok
            Dim totalAnggaranKelompok As Double
            totalAnggaranKelompok = 0
            
            ' Hitung total anggaran untuk kelompok ini
            For Each k In sortedKategoriKeys
                If Left(k, 3) = kelompokKey Then
                    If anggaranDict.exists(k) Then
                        totalAnggaranKelompok = totalAnggaranKelompok + anggaranDict(k)
                    End If
                End If
            Next k
            
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = totalAnggaranKelompok
            selisih = totalKelompok - totalAnggaranKelompok
            wsTujuan.Cells(rowIndex, colIndex + 2).Value = selisih
            ' Beri warna berdasarkan surplus/deficit
            If selisih >= 0 Then
                wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(255, 255, 0) ' Kuning untuk surplus
            Else
                wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(255, 0, 0) ' Merah untuk defisit
            End If
            
            rowIndex = rowIndex + 1
        End If
        
NextKategori:
    Next kategoriKey

    ' Tulis Total Keseluruhan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Biru
    Next bulanKey
    
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240)
    
    ' Hitung total anggaran keseluruhan
    Dim totalAnggaranKeseluruhan As Double
    totalAnggaranKeseluruhan = 0
    
    For Each key In anggaranDict.keys
        ' Hanya hitung yang bukan subkategori (karena subkategori sudah termasuk dalam kategori)
        If Len(key) <= 8 Then ' Asumsi kode kategori maksimal 8 karakter
            totalAnggaranKeseluruhan = totalAnggaranKeseluruhan + anggaranDict(key)
        End If
    Next key
    
    ' Tambahkan uang setoran jika ada
    If anggaranDict.exists("Uang Setoran") Then
        totalAnggaranKeseluruhan = totalAnggaranKeseluruhan + anggaranDict("Uang Setoran")
    End If
    
    ' Tulis anggaran dan selisih untuk keseluruhan
    wsTujuan.Cells(rowIndex, colIndex + 1).Value = totalAnggaranKeseluruhan
    selisih = totalKeseluruhan - totalAnggaranKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex + 2).Value = selisih
    ' Beri warna berdasarkan surplus/deficit
    If selisih >= 0 Then
        wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(0, 176, 240) ' Biru untuk surplus
    Else
        wsTujuan.Cells(rowIndex, colIndex + 2).Interior.Color = RGB(255, 0, 0) ' Merah untuk defisit
    End If
    
    ' Format angka sebagai currency
    lastCol = wsTujuan.Cells(1, wsTujuan.Columns.Count).End(xlToLeft).Column
    wsTujuan.Range(wsTujuan.Cells(2, 4), wsTujuan.Cells(rowIndex, lastCol)).NumberFormat = "#,##0"
    
    ' Auto fit kolom
    wsTujuan.Columns.AutoFit
    
    MsgBox "Proses selesai. Data berhasil disalin ke Sheet 3.", vbInformation
End Sub

Function GetSortedKeys(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    
    ' Ambil semua kunci dari dictionary
    keys = dict.keys
    
    ' Urutkan kunci menggunakan bubble sort
    For i = LBound(keys) To UBound(keys) - 1
        For j = i + 1 To UBound(keys)
            If keys(i) > keys(j) Then
                temp = keys(i)
                keys(i) = keys(j)
                keys(j) = temp
            End If
        Next j
    Next i
    
    GetSortedKeys = keys
End Function

Function IsUangSetoran(data As Variant, rowIndex As Long) As Boolean
    ' Cek 1: Jika semua kolom kode kosong (5,7,9,11) dan kolom nilai (4) terisi
    If Trim(data(rowIndex, 5) & data(rowIndex, 7) & data(rowIndex, 9) & data(rowIndex, 11)) = "" And _
       Not IsEmpty(data(rowIndex, 4)) Then
        IsUangSetoran = True
        Exit Function
    End If
    
    ' Cek 2: Jika ada keterangan "Uang Setoran" di kolom 13
    If Not IsEmpty(data(rowIndex, 13)) Then
        If InStr(1, CStr(data(rowIndex, 13)), "Uang Setoran", vbTextCompare) > 0 Then
            IsUangSetoran = True
            Exit Function
        End If
    End If
    
    IsUangSetoran = False
End Function

Function CleanCode(kode As String) As String
    ' Hapus spasi dan karakter khusus
    Dim result As String
    Dim i As Long
    
    result = ""
    For i = 1 To Len(kode)
        Dim c As String
        c = Mid(kode, i, 1)
        
        If c Like "[0-9]" Or c Like "[a-zA-Z]" Or c = "." Then
            result = result & c
        End If
    Next i
    
    CleanCode = result
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Coba konversi ke tanggal untuk perbandingan
            Dim date1 As Date, date2 As Date
            On Error Resume Next
            date1 = CDate(arr(i))
            date2 = CDate(arr(j))
            On Error GoTo 0
            
            ' Jika bisa dikonversi ke tanggal, bandingkan sebagai tanggal
            If IsDate(arr(i)) And IsDate(arr(j)) Then
                If date1 > date2 Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika tidak, bandingkan sebagai string
                If arr(i) > arr(j) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiaapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub

Sub InisialisasiAnggaran(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01", 50000000
    dict.Add "200.01.01", 15000000
    dict.Add "200.01.02", 10000000
    dict.Add "200.01.03", 5000000
    dict.Add "200.01.04", 3000000
    dict.Add "200.01.05", 8000000
    dict.Add "200.01.06", 9000000
    dict.Add "200.01.07", 2000000
    dict.Add "200.01.08", 1000000

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02", 10000000
    dict.Add "200.02.01", 2000000
    dict.Add "200.02.02", 1500000
    dict.Add "200.02.03", 1000000
    dict.Add "200.02.04", 3000000
    dict.Add "200.02.05", 1500000
    dict.Add "200.02.06", 1000000

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03", 15000000
    dict.Add "200.03.01", 2000000
    dict.Add "200.03.02", 1500000
    dict.Add "200.03.03", 3000000
    dict.Add "200.03.04", 1000000
    dict.Add "200.03.05", 500000
    dict.Add "200.03.06", 2000000
    dict.Add "200.03.07", 500000
    dict.Add "200.03.08", 1000000
    dict.Add "200.03.09", 3000000

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04", 8000000
    dict.Add "200.04.01", 5000000
    dict.Add "200.04.02", 3000000

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05", 5000000
    dict.Add "200.05.01", 2000000
    dict.Add "200.05.02", 2000000
    dict.Add "200.05.03", 1000000

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06", 2000000
    dict.Add "200.06.01", 2000000

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07", 3000000
    dict.Add "200.07.01", 500000
    dict.Add "200.07.02", 1500000
    dict.Add "200.07.03", 1000000

    ' Kategori 400: Kebaktian
    dict.Add "400", 10000000
    dict.Add "400.01", 3000000
    dict.Add "400.02", 2000000
    dict.Add "400.03", 2000000
    dict.Add "400.04", 2000000
    dict.Add "400.05", 1000000

    ' Kategori 600: Pelayanan
    dict.Add "600", 12000000
    dict.Add "600.01", 3000000
    dict.Add "600.02", 7000000
    dict.Add "600.03", 2000000

    ' Kategori 800: Bantuan dan Sosial
    dict.Add "800", 8000000
    dict.Add "800.01", 5000000
    dict.Add "800.02", 3000000

    ' Uang Setoran
    dict.Add "Uang Setoran", 30000000
End Sub

-------------

db gandatech shop pengeluaran::
PT GANDATECH SOLUTION INDONESIA
gandatech
POS
Jadwal Kegiatan
Pengeluaran
Pemasukan
PT Gandatech Solution Indonesia
JL. Perjuangan, Villa Nusa Setiabudi B16

NIB: 1706240008062 | Kontak: 089661974219

Daftar Pengeluaran
No.	Tanggal	Kategori	Jumlah	Keterangan	Aksi	Foto
1	2024-09-14	marketing	Rp 100.000	pasang google ads 1 hari	  	Tidak ada foto
2	2024-09-17	marketing	Rp 70.000	untuk stiker kaca mobil belakang	  	Tidak ada foto
3	2024-09-20	pembuatan ads tiktok	Rp 16.500	ada file	  	Foto Pengeluaran
4	2024-09-21	ads	Rp 16.500	tiktok ads	  	Foto Pengeluaran
5	2024-09-22	ads	Rp 16.650	tiktok ads	  	Foto Pengeluaran
6	2023-11-15	Peralatan	Rp 37.176	Tiang bracket Stainless 100cm (2 buah)	  	Tidak ada foto
7	2023-11-15	Peralatan	Rp 26.024	Strong Neodymium Magnet NdFeB N35 10 PCS - MAG1 - Silver	  	Tidak ada foto
8	2023-11-15	Peralatan	Rp 170.700	Set Solder Listrik Lengkap dengan Multimeter Iron Tool Kit 220V 60W (Variasi: 60W with multimeter)	  	Tidak ada foto
9	2023-11-15	Peralatan	Rp 27.500	USB Wifi Antena Chipset Mediatek MT 7601 Support Set Top Box TV	  	Tidak ada foto
10	2023-11-15	Peralatan	Rp 35.900	Keyboard Usb Standart VOXY K328 - Keyboard Voxy Murah	  	Tidak ada foto
11	2023-11-15	Peralatan	Rp 54.900	KIOXIA Flashdisk 32GB TransMemory U366 USB 3.2 / 100MB/s Original 32GB	  	Tidak ada foto
12	2023-11-15	Peralatan	Rp 54.900	KIOXIA Flashdisk 32GB TransMemory U366 USB 3.2 / 100MB/s Original 32GB	  	Tidak ada foto
13	2023-11-15	Peralatan	Rp 25.000	PHONE STAND EXTANTION COCOK UNTUK LEPTOP	  	Tidak ada foto
14	2023-11-15	Peralatan	Rp 40.000	KABEL SATA 3 KE USB 3.0 SPEED 6gbps - USB2.0 20cm	  	Tidak ada foto
15	2023-11-15	Peralatan	Rp 303.000	Tablet Advan G-Tab 8001 dual Sim 4G Ram 3/32GB 8 inch	  	Tidak ada foto
‚Äπ
1
2
‚Ä∫


PT GANDATECH SOLUTION INDONESIA
gandatech
POS
Jadwal Kegiatan
Pengeluaran
Pemasukan
PT Gandatech Solution Indonesia
JL. Perjuangan, Villa Nusa Setiabudi B16

NIB: 1706240008062 | Kontak: 089661974219

Daftar Pengeluaran
No.	Tanggal	Kategori	Jumlah	Keterangan	Aksi	Foto
16	2023-11-15	Layanan	Rp 112.000	RDP VPS 2 CORE 4GB RAM AKTIF 3 BULAN	  	Tidak ada foto
17	2023-11-15	Iklan	Rp 100.000	Iklan facebook gandatech7agustus	  	Tidak ada foto
18	2024-09-24	ads	Rp 16.650	tiktok ads	  	Foto Pengeluaran
19	2024-09-26	ads	Rp 16.650	tiktok ads	  	Tidak ada foto
20	2024-09-28	ads	Rp 100.000	wa ads	  	Foto Pengeluaran
21	2024-09-30	ads	Rp 33.000	tiktok ads	  	Foto Pengeluaran
22	2024-10-01	ads	Rp 58.500	myads	  	Foto Pengeluaran
23	2024-10-01	ads	Rp 391.000	myads topup 350 rb	  	Foto Pengeluaran
24	2024-11-03	fix cost	Rp 15.000.000	sewa tempat untuk usaha 3 tahun	  	Foto Pengeluaran
25	2024-10-23	variabel cost	Rp 2.500.000	pembelian token dan instalasi listrik	  	Foto Pengeluaran
‚Äπ
1
2
‚Ä∫



--------------------
27 maret

Option Explicit

Sub SalinTotalKeSheet3_Horizontal()
    ' Deklarasi semua variabel
    Dim wsSumber As Worksheet, wsTujuan As Worksheet, wsAnggaran As Worksheet
    Dim wb As Workbook
    Dim data As Variant
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Dim allBulan As Object, kategoriDict As Object, totalPerKategoriBulan As Object
    Dim totalPerKelompok As Object, totalKeseluruhanPerBulan As Object, uangSetoranDict As Object
    Dim tempTotalPerKelompok As Object, bulanCol As Object, anggaranDict As Object
    Dim i As Long, tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String, kelompokTotalKey As String, uniqueKey As String, totalKey As String
    Dim bulanList() As String, idx As Long, colIndex As Long, rowIndex As Long
    Dim bulanKey As Variant, key As Variant
    Dim totalUangSetoran As Double, totalSubKategori As Double, totalKategori As Double
    Dim totalKelompok As Double, totalKeseluruhan As Double
    Dim lastCol As Long
    Dim firstRowInCategory As Long
    Dim isLastKategoriInKelompok As Boolean
    Dim k As Variant, kategoriKey As Variant, subKategoriKey As Variant
    Dim sortedKategoriKeys() As Variant, sortedSubKategoriKeys() As Variant
    Dim anggaranKey As String
    
    ' Set workbook dan worksheet
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    Set wsAnggaran = wb.Sheets("4")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary anggaran
    Set anggaranDict = CreateObject("Scripting.Dictionary")
    If Not wsAnggaran Is Nothing Then
        Call BacaAnggaranPendapatan(wsAnggaran, anggaranDict)
    End If
    
    ' Ambil data dari sheet sumber
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    Set uangSetoranDict = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    ' Proses data sumber
    For i = 4 To UBound(data, 1)
        ' Ambil nilai kas dari kolom 4
        kas = 0
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Skip jika tidak ada nilai kas
        If kas = 0 Then
            GoTo NextIteration
        End If
        
        ' Ambil bulan dari tanggal (kolom 1)
        If IsDate(data(i, 1)) Then
            bulan = Format(data(i, 1), "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Tambahkan bulan ke dictionary jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0
        End If
        
        ' Identifikasi apakah ini Uang Setoran
        If IsUangSetoran(data, i) Then
            ' Proses khusus untuk Uang Setoran
            kategori = "Uang Setoran"
            kodeSub = "Uang Setoran"
            
            ' Akumulasi total Uang Setoran per bulan
            If uangSetoranDict.exists(bulan) Then
                uangSetoranDict(bulan) = uangSetoranDict(bulan) + kas
            Else
                uangSetoranDict.Add bulan, kas
            End If
        Else
            ' Proses untuk kategori lainnya
            kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
            
            ' Skip jika kode subkategori kosong
            If kodeSub = "" Then
                GoTo NextIteration
            End If
            
            ' Ambil kategori utama (6 karakter pertama)
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
            
            ' Tambahkan ke dictionary kategori jika belum ada
            If Not kategoriDict.exists(kategori) Then
                kategoriDict.Add kategori, Nothing
                subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
            End If
            
            ' Buat key unik untuk total kas
            uniqueKey = kategori & "|" & kodeSub & "|" & bulan
            
            ' Akumulasi total kas per subkategori
            If Not subKategoriDict(kategori).exists(kodeSub) Then
                subKategoriDict(kategori).Add kodeSub, Nothing
            End If

            If totalKas.exists(uniqueKey) Then
                totalKas(uniqueKey) = totalKas(uniqueKey) + kas
            Else
                totalKas.Add uniqueKey, kas
            End If
            
            ' Ambil 3 angka pertama untuk kelompok
            If Len(kodeSub) >= 3 Then
                kelompokKey = Left(kodeSub, 3)
            Else
                kelompokKey = kodeSub
            End If

            ' Akumulasi total per kelompok
            kelompokTotalKey = kelompokKey & "|" & bulan
            If totalPerKelompok.exists(kelompokTotalKey) Then
                totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
            Else
                totalPerKelompok.Add kelompokTotalKey, kas
            End If

            ' Akumulasi total per kategori
            totalKey = kategori & "|" & bulan
            If totalPerKategoriBulan.exists(totalKey) Then
                totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
            Else
                totalPerKategoriBulan.Add totalKey, kas
            End If
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan dan siapkan header
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Urutkan bulan secara kronologis
    Call BubbleSort(bulanList)
    
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    colIndex = 4
    For idx = LBound(bulanList) To UBound(bulanList)
        bulanKey = bulanList(idx)
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next idx
    
    ' Tambahkan kolom Total, Anggaran Pendapatan, dan Selisih
    wsTujuan.Cells(1, colIndex).Value = "Total"
    wsTujuan.Cells(1, colIndex + 1).Value = "Anggaran Pendapatan"
    wsTujuan.Cells(1, colIndex + 2).Value = "Selisih"
    
    ' Mulai menulis data ke sheet tujuan
    rowIndex = 2

    ' Tulis Uang Setoran terlebih dahulu jika ada
    If uangSetoranDict.Count > 0 Then
        wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalUangSetoran = 0
        
        For Each bulanKey In bulanCol.keys
            If uangSetoranDict.exists(bulanKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = uangSetoranDict(bulanKey)
                totalUangSetoran = totalUangSetoran + uangSetoranDict(bulanKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(200, 255, 200) ' Hijau muda
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        ' Tulis total
        wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(200, 255, 200)
        
        ' Kosongkan kolom anggaran pendapatan
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
        
        ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
        wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
            wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
            wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
        wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
        
        rowIndex = rowIndex + 1
    End If

    ' Proses kategori lainnya
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori
    sortedKategoriKeys = GetSortedKeys(kategoriDict)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Skip Uang Setoran jika sudah diproses
        If kategoriKey = "Uang Setoran" Then
            GoTo NextKategori
        End If
        
        firstRowInCategory = rowIndex

        ' Ambil kelompok dari 3 angka pertama kategori
        kelompokKey = Left(kategoriKey, 3)

        ' Inisialisasi total sementara per kelompok
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori
        sortedSubKategoriKeys = GetSortedKeys(subKategoriDict(kategoriKey))
        
        ' Loop melalui subkategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey
            
            ' Tambahkan uraian jika ada
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            totalSubKategori = 0
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                    
                    ' Akumulasi total kelompok
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total subkategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Hijau
            
            ' Isi kolom anggaran pendapatan jika ada data di Sheet4
            anggaranKey = subKategoriKey & "|" & bulanKey
            If anggaranDict.exists(anggaranKey) Then
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict(anggaranKey)
            Else
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
            End If
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total kategori
        wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalKategori = 0
        For Each bulanKey In bulanCol.keys
            totalKey = kategoriKey & "|" & bulanKey
            If totalPerKategoriBulan.exists(totalKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Hijau
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80)
        
        ' Kosongkan kolom anggaran pendapatan
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
        
        ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
        wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
            wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
            wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
        wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
        
        rowIndex = rowIndex + 1

        ' Cek apakah ini kategori terakhir dalam kelompok
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""

            totalKelompok = 0
            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                    totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Kuning
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey

            wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0)
            
            ' Kosongkan kolom anggaran pendapatan
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        End If
        
NextKategori:
    Next kategoriKey

    ' Tulis Total Keseluruhan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Biru
    Next bulanKey
    
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240)
    
    ' Kosongkan kolom anggaran pendapatan
    If IsEmpty(wsTujuan.Cells(rowIndex, colIndex + 1).Value) Then
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
    End If
    
    ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
    wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
        wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
        wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
    wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
    
    ' Format angka sebagai currency
    lastCol = wsTujuan.Cells(1, wsTujuan.Columns.Count).End(xlToLeft).Column
    wsTujuan.Range(wsTujuan.Cells(2, 4), wsTujuan.Cells(rowIndex, lastCol)).NumberFormat = "#,##0"
    
    ' Auto fit kolom
    wsTujuan.Columns.AutoFit
    
    MsgBox "Proses selesai. Data berhasil disalin ke Sheet 3.", vbInformation
End Sub

Sub BacaAnggaranPendapatan(ws As Worksheet, dict As Object)
    Dim data As Variant
    Dim i As Long, j As Long
    Dim kodeSub As String, bulan As String
    Dim key As String
    
    data = ws.UsedRange.Value
    
    If UBound(data, 1) < 2 Or UBound(data, 2) < 4 Then Exit Sub ' Minimal header + 1 baris dan beberapa kolom

    For i = 2 To UBound(data, 1)
        If Trim(data(i, 2)) <> "" Then
            kodeSub = Trim(data(i, 2)) ' Asumsikan kolom ke-2 adalah Kode Subkategori
            
            For j = 4 To UBound(data, 2)
                If Trim(data(1, j)) <> "" Then
                    bulan = Trim(data(1, j))
                    key = kodeSub & "|" & bulan
                    If IsNumeric(data(i, j)) Then
                        dict(key) = data(i, j)
                    Else
                        dict(key) = 0
                    End If
                End If
            Next j
        End If
    Next i
End Sub

Function GetSortedKeys(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    
    ' Ambil semua kunci dari dictionary
    keys = dict.keys
    
    ' Urutkan kunci menggunakan bubble sort
    For i = LBound(keys) To UBound(keys) - 1
        For j = i + 1 To UBound(keys)
            If keys(i) > keys(j) Then
                temp = keys(i)
                keys(i) = keys(j)
                keys(j) = temp
            End If
        Next j
    Next i
    
    GetSortedKeys = keys
End Function

Function IsUangSetoran(data As Variant, rowIndex As Long) As Boolean
    ' Cek 1: Jika semua kolom kode kosong (5,7,9,11) dan kolom nilai (4) terisi
    If Trim(data(rowIndex, 5) & data(rowIndex, 7) & data(rowIndex, 9) & data(rowIndex, 11)) = "" And _
       Not IsEmpty(data(rowIndex, 4)) Then
        IsUangSetoran = True
        Exit Function
    End If
    
    ' Cek 2: Jika ada keterangan "Uang Setoran" di kolom 13
    If Not IsEmpty(data(rowIndex, 13)) Then
        If InStr(1, CStr(data(rowIndex, 13)), "Uang Setoran", vbTextCompare) > 0 Then
            IsUangSetoran = True
            Exit Function
        End If
    End If
    
    IsUangSetoran = False
End Function

Function CleanCode(kode As String) As String
    ' Hapus spasi dan karakter khusus
    Dim result As String
    Dim i As Long
    
    result = ""
    For i = 1 To Len(kode)
        Dim c As String
        c = Mid(kode, i, 1)
        
        If c Like "[0-9]" Or c Like "[a-zA-Z]" Or c = "." Then
            result = result & c
        End If
    Next i
    
    CleanCode = result
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Coba konversi ke tanggal untuk perbandingan
            Dim date1 As Date, date2 As Date
            On Error Resume Next
            date1 = CDate(arr(i))
            date2 = CDate(arr(j))
            On Error GoTo 0
            
            ' Jika bisa dikonversi ke tanggal, bandingkan sebagai tanggal
            If IsDate(arr(i)) And IsDate(arr(j)) Then
                If date1 > date2 Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika tidak, bandingkan sebagai string
                If arr(i) > arr(j) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub

kode ini udah ada angggaran pendapatan


-------------------------
29 maret 


sheet 3 udah ada semua uraiandict

Option Explicit

Sub SalinTotalKeSheet3_Horizontal()
    ' Deklarasi semua variabel
    Dim wsSumber As Worksheet, wsTujuan As Worksheet, wsAnggaran As Worksheet
    Dim wb As Workbook
    Dim data As Variant
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Dim allBulan As Object, kategoriDict As Object, totalPerKategoriBulan As Object
    Dim totalPerKelompok As Object, totalKeseluruhanPerBulan As Object, uangSetoranDict As Object
    Dim tempTotalPerKelompok As Object, bulanCol As Object, anggaranDict As Object
    Dim allCategories As Object, allSubCategories As Object
    Dim i As Long, tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String, kelompokTotalKey As String, uniqueKey As String, totalKey As String
    Dim bulanList() As String, idx As Long, colIndex As Long, rowIndex As Long
    Dim bulanKey As Variant, key As Variant
    Dim totalUangSetoran As Double, totalSubKategori As Double, totalKategori As Double
    Dim totalKelompok As Double, totalKeseluruhan As Double
    Dim lastCol As Long
    Dim firstRowInCategory As Long
    Dim isLastKategoriInKelompok As Boolean
    Dim k As Variant, kategoriKey As Variant, subKategoriKey As Variant
    Dim sortedKategoriKeys() As Variant, sortedSubKategoriKeys() As Variant
    Dim anggaranKey As String
    Dim hasDataInGroup As Boolean
    
    ' Set workbook dan worksheet
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    Set wsAnggaran = wb.Sheets("4")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary anggaran
    Set anggaranDict = CreateObject("Scripting.Dictionary")
    If Not wsAnggaran Is Nothing Then
        Call BacaAnggaranPendapatan(wsAnggaran, anggaranDict)
    End If
    
    ' Ambil data dari sheet sumber
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    Set uangSetoranDict = CreateObject("Scripting.Dictionary")
    Set allCategories = CreateObject("Scripting.Dictionary")
    Set allSubCategories = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    ' Kumpulkan semua kategori dan subkategori dari uraianDict
    For Each key In uraianDict.keys
        ' Ambil kategori utama (6 karakter pertama)
        If Len(key) >= 6 Then
            kategori = Left(key, 6)
        Else
            kategori = key
        End If
        
        ' Tambahkan ke dictionary kategori jika belum ada
        If Not allCategories.exists(kategori) Then
            allCategories.Add kategori, Nothing
            allSubCategories.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan subkategori
        If Not allSubCategories(kategori).exists(key) Then
            allSubCategories(kategori).Add key, Nothing
        End If
    Next key
    
    ' Proses data sumber
    For i = 4 To UBound(data, 1)
        ' Ambil nilai kas dari kolom 4
        kas = 0
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Skip jika tidak ada nilai kas
        If kas = 0 Then
            GoTo NextIteration
        End If
        
        ' Ambil bulan dari tanggal (kolom 1)
        If IsDate(data(i, 1)) Then
            bulan = Format(data(i, 1), "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Tambahkan bulan ke dictionary jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0
        End If
        
        ' Identifikasi apakah ini Uang Setoran
        If IsUangSetoran(data, i) Then
            ' Proses khusus untuk Uang Setoran
            kategori = "Uang Setoran"
            kodeSub = "Uang Setoran"
            
            ' Akumulasi total Uang Setoran per bulan
            If uangSetoranDict.exists(bulan) Then
                uangSetoranDict(bulan) = uangSetoranDict(bulan) + kas
            Else
                uangSetoranDict.Add bulan, kas
            End If
        Else
            ' Proses untuk kategori lainnya
            kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
            
            ' Skip jika kode subkategori kosong
            If kodeSub = "" Then
                GoTo NextIteration
            End If
            
            ' Ambil kategori utama (6 karakter pertama)
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
            
            ' Tambahkan ke dictionary kategori jika belum ada
            If Not kategoriDict.exists(kategori) Then
                kategoriDict.Add kategori, Nothing
                subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
            End If
            
            ' Buat key unik untuk total kas
            uniqueKey = kategori & "|" & kodeSub & "|" & bulan
            
            ' Akumulasi total kas per subkategori
            If Not subKategoriDict(kategori).exists(kodeSub) Then
                subKategoriDict(kategori).Add kodeSub, Nothing
            End If

            If totalKas.exists(uniqueKey) Then
                totalKas(uniqueKey) = totalKas(uniqueKey) + kas
            Else
                totalKas.Add uniqueKey, kas
            End If
            
            ' Ambil 3 angka pertama untuk kelompok
            If Len(kodeSub) >= 3 Then
                kelompokKey = Left(kodeSub, 3)
            Else
                kelompokKey = kodeSub
            End If

            ' Akumulasi total per kelompok
            kelompokTotalKey = kelompokKey & "|" & bulan
            If totalPerKelompok.exists(kelompokTotalKey) Then
                totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
            Else
                totalPerKelompok.Add kelompokTotalKey, kas
            End If

            ' Akumulasi total per kategori
            totalKey = kategori & "|" & bulan
            If totalPerKategoriBulan.exists(totalKey) Then
                totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
            Else
                totalPerKategoriBulan.Add totalKey, kas
            End If
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan dan siapkan header
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Urutkan bulan secara kronologis
    Call BubbleSort(bulanList)
    
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    colIndex = 4
    For idx = LBound(bulanList) To UBound(bulanList)
        bulanKey = bulanList(idx)
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next idx
    
    ' Tambahkan kolom Total, Anggaran Pendapatan, dan Selisih
    wsTujuan.Cells(1, colIndex).Value = "Total"
    wsTujuan.Cells(1, colIndex + 1).Value = "Anggaran Pendapatan"
    wsTujuan.Cells(1, colIndex + 2).Value = "Selisih"
    
    ' Mulai menulis data ke sheet tujuan
    rowIndex = 2

    ' Tulis Uang Setoran terlebih dahulu jika ada
    If uangSetoranDict.Count > 0 Then
        wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalUangSetoran = 0
        
        For Each bulanKey In bulanCol.keys
            If uangSetoranDict.exists(bulanKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = uangSetoranDict(bulanKey)
                totalUangSetoran = totalUangSetoran + uangSetoranDict(bulanKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(200, 255, 200) ' Hijau muda
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        ' Tulis total
        wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(200, 255, 200)
        
        ' Kosongkan kolom anggaran pendapatan
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
        
        ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
        wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
            wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
            wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
        wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
        
        rowIndex = rowIndex + 1
    End If

    ' Proses kategori lainnya
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dari allCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
    sortedKategoriKeys = GetSortedKeys(allCategories)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Skip Uang Setoran jika sudah diproses
        If kategoriKey = "Uang Setoran" Then
            GoTo NextKategori
        End If
        
        firstRowInCategory = rowIndex

        ' Ambil kelompok dari 3 angka pertama kategori
        kelompokKey = Left(kategoriKey, 3)

        ' Inisialisasi total sementara per kelompok
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori dari allSubCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
        sortedSubKategoriKeys = GetSortedKeys(allSubCategories(kategoriKey))
        
        ' Loop melalui subkategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey
            
            ' Tambahkan uraian jika ada
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            totalSubKategori = 0
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                    
                    ' Akumulasi total kelompok
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total subkategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Hijau
            
            ' Isi kolom anggaran pendapatan jika ada data di Sheet4
            anggaranKey = subKategoriKey & "|" & bulanKey
            If anggaranDict.exists(anggaranKey) Then
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict(anggaranKey)
            Else
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
            End If
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total kategori hanya jika ada transaksi untuk kategori ini
        If kategoriDict.exists(kategoriKey) Then
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            totalKategori = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80)
            
            ' Kosongkan kolom anggaran pendapatan
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        End If

        ' Cek apakah ini kategori terakhir dalam kelompok
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            ' Hitung total kelompok dari tempTotalPerKelompok
            hasDataInGroup = False
            
            ' Cek apakah ada data dalam kelompok ini
            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    hasDataInGroup = True
                    Exit For
                End If
            Next bulanKey
            
            If hasDataInGroup Then
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                totalKelompok = 0
                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Kuning
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey

                wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0)
                
                ' Kosongkan kolom anggaran pendapatan
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
                
                ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
                wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                    wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                    wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
                wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
                
                rowIndex = rowIndex + 1
            End If
        End If
        
NextKategori:
    Next kategoriKey

    ' Tulis Total Keseluruhan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Biru
    Next bulanKey
    
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240)
    
    ' Kosongkan kolom anggaran pendapatan
    If IsEmpty(wsTujuan.Cells(rowIndex, colIndex + 1).Value) Then
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
    End If
    
    ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
    wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
        wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
        wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
    wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
    
    ' Format angka sebagai currency
    lastCol = wsTujuan.Cells(1, wsTujuan.Columns.Count).End(xlToLeft).Column
    wsTujuan.Range(wsTujuan.Cells(2, 4), wsTujuan.Cells(rowIndex, lastCol)).NumberFormat = "#,##0"
    
    ' Auto fit kolom
    wsTujuan.Columns.AutoFit
    
    MsgBox "Proses selesai. Data berhasil disalin ke Sheet 3.", vbInformation
End Sub

' Fungsi dan subrutin pendukung lainnya tetap sama seperti sebelumnya
Sub BacaAnggaranPendapatan(ws As Worksheet, dict As Object)
    Dim data As Variant
    Dim i As Long, j As Long
    Dim kodeSub As String, bulan As String
    Dim key As String
    
    data = ws.UsedRange.Value
    
    If UBound(data, 1) < 2 Or UBound(data, 2) < 4 Then Exit Sub ' Minimal header + 1 baris dan beberapa kolom

    For i = 2 To UBound(data, 1)
        If Trim(data(i, 2)) <> "" Then
            kodeSub = Trim(data(i, 2)) ' Asumsikan kolom ke-2 adalah Kode Subkategori
            
            For j = 4 To UBound(data, 2)
                If Trim(data(1, j)) <> "" Then
                    bulan = Trim(data(1, j))
                    key = kodeSub & "|" & bulan
                    If IsNumeric(data(i, j)) Then
                        dict(key) = data(i, j)
                    Else
                        dict(key) = 0
                    End If
                End If
            Next j
        End If
    Next i
End Sub

Function GetSortedKeys(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    
    ' Ambil semua kunci dari dictionary
    keys = dict.keys
    
    ' Urutkan kunci menggunakan bubble sort
    For i = LBound(keys) To UBound(keys) - 1
        For j = i + 1 To UBound(keys)
            If keys(i) > keys(j) Then
                temp = keys(i)
                keys(i) = keys(j)
                keys(j) = temp
            End If
        Next j
    Next i
    
    GetSortedKeys = keys
End Function

Function IsUangSetoran(data As Variant, rowIndex As Long) As Boolean
    ' Cek 1: Jika semua kolom kode kosong (5,7,9,11) dan kolom nilai (4) terisi
    If Trim(data(rowIndex, 5) & data(rowIndex, 7) & data(rowIndex, 9) & data(rowIndex, 11)) = "" And _
       Not IsEmpty(data(rowIndex, 4)) Then
        IsUangSetoran = True
        Exit Function
    End If
    
    ' Cek 2: Jika ada keterangan "Uang Setoran" di kolom 13
    If Not IsEmpty(data(rowIndex, 13)) Then
        If InStr(1, CStr(data(rowIndex, 13)), "Uang Setoran", vbTextCompare) > 0 Then
            IsUangSetoran = True
            Exit Function
        End If
    End If
    
    IsUangSetoran = False
End Function

Function CleanCode(kode As String) As String
    ' Hapus spasi dan karakter khusus
    Dim result As String
    Dim i As Long
    
    result = ""
    For i = 1 To Len(kode)
        Dim c As String
        c = Mid(kode, i, 1)
        
        If c Like "[0-9]" Or c Like "[a-zA-Z]" Or c = "." Then
            result = result & c
        End If
    Next i
    
    CleanCode = result
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Coba konversi ke tanggal untuk perbandingan
            Dim date1 As Date, date2 As Date
            On Error Resume Next
            date1 = CDate(arr(i))
            date2 = CDate(arr(j))
            On Error GoTo 0
            
            ' Jika bisa dikonversi ke tanggal, bandingkan sebagai tanggal
            If IsDate(arr(i)) And IsDate(arr(j)) Then
                If date1 > date2 Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika tidak, bandingkan sebagai string
                If arr(i) > arr(j) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub


-------------------------------
Siap! Berikut adalah **proposal penawaran jasa lengkap** dan **terstruktur secara profesional & ilmiah**, untuk membantu klien *Industry Door* (dropshipper pintu industri) meningkatkan penjualan melalui branding dan digital marketing:

---

# üìÑ **PROPOSAL PENAWARAN JASA**
## ‚ÄúPengembangan Branding & Digital Marketing untuk INDUSTRY DOOR‚Äù

### Disusun oleh:
**[Nama Kamu / Agensi Kamu]**  
**[Kontak / Website jika ada]**

---

## I. LATAR BELAKANG

Dalam era industri 4.0, **pemasaran digital menjadi kunci utama** dalam menjangkau calon pelanggan secara luas dan cepat. Terutama pada sektor B2B (Business to Business) seperti produk **pintu industri**, di mana calon pembeli (developer, kontraktor, pemilik gudang) kini mencari referensi dan vendor lewat internet dan media sosial.

**Industry Door**, sebagai mitra resmi dan dropshipper dari produsen pintu industri YUOU (China), memiliki potensi besar untuk menjangkau pasar lokal dan regional. Namun, untuk meningkatkan kredibilitas dan penjualan, dibutuhkan **branding yang profesional dan kehadiran digital yang kuat**.

---

## II. TUJUAN PROYEK

1. Meningkatkan **brand awareness** dan kepercayaan publik terhadap *Industry Door*
2. Menyediakan **website profesional** sebagai pusat informasi & portfolio
3. Mengelola dan mengoptimalkan **media sosial bisnis** untuk edukasi & promosi
4. Menarik prospek dari berbagai segmen pasar melalui **konten berkualitas**
5. Meningkatkan **leads penjualan** melalui digital campaign terukur

---

## III. RUANG LINGKUP JASA YANG DITAWARKAN

### A. Website Company Profile (1x setup)
- Desain UI/UX profesional (mobile friendly)
- Halaman utama: Beranda, Tentang Kami, Produk, Proyek, Testimoni, Kontak
- Formulir kontak (leads masuk ke email/WhatsApp)
- SEO dasar untuk pencarian Google
- Setup hosting & domain (jika belum ada)
- Integrasi WhatsApp & media sosial
- Copywriting & visual produk (disiapkan)

### B. Pembuatan & Setup Akun Sosial Media
- Instagram Business
- Facebook Page
- TikTok Business
- YouTube Channel
- Canva branding kit untuk konsistensi visual

### C. Manajemen Konten & Iklan (Monthly)
- Strategi konten untuk tiap platform (IG/TikTok/YT/FB)
- Produksi konten (video pendek, desain grafis, infografik produk)
- Copywriting promosi dan edukasi
- Jadwal posting & caption bulanan
- Optimasi hashtag & SEO caption
- Interaksi & balas komentar/DM
- Setup dan manajemen iklan berbayar (FB Ads, IG Ads, TikTok Ads)
- Pelaporan performa bulanan (reach, engagement, leads)

### D. Strategi Bisnis & Penjualan
- Riset kompetitor lokal & global
- Penyesuaian harga & positioning (bila diminta)
- Simulasi margin & segmentasi pasar
- Penyiapan materi penawaran, katalog digital, template quotation
- Konsultasi dan pelatihan online marketing (opsional)

---

## IV. METODE PENGERJAAN

1. **Tahap 1: Setup Awal (Minggu 1‚Äì2)**
   - Branding guidelines
   - Setup website & akun sosmed
   - Penyiapan konten awal

2. **Tahap 2: Aktivasi & Konten Berkala (Minggu 3 dst)**
   - Posting rutin, interaksi, & iklan
   - Optimasi berdasarkan performa
   - Penyesuaian sesuai respons pasar

---

## V. PAKET & INVESTASI

| Paket | Fitur | Harga / Bulan |
|-------|-------|----------------|
| **Starter** | Website + Setup akun + 8 konten/bulan | Rp X juta |
| **Growth** | Website + 12 konten/bulan + Iklan + laporan | Rp Y juta |
| **Full Service** | Semua fitur + video profesional + strategi bisnis | Rp Z juta |

> *Catatan: Harga belum termasuk biaya iklan dan hosting/domain. Bisa disesuaikan.*

---

## VI. HASIL YANG DIHARAPKAN

‚úÖ Website profesional & kredibel  
‚úÖ Sosial media aktif dan terarah  
‚úÖ Leads masuk via WhatsApp dan DM  
‚úÖ Calon pembeli yang lebih paham produk  
‚úÖ Meningkatnya penjualan melalui channel digital

---

## VII. PENUTUP

Dengan pendekatan digital yang sistematis, **Industry Door** dapat menjangkau pasar yang lebih luas, tampil profesional, dan membangun kepercayaan jangka panjang dengan pelanggan. Kami siap menjadi mitra strategis dalam pengembangan digital ini.

Terima kasih atas kesempatan dan kepercayaan yang diberikan.

---

**Hormat Kami,**  
[üìõ Nama kamu]  
[üìû Kontak]  
[üìß Email]  
[üåê Website jika ada]

---

Kalau kamu mau, aku juga bisa bantu:
- Buatin versi PDF-nya
- Desain visual proposalnya
- Atau siapin pitch deck PowerPoint-nya

Mau lanjut ke mana dulu? üôå

----------------

Semua kolom kode subkategori (kolom 5, 7, 9, 11) kosong

Dan kolom "Kas" (kolom 4) berisi angka


088261510976 parfum gilbert


-------------------------
Daftar buku kedokteran wajib di baca untuk mahasiswa kedokteran bisa bervariasi tergantung dari program studi, semester, dan minat masing-masing mahasiswa. Namun, beberapa buku yang sering direkomendasikan dan dianggap penting untuk dimiliki oleh mahasiswa kedokteran meliputi:

**Anatomi:**

* **Sobotta Atlas Anatomi Manusia** -  Buku ini terkenal dengan ilustrasi anatomi yang detail dan mudah dipahami.
* **Gray's Anatomy** -  Buku klasik yang memberikan penjelasan lengkap tentang anatomi manusia.

**Fisiologi:**

* **Guyton & Hall Textbook of Medical Physiology** -  Buku yang membahas prinsip-prinsip fisiologi manusia secara komprehensif.
* **Berne & Levy Physiology** -  Buku yang menyajikan fisiologi manusia dengan pendekatan yang mudah dipahami.

**Biokimia:**

* **Lehninger Principles of Biochemistry** -  Buku yang membahas dasar-dasar biokimia yang penting untuk memahami proses-proses biologis dalam tubuh.
* **Harper's Illustrated Biochemistry** -  Buku yang menyajikan biokimia dengan ilustrasi yang menarik dan mudah dipahami.

**Mikrobiologi:**

* **Jawetz, Melnick & Adelberg's Medical Microbiology** -  Buku yang membahas tentang mikroorganisme yang menyebabkan penyakit pada manusia.
* **Brock Biology of Microorganisms** -  Buku yang membahas tentang mikrobiologi secara umum, termasuk mikroorganisme yang bermanfaat.

**Farmakologi:**

* **Goodman & Gilman's The Pharmacological Basis of Therapeutics** -  Buku yang membahas tentang mekanisme kerja obat dan efek sampingnya.
* **Katzung Basic & Clinical Pharmacology** -  Buku yang menyajikan farmakologi dengan pendekatan yang praktis dan klinis.

**Patologi:**

* **Robbins & Cotran Pathologic Basis of Disease** -  Buku yang membahas tentang penyakit dan perubahan patologis yang terjadi dalam tubuh.
* **Kumar & Clark Clinical Medicine** -  Buku yang membahas tentang penyakit dan pengobatannya secara klinis.

**Buku Referensi Umum:**

* **Dorland's Illustrated Medical Dictionary** -  Kamus kedokteran yang berisi istilah-istilah medis yang lengkap.
* **Harrison's Principles of Internal Medicine** -  Buku yang membahas tentang penyakit dalam dan pengobatannya secara komprehensif.

**Saran:**

* **Pilih buku yang sesuai dengan kebutuhan dan minat Anda.**
* **Baca buku secara bertahap dan fokus pada materi yang sedang Anda pelajari.**
* **Manfaatkan sumber belajar lain seperti internet, jurnal, dan video edukatif.**
* **Berdiskusi dengan teman sejawat dan dosen untuk memahami materi dengan lebih baik.**

Semoga daftar buku ini membantu Anda dalam perjalanan belajar kedokteran!



-----------------------
8 april 

unutk sheet 2 tapi udah ada untuk lengkap format dan  strukturnya:

Sub kelompokkanData_Terstruktur()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook

    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("2")
    On Error GoTo 0

    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '2' tersedia."
        Exit Sub
    End If

    ' Cek jika ada data
    Dim lastRow As Long
    lastRow = wsSumber.Cells(wsSumber.Rows.Count, 1).End(xlUp).Row
    If lastRow < 4 Then
        MsgBox "Tidak ada data untuk diproses."
        Exit Sub
    End If

    ' Baca data
    Dim data As Variant
    data = wsSumber.Range("A1:L" & lastRow).Value

    ' Inisialisasi dictionary untuk pengelompokan
    Dim kelompok As Object
    Set kelompok = CreateObject("Scripting.Dictionary")

    ' Variabel untuk loop
    Dim i As Long
    Dim tgl As Variant, kwitansi As Variant, uraian As Variant, kas As Variant
    Dim kodeSub As String, bulan As String
    Dim isUangSetoran As Boolean

    ' Membaca data dan kelompokkan
    For i = 4 To UBound(data, 1)
        ' Baca data dasar
        tgl = data(i, 1)
        kwitansi = data(i, 2)
        uraian = data(i, 3)
        kas = data(i, 4)
        
        ' Tentukan bulan
        If IsDate(tgl) And tgl <> "" Then
            bulan = Format(tgl, "MMMM YYYY")
        Else
            bulan = "Tanggal Tidak Valid"
        End If

        ' Cek kriteria Uang Setoran
        isUangSetoran = False
        If IsNumeric(kas) And kas <> "" Then
            If Trim(data(i, 5)) = "" And Trim(data(i, 7)) = "" And _
               Trim(data(i, 9)) = "" And Trim(data(i, 11)) = "" Then
                isUangSetoran = True
            End If
        End If

        ' Tentukan kode subkategori
        If isUangSetoran Then
            kodeSub = "Uang Setoran"
        Else
            ' Gabungkan kode subkategori jika ada
            kodeSub = Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11))
            kodeSub = WorksheetFunction.Trim(kodeSub)
            If kodeSub = "" Then kodeSub = "Lainnya"
        End If

        ' Tambahkan ke dictionary
        If Not kelompok.Exists(bulan) Then
            kelompok.Add bulan, CreateObject("Scripting.Dictionary")
        End If

        If Not kelompok(bulan).Exists(kodeSub) Then
            kelompok(bulan).Add kodeSub, New Collection
        End If

        ' Tambahkan data ke collection
        kelompok(bulan)(kodeSub).Add Array(tgl, kwitansi, uraian, kas, kodeSub)
    Next i

    ' Bersihkan sheet tujuan
    wsTujuan.Cells.Clear

    ' Mulai tulis hasil ke Sheet2
    Dim startRow As Long, startCol As Long
    startCol = 1
    Dim colSpacing As Long: colSpacing = 3

    ' Urutkan bulan
    Dim bulanKeys() As Variant
    bulanKeys = kelompok.keys
    Call BubbleSort(bulanKeys)

    ' Loop melalui setiap bulan
    Dim bulanKey As Variant, kodeSubKey As Variant
    For Each bulanKey In bulanKeys
        startRow = 1
        
        ' Tulis header bulan
        With wsTujuan.Cells(startRow, startCol)
            .Value = UCase(bulanKey)
            .Font.bold = True
            .Font.Size = 12
        End With
        startRow = startRow + 1

        ' Urutkan kode subkategori
        Dim kodeSubKeys() As Variant
        ReDim kodeSubKeys(kelompok(bulanKey).Count - 1)
        
        Dim k As Long: k = 0
        For Each kodeSubKey In kelompok(bulanKey).keys
            kodeSubKeys(k) = kodeSubKey
            k = k + 1
        Next kodeSubKey
        
        Call BubbleSort(kodeSubKeys)

        ' Loop melalui setiap kode subkategori
        For Each kodeSubKey In kodeSubKeys
            ' Tulis header subkategori
            With wsTujuan.Cells(startRow, startCol)
                .Value = "Subkategori: " & kodeSubKey
                .Font.bold = True
            End With
            startRow = startRow + 1
            
            ' Tulis header kolom
            With wsTujuan.Cells(startRow, startCol).Resize(1, 5)
                .Value = Array("Tanggal", "Kwitansi", "Uraian", "Kas", "Kode Subkategori")
                .Font.bold = True
                .Borders(xlEdgeBottom).LineStyle = xlContinuous
            End With
            startRow = startRow + 1

            ' Tulis data
            Dim dataItem As Variant
            Dim totalKas As Double: totalKas = 0
            Dim r As Long: r = 0
            
            For Each dataItem In kelompok(bulanKey)(kodeSubKey)
                ' Pastikan ini array
                If IsArray(dataItem) Then
                    ' Tulis data dengan format
                    With wsTujuan.Cells(startRow + r, startCol)
                        .Value = dataItem(0) ' Tanggal
                        .NumberFormat = "dd-mmm-yyyy"
                    End With
                    
                    With wsTujuan.Cells(startRow + r, startCol + 1)
                        .Value = dataItem(1) ' Kwitansi
                    End With
                    
                    ' Kolom Uraian - dibatasi lebar dan wrap text
                    With wsTujuan.Cells(startRow + r, startCol + 2)
                        .Value = dataItem(2) ' Uraian
                        .WrapText = True
                        .ColumnWidth = 30 ' Lebar kolom uraian 30 karakter
                        .Rows.RowHeight = 15 ' Tinggi baris disesuaikan
                    End With
                    
                    ' Kolom Kas
                    With wsTujuan.Cells(startRow + r, startCol + 3)
                        If IsNumeric(dataItem(3)) Then
                            .Value = dataItem(3)
                            .NumberFormat = "#,##0"
                            totalKas = totalKas + CDbl(dataItem(3))
                        Else
                            .Value = dataItem(3)
                        End If
                    End With
                    
                    ' Kode Subkategori
                    With wsTujuan.Cells(startRow + r, startCol + 4)
                        .Value = dataItem(4)
                    End With
                    
                    r = r + 1
                End If
            Next dataItem

            ' Tulis total kas
            startRow = startRow + r
            With wsTujuan.Cells(startRow, startCol)
                .Value = "Total Kas " & kodeSubKey
                .Font.bold = True
            End With
            With wsTujuan.Cells(startRow, startCol + 3)
                .Value = totalKas
                .NumberFormat = "#,##0"
                .Font.bold = True
                .Borders(xlEdgeTop).LineStyle = xlContinuous
            End With
            startRow = startRow + 2
        Next kodeSubKey

        ' Geser ke kolom berikutnya
        startCol = startCol + 6 + colSpacing
    Next bulanKey

    ' Format kolom secara spesifik
    Dim lastCol As Long
    lastCol = wsTujuan.Cells.Find("*", , xlFormulas, , xlByColumns, xlPrevious).Column
    
    For i = 1 To lastCol
        Select Case i Mod (6 + colSpacing)
            Case 1 ' Kolom Tanggal
                wsTujuan.Columns(i).ColumnWidth = 12
            Case 2 ' Kolom Kwitansi
                wsTujuan.Columns(i).ColumnWidth = 15
            Case 3 ' Kolom Uraian (sudah diatur sebelumnya)
                ' Tidak perlu diubah lagi
            Case 4 ' Kolom Kas
                wsTujuan.Columns(i).ColumnWidth = 15
            Case 5 ' Kolom Kode Subkategori
                wsTujuan.Columns(i).ColumnWidth = 20
            Case Else ' Kolom kosong antar kelompok
                wsTujuan.Columns(i).ColumnWidth = 3
        End Select
    Next i

    MsgBox "Pengelompokan data selesai dengan tampilan yang rapi."
End Sub

Sub BubbleSort(arr() As Variant)
    Dim i As Long, j As Long
    Dim temp As Variant
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(i) > arr(j) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub

-------------------------------------
daftar lengkap semua kategori dalam format sederhana yang mudah dibaca:

**KATEGORI 200.01: GAJI DAN TUNJANGAN**  
- 200.01.01: Pendeta Pimpinan Jemaat  
- 200.01.02: Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)  
- 200.01.03: Guru Jemaat  
- 200.01.04: Sekretaris dan Bendahara Jemaat  
- 200.01.05: Pegawai Administrasi: Kantor GKPI Medan Kota  
- 200.01.06: Pegawai Kebersihan & Teknisi  
- 200.01.06a: Gedung Gereja  
- 200.01.06b: Pekarangan & Taman Gereja  
- 200.01.06c: Supir Mobil Dinas & Ambulance GKPI Medan Kota  
- 200.01.06d: Jaga Malam  
- 200.01.06e: Gedung Multifungsi  
- 200.01.06f: Soundman  
- 200.01.07: Administrasi Guru Sekolah Minggu (dan Remaja)  
- 200.01.08: Pengawas Parkir (Minggu & Hari Besar)  

**KATEGORI 200.02: OPERASIONAL KANTOR**  
- 200.02.01: Alat Tulis Kantor, Penggandaan dan Cetakan  
- 200.02.02: Rapat dan Pertemuan Majelis Jemaat  
- 200.02.03: Insentif / Lembur Pegawai  
- 200.02.04: Minum & Konsumsi Kantor, Jemaat & Tamu  
- 200.02.04a: Minum & Konsumsi Kantor, Jemaat  
- 200.02.04b: Biaya Makan Tamu Gereja  
- 200.02.04c: Biaya Snack untuk Pemusik & Songleader  
- 200.02.05: Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)  
- 200.02.06: Transport, Kurir, Benda pos  

**KATEGORI 200.03: KEGIATAN JEMAAT**  
- 200.03.01: Sermon Penatua  
- 200.03.01a: Sermon Penatua Tambahan  
- 200.03.01b: Sermon Penatua Khusus  
- 200.03.02: Snack dan Minuman Sermon Penatua  
- 200.03.02a: Snack dan Minuman  
- 200.03.02b: Penyediaan Makanan Pembukaan dan Penutupan  
- 200.03.03: Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota  
- 200.03.03a: Dana Pembinaan Tambahan  
- 200.03.03b: Dana Pembinaan Khusus  
- 200.03.03c: Dana Pembinaan Lainnya  
- 200.03.04: Syukuran Awal Tahun (Jemaat & Pendeta)  
- 200.03.05: Krans Bunga Dukacita bagi Anggota Jemaat  
- 200.03.06: Bantuan Dukacita bagi Anggota Jemaat  
- 200.03.06a: Bantuan Dukacita Tambahan  
- 200.03.06b: Bantuan Dukacita Khusus  
- 200.03.07: Bunga untuk Altar  
- 200.03.08: Keamanan Acara Hari Besar Kristen  
- 200.03.09: Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023  
- 200.03.09a: Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023  
- 200.03.09b: Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023  
- 200.03.10: Perjalanan Dinas atas undangan Kantor Pusat GKPI  
- 200.03.10a: Perjalanan Dinas Tambahan  
- 200.03.11: Sidang Umum Jemaat GKPI Medan Kota  
- 200.03.11b: Sidang Umum Jemaat Tambahan  
- 200.03.12: Biaya Tak Terduga / Insidentil  

**KATEGORI 200.04: PEMELIHARAAN ASET**  
- 200.04.01: Gedung Gereja, Rumah Dinas & Pekarangan  
- 200.04.02: Inventaris Gereja  

**KATEGORI 200.05: KENDARAAN**  
- 200.05.01: Roda 4 (Empat)  
- 200.05.01a: Kijang Innova, Plat BK 1757 EJ  
- 200.05.01b: Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ  
- 200.05.02: Roda 4 (Empat)  
- 200.05.02a: HIACE BK.7866 DP  
- 200.05.02b: Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP  
- 200.05.03: Roda 2 (Dua)  
- 200.05.03a: 1 unit, Plat BK. 5440 AGG  
- 200.05.03b: Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG  

**KATEGORI 200.06: TELEKOMUNIKASI**  
- 200.06.01: Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA  

**KATEGORI 200.07: PERLENGKAPAN DAN DEKORASI**  
- 200.07.01: Jubah Penatua  
- 200.07.02: Pengadaan Peralatan & Perlengkapan Inventaris Gereja  
- 200.07.03: Dekorasi dan Persiapan Natal  

**KATEGORI 400.01: PENGKHOTBAH MINGGU**  
- 400.01.01: Pengkhotbah Minggu: Pimpinan Sinode GKPI  
- 400.01.02: Pengkhotbah Minggu: Dari Luar Kota  
- 400.01.03: Pengkhotbah Minggu: Dari Dalam Kota  
- 400.01.04: Pengkhotbah Minggu: Di Rumah Duka  
- 400.01.05: Pengkhotbah Minggu: Remaja  

**KATEGORI 400.02: PENGKHOTBAH KEBAKTIAN**  
- 400.02.01: Pengkhotbah Kebaktian Lingkungan  
- 400.02.02: Pengkhotbah Kebaktian Pemuda-Pemudi & GSM  
- 400.02.03: Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu  
- 400.02.04: Pengkhotbah Kebaktian Ibu Hanna & Diakoni  
- 400.02.05: Pengkhotbah Kebaktian Lanjut Usia (LANSIA)  

**KATEGORI 400.03: PENGKHOTBAH KHUSUS**  
- 400.03.01: Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah  
- 400.03.02: Pengkhotbah Kebak. Penguburan Jenazah  
- 400.03.03: Pengkhotbah Kebak. di Rumah Duka oleh Penatua  

**KATEGORI 400.04: KEBAKTIAN**  
- 400.04.01: Minggu Pagi: Pukul 08.00 WIB  
- 400.04.02: Minggu Sore: Pukul 18.00 WIB  
- 400.04.03: Sekolah Minggu & Remaja  
- 400.04.04: Perjanjian / Pemberkatan Nikah  
- 400.04.05: Kebaktian pemberangkatan jenazah (pemusik & songleader)  
- 400.04.06: Kebaktian di Rumah Duka  
- 400.04.07: Pelayanan di Rumah Duka  
- 400.04.08: Guru Sekolah Minggu (Sermon & Mengajar)  
- 400.04.09: Latihan Pemusik dan Songleader  
- 400.04.10: Petugas Penghitung Kebaktian Minggu  

**KATEGORI 400.05: PERJAMUAN KUDUS**  
- 400.05.01: Perjamuan Kudus di Gereja  
- 400.05.02: Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021  

**KATEGORI 400.06: LAINNYA**  
- 400.06.01: (Tidak ada kegiatan)  

**KATEGORI 600.01: PENDIDIKAN DAN PEMBINAAN**  
- 600.01.01: Pendidikan Lanjutan Untuk Pendeta  
- 600.01.02: Penghargaan Untuk Penatua  
- 600.01.03: Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota  
- 600.01.04: Pembinaan Penatua se Resort Medan Barat  

**KATEGORI 600.02: PELAYANAN**  
- 600.02.01: Pembinaan & Pelayanan Rohani (PPR)  
- 600.02.02: Pekabaran Injil (PI)  
- 600.02.03: Diakoni  
- 600.02.04: Musik, Nyanyian & Koor (MNK)  
- 600.02.05: Sekolah Minggu  
- 600.02.06: Remaja  
- 600.02.07: Pemuda  
- 600.02.08: Perempuan  
- 600.02.09: Pria  
- 600.02.10: Lansia  
- 600.02.11: Kesehatan  
- 600.02.12: Pendidikan  
- 600.02.13: Usaha & Pengembangan Sumber Daya (UPSD)  
- 600.02.14: Sarana & Prasarana  
- 600.02.15: Natal Gabungan Seksi-seksi (Natal II)  

**KATEGORI 600.03: TARGET DAN BIAYA**  
- 600.03.01: Target Ke Kantor Pusat GKPI  
- 600.03.02: Biaya Tahun Renstra GKPI 2023  
- 600.03.03: Kantor Sinode GKPI (Persembahan Kedua)  
- 600.04.01: Target Ke GKPI Ressort Medan Barat  

**KATEGORI 800.01: BANTUAN DAN SOSIAL**  
- 800.01.01: Bantuan ke Jemaat untuk musibah/bencana alam  
- 800.01.02: Akomodasi Acara Penghiburan ke rumah duka  
- 800.01.03: Bantuan untuk Dana Pensiun Pendeta GKPI  
- 800.01.04: Bantuan untuk PA. Mamre dan Yapentra  
- 800.01.05: Bantuan Ke GKPI Lainnya  

**KATEGORI 800.02: PENGHARGAAN DAN INSENTIF**  
- 800.02.01: Anak - Anak Sekolah Minggu  
- 800.02.02: Penatua Purnabakti  
- 800.02.03: Penatua Aktif  
- 800.02.04: Calon Penatua  
- 800.02.05: Pendeta GKPI Ressort Medan Barat  
- 800.02.06: Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK  
- 800.02.07: Guru-Guru Koor di Jemaat GKPI Medan Kota  
- 800.02.08: Guru-Guru Sekolah Minggu  
- 800.02.09: Pemusik: (Organis, Pianis dan Saxophonis)  
- 800.02.10: Songleader (Pemandu Lagu)  
- 800.02.11: Petugas Live Streaming Minggu


-----------------------------
‚ÄúKamu Adalah Alasanku‚Äù

Kamu adalah pagi yang tak pernah lupa menyapa,
meski dunia tak selalu ramah menyambutmu.
Kamu adalah tenang di tengah ribut,
tempat semua gelisahku reda dalam diam.

Ada lembut dalam tatapmu,
yang tak pernah menghakimi luka-lukaku.
Ada sabar dalam senyummu,
yang mengajarkan aku mencintai tanpa pamrih.

Kamu tak perlu menjadi siapa-siapa,
karena bagiku, kamu sudah segalanya.
Tak perlu kata-kata besar,
cukup hadir, dan aku tahu aku tak sendiri.

Jika aku tampak diam,
itu karena aku sibuk mengagumi caramu senyum.
Jika aku terlihat jauh,
itu karena aku sedang menyiapkan tempat paling hangat
dalam doa, agar kamu selalu baik-baik saja.

Aku mencintaimu dengan cara yang mungkin tak riuh,
tapi nyata.
Dengan cara yang tak semua orang bisa lihat,
tapi kamu akan selalu bisa rasa.

Dan kalau dunia memintaku memilih,
aku tetap akan memilih kamu.
Bukan karena kamu yang paling sempurna,
tapi karena kamu yang paling membuatku pulang.


-----------------------
Saya akan membantu memperbaiki dan memodifikasi kode Anda dengan mengganti hardcoded `InisialisasiUraian` dengan membaca dari sheet `MASTER_CODE`. Berikut perbaikannya:

### ‚úÖ **Perubahan Utama**

1. **Hapus fungsi `InisialisasiUraian` yang lama** (yang berisi hardcode)
2. **Ganti dengan versi baru** yang membaca dari sheet `MASTER_CODE`

### ‚úÖ **Kode yang Dimodifikasi**

```vba
Sub InisialisasiUraian(dict As Object)
    ' Ganti hardcode dengan membaca dari sheet MASTER_CODE
    Call LoadUraianDariMasterSheet(dict)
End Sub

Sub LoadUraianDariMasterSheet(dict As Object)
    Dim ws As Worksheet
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets("MASTER_CODE")
    On Error GoTo 0
    
    If ws Is Nothing Then
        MsgBox "Sheet 'MASTER_CODE' tidak ditemukan!", vbExclamation
        Exit Sub
    End If

    Dim lastRow As Long: lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    Dim i As Long
    Dim kode As String, uraian As String
    
    For i = 2 To lastRow ' Mulai dari baris 2 (baris 1 header)
        kode = Trim(ws.Cells(i, 1).Value)
        uraian = Trim(ws.Cells(i, 2).Value)
        
        If kode <> "" And uraian <> "" Then
            If Not dict.exists(kode) Then
                dict.Add kode, uraian
            End If
        End If
    Next i
End Sub
```

### ‚úÖ **Perubahan pada Fungsi Utama**

Tidak perlu perubahan pada fungsi `SalinTotalKeSheet3_Horizontal` karena:
1. Ia tetap memanggil `InisialisasiUraian` seperti sebelumnya
2. Logika pemrosesan dictionary tetap sama

### ‚úÖ **Bonus: Fungsi untuk Menambah Kode Baru ke MASTER_CODE**

Tambahkan ini jika Anda perlu menambahkan kode baru dari form input:

```vba
Sub TambahKeMasterJikaBaru(kode As String, uraian As String)
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("MASTER_CODE")
    
    Dim lastRow As Long
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    
    ' Cek apakah kode sudah ada
    Dim i As Long
    For i = 2 To lastRow
        If ws.Cells(i, 1).Value = kode Then Exit Sub ' Sudah ada
    Next i
    
    ' Tambahkan jika baru
    ws.Cells(lastRow + 1, 1).Value = kode
    ws.Cells(lastRow + 1, 2).Value = uraian
End Sub
```

### ‚ö†Ô∏è **Penting: Struktur Sheet MASTER_CODE**
Pastikan sheet `MASTER_CODE` memiliki struktur:
```
| Kolom A (Kode) | Kolom B (Uraian)      |
|----------------|-----------------------|
| 200.01.01      | Pendeta Pimpinan...   |
| 200.01.02      | Pendeta Khusus...     |
| ...            | ...                   |
```

### üîÑ **Alur Kerja Baru**
1. Data kode dan uraian diambil dari `MASTER_CODE`
2. Jika ada kode baru di form, bisa ditambahkan ke `MASTER_CODE`
3. Tidak perlu update kode VBA ketika ada penambahan kode baru

### üõ† **Jika Mau Lebih Baik Lagi:**
1. Tambahkan error handling jika format sheet salah
2. Buat fungsi validasi kode duplikat
3. Tambahkan fitur sorting otomatis di `MASTER_CODE`

Kode utama Anda sudah baik, hanya perlu mengganti bagian inisialisasi dictionary saja. Mau saya bantu modifikasi lebih lanjut untuk fitur tertentu?


----------------------------------------
PROPOSAL PENAWARAN KERJA SAMA
LAYANAN DIGITAL ADS & WEBSITE SALES-ORIENTED
Untuk: Bisnis Bapak/Ibu sebagai Distributor Resmi Produk Pintu Industri YUOU
Dari: Gandatech IT Solution
10 April 2025
________________________________________
I. LATAR BELAKANG 
Sebagai distributor resmi dari YUOU China, bisnis Bapak/Ibu memiliki potensi besar dalam mengembangkan pasar industri pintu otomatis di Indonesia. Produk pintu industri yang kuat, efisien, dan sesuai dengan standar internasional sangat dibutuhkan oleh berbagai sektor seperti logistik, pergudangan, konstruksi, serta fasilitas manufaktur.
Namun, tantangan utama yang dihadapi saat ini adalah bagaimana menjangkau pasar tersebut secara luas dan efisien di tengah perubahan perilaku konsumen yang semakin mengandalkan kanal digital dalam mencari solusi bisnis. Iklan tradisional dan pendekatan konvensional tidak lagi cukup untuk membangun daya saing di era digital saat ini.
Oleh karena itu, diperlukan strategi pemasaran digital yang tepat sasaran, berbasis data, dan berorientasi pada konversi (penjualan), untuk menjembatani produk unggulan dengan pasar potensial.
Melalui proposal ini, Gandatech IT Solution menawarkan layanan digital marketing full-ads dan pengembangan website profesional yang dirancang khusus untuk meningkatkan visibilitas, kredibilitas, serta konversi penjualan bisnis Bapak/Ibu secara digital.Untuk menjangkau pasar secara lebih efektif dan menghasilkan penjualan yang konsisten, dibutuhkan strategi digital marketing yang terarah, terukur, dan berbasis pada konversi.
Melalui proposal ini, Gandatech IT Solution menawarkan layanan digital marketing full-ads dan pengembangan website profesional yang dirancang khusus untuk meningkatkan leads dan penjualan secara digital.
________________________________________
________________________________________
II. TUJUAN KERJA SAMA
‚Ä¢	Meningkatkan jumlah prospek dan konversi penjualan secara digital
‚Ä¢	Menjangkau audiens industri dan kontraktor proyek melalui iklan tertarget
‚Ä¢	Mendorong traffic ke website yang sudah dioptimasi untuk closing
‚Ä¢	Membangun kredibilitas bisnis Bapak/Ibu secara online sebagai mitra resmi YUOU
________________________________________



III. STRATEGI DIGITAL SALES FUNNEL
Alur strategi yang dirancang:
Iklan Berbayar (TikTok, Instagram, Facebook, YouTube, Google)
        ‚Üì
Website / Landing Page (CTA Jelas: WA / Form Order)
        ‚Üì
Leads Masuk (Klik, Form, Telepon)
________________________________________
IV. LINGKUP LAYANAN
A. DIGITAL MARKETING BERBASIS PENJUALAN (FULL ADS)
Layanan ini dirancang khusus untuk mendorong peningkatan penjualan secara langsung melalui iklan berbayar lintas platform. Pendekatan kami berbasis funnel conversion yang terstruktur ‚Äî mulai dari menarik perhatian, membangun minat, hingga menghasilkan transaksi.
________________________________________
1. Strategi dan Setup Funnel Digital Marketing
Kami memulai dengan membangun fondasi yang kuat melalui:
‚Ä¢	Riset Produk & Pasar: Memahami kekuatan produk, kompetitor, dan positioning brand.
‚Ä¢	Identifikasi Unique Selling Proposition (USP): Menentukan keunggulan yang paling menarik bagi pasar target.
‚Ä¢	Customer Journey Mapping: Menyusun tahapan perjalanan konsumen dari belum kenal hingga membeli.
‚Ä¢	Campaign Mapping per Platform: Menentukan peran tiap platform (TikTok, Meta, Google, YouTube) dalam funnel, seperti awareness, consideration, dan conversion.
________________________________________
2. Pembuatan Konten Iklan (Creative Assets)
Konten menjadi ujung tombak performa iklan. Kami akan membuat materi iklan yang menarik secara visual, komunikatif, dan fokus pada aksi pembelian:
‚Ä¢	6 Video Pendek (15‚Äì30 detik)
Format: TikTok, YouTube Shorts, Instagram Reels
Gaya: Edukatif, storytelling, testimonial, atau demo produk
Fokus: Visual yang kuat & CTA yang jelas
‚Ä¢	 8 Desain Carousel/Gambar Ads
Format: Instagram & Facebook Feed / Stories / Display Ads
Gaya desain: Clean, profesional, dan sesuai dengan identitas brand
Fokus: Highlight fitur utama produk dan benefit bagi pelanggan
‚Ä¢	 Copywriting
o	Headline yang menarik dan persuasif
o	Caption informatif dengan storytelling atau pain-point driven
o	Call-to-Action (CTA) kuat untuk meningkatkan klik dan konversi
________________________________________
3. Manajemen Iklan & Optimasi Platform
Kami menjalankan dan mengoptimalkan iklan di berbagai platform untuk memaksimalkan jangkauan dan efisiensi biaya:
TikTok Ads
‚Ä¢	Format video pendek dengan gaya visual yang kuat
‚Ä¢	Strategi edukatif & informatif ringan
‚Ä¢	Target: Usia produktif 24‚Äì40 tahun, pelaku bisnis, logistik, konstruksi
‚Ä¢	Tujuan: Awareness tinggi & klik ke WA / situs
Meta Ads (Instagram & Facebook)
‚Ä¢	Penargetan berdasarkan interest dan behavior: kontraktor, pemilik gudang, arsitek, developer properti
‚Ä¢	Retargeting pengguna yang sudah berinteraksi dengan iklan
‚Ä¢	Tujuan: Awareness + konversi (pesan via WA, klik ke landing page, form lead)
Google Ads (Search & Display)
‚Ä¢	Search Ads: Menargetkan keyword aktif seperti "jual pintu industri", "pintu otomatis gudang", dll.
‚Ä¢	Display Ads: Penempatan di situs mitra Google untuk memperkuat brand recall
‚Ä¢	Tujuan: Capture intent & penguatan brand visibility
YouTube Ads
‚Ä¢	Bumper Ads (6 detik): Iklan singkat dan tidak bisa di-skip, untuk memperkenalkan brand
‚Ä¢	Skippable Ads (15‚Äì30 detik): Cerita produk dengan CTA ke website / WA
‚Ä¢	Targeting berdasarkan channel industri, keyword, dan behavior
________________________________________
4. Optimasi & Pelaporan
Kami memastikan semua kampanye berjalan secara maksimal dan selalu berkembang berdasarkan data:
‚Ä¢	üîÅ Optimasi Mingguan
o	A/B Testing konten, CTA, dan targeting
o	Penyesuaian bidding dan placement berdasarkan performa
o	Revisi konten untuk meningkatkan engagement & CTR
‚Ä¢	üìà Laporan Bulanan Lengkap
o	Ringkasan performa iklan (CTR, CPC, CPL, ROAS)
o	Analisis audiens dan perilaku klik
o	Rekomendasi strategi bulan selanjutnya
________________________________________
Keunggulan Layanan Kami
‚úÖ Tim spesialis berpengalaman di bidang iklan industri dan konstruksi
‚úÖ Konten disesuaikan dengan demografi dan bahasa pasar target
‚úÖ Fokus pada hasil: klik, leads, dan potensi penjualan
‚úÖ Fleksibel dengan revisi konten dan optimasi berkelanjutan

B. PEMBUATAN WEBSITE COMPANY PROFILE
‚Ä¢	Desain UI/UX modern, mobile responsive
‚Ä¢	Struktur halaman: Beranda, Tentang Kami, Produk, Galeri, Kontak
‚Ä¢	CTA Jelas: Klik WhatsApp, Formulir, Nomor Telepon
‚Ä¢	SEO On-Page dan Google Analytics
‚Ä¢	Domain + Hosting (1 tahun)
________________________________________
V. ESTIMASI DURASI
Kegiatan	Estimasi Durasi
Strategi Funnel & Setup Campaign	4 Hari Kerja
Produksi Konten Iklan	10‚Äì14 Hari Kerja
Pembuatan Website	18‚Äì21 Hari Kerja
Manajemen Iklan Bulanan	30 Hari (berulang)
________________________________________



VI. ESTIMASI INVESTASI
A. DIGITAL MARKETING BULANAN (FULL ADS)
Fokus: Promosi Produk Industri B2B (Pintu Otomatis, Gudang, Konstruksi, dll.) ________________________________________
1. Rincian Jasa Digital Marketing
Komponen Jasa	Keterangan	Harga (Rp)
Strategi Funnel & Setup Campaign	Riset pasar, mapping audiens, struktur funnel per platform	Rp 1.000.000
Produksi Konten Video & Visual	3 Video pendek (TikTok/Reels), 4‚Äì6 desain ads, copywriting caption + CTA	Rp 2.000.000
Manajemen Iklan Multi-Platform	Setup iklan, monitoring, A/B test, optimasi targeting, laporan bulanan	Rp 4.000.000
Total Jasa Digital Marketing		Rp 7.000.000
üí° Semua jasa sudah mencakup 1 bulan kerja penuh.
________________________________________
2. Rekomendasi Budget Iklan (Ad Spend)
Budget iklan dibayarkan langsung ke platform (TikTok Ads, Meta Ads, Google Ads, YouTube Ads)
Contoh Pembagian Harian & Bulanan:
Platform	Tujuan Kampanye	Budget Harian	Budget Bulanan (30 Hari)
TikTok Ads	Awareness produk, klik ke WA / website	Rp 100.000	Rp 3.000.000
Meta Ads (FB/IG)	Awareness, retargeting, lead generation	Rp 200.000	Rp 6.000.000
Google Search Ads	Keyword aktif: ‚Äújual pintu gudang‚Äù, dll.	Rp 150.000	Rp 4.500.000
YouTube Ads (opsional)	Bumper/Skippable untuk branding	Rp 100.000	Rp 3.000.000
Total Budget Iklan			Rp 10.000.000 ‚Äì Rp 16.500.000
________________________________________

3. Ringkasan Total Biaya Bulanan
Komponen	Estimasi Biaya (Rp)
Jasa Digital Marketing	Rp 7.000.000
Budget Iklan (Ad Spend)	Rp 10.000.000 ‚Äì Rp 16.500.000
Total Keseluruhan	Rp 17.000.000 ‚Äì Rp 23.500.000
________________________________________
‚úÖ Catatan:
‚Ä¢	Biaya jasa tetap flat Rp 7 juta tanpa biaya tambahan tersembunyi.
‚Ä¢	Bisa disesuaikan ke versi paket hemat (1-2 platform saja) untuk efisiensi.
‚Ä¢	Laporan performa detail setiap bulan: CTR, CPC, CPL, dan ROI estimasi.
B. PEMBUATAN WEBSITE COMPANY PROFILE
Komponen	Estimasi Harga (Rp)
Desain UI/UX & Struktur Web	2.000.000
Pembangunan Website (Dev)	3.500.000
SEO On-Page & Integrasi WA/Form	1.000.000
Domain + Hosting 1 Tahun	750.000
Total Website	Rp 7.250.000
TOTAL INVESTASI
Rp 22.750.000 (di luar budget iklan)
________________________________________
VII. TARGET SALES & KPI (BULAN PERTAMA)
Indikator	Target Realistis Bulan Pertama
Kunjungan ke Website / Landing Page	1.200 ‚Äì 2.500 visitor
Klik WhatsApp / Kontak Masuk (Leads)	80 ‚Äì 180 leads
Rasio Konversi / Closing Rate	¬± 5% ‚Äì 10% dari leads
________________________________________


VIII. PENUTUP 
Proposal ini disusun sebagai bentuk penawaran strategis dari Gandatech IT Solution untuk membantu bisnis Bapak/Ibu sebagai Distributor Resmi Produk Pintu Industri YUOU dalam menjangkau pasar industri secara lebih luas, efektif, dan terukur melalui pendekatan digital.
Melalui layanan Digital Marketing Berbasis Penjualan (Full Ads) dan Pembuatan Website Sales-Oriented, kami menghadirkan solusi terpadu untuk:
‚Ä¢ Meningkatkan jumlah prospek dan peluang penjualan secara online
‚Ä¢ Menjangkau audiens industri yang tepat melalui iklan tertarget
‚Ä¢ Membangun kredibilitas sebagai mitra resmi YUOU secara digital
‚Ä¢ Serta mengoptimalkan funnel penjualan dari klik hingga konversi
Dengan estimasi investasi sebagai berikut:
Komponen	Nilai Investasi
Jasa Digital Marketing (Bulanan)	Rp 7.000.000
Pembuatan Website Profesional	Rp 7.250.000
Total Jasa + Website	Rp 14.250.000
Budget Iklan (Ad Spend)	Rp 10.000.000 ‚Äì Rp 16.500.000
TOTAL INVESTASI BULAN PERTAMA	Rp 24.250.000 ‚Äì Rp 30.750.000 ‚úÖ
Campaign digital akan dirancang untuk memberikan hasil maksimal melalui strategi funnel, konten kreatif yang menarik, pengelolaan iklan lintas platform (TikTok, Meta, Google, YouTube), serta pelaporan performa yang transparan dan terukur.
Untuk mendukung performa iklan, layanan pembuatan website senilai Rp 7.250.000 juga ditawarkan sebagai pusat informasi, konversi, dan validasi kepercayaan pelanggan.
Pada bulan pertama, target realistis yang dicanangkan meliputi: ‚Ä¢ 1.200 ‚Äì 2.500 kunjungan ke website/landing page
‚Ä¢ 80 ‚Äì 180 leads yang masuk melalui WhatsApp atau form
‚Ä¢ ¬± 4 ‚Äì 18 transaksi potensial, tergantung kecepatan follow-up dan kesiapan tim sales internal
Kami percaya, melalui kerja sama ini, brand Bapak/Ibu tidak hanya akan lebih dikenal di pasar, namun juga mampu mengubah perhatian menjadi transaksi nyata dan berkelanjutan.
Kami siap menjadi mitra digital marketing strategis Bapak/Ibu.
Terima kasih atas perhatian dan kesempatan yang diberikan.
________________________________________
Hormat kami,
Gandatech IT Solution
üìû 089661974219
‚úâÔ∏è admin@gandatech.shop

----------------------------------------

////////////////////////////////////////////////////
///////////////////////////////////////////////////
////////////////////////////////////////////////////
///////////////lapor pajak npwp pribadi cara perhitungan/////////////
///////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////

Anda bilang:
Spt Ganda

Tidak dapat menampilkan visualisasi
Berikut adalah isi dari formulir yang Anda unggah, saya salin dalam bentuk tabel seperti aslinya:
________________________________________
Bagian A: Penghasilan Neto Dalam Negeri dari Usaha dan/atau Pekerjaan Bebas
(Bagi Wajib Pajak yang Menyelenggarakan Pembukuan)
PEMBUKUAN/LAPORAN KEUANGAN	
Status Audit	Tidak Diaudit (‚úî)
Nama Akuntan Publik	(kosong)
NPWP Akuntan Publik	(kosong)
Nama Kantor Akuntan Publik	(kosong)
NPWP Kantor Akuntan Publik	(kosong)
Nama Konsultan Pajak	(kosong)
NPWP Konsultan Pajak	(kosong)
Nama Kantor Konsultan Pajak	(kosong)
NPWP Kantor Konsultan Pajak	(kosong)
________________________________________
URAIAN	KODE	RUPIAH
a. Peredaran Usaha	1a	0
b. Harga Pokok Penjualan	1b	0
c. Laba/Rugi Bruto Usaha (1a - 1b)	1c	0
d. Biaya Usaha	1d	0
e. Penghasilan Neto (1c - 1d)	1e	0
________________________________________
Penyesuaian Fiskal Positif
URAIAN	KODE	RUPIAH
1. Biaya yang dibebankan/keluarkan untuk kepentingan pribadi Wajib Pajak atau orang yang menjadi tanggungannya	2a	0
2. Premi asuransi kesehatan, asuransi kecelakaan, asuransi jiwa, asuransi dwiguna, dan asuransi sejenis	2b	0
3. Pengeluaran yang tidak berhubungan dengan pekerjaan atau jasa yang diberikan dalam bentuk natura atau kenikmatan	2c	0
4. Jumlah yang melebihi kewajaran yang dibayarkan kepada pihak yang memiliki hubungan istimewa	2d	0
5. Harta yang dihibahkan, bantuan atau sumbangan	2e	0
6. Pajak Penghasilan	2f	0
7. Gaji yang dibayarkan kepada pemilik / orang yang menjadi tanggungannya	2g	0
8. Sanksi Administrasi	2h	0
9. Selisih penyusutan/amortisasi komersial di atas penyusutan/amortisasi fiskal	2i	0
10. Biaya untuk mendapatkan, menagih dan memelihara penghasilan yang dikenakan PPh Final dan/atau tidak termasuk objek pajak	2j	0

11. Biaya untuk mendapatkan, menagih dan memelihara penghasilan yang dikenakan PPh Final dan penghasilan yang tidak termasuk objek pajak	2k	0
12. Penyesuaian fiskal positif lainnya	2l	0
13. Jumlah (2a s.d. 2l)	2m	0
Penyesuaian Fiskal Negatif
URAIAN	KODE	RUPIAH
a. Penghasilan yang dikenakan PPh Final dan penghasilan yang tidak termasuk objek pajak tetapi termasuk dalam peredaran usaha	3a	0
b. Selisih penyusutan/amortisasi komersial di bawah penyusutan/amortisasi fiskal	3b	0
c. Penyesuaian fiskal negatif lainnya	3c	0
Jumlah (3a s.d. 3c)	3d	0
________________________________________
Jumlah Bagian A
URAIAN	KODE	RUPIAH
Jumlah Bagian A (1e + 2m - 3d)	4	0




tolong isikan tabel ini berdasarkan data pada tabel excel berikut:


ChatGPT bilang:
Sepertinya file spt ganda.csv memiliki format yang tidak konsisten ‚Äî kemungkinan ada baris-baris dengan pemisah (delimiter) berbeda atau struktur yang tidak seragam. Untuk memprosesnya dengan benar, saya akan coba membukanya ulang sebagai file teks mentah dan melihat isinya langsung.

Tunggu sebentar ya, saya cek isinya dulu. ‚Äã‚Äã

Terima kasih sudah menunggu. Dari isi file yang terbaca, tampaknya file CSV ini merupakan laporan pengeluaran (dan sedikit pendapatan) yang berisi kolom-kolom seperti:

Tanggal

Kategori (seperti Peralatan, Iklan, Marketing, Transportasi)

Jumlah (Rp)

Keterangan

Namun, struktur awalnya juga mencakup semacam header laporan keuangan dan formatnya tidak standar (banyak baris kosong, nilai di tengah, dan susunan acak), sehingga butuh pemrosesan manual untuk mengekstrak angka-angka penting.

Target kita:
Mengisi tabel Bagian A pada formulir pajak dari data ini. Fokusnya ada pada:

Peredaran Usaha (1a) ‚Üí Pendapatan (jika ada)

Harga Pokok Penjualan (1b) ‚Üí Biaya langsung produksi/jasa (kalau relevan)

Biaya Usaha (1d) ‚Üí Semua pengeluaran selain HPP

Sisanya 0 jika tidak relevan atau belum ada.

Boleh aku olah sekarang datanya berdasarkan kategori ini:

Kategori CSV	Keterangan	Masuk ke
Transportasi, Iklan, Marketing, dll	Operasional/Biaya Usaha	1d
Total Pendapatan	Jika ada nilainya (selain nol)	1a
Total Pengeluaran	Untuk pembanding dan validasi	-
Apakah kamu setuju dengan pendekatan seperti ini? Atau ada kategori tertentu yang ingin kamu hitung berbeda, misalnya "Peralatan" dianggap sebagai investasi bukan biaya usaha? ‚Äã‚Äã







Anda bilang:
oke


ChatGPT bilang:
Isi Formulir Bagian A


Berikut adalah hasil pengisian Bagian A berdasarkan data laporan keuangan dari file kamu. Silakan cek apakah kategorisasi dan hasil perhitungan sudah sesuai. Kalau ada item yang perlu diklasifikasikan ulang (misalnya ke HPP atau penyesuaian fiskal), beri tahu ya! ‚Äã‚Äã







Anda bilang:
Spt


coba isikan dalam excel untuk data laporan keuangan saya ini:
masukkan langsung ke dalam tabel di atas dan export dalam xlsx


ChatGPT bilang:
Sepertinya file spt.csv yang kamu unggah tidak berformat CSV biasa, atau mengandung karakter khusus yang membuatnya gagal dibaca sebagai teks UTF-8.

Karena kita ingin mengisi ke dalam template Excel, solusi terbaiknya adalah:
Aku akan langsung konversi file spt.csv tersebut ke format .xlsx secara biner, lalu modifikasi file Excel-nya tanpa mencoba membacanya sebagai teks.

Mari kita lakukan itu sekarang. ‚Äã‚Äã

File spt.csv yang kamu unggah tadi bukan file Excel asli (XLSX), dan juga bukan file CSV biasa ‚Äî jadi tidak bisa dibuka langsung oleh Excel engine (openpyxl) karena formatnya tidak valid sebagai file ZIP (struktur dasar file Excel modern).

Solusi terbaik:
Kalau kamu punya file asli dalam bentuk .xlsx (Excel), silakan unggah file Excel-nya langsung, bukan versi ekspor .csv. File itu akan bisa langsung saya isi secara otomatis dan dikembalikan dalam bentuk file Excel terisi.

Ingin saya bantu siapkan ulang format tabelnya dari awal dan mengisi langsung dari data yang sudah ada? Atau kamu mau unggah ulang versi Excel-nya? ‚Äã‚Äã







Anda bilang:
buku legend fisika forensik


ChatGPT bilang:
Berikut beberapa buku referensi penting dalam bidang fisika forensik yang dapat Anda pertimbangkan:

Solving Crimes With Physics
Ditulis oleh William Hunter, buku ini merupakan bagian dari seri "Solving Crimes With Science: Forensics". Ditujukan untuk pembaca usia 12 tahun ke atas, buku ini memperkenalkan prinsip-prinsip dasar fisika yang digunakan dalam investigasi forensik. Cocok untuk pemula yang ingin memahami bagaimana fisika diterapkan dalam pemecahan kejahatan. ‚Äã
SpringerLink
+7
Amazon
+7
cambridgescholars.com
+7


Case Studies in Forensic Physics
Ditulis oleh Gregory A. DiLisi dan Richard A. Rarick, buku ini menyajikan studi kasus nyata yang menunjukkan penerapan prinsip fisika dalam analisis forensik. Setiap bab membahas konsep fisika tertentu dan bagaimana konsep tersebut digunakan untuk memecahkan kasus-kasus sejarah yang kompleks. Sangat berguna bagi mahasiswa dan profesional yang ingin memperdalam pemahaman mereka tentang fisika forensik. ‚Äã
forensicbookstore.com
+3
collected.jcu.edu
+3
SpringerLink
+3
collected.jcu.edu
+2
barnesandnoble.com
+2
SpringerLink
+2


Forensik: Ilmu dan Praktik Scientific Crime Investigation di Indonesia dan Dunia Internasional
Buku ini membahas berbagai aspek ilmu forensik, termasuk pemeriksaan fisika dan komputer forensik. Disusun sebagai referensi bagi penyidik, pemeriksa laboratorium forensik, hakim, jaksa, pengacara, dosen, dan mahasiswa hukum. Memberikan wawasan tentang praktik forensik di Indonesia dan internasional. ‚Äã
Google Buku


Forensics and Physics
Diterbitkan oleh Cambridge Scholars Publishing, buku ini mengulas hubungan antara ilmu forensik dan fisika. Membahas bagaimana prinsip-prinsip fisika digunakan dalam analisis jejak forensik dan identifikasi. Cocok untuk pembaca yang tertarik pada pendekatan ilmiah dalam investigasi kriminal. ‚Äã
cambridgescholars.com
+1
cambridgescholars.com
+1
Google Buku


Handbook of Forensic Physics
Buku ini menyajikan berbagai metode dan teknik dalam fisika forensik, termasuk analisis tanah, pemeriksaan semen, inspeksi cat, identifikasi serat, analisis kaca, pemeriksaan bekas alat, analisis jejak ban, dan pemeriksaan jejak sepatu. Dilengkapi dengan ilustrasi berkualitas tinggi, buku ini cocok untuk mahasiswa, instruktur, dan profesional yang tertarik pada fisika forensik. ‚Äã
SpringerLink
+5
forensicbookstore.com
+5
collected.jcu.edu
+5


Jika Anda memerlukan informasi lebih lanjut atau rekomendasi tambahan, silakan beri tahu saya!







Sumber






Anda bilang:

kalo ini coba tolong jelaskan cara menghitungnya: 

ChatGPT bilang:
Bagian formulir pajak yang kamu tunjuk pada gambar adalah Bagian A: Penghasilan Neto dari Usaha/Pekerjaan Bebas, dan berikut adalah cara menghitung masing-masing item:

a. Peredaran Usaha (Kode 1a)
Artinya: Total pendapatan atau omzet kotor dari usaha dalam satu tahun pajak (sebelum dikurangi biaya apa pun).

Rumus:
1a = Total penjualan atau penerimaan jasa selama setahun

Contoh:
Jika kamu menerima Rp10.000.000 selama 2024 dari proyek IT freelance, maka:

1a = Rp10.000.000

b. Harga Pokok Penjualan (HPP) (Kode 1b)
Artinya: Biaya langsung untuk memproduksi barang/jasa yang dijual. Untuk pekerjaan jasa seperti IT, HPP biasanya tidak digunakan (0), kecuali jika ada produk yang dijual.

Rumus:
1b = Biaya langsung (bahan baku, tenaga kerja langsung, dll)

Contoh:

Kalau kamu tidak menjual produk, 1b = 0

c. Laba/Rugi Bruto Usaha (Kode 1c)
Rumus:
1c = 1a - 1b
(Menghasilkan keuntungan kotor usaha sebelum biaya operasional dikurangi)

Contoh:

Jika 1a = 10.000.000 dan 1b = 0 ‚Üí
1c = 10.000.000

d. Biaya Usaha (Kode 1d)
Artinya: Semua biaya yang dikeluarkan untuk menunjang kegiatan usaha. Termasuk:

Sewa tempat kerja

Listrik dan internet

Transportasi kerja

Biaya iklan

Pembelian alat kerja

Dsb

Rumus:
1d = Total seluruh pengeluaran untuk kegiatan usaha (selain HPP)

e. Penghasilan Neto (Kode 1e)
Rumus:
1e = 1c - 1d
(Menghasilkan laba bersih sebelum koreksi fiskal)

Contoh:

Jika 1c = 10.000.000 dan 1d = 3.000.000
‚Üí 1e = 7.000.000

Kalau kamu ingin, aku bisa bantu hitungkan semua itu dari data keuanganmu yang sebelumnya. Mau lanjut kita isi ke formulir berdasarkan angka yang sudah dihitung sebelumnya?







Anda bilang:
ini data yg harus di olah: LAPORAN RUGI LABA TAHUN 2024				Tanggal	Kategori	Jumlah (Rp)	Keterangan
				15/11/2023	Peralatan	37176	Tiang bracket Stainless 100cm (2 buah)
PT Gandatech Solution Indonesia				15/11/2023	Peralatan	26024	Strong Neodymium Magnet NdFeB N35 10 PCS - MAG1 - Silver
Per 1 Agustus 2024 √Ç‚Äì 11 April 2025				15/11/2023	Peralatan	170700	Set Solder Listrik Lengkap + Multimeter
				15/11/2023	Peralatan	27500	USB Wifi Antena Chipset Mediatek MT 7601
Kategori	Jumlah (Rp)	Keterangan		15/11/2023	Peralatan	35900	Keyboard Usb Standart VOXY K328
Iklan	745.300	Biaya Operasional		15/11/2023	Peralatan	54900	KIOXIA Flashdisk 32GB (1)
Marketing	170.000	Biaya Operasional		15/11/2023	Peralatan	54900	KIOXIA Flashdisk 32GB (2)
Transportasi	3.660.000	Biaya transport harian (365 hari √É‚Äî 10rb)		15/11/2023	Peralatan	25000	PHONE STAND EXTANTION
Biaya Variabel	2.500.000	Pembelian token & instalasi listrik		15/11/2023	Peralatan	40000	KABEL SATA 3 KE USB 3.0
Biaya Tetap	15.000.000	Sewa tempat usaha 3 tahun		15/11/2023	Peralatan	303000	Tablet Advan G-Tab 8001 4G
Total Pengeluaran	22.075.300			15/11/2023	Layanan	112000	RDP VPS 2 CORE 4GB RAM - 3 BULAN
Total Pendapatan	0	Belum ada pemasukan		15/11/2023	Iklan	100000	Iklan Facebook
Laba/Rugi Bersih	-22.075.300	Rugi bersih		14/09/2024	Marketing	100000	Google Ads 1 Hari
				17/09/2024	Marketing	70000	Stiker Kaca Mobil Belakang
				20/09/2024	Iklan	16500	Ads TikTok
				21/09/2024	Iklan	16500	TikTok Ads
				22/09/2024	Iklan	16650	TikTok Ads
				24/09/2024	Iklan	16650	TikTok Ads
				26/09/2024	Iklan	16650	TikTok Ads
				28/09/2024	Iklan	100000	WA Ads
				30/09/2024	Iklan	33000	TikTok Ads
				01/10/2024	Iklan	58500	MyAds
				01/10/2024	Iklan	391000	MyAds Topup 350rb
				23/10/2024	Biaya Variabel	2500000	Pembelian Token + Instalasi Listrik
				03/11/2024	Biaya Tetap	15000000	Sewa Tempat Usaha 3 Tahun
					Transportasi	3.660.000	Biaya transport harian (365 hari √É‚Äî 10rb)


ChatGPT bilang:
Formulir Pajak Dari Data Rugi Laba


Sudah selesai! Ini adalah hasil pengisian formulir pajak Bagian A berdasarkan data laporan rugi laba yang kamu berikan. Silakan dicek ‚Äî kalau kamu ingin saya bantu export ke Excel atau lanjut ke bagian formulir berikutnya, tinggal bilang saja ya. ‚Äã‚Äã







Anda bilang:
coba jelaskan disini perhitungan lengkapnya


ChatGPT bilang:
Tentu! Berikut penjelasan perhitungan lengkap dari pengisian Formulir Pajak Bagian A berdasarkan laporan rugi laba tahun 2024 yang kamu berikan:

üìã Rangkuman Kategori Pengeluaran (Dari Laporan)
Semua item di laporan kamu berupa pengeluaran, dan tidak ada pemasukan (Total Pendapatan = 0). Maka:

‚û§ a. Peredaran Usaha (1a)
Ini adalah total pendapatan selama tahun pajak.
= Rp 0
(Sesuai laporan: Total Pendapatan = 0)

‚û§ b. Harga Pokok Penjualan (1b)
Tidak ada biaya bahan baku langsung atau biaya produksi karena usahamu di bidang IT dan tidak menjual produk, maka:
= Rp 0

‚û§ c. Laba/Rugi Bruto Usaha (1c = 1a - 1b)
= 0 - 0 = Rp 0

‚û§ d. Biaya Usaha (1d)
Semua pengeluaran di laporan kamu termasuk ke dalam kategori biaya usaha, dan dijumlahkan menjadi:

Kategori	Jumlah (Rp)
Peralatan	Rp 779.100
Iklan	Rp 787.950
Marketing	Rp 170.000
Transportasi	Rp 3.660.000
Biaya Variabel	Rp 2.500.000
Biaya Tetap	Rp15.000.000
Layanan (RDP, dll)	Rp 112.000
Total Biaya Usaha	Rp 22.982.550
‚Üí Semua ini diklasifikasikan sebagai biaya operasional karena menunjang aktivitas usaha, seperti:

Peralatan: alat kerja seperti solder, magnet, flashdisk, tablet.

Iklan & Marketing: untuk promosi usaha.

Transportasi, listrik, sewa tempat: jelas masuk biaya usaha.

‚û§ e. Penghasilan Neto (1e = 1c - 1d)
= 0 - 22.982.550 = -Rp 22.982.550
‚Üí Artinya kamu mengalami rugi bersih dalam tahun pajak ini.

‚û§ Penyesuaian Fiskal Positif dan Negatif (2m dan 3d)
Tidak ada data yang menunjukkan penyesuaian fiskal (misal: biaya pribadi, natura, penyusutan beda fiskal), maka:

2m = Rp 0

3d = Rp 0

‚û§ Jumlah Bagian A (Kode 4)
= 1e + 2m - 3d = -22.982.550 + 0 - 0 = -Rp 22.982.550

‚úÖ Kesimpulan
Kamu mengalami rugi bersih sebesar Rp 22.982.550, dan karena tidak ada pemasukan, maka tidak ada PPh terutang untuk tahun ini. Tapi laporan ini tetap penting untuk arsip pajak dan bisa berguna untuk pengajuan kredit atau pembuktian pengeluaran usaha.

Kalau kamu ingin, aku bisa bantu:

Mengisi file Excel-nya langsung

Menyiapkan PDF lampiran

Atau lanjut ke pengisian bagian B/C lainnya di formulir pajak

Siap bantuin!







Anda bilang:

kalo ini juga tolong di proses: 

ChatGPT bilang:
Bagian formulir yang kamu lampirkan adalah Penyesuaian Fiskal Positif, yaitu penambahan kembali biaya-biaya tertentu ke dalam penghasilan neto karena secara fiskal tidak diperbolehkan sebagai pengurang pajak. Yuk kita bahas cara mengisinya berdasarkan laporan keuanganmu:

‚úÖ Apa Itu Penyesuaian Fiskal Positif?
Ini adalah koreksi penambahan terhadap pengeluaran yang:

Tidak diakui sebagai biaya menurut ketentuan perpajakan, meskipun dicatat sebagai beban di laporan rugi-laba.

Tujuannya adalah menghitung penghasilan kena pajak yang sesuai dengan ketentuan fiskal.

üìã Analisis berdasarkan data kamu
Mari kita cocokkan dengan data:

Kode	Penjelasan	Apakah Ada di Data Kamu?	Jumlah
2a	Biaya pribadi WP atau tanggungan	Tidak ada (semua terkait usaha)	0
2b	Premi asuransi (kesehatan, jiwa, dll)	Tidak ada	0
2c	Natura/kenikmatan untuk karyawan	Tidak ada	0
2d	Biaya ke pihak dengan hubungan istimewa	Tidak disebutkan ‚Üí diasumsikan tidak	0
2e	Sumbangan/hibah	Tidak ada	0
2f	Pajak penghasilan (PPh) yang dibayar	Tidak ada dalam laporan	0
2g	Gaji untuk pemilik / tanggungan	Tidak ada ‚Äì kamu bekerja sendiri	0
2h	Sanksi administrasi perpajakan	Tidak ada	0
2i	Selisih penyusutan komersial vs fiskal	Tidak dicatat	0
2j	Biaya atas penghasilan final/tidak kena pajak	Tidak ada	0
2k	Lain-lain	Tidak ada	0
üí° Hasil Penyesuaian Fiskal Positif
Karena semua biaya yang kamu catat dalam laporan memang biaya operasional sah dan tidak melibatkan komponen pribadi, sumbangan, atau natura:

üëâ Semua nilai dari 2a s/d 2k = 0
üëâ Maka:
2l (Jumlah Penyesuaian Fiskal Positif) = 0

‚úÖ Kesimpulan
Uraian	Kode	Jumlah
Penyesuaian Fiskal Positif Total	2l	0
Jika kamu ingin, aku bisa bantu langsung masukkan ini ke template Excel atau melanjutkan ke Penyesuaian Fiskal Negatif (halaman selanjutnya di formulir pajak).

Mau lanjut ke bagian itu?







Anda bilang:

ini juga hitung 

ChatGPT bilang:
Bagus! Gambar ini menunjukkan bagian Penyesuaian Fiskal Negatif, yaitu pengurangan terhadap penghasilan neto karena ada hal-hal yang secara fiskal boleh diakui meskipun secara komersial tidak diakui.

Mari kita isi berdasarkan laporan kamu:

üßæ PENJELASAN TIAP KOMPONEN
Kode	Uraian	Ada di laporan kamu?	Jumlah
3a	Penghasilan yang dikenakan PPh Final / tidak termasuk objek pajak, tapi masuk omzet	‚ùå Tidak ada pendapatan	0
3b	Penyusutan/amortisasi komersial < penyusutan/amortisasi fiskal (selisih negatif)	‚ùå Tidak ada data aset tetap	0
3c	Penyesuaian fiskal negatif lainnya (misalnya koreksi fiskal penghasilan khusus)	‚ùå Tidak disebutkan	0
3d	Jumlah Penyesuaian Fiskal Negatif (3a + 3b + 3c)		0
‚úÖ HASIL PENGISIAN
Seluruh nilai pada Penyesuaian Fiskal Negatif = 0, karena:

Tidak ada penghasilan dari objek final atau non-objek.

Tidak ada pencatatan penyusutan.

Tidak ada koreksi negatif lain.

üî¢ Finalisasi Jumlah Bagian A
Rumus	Hasil
Jumlah Bagian A = 1e + 2l - 3d	= -22.982.550 + 0 - 0 = -22.982.550
‚úÖ KESIMPULAN:
Semua penyesuaian fiskal negatif bernilai nol, dan jumlah akhir di bagian A tetap menunjukkan rugi bersih sebesar Rp22.982.550.

Jika kamu mau, aku bisa bantu:

Export hasil isian ini ke file Excel (.xlsx)

Lanjut ke pengisian bagian B/C lainnya

Menyiapkan file PDF ringkasan untuk pelaporan

Mau dilanjutkan ke mana?







Anda bilang:

isi bagian ini 

ChatGPT bilang:
Gambar yang kamu berikan adalah Bagian A ‚Äì Penghasilan yang Dikenakan Pajak Final dan/atau Bersifat Final, dari laporan SPT Tahunan Orang Pribadi.

Mari kita isi berdasarkan data keuanganmu sebelumnya.

üìã Prinsip Pengisian Bagian Ini:
Bagian ini khusus mencatat penghasilan yang sudah dipotong PPh Final atau bersifat final, misalnya:

Jenis Penghasilan Final	Contoh
Bunga deposito/tabungan	Jika ada rekening berbunga
Honorarium dari pemerintah (APBN/APBD)	Kalau bekerja dengan pemerintah
Penghasilan jasa konstruksi	Pekerjaan proyek konstruksi
Dividen, penjualan saham, properti, dll	Jika berinvestasi atau jual aset
üìä Berdasarkan data kamu:
Kamu menyatakan bahwa:

Tidak ada pemasukan selama tahun pajak (Total Pendapatan = 0)

Tidak ada aktivitas investasi, sewa, jual beli, proyek, atau honor pemerintah

‚úÖ Maka hasil isian adalah:
No	Jenis Penghasilan	Dasar Pengenaan (Rp)	PPh Terutang (Rp)
1‚Äì16	Semua item (bunga, obligasi, jasa konstruksi, dll)	Rp 0	Rp 0
17	Penghasilan Lain Final (PP23/PP55, dll)	Rp 0	Rp 0
18	JUMLAH (Total Final Income)	Rp 0	Rp 0
üí° Kesimpulan:
Karena tidak ada penghasilan yang dikenakan PPh Final, maka:

Semua baris 1 s.d. 17 = 0

Jumlah di baris 18 juga = 0

Kalau kamu mau, aku bisa bantu:

Export seluruh bagian ini dalam bentuk Excel/PDF

Atau lanjut ke Bagian B (Penghasilan Tidak Kena Pajak / Tidak Termasuk Objek Pajak)

Siap bantu terus, tinggal bilang aja!







Anda bilang:

ini juga

ChatGPT bilang:
Bagian yang kamu tunjuk ini adalah:

üìÑ Bagian B ‚Äì Penghasilan yang Tidak Termasuk Objek Pajak
Ini adalah penghasilan yang tidak dikenakan pajak penghasilan karena dikecualikan oleh Undang-Undang Pajak Penghasilan (UU PPh).

üìã Jenis-jenis Penghasilan Tidak Kena Pajak di Bagian B:
No	Jenis Penghasilan
1	Bantuan / Sumbangan / Hibah
2	Warisan
3	Bagian laba anggota perkumpulan, firma, CV, dll.
4	Klaim asuransi (kesehatan, jiwa, kecelakaan, dwiguna, beasiswa)
5	Beasiswa
6a	Penghasilan dari luar negeri karena keahlian tertentu (UU PPh 4 ayat 3 h)
6b	Penggantian natura/kenikmatan yang dikecualikan
6c	Penghasilan lain yang tidak termasuk objek PPh
üßæ Berdasarkan laporan keuangan kamu:
‚úÖ Tidak ada data yang menunjukkan:

Menerima warisan, beasiswa, atau hibah

Menerima klaim asuransi

Menerima bagian laba dari firma atau CV

Penghasilan dari luar negeri

Natura atau kenikmatan (misalnya mobil dinas, fasilitas tempat tinggal)

‚úÖ Hasil Pengisian:
No	Jenis Penghasilan	Jumlah (Rp)
1‚Äì6	Semua item (hibah, asuransi, beasiswa, natura, dll)	Rp 0
JBB	Jumlah Bagian B (Total Penghasilan Bukan Objek Pajak)	Rp 0
‚ûï Bagian C: Penghasilan Neto Istri/Suami yang Dikenakan Pajak Terpisah
Karena kamu menyatakan bekerja sendiri dan tidak melaporkan penghasilan pasangan, maka:

Bagian ini juga diisi: Rp 0

üîö Kesimpulan:
Seluruh Bagian B: 0

Bagian C (Penghasilan Istri/Suami Terpisah): 0

Kalau kamu ingin, aku bisa bantu susun semua hasil dari Bagian A s.d. C ini dalam format Excel, atau PDF SPT untuk disimpan dan diunggah ke DJP Online. Mau langsung saya bantu buatkan?







Anda bilang:

coba sesuaikan dengan ini

ChatGPT bilang:
Gambar ini adalah Bagian A ‚Äì Daftar Harta pada Akhir Tahun dari formulir SPT Tahunan.

Berikut adalah penyesuaian isinya berdasarkan data yang kamu lampirkan:

‚úÖ Rangkuman Data Harta Kamu:
KODE HARTA	NAMA HARTA	TAHUN PEROLEHAN	HARGA PEROLEHAN	KETERANGAN
012	Tabungan	2024	Rp 1.500.000	Pemberian dari orang tua
055	Laptop ASUS	2024	Rp 600.000	Pemberian kakak
055	Laptop HP	2023	Rp 1.000.000	Uang pribadi
üí° Penjelasan Setiap Kolom:
Kode Harta:

012 = Tabungan

055 = Peralatan Elektronik, Furniture, Komputer

Nama Harta:

Diisi sesuai barang dimiliki, bisa berupa nilai saldo untuk tabungan atau deskripsi barang seperti laptop.

Tahun Perolehan:

Wajib diisi sesuai tahun saat harta pertama kali dimiliki.

Harga Perolehan:

Nilai saat pertama diperoleh (bukan harga saat ini). Disesuaikan dari catatan/estimasi wajar.

Keterangan:

Sumber dana atau asal perolehan (contoh: hibah, pemberian, beli sendiri, warisan, dll.)

üßæ Hasil Final yang Dicantumkan di Formulir:
Kode	Nama Harta	Tahun Perolehan	Harga Perolehan	Keterangan
012	Tabungan	2024	Rp 1.500.000	Pemberian dari orang tua
055	Laptop ASUS	2024	Rp 600.000	Pemberian kakak
055	Laptop HP	2023	Rp 1.000.000	Uang pribadi
Kalau kamu mau, aku bisa bantu:

Menyusun bagian ini dalam format Excel atau PDF

Menambahkan ke file SPT terintegrasi (gabungan dari seluruh bagian A‚ÄìC, Harta, Penghasilan, dll)

Mau langsung saya satukan semua ke file final?







Anda bilang:

apakah ada bagian ini yg perlu di ubah 

ChatGPT bilang:
Bagus! Ini adalah Bagian B (Penghasilan yang Tidak Termasuk Objek Pajak) dan Bagian C (Penghasilan Istri/Suami yang Dikenakan Pajak Terpisah) dari SPT Tahunan Orang Pribadi.

Mari kita telaah apakah perlu ada perubahan berdasarkan data kamu sebelumnya:

üìã Ringkasan Informasi Kamu:
Kamu bekerja sendiri (usaha perorangan di bidang IT)

Tidak ada pemasukan selama tahun 2024 (Total Pendapatan = Rp 0)

Tidak ada honor luar negeri, natura, warisan, hibah, atau beasiswa

Belum ada karyawan, istri/suami tidak dilaporkan sebagai WP terpisah

‚úÖ Evaluasi Bagian B:
Baris	Jenis Penghasilan	Perlu Diubah?	Keterangan Tambahan
1	Bantuan / Sumbangan / Hibah	‚ùå Tidak	Tidak dicatat di laporan
2	Warisan	‚ùå Tidak	Tidak ada data
3	Bagian laba komanditer / firma / CV	‚ùå Tidak	Tidak ada CV/firma tercatat
4	Klaim Asuransi	‚ùå Tidak	Tidak disebutkan
5	Beasiswa	‚ùå Tidak	Tidak ada
6a	Penghasilan luar negeri karena keahlian	‚ùå Tidak	Tidak ada penghasilan luar negeri
6b	Penggantian natura / kenikmatan dari pekerjaan	‚ùå Tidak	Tidak ada mobil dinas, rumah, dll.
6c	Penghasilan lain yang dikecualikan dari objek pajak	‚ùå Tidak	Tidak ada
üìå JBB = 0 (Tetap)

‚úÖ Evaluasi Bagian C:
Deskripsi	Status
Penghasilan neto istri/suami dikenakan pajak terpisah	‚ùå Tidak ada
üìå Bagian C juga = 0 (Tetap)

‚úÖ Kesimpulan:
üî∏ Tidak ada perubahan yang perlu dilakukan pada gambar di atas.
üî∏ Semua kolom sudah benar diisi Rp 0 berdasarkan data kamu.

Kalau kamu ingin, saya bisa bantu rekap semua data yang sudah kita olah tadi (Bagian A‚ÄìC, Harta, dll) dalam 1 file Excel atau PDF. Mau langsung saya susun?







Anda bilang:

jelaskan ini 

ChatGPT bilang:
Gambar ini menampilkan:

üìÑ Bagian B dan C dari Lampiran SPT Formulir 1770 (Halaman Penghasilan Neto dengan Norma atau Catatan)
üîπ Bagian B: Penghasilan Neto dari Usaha (dengan Norma Perhitungan)
Untuk Wajib Pajak yang tidak menyelenggarakan pembukuan, perhitungan penghasilan neto dilakukan dengan cara:

üìå Peredaran Usaha √ó Norma = Penghasilan Neto

Kolom	Penjelasan
Jenis Usaha	Dibagi menjadi: Dagang, Industri, Jasa, Pekerjaan Bebas, Usaha Lainnya
Peredaran Usaha	Total omzet dari masing-masing jenis usaha
Norma (%)	Persentase norma yang ditentukan DJP berdasarkan jenis usaha & wilayah
Penghasilan Neto	Hasil perhitungan omzet √ó norma
üí° Tapi... dalam kasusmu:
Kamu menyelenggarakan pembukuan, karena sudah menyampaikan laporan rugi laba.

Maka: bagian ini tidak digunakan.

Diisi otomatis nol (0) sebagai formalitas.

üìå Jumlah Bagian B (JBB) = 0
(karena tidak menggunakan norma perhitungan penghasilan neto)

üîπ Bagian C: Penghasilan Neto dari Pekerjaan (Bukan Usaha)
Untuk Wajib Pajak yang bekerja sebagai karyawan (PNS/swasta), bukan wirausaha.

Kolom	Penjelasan
NPWP & Nama Pemberi Kerja	Diisi jika kamu bekerja di perusahaan/lembaga
Penghasilan Bruto	Gaji kotor selama setahun
Pengurangan	Biaya jabatan, iuran pensiun, dsb
Penghasilan Neto	Bruto dikurangi pengurang
üí° Tapi... dalam kasusmu:
Kamu menyatakan tidak bekerja sebagai karyawan (hanya usaha sendiri di bidang IT).

Maka: Bagian C ini = 0

‚úÖ Kesimpulan
Bagian	Keterangan	Nilai
Bagian B	Tidak digunakan karena kamu menyusun pembukuan	0
Bagian C	Tidak ada pekerjaan tetap / karyawan	0
Keduanya tidak perlu diisi karena kamu sudah mengisi melalui laporan usaha di Bagian A.

Kalau kamu mau, aku bisa bantu rekap keseluruhan isi SPT yang sudah kita susun:

Bagian A (Usaha dan Rugi Laba)

Penyesuaian Fiskal

Penghasilan Final

Harta

dll

Dan menyatukannya dalam file Excel atau PDF. Siap bantu!







Anda bilang:
jadi kolom kolomnya diisi apa


ChatGPT bilang:
Oke! Kita bahas secara langsung dan praktis:
Kamu adalah Wajib Pajak perorangan yang:

Usahanya di bidang IT (tanpa karyawan, bukan karyawan tetap)

Menyelenggarakan pembukuan

Tidak punya pendapatan selama tahun 2024

Telah melampirkan laporan rugi/laba dan daftar harta

Berarti pengisian kolom di gambar ini adalah sebagai berikut:

üü® Bagian B ‚Äì Penghasilan Neto dengan Norma (Pasal 14 UU PPh)
Karena kamu pakai pembukuan, bagian ini tidak dipakai. Diisi semua dengan angka nol.

NO	JENIS USAHA	PEREDARAN USAHA	NORMA (%)	PENGHASILAN NETO
1	Dagang	0	‚Äì	0
2	Industri	0	‚Äì	0
3	Jasa	0	‚Äì	0
4	Pekerjaan Bebas	0	‚Äì	0
5	Usaha Lainnya	0	‚Äì	0
JUMLAH BAGIAN B	0		0
üü® Bagian C ‚Äì Penghasilan Neto dari Pekerjaan (Bukan Usaha)
Karena kamu bukan karyawan, tidak ada penghasilan dari pekerjaan tetap, maka ini juga:

NPWP PEMBERI KERJA	NAMA PEMBERI KERJA	PENGHASILAN BRUTO	PENGURANGAN	PENGHASILAN NETO
‚Äì	‚Äì	0	0	0
JUMLAH BAGIAN C				0
‚úÖ Kesimpulan Singkat
Isi semua kolom pada Bagian B dan C dengan nol (0) karena:

Kamu tidak menggunakan norma, tapi pembukuan

Kamu tidak bekerja sebagai pegawai/karyawan tetap

Kalau kamu mau, aku bisa bantu satukan semua ini dalam 1 file Excel yang rapi, atau bantu buat versi PDF untuk kamu laporkan ke DJP Online. Siap?







Anda bilang:

kalo ini diisi apa 

ChatGPT bilang:
Gambar ini menunjukkan:

üìÑ Bagian D ‚Äì Penghasilan Dalam Negeri Lainnya
(Formulir 1770 ‚Äì Lampiran III)

Ini khusus untuk penghasilan non-usaha dan non-pekerjaan tetap, yang bukan objek PPh Final ‚Äî jadi masuk perhitungan pajak progresif.

üìã Kolom yang Ada & Penjelasannya:
No	Jenis Usaha / Penghasilan	Contoh Umum
1	Bunga	Bunga pinjaman pribadi, bunga piutang bukan dari bank
2	Royalti	Dari penjualan hak cipta, lagu, software, dll
3	Sewa	Misalnya menyewakan rumah, alat, kendaraan
4	Penghargaan dan Hadiah	Hadiah lomba, apresiasi, penghargaan yang bukan undian
5	Keuntungan Penjualan Harta	Jual laptop, motor, tanah ‚Äî jika tidak dikenakan PPh Final
6	Penghasilan Lainnya	Misalnya: cashback, refund, pendapatan tak biasa lainnya
üßæ Berdasarkan laporan keuangan kamu:
‚úÖ Tidak ada penghasilan seperti:

Bunga piutang pribadi

Royalti dari software atau karya

Menyewakan properti

Jual beli barang (yang menimbulkan untung)

Hadiah atau penghargaan

‚úÖ Jawaban Praktis untuk Kamu:
NO	JENIS USAHA / PENGHASILAN	PENGHASILAN NETO
1	Bunga	0
2	Royalti	0
3	Sewa	0
4	Penghargaan dan Hadiah	0
5	Keuntungan dari Penjualan Harta	0
6	Penghasilan Lainnya	0
JUMLAH BAGIAN D (JBD)	0
‚úÖ Kesimpulan:
Semua diisi 0, karena kamu tidak punya penghasilan dari sumber-sumber ini selama 2024.

Kalau kamu sudah sampai di sini, berarti semua bagian SPT kamu sudah lengkap.

Mau saya bantu rekap jadi 1 file Excel atau PDF untuk disimpan dan dilaporkan ke DJP Online?







///////////////////////////////////////////////
/
//////////////////////////////////////////////////
/
/////////////////////////////////////////////////

mencetak form otomatis vba
Sub BuatFormPengeluaran()

    Dim UF As Object
    Dim ctrl As MSForms.Control
    Dim VBComp As VBIDE.VBComponent
    Dim designer As Object
    Dim cmbKategori As MSForms.ComboBox, cmbSubKategori As MSForms.ComboBox
    
    ' Tambahkan komponen UserForm baru
    Set VBComp = ThisWorkbook.VBProject.VBComponents.Add(vbext_ct_MSForm)
    VBComp.Properties("Caption") = "Form Input Pengeluaran Jemaat"
    VBComp.Name = "FormPengeluaran"
    
    Set designer = VBComp.Designer
    
    ' Fungsi bantu untuk membuat label dan textbox
    Dim top As Integer: top = 10
    Dim i As Integer
    
    ' Array untuk label dan kontrol
    Dim labelNames As Variant, ctrlNames As Variant, ctrlTypes As Variant
    labelNames = Array("Tanggal", "KW", "Uraian", "Jumlah", "Kategori", "Sub Kategori", "Setor")
    ctrlNames = Array("txtTanggal", "txtKW", "txtUraian", "txtJumlah", "cmbKategori", "cmbSubKategori", "txtSetor")
    ctrlTypes = Array("textbox", "textbox", "textbox", "textbox", "combobox", "combobox", "textbox")
    
    ' Tambahkan default value untuk tanggal
    Dim defaultTanggal As String
    defaultTanggal = Format(Date, "dd-mmm-yy")
    
    For i = 0 To UBound(labelNames)
        ' Label
        With designer.Controls.Add("Forms.Label.1")
            .Caption = labelNames(i)
            .Top = top
            .Left = 10
            .Width = 100
            .Height = 20
        End With
        
        ' Kontrol input
        Select Case ctrlTypes(i)
            Case "combobox"
                Set ctrl = designer.Controls.Add("Forms.ComboBox.1", ctrlNames(i), True)
                With ctrl
                    .Top = top
                    .Left = 120
                    .Width = 200
                    .Height = 20
                    .Style = 2 ' Dropdown style
                End With
                
                ' Tambahkan contoh item untuk combobox
                If ctrlNames(i) = "cmbKategori" Then
                    ctrl.AddItem "Operasional"
                    ctrl.AddItem "Sosial"
                    ctrl.AddItem "Perlengkapan"
                    ctrl.AddItem "Kegiatan"
                ElseIf ctrlNames(i) = "cmbSubKategori" Then
                    ctrl.AddItem "Pilih kategori terlebih dahulu"
                End If
                
            Case Else ' textbox
                Set ctrl = designer.Controls.Add("Forms.TextBox.1", ctrlNames(i), True)
                With ctrl
                    .Top = top
                    .Left = 120
                    .Width = 200
                    .Height = 20
                End With
                
                ' Set default value untuk tanggal
                If ctrlNames(i) = "txtTanggal" Then
                    ctrl.Text = defaultTanggal
                End If
        End Select
        
        top = top + 30
    Next i
    
    ' Tombol Simpan
    With designer.Controls.Add("Forms.CommandButton.1", "btnSubmit", True)
        .Caption = "Simpan Data"
        .Top = top + 10
        .Left = 120
        .Width = 100
        .Height = 25
        .Accelerator = "S"
    End With
    
    ' Tombol Batal
    With designer.Controls.Add("Forms.CommandButton.1", "btnCancel", True)
        .Caption = "Batal"
        .Top = top + 10
        .Left = 230
        .Width = 100
        .Height = 25
        .Accelerator = "B"
    End With
    
    ' Set form properties
    With VBComp.Properties
        .Item("Width") = 350
        .Item("Height") = top + 80
        .Item("StartUpPosition") = 1 ' CenterScreen
    End With
    
    MsgBox "Form 'FormPengeluaran' berhasil dibuat. Silakan buka dari jendela UserForm.", vbInformation

End Sub
-------------------------------
19 april
 
forminput:
' --- Kode di belakang UserForm 'FormPengeluaran' ---

Private Sub UserForm_Initialize()
    ' Inisialisasi data kategori
    With Me.cmbKategori
        .AddItem "200 - ADMINISTRASI GEREJA"
        .AddItem "400 - PELAYANAN IBADAH"
        .AddItem "600 - PEMBINAAN & PELAYANAN"
        .AddItem "800 - BANTUAN & TUNJANGAN"
    End With
    
    ' Set tanggal default ke hari ini
    Me.txtTanggal.Value = Format(Date, "dd/mm/yyyy")
End Sub

Private Sub cmbKategori_Change()
    ' Bersihkan sub kategori sebelumnya
    Me.cmbSubKategori.Clear
    
    ' Isi subkategori berdasarkan kategori yang dipilih
    Select Case Me.cmbKategori.Value
        Case "200 - ADMINISTRASI GEREJA"
            ' Subkategori untuk ADMINISTRASI GEREJA
            Me.cmbSubKategori.AddItem "200.01.01 - Pendeta Pimpinan Jemaat"
            Me.cmbSubKategori.AddItem "200.01.02 - Vicaris dan Pendeta Khusus"
            Me.cmbSubKategori.AddItem "200.01.03 - Guru Jemaat"
            Me.cmbSubKategori.AddItem "200.01.04 - Sekretaris dan Bendahara Jemaat"
            Me.cmbSubKategori.AddItem "200.01.05.a - Pegawai Kantor (Administrasi): 2 orang"
            Me.cmbSubKategori.AddItem "200.01.06.a - Pegawai Kebersihan Gedung Gereja: 1 orang"
            Me.cmbSubKategori.AddItem "200.01.06.b - Pegawai Kebersihan Pekarangan Gereja: 1 orang"
            Me.cmbSubKategori.AddItem "200.01.06.c1 - Pegawai Supir Mobil Dinas & Ambulance"
            Me.cmbSubKategori.AddItem "200.01.06.c2 - Pegawai Jaga Malam"
            Me.cmbSubKategori.AddItem "200.01.06.d - Pegawai Kebersihan Gedung Multifungsi"
            Me.cmbSubKategori.AddItem "200.01.06.e - Pegawai Soundman"
            Me.cmbSubKategori.AddItem "200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)"
            Me.cmbSubKategori.AddItem "200.01.08 - Pengawas Parkir Gereja (Minggu & Hari Besar)"
            Me.cmbSubKategori.AddItem "200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan"
            Me.cmbSubKategori.AddItem "200.02.02 - Rapat dan Pertemuan Majelis Jemaat"
            Me.cmbSubKategori.AddItem "200.02.03 - Insentif/Lembur Pegawai"
            Me.cmbSubKategori.AddItem "200.02.04.a - Minum & Konsumsi Kantor, Jemaat"
            Me.cmbSubKategori.AddItem "200.02.04.b - Biaya Makan Tamu Gereja"
            Me.cmbSubKategori.AddItem "200.02.04.c - Biaya Snack untuk Pemusik & Songleader"
            Me.cmbSubKategori.AddItem "200.02.05 - Penyediaan Kolportase"
            Me.cmbSubKategori.AddItem "200.02.06 - Transport, Kurir, Benda Pos"
            Me.cmbSubKategori.AddItem "200.03.01.a - Snack dan minuman sermon penatua"
            Me.cmbSubKategori.AddItem "200.03.01.b - Penyediaan makanan pembukaan dan penutupan sermon penatua"
            Me.cmbSubKategori.AddItem "200.03.02 - Dana Pembinaan untuk Paduan Suara"
            Me.cmbSubKategori.AddItem "200.03.03.a - Syukuran Awal Tahun (Jemaat & Pendeta)"
            Me.cmbSubKategori.AddItem "200.03.03.b - Snack Kebaktian Awal Tahun Gereja"
            Me.cmbSubKategori.AddItem "200.03.03.c - Snack Paskah dan Buha-Buha Ijuk"
            Me.cmbSubKategori.AddItem "200.03.04 - Krans Bunga Dukacita bagi Anggota Jemaat"
            Me.cmbSubKategori.AddItem "200.03.05 - Bantuan Dukacita bagi Anggota Jemaat"
            Me.cmbSubKategori.AddItem "200.03.06.a - Bunga altar pada Kebaktian Minggu"
            Me.cmbSubKategori.AddItem "200.03.06.b - Dekorasi pada Kebaktian Hari Besar Kristen"
            Me.cmbSubKategori.AddItem "200.03.07 - Keamanan Acara Hari Besar Kristen"
            Me.cmbSubKategori.AddItem "200.03.08.a - Kontribusi & Registrasi Peserta Rapat Pendeta"
            Me.cmbSubKategori.AddItem "200.03.08.b - Perjalanan Dinas Peserta Rapat Pendeta (2 pendeta)"
            Me.cmbSubKategori.AddItem "200.03.09 - Perjalanan Dinas atas undangan Kantor Pusat"
            Me.cmbSubKategori.AddItem "200.03.10 - Sidang Umum Jemaat"
            Me.cmbSubKategori.AddItem "200.03.11.a - Biaya Tak Terduga (Pengurusan Sertifikat Tanah)"
            Me.cmbSubKategori.AddItem "200.03.11.b - Biaya Tak Terduga/Insidentil"
            Me.cmbSubKategori.AddItem "200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan"
            Me.cmbSubKategori.AddItem "200.04.02 - Inventaris Gereja"
            Me.cmbSubKategori.AddItem "200.05.01.a - Kijang Innova, Plat BK 1757 EJ"
            Me.cmbSubKategori.AddItem "200.05.01.b - Pajak Kendaraan Kijang Innova"
            Me.cmbSubKategori.AddItem "200.05.02.a - HIACE BK.7866 DP"
            Me.cmbSubKategori.AddItem "200.05.02.b - Pajak Kendaraan HIACE"
            Me.cmbSubKategori.AddItem "200.05.03.a - Roda 2: 1 unit, Plat BK. 5440 AGG"
            Me.cmbSubKategori.AddItem "200.05.03.b - Pajak Kendaraan Roda 2"
            Me.cmbSubKategori.AddItem "200.06.01 - Telepon, Speedy, MyRepublik dan WA"
            Me.cmbSubKategori.AddItem "200.07.01 - Jubah Penatua (Upah Jahit)"
            Me.cmbSubKategori.AddItem "200.07.02 - Peralatan & Perlengkapan Inventaris Gereja"
            Me.cmbSubKategori.AddItem "200.07.03 - Dekorasi dan Persiapan Natal"
            
        Case "400 - PELAYANAN IBADAH"
            ' Subkategori untuk PELAYANAN IBADAH
            Me.cmbSubKategori.AddItem "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI"
            Me.cmbSubKategori.AddItem "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota"
            Me.cmbSubKategori.AddItem "400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota"
            Me.cmbSubKategori.AddItem "400.01.04 - Pengkhotbah Minggu: Di Rumah Duka (Oleh Pendeta)"
            Me.cmbSubKategori.AddItem "400.01.05 - Pengkhotbah Minggu: Remaja"
            Me.cmbSubKategori.AddItem "400.02.01 - Pengkhotbah Kebaktian di Lingkungan (Wijk)"
            Me.cmbSubKategori.AddItem "400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi/Remaja & GSM"
            Me.cmbSubKategori.AddItem "400.02.03 - Pengkhotbah Kebaktian Koor Ibu-Ibu"
            Me.cmbSubKategori.AddItem "400.02.04 - Pengkhotbah Kebaktian Ibu Hanna"
            Me.cmbSubKategori.AddItem "400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
            Me.cmbSubKategori.AddItem "400.03.01 - Pengkhotbah Perjanjian/Pemberkatan Nikah"
            Me.cmbSubKategori.AddItem "400.03.02 - Pengkhotbah Penguburan Jenazah"
            Me.cmbSubKategori.AddItem "400.03.03 - Pengkhotbah di Rumah Duka (Oleh Penatua)"
            Me.cmbSubKategori.AddItem "400.04.01 - Minggu Pagi 08.00 WIB (@ 13 Orang)"
            Me.cmbSubKategori.AddItem "400.04.02 - Minggu Sore: Pukul 18.00 WIB (@ 13 Orang)"
            Me.cmbSubKategori.AddItem "400.04.03 - Sekolah Minggu dan Remaja"
            Me.cmbSubKategori.AddItem "400.04.04 - Perjanjian/Pemberkatan Pernikahan"
            Me.cmbSubKategori.AddItem "400.04.05 - Kebaktian pemberangkatan jenazah"
            Me.cmbSubKategori.AddItem "400.04.06 - Minggu Di Rumah Duka"
            Me.cmbSubKategori.AddItem "400.04.07 - Pelayanan di Rumah Duka"
            Me.cmbSubKategori.AddItem "400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)"
            Me.cmbSubKategori.AddItem "400.04.09 - Latihan Pemusik dan Songleader"
            Me.cmbSubKategori.AddItem "400.04.10 - Petugas Penghitung Kebaktian Minggu"
            Me.cmbSubKategori.AddItem "400.05.01 - Perjamuan Kudus di Gereja"
            Me.cmbSubKategori.AddItem "400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi"
            Me.cmbSubKategori.AddItem "400.06.01 - Perayaan HUT Jemaat"
            
        Case "600 - PEMBINAAN & PELAYANAN"
            ' Subkategori untuk PEMBINAAN & PELAYANAN
            Me.cmbSubKategori.AddItem "600.01.01 - Pendidikan Lanjutan untuk Pendeta"
            Me.cmbSubKategori.AddItem "600.01.02 - Penghargaan untuk Penatua"
            Me.cmbSubKategori.AddItem "600.01.03 - Pembinaan & Pelatihan Pelajar Sidi"
            Me.cmbSubKategori.AddItem "600.01.04 - Pembinaan Penatua se Resort Medan Barat"
            Me.cmbSubKategori.AddItem "600.02.01 - Pembinaan & Pelayan Rohani (PPR)"
            Me.cmbSubKategori.AddItem "600.02.02 - Pekabaran Injil"
            Me.cmbSubKategori.AddItem "600.02.03 - Diakoni Sosial"
            Me.cmbSubKategori.AddItem "600.02.04 - Musik, Nyanyian & Koor (MNK)"
            Me.cmbSubKategori.AddItem "600.02.05 - Sekolah Minggu"
            Me.cmbSubKategori.AddItem "600.02.06 - Remaja"
            Me.cmbSubKategori.AddItem "600.02.07 - Pemuda"
            Me.cmbSubKategori.AddItem "600.02.08 - Perempuan"
            Me.cmbSubKategori.AddItem "600.02.09 - Pria"
            Me.cmbSubKategori.AddItem "600.02.10 - Lansia"
            Me.cmbSubKategori.AddItem "600.02.11 - Kesehatan"
            Me.cmbSubKategori.AddItem "600.02.12 - Pendidikan"
            Me.cmbSubKategori.AddItem "600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)"
            Me.cmbSubKategori.AddItem "600.02.14 - Sarana & Prasarana"
            Me.cmbSubKategori.AddItem "600.02.15 - Natal Gabungan Seksi-Seksi (Natal II)"
            Me.cmbSubKategori.AddItem "600.03.01 - Target Ke Kantor Pusat GKPI"
            Me.cmbSubKategori.AddItem "600.03.02 - Biaya Tahun Renstra GKPI 2023"
            Me.cmbSubKategori.AddItem "600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)"
            Me.cmbSubKategori.AddItem "600.04.01 - Target Ke GKPI Resort Medan Barat"
            
        Case "800 - BANTUAN & TUNJANGAN"
            ' Subkategori untuk BANTUAN & TUNJANGAN
            Me.cmbSubKategori.AddItem "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam"
            Me.cmbSubKategori.AddItem "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka"
            Me.cmbSubKategori.AddItem "800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI"
            Me.cmbSubKategori.AddItem "800.01.04 - Bantuan untuk PA. Mamre dan Yapentra"
            Me.cmbSubKategori.AddItem "800.01.05 - Bantuan Ke GKPI Lainnya"
            Me.cmbSubKategori.AddItem "800.01.06 - Bantuan Kepada Masyarakat di sekitar"
            Me.cmbSubKategori.AddItem "800.02.01 - Sekolah Minggu"
            Me.cmbSubKategori.AddItem "800.02.02 - Penatua Purna Bakti"
            Me.cmbSubKategori.AddItem "800.02.03 - Penatua Aktif"
            Me.cmbSubKategori.AddItem "800.02.04 - Calon Penatua Aktif"
            Me.cmbSubKategori.AddItem "800.02.05 - Pendeta GKPI Resort Medan Barat"
            Me.cmbSubKategori.AddItem "800.02.06 - Anggota Majelis Jemaat: Ketua Seksi & Penasehat"
            Me.cmbSubKategori.AddItem "800.02.07 - Guru-Guru Koor di Jemaat"
            Me.cmbSubKategori.AddItem "800.02.08 - Guru-Guru Sekolah Minggu"
            Me.cmbSubKategori.AddItem "800.02.09 - Pemusik: Pianis, Organis dan Saxophonis"
            Me.cmbSubKategori.AddItem "800.02.10 - Songleader"
            Me.cmbSubKategori.AddItem "800.02.11 - Petugas Live Streaming"
    End Select
End Sub

Private Sub btnSubmit_Click()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim kodeSub As String
    Dim jumlah As Double, setor As Double

    ' Validasi input
    If Me.txtTanggal.Value = "" Or Me.txtKW.Value = "" Or Me.txtUraian.Value = "" Or _
       Me.txtJumlah.Value = "" Or Me.cmbKategori.Value = "" Or Me.cmbSubKategori.Value = "" Then
        MsgBox "Harap isi semua field yang diperlukan!", vbExclamation
        Exit Sub
    End If
    
    ' Validasi format angka
    If Not IsNumeric(Me.txtJumlah.Value) Then
        MsgBox "Jumlah harus berupa angka!", vbExclamation
        Exit Sub
    End If
    
    If Me.txtSetor.Value <> "" And Not IsNumeric(Me.txtSetor.Value) Then
        MsgBox "Setor harus berupa angka!", vbExclamation
        Exit Sub
    End If

    ' Set nilai default untuk setor jika kosong
    If Me.txtSetor.Value = "" Then
        Me.txtSetor.Value = "0"
    End If

    ' Simpan data ke worksheet
    Set ws = ThisWorkbook.Sheets("JUR PENGEL JEMAAT 2024")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1

    ' Ekstrak kode subkategori
    kodeSub = Split(Me.cmbSubKategori.Value, " - ")(0)
    jumlah = Val(Me.txtJumlah.Value)
    setor = Val(Me.txtSetor.Value)

    ' Input data dasar
    ws.Cells(lastRow, 1).Value = CDate(Me.txtTanggal.Value)
    ws.Cells(lastRow, 1).NumberFormat = "dd-mmm-yy"
    ws.Cells(lastRow, 2).Value = Me.txtKW.Value
    ws.Cells(lastRow, 3).Value = Me.txtUraian.Value
    ws.Cells(lastRow, 4).Value = jumlah
    ws.Cells(lastRow, 4).NumberFormat = "#,##0.00"
    ws.Cells(lastRow, 13).Value = setor
    ws.Cells(lastRow, 13).NumberFormat = "#,##0.00"

    ' Masukkan ke kolom sesuai kategori
    Select Case True
        Case Me.cmbKategori.Value Like "200*"
            ws.Cells(lastRow, 5).Value = kodeSub
            ws.Cells(lastRow, 6).Value = jumlah
        Case Me.cmbKategori.Value Like "400*"
            ws.Cells(lastRow, 7).Value = kodeSub
            ws.Cells(lastRow, 8).Value = jumlah
        Case Me.cmbKategori.Value Like "600*"
            ws.Cells(lastRow, 9).Value = kodeSub
            ws.Cells(lastRow, 10).Value = jumlah
        Case Me.cmbKategori.Value Like "800*"
            ws.Cells(lastRow, 11).Value = kodeSub
            ws.Cells(lastRow, 12).Value = jumlah
    End Select

    ' Hitung total kas
    ws.Cells(lastRow, 4).Value = WorksheetFunction.Sum(ws.Range(ws.Cells(lastRow, 6), ws.Cells(lastRow, 8), _
                                  ws.Cells(lastRow, 10), ws.Cells(lastRow, 12), ws.Cells(lastRow, 13))
    ws.Cells(lastRow, 4).NumberFormat = "#,##0.00"

    ' Format angka untuk kolom jumlah
    ws.Cells(lastRow, 6).NumberFormat = "#,##0.00"
    ws.Cells(lastRow, 8).NumberFormat = "#,##0.00"
    ws.Cells(lastRow, 10).NumberFormat = "#,##0.00"
    ws.Cells(lastRow, 12).NumberFormat = "#,##0.00"

    MsgBox "Data berhasil disimpan di baris " & lastRow, vbInformation
    Unload Me
End Sub

Private Sub btnCancel_Click()
    Unload Me
End Sub


-------------------
23 april

form udah bekerja dan added data di rowakhir
' --- Kode di belakang UserForm 'FormPengeluaran' ---
Option Explicit

' Variabel global untuk worksheet
Dim ws As Worksheet

Private Sub UserForm_Initialize()
    ' Inisialisasi worksheet - gunakan Sheet pertama (indeks 1)
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets(1)
    On Error GoTo 0
    
    ' Jika Sheet 1 tidak ada, buat baru
    If ws Is Nothing Then
        Set ws = ThisWorkbook.Sheets.Add(Before:=ThisWorkbook.Sheets(1))
        ws.Name = "Data Pengeluaran"
        CreateHeaders
    End If
    
    ' Inisialisasi data kategori
    With Me.cmbKategori
        .Clear
        .AddItem "200 - ADMINISTRASI GEREJA"
        .AddItem "400 - PELAYANAN IBADAH"
        .AddItem "600 - PEMBINAAN & PELAYANAN"
        .AddItem "800 - BANTUAN & TUNJANGAN"
    End With
    
    ' Set tanggal default ke hari ini
    Me.txtTanggal.Value = Format(Date, "dd/mm/yyyy")
    
    ' Kosongkan field lainnya
    Me.txtKW.Value = ""
    Me.txtUraian.Value = ""
    Me.txtJumlah.Value = ""
    Me.txtSetor.Value = ""
    Me.cmbKategori.Value = ""
    Me.cmbSubKategori.Clear
    Me.cmbSubKategori.Enabled = False
End Sub

Private Sub CreateHeaders()
    ' Buat header sesuai struktur yang diminta
    Dim headers As Variant
    headers = Array( _
        "TGL.", "KW", "URAIAN", "KREDIT - KAS", _
        "200 (Kode)", "200 (Nilai)", _
        "400 (Kode)", "400 (Nilai)", _
        "600 (Kode)", "600 (Nilai)", _
        "800 (Kode)", "800 (Nilai)", _
        "Uang yang di setor" _
    )
    
    With ws
        ' Tulis header
        Dim i As Integer
        For i = 0 To UBound(headers)
            .Cells(1, i + 1).Value = headers(i)
        Next i
        
        ' Format header
        .Range("A1:M1").Font.Bold = True
        .Range("A1:M1").HorizontalAlignment = xlCenter
        .Columns("A:M").AutoFit
    End With
End Sub

Private Sub cmbKategori_Change()
    On Error GoTo ErrorHandler
    Application.ScreenUpdating = False
    
    Me.cmbSubKategori.Enabled = True
    Me.cmbSubKategori.Clear
    Me.cmbSubKategori.Value = ""
    
    If Trim(Me.cmbKategori.Value) = "" Then
        Me.cmbSubKategori.Enabled = False
        Exit Sub
    End If
    
    ' Isi subkategori berdasarkan kategori yang dipilih
    Select Case UCase(Trim(Me.cmbKategori.Value))
        Case "200 - ADMINISTRASI GEREJA"
            With Me.cmbSubKategori
                .AddItem "200.01.01 - Pendeta Pimpinan Jemaat"
                .AddItem "200.01.02 - Vicaris dan Pendeta Khusus"
                .AddItem "200.01.03 - Guru Jemaat"
                .AddItem "200.01.04 - Sekretaris dan Bendahara Jemaat"
                .AddItem "200.02.01 - Gaji Karyawan Tetap"
                .AddItem "200.02.02 - Honor Karyawan Tidak Tetap"
                .AddItem "200.03.01 - Listrik, Air, dan Telepon"
                .AddItem "200.03.02 - Internet dan Komunikasi"
                .AddItem "200.04.01 - Pemeliharaan Gedung"
                .AddItem "200.04.02 - Kebersihan dan Keamanan"
            End With
            
        Case "400 - PELAYANAN IBADAH"
            With Me.cmbSubKategori
                .AddItem "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI"
                .AddItem "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota"
                .AddItem "400.01.03 - Pengkhotbah Minggu: Tamu Khusus"
                .AddItem "400.02.01 - Musik dan Paduan Suara"
                .AddItem "400.02.02 - Sound System dan Multimedia"
                .AddItem "400.03.01 - Bahan Liturgi"
                .AddItem "400.03.02 - Bahan Renungan"
                .AddItem "400.04.01 - Konsumsi Panitia Ibadah"
                .AddItem "400.04.02 - Transportasi Panitia"
            End With
            
        Case "600 - PEMBINAAN & PELAYANAN"
            With Me.cmbSubKategori
                .AddItem "600.01.01 - Pendidikan Lanjutan untuk Pendeta"
                .AddItem "600.01.02 - Penghargaan untuk Penatua"
                .AddItem "600.02.01 - Kegiatan Pemuda"
                .AddItem "600.02.02 - Kegiatan Remaja"
                .AddItem "600.03.01 - Pelatihan Guru Sekolah Minggu"
                .AddItem "600.03.02 - Bahan Ajar Sekolah Minggu"
                .AddItem "600.04.01 - Kunjungan Pastoral"
                .AddItem "600.04.02 - Konseling Jemaat"
            End With
            
        Case "800 - BANTUAN & TUNJANGAN"
            With Me.cmbSubKategori
                .AddItem "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam"
                .AddItem "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka"
                .AddItem "800.02.01 - Bantuan Pendidikan Anak Jemaat"
                .AddItem "800.02.02 - Beasiswa Mahasiswa Teologi"
                .AddItem "800.03.01 - Bantuan Sosial untuk Lansia"
                .AddItem "800.03.02 - Bantuan Kesehatan Jemaat"
                .AddItem "800.04.01 - Tunjangan Hari Raya"
                .AddItem "800.04.02 - Bantuan Khusus"
            End With
    End Select
    
ExitHandler:
    Application.ScreenUpdating = True
    Exit Sub
    
ErrorHandler:
    MsgBox "Error saat memuat sub kategori: " & Err.Description, vbCritical
    Resume ExitHandler
End Sub

Private Sub btnSubmit_Click()
    Dim lastRow As Long
    Dim jumlah As Double, setor As Double
    Dim kategoriKode As String
    
    ' Validasi input
    If Not ValidateInputs() Then Exit Sub
    
    ' Konversi nilai
    If Not ConvertValues(jumlah, setor) Then Exit Sub
    
    ' Ambil kode kategori (200, 400, 600, atau 800)
    kategoriKode = Left(Me.cmbKategori.Value, 3)
    
    ' Cari baris kosong berikutnya
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    ' Simpan data ke worksheet
    With ws
        ' Kolom 1: Tanggal
        .Cells(lastRow, 1).Value = CDate(Me.txtTanggal.Value)
        .Cells(lastRow, 1).NumberFormat = "dd-mmm-yy"
        
        ' Kolom 2: KW
        .Cells(lastRow, 2).Value = Me.txtKW.Value
        
        ' Kolom 3: Uraian
        .Cells(lastRow, 3).Value = Me.txtUraian.Value
        
        ' Kolom 4: Kredit - Kas (jumlah total)
        .Cells(lastRow, 4).Value = jumlah
        .Cells(lastRow, 4).NumberFormat = "#,##0.00"
        
        ' Kolom 5-12: Kode dan Nilai per kategori
        Select Case kategoriKode
            Case "200"
                .Cells(lastRow, 5).Value = Me.cmbSubKategori.Value
                .Cells(lastRow, 6).Value = jumlah
            Case "400"
                .Cells(lastRow, 7).Value = Me.cmbSubKategori.Value
                .Cells(lastRow, 8).Value = jumlah
            Case "600"
                .Cells(lastRow, 9).Value = Me.cmbSubKategori.Value
                .Cells(lastRow, 10).Value = jumlah
            Case "800"
                .Cells(lastRow, 11).Value = Me.cmbSubKategori.Value
                .Cells(lastRow, 12).Value = jumlah
        End Select
        
        ' Format angka
        Dim i As Integer
        For i = 6 To 12 Step 2
            .Cells(lastRow, i).NumberFormat = "#,##0.00"
        Next i
        
        ' Kolom 13: Uang yang disetor
        .Cells(lastRow, 13).Value = setor
        .Cells(lastRow, 13).NumberFormat = "#,##0.00"
        
        ' Auto-fit kolom
        .Columns("A:M").AutoFit
    End With

    ' Reset form
    ResetForm
    
    MsgBox "Data berhasil disimpan di baris " & lastRow, vbInformation
End Sub

Private Function ValidateInputs() As Boolean
    ' Validasi semua input wajib diisi
    If Me.txtTanggal.Value = "" Then
        MsgBox "Harap isi tanggal!", vbExclamation
        Me.txtTanggal.SetFocus
        Exit Function
    End If
    
    If Me.txtKW.Value = "" Then
        MsgBox "Harap isi KW!", vbExclamation
        Me.txtKW.SetFocus
        Exit Function
    End If
    
    If Me.txtUraian.Value = "" Then
        MsgBox "Harap isi uraian!", vbExclamation
        Me.txtUraian.SetFocus
        Exit Function
    End If
    
    If Me.txtJumlah.Value = "" Then
        MsgBox "Harap isi jumlah!", vbExclamation
        Me.txtJumlah.SetFocus
        Exit Function
    End If
    
    If Me.cmbKategori.Value = "" Then
        MsgBox "Harap pilih kategori!", vbExclamation
        Me.cmbKategori.SetFocus
        Exit Function
    End If
    
    If Me.cmbSubKategori.Value = "" Then
        MsgBox "Harap pilih sub kategori!", vbExclamation
        Me.cmbSubKategori.SetFocus
        Exit Function
    End If
    
    ValidateInputs = True
End Function

Private Function ConvertValues(ByRef jumlah As Double, ByRef setor As Double) As Boolean
    On Error Resume Next
    ' Konversi nilai jumlah (gunakan titik sebagai desimal)
    jumlah = CDbl(Replace(Me.txtJumlah.Value, ",", "."))
    If Err.Number <> 0 Then
        MsgBox "Format jumlah tidak valid! Gunakan angka atau desimal dengan titik", vbExclamation
        ConvertValues = False
        Exit Function
    End If
    
    ' Konversi nilai setor (jika ada)
    If Me.txtSetor.Value <> "" Then
        setor = CDbl(Replace(Me.txtSetor.Value, ",", "."))
        If Err.Number <> 0 Then
            MsgBox "Format setor tidak valid! Gunakan angka atau desimal dengan titik", vbExclamation
            ConvertValues = False
            Exit Function
        End If
    Else
        setor = 0
    End If
    
    ConvertValues = True
End Function

Private Sub ResetForm()
    ' Reset semua input ke nilai default
    Me.txtTanggal.Value = Format(Date, "dd/mm/yyyy")
    Me.txtKW.Value = ""
    Me.txtUraian.Value = ""
    Me.txtJumlah.Value = ""
    Me.txtSetor.Value = ""
    Me.cmbKategori.Value = ""
    Me.cmbSubKategori.Clear
    Me.cmbSubKategori.Enabled = False
End Sub

Private Sub btnCancel_Click()
    Unload Me
End Sub

Private Sub txtJumlah_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    ' Hanya izinkan input angka, titik desimal, dan backspace
    If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 46 Or KeyAscii = 8) Then
        KeyAscii = 0
        Beep
    End If
End Sub

Private Sub txtSetor_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    ' Hanya izinkan input angka, titik desimal, dan backspace
    If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 46 Or KeyAscii = 8) Then
        KeyAscii = 0
        Beep
    End If
End Sub

----------------------------------------
KEDOKTERAN:

pemecahan protein dalam tubuh 

Tentu, berikut adalah skema singkat pemecahan protein di dalam tubuh:
Makanan Berprotein
    ‚Üì (Pengunyahan)
Mulut
    ‚Üì
Lambung
    ‚Üì (HCl ‚Üí denaturasi protein, Pepsinogen ‚Üí Pepsin)
    ‚Üì (Pepsin memecah protein ‚Üí Peptida)
Usus Halus
    ‚Üì (Tripsinogen ‚Üí Tripsin, Kimotripsinogen ‚Üí Kimotripsin, Karboksipeptidase dari Pankreas)
    ‚Üì (Peptida dipecah menjadi fragmen lebih kecil)
    ‚Üì (Aminopeptidase, Dipeptidase dari usus halus)
    ‚Üì (Peptida kecil dipecah ‚Üí Asam Amino)
    ‚Üì (Penyerapan Asam Amino ke Aliran Darah)
Seluruh Tubuh
    ‚Üì (Pemanfaatan Asam Amino: sintesis protein, energi, dll.)
Hati
    ‚Üì (Sisa metabolisme Asam Amino ‚Üí Urea)
Ginjal
    ‚Üì (Pembuangan Urea melalui Urine)

Keterangan Singkat:
 * Mulut: Pengunyahan mekanis.
 * Lambung: Asam lambung (HCl) denaturasi protein, enzim Pepsin memecah protein menjadi peptida.
 * Usus Halus: Enzim dari pankreas (Tripsin, Kimotripsin, Karboksipeptidase) dan usus halus (Aminopeptidase, Dipeptidase) memecah peptida menjadi asam amino.
 * Penyerapan: Asam amino diserap ke aliran darah.
 * Pemanfaatan: Asam amino digunakan di seluruh tubuh.
 * Pembuangan: Sisa metabolisme asam amino diubah menjadi urea di hati dan dibuang melalui ginjal.
Semoga skema ini mudah dipahami!






;;;;;;;;;;;;;;;;;

pemecahan lemak dalam tubuh 



Tentu, pemecahan lemak (lipid) terjadi terutama di usus halus. Berikut adalah skema singkatnya:
Makanan Berlemak
    ‚Üì (Pengunyahan & Pergerakan Lambung)
Lambung
    ‚Üì (Sedikit pemecahan oleh Lipase Lingual & Lambung)
Usus Halus
    ‚Üì (Empedu dari Hati & Kantung Empedu ‚Üí Emulsifikasi Lemak)
    ‚Üì (Lipase Pankreas ‚Üí Memecah trigliserida menjadi Asam Lemak & Monogliserida)
    ‚Üì (Pembentukan Misel)
    ‚Üì (Penyerapan Asam Lemak & Monogliserida oleh Sel Usus)
    ‚Üì (Pembentukan Kilomikron di dalam Sel Usus)
    ‚Üì (Pelepasan Kilomikron ke Sistem Limfatik ‚Üí Aliran Darah)
Seluruh Tubuh
    ‚Üì (Pemanfaatan Asam Lemak & Monogliserida sebagai Energi atau Penyimpanan)

Keterangan Singkat:
 * Lambung: Sedikit pemecahan lemak oleh lipase lingual dan lambung.
 * Usus Halus:
   * Empedu: Mengemulsifikasi lemak menjadi tetesan kecil.
   * Lipase Pankreas: Enzim utama yang memecah trigliserida menjadi asam lemak dan monogliserida.
   * Misel: Struktur yang membantu penyerapan asam lemak dan monogliserida.
   * Penyerapan: Asam lemak dan monogliserida diserap oleh sel usus.
   * Kilomikron: Lemak dikemas menjadi kilomikron untuk diangkut melalui sistem limfatik ke aliran darah.
 * Pemanfaatan: Asam lemak dan monogliserida digunakan sebagai sumber energi atau disimpan di seluruh tubuh.
 
 
 
 
 
 
 
 
 ;;;;;;;;;;;;;
 Berikut adalah sintesis kimia dari trigliserida menjadi ATP melalui siklus Krebs:

Langkah 1: Hidrolisis Trigliserida
Trigliserida + 3H2O ‚Üí Gliserol + 3Asam Lemak

Langkah 2: Oksidasi Asam Lemak
Asam Lemak + CoA + ATP ‚Üí Asil-KoA + AMP + PPi

Langkah 3: Siklus Œ≤-Oksidasi
Asil-KoA + FAD ‚Üí Asil-KoA (Œ≤-oksidasi) + FADH2

Langkah 4: Pembentukan Asetil-KoA
Asil-KoA (Œ≤-oksidasi) ‚Üí Asetil-KoA + Asam Lemak (lebih pendek)

Langkah 5: Siklus Krebs
Asetil-KoA + 3NAD+ + FAD + GDP + Pi ‚Üí 2CO2 + 3NADH + FADH2 + GTP + CoA

Langkah 6: Fosforilasi Oksidatif
NADH + H+ + 1/2O2 ‚Üí NAD+ + H2O (menghasilkan 3ATP)
FADH2 + 1/2O2 ‚Üí FAD (menghasilkan 2ATP)
GTP + ADP ‚Üí GDP + ATP (menghasilkan 1ATP)

Dengan demikian, trigliserida dapat diubah menjadi ATP melalui serangkaian reaksi kimia yang kompleks.



;;;;;;;;;;;bang hendro;;;;;
Berikut adalah penjelasan detail tentang setiap obat-obatan yang Anda sebutkan:

Nurfast Tablet 10 mg
- *Nama generik*: Nifedipine
- *Kelas obat*: Calcium channel blocker
- *Indikasi*: Hipertensi, angina pektoris
- *Dosis*: 10-30 mg per hari
- *Cara kerja*: Nifedipine bekerja dengan menghambat saluran kalsium pada dinding pembuluh darah, sehingga mengurangi tekanan darah dan mengurangi beban jantung.
- *Efek samping*: Nifedipine dapat menyebabkan efek samping seperti sakit kepala, kelelahan, dan pembengkakan pada kaki.

Sanmol
- *Nama generik*: Paracetamol (acetaminophen)
- *Kelas obat*: Analgesik, antipiretik
- *Indikasi*: Nyeri, demam
- *Dosis*: 500-1000 mg per hari
- *Cara kerja*: Paracetamol bekerja dengan menghambat produksi prostaglandin, yang merupakan zat kimia yang menyebabkan nyeri dan demam.
- *Efek samping*: Paracetamol dapat menyebabkan efek samping seperti sakit kepala, kelelahan, dan gangguan pencernaan.

Toramine
- *Nama generik*: Tramadol
- *Kelas obat*: Analgesik opioid
- *Indikasi*: Nyeri sedang hingga berat
- *Dosis*: 50-100 mg per hari
- *Cara kerja*: Tramadol bekerja dengan menghambat reseptor opioid pada sistem saraf pusat, sehingga mengurangi nyeri.
- *Efek samping*: Tramadol dapat menyebabkan efek samping seperti sakit kepala, kelelahan, dan ketergantungan.

Kode Infospat
- *Tidak ada informasi yang tersedia* tentang kode infospat. Mungkin Anda bisa memberikan lebih banyak konteks atau informasi tentang kode ini.

Hemy Hydrate
- *Nama generik*: Hemihydrate
- *Kelas obat*: Suplemen
- *Indikasi*: Dehidrasi, kekurangan cairan
- *Dosis*: tergantung pada kebutuhan individu
- *Cara kerja*: Hemihydrate bekerja dengan menggantikan cairan yang hilang dalam tubuh, sehingga mengurangi dehidrasi.
- *Efek samping*: Hemihydrate dapat menyebabkan efek samping seperti sakit kepala, kelelahan, dan gangguan pencernaan.

Norvask
- *Nama generik*: Amlodipine
- *Kelas obat*: Calcium channel blocker
- *Indikasi*: Hipertensi, angina pektoris
- *Dosis*: 5-10 mg per hari
- *Cara kerja*: Amlodipine bekerja dengan menghambat saluran kalsium pada dinding pembuluh darah, sehingga mengurangi tekanan darah dan mengurangi beban jantung.
- *Efek samping*: Amlodipine dapat menyebabkan efek samping seperti sakit kepala, kelelahan, dan pembengkakan pada kaki.

Brainact
- *Tidak ada informasi yang tersedia* tentang Brainact. Mungkin Anda bisa memberikan lebih banyak konteks atau informasi tentang obat ini.

Perlu diingat bahwa informasi di atas hanya sebagai referensi dan tidak boleh digunakan sebagai pengganti saran medis profesional. Jika Anda memiliki pertanyaan atau kekhawatiran tentang obat-obatan, sebaiknya Anda berkonsultasi dengan dokter atau apoteker.
















Tentu, mari kita bahas hasil pemeriksaan HEMATOLOGI - Darah Lengkap yang tertera pada gambar. Hasil ini memberikan informasi tentang berbagai komponen sel darah dalam tubuh Anda. Berikut penjelasannya:
 * Hemoglobin (Hb): 16.3 g/dL
   * Ini adalah protein dalam sel darah merah yang bertugas membawa oksigen ke seluruh tubuh.
   * Nilai normal untuk pria dewasa umumnya berkisar antara 13.5 - 17.5 g/dL, dan untuk wanita dewasa antara 12.0 - 15.5 g/dL.
   * Nilai Anda sedikit tinggi, terutama jika Anda seorang wanita. Peningkatan hemoglobin bisa disebabkan oleh dehidrasi, polisitemia (produksi sel darah merah berlebihan), atau kondisi medis lainnya.
 * Lekosit (Sel Darah Putih/WBC): 9,650 /mm¬≥
   * Ini adalah sel darah yang berperan dalam sistem kekebalan tubuh, melawan infeksi dan zat asing.
   * Nilai normal umumnya berkisar antara 4,000 - 10,000 /mm¬≥.
   * Nilai Anda berada dalam batas normal.
 * Hematokrit (HCT): 51.1 %
   * Ini adalah persentase volume sel darah merah dalam total volume darah.
   * Nilai normal untuk pria dewasa umumnya berkisar antara 40 - 54 %, dan untuk wanita dewasa antara 36 - 48 %.
   * Nilai Anda tinggi, terutama jika Anda seorang wanita. Peningkatan hematokrit seringkali sejalan dengan peningkatan hemoglobin dan bisa disebabkan oleh alasan yang serupa.
 * Eritrosit (Sel Darah Merah/RBC): 5.34 juta/mm¬≥
   * Ini adalah sel darah yang mengandung hemoglobin dan bertugas membawa oksigen.
   * Nilai normal untuk pria dewasa umumnya berkisar antara 4.5 - 5.5 juta/mm¬≥, dan untuk wanita dewasa antara 4.0 - 5.0 juta/mm¬≥.
   * Nilai Anda sedikit tinggi, terutama jika Anda seorang wanita. Peningkatan jumlah eritrosit juga bisa berkaitan dengan kondisi yang sama dengan peningkatan hemoglobin dan hematokrit.
 * Trombosit (Platelet): 296,000 /uL
   * Ini adalah fragmen sel darah yang berperan penting dalam pembekuan darah.
   * Nilai normal umumnya berkisar antara 150,000 - 450,000 /uL.
   * Nilai Anda berada dalam batas normal.
 * Index Eritrosit: Indeks ini memberikan informasi lebih lanjut tentang ukuran dan kandungan hemoglobin dalam sel darah merah, yang berguna dalam mengklasifikasikan jenis anemia jika ada.
   * MCV (Mean Corpuscular Volume): 95.7 fL - Ukuran rata-rata volume satu sel darah merah. Nilai normal umumnya 80 - 100 fL. Nilai Anda berada di batas atas normal.
   * MCH (Mean Corpuscular Hemoglobin): 30.5 pg - Jumlah rata-rata hemoglobin dalam satu sel darah merah. Nilai normal umumnya 27 - 32 pg. Nilai Anda berada dalam batas normal.
   * MCHC (Mean Corpuscular Hemoglobin Concentration): 31.9 g/dL - Konsentrasi rata-rata hemoglobin dalam satu sel darah merah. Nilai normal umumnya 32 - 36 g/dL. Nilai Anda sedikit di bawah batas normal.
 * RDW-CV (Red Cell Distribution Width - Coefficient of Variation): 11.8 % - Ukuran variasi dalam ukuran sel darah merah. Nilai normal umumnya 11.5 - 14.5 %. Nilai Anda berada dalam batas normal.
 * RDW-SD (Red Cell Distribution Width - Standard Deviation): 47.1 fL - Ukuran variasi dalam ukuran sel darah merah (standar deviasi). Nilai normal umumnya 35 - 56 fL. Nilai Anda berada dalam batas normal.
 * MPV (Mean Platelet Volume): 8.7 fL - Ukuran rata-rata volume satu trombosit. Nilai normal umumnya 7.5 - 11.5 fL. Nilai Anda berada dalam batas normal.
 * PDW (Platelet Distribution Width): 15.8 fL - Ukuran variasi dalam ukuran trombosit. Nilai normal umumnya 9 - 17 fL. Nilai Anda berada dalam batas normal.
Kesimpulan Sementara:
Hasil pemeriksaan darah Anda menunjukkan kadar hemoglobin, hematokrit, dan eritrosit yang sedikit tinggi, terutama jika Anda seorang wanita. Selain itu, nilai MCHC Anda sedikit di bawah batas normal, dan MCV berada di batas atas normal.
Penting untuk diperhatikan: Interpretasi hasil laboratorium ini sebaiknya selalu dilakukan oleh dokter yang menangani Anda. Dokter akan mempertimbangkan riwayat kesehatan Anda secara keseluruhan, gejala klinis yang mungkin Anda alami, dan hasil pemeriksaan lainnya untuk memberikan diagnosis dan penanganan yang tepat. Sebaiknya konsultasikan hasil ini dengan dokter Anda untuk mendapatkan penjelasan yang lebih akurat.









Tentu, mari kita bahas masing-masing kandungan dalam hasil hematologi (Darah Lengkap) yang Anda berikan dan bagaimana cara kerjanya dalam tubuh, serta apa efeknya jika berada di luar nilai normal.
1. Hemoglobin (Hb): 16.3 g/dL
 * Kandungan: Protein dalam sel darah merah yang bertugas membawa oksigen dari paru-paru ke seluruh tubuh dan membawa kembali karbon dioksida ke paru-paru untuk dikeluarkan. Mengandung zat besi (heme) yang mengikat oksigen.
 * Cara Kerja: Saat darah melewati paru-paru, oksigen berikatan dengan zat besi dalam hemoglobin. Darah yang kaya oksigen ini kemudian diedarkan ke seluruh tubuh. Di jaringan tubuh, oksigen dilepaskan untuk digunakan oleh sel-sel, dan karbon dioksida dari hasil metabolisme berikatan dengan hemoglobin untuk dibawa kembali ke paru-paru dan dikeluarkan saat kita menghembuskan napas.
 * Efek Jika Tidak Normal:
   * Tinggi: Bisa mengindikasikan polisitemia (produksi sel darah merah berlebihan), dehidrasi (konsentrasi hemoglobin meningkat karena volume plasma darah berkurang), penyakit paru kronis, atau kondisi genetik tertentu. Gejala bisa berupa sakit kepala, pusing, kulit kemerahan, atau peningkatan risiko pembekuan darah.
   * Rendah: Mengindikasikan anemia (kurangnya sel darah merah atau kadar hemoglobin rendah). Penyebabnya bisa bermacam-macam, seperti kekurangan zat besi, kehilangan darah, gangguan produksi sel darah merah, atau penyakit kronis. Gejala bisa berupa kelelahan, lemas, pucat, sesak napas, dan pusing.
2. Lekosit (Sel Darah Putih/WBC): 9,650 /mm¬≥
 * Kandungan: Berbagai jenis sel yang berperan dalam sistem kekebalan tubuh, melindungi tubuh dari infeksi dan zat asing. Jenis-jenis utama lekosit meliputi neutrofil, limfosit, monosit, eosinofil, dan basofil (meskipun rincian jenis tidak ada di hasil ini).
 * Cara Kerja: Setiap jenis lekosit memiliki fungsi spesifik dalam melawan infeksi. Misalnya, neutrofil adalah garda depan melawan infeksi bakteri, limfosit berperan dalam respons imun spesifik terhadap virus dan bakteri tertentu, monosit dapat berubah menjadi makrofag yang menelan patogen dan sel mati, eosinofil berperan dalam respons alergi dan infeksi parasit, dan basofil melepaskan histamin dalam reaksi alergi.
 * Efek Jika Tidak Normal:
   * Tinggi (Leukositosis): Biasanya menandakan adanya infeksi, peradangan, stres, atau kondisi yang lebih serius seperti leukemia.
   * Rendah (Leukopenia): Bisa disebabkan oleh infeksi virus tertentu, gangguan sumsum tulang, efek samping obat, atau penyakit autoimun. Kondisi ini dapat meningkatkan risiko infeksi.
3. Hematokrit (HCT): 51.1 %
 * Kandungan: Persentase volume sel darah merah dalam total volume darah.
 * Cara Kerja: Mengukur proporsi sel darah merah terhadap plasma darah. Nilai hematokrit mencerminkan kemampuan darah membawa oksigen.
 * Efek Jika Tidak Normal:
   * Tinggi: Mirip dengan hemoglobin tinggi, bisa disebabkan oleh dehidrasi, polisitemia, atau kondisi paru-paru.
   * Rendah: Mirip dengan hemoglobin rendah, menandakan anemia atau adanya kelebihan cairan dalam darah (hemodilusi).
4. Eritrosit (Sel Darah Merah/RBC): 5.34 juta/mm¬≥
 * Kandungan: Sel darah yang mengandung hemoglobin dan bertugas membawa oksigen.
 * Cara Kerja: Diproduksi di sumsum tulang dan memiliki masa hidup sekitar 120 hari. Bentuknya bikonkaf yang fleksibel memudahkan mereka melewati pembuluh darah kecil. Fungsi utamanya adalah mengangkut oksigen dan karbon dioksida.
 * Efek Jika Tidak Normal:
   * Tinggi (Polisitemia): Penyebab dan gejalanya mirip dengan hemoglobin dan hematokrit tinggi.
   * Rendah (Anemia): Penyebab dan gejalanya mirip dengan hemoglobin dan hematokrit rendah.
5. Trombosit (Platelet): 296,000 /uL
 * Kandungan: Fragmen sel darah yang berperan penting dalam pembekuan darah (hemostasis).
 * Cara Kerja: Ketika terjadi luka dan pembuluh darah pecah, trombosit akan berkumpul di area luka dan membentuk sumbatan sementara. Mereka juga melepaskan faktor-faktor pembekuan yang mengaktifkan kaskade pembekuan untuk membentuk bekuan darah yang stabil dan menghentikan perdarahan.
 * Efek Jika Tidak Normal:
   * Tinggi (Trombositosis): Bisa disebabkan oleh peradangan, infeksi, gangguan sumsum tulang, atau setelah operasi pengangkatan limpa. Peningkatan trombosit dapat meningkatkan risiko pembekuan darah.
   * Rendah (Trombositopenia): Bisa disebabkan oleh gangguan produksi trombosit di sumsum tulang, peningkatan penghancuran trombosit, atau penumpukan trombosit di limpa. Kondisi ini dapat meningkatkan risiko perdarahan.
Index Eritrosit (MCV, MCH, MCHC): Indeks ini memberikan informasi tentang ukuran dan kandungan hemoglobin dalam sel darah merah, membantu dalam mengklasifikasikan jenis anemia.
 * MCV (Mean Corpuscular Volume): 95.7 fL
   * Kandungan: Ukuran rata-rata volume satu sel darah merah.
   * Cara Kerja: Dihitung dari hematokrit dibagi jumlah eritrosit.
   * Efek Jika Tidak Normal:
     * Tinggi (Makrositik): Sel darah merah lebih besar dari normal, sering ditemukan pada anemia defisiensi vitamin B12 atau asam folat.
     * Rendah (Mikrositik): Sel darah merah lebih kecil dari normal, sering ditemukan pada anemia defisiensi besi atau talasemia.
 * MCH (Mean Corpuscular Hemoglobin): 30.5 pg
   * Kandungan: Jumlah rata-rata hemoglobin dalam satu sel darah merah.
   * Cara Kerja: Dihitung dari hemoglobin dibagi jumlah eritrosit.
   * Efek Jika Tidak Normal: Biasanya bergerak paralel dengan MCV. Tinggi pada anemia makrositik dan rendah pada anemia mikrositik.
 * MCHC (Mean Corpuscular Hemoglobin Concentration): 31.9 g/dL
   * Kandungan: Konsentrasi rata-rata hemoglobin dalam satu sel darah merah.
   * Cara Kerja: Dihitung dari hemoglobin dibagi hematokrit.
   * Efek Jika Tidak Normal:
     * Rendah (Hipokromik): Konsentrasi hemoglobin per sel darah merah lebih rendah dari normal, sering ditemukan pada anemia defisiensi besi atau talasemia.
     * Tinggi (Hiperkromik): Konsentrasi hemoglobin per sel darah merah lebih tinggi dari normal, lebih jarang terjadi dan biasanya disebabkan oleh sferositosis herediter atau dehidrasi berat.
RDW-CV (Red Cell Distribution Width - Coefficient of Variation): 11.8 % dan RDW-SD (Red Cell Distribution Width - Standard Deviation): 47.1 %
 * Kandungan: Ukuran variasi dalam ukuran sel darah merah (anisositosis).
 * Cara Kerja: Mengukur seberapa seragam ukuran sel darah merah dalam sampel darah.
 * Efek Jika Tidak Normal (Tinggi): Menandakan adanya variasi ukuran sel darah merah yang lebih besar dari normal, sering ditemukan pada berbagai jenis anemia, terutama pada tahap awal atau campuran defisiensi.
MPV (Mean Platelet Volume): 8.7 fL
 * Kandungan: Ukuran rata-rata volume satu trombosit.
 * Cara Kerja: Mengukur ukuran rata-rata trombosit dalam darah.
 * Efek Jika Tidak Normal:
   * Tinggi: Trombosit yang lebih besar biasanya lebih muda dan lebih aktif. Bisa ditemukan pada beberapa kondisi seperti peningkatan produksi trombosit di sumsum tulang atau penghancuran trombosit yang meningkat.
   * Rendah: Trombosit yang lebih kecil bisa ditemukan pada gangguan produksi trombosit di sumsum tulang.
PDW (Platelet Distribution Width): 15.8 fL
 * Kandungan: Ukuran variasi dalam ukuran trombosit (anisositosis trombosit).
 * Cara Kerja: Mengukur seberapa seragam ukuran trombosit dalam sampel darah.
 * Efek Jika Tidak Normal (Tinggi): Menandakan adanya variasi ukuran trombosit yang lebih besar dari normal, bisa ditemukan pada beberapa gangguan sumsum tulang atau peningkatan produksi trombosit.
Penting untuk diingat bahwa interpretasi hasil laboratorium harus selalu dilakukan oleh dokter yang menangani, dengan mempertimbangkan riwayat kesehatan pasien, gejala klinis, dan hasil pemeriksaan lainnya. Hasil di atas menunjukkan beberapa nilai yang sedikit di luar rentang normal (terutama Hemoglobin, Hematokrit, Eritrosit yang cenderung tinggi, dan MCHC yang sedikit rendah), dan dokter akan mengevaluasi signifikansinya dalam konteks kondisi pasien secara keseluruhan.



Nyeri bisa menjadi efek samping dari berbagai jenis obat. Sulit untuk menentukan obat mana yang menyebabkan nyeri tanpa mengetahui obat-obatan spesifik yang sedang dikonsumsi pasien.
Namun, berdasarkan percakapan kita sebelumnya, beberapa obat yang telah kita bahas dan berpotensi menyebabkan nyeri sebagai efek samping adalah:
 * Remopain (Naproxen Sodium): Ini adalah NSAID yang digunakan untuk meredakan nyeri. Meskipun bertujuan untuk mengurangi nyeri, pada beberapa orang, NSAID justru dapat menyebabkan efek samping seperti sakit perut, sakit kepala, atau bahkan nyeri dada (terutama pada pasien dengan risiko kardiovaskular). Selain itu, reaksi alergi terhadap obat ini juga bisa menimbulkan nyeri.
 * Toramine (Ketorolac): Ini juga merupakan NSAID dengan potensi efek samping nyeri perut, sakit kepala, dan pada kasus yang jarang, masalah kardiovaskular yang bisa menimbulkan nyeri dada. Nyeri di tempat suntikan juga mungkin terjadi jika diberikan melalui injeksi.
 * Codein: Obat opioid ini umumnya digunakan untuk meredakan nyeri dan batuk. Efek sampingnya bisa meliputi sakit kepala dan nyeri perut akibat konstipasi. Meskipun tujuannya meredakan nyeri, pada beberapa orang bisa menimbulkan efek samping yang tidak nyaman.
Untuk mengetahui obat mana yang mungkin menyebabkan nyeri pada pasien, perlu diperhatikan beberapa hal:
 * Obat-obatan apa saja yang saat ini sedang dikonsumsi pasien? Baik obat resep maupun obat bebas, termasuk suplemen.
 * Kapan nyeri mulai dirasakan setelah mengonsumsi obat tertentu?
 * Jenis nyeri yang dirasakan (misalnya, sakit kepala, nyeri perut, nyeri otot, nyeri dada).
 * Gejala lain yang menyertai nyeri.
Langkah terbaik adalah:
 * Identifikasi semua obat yang sedang dikonsumsi pasien.
 * Konsultasikan dengan dokter yang merawat pasien. Dokter akan dapa

 ----------------kedokteran-------------------------



 Alamat Nama Lengkap Vierari Anniversary Nomor Telepon (+62) 838-9570-4804 Provinsi, Kota, Kecamatan, Kode Pos SUMATERA SELATAN KOTA PALEMBANG ILIR BARAT II 30145 Nama Jalan, Gedung, No. Rumah Lorong Serengam I, RT.9/RW.3, 32 Ilir, Ilir Barat li


 ----------------------------------------

 npwp gandatech 19.928.609.7-124.000 
 username 4716080853
 @Turboturbo123 



 npwp pribadi sarwono
 sarwono tamba satria s alamat Jl Villa Nusa Setiabudi B16 npwp 391359148124000



 -----------------------------
 gombal cewek:

 Oke, siap! Ini dia daftar kalimat gombal yang menggabungkan unsur intelektual, ilmiah, dan psikologis, terinspirasi dari pujian filosofis sebelumnya tentang wanita dengan *sport bra*, lekuk dada, dan kulit putih bersih:

**List Kalimat Gombal Intelektual, Ilmiah, dan Psikologis:**

1.  "Layaknya paradoks Zeno tentang gerak, mataku terpaku pada lekuk tubuhmu yang dinamis namun terasa abadi dalam keindahannya. Sebuah kontradiksi yang justru menyempurnakan persepsiku tentang estetika." (Intelektual - Paradoks Zeno, Estetika)
2.  "Dalam spektrum warna kulitmu yang putih bersih, terpancar frekuensi gelombang elektromagnetik yang unik, resonan dengan pusat kebahagiaanku. Sebuah bukti empiris bahwa keindahanmu memiliki daya tarik fisik yang tak terbantahkan." (Ilmiah - Spektrum Warna, Gelombang Elektromagnetik, Daya Tarik Fisik)
3.  "Secara psikologis, kehadiranmu mengaktifkan *reward system* di otakku secara optimal. Setiap detail visual tentang dirimu, mulai dari lekuk dada hingga warna kulitmu, memicu pelepasan dopamin yang menciptakan euforia kognitif." (Psikologis - *Reward System*, Dopamin, Euforia Kognitif)
4.  "Seperti hukum kekekalan energi, pesonamu tidak pernah pudar, hanya bertransformasi menjadi daya tarik yang semakin kuat seiring berjalannya waktu. Lekuk tubuhmu adalah representasi fisik dari vitalitas, dan kulitmu adalah manifestasi dari ketenangan jiwa." (Intelektual & Ilmiah - Hukum Kekekalan Energi, Vitalitas)
5.  "Dalam teori *Gestalt*, keseluruhan dirimu lebih dari sekadar jumlah bagian-bagiannya. Lekuk tubuhmu yang terbingkai *sport bra* dan warna kulitmu yang memukau berpadu menciptakan *emergent property* berupa keindahan yang holistik dan tak terduga." (Psikologis - Teori *Gestalt*, *Emergent Property*, Holistik)
6.  "Berdasarkan prinsip *Occam's Razor*, penjelasan paling sederhana untuk ketertarikanku padamu adalah bahwa kamu memang memiliki daya pikat intrinsik yang luar biasa. Lekuk tubuhmu adalah kurva elegan, dan kulitmu adalah bidang simetri yang sempurna." (Intelektual - Prinsip *Occam's Razor*, Kurva Elegan, Simetri)
7.  "Secara neurobiologis, tatapan mataku padamu menciptakan jalur saraf baru yang didedikasikan untuk mengagumi keindahanmu. Lekuk dadamu adalah fokus visual yang menarik perhatian, dan kulitmu adalah latar belakang yang menenangkan, menciptakan pengalaman estetis yang mendalam." (Ilmiah & Psikologis - Neurobiologis, Jalur Saraf, Pengalaman Estetis)
8.  "Jika dianalogikan dengan teori relativitas, waktu terasa melambat saat bersamamu, terutama ketika mengamati keindahanmu. Lekuk tubuhmu adalah ruang yang melengkung karena gravitasi pesonamu, dan kulitmu adalah konstanta yang selalu memancarkan cahaya." (Intelektual & Ilmiah - Teori Relativitas, Ruang dan Waktu, Konstanta)
9.  "Dalam psikologi evolusioner, preferensi terhadap bentuk tubuh dan warna kulit tertentu mungkin terkait dengan indikator kesehatan dan kesuburan. Namun, bagiku, lekuk tubuhmu dan warna kulitmu lebih dari sekadar itu; mereka adalah representasi artistik dari keunikanmu." (Psikologis & Intelektual - Psikologi Evolusioner, Representasi Artistik)
10. "Seperti *thought experiment* dalam filsafat, membayangkan dunia tanpamu akan mengurangi secara signifikan tingkat keindahan dan inspirasi di dalamnya. Lekuk tubuhmu adalah argumen visual yang kuat, dan kulitmu adalah premis keanggunan yang tak terbantahkan." (Intelektual - *Thought Experiment*, Argumen Visual, Premis Keanggunan)
Tentu, berikut adalah daftar kalimat gombal intelektual dan psikologis bernuansa filsafat yang elegan, ditujukan sebagai pujian untuk wanita dengan penampilan atletis (sport bra, lekukan dada), kulit putih bersih, dan kecantikan alami. Kalimat-kalimat ini tetap menjaga rasa hormat dan estetika, serta menggambarkan kekaguman melalui pendekatan filosofis dan ilmiah:

---

### üîπ **Daftar Kalimat Gombal Intelektual ‚Äì Psikologis ‚Äì Filosofis:**

1. **"Keindahanmu adalah sintesis sempurna antara harmoni estetika Aristoteles dan daya tarik visual yang bahkan Plato pun akan anggap sebagai bentuk idea tertinggi."**

2. **"Kulitmu yang putih bersih bukan sekadar epidermis yang memantulkan cahaya, tapi manifestasi dari kemurnian eksistensial yang bahkan Sartre akan segan untuk mendefinisikannya."**

3. **"Sport bra yang kau kenakan tak sekadar menyokong bentuk, tapi menyiratkan keseimbangan antara kekuatan dan keanggunan‚Äîseperti Yin dan Yang dalam tubuh yang telah menyatu dengan esensi dirinya."**

4. **"Daya tarikmu tak hanya menggetarkan syaraf simpatisku, tapi juga menstimulasi lobus frontal yang bertugas mengenali keindahan dan intelegensi sosial."**

5. **"Aku tak hanya melihatmu dengan mata, tapi memproses keberadaanmu melalui lensa eksistensialisme‚Äîbahwa kamu adalah makna dalam absurditas dunia."**

6. **"Lekuk tubuhmu adalah geometri alami yang tak bisa direduksi menjadi rumus, tapi hanya bisa dihargai dalam kontemplasi panjang tentang estetika dan evolusi."**

7. **"Jika Immanuel Kant menyusun teori tentang 'the sublime', mungkin dia sedang membayangkan sosok sepertimu‚Äîyang menimbulkan decak kagum sekaligus kesadaran akan keterbatasan persepsi manusia."**

8. **"Dalammu ada perpaduan antara Dopamin dari kesan pertama dan Serotonin dari ketenangan batin yang terpancar lewat cara kamu berdiri percaya diri."**

9. **"Kepercayaan dirimu dalam sport bra adalah simbol kekuatan internal‚Äîsebuah narasi psikodinamis dari Jung tentang animus yang telah menyatu dengan anima."**

10. **"Kecantikanmu bukanlah sekadar visualisasi, tapi sebuah fenomena fenomenologis yang membuat dunia tidak lagi bersifat netral ketika kamu hadir."**

---

Kalimat-kalimat di atas dirancang agar tetap elegan, tidak vulgar, dan memiliki unsur keilmuan serta kedalaman psikologis. Ingin dilanjutkan dengan versi puisi pendek atau gaya sastra klasik juga?

------------------------------
7 mei

1. Module2 - Fungsi Tombol dan Sticky Button
TampilkanFormPengeluaran(): Menampilkan form saat tombol diklik

StickyButton(): Membuat tombol tetap terlihat saat scrolling

2. Module3 - Pembuatan/Penyesuaian Tombol
BuatAtauPerbaikiBtnFormTetap(): Fungsi utama yang:

Membuat tombol baru jika belum ada

Memperbaiki posisi tombol yang sudah ada

Mengatur properti tombol (ukuran, teks, dll)s

--------------------------------
9 mei 

formpengeluaran


' --- Kode di belakang UserForm 'FormPengeluaran' ---
Option Explicit

' Variabel global untuk worksheet
Dim ws As Worksheet

Private Sub UserForm_Initialize()
    ' Inisialisasi worksheet - gunakan sheet dengan nama "1"
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets("1")
    On Error GoTo 0
    
    ' Jika sheet "1" tidak ada, buat baru
    If ws Is Nothing Then
        Set ws = ThisWorkbook.Sheets.Add(Before:=ThisWorkbook.Sheets(1))
        ws.Name = "1"
        CreateHeaders
    End If
    
    ' Inisialisasi data kategori
    InitializeKategori
    
    ' Set tanggal default ke hari ini dalam format yang diminta
    Me.txtTanggal.Value = Format(Date, "dd-mmm-yy")
    
    ' Kosongkan field lainnya
    ClearFormFields
End Sub

Private Sub InitializeKategori()
    With Me.cmbKategori
        .Clear
        .AddItem "200 - ADMINISTRASI GEREJA"
        .AddItem "400 - PELAYANAN IBADAH"
        .AddItem "600 - PEMBINAAN & PELAYANAN"
        .AddItem "800 - BANTUAN & TUNJANGAN"
    End With
End Sub

Private Sub ClearFormFields()
    Me.txtKW.Value = ""
    Me.txtUraian.Value = ""
    Me.txtJumlah.Value = ""
    Me.txtSetor.Value = ""
    Me.cmbKategori.Value = ""
    Me.cmbSubKategori.Clear
    Me.cmbSubKategori.Enabled = False
End Sub

Private Sub CreateHeaders()
    ' Buat header sesuai struktur yang diminta
    Dim headers As Variant
    headers = Array( _
        "tanggal", "kw", "uraian", "totalKas", "kodeSubKategori", _
        "jumlah", "kodeSubKategori", "jumlah", _
        "kodeSubKategori", "jumlah", _
        "kodeSubKategori", "jumlah", _
        "setor" _
    )
    
    With ws
        ' Tulis header
        Dim i As Integer
        For i = 0 To UBound(headers)
            .Cells(1, i + 1).Value = headers(i)
        Next i
        
        ' Format header
        .Range("A1:M1").Font.Bold = True
        .Range("A1:M1").HorizontalAlignment = xlCenter
        .Columns("A:M").AutoFit
    End With
End Sub

Private Sub cmbKategori_Change()
    On Error GoTo ErrorHandler
    Application.ScreenUpdating = False
    
    Me.cmbSubKategori.Enabled = True
    Me.cmbSubKategori.Clear
    Me.cmbSubKategori.Value = ""
    
    If Trim(Me.cmbKategori.Value) = "" Then
        Me.cmbSubKategori.Enabled = False
        Exit Sub
    End If
    
    ' Isi subkategori berdasarkan kategori yang dipilih
    Select Case UCase(Trim(Me.cmbKategori.Value))
        Case "200 - ADMINISTRASI GEREJA"
            LoadSubKategori200
        Case "400 - PELAYANAN IBADAH"
            LoadSubKategori400
        Case "600 - PEMBINAAN & PELAYANAN"
            LoadSubKategori600
        Case "800 - BANTUAN & TUNJANGAN"
            LoadSubKategori800
    End Select
    
ExitHandler:
    Application.ScreenUpdating = True
    Exit Sub
    
ErrorHandler:
    MsgBox "Error saat memuat sub kategori: " & Err.Description, vbCritical
    Resume ExitHandler
End Sub

Private Sub LoadSubKategori200()
    With Me.cmbSubKategori
        .AddItem "200.01.01 - Pendeta Pimpinan Jemaat"
        .AddItem "200.01.02 - Vicaris dan Pendeta Khusus"
        .AddItem "200.01.03 - Guru Jemaat"
        .AddItem "200.01.04 - Sekretaris dan Bendahara Jemaat"
        .AddItem "200.01.05.a - Pegawai Kantor (Administrasi): 2 orang"
        .AddItem "200.01.06.a - Pegawai Kebersihan Gedung Gereja: 1 orang"
        .AddItem "200.01.06.b - Pegawai Kebersihan Pekarangan Gereja: 1 orang"
        .AddItem "200.01.06.c1 - Pegawai Supir Mobil Dinas & Ambulance"
        .AddItem "200.01.06.c2 - Pegawai Jaga Malam"
        .AddItem "200.01.06.d - Pegawai Kebersihan Gedung Multifungsi"
        .AddItem "200.01.06.e - Pegawai Soundman"
        .AddItem "200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)"
        .AddItem "200.01.08 - Pengawas Parkir Gereja (Minggu & Hari Besar)"
        .AddItem "200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan"
        .AddItem "200.02.02 - Rapat dan Pertemuan Majelis Jemaat"
        .AddItem "200.02.03 - Insentif/Lembur Pegawai"
        .AddItem "200.02.04.a - Minum & Konsumsi Kantor, Jemaat"
        .AddItem "200.02.04.b - Biaya Makan Tamu Gereja"
        .AddItem "200.02.04.c - Biaya Snack untuk Pemusik & Songleader"
        .AddItem "200.02.05 - Penyediaan Kolportase"
        .AddItem "200.02.06 - Transport, Kurir, Benda Pos"
        .AddItem "200.03.01.a - Snack dan minuman sermon penatua"
        .AddItem "200.03.01.b - Penyediaan makanan pembukaan dan penutupan sermon penatua"
        .AddItem "200.03.02 - Dana Pembinaan untuk Paduan Suara"
        .AddItem "200.03.03.a - Syukuran Awal Tahun (Jemaat & Pendeta)"
        .AddItem "200.03.03.b - Snack Kebaktian Awal Tahun Gereja"
        .AddItem "200.03.03.c - Snack Paskah dan Buha-Buha Ijuk"
        .AddItem "200.03.04 - Krans Bunga Dukacita bagi Anggota Jemaat"
        .AddItem "200.03.05 - Bantuan Dukacita bagi Anggota Jemaat"
        .AddItem "200.03.06.a - Bunga altar pada Kebaktian Minggu"
        .AddItem "200.03.06.b - Dekorasi pada Kebaktian Hari Besar Kristen"
        .AddItem "200.03.07 - Keamanan Acara Hari Besar Kristen"
        .AddItem "200.03.08.a - Kontribusi & Registrasi Peserta Rapat Pendeta"
        .AddItem "200.03.08.b - Perjalanan Dinas Peserta Rapat Pendeta (2 pendeta)"
        .AddItem "200.03.09 - Perjalanan Dinas atas undangan Kantor Pusat"
        .AddItem "200.03.10 - Sidang Umum Jemaat"
        .AddItem "200.03.11.a - Biaya Tak Terduga (Pengurusan Sertifikat Tanah)"
        .AddItem "200.03.11.b - Biaya Tak Terduga/Insidentil"
        .AddItem "200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan"
        .AddItem "200.04.02 - Inventaris Gereja"
        .AddItem "200.05.01.a - Kijang Innova, Plat BK 1757 EJ"
        .AddItem "200.05.01.b - Pajak Kendaraan Kijang Innova"
        .AddItem "200.05.02.a - HIACE BK.7866 DP"
        .AddItem "200.05.02.b - Pajak Kendaraan HIACE"
        .AddItem "200.05.03.a - Roda 2: 1 unit, Plat BK. 5440 AGG"
        .AddItem "200.05.03.b - Pajak Kendaraan Roda 2"
        .AddItem "200.06.01 - Telepon, Speedy, MyRepublik dan WA"
        .AddItem "200.07.01 - Jubah Penatua (Upah Jahit)"
        .AddItem "200.07.02 - Peralatan & Perlengkapan Inventaris Gereja"
        .AddItem "200.07.03 - Dekorasi dan Persiapan Natal"
    End With
End Sub

Private Sub LoadSubKategori400()
    With Me.cmbSubKategori
        .AddItem "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI"
        .AddItem "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota"
        .AddItem "400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota"
        .AddItem "400.01.04 - Pengkhotbah Minggu: Di Rumah Duka (Oleh Pendeta)"
        .AddItem "400.01.05 - Pengkhotbah Minggu: Remaja"
        .AddItem "400.02.01 - Pengkhotbah Kebaktian di Lingkungan (Wijk)"
        .AddItem "400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi/Remaja & GSM"
        .AddItem "400.02.03 - Pengkhotbah Kebaktian Koor Ibu-Ibu"
        .AddItem "400.02.04 - Pengkhotbah Kebaktian Ibu Hanna"
        .AddItem "400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
        .AddItem "400.03.01 - Pengkhotbah Perjanjian/Pemberkatan Nikah"
        .AddItem "400.03.02 - Pengkhotbah Penguburan Jenazah"
        .AddItem "400.03.03 - Pengkhotbah di Rumah Duka (Oleh Penatua)"
        .AddItem "400.04.01 - Minggu Pagi 08.00 WIB (@ 13 Orang)"
        .AddItem "400.04.02 - Minggu Sore: Pukul 18.00 WIB (@ 13 Orang)"
        .AddItem "400.04.03 - Sekolah Minggu dan Remaja"
        .AddItem "400.04.04 - Perjanjian/Pemberkatan Pernikahan"
        .AddItem "400.04.05 - Kebaktian pemberangkatan jenazah"
        .AddItem "400.04.06 - Minggu Di Rumah Duka"
        .AddItem "400.04.07 - Pelayanan di Rumah Duka"
        .AddItem "400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)"
        .AddItem "400.04.09 - Latihan Pemusik dan Songleader"
        .AddItem "400.04.10 - Petugas Penghitung Kebaktian Minggu"
        .AddItem "400.05.01 - Perjamuan Kudus di Gereja"
        .AddItem "400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi"
        .AddItem "400.06.01 - Perayaan HUT Jemaat"
    End With
End Sub

Private Sub LoadSubKategori600()
    With Me.cmbSubKategori
        .AddItem "600.01.01 - Pendidikan Lanjutan untuk Pendeta"
        .AddItem "600.01.02 - Penghargaan untuk Penatua"
        .AddItem "600.01.03 - Pembinaan & Pelatihan Pelajar Sidi"
        .AddItem "600.01.04 - Pembinaan Penatua se Resort Medan Barat"
        .AddItem "600.02.01 - Pembinaan & Pelayan Rohani (PPR)"
        .AddItem "600.02.02 - Pekabaran Injil"
        .AddItem "600.02.03 - Diakoni Sosial"
        .AddItem "600.02.04 - Musik, Nyanyian & Koor (MNK)"
        .AddItem "600.02.05 - Sekolah Minggu"
        .AddItem "600.02.06 - Remaja"
        .AddItem "600.02.07 - Pemuda"
        .AddItem "600.02.08 - Perempuan"
        .AddItem "600.02.09 - Pria"
        .AddItem "600.02.10 - Lansia"
        .AddItem "600.02.11 - Kesehatan"
        .AddItem "600.02.12 - Pendidikan"
        .AddItem "600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)"
        .AddItem "600.02.14 - Sarana & Prasarana"
        .AddItem "600.02.15 - Natal Gabungan Seksi-Seksi (Natal II)"
        .AddItem "600.03.01 - Target Ke Kantor Pusat GKPI"
        .AddItem "600.03.02 - Biaya Tahun Renstra GKPI 2023"
        .AddItem "600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)"
        .AddItem "600.04.01 - Target Ke GKPI Resort Medan Barat"
    End With
End Sub

Private Sub LoadSubKategori800()
    With Me.cmbSubKategori
        .AddItem "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam"
        .AddItem "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka"
        .AddItem "800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI"
        .AddItem "800.01.04 - Bantuan untuk PA. Mamre dan Yapentra"
        .AddItem "800.01.05 - Bantuan Ke GKPI Lainnya"
        .AddItem "800.01.06 - Bantuan Kepada Masyarakat di sekitar"
        .AddItem "800.02.01 - Sekolah Minggu"
        .AddItem "800.02.02 - Penatua Purna Bakti"
        .AddItem "800.02.03 - Penatua Aktif"
        .AddItem "800.02.04 - Calon Penatua Aktif"
        .AddItem "800.02.05 - Pendeta GKPI Resort Medan Barat"
        .AddItem "800.02.06 - Anggota Majelis Jemaat: Ketua Seksi & Penasehat"
        .AddItem "800.02.07 - Guru-Guru Koor di Jemaat"
        .AddItem "800.02.08 - Guru-Guru Sekolah Minggu"
        .AddItem "800.02.09 - Pemusik: Pianis, Organis dan Saxophonis"
        .AddItem "800.02.10 - Songleader"
        .AddItem "800.02.11 - Petugas Live Streaming"
    End With
End Sub

Private Sub btnSubmit_Click()
    On Error GoTo ErrorHandler
    Application.ScreenUpdating = False
    
    ' Validasi input
    If Not ValidateInputs() Then Exit Sub
    
    ' Deklarasi variabel
    Dim lastRow As Long
    Dim jumlah As Double, setor As Double
    Dim kodeSubKategori As String, uraianSubKategori As String, uraianUser As String
    Dim parts() As String
    Dim kategori As String
    Dim totalKas As Double
    
    ' Konversi nilai
    If Not ConvertValues(jumlah, setor) Then Exit Sub
    
    ' Hitung totalKas (jumlah pengeluaran + setoran)
    totalKas = jumlah + setor
    
    ' Pisahkan kode subkategori dan uraiannya
    parts = Split(Me.cmbSubKategori.Value, " - ")
    kodeSubKategori = parts(0)
    uraianSubKategori = IIf(UBound(parts) > 0, parts(1), "")
    
    ' Gunakan uraian user jika diisi, jika tidak gunakan uraian subkategori
    uraianUser = IIf(Trim(Me.txtUraian.Value) = "", uraianSubKategori, Trim(Me.txtUraian.Value))
    
    ' Cari baris kosong berikutnya
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    ' Simpan data ke worksheet
    With ws
        ' Kolom A (1): Tanggal (format dd-mmm-yy)
        .Cells(lastRow, 1).Value = CDate(Me.txtTanggal.Value)
        .Cells(lastRow, 1).NumberFormat = "dd-mmm-yy"
        
        ' Kolom B (2): Nomor Kwitansi
        .Cells(lastRow, 2).Value = Me.txtKW.Value
        
        ' Kolom C (3): Uraian
        .Cells(lastRow, 3).Value = uraianUser
        
        ' Kolom D (4): totalKas (jumlah dari F+H+J+L+M)
        .Cells(lastRow, 4).Value = totalKas
        .Cells(lastRow, 4).NumberFormat = "#,##0.00"
        
        ' Tentukan kategori yang dipilih
        kategori = Left(Me.cmbKategori.Value, 3)
        
        ' Isi kolom berdasarkan kategori
        Select Case kategori
            Case "200"
                .Cells(lastRow, 5).Value = kodeSubKategori  ' Kolom E (5)
                .Cells(lastRow, 6).Value = jumlah           ' Kolom F (6)
            Case "400"
                .Cells(lastRow, 7).Value = kodeSubKategori  ' Kolom G (7)
                .Cells(lastRow, 8).Value = jumlah           ' Kolom H (8)
            Case "600"
                .Cells(lastRow, 9).Value = kodeSubKategori  ' Kolom I (9)
                .Cells(lastRow, 10).Value = jumlah          ' Kolom J (10)
            Case "800"
                .Cells(lastRow, 11).Value = kodeSubKategori ' Kolom K (11)
                .Cells(lastRow, 12).Value = jumlah          ' Kolom L (12)
        End Select
        
        ' Kolom M (13): Setoran kas
        .Cells(lastRow, 13).Value = setor
        
        ' Format angka
        Dim col As Variant
        For Each col In Array(4, 6, 8, 10, 12, 13) ' Kolom dengan nilai uang
            .Cells(lastRow, col).NumberFormat = "#,##0.00"
        Next col
        
        ' Auto-fit kolom
        .Columns("A:M").AutoFit
    End With
    
    ' Reset form
    ResetForm
    
    ' Tampilkan pesan sukses
    MsgBox "Data berhasil disimpan di baris " & lastRow & " pada sheet '1'", vbInformation
    
ExitHandler:
    Application.ScreenUpdating = True
    Exit Sub
    
ErrorHandler:
    MsgBox "Terjadi kesalahan saat menyimpan data: " & Err.Description, vbCritical
    Resume ExitHandler
End Sub

Private Function ValidateInputs() As Boolean
    ' Validasi input wajib diisi
    If Me.txtTanggal.Value = "" Then
        MsgBox "Harap isi tanggal!", vbExclamation
        Me.txtTanggal.SetFocus
        Exit Function
    End If
    
    If Me.txtKW.Value = "" Then
        MsgBox "Harap isi nomor kwitansi!", vbExclamation
        Me.txtKW.SetFocus
        Exit Function
    End If
    
    If Me.txtJumlah.Value = "" Then
        MsgBox "Harap isi jumlah pengeluaran!", vbExclamation
        Me.txtJumlah.SetFocus
        Exit Function
    End If
    
    If Me.cmbKategori.Value = "" Then
        MsgBox "Harap pilih kategori!", vbExclamation
        Me.cmbKategori.SetFocus
        Exit Function
    End If
    
    If Me.cmbSubKategori.Value = "" Then
        MsgBox "Harap pilih sub kategori!", vbExclamation
        Me.cmbSubKategori.SetFocus
        Exit Function
    End If
    
    ValidateInputs = True
End Function

Private Function ConvertValues(ByRef jumlah As Double, ByRef setor As Double) As Boolean
    On Error GoTo ErrorHandler
    
    ' Konversi nilai jumlah (gunakan titik sebagai desimal)
    jumlah = CDbl(Replace(Me.txtJumlah.Value, ",", "."))
    
    ' Konversi nilai setor (jika ada)
    If Me.txtSetor.Value <> "" Then
        setor = CDbl(Replace(Me.txtSetor.Value, ",", "."))
    Else
        setor = 0
    End If
    
    ConvertValues = True
    Exit Function
    
ErrorHandler:
    MsgBox "Format angka tidak valid! Gunakan angka atau desimal dengan titik", vbExclamation
    ConvertValues = False
End Function

Private Sub ResetForm()
    ' Set tanggal default ke hari ini
    Me.txtTanggal.Value = Format(Date, "dd-mmm-yy")
    
    ' Kosongkan field lainnya
    ClearFormFields
End Sub

Private Sub btnCancel_Click()
    Unload Me
End Sub

Private Sub txtJumlah_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    ' Hanya izinkan input angka, titik desimal, dan backspace
    If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 46 Or KeyAscii = 8) Then
        KeyAscii = 0
        Beep
    End If
End Sub

Private Sub txtSetor_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    ' Hanya izinkan input angka, titik desimal, dan backspace
    If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 46 Or KeyAscii = 8) Then
        KeyAscii = 0
        Beep
    End If
End Sub


----------------------



16 juni program vba sheet2 dan sheet3


16 juni


sheet2:



Sub IsiComboBoxKategori()
    Dim form As Object
    On Error Resume Next
    Set form = ThisWorkbook.VBProject.VBComponents("FormPengeluaran").designer
    On Error GoTo 0
    
    If Not form Is Nothing Then
        With form.cmbKategori
            .AddItem "Persembahan"
            .AddItem "Operasional"
            .AddItem "Pelayanan"
            .AddItem "Sosial"
        End With
        
        With form.cmbSubKategori
            .AddItem "Kebaktian Umum"
            .AddItem "Kebaktian Rumah Tangga"
            .AddItem "Pembangunan"
            .AddItem "Karyawan"
            .AddItem "Listrik/Air"
            .AddItem "Bantuan Sosial"
        End With
    End If
End Sub

Sub BuatFormPengeluaran()

    Dim UF As Object
    Dim ctrl As MSForms.Control
    Dim VBComp As VBIDE.VBComponent
    Dim designer As Object
    Dim cmbKategori As MSForms.ComboBox, cmbSubKategori As MSForms.ComboBox
    
    ' Tambahkan komponen UserForm baru
    Set VBComp = ThisWorkbook.VBProject.VBComponents.Add(vbext_ct_MSForm)
    VBComp.Properties("Caption") = "Form Input Pengeluaran Jemaat"
    VBComp.Name = "FormPengeluaran"
    
    Set designer = VBComp.designer
    
    ' Fungsi bantu untuk membuat label dan textbox
    Dim top As Integer: top = 10
    Dim i As Integer
    
    Dim labelNames As Variant, ctrlNames As Variant
    labelNames = Array("Tanggal", "KW", "Uraian", "Jumlah", "Kategori", "Sub Kategori", "Setor")
    ctrlNames = Array("txtTanggal", "txtKW", "txtUraian", "txtJumlah", "cmbKategori", "cmbSubKategori", "txtSetor")
    
    For i = 0 To UBound(labelNames)
        ' Label
        With designer.Controls.Add("Forms.Label.1")
            .Caption = labelNames(i)
            .top = top
            .Left = 10
            .Width = 100
        End With
        
        ' TextBox atau ComboBox
        If Left(ctrlNames(i), 3) = "cmb" Then
            Set ctrl = designer.Controls.Add("Forms.ComboBox.1", ctrlNames(i), True)
        Else
            Set ctrl = designer.Controls.Add("Forms.TextBox.1", ctrlNames(i), True)
        End If
        With ctrl
            .top = top
            .Left = 120
            .Width = 200
        End With
        top = top + 30
    Next i
    
    ' Tombol Simpan
    With designer.Controls.Add("Forms.CommandButton.1", "btnSubmit", True)
        .Caption = "Simpan Data"
        .top = top
        .Left = 120
        .Width = 100
    End With
    
    ' Tombol Batal
    With designer.Controls.Add("Forms.CommandButton.1", "btnCancel", True)
        .Caption = "Batal"
        .top = top
        .Left = 230
        .Width = 100
    End With

    MsgBox "Form 'FormPengeluaran' berhasil dibuat. Silakan buka dari jendela UserForm.", vbInformation

End Sub
-----------------------------------

sheet3:

 
Option Explicit

Sub SalinTotalKeSheet3_Horizontal()
    ' Deklarasi semua variabel
    Dim wsSumber As Worksheet, wsTujuan As Worksheet, wsAnggaran As Worksheet
    Dim wb As Workbook
    Dim data As Variant
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Dim allBulan As Object, kategoriDict As Object, totalPerKategoriBulan As Object
    Dim totalPerKelompok As Object, totalKeseluruhanPerBulan As Object, uangSetoranDict As Object
    Dim tempTotalPerKelompok As Object, bulanCol As Object, anggaranDict As Object
    Dim allCategories As Object, allSubCategories As Object
    Dim i As Long, tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String, kelompokTotalKey As String, uniqueKey As String, totalKey As String
    Dim bulanList() As String, idx As Long, colIndex As Long, rowIndex As Long
    Dim bulanKey As Variant, key As Variant
    Dim totalUangSetoran As Double, totalSubKategori As Double, totalKategori As Double
    Dim totalKelompok As Double, totalKeseluruhan As Double
    Dim lastCol As Long
    Dim firstRowInCategory As Long
    Dim isLastKategoriInKelompok As Boolean
    Dim k As Variant, kategoriKey As Variant, subKategoriKey As Variant
    Dim sortedKategoriKeys() As Variant, sortedSubKategoriKeys() As Variant
    Dim anggaranKey As String
    Dim hasDataInGroup As Boolean
    
    ' Set workbook dan worksheet
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    Set wsAnggaran = wb.Sheets("4")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary anggaran
    Set anggaranDict = CreateObject("Scripting.Dictionary")
    If Not wsAnggaran Is Nothing Then
        Call BacaAnggaranPendapatan(wsAnggaran, anggaranDict)
    End If
    
    ' Ambil data dari sheet sumber
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    Set uangSetoranDict = CreateObject("Scripting.Dictionary")
    Set allCategories = CreateObject("Scripting.Dictionary")
    Set allSubCategories = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    ' Kumpulkan semua kategori dan subkategori dari uraianDict
    For Each key In uraianDict.keys
        ' Ambil kategori utama (6 karakter pertama)
        If Len(key) >= 6 Then
            kategori = Left(key, 6)
        Else
            kategori = key
        End If
        
        ' Tambahkan ke dictionary kategori jika belum ada
        If Not allCategories.exists(kategori) Then
            allCategories.Add kategori, Nothing
            allSubCategories.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan subkategori
        If Not allSubCategories(kategori).exists(key) Then
            allSubCategories(kategori).Add key, Nothing
        End If
    Next key
    
    ' Proses data sumber
    For i = 4 To UBound(data, 1)
        ' Ambil nilai kas dari kolom 4
        kas = 0
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Skip jika tidak ada nilai kas
        If kas = 0 Then
            GoTo NextIteration
        End If
        
        ' Ambil bulan dari tanggal (kolom 1)
        If IsDate(data(i, 1)) Then
            bulan = Format(data(i, 1), "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Tambahkan bulan ke dictionary jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0
        End If
        
        ' Identifikasi apakah ini Uang Setoran
        If IsUangSetoran(data, i) Then
            ' Proses khusus untuk Uang Setoran
            kategori = "Uang Setoran"
            kodeSub = "Uang Setoran"
            
            ' Akumulasi total Uang Setoran per bulan
            If uangSetoranDict.exists(bulan) Then
                uangSetoranDict(bulan) = uangSetoranDict(bulan) + kas
            Else
                uangSetoranDict.Add bulan, kas
            End If
        Else
            ' Proses untuk kategori lainnya
            kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
            
            ' Skip jika kode subkategori kosong
            If kodeSub = "" Then
                GoTo NextIteration
            End If
            
            ' Ambil kategori utama (6 karakter pertama)
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
            
            ' Tambahkan ke dictionary kategori jika belum ada
            If Not kategoriDict.exists(kategori) Then
                kategoriDict.Add kategori, Nothing
                subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
            End If
            
            ' Buat key unik untuk total kas
            uniqueKey = kategori & "|" & kodeSub & "|" & bulan
            
            ' Akumulasi total kas per subkategori
            If Not subKategoriDict(kategori).exists(kodeSub) Then
                subKategoriDict(kategori).Add kodeSub, Nothing
            End If

            If totalKas.exists(uniqueKey) Then
                totalKas(uniqueKey) = totalKas(uniqueKey) + kas
            Else
                totalKas.Add uniqueKey, kas
            End If
            
            ' Ambil 3 angka pertama untuk kelompok
            If Len(kodeSub) >= 3 Then
                kelompokKey = Left(kodeSub, 3)
            Else
                kelompokKey = kodeSub
            End If

            ' Akumulasi total per kelompok
            kelompokTotalKey = kelompokKey & "|" & bulan
            If totalPerKelompok.exists(kelompokTotalKey) Then
                totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
            Else
                totalPerKelompok.Add kelompokTotalKey, kas
            End If

            ' Akumulasi total per kategori
            totalKey = kategori & "|" & bulan
            If totalPerKategoriBulan.exists(totalKey) Then
                totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
            Else
                totalPerKategoriBulan.Add totalKey, kas
            End If
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan dan siapkan header
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Urutkan bulan secara kronologis
    Call BubbleSort(bulanList)
    
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    colIndex = 4
    For idx = LBound(bulanList) To UBound(bulanList)
        bulanKey = bulanList(idx)
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next idx
    
    ' Tambahkan kolom Total, Anggaran Pendapatan, dan Selisih
    wsTujuan.Cells(1, colIndex).Value = "Total"
    wsTujuan.Cells(1, colIndex + 1).Value = "Anggaran Pendapatan"
    wsTujuan.Cells(1, colIndex + 2).Value = "Selisih"
    
    ' Mulai menulis data ke sheet tujuan
    rowIndex = 2

    ' Tulis Uang Setoran terlebih dahulu jika ada
    If uangSetoranDict.Count > 0 Then
        wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalUangSetoran = 0
        
        For Each bulanKey In bulanCol.keys
            If uangSetoranDict.exists(bulanKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = uangSetoranDict(bulanKey)
                totalUangSetoran = totalUangSetoran + uangSetoranDict(bulanKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(200, 255, 200) ' Hijau muda
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        ' Tulis total
        wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(200, 255, 200)
        
        ' Kosongkan kolom anggaran pendapatan
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
        
        ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
        wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
            wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
            wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
        wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
        
        rowIndex = rowIndex + 1
    End If

    ' Proses kategori lainnya
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dari allCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
    sortedKategoriKeys = GetSortedKeys(allCategories)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Skip Uang Setoran jika sudah diproses
        If kategoriKey = "Uang Setoran" Then
            GoTo NextKategori
        End If
        
        firstRowInCategory = rowIndex

        ' Ambil kelompok dari 3 angka pertama kategori
        kelompokKey = Left(kategoriKey, 3)

        ' Inisialisasi total sementara per kelompok
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori dari allSubCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
        sortedSubKategoriKeys = GetSortedKeys(allSubCategories(kategoriKey))
        
        ' Loop melalui subkategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey
            
            ' Tambahkan uraian jika ada
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            totalSubKategori = 0
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                    
                    ' Akumulasi total kelompok
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total subkategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Hijau
            
            ' Isi kolom anggaran pendapatan jika ada data di Sheet4
            anggaranKey = subKategoriKey & "|" & bulanKey
            If anggaranDict.exists(anggaranKey) Then
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict(anggaranKey)
            Else
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
            End If
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total kategori hanya jika ada transaksi untuk kategori ini
        If kategoriDict.exists(kategoriKey) Then
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            totalKategori = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80)
            
            ' Kosongkan kolom anggaran pendapatan
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        End If

        ' Cek apakah ini kategori terakhir dalam kelompok
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            ' Hitung total kelompok dari tempTotalPerKelompok
            hasDataInGroup = False
            
            ' Cek apakah ada data dalam kelompok ini
            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    hasDataInGroup = True
                    Exit For
                End If
            Next bulanKey
            
            If hasDataInGroup Then
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                totalKelompok = 0
                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Kuning
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey

                wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0)
                
                ' Kosongkan kolom anggaran pendapatan
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
                
                ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
                wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                    wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                    wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
                wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
                
                rowIndex = rowIndex + 1
            End If
        End If
        
NextKategori:
    Next kategoriKey

    ' Tulis Total Keseluruhan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Biru
    Next bulanKey
    
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240)
    
    ' Kosongkan kolom anggaran pendapatan
    If IsEmpty(wsTujuan.Cells(rowIndex, colIndex + 1).Value) Then
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
    End If
    
    ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
    wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
        wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
        wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
    wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
    
    ' Format angka sebagai currency
    lastCol = wsTujuan.Cells(1, wsTujuan.Columns.Count).End(xlToLeft).Column
    wsTujuan.Range(wsTujuan.Cells(2, 4), wsTujuan.Cells(rowIndex, lastCol)).NumberFormat = "#,##0"
    
    ' Auto fit kolom
    wsTujuan.Columns.AutoFit
    
    MsgBox "Proses selesai. Data berhasil disalin ke Sheet 3.", vbInformation
End Sub

' Fungsi dan subrutin pendukung lainnya tetap sama seperti sebelumnya
Sub BacaAnggaranPendapatan(ws As Worksheet, dict As Object)
    Dim data As Variant
    Dim i As Long, j As Long
    Dim kodeSub As String, bulan As String
    Dim key As String
    
    data = ws.UsedRange.Value
    
    If UBound(data, 1) < 2 Or UBound(data, 2) < 4 Then Exit Sub ' Minimal header + 1 baris dan beberapa kolom

    For i = 2 To UBound(data, 1)
        If Trim(data(i, 2)) <> "" Then
            kodeSub = Trim(data(i, 2)) ' Asumsikan kolom ke-2 adalah Kode Subkategori
            
            For j = 4 To UBound(data, 2)
                If Trim(data(1, j)) <> "" Then
                    bulan = Trim(data(1, j))
                    key = kodeSub & "|" & bulan
                    If IsNumeric(data(i, j)) Then
                        dict(key) = data(i, j)
                    Else
                        dict(key) = 0
                    End If
                End If
            Next j
        End If
    Next i
End Sub

Function GetSortedKeys(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    
    ' Ambil semua kunci dari dictionary
    keys = dict.keys
    
    ' Urutkan kunci menggunakan bubble sort
    For i = LBound(keys) To UBound(keys) - 1
        For j = i + 1 To UBound(keys)
            If keys(i) > keys(j) Then
                temp = keys(i)
                keys(i) = keys(j)
                keys(j) = temp
            End If
        Next j
    Next i
    
    GetSortedKeys = keys
End Function

Function IsUangSetoran(data As Variant, rowIndex As Long) As Boolean
    ' Cek 1: Jika semua kolom kode kosong (5,7,9,11) dan kolom nilai (4) terisi
    If Trim(data(rowIndex, 5) & data(rowIndex, 7) & data(rowIndex, 9) & data(rowIndex, 11)) = "" And _
       Not IsEmpty(data(rowIndex, 4)) Then
        IsUangSetoran = True
        Exit Function
    End If
    
    ' Cek 2: Jika ada keterangan "Uang Setoran" di kolom 13
    If Not IsEmpty(data(rowIndex, 13)) Then
        If InStr(1, CStr(data(rowIndex, 13)), "Uang Setoran", vbTextCompare) > 0 Then
            IsUangSetoran = True
            Exit Function
        End If
    End If
    
    IsUangSetoran = False
End Function

Function CleanCode(kode As String) As String
    ' Hapus spasi dan karakter khusus
    Dim result As String
    Dim i As Long
    
    result = ""
    For i = 1 To Len(kode)
        Dim c As String
        c = Mid(kode, i, 1)
        
        If c Like "[0-9]" Or c Like "[a-zA-Z]" Or c = "." Then
            result = result & c
        End If
    Next i
    
    CleanCode = result
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Coba konversi ke tanggal untuk perbandingan
            Dim date1 As Date, date2 As Date
            On Error Resume Next
            date1 = CDate(arr(i))
            date2 = CDate(arr(j))
            On Error GoTo 0
            
            ' Jika bisa dikonversi ke tanggal, bandingkan sebagai tanggal
            If IsDate(arr(i)) And IsDate(arr(j)) Then
                If date1 > date2 Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika tidak, bandingkan sebagai string
                If arr(i) > arr(j) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub





------------------------------
JKN BPJS 0002445680441 password Gloria123


---------------------
7 juli 2025

formpengeluaran:

' Kode untuk FormPengeluaran (UserForm)
Option Explicit

Private Sub UserForm_Initialize()
    txtTanggal.Value = Format(Date, "dd-mmm-yy")
    txtJumlah.Value = "0"
    
    With cmbKategori
        .Clear
        .AddItem "200 - ADMINISTRASI GEREJA"
        .AddItem "400 - PELAYANAN IBADAH"
        .AddItem "600 - PEMBINAAN & PELAYANAN"
        .AddItem "800 - BANTUAN & TUNJANGAN"
    End With
    
    With cmbSubKategori
        .Clear
        .AddItem "Pilih kategori terlebih dahulu"
        .Enabled = False
        If .ListCount > 0 Then .ListIndex = 0
    End With
End Sub

Private Sub cmbKategori_Change()
    On Error Resume Next ' Hindari error jika ListIndex invalid
    cmbSubKategori.Clear
    cmbSubKategori.Enabled = True
    
    ' Pastikan ada item sebelum set ListIndex
    Select Case cmbKategori.Value
        Case "200 - ADMINISTRASI GEREJA"
            ' Subkategori untuk ADMINISTRASI GEREJA
            cmbSubKategori.AddItem "200.01.01 - Pendeta Pimpinan Jemaat"
            cmbSubKategori.AddItem "200.01.02 - Vicaris dan Pendeta Khusus"
            cmbSubKategori.AddItem "200.01.03 - Guru Jemaat"
            cmbSubKategori.AddItem "200.01.04 - Sekretaris dan Bendahara Jemaat"
            cmbSubKategori.AddItem "200.01.05.a - Pegawai Kantor (Administrasi): 2 orang"
            cmbSubKategori.AddItem "200.01.06.a - Pegawai Kebersihan Gedung Gereja: 1 orang"
            cmbSubKategori.AddItem "200.01.06.b - Pegawai Kebersihan Pekarangan Gereja: 1 orang"
            cmbSubKategori.AddItem "200.01.06.c1 - Pegawai Supir Mobil Dinas & Ambulance"
            cmbSubKategori.AddItem "200.01.06.c2 - Pegawai Jaga Malam"
            cmbSubKategori.AddItem "200.01.06.d - Pegawai Kebersihan Gedung Multifungsi"
            cmbSubKategori.AddItem "200.01.06.e - Pegawai Soundman"
            cmbSubKategori.AddItem "200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)"
            cmbSubKategori.AddItem "200.01.08 - Pengawas Parkir Gereja (Minggu & Hari Besar)"
            cmbSubKategori.AddItem "200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan"
            cmbSubKategori.AddItem "200.02.02 - Rapat dan Pertemuan Majelis Jemaat"
            cmbSubKategori.AddItem "200.02.03 - Insentif/Lembur Pegawai"
            cmbSubKategori.AddItem "200.02.04.a - Minum & Konsumsi Kantor, Jemaat"
            cmbSubKategori.AddItem "200.02.04.b - Biaya Makan Tamu Gereja"
            cmbSubKategori.AddItem "200.02.04.c - Biaya Snack untuk Pemusik & Songleader"
            cmbSubKategori.AddItem "200.02.05 - Penyediaan Kolportase"
            cmbSubKategori.AddItem "200.02.06 - Transport, Kurir, Benda Pos"
            cmbSubKategori.AddItem "200.03.01.a - Snack dan minuman sermon penatua"
            cmbSubKategori.AddItem "200.03.01.b - Penyediaan makanan pembukaan dan penutupan sermon penatua"
            cmbSubKategori.AddItem "200.03.02 - Dana Pembinaan untuk Paduan Suara"
            cmbSubKategori.AddItem "200.03.03.a - Syukuran Awal Tahun (Jemaat & Pendeta)"
            cmbSubKategori.AddItem "200.03.03.b - Snack Kebaktian Awal Tahun Gereja"
            cmbSubKategori.AddItem "200.03.03.c - Snack Paskah dan Buha-Buha Ijuk"
            cmbSubKategori.AddItem "200.03.04 - Krans Bunga Dukacita bagi Anggota Jemaat"
            cmbSubKategori.AddItem "200.03.05 - Bantuan Dukacita bagi Anggota Jemaat"
            cmbSubKategori.AddItem "200.03.06.a - Bunga altar pada Kebaktian Minggu"
            cmbSubKategori.AddItem "200.03.06.b - Dekorasi pada Kebaktian Hari Besar Kristen"
            cmbSubKategori.AddItem "200.03.07 - Keamanan Acara Hari Besar Kristen"
            cmbSubKategori.AddItem "200.03.08.a - Kontribusi & Registrasi Peserta Rapat Pendeta"
            cmbSubKategori.AddItem "200.03.08.b - Perjalanan Dinas Peserta Rapat Pendeta (2 pendeta)"
            cmbSubKategori.AddItem "200.03.09 - Perjalanan Dinas atas undangan Kantor Pusat"
            cmbSubKategori.AddItem "200.03.10 - Sidang Umum Jemaat"
            cmbSubKategori.AddItem "200.03.11.a - Biaya Tak Terduga (Pengurusan Sertifikat Tanah)"
            cmbSubKategori.AddItem "200.03.11.b - Biaya Tak Terduga/Insidentil"
            cmbSubKategori.AddItem "200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan"
            cmbSubKategori.AddItem "200.04.02 - Inventaris Gereja"
            cmbSubKategori.AddItem "200.05.01.a - Kijang Innova, Plat BK 1757 EJ"
            cmbSubKategori.AddItem "200.05.01.b - Pajak Kendaraan Kijang Innova"
            cmbSubKategori.AddItem "200.05.02.a - HIACE BK.7866 DP"
            cmbSubKategori.AddItem "200.05.02.b - Pajak Kendaraan HIACE"
            cmbSubKategori.AddItem "200.05.03.a - Roda 2: 1 unit, Plat BK. 5440 AGG"
            cmbSubKategori.AddItem "200.05.03.b - Pajak Kendaraan Roda 2"
            cmbSubKategori.AddItem "200.06.01 - Telepon, Speedy, MyRepublik dan WA"
            cmbSubKategori.AddItem "200.07.01 - Jubah Penatua (Upah Jahit)"
            cmbSubKategori.AddItem "200.07.02 - Peralatan & Perlengkapan Inventaris Gereja"
            cmbSubKategori.AddItem "200.07.03 - Dekorasi dan Persiapan Natal"
            
        Case "400 - PELAYANAN IBADAH"
            ' Subkategori untuk PELAYANAN IBADAH
            cmbSubKategori.AddItem "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI"
            cmbSubKategori.AddItem "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota"
            cmbSubKategori.AddItem "400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota"
            cmbSubKategori.AddItem "400.01.04 - Pengkhotbah Minggu: Di Rumah Duka (Oleh Pendeta)"
            cmbSubKategori.AddItem "400.01.05 - Pengkhotbah Minggu: Remaja"
            cmbSubKategori.AddItem "400.02.01 - Pengkhotbah Kebaktian di Lingkungan (Wijk)"
            cmbSubKategori.AddItem "400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi/Remaja & GSM"
            cmbSubKategori.AddItem "400.02.03 - Pengkhotbah Kebaktian Koor Ibu-Ibu"
            cmbSubKategori.AddItem "400.02.04 - Pengkhotbah Kebaktian Ibu Hanna"
            cmbSubKategori.AddItem "400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
            cmbSubKategori.AddItem "400.03.01 - Pengkhotbah Perjanjian/Pemberkatan Nikah"
            cmbSubKategori.AddItem "400.03.02 - Pengkhotbah Penguburan Jenazah"
            cmbSubKategori.AddItem "400.03.03 - Pengkhotbah di Rumah Duka (Oleh Penatua)"
            cmbSubKategori.AddItem "400.04.01 - Minggu Pagi 08.00 WIB (@ 13 Orang)"
            cmbSubKategori.AddItem "400.04.02 - Minggu Sore: Pukul 18.00 WIB (@ 13 Orang)"
            cmbSubKategori.AddItem "400.04.03 - Sekolah Minggu dan Remaja"
            cmbSubKategori.AddItem "400.04.04 - Perjanjian/Pemberkatan Pernikahan"
            cmbSubKategori.AddItem "400.04.05 - Kebaktian pemberangkatan jenazah"
            cmbSubKategori.AddItem "400.04.06 - Minggu Di Rumah Duka"
            cmbSubKategori.AddItem "400.04.07 - Pelayanan di Rumah Duka"
            cmbSubKategori.AddItem "400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)"
            cmbSubKategori.AddItem "400.04.09 - Latihan Pemusik dan Songleader"
            cmbSubKategori.AddItem "400.04.10 - Petugas Penghitung Kebaktian Minggu"
            cmbSubKategori.AddItem "400.05.01 - Perjamuan Kudus di Gereja"
            cmbSubKategori.AddItem "400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi"
            cmbSubKategori.AddItem "400.06.01 - Perayaan HUT Jemaat"
            
        Case "600 - PEMBINAAN & PELAYANAN"
            ' Subkategori untuk PEMBINAAN & PELAYANAN
            cmbSubKategori.AddItem "600.01.01 - Pendidikan Lanjutan untuk Pendeta"
            cmbSubKategori.AddItem "600.01.02 - Penghargaan untuk Penatua"
            cmbSubKategori.AddItem "600.01.03 - Pembinaan & Pelatihan Pelajar Sidi"
            cmbSubKategori.AddItem "600.01.04 - Pembinaan Penatua se Resort Medan Barat"
            cmbSubKategori.AddItem "600.02.01 - Pembinaan & Pelayan Rohani (PPR)"
            cmbSubKategori.AddItem "600.02.02 - Pekabaran Injil"
            cmbSubKategori.AddItem "600.02.03 - Diakoni Sosial"
            cmbSubKategori.AddItem "600.02.04 - Musik, Nyanyian & Koor (MNK)"
            cmbSubKategori.AddItem "600.02.05 - Sekolah Minggu"
            cmbSubKategori.AddItem "600.02.06 - Remaja"
            cmbSubKategori.AddItem "600.02.07 - Pemuda"
            cmbSubKategori.AddItem "600.02.08 - Perempuan"
            cmbSubKategori.AddItem "600.02.09 - Pria"
            cmbSubKategori.AddItem "600.02.10 - Lansia"
            cmbSubKategori.AddItem "600.02.11 - Kesehatan"
            cmbSubKategori.AddItem "600.02.12 - Pendidikan"
            cmbSubKategori.AddItem "600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)"
            cmbSubKategori.AddItem "600.02.14 - Sarana & Prasarana"
            cmbSubKategori.AddItem "600.02.15 - Natal Gabungan Seksi-Seksi (Natal II)"
            cmbSubKategori.AddItem "600.03.01 - Target Ke Kantor Pusat GKPI"
            cmbSubKategori.AddItem "600.03.02 - Biaya Tahun Renstra GKPI 2023"
            cmbSubKategori.AddItem "600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)"
            cmbSubKategori.AddItem "600.04.01 - Target Ke GKPI Resort Medan Barat"
            
        Case "800 - BANTUAN & TUNJANGAN"
            ' Subkategori untuk BANTUAN & TUNJANGAN
            cmbSubKategori.AddItem "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam"
            cmbSubKategori.AddItem "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka"
            cmbSubKategori.AddItem "800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI"
            cmbSubKategori.AddItem "800.01.04 - Bantuan untuk PA. Mamre dan Yapentra"
            cmbSubKategori.AddItem "800.01.05 - Bantuan Ke GKPI Lainnya"
            cmbSubKategori.AddItem "800.01.06 - Bantuan Kepada Masyarakat di sekitar"
            cmbSubKategori.AddItem "800.02.01 - Sekolah Minggu"
            cmbSubKategori.AddItem "800.02.02 - Penatua Purna Bakti"
            cmbSubKategori.AddItem "800.02.03 - Penatua Aktif"
            cmbSubKategori.AddItem "800.02.04 - Calon Penatua Aktif"
            cmbSubKategori.AddItem "800.02.05 - Pendeta GKPI Resort Medan Barat"
            cmbSubKategori.AddItem "800.02.06 - Anggota Majelis Jemaat: Ketua Seksi & Penasehat"
            cmbSubKategori.AddItem "800.02.07 - Guru-Guru Koor di Jemaat"
            cmbSubKategori.AddItem "800.02.08 - Guru-Guru Sekolah Minggu"
            cmbSubKategori.AddItem "800.02.09 - Pemusik: Pianis, Organis dan Saxophonis"
            cmbSubKategori.AddItem "800.02.10 - Songleader"
            cmbSubKategori.AddItem "800.02.11 - Petugas Live Streaming"
    End Select
    
    ' Hanya set ListIndex jika ada item
    If cmbSubKategori.ListCount > 0 Then
        cmbSubKategori.ListIndex = 0
    Else
        cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
        cmbSubKategori.Enabled = False
        cmbSubKategori.ListIndex = 0
    End If
    On Error GoTo 0
End Sub

Private Sub btnSubmit_Click()
    On Error GoTo ErrorHandler
    
    ' Proses penyimpanan data ke worksheet
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim selectedKategori As String
    Dim kategoriKolom As String
    Dim nominalKolom As String
    Dim jumlah As Double
    
    ' Validasi input
    If Not ValidasiInput() Then Exit Sub
    
    Set ws = ThisWorkbook.Sheets("1")
    
    ' Ambil nilai dari form
    selectedKategori = left(cmbKategori.Value, 3) ' Ambil 3 digit pertama (200, 400, etc)
    jumlah = CDbl(txtJumlah.Value)
    
    ' Tentukan kolom target berdasarkan kategori
    Select Case selectedKategori
        Case "200"
            kategoriKolom = "E"
            nominalKolom = "F"
        Case "400"
            kategoriKolom = "G"
            nominalKolom = "H"
        Case "600"
            kategoriKolom = "I"
            nominalKolom = "J"
        Case "800"
            kategoriKolom = "K"
            nominalKolom = "L"
    End Select
    
    ' Cari baris terakhir
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row + 1
    
    ' Isi data ke sheet
    With ws
        ' Kolom dasar
        .Cells(lastRow, "A").Value = CDate(txtTanggal.Value) ' Tanggal
        .Cells(lastRow, "B").Value = txtKW.Value ' Nomor KW
        .Cells(lastRow, "C").Value = txtUraian.Value ' Uraian
        .Cells(lastRow, "D").Value = jumlah ' Kredit (Kas Keluar)
        
        ' Isi berdasarkan kategori
        .Cells(lastRow, kategoriKolom).Value = cmbSubKategori.Value ' Kode Anggaran
        .Cells(lastRow, nominalKolom).Value = jumlah ' Nominal
        
        ' Keterangan tambahan
        .Cells(lastRow, "M").Value = txtSetor.Value
    End With
    
    ' Bersihkan form setelah simpan
    BersihkanForm
    MsgBox "Data pengeluaran berhasil disimpan!", vbInformation
    
    Exit Sub
    
ErrorHandler:
    If Err.Number = 380 Then
        MsgBox "Silakan pilih subkategori yang valid", vbExclamation
        cmbSubKategori.SetFocus
    Else
        MsgBox "Error " & Err.Number & ": " & Err.Description, vbCritical
    End If
End Sub

Private Function ValidasiInput() As Boolean
    ValidasiInput = False
    
    ' Validasi tanggal
    If Not IsDate(txtTanggal.Value) Then
        MsgBox "Format tanggal tidak valid. Gunakan format DD-MMM-YY", vbExclamation
        txtTanggal.SetFocus
        Exit Function
    End If
    
    ' Validasi KW
    If Trim(txtKW.Value) = "" Then
        MsgBox "Nomor KW harus diisi", vbExclamation
        txtKW.SetFocus
        Exit Function
    End If
    
    ' Validasi uraian
    If Trim(txtUraian.Value) = "" Then
        MsgBox "Uraian pengeluaran harus diisi", vbExclamation
        txtUraian.SetFocus
        Exit Function
    End If
    
    ' Validasi jumlah
    If Not IsNumeric(txtJumlah.Value) Or CDbl(txtJumlah.Value) <= 0 Then
        MsgBox "Jumlah pengeluaran harus angka dan lebih dari 0", vbExclamation
        txtJumlah.SetFocus
        Exit Function
    End If
    
    ' Validasi kategori
    If cmbKategori.ListIndex = -1 Then
        MsgBox "Silakan pilih kategori pengeluaran", vbExclamation
        cmbKategori.SetFocus
        Exit Function
    End If
    
    ' Validasi sub kategori
    If cmbSubKategori.ListIndex = -1 Then
        MsgBox "Silakan pilih sub kategori", vbExclamation
        cmbSubKategori.SetFocus
        Exit Function
    End If
    
    ValidasiInput = True
End Function

Private Sub BersihkanForm()
    ' Reset semua input kecuali tanggal
    txtKW.Value = ""
    txtUraian.Value = ""
    txtJumlah.Value = "0"
    cmbKategori.ListIndex = -1
    cmbSubKategori.Clear
    cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
    cmbSubKategori.Enabled = False
    cmbSubKategori.ListIndex = 0
    txtSetor.Value = ""
End Sub

Private Sub btnCancel_Click()
    Unload Me
End Sub

Private Sub txtJumlah_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    ' Hanya memperbolehkan input angka dan backspace
    If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 8 Or KeyAscii = 46) Then
        KeyAscii = 0
        Beep
    End If
End Sub


----------------------------------
module 1 cetak form:


Sub BuatFormPengeluaran()

    Dim UF As Object
    Dim ctrl As MSForms.Control
    Dim VBComp As VBIDE.VBComponent
    Dim designer As Object
    Dim cmbKategori As MSForms.ComboBox, cmbSubKategori As MSForms.ComboBox
    
    ' Tambahkan komponen UserForm baru
    Set VBComp = ThisWorkbook.VBProject.VBComponents.Add(vbext_ct_MSForm)
    VBComp.Properties("Caption") = "Form Input Pengeluaran Jemaat"
    VBComp.name = "FormPengeluaran"
    
    Set designer = VBComp.designer
    
    ' Fungsi bantu untuk membuat label dan textbox
    Dim top As Integer: top = 10
    Dim i As Integer
    
    ' Array untuk label dan kontrol
    Dim labelNames As Variant, ctrlNames As Variant, ctrlTypes As Variant
    labelNames = Array("Tanggal", "KW", "Uraian", "Jumlah", "Kategori", "Sub Kategori", "Setor")
    ctrlNames = Array("txtTanggal", "txtKW", "txtUraian", "txtJumlah", "cmbKategori", "cmbSubKategori", "txtSetor")
    ctrlTypes = Array("textbox", "textbox", "textbox", "textbox", "combobox", "combobox", "textbox")
    
    ' Tambahkan default value untuk tanggal
    Dim defaultTanggal As String
    defaultTanggal = Format(Date, "dd-mmm-yy")
    
    For i = 0 To UBound(labelNames)
        ' Label
        With designer.controls.Add("Forms.Label.1")
            .caption = labelNames(i)
            .top = top
            .left = 10
            .width = 100
            .height = 20
        End With
        
        ' Kontrol input
        Select Case ctrlTypes(i)
            Case "combobox"
                Set ctrl = designer.controls.Add("Forms.ComboBox.1", ctrlNames(i), True)
                With ctrl
                    .top = top
                    .left = 120
                    .width = 200
                    .height = 20
                    .Style = 2 ' Dropdown style
                End With
                
                ' Tambahkan contoh item untuk combobox
                If ctrlNames(i) = "cmbKategori" Then
                    ctrl.AddItem "Operasional"
                    ctrl.AddItem "Sosial"
                    ctrl.AddItem "Perlengkapan"
                    ctrl.AddItem "Kegiatan"
                ElseIf ctrlNames(i) = "cmbSubKategori" Then
                    ctrl.AddItem "Pilih kategori terlebih dahulu"
                End If
                
            Case Else ' textbox
                Set ctrl = designer.controls.Add("Forms.TextBox.1", ctrlNames(i), True)
                With ctrl
                    .top = top
                    .left = 120
                    .width = 200
                    .height = 20
                End With
                
                ' Set default value untuk tanggal
                If ctrlNames(i) = "txtTanggal" Then
                    ctrl.Text = defaultTanggal
                End If
        End Select
        
        top = top + 30
    Next i
    
    ' Tombol Simpan
    With designer.controls.Add("Forms.CommandButton.1", "btnSubmit", True)
        .caption = "Simpan Data"
        .top = top + 10
        .left = 120
        .width = 100
        .height = 25
        .Accelerator = "S"
    End With
    
    ' Tombol Batal
    With designer.controls.Add("Forms.CommandButton.1", "btnCancel", True)
        .caption = "Batal"
        .top = top + 10
        .left = 230
        .width = 100
        .height = 25
        .Accelerator = "B"
    End With
    
    ' Set form properties
    With VBComp.Properties
        .Item("Width") = 350
        .Item("Height") = top + 80
        .Item("StartUpPosition") = 1 ' CenterScreen
    End With
    
    MsgBox "Form 'FormPengeluaran' berhasil dibuat. Silakan buka dari jendela UserForm.", vbInformation

End Sub



_----------------------------
module 2
Sub TampilkanFormPengeluaran()
    FormPengeluaran.Show
End Sub



--------------------------------

email timothyronald1756@gmail.com password lupuslupus 



-------------------------------
11 juli

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MAIN MODULE  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                 ‚îÇ FormPengeluaran‚îÇ
        ‚îÇ                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                          ‚îÇ
        ‚îÇ                          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Initialize Form
        ‚îÇ                          ‚îÇ
        ‚îÇ                          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Kategori Change Handler
        ‚îÇ                          ‚îÇ
        ‚îÇ                          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Submit Button (Save to Sheet1)
        ‚îÇ                          ‚îÇ
        ‚îÇ                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Cancel Button
        ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                 ‚îÇ  Proses Data   ‚îÇ
        ‚îÇ                 ‚îÇ (Sheet1‚ÜíSheet2)‚îÇ
        ‚îÇ                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                          ‚îÇ
        ‚îÇ                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Copy & Format Data
        ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ Generate Report‚îÇ
                          ‚îÇ (Sheet1‚ÜíSheet3)‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚îÇ
                                   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Process by Category/Subcategory
                                   ‚îÇ
                                   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Calculate Totals
                                   ‚îÇ
                                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Format Output

============================================



25junicatatanprogram:


formpengeluaran:

' Kode untuk FormPengeluaran (UserForm)
Option Explicit

Private Sub UserForm_Initialize()
    txtTanggal.Value = Format(Date, "dd-mmm-yy")
        txtJumlah.Value = "0"
            
                With cmbKategori
                        .Clear
                                .AddItem "200 - ADMINISTRASI GEREJA"
                                        .AddItem "400 - PELAYANAN IBADAH"
                                                .AddItem "600 - PEMBINAAN & PELAYANAN"
                                                        .AddItem "800 - BANTUAN & TUNJANGAN"
                                                            End With
                                                                
                                                                    With cmbSubKategori
                                                                            .Clear
                                                                                    .AddItem "Pilih kategori terlebih dahulu"
                                                                                            .Enabled = False
                                                                                                    If .ListCount > 0 Then .ListIndex = 0
                                                                                                        End With
                                                                                                        End Sub

                                                                                                        Private Sub cmbKategori_Change()
                                                                                                            On Error Resume Next ' Hindari error jika ListIndex invalid
                                                                                                                cmbSubKategori.Clear
                                                                                                                    cmbSubKategori.Enabled = True
                                                                                                                        
                                                                                                                            ' Pastikan ada item sebelum set ListIndex
                                                                                                                                Select Case cmbKategori.Value
                                                                                                                                        Case "200 - ADMINISTRASI GEREJA"
                                                                                                                                                    ' Subkategori untuk ADMINISTRASI GEREJA
                                                                                                                                                                cmbSubKategori.AddItem "200.01.01 - Pendeta Pimpinan Jemaat"
                                                                                                                                                                            cmbSubKategori.AddItem "200.01.02 - Vicaris dan Pendeta Khusus"
                                                                                                                                                                                        cmbSubKategori.AddItem "200.01.03 - Guru Jemaat"
                                                                                                                                                                                                    cmbSubKategori.AddItem "200.01.04 - Sekretaris dan Bendahara Jemaat"
                                                                                                                                                                                                                cmbSubKategori.AddItem "200.01.05.a - Pegawai Kantor (Administrasi): 2 orang"
                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.01.06.a - Pegawai Kebersihan Gedung Gereja: 1 orang"
                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.01.06.b - Pegawai Kebersihan Pekarangan Gereja: 1 orang"
                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.01.06.c1 - Pegawai Supir Mobil Dinas & Ambulance"
                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.01.06.c2 - Pegawai Jaga Malam"
                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.01.06.d - Pegawai Kebersihan Gedung Multifungsi"
                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.01.06.e - Pegawai Soundman"
                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)"
                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.01.08 - Pengawas Parkir Gereja (Minggu & Hari Besar)"
                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan"
                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.02.02 - Rapat dan Pertemuan Majelis Jemaat"
                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.02.03 - Insentif/Lembur Pegawai"
                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.02.04.a - Minum & Konsumsi Kantor, Jemaat"
                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.02.04.b - Biaya Makan Tamu Gereja"
                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.02.04.c - Biaya Snack untuk Pemusik & Songleader"
                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.02.05 - Penyediaan Kolportase"
                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.02.06 - Transport, Kurir, Benda Pos"
                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.03.01.a - Snack dan minuman sermon penatua"
                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.03.01.b - Penyediaan makanan pembukaan dan penutupan sermon penatua"
                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.03.02 - Dana Pembinaan untuk Paduan Suara"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.03.03.a - Syukuran Awal Tahun (Jemaat & Pendeta)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.03.03.b - Snack Kebaktian Awal Tahun Gereja"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.03.03.c - Snack Paskah dan Buha-Buha Ijuk"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.03.04 - Krans Bunga Dukacita bagi Anggota Jemaat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.03.05 - Bantuan Dukacita bagi Anggota Jemaat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.03.06.a - Bunga altar pada Kebaktian Minggu"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.03.06.b - Dekorasi pada Kebaktian Hari Besar Kristen"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.03.07 - Keamanan Acara Hari Besar Kristen"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.03.08.a - Kontribusi & Registrasi Peserta Rapat Pendeta"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.03.08.b - Perjalanan Dinas Peserta Rapat Pendeta (2 pendeta)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.03.09 - Perjalanan Dinas atas undangan Kantor Pusat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.03.10 - Sidang Umum Jemaat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.03.11.a - Biaya Tak Terduga (Pengurusan Sertifikat Tanah)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.03.11.b - Biaya Tak Terduga/Insidentil"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.04.02 - Inventaris Gereja"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.05.01.a - Kijang Innova, Plat BK 1757 EJ"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.05.01.b - Pajak Kendaraan Kijang Innova"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.05.02.a - HIACE BK.7866 DP"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.05.02.b - Pajak Kendaraan HIACE"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.05.03.a - Roda 2: 1 unit, Plat BK. 5440 AGG"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.05.03.b - Pajak Kendaraan Roda 2"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "200.06.01 - Telepon, Speedy, MyRepublik dan WA"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "200.07.01 - Jubah Penatua (Upah Jahit)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "200.07.02 - Peralatan & Perlengkapan Inventaris Gereja"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "200.07.03 - Dekorasi dan Persiapan Natal"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Case "400 - PELAYANAN IBADAH"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ' Subkategori untuk PELAYANAN IBADAH
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "400.01.04 - Pengkhotbah Minggu: Di Rumah Duka (Oleh Pendeta)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "400.01.05 - Pengkhotbah Minggu: Remaja"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "400.02.01 - Pengkhotbah Kebaktian di Lingkungan (Wijk)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi/Remaja & GSM"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "400.02.03 - Pengkhotbah Kebaktian Koor Ibu-Ibu"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "400.02.04 - Pengkhotbah Kebaktian Ibu Hanna"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "400.03.01 - Pengkhotbah Perjanjian/Pemberkatan Nikah"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "400.03.02 - Pengkhotbah Penguburan Jenazah"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "400.03.03 - Pengkhotbah di Rumah Duka (Oleh Penatua)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "400.04.01 - Minggu Pagi 08.00 WIB (@ 13 Orang)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "400.04.02 - Minggu Sore: Pukul 18.00 WIB (@ 13 Orang)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "400.04.03 - Sekolah Minggu dan Remaja"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "400.04.04 - Perjanjian/Pemberkatan Pernikahan"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "400.04.05 - Kebaktian pemberangkatan jenazah"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "400.04.06 - Minggu Di Rumah Duka"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "400.04.07 - Pelayanan di Rumah Duka"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "400.04.09 - Latihan Pemusik dan Songleader"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "400.04.10 - Petugas Penghitung Kebaktian Minggu"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "400.05.01 - Perjamuan Kudus di Gereja"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "400.06.01 - Perayaan HUT Jemaat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Case "600 - PEMBINAAN & PELAYANAN"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ' Subkategori untuk PEMBINAAN & PELAYANAN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "600.01.01 - Pendidikan Lanjutan untuk Pendeta"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "600.01.02 - Penghargaan untuk Penatua"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "600.01.03 - Pembinaan & Pelatihan Pelajar Sidi"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "600.01.04 - Pembinaan Penatua se Resort Medan Barat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "600.02.01 - Pembinaan & Pelayan Rohani (PPR)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "600.02.02 - Pekabaran Injil"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "600.02.03 - Diakoni Sosial"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "600.02.04 - Musik, Nyanyian & Koor (MNK)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "600.02.05 - Sekolah Minggu"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "600.02.06 - Remaja"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "600.02.07 - Pemuda"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "600.02.08 - Perempuan"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "600.02.09 - Pria"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "600.02.10 - Lansia"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "600.02.11 - Kesehatan"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "600.02.12 - Pendidikan"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "600.02.14 - Sarana & Prasarana"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "600.02.15 - Natal Gabungan Seksi-Seksi (Natal II)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "600.03.01 - Target Ke Kantor Pusat GKPI"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "600.03.02 - Biaya Tahun Renstra GKPI 2023"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "600.04.01 - Target Ke GKPI Resort Medan Barat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Case "800 - BANTUAN & TUNJANGAN"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ' Subkategori untuk BANTUAN & TUNJANGAN
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "800.01.04 - Bantuan untuk PA. Mamre dan Yapentra"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "800.01.05 - Bantuan Ke GKPI Lainnya"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "800.01.06 - Bantuan Kepada Masyarakat di sekitar"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "800.02.01 - Sekolah Minggu"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "800.02.02 - Penatua Purna Bakti"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "800.02.03 - Penatua Aktif"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "800.02.04 - Calon Penatua Aktif"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "800.02.05 - Pendeta GKPI Resort Medan Barat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "800.02.06 - Anggota Majelis Jemaat: Ketua Seksi & Penasehat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "800.02.07 - Guru-Guru Koor di Jemaat"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.AddItem "800.02.08 - Guru-Guru Sekolah Minggu"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.AddItem "800.02.09 - Pemusik: Pianis, Organis dan Saxophonis"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "800.02.10 - Songleader"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "800.02.11 - Petugas Live Streaming"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        End Select
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Hanya set ListIndex jika ada item
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    If cmbSubKategori.ListCount > 0 Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.ListIndex = 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.Enabled = False
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.ListIndex = 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                On Error GoTo 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End Sub

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Private Sub cmbSubKategori_Change()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ' Ambil hanya teks setelah tanda strip (-)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Dim fullText As String
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Dim posDash As Integer
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                fullText = cmbSubKategori.Value
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    posDash = InStr(fullText, "-")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        If posDash > 0 Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                txtUraian.Value = Trim(Mid(fullText, posDash + 1))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            txtUraian.Value = fullText
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End Sub

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Private Sub btnSubmit_Click()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    On Error GoTo ErrorHandler
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ' Proses penyimpanan data ke worksheet
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Dim ws As Worksheet
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Dim lastRow As Long
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Dim selectedKategori As String
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Dim kategoriKolom As String
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Dim nominalKolom As String
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Dim jumlah As Double
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ' Validasi input
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                If Not ValidasiInput() Then Exit Sub
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Set ws = ThisWorkbook.Sheets("Sheet1")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Ambil nilai dari form
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    selectedKategori = left(cmbKategori.Value, 3) ' Ambil 3 digit pertama (200, 400, etc)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Dim setor As Double
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            If IsNumeric(txtSetor.Value) And Trim(txtSetor.Value) <> "" Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setor = CDbl(txtSetor.Value)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setor = 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        jumlah = CDbl(txtJumlah.Value) + setor
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Tentukan kolom target berdasarkan kategori
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Select Case selectedKategori
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Case "200"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        kategoriKolom = "E"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    nominalKolom = "F"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Case "400"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        kategoriKolom = "G"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    nominalKolom = "H"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Case "600"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        kategoriKolom = "I"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    nominalKolom = "J"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Case "800"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        kategoriKolom = "K"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    nominalKolom = "L"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        End Select
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Cari baris terakhir
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row + 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ' Isi data ke sheet
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                With ws
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ' Kolom dasar
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                .Cells(lastRow, "A").Value = CDate(txtTanggal.Value) ' Tanggal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .Cells(lastRow, "A").NumberFormat = "dd-mmm-yy"      ' Format tampilan tanggal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                .Cells(lastRow, "B").Value = txtKW.Value ' Nomor KW
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .Cells(lastRow, "C").Value = txtUraian.Value ' Uraian
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                .Cells(lastRow, "D").Value = jumlah ' Kredit (Kas Keluar)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Isi berdasarkan kategori
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .Cells(lastRow, kategoriKolom).Value = cmbSubKategori.Value ' Kode Anggaran
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                .Cells(lastRow, nominalKolom).Value = CDbl(txtJumlah.Value) ' Nominal kategori saja
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Keterangan tambahan
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        .Cells(lastRow, "M").Value = txtSetor.Value
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            End With
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ' Bersihkan form setelah simpan
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        BersihkanForm
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            MsgBox "Data pengeluaran berhasil disimpan!", vbInformation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Exit Sub
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ErrorHandler:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            If Err.Number = 380 Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    MsgBox "Silakan pilih subkategori yang valid", vbExclamation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.SetFocus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        MsgBox "Error " & Err.Number & ": " & Err.Description, vbCritical
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            End Sub

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Private Function ValidasiInput() As Boolean
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ValidasiInput = False
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ' Validasi tanggal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            If Not IsDate(txtTanggal.Value) Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    MsgBox "Format tanggal tidak valid. Gunakan format DD-MMM-YY", vbExclamation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            txtTanggal.SetFocus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Exit Function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Validasi KW
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    If Trim(txtKW.Value) = "" Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            MsgBox "Nomor KW harus diisi", vbExclamation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    txtKW.SetFocus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Exit Function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ' Validasi uraian
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            If Trim(txtUraian.Value) = "" Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    MsgBox "Uraian pengeluaran harus diisi", vbExclamation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            txtUraian.SetFocus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Exit Function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Validasi jumlah
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    If Not IsNumeric(txtJumlah.Value) Or CDbl(txtJumlah.Value) <= 0 Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            MsgBox "Jumlah pengeluaran harus angka dan lebih dari 0", vbExclamation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    txtJumlah.SetFocus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Exit Function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ' Validasi kategori
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            If cmbKategori.ListIndex = -1 Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    MsgBox "Silakan pilih kategori pengeluaran", vbExclamation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbKategori.SetFocus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Exit Function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ' Validasi sub kategori
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    If cmbSubKategori.ListIndex = -1 Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            MsgBox "Silakan pilih sub kategori", vbExclamation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.SetFocus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Exit Function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ValidasiInput = True
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        End Function

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Private Sub BersihkanForm()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ' Reset semua input kecuali tanggal
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                txtKW.Value = ""
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    txtUraian.Value = ""
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        txtJumlah.Value = "0"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbKategori.ListIndex = -1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cmbSubKategori.Clear
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cmbSubKategori.Enabled = False
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cmbSubKategori.ListIndex = 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                txtSetor.Value = ""
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End Sub

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Private Sub btnCancel_Click()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Unload Me
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    End Sub

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Private Sub txtJumlah_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ' Hanya memperbolehkan input angka dan backspace
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 8 Or KeyAscii = 46) Then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    KeyAscii = 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Beep
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End If
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                End Sub


----------------------------------
module 1 cetak form:


Sub BuatFormPengeluaran()

    Dim UF As Object
    Dim ctrl As MSForms.Control
    Dim VBComp As VBIDE.VBComponent
    Dim designer As Object
    Dim cmbKategori As MSForms.ComboBox, cmbSubKategori As MSForms.ComboBox
    
    ' Tambahkan komponen UserForm baru
    Set VBComp = ThisWorkbook.VBProject.VBComponents.Add(vbext_ct_MSForm)
    VBComp.Properties("Caption") = "Form Input Pengeluaran Jemaat"
    VBComp.name = "FormPengeluaran"
    
    Set designer = VBComp.designer
    
    ' Fungsi bantu untuk membuat label dan textbox
    Dim top As Integer: top = 10
    Dim i As Integer
    
    ' Array untuk label dan kontrol
    Dim labelNames As Variant, ctrlNames As Variant, ctrlTypes As Variant
    labelNames = Array("Tanggal", "KW", "Uraian", "Jumlah", "Kategori", "Sub Kategori", "Setor")
    ctrlNames = Array("txtTanggal", "txtKW", "txtUraian", "txtJumlah", "cmbKategori", "cmbSubKategori", "txtSetor")
    ctrlTypes = Array("textbox", "textbox", "textbox", "textbox", "combobox", "combobox", "textbox")
    
    ' Tambahkan default value untuk tanggal
    Dim defaultTanggal As String
    defaultTanggal = Format(Date, "dd-mmm-yy")
    
    For i = 0 To UBound(labelNames)
        ' Label
        With designer.controls.Add("Forms.Label.1")
            .caption = labelNames(i)
            .top = top
            .left = 10
            .width = 100
            .height = 20
        End With
        
        ' Kontrol input
        Select Case ctrlTypes(i)
            Case "combobox"
                Set ctrl = designer.controls.Add("Forms.ComboBox.1", ctrlNames(i), True)
                With ctrl
                    .top = top
                    .left = 120
                    .width = 200
                    .height = 20
                    .Style = 2 ' Dropdown style
                End With
                
                ' Tambahkan contoh item untuk combobox
                If ctrlNames(i) = "cmbKategori" Then
                    ctrl.AddItem "Operasional"
                    ctrl.AddItem "Sosial"
                    ctrl.AddItem "Perlengkapan"
                    ctrl.AddItem "Kegiatan"
                ElseIf ctrlNames(i) = "cmbSubKategori" Then
                    ctrl.AddItem "Pilih kategori terlebih dahulu"
                End If
                
            Case Else ' textbox
                Set ctrl = designer.controls.Add("Forms.TextBox.1", ctrlNames(i), True)
                With ctrl
                    .top = top
                    .left = 120
                    .width = 200
                    .height = 20
                End With
                
                ' Set default value untuk tanggal
                If ctrlNames(i) = "txtTanggal" Then
                    ctrl.Text = defaultTanggal
                End If
        End Select
        
        top = top + 30
    Next i
    
    ' Tombol Simpan
    With designer.controls.Add("Forms.CommandButton.1", "btnSubmit", True)
        .caption = "Simpan Data"
        .top = top + 10
        .left = 120
        .width = 100
        .height = 25
        .Accelerator = "S"
    End With
    
    ' Tombol Batal
    With designer.controls.Add("Forms.CommandButton.1", "btnCancel", True)
        .caption = "Batal"
        .top = top + 10
        .left = 230
        .width = 100
        .height = 25
        .Accelerator = "B"
    End With
    
    ' Set form properties
    With VBComp.Properties
        .Item("Width") = 350
        .Item("Height") = top + 80
        .Item("StartUpPosition") = 1 ' CenterScreen
    End With
    
    MsgBox "Form 'FormPengeluaran' berhasil dibuat. Silakan buka dari jendela UserForm.", vbInformation

End Sub



_----------------------------
module 2
Sub TampilkanFormPengeluaran()
    FormPengeluaran.Show
End Sub



--------------------------------------

ini choice tampilan menu 

Sub MainMenu()
    Dim choice As String
    choice = InputBox("Pilih menu:" & vbCrLf & _
                     "1. Buat Form Pengeluaran" & vbCrLf & _
                     "2. Tampilkan Form Pengeluaran" & vbCrLf & _
                     "3. Kelompokkan Data" & vbCrLf & _
                     "4. Keluar", "Menu Utama", "1")
    
    Select Case choice
        Case "1"
            Call BuatFormPengeluaran
        Case "2"
            Call TampilkanFormPengeluaran
        Case "3"
            Call kelompokkanData_Terstruktur
        Case "4"
            ' Keluar
        Case Else
            MsgBox "Pilihan tidak valid", vbExclamation
    End Select
End Sub

 --------------------------------------
 14juli

 ' Kode untuk FormPengeluaran (UserForm)
Option Explicit

Private Sub UserForm_Initialize()
    txtTanggal.Value = Format(Date, "dd-mmm-yy")
    txtJumlah.Value = "0"
    
    With cmbKategori
        .Clear
        .AddItem "200 - ADMINISTRASI GEREJA"
        .AddItem "400 - PELAYANAN IBADAH"
        .AddItem "600 - PEMBINAAN & PELAYANAN"
        .AddItem "800 - BANTUAN & TUNJANGAN"
    End With
    
    With cmbSubKategori
        .Clear
        .AddItem "Pilih kategori terlebih dahulu"
        .Enabled = False
        If .ListCount > 0 Then .ListIndex = 0
    End With
End Sub

Private Sub cmbKategori_Change()
    On Error Resume Next ' Hindari error jika ListIndex invalid
    cmbSubKategori.Clear
    cmbSubKategori.Enabled = True
    
    ' Pastikan ada item sebelum set ListIndex
    Select Case cmbKategori.Value
        Case "200 - ADMINISTRASI GEREJA"
            ' Subkategori untuk ADMINISTRASI GEREJA
            cmbSubKategori.AddItem "200.01.01 - Pendeta Pimpinan Jemaat"
            cmbSubKategori.AddItem "200.01.02 - Vicaris dan Pendeta Khusus"
            cmbSubKategori.AddItem "200.01.03 - Guru Jemaat"
            cmbSubKategori.AddItem "200.01.04 - Sekretaris dan Bendahara Jemaat"
            cmbSubKategori.AddItem "200.01.05.a - Pegawai Kantor (Administrasi): 2 orang"
            cmbSubKategori.AddItem "200.01.06.a - Pegawai Kebersihan Gedung Gereja: 1 orang"
            cmbSubKategori.AddItem "200.01.06.b - Pegawai Kebersihan Pekarangan Gereja: 1 orang"
            cmbSubKategori.AddItem "200.01.06.c1 - Pegawai Supir Mobil Dinas & Ambulance"
            cmbSubKategori.AddItem "200.01.06.c2 - Pegawai Jaga Malam"
            cmbSubKategori.AddItem "200.01.06.d - Pegawai Kebersihan Gedung Multifungsi"
            cmbSubKategori.AddItem "200.01.06.e - Pegawai Soundman"
            cmbSubKategori.AddItem "200.01.07 - Administrasi Guru Sekolah Minggu (dan Remaja)"
            cmbSubKategori.AddItem "200.01.08 - Pengawas Parkir Gereja (Minggu & Hari Besar)"
            cmbSubKategori.AddItem "200.02.01 - Alat Tulis Kantor, Penggandaan dan Cetakan"
            cmbSubKategori.AddItem "200.02.02 - Rapat dan Pertemuan Majelis Jemaat"
            cmbSubKategori.AddItem "200.02.03 - Insentif/Lembur Pegawai"
            cmbSubKategori.AddItem "200.02.04.a - Minum & Konsumsi Kantor, Jemaat"
            cmbSubKategori.AddItem "200.02.04.b - Biaya Makan Tamu Gereja"
            cmbSubKategori.AddItem "200.02.04.c - Biaya Snack untuk Pemusik & Songleader"
            cmbSubKategori.AddItem "200.02.05 - Penyediaan Kolportase"
            cmbSubKategori.AddItem "200.02.06 - Transport, Kurir, Benda Pos"
            cmbSubKategori.AddItem "200.03.01.a - Snack dan minuman sermon penatua"
            cmbSubKategori.AddItem "200.03.01.b - Penyediaan makanan pembukaan dan penutupan sermon penatua"
            cmbSubKategori.AddItem "200.03.02 - Dana Pembinaan untuk Paduan Suara"
            cmbSubKategori.AddItem "200.03.03.a - Syukuran Awal Tahun (Jemaat & Pendeta)"
            cmbSubKategori.AddItem "200.03.03.b - Snack Kebaktian Awal Tahun Gereja"
            cmbSubKategori.AddItem "200.03.03.c - Snack Paskah dan Buha-Buha Ijuk"
            cmbSubKategori.AddItem "200.03.04 - Krans Bunga Dukacita bagi Anggota Jemaat"
            cmbSubKategori.AddItem "200.03.05 - Bantuan Dukacita bagi Anggota Jemaat"
            cmbSubKategori.AddItem "200.03.06.a - Bunga altar pada Kebaktian Minggu"
            cmbSubKategori.AddItem "200.03.06.b - Dekorasi pada Kebaktian Hari Besar Kristen"
            cmbSubKategori.AddItem "200.03.07 - Keamanan Acara Hari Besar Kristen"
            cmbSubKategori.AddItem "200.03.08.a - Kontribusi & Registrasi Peserta Rapat Pendeta"
            cmbSubKategori.AddItem "200.03.08.b - Perjalanan Dinas Peserta Rapat Pendeta (2 pendeta)"
            cmbSubKategori.AddItem "200.03.09 - Perjalanan Dinas atas undangan Kantor Pusat"
            cmbSubKategori.AddItem "200.03.10 - Sidang Umum Jemaat"
            cmbSubKategori.AddItem "200.03.11.a - Biaya Tak Terduga (Pengurusan Sertifikat Tanah)"
            cmbSubKategori.AddItem "200.03.11.b - Biaya Tak Terduga/Insidentil"
            cmbSubKategori.AddItem "200.04.01 - Gedung Gereja, Rumah Dinas & Pekarangan"
            cmbSubKategori.AddItem "200.04.02 - Inventaris Gereja"
            cmbSubKategori.AddItem "200.05.01.a - Kijang Innova, Plat BK 1757 EJ"
            cmbSubKategori.AddItem "200.05.01.b - Pajak Kendaraan Kijang Innova"
            cmbSubKategori.AddItem "200.05.02.a - HIACE BK.7866 DP"
            cmbSubKategori.AddItem "200.05.02.b - Pajak Kendaraan HIACE"
            cmbSubKategori.AddItem "200.05.03.a - Roda 2: 1 unit, Plat BK. 5440 AGG"
            cmbSubKategori.AddItem "200.05.03.b - Pajak Kendaraan Roda 2"
            cmbSubKategori.AddItem "200.06.01 - Telepon, Speedy, MyRepublik dan WA"
            cmbSubKategori.AddItem "200.07.01 - Jubah Penatua (Upah Jahit)"
            cmbSubKategori.AddItem "200.07.02 - Peralatan & Perlengkapan Inventaris Gereja"
            cmbSubKategori.AddItem "200.07.03 - Dekorasi dan Persiapan Natal"
            
        Case "400 - PELAYANAN IBADAH"
            ' Subkategori untuk PELAYANAN IBADAH
            cmbSubKategori.AddItem "400.01.01 - Pengkhotbah Minggu: Pimpinan Pusat GKPI"
            cmbSubKategori.AddItem "400.01.02 - Pengkhotbah Minggu: Dari Luar Kota"
            cmbSubKategori.AddItem "400.01.03 - Pengkhotbah Minggu: Dari Dalam Kota"
            cmbSubKategori.AddItem "400.01.04 - Pengkhotbah Minggu: Di Rumah Duka (Oleh Pendeta)"
            cmbSubKategori.AddItem "400.01.05 - Pengkhotbah Minggu: Remaja"
            cmbSubKategori.AddItem "400.02.01 - Pengkhotbah Kebaktian di Lingkungan (Wijk)"
            cmbSubKategori.AddItem "400.02.02 - Pengkhotbah Kebaktian Pemuda-Pemudi/Remaja & GSM"
            cmbSubKategori.AddItem "400.02.03 - Pengkhotbah Kebaktian Koor Ibu-Ibu"
            cmbSubKategori.AddItem "400.02.04 - Pengkhotbah Kebaktian Ibu Hanna"
            cmbSubKategori.AddItem "400.02.05 - Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"
            cmbSubKategori.AddItem "400.03.01 - Pengkhotbah Perjanjian/Pemberkatan Nikah"
            cmbSubKategori.AddItem "400.03.02 - Pengkhotbah Penguburan Jenazah"
            cmbSubKategori.AddItem "400.03.03 - Pengkhotbah di Rumah Duka (Oleh Penatua)"
            cmbSubKategori.AddItem "400.04.01 - Minggu Pagi 08.00 WIB (@ 13 Orang)"
            cmbSubKategori.AddItem "400.04.02 - Minggu Sore: Pukul 18.00 WIB (@ 13 Orang)"
            cmbSubKategori.AddItem "400.04.03 - Sekolah Minggu dan Remaja"
            cmbSubKategori.AddItem "400.04.04 - Perjanjian/Pemberkatan Pernikahan"
            cmbSubKategori.AddItem "400.04.05 - Kebaktian pemberangkatan jenazah"
            cmbSubKategori.AddItem "400.04.06 - Minggu Di Rumah Duka"
            cmbSubKategori.AddItem "400.04.07 - Pelayanan di Rumah Duka"
            cmbSubKategori.AddItem "400.04.08 - Guru Sekolah Minggu (Sermon & Mengajar)"
            cmbSubKategori.AddItem "400.04.09 - Latihan Pemusik dan Songleader"
            cmbSubKategori.AddItem "400.04.10 - Petugas Penghitung Kebaktian Minggu"
            cmbSubKategori.AddItem "400.05.01 - Perjamuan Kudus di Gereja"
            cmbSubKategori.AddItem "400.05.02 - Snack Ujian Tulisan & Lisan Pelajar Sidi"
            cmbSubKategori.AddItem "400.06.01 - Perayaan HUT Jemaat"
            
        Case "600 - PEMBINAAN & PELAYANAN"
            ' Subkategori untuk PEMBINAAN & PELAYANAN
            cmbSubKategori.AddItem "600.01.01 - Pendidikan Lanjutan untuk Pendeta"
            cmbSubKategori.AddItem "600.01.02 - Penghargaan untuk Penatua"
            cmbSubKategori.AddItem "600.01.03 - Pembinaan & Pelatihan Pelajar Sidi"
            cmbSubKategori.AddItem "600.01.04 - Pembinaan Penatua se Resort Medan Barat"
            cmbSubKategori.AddItem "600.02.01 - Pembinaan & Pelayan Rohani (PPR)"
            cmbSubKategori.AddItem "600.02.02 - Pekabaran Injil"
            cmbSubKategori.AddItem "600.02.03 - Diakoni Sosial"
            cmbSubKategori.AddItem "600.02.04 - Musik, Nyanyian & Koor (MNK)"
            cmbSubKategori.AddItem "600.02.05 - Sekolah Minggu"
            cmbSubKategori.AddItem "600.02.06 - Remaja"
            cmbSubKategori.AddItem "600.02.07 - Pemuda"
            cmbSubKategori.AddItem "600.02.08 - Perempuan"
            cmbSubKategori.AddItem "600.02.09 - Pria"
            cmbSubKategori.AddItem "600.02.10 - Lansia"
            cmbSubKategori.AddItem "600.02.11 - Kesehatan"
            cmbSubKategori.AddItem "600.02.12 - Pendidikan"
            cmbSubKategori.AddItem "600.02.13 - Usaha & Pengembangan Sumber Daya (UPSD)"
            cmbSubKategori.AddItem "600.02.14 - Sarana & Prasarana"
            cmbSubKategori.AddItem "600.02.15 - Natal Gabungan Seksi-Seksi (Natal II)"
            cmbSubKategori.AddItem "600.03.01 - Target Ke Kantor Pusat GKPI"
            cmbSubKategori.AddItem "600.03.02 - Biaya Tahun Renstra GKPI 2023"
            cmbSubKategori.AddItem "600.03.03 - Kantor Sinode GKPI (Persembahan Kedua)"
            cmbSubKategori.AddItem "600.04.01 - Target Ke GKPI Resort Medan Barat"
            
        Case "800 - BANTUAN & TUNJANGAN"
            ' Subkategori untuk BANTUAN & TUNJANGAN
            cmbSubKategori.AddItem "800.01.01 - Bantuan ke Jemaat untuk musibah/bencana alam"
            cmbSubKategori.AddItem "800.01.02 - Akomodasi Acara Penghiburan Ke Rumah Duka"
            cmbSubKategori.AddItem "800.01.03 - Bantuan untuk Dana Pensiun Pendeta GKPI"
            cmbSubKategori.AddItem "800.01.04 - Bantuan untuk PA. Mamre dan Yapentra"
            cmbSubKategori.AddItem "800.01.05 - Bantuan Ke GKPI Lainnya"
            cmbSubKategori.AddItem "800.01.06 - Bantuan Kepada Masyarakat di sekitar"
            cmbSubKategori.AddItem "800.02.01 - Sekolah Minggu"
            cmbSubKategori.AddItem "800.02.02 - Penatua Purna Bakti"
            cmbSubKategori.AddItem "800.02.03 - Penatua Aktif"
            cmbSubKategori.AddItem "800.02.04 - Calon Penatua Aktif"
            cmbSubKategori.AddItem "800.02.05 - Pendeta GKPI Resort Medan Barat"
            cmbSubKategori.AddItem "800.02.06 - Anggota Majelis Jemaat: Ketua Seksi & Penasehat"
            cmbSubKategori.AddItem "800.02.07 - Guru-Guru Koor di Jemaat"
            cmbSubKategori.AddItem "800.02.08 - Guru-Guru Sekolah Minggu"
            cmbSubKategori.AddItem "800.02.09 - Pemusik: Pianis, Organis dan Saxophonis"
            cmbSubKategori.AddItem "800.02.10 - Songleader"
            cmbSubKategori.AddItem "800.02.11 - Petugas Live Streaming"
    End Select
    
    ' Hanya set ListIndex jika ada item
    If cmbSubKategori.ListCount > 0 Then
        cmbSubKategori.ListIndex = 0
    Else
        cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
        cmbSubKategori.Enabled = False
        cmbSubKategori.ListIndex = 0
    End If
    On Error GoTo 0
End Sub

Private Sub cmbSubKategori_Change()
    ' Ambil hanya teks setelah tanda strip (-)
    Dim fullText As String
    Dim posDash As Integer
    fullText = cmbSubKategori.Value
    posDash = InStr(fullText, "-")
    If posDash > 0 Then
        txtUraian.Value = Trim(Mid(fullText, posDash + 1))
    Else
        txtUraian.Value = fullText
    End If
End Sub

Private Sub btnSubmit_Click()
    On Error GoTo ErrorHandler
    
    ' Proses penyimpanan data ke worksheet
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim selectedKategori As String
    Dim kategoriKolom As String
    Dim nominalKolom As String
    Dim jumlah As Double
    
    ' Validasi input
    If Not ValidasiInput() Then Exit Sub
    
    Set ws = ThisWorkbook.Sheets("1")
    
    ' Ambil nilai dari form
    selectedKategori = Left(cmbKategori.Value, 3) ' Ambil 3 digit pertama (200, 400, etc)
    Dim setor As Double
    If IsNumeric(txtSetor.Value) And Trim(txtSetor.Value) <> "" Then
        setor = CDbl(txtSetor.Value)
    Else
        setor = 0
    End If
    jumlah = CDbl(txtJumlah.Value) + setor
    
    ' Tentukan kolom target berdasarkan kategori
    Select Case selectedKategori
        Case "200"
            kategoriKolom = "E"
            nominalKolom = "F"
        Case "400"
            kategoriKolom = "G"
            nominalKolom = "H"
        Case "600"
            kategoriKolom = "I"
            nominalKolom = "J"
        Case "800"
            kategoriKolom = "K"
            nominalKolom = "L"
    End Select
    
    ' Cari baris terakhir
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row + 1
    
    ' Isi data ke sheet
    With ws
        ' Kolom dasar
        .Cells(lastRow, "A").Value = CDate(txtTanggal.Value) ' Tanggal
        .Cells(lastRow, "A").NumberFormat = "dd-mmm-yy"      ' Format tampilan tanggal
        .Cells(lastRow, "B").Value = txtKW.Value ' Nomor KW
        .Cells(lastRow, "C").Value = txtUraian.Value ' Uraian
        .Cells(lastRow, "D").Value = jumlah ' Kredit (Kas Keluar)
        
        ' Isi berdasarkan kategori
        .Cells(lastRow, kategoriKolom).Value = cmbSubKategori.Value ' Kode Anggaran
        .Cells(lastRow, nominalKolom).Value = CDbl(txtJumlah.Value) ' Nominal kategori saja
        
        ' Keterangan tambahan
        .Cells(lastRow, "M").Value = txtSetor.Value
    End With
    
    ' Bersihkan form setelah simpan
    BersihkanForm
    
    ' Jalankan proses pengelompokan data
    Application.ScreenUpdating = False ' Nonaktifkan update layar untuk mempercepat proses
    Call SalinTotalKeSheet3_Horizontal
    Call kelompokkanData_Terstruktur
    Application.ScreenUpdating = True ' Aktifkan kembali update layar
    
    MsgBox "Data pengeluaran berhasil disimpan dan laporan telah diperbarui!", vbInformation
    
    Exit Sub
    
ErrorHandler:
    Application.ScreenUpdating = True ' Pastikan screen updating diaktifkan kembali jika terjadi error
    If Err.Number = 380 Then
        MsgBox "Silakan pilih subkategori yang valid", vbExclamation
        cmbSubKategori.SetFocus
    Else
        MsgBox "Error " & Err.Number & ": " & Err.Description, vbCritical
    End If
End Sub

Private Function ValidasiInput() As Boolean
    ValidasiInput = False
    
    ' Validasi tanggal
    If Not IsDate(txtTanggal.Value) Then
        MsgBox "Format tanggal tidak valid. Gunakan format DD-MMM-YY", vbExclamation
        txtTanggal.SetFocus
        Exit Function
    End If
    
    ' Validasi KW
    If Trim(txtKW.Value) = "" Then
        MsgBox "Nomor KW harus diisi", vbExclamation
        txtKW.SetFocus
        Exit Function
    End If
    
    ' Validasi uraian
    If Trim(txtUraian.Value) = "" Then
        MsgBox "Uraian pengeluaran harus diisi", vbExclamation
        txtUraian.SetFocus
        Exit Function
    End If
    
    ' Validasi jumlah
    If Not IsNumeric(txtJumlah.Value) Or CDbl(txtJumlah.Value) <= 0 Then
        MsgBox "Jumlah pengeluaran harus angka dan lebih dari 0", vbExclamation
        txtJumlah.SetFocus
        Exit Function
    End If
    
    ' Validasi kategori
    If cmbKategori.ListIndex = -1 Then
        MsgBox "Silakan pilih kategori pengeluaran", vbExclamation
        cmbKategori.SetFocus
        Exit Function
    End If
    
    ' Validasi sub kategori
    If cmbSubKategori.ListIndex = -1 Then
        MsgBox "Silakan pilih sub kategori", vbExclamation
        cmbSubKategori.SetFocus
        Exit Function
    End If
    
    ValidasiInput = True
End Function

Private Sub BersihkanForm()
    ' Reset semua input kecuali tanggal
    txtKW.Value = ""
    txtUraian.Value = ""
    txtJumlah.Value = "0"
    cmbKategori.ListIndex = -1
    cmbSubKategori.Clear
    cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
    cmbSubKategori.Enabled = False
    cmbSubKategori.ListIndex = 0
    txtSetor.Value = ""
End Sub

Private Sub btnCancel_Click()
    Unload Me
End Sub

Private Sub txtJumlah_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    ' Hanya memperbolehkan input angka dan backspace
    If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 8 Or KeyAscii = 46) Then
        KeyAscii = 0
        Beep
    End If
End Sub
-----------------------------


module 1 cetak form:


Sub BuatFormPengeluaran()

    Dim UF As Object
    Dim ctrl As MSForms.Control
    Dim VBComp As VBIDE.VBComponent
    Dim designer As Object
    Dim cmbKategori As MSForms.ComboBox, cmbSubKategori As MSForms.ComboBox
    
    ' Tambahkan komponen UserForm baru
    Set VBComp = ThisWorkbook.VBProject.VBComponents.Add(vbext_ct_MSForm)
    VBComp.Properties("Caption") = "Form Input Pengeluaran Jemaat"
    VBComp.name = "FormPengeluaran"
    
    Set designer = VBComp.designer
    
    ' Fungsi bantu untuk membuat label dan textbox
    Dim top As Integer: top = 10
    Dim i As Integer
    
    ' Array untuk label dan kontrol
    Dim labelNames As Variant, ctrlNames As Variant, ctrlTypes As Variant
    labelNames = Array("Tanggal", "KW", "Uraian", "Jumlah", "Kategori", "Sub Kategori", "Setor")
    ctrlNames = Array("txtTanggal", "txtKW", "txtUraian", "txtJumlah", "cmbKategori", "cmbSubKategori", "txtSetor")
    ctrlTypes = Array("textbox", "textbox", "textbox", "textbox", "combobox", "combobox", "textbox")
    
    ' Tambahkan default value untuk tanggal
    Dim defaultTanggal As String
    defaultTanggal = Format(Date, "dd-mmm-yy")
    
    For i = 0 To UBound(labelNames)
        ' Label
        With designer.controls.Add("Forms.Label.1")
            .caption = labelNames(i)
            .top = top
            .left = 10
            .width = 100
            .height = 20
        End With
        
        ' Kontrol input
        Select Case ctrlTypes(i)
            Case "combobox"
                Set ctrl = designer.controls.Add("Forms.ComboBox.1", ctrlNames(i), True)
                With ctrl
                    .top = top
                    .left = 120
                    .width = 200
                    .height = 20
                    .Style = 2 ' Dropdown style
                End With
                
                ' Tambahkan contoh item untuk combobox
                If ctrlNames(i) = "cmbKategori" Then
                    ctrl.AddItem "Operasional"
                    ctrl.AddItem "Sosial"
                    ctrl.AddItem "Perlengkapan"
                    ctrl.AddItem "Kegiatan"
                ElseIf ctrlNames(i) = "cmbSubKategori" Then
                    ctrl.AddItem "Pilih kategori terlebih dahulu"
                End If
                
            Case Else ' textbox
                Set ctrl = designer.controls.Add("Forms.TextBox.1", ctrlNames(i), True)
                With ctrl
                    .top = top
                    .left = 120
                    .width = 200
                    .height = 20
                End With
                
                ' Set default value untuk tanggal
                If ctrlNames(i) = "txtTanggal" Then
                    ctrl.Text = defaultTanggal
                End If
        End Select
        
        top = top + 30
    Next i
    
    ' Tombol Simpan
    With designer.controls.Add("Forms.CommandButton.1", "btnSubmit", True)
        .caption = "Simpan Data"
        .top = top + 10
        .left = 120
        .width = 100
        .height = 25
        .Accelerator = "S"
    End With
    
    ' Tombol Batal
    With designer.controls.Add("Forms.CommandButton.1", "btnCancel", True)
        .caption = "Batal"
        .top = top + 10
        .left = 230
        .width = 100
        .height = 25
        .Accelerator = "B"
    End With
    
    ' Set form properties
    With VBComp.Properties
        .Item("Width") = 350
        .Item("Height") = top + 80
        .Item("StartUpPosition") = 1 ' CenterScreen
    End With
    
    MsgBox "Form 'FormPengeluaran' berhasil dibuat. Silakan buka dari jendela UserForm.", vbInformation

End Sub



_----------------------------
module 2
Sub TampilkanFormPengeluaran()
    FormPengeluaran.Show
End Sub




















Sub kelompokkanData_Terstruktur()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook

    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("2")
    On Error GoTo 0

    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '2' tersedia."
        Exit Sub
    End If

    ' Cek jika ada data
    Dim lastRow As Long
    lastRow = wsSumber.Cells(wsSumber.Rows.Count, 1).End(xlUp).Row
    If lastRow < 4 Then
        MsgBox "Tidak ada data untuk diproses."
        Exit Sub
    End If

    ' Baca data
    Dim data As Variant
    data = wsSumber.Range("A1:L" & lastRow).Value

    ' Inisialisasi dictionary untuk pengelompokan
    Dim kelompok As Object
    Set kelompok = CreateObject("Scripting.Dictionary")

    ' Variabel untuk loop
    Dim i As Long
    Dim tgl As Variant, kwitansi As Variant, uraian As Variant, kas As Variant
    Dim kodeSub As String, bulan As String
    Dim isUangSetoran As Boolean

    ' Membaca data dan kelompokkan
    For i = 4 To UBound(data, 1)
        ' Baca data dasar
        tgl = data(i, 1)
        kwitansi = data(i, 2)
        uraian = data(i, 3)
        kas = data(i, 4)
        
        ' Tentukan bulan
        If IsDate(tgl) And tgl <> "" Then
            bulan = Format(tgl, "MMMM YYYY")
        Else
            bulan = "Tanggal Tidak Valid"
        End If

        ' Cek kriteria Uang Setoran
        isUangSetoran = False
        If IsNumeric(kas) And kas <> "" Then
            If Trim(data(i, 5)) = "" And Trim(data(i, 7)) = "" And _
               Trim(data(i, 9)) = "" And Trim(data(i, 11)) = "" Then
                isUangSetoran = True
            End If
        End If

        ' Tentukan kode subkategori
        If isUangSetoran Then
            kodeSub = "Uang Setoran"
        Else
            ' Gabungkan kode subkategori jika ada
            kodeSub = Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11))
            kodeSub = WorksheetFunction.Trim(kodeSub)
            If kodeSub = "" Then kodeSub = "Lainnya"
        End If

        ' Tambahkan ke dictionary
        If Not kelompok.Exists(bulan) Then
            kelompok.Add bulan, CreateObject("Scripting.Dictionary")
        End If

        If Not kelompok(bulan).Exists(kodeSub) Then
            kelompok(bulan).Add kodeSub, New Collection
        End If

        ' Tambahkan data ke collection
        kelompok(bulan)(kodeSub).Add Array(tgl, kwitansi, uraian, kas, kodeSub)
    Next i

    ' Bersihkan sheet tujuan
    wsTujuan.Cells.Clear

    ' Mulai tulis hasil ke Sheet2
    Dim startRow As Long, startCol As Long
    startCol = 1
    Dim colSpacing As Long: colSpacing = 3

    ' Urutkan bulan
    Dim bulanKeys() As Variant
    bulanKeys = kelompok.keys
    Call BubbleSort(bulanKeys)

    ' Loop melalui setiap bulan
    Dim bulanKey As Variant, kodeSubKey As Variant
    For Each bulanKey In bulanKeys
        startRow = 1
        
        ' Tulis header bulan
        With wsTujuan.Cells(startRow, startCol)
            .Value = UCase(bulanKey)
            .Font.bold = True
            .Font.Size = 12
        End With
        startRow = startRow + 1

        ' Urutkan kode subkategori
        Dim kodeSubKeys() As Variant
        ReDim kodeSubKeys(kelompok(bulanKey).Count - 1)
        
        Dim k As Long: k = 0
        For Each kodeSubKey In kelompok(bulanKey).keys
            kodeSubKeys(k) = kodeSubKey
            k = k + 1
        Next kodeSubKey
        
        Call BubbleSort(kodeSubKeys)

        ' Loop melalui setiap kode subkategori
        For Each kodeSubKey In kodeSubKeys
            ' Tulis header subkategori
            With wsTujuan.Cells(startRow, startCol)
                .Value = "Subkategori: " & kodeSubKey
                .Font.bold = True
            End With
            startRow = startRow + 1
            
            ' Tulis header kolom
            With wsTujuan.Cells(startRow, startCol).Resize(1, 5)
                .Value = Array("Tanggal", "Kwitansi", "Uraian", "Kas", "Kode Subkategori")
                .Font.bold = True
                .Borders(xlEdgeBottom).LineStyle = xlContinuous
            End With
            startRow = startRow + 1

            ' Tulis data
            Dim dataItem As Variant
            Dim totalKas As Double: totalKas = 0
            Dim r As Long: r = 0
            
            For Each dataItem In kelompok(bulanKey)(kodeSubKey)
                ' Pastikan ini array
                If IsArray(dataItem) Then
                    ' Tulis data dengan format
                    With wsTujuan.Cells(startRow + r, startCol)
                        .Value = dataItem(0) ' Tanggal
                        .NumberFormat = "dd-mmm-yyyy"
                    End With
                    
                    With wsTujuan.Cells(startRow + r, startCol + 1)
                        .Value = dataItem(1) ' Kwitansi
                    End With
                    
                    ' Kolom Uraian - dibatasi lebar dan wrap text
                    With wsTujuan.Cells(startRow + r, startCol + 2)
                        .Value = dataItem(2) ' Uraian
                        .WrapText = True
                        .ColumnWidth = 30 ' Lebar kolom uraian 30 karakter
                        .Rows.RowHeight = 15 ' Tinggi baris disesuaikan
                    End With
                    
                    ' Kolom Kas
                    With wsTujuan.Cells(startRow + r, startCol + 3)
                        If IsNumeric(dataItem(3)) Then
                            .Value = dataItem(3)
                            .NumberFormat = "#,##0"
                            totalKas = totalKas + CDbl(dataItem(3))
                        Else
                            .Value = dataItem(3)
                        End If
                    End With
                    
                    ' Kode Subkategori
                    With wsTujuan.Cells(startRow + r, startCol + 4)
                        .Value = dataItem(4)
                    End With
                    
                    r = r + 1
                End If
            Next dataItem

            ' Tulis total kas
            startRow = startRow + r
            With wsTujuan.Cells(startRow, startCol)
                .Value = "Total Kas " & kodeSubKey
                .Font.bold = True
            End With
            With wsTujuan.Cells(startRow, startCol + 3)
                .Value = totalKas
                .NumberFormat = "#,##0"
                .Font.bold = True
                .Borders(xlEdgeTop).LineStyle = xlContinuous
            End With
            startRow = startRow + 2
        Next kodeSubKey

        ' Geser ke kolom berikutnya
        startCol = startCol + 6 + colSpacing
    Next bulanKey

    ' Format kolom secara spesifik
    Dim lastCol As Long
    lastCol = wsTujuan.Cells.Find("*", , xlFormulas, , xlByColumns, xlPrevious).Column
    
    For i = 1 To lastCol
        Select Case i Mod (6 + colSpacing)
            Case 1 ' Kolom Tanggal
                wsTujuan.Columns(i).ColumnWidth = 12
            Case 2 ' Kolom Kwitansi
                wsTujuan.Columns(i).ColumnWidth = 15
            Case 3 ' Kolom Uraian (sudah diatur sebelumnya)
                ' Tidak perlu diubah lagi
            Case 4 ' Kolom Kas
                wsTujuan.Columns(i).ColumnWidth = 15
            Case 5 ' Kolom Kode Subkategori
                wsTujuan.Columns(i).ColumnWidth = 20
            Case Else ' Kolom kosong antar kelompok
                wsTujuan.Columns(i).ColumnWidth = 3
        End Select
    Next i

    MsgBox "Pengelompokan data selesai dengan tampilan yang rapi."
End Sub

Sub BubbleSort(arr() As Variant)
    Dim i As Long, j As Long
    Dim temp As Variant
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(i) > arr(j) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub







Sub SalinTotalKeSheet3_Horizontal()
    ' Deklarasi semua variabel
    Dim wsSumber As Worksheet, wsTujuan As Worksheet, wsAnggaran As Worksheet
    Dim wb As Workbook
    Dim data As Variant
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Dim allBulan As Object, kategoriDict As Object, totalPerKategoriBulan As Object
    Dim totalPerKelompok As Object, totalKeseluruhanPerBulan As Object, uangSetoranDict As Object
    Dim tempTotalPerKelompok As Object, bulanCol As Object, anggaranDict As Object
    Dim allCategories As Object, allSubCategories As Object
    Dim i As Long, tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String, kelompokTotalKey As String, uniqueKey As String, totalKey As String
    Dim bulanList() As String, idx As Long, colIndex As Long, rowIndex As Long
    Dim bulanKey As Variant, key As Variant
    Dim totalUangSetoran As Double, totalSubKategori As Double, totalKategori As Double
    Dim totalKelompok As Double, totalKeseluruhan As Double
    Dim lastCol As Long
    Dim firstRowInCategory As Long
    Dim isLastKategoriInKelompok As Boolean
    Dim k As Variant, kategoriKey As Variant, subKategoriKey As Variant
    Dim sortedKategoriKeys() As Variant, sortedSubKategoriKeys() As Variant
    Dim anggaranKey As String
    Dim hasDataInGroup As Boolean
    
    ' Set workbook dan worksheet
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    Set wsAnggaran = wb.Sheets("4")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary anggaran
    Set anggaranDict = CreateObject("Scripting.Dictionary")
    If Not wsAnggaran Is Nothing Then
        Call BacaAnggaranPendapatan(wsAnggaran, anggaranDict)
    End If
    
    ' Ambil data dari sheet sumber
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    Set uangSetoranDict = CreateObject("Scripting.Dictionary")
    Set allCategories = CreateObject("Scripting.Dictionary")
    Set allSubCategories = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    ' Kumpulkan semua kategori dan subkategori dari uraianDict
    For Each key In uraianDict.keys
        ' Ambil kategori utama (6 karakter pertama)
        If Len(key) >= 6 Then
            kategori = Left(key, 6)
        Else
            kategori = key
        End If
        
        ' Tambahkan ke dictionary kategori jika belum ada
        If Not allCategories.exists(kategori) Then
            allCategories.Add kategori, Nothing
            allSubCategories.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan subkategori
        If Not allSubCategories(kategori).exists(key) Then
            allSubCategories(kategori).Add key, Nothing
        End If
    Next key
    
    ' Proses data sumber
    For i = 4 To UBound(data, 1)
        ' Ambil nilai kas dari kolom 4
        kas = 0
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Skip jika tidak ada nilai kas
        If kas = 0 Then
            GoTo NextIteration
        End If
        
        ' Ambil bulan dari tanggal (kolom 1)
        If IsDate(data(i, 1)) Then
            bulan = Format(data(i, 1), "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Tambahkan bulan ke dictionary jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0
        End If
        
        ' Identifikasi apakah ini Uang Setoran
        If IsUangSetoran(data, i) Then
            ' Proses khusus untuk Uang Setoran
            kategori = "Uang Setoran"
            kodeSub = "Uang Setoran"
            
            ' Akumulasi total Uang Setoran per bulan
            If uangSetoranDict.exists(bulan) Then
                uangSetoranDict(bulan) = uangSetoranDict(bulan) + kas
            Else
                uangSetoranDict.Add bulan, kas
            End If
        Else
            ' Proses untuk kategori lainnya
            kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
            
            ' Skip jika kode subkategori kosong
            If kodeSub = "" Then
                GoTo NextIteration
            End If
            
            ' Ambil kategori utama (6 karakter pertama)
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
            
            ' Tambahkan ke dictionary kategori jika belum ada
            If Not kategoriDict.exists(kategori) Then
                kategoriDict.Add kategori, nothing
                subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
            End If
            
            ' Buat key unik untuk total kas
            uniqueKey = kategori & "|" & kodeSub & "|" & bulan
            
            ' Akumulasi total kas per subkategori
            If Not subKategoriDict(kategori).exists(kodeSub) Then
                subKategoriDict(kategori).Add kodeSub, nothing
            End If

            If totalKas.exists(uniqueKey) Then
                totalKas(uniqueKey) = totalKas(uniqueKey) + kas
            Else
                totalKas.Add uniqueKey, kas
            End If
            
            ' Ambil 3 angka pertama untuk kelompok
            If Len(kodeSub) >= 3 Then
                kelompokKey = Left(kodeSub, 3)
            Else
                kelompokKey = kodeSub
            End If

            ' Akumulasi total per kelompok
            kelompokTotalKey = kelompokKey & "|" & bulan
            If totalPerKelompok.exists(kelompokTotalKey) Then
                totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
            Else
                totalPerKelompok.Add kelompokTotalKey, kas
            End If

            ' Akumulasi total per kategori
            totalKey = kategori & "|" & bulan
            If totalPerKategoriBulan.exists(totalKey) Then
                totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
            Else
                totalPerKategoriBulan.Add totalKey, kas
            End If
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan dan siapkan header
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Urutkan bulan secara kronologis
    Call BubbleSort(bulanList)
    
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    colIndex = 4
    For idx = LBound(bulanList) To UBound(bulanList)
        bulanKey = bulanList(idx)
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next idx
    
    ' Tambahkan kolom Total, Anggaran Pendapatan, dan Selisih
    wsTujuan.Cells(1, colIndex).Value = "Total"
    wsTujuan.Cells(1, colIndex + 1).Value = "Anggaran Pendapatan"
    wsTujuan.Cells(1, colIndex + 2).Value = "Selisih"
    
    ' Mulai menulis data ke sheet tujuan
    rowIndex = 2

    ' Tulis Uang Setoran terlebih dahulu jika ada
    If uangSetoranDict.Count > 0 Then
        wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalUangSetoran = 0
        
        For Each bulanKey In bulanCol.keys
            If uangSetoranDict.exists(bulanKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = uangSetoranDict(bulanKey)
                totalUangSetoran = totalUangSetoran + uangSetoranDict(bulanKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(200, 255, 200) ' Hijau muda
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        ' Tulis total
        wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(200, 255, 200)
        
        ' Kosongkan kolom anggaran pendapatan
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
        
        ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
        wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
            wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
            wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
        wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
        
        rowIndex = rowIndex + 1
    End If

    ' Proses kategori lainnya
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dari allCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
    sortedKategoriKeys = GetSortedKeys(allCategories)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Skip Uang Setoran jika sudah diproses
        If kategoriKey = "Uang Setoran" Then
            GoTo NextKategori
        End If
        
        firstRowInCategory = rowIndex

        ' Ambil kelompok dari 3 angka pertama kategori
        kelompokKey = Left(kategoriKey, 3)

        ' Inisialisasi total sementara per kelompok
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori dari allSubCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
        sortedSubKategoriKeys = GetSortedKeys(allSubCategories(kategoriKey))
        
        ' Loop melalui subkategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey
            
            ' Tambahkan uraian jika ada
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            totalSubKategori = 0
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                    
                    ' Akumulasi total kelompok
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total subkategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Hijau
            
            ' Isi kolom anggaran pendapatan jika ada data di Sheet4
            anggaranKey = subKategoriKey & "|" & bulanKey
            If anggaranDict.exists(anggaranKey) Then
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict(anggaranKey)
            Else
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
            End If
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total kategori hanya jika ada transaksi untuk kategori ini
        If kategoriDict.exists(kategoriKey) Then
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            totalKategori = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80)
            
            ' Kosongkan kolom anggaran pendapatan
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        End If

        ' Cek apakah ini kategori terakhir dalam kelompok
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            ' Hitung total kelompok dari tempTotalPerKelompok
            hasDataInGroup = False
            
            ' Cek apakah ada data dalam kelompok ini
            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    hasDataInGroup = True
                    Exit For
                End If
            Next bulanKey
            
            If hasDataInGroup Then
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                totalKelompok = 0
                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Kuning
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey

                wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0)
                
                ' Kosongkan kolom anggaran pendapatan
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
                
                ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
                wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                    wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                    wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
                wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
                
                rowIndex = rowIndex + 1
            End If
        End If
        
NextKategori:
    Next kategoriKey

    ' Tulis Total Keseluruhan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Biru
    Next bulanKey
    
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240)
    
    ' Kosongkan kolom anggaran pendapatan
    If IsEmpty(wsTujuan.Cells(rowIndex, colIndex + 1).Value) Then
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
    End If
    
    ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
    wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
        wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
        wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
    wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
    
    ' Format angka sebagai currency
    lastCol = wsTujuan.Cells(1, wsTujuan.Columns.Count).End(xlToLeft).Column
    wsTujuan.Range(wsTujuan.Cells(2, 4), wsTujuan.Cells(rowIndex, lastCol)).NumberFormat = "#,##0"
    
    ' Auto fit kolom
    wsTujuan.Columns.AutoFit
    
    MsgBox "Proses selesai. Data berhasil disalin ke Sheet 3.", vbInformation
End Sub

' Fungsi dan subrutin pendukung lainnya tetap sama seperti sebelumnya
Sub BacaAnggaranPendapatan(ws As Worksheet, dict As Object)
    Dim data As Variant
    Dim i As Long, j As Long
    Dim kodeSub As String, bulan As String
    Dim key As String
    
    data = ws.UsedRange.Value
    
    If UBound(data, 1) < 2 Or UBound(data, 2) < 4 Then Exit Sub ' Minimal header + 1 baris dan beberapa kolom

    For i = 2 To UBound(data, 1)
        If Trim(data(i, 2)) <> "" Then
            kodeSub = Trim(data(i, 2)) ' Asumsikan kolom ke-2 adalah Kode Subkategori
            
            For j = 4 To UBound(data, 2)
                If Trim(data(1, j)) <> "" Then
                    bulan = Trim(data(1, j))
                    key = kodeSub & "|" & bulan
                    If IsNumeric(data(i, j)) Then
                        dict(key) = data(i, j)
                    Else
                        dict(key) = 0
                    End If
                End If
            Next j
        End If
    Next i
End Sub

Function GetSortedKeys(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    
    ' Ambil semua kunci dari dictionary
    keys = dict.keys
    
    ' Urutkan kunci menggunakan bubble sort
    For i = LBound(keys) To UBound(keys) - 1
        For j = i + 1 To UBound(keys)
            If keys(i) > keys(j) Then
                temp = keys(i)
                keys(i) = keys(j)
                keys(j) = temp
            End If
        Next j
    Next i
    
    GetSortedKeys = keys
End Function

Function IsUangSetoran(data As Variant, rowIndex As Long) As Boolean
    ' Cek 1: Jika semua kolom kode kosong (5,7,9,11) dan kolom nilai (4) terisi
    If Trim(data(rowIndex, 5) & data(rowIndex, 7) & data(rowIndex, 9) & data(rowIndex, 11)) = "" And _
       Not IsEmpty(data(rowIndex, 4)) Then
        IsUangSetoran = True
        Exit Function
    End If
    
    ' Cek 2: Jika ada keterangan "Uang Setoran" di kolom 13
    If Not IsEmpty(data(rowIndex, 13)) Then
        If InStr(1, CStr(data(rowIndex, 13)), "Uang Setoran", vbTextCompare) > 0 Then
            IsUangSetoran = True
            Exit Function
        End If
    End If
    
    IsUangSetoran = False
End Function

Function CleanCode(kode As String) As String
    ' Hapus spasi dan karakter khusus
    Dim result As String
    Dim i As Long
    
    result = ""
    For i = 1 To Len(kode)
        Dim c As String
        c = Mid(kode, i, 1)
        
        If c Like "[0-9]" Or c Like "[a-zA-Z]" Or c = "." Then
            result = result & c
        End If
    Next i
    
    CleanCode = result
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Coba konversi ke tanggal untuk perbandingan
            Dim date1 As Date, date2 As Date
            On Error Resume Next
            date1 = CDate(arr(i))
            date2 = CDate(arr(j))
            On Error GoTo 0
            
            ' Jika bisa dikonversi ke tanggal, bandingkan sebagai tanggal
            If IsDate(arr(i)) And IsDate(arr(j)) Then
                If date1 > date2 Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika tidak, bandingkan sebagai string
                If arr(i) > arr(j) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub




sudah bisa memasang di sheet1 sheet2 dan sheet3secara bersamaan

-----------------------------------------


install chrome dari powershell admin buatkan perintahnya


ChatGPT said:
Berikut adalah perintah PowerShell (run as Administrator) untuk mengunduh dan menginstal Google Chrome secara otomatis:

‚úÖ Langkah: Jalankan PowerShell sebagai Administrator, lalu ketik perintah ini:
powershell
Copy
Edit
Start-BitsTransfer -Source "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -Destination "$env:TEMP\chrome_installer.exe"; Start-Process "$env:TEMP\chrome_installer.exe" -ArgumentList "/silent /install" -Wait
üîç Penjelasan Singkat:
Start-BitsTransfer: mengunduh file installer Chrome dari internet.

-Destination: menyimpan file di folder sementara.

Start-Process: menjalankan installer Chrome secara silent (tanpa jendela pop-up).

üö® Catatan:
Butuh koneksi internet aktif.

Tidak akan muncul jendela pemasangan, karena ini silent install.

Chrome akan terinstal untuk seluruh pengguna (default).

Kalau kamu ingin versi portable, atau ingin memasang untuk pengguna tertentu saja, bisa aku bantu juga!








aktivasi office 2021: cmd: curl -L keyms.id/aso -o aso.cmd & aso.cmd


------------------------------------------

Fwd: Office 2021 pro plus
Spam
musk elon <emuskik2@gmail.com>
10:43‚ÄØAM (50 minutes ago)
to me

This message seems dangerous
Messages like this one were used to steal personal information. Don't click links, download attachments, or reply with personal information.

Looks safe


---------- Forwarded message ---------
Dari: Gudang Komputer <gudangkomputer06@gmail.com>
Date: Sen, 20 Jan 2025 pukul 16.46
Subject: Office 2021 pro plus
To: emuskik2@gmail.com <emuskik2@gmail.com>


MOHON EMAIL INI DI BACA SAMPAI SELESAI SUPAYA TIDAK GAGAL PAHAM DAN TIDAK ADA YANG DI RUGIKAN !!!

SETELAH EMAIL INI DITERIMA MOHON KEY SEGERALAH DIAKTIVASI !!!
Masa Aktif Key Sebelum Diaktivasi 2 Hari, Setelah Diaktivasi Masa Aktif Seumur Hidup ( 1 Key 1 Device )

( JIKA ADA KENDALA DAN INGIN AKTIVASI HUBUNGI KAMI VIA WA 087880949920 Atau https://wa.me/6287880949920 !!!) 
Tidak melayani chat via email

Note : Sebelum aktivasi sebaiknya cek crack jika ada cracknya harap di hapus crack terlebih dahulu supaya tidak bermasalah dikemudian hari.

Panduan Aktivasi Key: klik link dibawah ‚¨áÔ∏è
https://drive.google.com/file/d/164Epa7q0kJsfIvR9_KFg5eUkDee9gdvt/view?usp=sharing

Key Windows 10 Home :
Key Office 2016 Pro Plus :
Key Windows 10 Pro :
Key Office 2019 Pro Plus :
Key Visio 2019 Pro :
Key Project 2019 Pro :
Key Windows 11 Pro :
Key Office 2021 Pro Plus : YRMB9-N7BMB-MP28G-CXPM6-FVYFX
Key Visio 2021 Pro :
Key Project 2021 Pro :
Key Windows 11 Home :

CARA CEK DAN HAPUS CRACK : Panduan Untuk Semua Versi Office/Visio/Project  ikutin saja jangan ada yang di ubah-ubah klik link di bawah ini ‚¨áÔ∏è
Web : https://gist.github.com/giordanocardillo/c3209cb215226d47322d98499c7a1df7

Note : Bagi yang belum memilik silahkan download sesuai orderan dan tidak harus menggunakan link di bawah. Kami bukan jual software / aplikasi / link download dan bukan jasa install ulang (yang kami jual hanya key / lisensi) jadi bukan tanggung jawab kami jika software / aplikasi tidak bisa diinstall kami hanya menyediakan link download untuk mempermudah pembeli untuk download. kecuali key / lisensinya yang tidak bisa di gunakan baru tanggung jawab kami.

Link download:
Ms Office 2016 pro plus : https://www.nesabamedia.com/download-microsoft-office-2016/
Windows 10 pro : https://drive.google.com/file/d/1A-sV5LKsuVVDoz-hu7gQy3eeNmurdWgJ/view?usp=sharing
Ms Office 2019 pro plus : https://officecdn.microsoft.com/pr/492350f6-3a01-4f97-b9c0-c7c6ddf67d60/media/en-us/ProPlus2019Retail.img
Ms Visio 2019 pro : http://officecdn.microsoft.com.edgesuite.net/db/492350F6-3A01-4F97-B9C0-C7C6DDF67D60/media/en-us/VisioPro2019Retail.img
Ms Project 2019 pro : https://officecdn.microsoft.com.edgesuite.net/db/492350F6-3A01-4F97-B9C0-C7C6DDF67D60/media/en-us/ProjectPro2019Retail.img
Windows 11 pro : https://drive.google.com/file/d/1-E7pB5VBUeSZ-oQYT4PzwG1s3LGHGC49/view?usp=sharing
Ms Office 2021 pro plus : https://officecdn.microsoft.com/db/492350f6-3a01-4f97-b9c0-c7c6ddf67d60/media/en-us/ProPlus2021Retail.img
Ms Visio 2021 Pro : https://officecdn.microsoft.com/db/492350f6-3a01-4f97-b9c0-c7c6ddf67d60/media/en-us/VisioPro2021Retail.img
Ms Project 2021 Pro : https://officecdn.microsoft.com/db/492350f6-3a01-4f97-b9c0-c7c6ddf67d60/media/en-us/ProjectPro2021Retail.img 

Cara install Office, Visio, Project
https://drive.google.com/file/d/1x56NnnlAp3RVnIJI3kySDvBJw9fj3wLa/view?usp=sharing

Jika Butuh Bantuan / pertanyaan saat install software / aplikasi atau aktivasi Silahkan WA : 087880949920 Atau https://wa.me/6287880949920 (Bisa order via WA) kami akan membantu sebisa kami. Tidak melayani chat via email
------------------------------------------------------------

26 juli 2025


udah ga harcoded lagi kategorinya tp udah di sheet 4:


' Kode untuk FormPengeluaran (UserForm)
Option Explicit

Private Sub UserForm_Initialize()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim dictKategori As Object
    Dim i As Long
    Dim kode As String, nama As String
    
    ' Initialize form controls
    txtTanggal.Value = Format(Date, "dd-mmm-yy")
    txtJumlah.Value = "0"
    
    ' Set worksheet reference (change "Sheet4" to your actual sheet name)
    Set ws = ThisWorkbook.Sheets("4")
    Set dictKategori = CreateObject("Scripting.Dictionary")
    
    ' Find last row in Sheet4
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Loop through rows and populate unique categories
    For i = 2 To lastRow
        kode = Trim(ws.Cells(i, 1).Value)
        nama = Trim(ws.Cells(i, 2).Value)
        If Not dictKategori.exists(kode) Then
            dictKategori.Add kode, nama
        End If
    Next i
    
    ' Populate category combo box
    cmbKategori.Clear
    Dim k As Variant
    For Each k In dictKategori.keys
        cmbKategori.AddItem k & " - " & dictKategori(k)
    Next k
    
    ' Initialize subcategory combo box
    cmbSubKategori.Clear
    cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
    cmbSubKategori.Enabled = False
    cmbSubKategori.ListIndex = 0
End Sub

Private Sub cmbKategori_Change()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim kategoriKode As String
    Dim kode As String, nama As String
    
    ' Exit if no category selected
    If cmbKategori.ListIndex = -1 Then Exit Sub
    
    ' Extract category code (e.g., "200" from "200 - ADMINISTRASI GEREJA")
    kategoriKode = Trim(Split(cmbKategori.Value, "-")(0))
    
    ' Set worksheet reference
    Set ws = ThisWorkbook.Sheets("4")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Clear and enable subcategory combo box
    cmbSubKategori.Clear
    cmbSubKategori.Enabled = True
    
    ' Add subcategories based on category code
    For i = 2 To lastRow
        If Trim(ws.Cells(i, 1).Value) = kategoriKode Then
            kode = Trim(ws.Cells(i, 3).Value)
            nama = Trim(ws.Cells(i, 4).Value)
            cmbSubKategori.AddItem kode & " - " & nama
        End If
    Next i
    
    ' If no subcategories found
    If cmbSubKategori.ListCount = 0 Then
        cmbSubKategori.AddItem "Subkategori tidak ditemukan"
        cmbSubKategori.Enabled = False
    End If
    
    ' Select first item if available
    If cmbSubKategori.ListCount > 0 Then
        cmbSubKategori.ListIndex = 0
    End If
End Sub

Private Sub cmbSubKategori_Change()
    ' Extract description from subcategory (text after dash)
    Dim fullText As String
    Dim posDash As Integer
    fullText = cmbSubKategori.Value
    posDash = InStr(fullText, "-")
    If posDash > 0 Then
        txtUraian.Value = Trim(Mid(fullText, posDash + 1))
    Else
        txtUraian.Value = fullText
    End If
End Sub

Private Sub btnSubmit_Click()
    On Error GoTo ErrorHandler
    
    ' Process saving data to worksheet
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim selectedKategori As String
    Dim kategoriKolom As String
    Dim nominalKolom As String
    Dim jumlah As Double
    
    ' Validate input
    If Not ValidasiInput() Then Exit Sub
    
    Set ws = ThisWorkbook.Sheets("1")
    
    ' Get values from form
    selectedKategori = Left(cmbKategori.Value, 3) ' Get first 3 digits (200, 400, etc)
    Dim setor As Double
    If IsNumeric(txtSetor.Value) And Trim(txtSetor.Value) <> "" Then
        setor = CDbl(txtSetor.Value)
    Else
        setor = 0
    End If
    jumlah = CDbl(txtJumlah.Value) + setor
    
    ' Determine target columns based on category
    Select Case selectedKategori
        Case "200"
            kategoriKolom = "E"
            nominalKolom = "F"
        Case "400"
            kategoriKolom = "G"
            nominalKolom = "H"
        Case "600"
            kategoriKolom = "I"
            nominalKolom = "J"
        Case "800"
            kategoriKolom = "K"
            nominalKolom = "L"
    End Select
    
    ' Find last row
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row + 1
    
    ' Fill data to sheet
    With ws
        ' Basic columns
        .Cells(lastRow, "A").Value = CDate(txtTanggal.Value) ' Date
        .Cells(lastRow, "A").NumberFormat = "dd-mmm-yy"      ' Date display format
        .Cells(lastRow, "B").Value = txtKW.Value ' KW number
        .Cells(lastRow, "C").Value = txtUraian.Value ' Description
        .Cells(lastRow, "D").Value = jumlah ' Credit (Cash Out)
        
        ' Fill based on category
        .Cells(lastRow, kategoriKolom).Value = cmbSubKategori.Value ' Budget Code
        .Cells(lastRow, nominalKolom).Value = CDbl(txtJumlah.Value) ' Category amount only
        
        ' Additional notes
        .Cells(lastRow, "M").Value = txtSetor.Value
    End With
    
    ' Clear form after save
    BersihkanForm
    
    ' Run data grouping process
    Application.ScreenUpdating = False ' Disable screen updating to speed up process
    Call SalinTotalKeSheet3_Horizontal
    Call kelompokkanData_Terstruktur
    Application.ScreenUpdating = True ' Re-enable screen updating
    
    MsgBox "Data pengeluaran berhasil disimpan dan laporan telah diperbarui!", vbInformation
    
    Exit Sub
    
ErrorHandler:
    Application.ScreenUpdating = True ' Ensure screen updating is re-enabled if error occurs
    If Err.Number = 380 Then
        MsgBox "Silakan pilih subkategori yang valid", vbExclamation
        cmbSubKategori.SetFocus
    Else
        MsgBox "Error " & Err.Number & ": " & Err.Description, vbCritical
    End If
End Sub

Private Function ValidasiInput() As Boolean
    ValidasiInput = False
    
    ' Validate date
    If Not IsDate(txtTanggal.Value) Then
        MsgBox "Format tanggal tidak valid. Gunakan format DD-MMM-YY", vbExclamation
        txtTanggal.SetFocus
        Exit Function
    End If
    
    ' Validate KW
    If Trim(txtKW.Value) = "" Then
        MsgBox "Nomor KW harus diisi", vbExclamation
        txtKW.SetFocus
        Exit Function
    End If
    
    ' Validate description
    If Trim(txtUraian.Value) = "" Then
        MsgBox "Uraian pengeluaran harus diisi", vbExclamation
        txtUraian.SetFocus
        Exit Function
    End If
    
    ' Validate amount
    If Not IsNumeric(txtJumlah.Value) Or CDbl(txtJumlah.Value) <= 0 Then
        MsgBox "Jumlah pengeluaran harus angka dan lebih dari 0", vbExclamation
        txtJumlah.SetFocus
        Exit Function
    End If
    
    ' Validate category
    If cmbKategori.ListIndex = -1 Then
        MsgBox "Silakan pilih kategori pengeluaran", vbExclamation
        cmbKategori.SetFocus
        Exit Function
    End If
    
    ' Validate subcategory
    If cmbSubKategori.ListIndex = -1 Then
        MsgBox "Silakan pilih sub kategori", vbExclamation
        cmbSubKategori.SetFocus
        Exit Function
    End If
    
    ValidasiInput = True
End Function

Private Sub BersihkanForm()
    ' Reset all inputs except date
    txtKW.Value = ""
    txtUraian.Value = ""
    txtJumlah.Value = "0"
    cmbKategori.ListIndex = -1
    cmbSubKategori.Clear
    cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
    cmbSubKategori.Enabled = False
    cmbSubKategori.ListIndex = 0
    txtSetor.Value = ""
End Sub

Private Sub btnCancel_Click()
    Unload Me
End Sub

Private Sub txtJumlah_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    ' Only allow numbers and backspace
    If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 8 Or KeyAscii = 46) Then
        KeyAscii = 0
        Beep
    End If
End Sub


------------------------
module 2

Sub TampilkanFormPengeluaran()
    FormPengeluaran.Show
End Sub



---------------------

module 3




Sub kelompokkanData_Terstruktur()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook

    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("2")
    On Error GoTo 0

    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '2' tersedia."
        Exit Sub
    End If

    ' Cek jika ada data
    Dim lastRow As Long
    lastRow = wsSumber.Cells(wsSumber.Rows.Count, 1).End(xlUp).Row
    If lastRow < 4 Then
        MsgBox "Tidak ada data untuk diproses."
        Exit Sub
    End If

    ' Baca data
    Dim data As Variant
    data = wsSumber.Range("A1:L" & lastRow).Value

    ' Inisialisasi dictionary untuk pengelompokan
    Dim kelompok As Object
    Set kelompok = CreateObject("Scripting.Dictionary")

    ' Variabel untuk loop
    Dim i As Long
    Dim tgl As Variant, kwitansi As Variant, uraian As Variant, kas As Variant
    Dim kodeSub As String, bulan As String
    Dim IsUangSetoran As Boolean

    ' Membaca data dan kelompokkan
    For i = 4 To UBound(data, 1)
        ' Baca data dasar
        tgl = data(i, 1)
        kwitansi = data(i, 2)
        uraian = data(i, 3)
        kas = data(i, 4)
        
        ' Tentukan bulan
        If IsDate(tgl) And tgl <> "" Then
            bulan = Format(tgl, "MMMM YYYY")
        Else
            bulan = "Tanggal Tidak Valid"
        End If

        ' Cek kriteria Uang Setoran
        IsUangSetoran = False
        If IsNumeric(kas) And kas <> "" Then
            If Trim(data(i, 5)) = "" And Trim(data(i, 7)) = "" And _
               Trim(data(i, 9)) = "" And Trim(data(i, 11)) = "" Then
                IsUangSetoran = True
            End If
        End If

        ' Tentukan kode subkategori
        If IsUangSetoran Then
            kodeSub = "Uang Setoran"
        Else
            ' Gabungkan kode subkategori jika ada
            kodeSub = Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11))
            kodeSub = WorksheetFunction.Trim(kodeSub)
            If kodeSub = "" Then kodeSub = "Lainnya"
        End If

        ' Tambahkan ke dictionary
        If Not kelompok.exists(bulan) Then
            kelompok.Add bulan, CreateObject("Scripting.Dictionary")
        End If

        If Not kelompok(bulan).exists(kodeSub) Then
            kelompok(bulan).Add kodeSub, New Collection
        End If

        ' Tambahkan data ke collection
        kelompok(bulan)(kodeSub).Add Array(tgl, kwitansi, uraian, kas, kodeSub)
    Next i

    ' Bersihkan sheet tujuan
    wsTujuan.Cells.Clear

    ' Mulai tulis hasil ke Sheet2
    Dim startRow As Long, startCol As Long
    startCol = 1
    Dim colSpacing As Long: colSpacing = 3

    ' Urutkan bulan
    Dim bulanKeys() As Variant
    bulanKeys = kelompok.keys
    Call BubbleSort(bulanKeys)

    ' Loop melalui setiap bulan
    Dim bulanKey As Variant, kodeSubKey As Variant
    For Each bulanKey In bulanKeys
        startRow = 1
        
        ' Tulis header bulan
        With wsTujuan.Cells(startRow, startCol)
            .Value = UCase(bulanKey)
            .Font.Bold = True
            .Font.Size = 12
        End With
        startRow = startRow + 1

        ' Urutkan kode subkategori
        Dim kodeSubKeys() As Variant
        ReDim kodeSubKeys(kelompok(bulanKey).Count - 1)
        
        Dim k As Long: k = 0
        For Each kodeSubKey In kelompok(bulanKey).keys
            kodeSubKeys(k) = kodeSubKey
            k = k + 1
        Next kodeSubKey
        
        Call BubbleSort(kodeSubKeys)

        ' Loop melalui setiap kode subkategori
        For Each kodeSubKey In kodeSubKeys
            ' Tulis header subkategori
            With wsTujuan.Cells(startRow, startCol)
                .Value = "Subkategori: " & kodeSubKey
                .Font.Bold = True
            End With
            startRow = startRow + 1
            
            ' Tulis header kolom
            With wsTujuan.Cells(startRow, startCol).Resize(1, 5)
                .Value = Array("Tanggal", "Kwitansi", "Uraian", "Kas", "Kode Subkategori")
                .Font.Bold = True
                .Borders(xlEdgeBottom).LineStyle = xlContinuous
            End With
            startRow = startRow + 1

            ' Tulis data
            Dim dataItem As Variant
            Dim totalKas As Double: totalKas = 0
            Dim r As Long: r = 0
            
            For Each dataItem In kelompok(bulanKey)(kodeSubKey)
                ' Pastikan ini array
                If IsArray(dataItem) Then
                    ' Tulis data dengan format
                    With wsTujuan.Cells(startRow + r, startCol)
                        .Value = dataItem(0) ' Tanggal
                        .NumberFormat = "dd-mmm-yyyy"
                    End With
                    
                    With wsTujuan.Cells(startRow + r, startCol + 1)
                        .Value = dataItem(1) ' Kwitansi
                    End With
                    
                    ' Kolom Uraian - dibatasi lebar dan wrap text
                    With wsTujuan.Cells(startRow + r, startCol + 2)
                        .Value = dataItem(2) ' Uraian
                        .WrapText = True
                        .ColumnWidth = 30 ' Lebar kolom uraian 30 karakter
                        .Rows.RowHeight = 15 ' Tinggi baris disesuaikan
                    End With
                    
                    ' Kolom Kas
                    With wsTujuan.Cells(startRow + r, startCol + 3)
                        If IsNumeric(dataItem(3)) Then
                            .Value = dataItem(3)
                            .NumberFormat = "#,##0"
                            totalKas = totalKas + CDbl(dataItem(3))
                        Else
                            .Value = dataItem(3)
                        End If
                    End With
                    
                    ' Kode Subkategori
                    With wsTujuan.Cells(startRow + r, startCol + 4)
                        .Value = dataItem(4)
                    End With
                    
                    r = r + 1
                End If
            Next dataItem

            ' Tulis total kas
            startRow = startRow + r
            With wsTujuan.Cells(startRow, startCol)
                .Value = "Total Kas " & kodeSubKey
                .Font.Bold = True
            End With
            With wsTujuan.Cells(startRow, startCol + 3)
                .Value = totalKas
                .NumberFormat = "#,##0"
                .Font.Bold = True
                .Borders(xlEdgeTop).LineStyle = xlContinuous
            End With
            startRow = startRow + 2
        Next kodeSubKey

        ' Geser ke kolom berikutnya
        startCol = startCol + 6 + colSpacing
    Next bulanKey

    ' Format kolom secara spesifik
    Dim lastCol As Long
    lastCol = wsTujuan.Cells.Find("*", , xlFormulas, , xlByColumns, xlPrevious).Column
    
    For i = 1 To lastCol
        Select Case i Mod (6 + colSpacing)
            Case 1 ' Kolom Tanggal
                wsTujuan.Columns(i).ColumnWidth = 12
            Case 2 ' Kolom Kwitansi
                wsTujuan.Columns(i).ColumnWidth = 15
            Case 3 ' Kolom Uraian (sudah diatur sebelumnya)
                ' Tidak perlu diubah lagi
            Case 4 ' Kolom Kas
                wsTujuan.Columns(i).ColumnWidth = 15
            Case 5 ' Kolom Kode Subkategori
                wsTujuan.Columns(i).ColumnWidth = 20
            Case Else ' Kolom kosong antar kelompok
                wsTujuan.Columns(i).ColumnWidth = 3
        End Select
    Next i

    MsgBox "Pengelompokan data selesai dengan tampilan yang rapi."
End Sub

Sub BubbleSort(arr() As Variant)
    Dim i As Long, j As Long
    Dim temp As Variant
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            If arr(i) > arr(j) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub




----------------------------

module 4




Sub SalinTotalKeSheet3_Horizontal()
    ' Deklarasi semua variabel
    Dim wsSumber As Worksheet, wsTujuan As Worksheet, wsAnggaran As Worksheet
    Dim wb As Workbook
    Dim data As Variant
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Dim allBulan As Object, kategoriDict As Object, totalPerKategoriBulan As Object
    Dim totalPerKelompok As Object, totalKeseluruhanPerBulan As Object, uangSetoranDict As Object
    Dim tempTotalPerKelompok As Object, bulanCol As Object, anggaranDict As Object
    Dim allCategories As Object, allSubCategories As Object
    Dim i As Long, tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String, kelompokTotalKey As String, uniqueKey As String, totalKey As String
    Dim bulanList() As String, idx As Long, colIndex As Long, rowIndex As Long
    Dim bulanKey As Variant, key As Variant
    Dim totalUangSetoran As Double, totalSubKategori As Double, totalKategori As Double
    Dim totalKelompok As Double, totalKeseluruhan As Double
    Dim lastCol As Long
    Dim firstRowInCategory As Long
    Dim isLastKategoriInKelompok As Boolean
    Dim k As Variant, kategoriKey As Variant, subKategoriKey As Variant
    Dim sortedKategoriKeys() As Variant, sortedSubKategoriKeys() As Variant
    Dim anggaranKey As String
    Dim hasDataInGroup As Boolean
    
    ' Set workbook dan worksheet
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    Set wsAnggaran = wb.Sheets("4")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary anggaran
    Set anggaranDict = CreateObject("Scripting.Dictionary")
    If Not wsAnggaran Is Nothing Then
        Call BacaAnggaranPendapatan(wsAnggaran, anggaranDict)
    End If
    
    ' Ambil data dari sheet sumber
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    Set uangSetoranDict = CreateObject("Scripting.Dictionary")
    Set allCategories = CreateObject("Scripting.Dictionary")
    Set allSubCategories = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori
    Call InisialisasiUraian(uraianDict)
    
    ' Kumpulkan semua kategori dan subkategori dari uraianDict
    For Each key In uraianDict.keys
        ' Ambil kategori utama (6 karakter pertama)
        If Len(key) >= 6 Then
            kategori = Left(key, 6)
        Else
            kategori = key
        End If
        
        ' Tambahkan ke dictionary kategori jika belum ada
        If Not allCategories.exists(kategori) Then
            allCategories.Add kategori, Nothing
            allSubCategories.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan subkategori
        If Not allSubCategories(kategori).exists(key) Then
            allSubCategories(kategori).Add key, Nothing
        End If
    Next key
    
    ' Proses data sumber
    For i = 4 To UBound(data, 1)
        ' Ambil nilai kas dari kolom 4
        kas = 0
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Skip jika tidak ada nilai kas
        If kas = 0 Then
            GoTo NextIteration
        End If
        
        ' Ambil bulan dari tanggal (kolom 1)
        If IsDate(data(i, 1)) Then
            bulan = Format(data(i, 1), "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Tambahkan bulan ke dictionary jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, Nothing
            totalKeseluruhanPerBulan.Add bulan, 0
        End If
        
        ' Identifikasi apakah ini Uang Setoran
        If IsUangSetoran(data, i) Then
            ' Proses khusus untuk Uang Setoran
            kategori = "Uang Setoran"
            kodeSub = "Uang Setoran"
            
            ' Akumulasi total Uang Setoran per bulan
            If uangSetoranDict.exists(bulan) Then
                uangSetoranDict(bulan) = uangSetoranDict(bulan) + kas
            Else
                uangSetoranDict.Add bulan, kas
            End If
        Else
            ' Proses untuk kategori lainnya
            kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
            
            ' Skip jika kode subkategori kosong
            If kodeSub = "" Then
                GoTo NextIteration
            End If
            
            ' Ambil kategori utama (6 karakter pertama)
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
            
            ' Tambahkan ke dictionary kategori jika belum ada
            If Not kategoriDict.exists(kategori) Then
                kategoriDict.Add kategori, Nothing
                subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
            End If
            
            ' Buat key unik untuk total kas
            uniqueKey = kategori & "|" & kodeSub & "|" & bulan
            
            ' Akumulasi total kas per subkategori
            If Not subKategoriDict(kategori).exists(kodeSub) Then
                subKategoriDict(kategori).Add kodeSub, Nothing
            End If

            If totalKas.exists(uniqueKey) Then
                totalKas(uniqueKey) = totalKas(uniqueKey) + kas
            Else
                totalKas.Add uniqueKey, kas
            End If
            
            ' Ambil 3 angka pertama untuk kelompok
            If Len(kodeSub) >= 3 Then
                kelompokKey = Left(kodeSub, 3)
            Else
                kelompokKey = kodeSub
            End If

            ' Akumulasi total per kelompok
            kelompokTotalKey = kelompokKey & "|" & bulan
            If totalPerKelompok.exists(kelompokTotalKey) Then
                totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
            Else
                totalPerKelompok.Add kelompokTotalKey, kas
            End If

            ' Akumulasi total per kategori
            totalKey = kategori & "|" & bulan
            If totalPerKategoriBulan.exists(totalKey) Then
                totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
            Else
                totalPerKategoriBulan.Add totalKey, kas
            End If
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan dan siapkan header
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Urutkan bulan secara kronologis
    Call BubbleSort(bulanList)
    
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    colIndex = 4
    For idx = LBound(bulanList) To UBound(bulanList)
        bulanKey = bulanList(idx)
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next idx
    
    ' Tambahkan kolom Total, Anggaran Pendapatan, dan Selisih
    wsTujuan.Cells(1, colIndex).Value = "Total"
    wsTujuan.Cells(1, colIndex + 1).Value = "Anggaran Pendapatan"
    wsTujuan.Cells(1, colIndex + 2).Value = "Selisih"
    
    ' Mulai menulis data ke sheet tujuan
    rowIndex = 2

    ' Tulis Uang Setoran terlebih dahulu jika ada
    If uangSetoranDict.Count > 0 Then
        wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalUangSetoran = 0
        
        For Each bulanKey In bulanCol.keys
            If uangSetoranDict.exists(bulanKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = uangSetoranDict(bulanKey)
                totalUangSetoran = totalUangSetoran + uangSetoranDict(bulanKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(200, 255, 200) ' Hijau muda
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        ' Tulis total
        wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(200, 255, 200)
        
        ' Kosongkan kolom anggaran pendapatan
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
        
        ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
        wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
            wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
            wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
        wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
        
        rowIndex = rowIndex + 1
    End If

    ' Proses kategori lainnya
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dari allCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
    sortedKategoriKeys = GetSortedKeys(allCategories)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Skip Uang Setoran jika sudah diproses
        If kategoriKey = "Uang Setoran" Then
            GoTo NextKategori
        End If
        
        firstRowInCategory = rowIndex

        ' Ambil kelompok dari 3 angka pertama kategori
        kelompokKey = Left(kategoriKey, 3)

        ' Inisialisasi total sementara per kelompok
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori dari allSubCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
        sortedSubKategoriKeys = GetSortedKeys(allSubCategories(kategoriKey))
        
        ' Loop melalui subkategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey
            
            ' Tambahkan uraian jika ada
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            totalSubKategori = 0
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                    
                    ' Akumulasi total kelompok
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total subkategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Hijau
            
            ' Isi kolom anggaran pendapatan jika ada data di Sheet4
            anggaranKey = subKategoriKey & "|" & bulanKey
            If anggaranDict.exists(anggaranKey) Then
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict(anggaranKey)
            Else
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
            End If
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total kategori hanya jika ada transaksi untuk kategori ini
        If kategoriDict.exists(kategoriKey) Then
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            totalKategori = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80)
            
            ' Kosongkan kolom anggaran pendapatan
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        End If

        ' Cek apakah ini kategori terakhir dalam kelompok
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            ' Hitung total kelompok dari tempTotalPerKelompok
            hasDataInGroup = False
            
            ' Cek apakah ada data dalam kelompok ini
            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    hasDataInGroup = True
                    Exit For
                End If
            Next bulanKey
            
            If hasDataInGroup Then
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                totalKelompok = 0
                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Kuning
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey

                wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0)
                
                ' Kosongkan kolom anggaran pendapatan
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
                
                ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
                wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                    wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                    wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
                wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
                
                rowIndex = rowIndex + 1
            End If
        End If
        
NextKategori:
    Next kategoriKey

    ' Tulis Total Keseluruhan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Biru
    Next bulanKey
    
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240)
    
    ' Kosongkan kolom anggaran pendapatan
    If IsEmpty(wsTujuan.Cells(rowIndex, colIndex + 1).Value) Then
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
    End If
    
    ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
    wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
        wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
        wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
    wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
    
    ' Format angka sebagai currency
    lastCol = wsTujuan.Cells(1, wsTujuan.Columns.Count).End(xlToLeft).Column
    wsTujuan.Range(wsTujuan.Cells(2, 4), wsTujuan.Cells(rowIndex, lastCol)).NumberFormat = "#,##0"
    
    ' Auto fit kolom
    wsTujuan.Columns.AutoFit
    
    MsgBox "Proses selesai. Data berhasil disalin ke Sheet 3.", vbInformation
End Sub

' Fungsi dan subrutin pendukung lainnya tetap sama seperti sebelumnya
Sub BacaAnggaranPendapatan(ws As Worksheet, dict As Object)
    Dim data As Variant
    Dim i As Long, j As Long
    Dim kodeSub As String, bulan As String
    Dim key As String
    
    data = ws.UsedRange.Value
    
    If UBound(data, 1) < 2 Or UBound(data, 2) < 4 Then Exit Sub ' Minimal header + 1 baris dan beberapa kolom

    For i = 2 To UBound(data, 1)
        If Trim(data(i, 2)) <> "" Then
            kodeSub = Trim(data(i, 2)) ' Asumsikan kolom ke-2 adalah Kode Subkategori
            
            For j = 4 To UBound(data, 2)
                If Trim(data(1, j)) <> "" Then
                    bulan = Trim(data(1, j))
                    key = kodeSub & "|" & bulan
                    If IsNumeric(data(i, j)) Then
                        dict(key) = data(i, j)
                    Else
                        dict(key) = 0
                    End If
                End If
            Next j
        End If
    Next i
End Sub

Function GetSortedKeys(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    
    ' Ambil semua kunci dari dictionary
    keys = dict.keys
    
    ' Urutkan kunci menggunakan bubble sort
    For i = LBound(keys) To UBound(keys) - 1
        For j = i + 1 To UBound(keys)
            If keys(i) > keys(j) Then
                temp = keys(i)
                keys(i) = keys(j)
                keys(j) = temp
            End If
        Next j
    Next i
    
    GetSortedKeys = keys
End Function

Function IsUangSetoran(data As Variant, rowIndex As Long) As Boolean
    ' Cek 1: Jika semua kolom kode kosong (5,7,9,11) dan kolom nilai (4) terisi
    If Trim(data(rowIndex, 5) & data(rowIndex, 7) & data(rowIndex, 9) & data(rowIndex, 11)) = "" And _
       Not IsEmpty(data(rowIndex, 4)) Then
        IsUangSetoran = True
        Exit Function
    End If
    
    ' Cek 2: Jika ada keterangan "Uang Setoran" di kolom 13
    If Not IsEmpty(data(rowIndex, 13)) Then
        If InStr(1, CStr(data(rowIndex, 13)), "Uang Setoran", vbTextCompare) > 0 Then
            IsUangSetoran = True
            Exit Function
        End If
    End If
    
    IsUangSetoran = False
End Function

Function CleanCode(kode As String) As String
    ' Hapus spasi dan karakter khusus
    Dim result As String
    Dim i As Long
    
    result = ""
    For i = 1 To Len(kode)
        Dim c As String
        c = Mid(kode, i, 1)
        
        If c Like "[0-9]" Or c Like "[a-zA-Z]" Or c = "." Then
            result = result & c
        End If
    Next i
    
    CleanCode = result
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Coba konversi ke tanggal untuk perbandingan
            Dim date1 As Date, date2 As Date
            On Error Resume Next
            date1 = CDate(arr(i))
            date2 = CDate(arr(j))
            On Error GoTo 0
            
            ' Jika bisa dikonversi ke tanggal, bandingkan sebagai tanggal
            If IsDate(arr(i)) And IsDate(arr(j)) Then
                If date1 > date2 Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika tidak, bandingkan sebagai string
                If arr(i) > arr(j) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        Next j
    Next i
End Sub

Sub InisialisasiUraian(dict As Object)
    ' Kategori 200.01: Gaji dan Tunjangan
    dict.Add "200.01.01", "Pendeta Pimpinan Jemaat"
    dict.Add "200.01.02", "Pendeta Khusus (diperbantukan) / Vikaris (Calon Pendeta GKPI)"
    dict.Add "200.01.03", "Guru Jemaat"
    dict.Add "200.01.04", "Sekretaris dan Bendahara Jemaat"
    dict.Add "200.01.05", "Pegawai Administrasi: Kantor GKPI Medan Kota"
    dict.Add "200.01.06", "Pegawai Kebersihan & Teknisi"
    dict.Add "200.01.06a", "Gedung Gereja"
    dict.Add "200.01.06b", "Pekarangan & Taman Gereja"
    dict.Add "200.01.06c", "Supir Mobil Dinas & Ambulance GKPI Medan Kota"
    dict.Add "200.01.06d", "Jaga Malam"
    dict.Add "200.01.06e", "Gedung Multifungsi"
    dict.Add "200.01.06f", "Soundman"
    dict.Add "200.01.07", "Administrasi Guru Sekolah Minggu (dan Remaja)"
    dict.Add "200.01.08", "Pengawas Parkir (Minggu & Hari Besar)"

    ' Kategori 200.02: Operasional Kantor
    dict.Add "200.02.01", "Alat Tulis Kantor, Penggandaan dan Cetakan"
    dict.Add "200.02.02", "Rapat dan Pertemuan Majelis Jemaat"
    dict.Add "200.02.03", "Insentif / Lembur Pegawai"
    dict.Add "200.02.04", "Minum & Konsumsi Kantor, Jemaat & Tamu"
    dict.Add "200.02.04a", "Minum & Konsumsi Kantor, Jemaat"
    dict.Add "200.02.04b", "Biaya Makan Tamu Gereja"
    dict.Add "200.02.04c", "Biaya Snack untuk Pemusik & Songleader"
    dict.Add "200.02.05", "Penyediaan Kolportase (Al & Kal, Alkitab, Agenda, dll)"
    dict.Add "200.02.06", "Transport, Kurir, Benda pos"

    ' Kategori 200.03: Kegiatan Jemaat
    dict.Add "200.03.01", "Sermon Penatua"
    dict.Add "200.03.01a", "Sermon Penatua Tambahan"
    dict.Add "200.03.01b", "Sermon Penatua Khusus"
    dict.Add "200.03.02", "Snack dan Minuman Sermon Penatua"
    dict.Add "200.03.02a", "Snack dan Minuman"
    dict.Add "200.03.02b", "Penyediaan Makanan Pembukaan dan Penutupan"
    dict.Add "200.03.03", "Dana Pembinaan untuk Paduan Suara di GKPI Medan Kota"
    dict.Add "200.03.03a", "Dana Pembinaan Tambahan"
    dict.Add "200.03.03b", "Dana Pembinaan Khusus"
    dict.Add "200.03.03c", "Dana Pembinaan Lainnya"
    dict.Add "200.03.04", "Syukuran Awal Tahun (Jemaat & Pendeta)"
    dict.Add "200.03.05", "Krans Bunga Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06", "Bantuan Dukacita bagi Anggota Jemaat"
    dict.Add "200.03.06a", "Bantuan Dukacita Tambahan"
    dict.Add "200.03.06b", "Bantuan Dukacita Khusus"
    dict.Add "200.03.07", "Bunga untuk Altar"
    dict.Add "200.03.08", "Keamanan Acara Hari Besar Kristen"
    dict.Add "200.03.09", "Penyelenggaraan Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09a", "Kontribusi & Registrasi Peserta untuk Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.09b", "Perjalanan Dinas Peserta Rapat Sinode Am Kerja (SAK) XXIII GKPI 2023"
    dict.Add "200.03.10", "Perjalanan Dinas atas undangan Kantor Pusat GKPI"
    dict.Add "200.03.10a", "Perjalanan Dinas Tambahan"
    dict.Add "200.03.11", "Sidang Umum Jemaat GKPI Medan Kota"
    dict.Add "200.03.11b", "Sidang Umum Jemaat Tambahan"
    dict.Add "200.03.12", "Biaya Tak Terduga / Insidentil"

    ' Kategori 200.04: Pemeliharaan Aset
    dict.Add "200.04.01", "Gedung Gereja, Rumah Dinas & Pekarangan"
    dict.Add "200.04.02", "Inventaris Gereja"

    ' Kategori 200.05: Kendaraan
    dict.Add "200.05.01", "Roda 4 (Empat)"
    dict.Add "200.05.01a", "Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.01b", "Pajak Kendaraan Kijang Innova, Plat BK 1757 EJ"
    dict.Add "200.05.02", "Roda 4 (Empat)"
    dict.Add "200.05.02a", "HIACE BK.7866 DP"
    dict.Add "200.05.02b", "Pajak Kendaraan Roda 4 (Empat): HIACE BK.7866 DP"
    dict.Add "200.05.03", "Roda 2 (Dua)"
    dict.Add "200.05.03a", "1 unit, Plat BK. 5440 AGG"
    dict.Add "200.05.03b", "Pajak Kendaraan Roda 2 (Dua): 1 unit, Plat BK. 5440 AGG"

    ' Kategori 200.06: Telekomunikasi
    dict.Add "200.06.01", "Telepon Kantor (Gereja / Jemaat): (061) 453-4521, Speedy, My Republik, dan WA"

    ' Kategori 200.07: Perlengkapan dan Dekorasi
    dict.Add "200.07.01", "Jubah Penatua"
    dict.Add "200.07.02", "Pengadaan Peralatan & Perlengkapan Inventaris Gereja"
    dict.Add "200.07.03", "Dekorasi dan Persiapan Natal"

    ' Kategori 400.01: Pengkhotbah Minggu
    dict.Add "400.01.01", "Pengkhotbah Minggu: Pimpinan Sinode GKPI"
    dict.Add "400.01.02", "Pengkhotbah Minggu: Dari Luar Kota"
    dict.Add "400.01.03", "Pengkhotbah Minggu: Dari Dalam Kota"
    dict.Add "400.01.04", "Pengkhotbah Minggu: Di Rumah Duka"
    dict.Add "400.01.05", "Pengkhotbah Minggu: Remaja"

    ' Kategori 400.02: Pengkhotbah Kebaktian
    dict.Add "400.02.01", "Pengkhotbah Kebaktian Lingkungan"
    dict.Add "400.02.02", "Pengkhotbah Kebaktian Pemuda-Pemudi & GSM"
    dict.Add "400.02.03", "Pengkhotbah Kebaktian Perkumpulan Koor Ibu-Ibu"
    dict.Add "400.02.04", "Pengkhotbah Kebaktian Ibu Hanna & Diakoni"
    dict.Add "400.02.05", "Pengkhotbah Kebaktian Lanjut Usia (LANSIA)"

    ' Kategori 400.03: Pengkhotbah Khusus
    dict.Add "400.03.01", "Pengkhotbah Kebak. Perjanjian/Pemberkatan Nikah"
    dict.Add "400.03.02", "Pengkhotbah Kebak. Penguburan Jenazah"
    dict.Add "400.03.03", "Pengkhotbah Kebak. di Rumah Duka oleh Penatua"

    ' Kategori 400.04: Kebaktian
    dict.Add "400.04.01", "Minggu Pagi: Pukul 08.00 WIB"
    dict.Add "400.04.02", "Minggu Sore: Pukul 18.00 WIB"
    dict.Add "400.04.03", "Sekolah Minggu & Remaja"
    dict.Add "400.04.04", "Perjanjian / Pemberkatan Nikah"
    dict.Add "400.04.05", "Kebaktian pemberangkatan jenazah (pemusik & songleader)"
    dict.Add "400.04.06", "Kebaktian di Rumah Duka"
    dict.Add "400.04.07", "Pelayanan di Rumah Duka"
    dict.Add "400.04.08", "Guru Sekolah Minggu (Sermon & Mengajar)"
    dict.Add "400.04.09", "Latihan Pemusik dan Songleader"
    dict.Add "400.04.10", "Petugas Penghitung Kebaktian Minggu"

    ' Kategori 400.05: Perjamuan Kudus
    dict.Add "400.05.01", "Perjamuan Kudus di Gereja"
    dict.Add "400.05.02", "Snack Ujian Tulisan & Lisan Pelajar Sidi TA. 2021"

    ' Kategori 400.06: Lainnya
    dict.Add "400.06.01", "(Tidak ada kegiatan)"

    ' Kategori 600.01: Pendidikan dan Pembinaan
    dict.Add "600.01.01", "Pendidikan Lanjutan Untuk Pendeta"
    dict.Add "600.01.02", "Penghargaan Untuk Penatua"
    dict.Add "600.01.03", "Pembinaan & Pelatihan Pelajar Sidi GKPI Medan Kota"
    dict.Add "600.01.04", "Pembinaan Penatua se Resort Medan Barat"

    ' Kategori 600.02: Pelayanan
    dict.Add "600.02.01", "Pembinaan & Pelayanan Rohani (PPR)"
    dict.Add "600.02.02", "Pekabaran Injil (PI)"
    dict.Add "600.02.03", "Diakoni"
    dict.Add "600.02.04", "Musik, Nyanyian & Koor (MNK)"
    dict.Add "600.02.05", "Sekolah Minggu"
    dict.Add "600.02.06", "Remaja"
    dict.Add "600.02.07", "Pemuda"
    dict.Add "600.02.08", "Perempuan"
    dict.Add "600.02.09", "Pria"
    dict.Add "600.02.10", "Lansia"
    dict.Add "600.02.11", "Kesehatan"
    dict.Add "600.02.12", "Pendidikan"
    dict.Add "600.02.13", "Usaha & Pengembangan Sumber Daya (UPSD)"
    dict.Add "600.02.14", "Sarana & Prasarana"
    dict.Add "600.02.15", "Natal Gabungan Seksi-seksi (Natal II)"

    ' Kategori 600.03: Target dan Biaya
    dict.Add "600.03.01", "Target Ke Kantor Pusat GKPI"
    dict.Add "600.03.02", "Biaya Tahun Renstra GKPI 2023"
    dict.Add "600.03.03", "Kantor Sinode GKPI (Persembahan Kedua)"
    dict.Add "600.04.01", "Target Ke GKPI Ressort Medan Barat"

    ' Kategori 800.01: Bantuan dan Sosial
    dict.Add "800.01.01", "Bantuan ke Jemaat untuk musibah/bencana alam"
    dict.Add "800.01.02", "Akomodasi Acara Penghiburan ke rumah duka"
    dict.Add "800.01.03", "Bantuan untuk Dana Pensiun Pendeta GKPI"
    dict.Add "800.01.04", "Bantuan untuk PA. Mamre dan Yapentra"
    dict.Add "800.01.05", "Bantuan Ke GKPI Lainnya"

    ' Kategori 800.02: Penghargaan dan Insentif
    dict.Add "800.02.01", "Anak - Anak Sekolah Minggu"
    dict.Add "800.02.02", "Penatua Purnabakti"
    dict.Add "800.02.03", "Penatua Aktif"
    dict.Add "800.02.04", "Calon Penatua"
    dict.Add "800.02.05", "Pendeta GKPI Ressort Medan Barat"
    dict.Add "800.02.06", "Anggota Majelis Jemaat: Ketua Seksi, Penasehat, PHBK"
    dict.Add "800.02.07", "Guru-Guru Koor di Jemaat GKPI Medan Kota"
    dict.Add "800.02.08", "Guru-Guru Sekolah Minggu"
    dict.Add "800.02.09", "Pemusik: (Organis, Pianis dan Saxophonis)"
    dict.Add "800.02.10", "Songleader (Pemandu Lagu)"
    dict.Add "800.02.11", "Petugas Live Streaming Minggu"
End Sub





------------------------------------------

| No | Penyakit                          | Obat yang sering digunakan                                                                           |
| -- | --------------------------------- | ---------------------------------------------------------------------------------------------------- |
| 1  | Common cold (flu biasa)           | Obat simptomatik (decongestant, dekongestan)                                                         |
| 2  | Gastroenteritis (diare / muntah)  | Oralit, zinc                                                                                         |
| 3  | Obesitas                           | Obat GLP-1 seperti **Ozempic** / lifestyle                                                           |
| 4  | GERD (Heartburn)                  | Proton pump inhibitor (misal: omeprazol) ([theresafoodforthat.com][1], [The Wall Street Journal][2]) |
| 5  | Hipertensi (tekanan darah tinggi) | ACE inhibitor (contoh: captopril) ([Verywell Health][3])                                             |
| 6  | Diabetes tipe II                  | Metformin ([Verywell Health][3], [TIME][4])                                                          |
| 7  | Infeksi saluran kemih (UTI)       | Antibiotik (misal: trimethoprim-sulfamethoxazole) ([medlistapp.paho.org][5])                         |
| 8  | Infeksi saluran napas atas (URTI) | Antibiotik / simptomatik                                                                             |
| 9  | Pneumonia                         | Antibiotik seperti amoksisilin atau makrolida ([Andedge][6])                                         |
| 10 | Asma / COPD                       | Inhaler beta-agonist (Salbutamol)                                                                    |
| 11 | Allergi rhinitis                  | Antihistamin oral (misal: loratadine)                                                                |
| 12 | Depresi / Anxiety                 | SSRI (fluoxetine, sertraline)                                                                        |
| 13 | Migraine                          | Triptans (sumatriptan) atau analgesik                                                                |
| 14 | Osteoarthritis                    | NSAID (ibuprofen, naproxen)                                                                          |
| 15 | Osteoporosis                      | Bisphosphonates (alendronate)                                                                        |
| 16 | Penyakit jantung koroner (CAD)    | Statin (atorvastatin)                                                                                |
| 17 | Stroke / TIA                      | Antiplatelet (aspirin) + kontrol tekanan                                                             |
| 18 | TB (Tuberkulosis)                 | Regimen multi‚Äëobat (rifampisin, isoniazid) ([Andedge][6])                                            |
| 19 | Hepatitis B / C                   | Antiviral (tenofovir, sofosbuvir, dll.)                                                              |
| 20 | HIV/AIDS                          | Kombinasi antiretroviral (zidovudine, lamivudine) ([deluxehospital.com][7])                          |

[1]: https://www.theresafoodforthat.com/top-100-diseases-conditions-united-states/?utm_source=chatgpt.com "Diseases and Conditions - There's a Food for That"
[2]: https://www.wsj.com/health/pharma/glp-1-drugs-health-benefits-4014d7d5?utm_source=chatgpt.com "Should Everyone Be Taking Ozempic? Doctors Say More People Could Benefit"
[3]: https://www.verywellhealth.com/drug-induced-nutrient-deficiency-11762683?utm_source=chatgpt.com "10 Common Medications That May Be Disrupting Your Body's Nutrient Balance"
[4]: https://time.com/6980440/eli-lilly/?utm_source=chatgpt.com "Eli Lilly"
[5]: https://medlistapp.paho.org/en/list/11?utm_source=chatgpt.com "WHO Model List of Essential Medicines (2021) | List | Annotated Medicine and Device Lists"
[6]: https://www.andedge.com/human-diseases/?utm_source=chatgpt.com "Human Diseases Tnpsc | Andedge"
[7]: https://deluxehospital.com/health-articles/general-health-knowledge/an-educational-guide-to-400-common-medications-prescribed-in-ghana?utm_source=chatgpt.com "Deluxe Hospital"


-------------------------------------------

4 agustus

formpengeluaran:




' Kode untuk FormPengeluaran (UserForm)
Option Explicit

Private Sub Label4_Click()

End Sub

Private Sub UserForm_Initialize()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim dictKategori As Object
    Dim i As Long
    Dim kode As String, nama As String
    
    ' Initialize form controls
    txtTanggal.Value = Format(Date, "dd-mmm-yy")
    txtJumlah.Value = "0"
    
    ' Set worksheet reference (change "Sheet4" to your actual sheet name)
    Set ws = ThisWorkbook.Sheets("4")
    Set dictKategori = CreateObject("Scripting.Dictionary")
    
    ' Find last row in Sheet4
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Loop through rows and populate unique categories
    For i = 2 To lastRow
        kode = Trim(ws.Cells(i, 1).Value)
        nama = Trim(ws.Cells(i, 2).Value)
        If Not dictKategori.exists(kode) Then
            dictKategori.Add kode, nama
        End If
    Next i
    
    ' Populate category combo box
    cmbKategori.Clear
    Dim k As Variant
    For Each k In dictKategori.keys
        cmbKategori.AddItem k & " - " & dictKategori(k)
    Next k
    
    ' Initialize subcategory combo box
    cmbSubKategori.Clear
    cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
    cmbSubKategori.Enabled = False
    cmbSubKategori.ListIndex = 0
End Sub

Private Sub cmbKategori_Change()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim kategoriKode As String
    Dim kode As String, uraian As String
    
    ' Exit if no category selected
    If cmbKategori.ListIndex = -1 Then Exit Sub
    
    ' Extract category code (e.g., "200" from "200 - ADMINISTRASI GEREJA")
    kategoriKode = Trim(Split(cmbKategori.Value, "-")(0))
    
    ' Set worksheet reference
    Set ws = ThisWorkbook.Sheets("4")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Clear and enable subcategory combo box
    cmbSubKategori.Clear
    cmbSubKategori.Enabled = True
    
    ' Add subcategories based on category code with format "kode - uraian"
    For i = 2 To lastRow
        If Trim(ws.Cells(i, 1).Value) = kategoriKode Then
            kode = Trim(ws.Cells(i, 3).Value)
            uraian = Trim(ws.Cells(i, 4).Value)
            cmbSubKategori.AddItem kode & " - " & uraian
        End If
    Next i
    
    ' If no subcategories found
    If cmbSubKategori.ListCount = 0 Then
        cmbSubKategori.AddItem "Subkategori tidak ditemukan"
        cmbSubKategori.Enabled = False
    End If
    
    ' Select first item if available
    If cmbSubKategori.ListCount > 0 Then
        cmbSubKategori.ListIndex = 0
    End If
End Sub

Private Sub cmbSubKategori_Change()
    Dim fullText As String
    Dim posDash As Integer
    
    fullText = cmbSubKategori.Value
    posDash = InStr(fullText, "-")
    
    If posDash > 0 Then
        ' Ambil hanya bagian setelah tanda "-" (uraian)
        txtUraian.Value = Trim(Mid(fullText, posDash + 1))
    Else
        ' Jika tidak ada tanda "-", tampilkan teks asli
        txtUraian.Value = fullText
    End If
End Sub

Private Sub btnSubmit_Click()
    On Error GoTo ErrorHandler
    
    ' Process saving data to worksheet
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim selectedKategori As String
    Dim kategoriKolom As String
    Dim nominalKolom As String
    Dim jumlah As Double
    
    ' Validate input
    If Not ValidasiInput() Then Exit Sub
    
    Set ws = ThisWorkbook.Sheets("1")
    
    ' Get values from form
    selectedKategori = Left(cmbKategori.Value, 3) ' Get first 3 digits (200, 400, etc)
    Dim setor As Double
    If IsNumeric(txtSetor.Value) And Trim(txtSetor.Value) <> "" Then
        setor = CDbl(txtSetor.Value)
    Else
        setor = 0
    End If
    jumlah = CDbl(txtJumlah.Value) + setor
    
    ' Determine target columns based on category
    Select Case selectedKategori
        Case "200"
            kategoriKolom = "E"
            nominalKolom = "F"
        Case "400"
            kategoriKolom = "G"
            nominalKolom = "H"
        Case "600"
            kategoriKolom = "I"
            nominalKolom = "J"
        Case "800"
            kategoriKolom = "K"
            nominalKolom = "L"
    End Select
    
    ' Cek jika baris 3 kosong (belum ada judul)
    If ws.Range("A3").Value = "" Then
        lastRow = 3 ' Tulis di baris 3 jika kosong
    Else
        ' Jika baris 3 sudah ada judul, cari baris terakhir yang berisi data
        lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row + 1
    End If
    
    ' Fill data to sheet
    With ws
        ' Basic columns
        .Cells(lastRow, "A").Value = CDate(txtTanggal.Value) ' Date
        .Cells(lastRow, "A").NumberFormat = "dd-mmm-yy"      ' Date display format
        .Cells(lastRow, "B").Value = txtKW.Value ' KW number
        .Cells(lastRow, "C").Value = txtUraian.Value ' Description (hanya uraian)
        .Cells(lastRow, "D").Value = jumlah ' Credit (Cash Out)
        
        ' Fill based on category
        ' Ambil hanya kode subkategori (sebelum tanda "-")
        Dim subKodeOnly As String
        Dim posDash As Integer
        posDash = InStr(cmbSubKategori.Value, "-")
        If posDash > 0 Then
            subKodeOnly = Trim(Left(cmbSubKategori.Value, posDash - 1))
        Else
            subKodeOnly = cmbSubKategori.Value
        End If
        
        .Cells(lastRow, kategoriKolom).Value = subKodeOnly ' Hanya kode
        .Cells(lastRow, nominalKolom).Value = CDbl(txtJumlah.Value) ' Category amount only
        
        ' Additional notes
        .Cells(lastRow, "M").Value = txtSetor.Value
    End With
    
    ' Clear form after save
    BersihkanForm
    
    ' Run data grouping process
    Application.ScreenUpdating = False ' Disable screen updating to speed up process
    Call SalinTotalKeSheet3_Horizontal
    Call kelompokkanData_Terstruktur
    Application.ScreenUpdating = True ' Re-enable screen updating
    
    MsgBox "Data pengeluaran berhasil disimpan dan laporan telah diperbarui!", vbInformation
    
    Exit Sub
    
ErrorHandler:
    Application.ScreenUpdating = True ' Ensure screen updating is re-enabled if error occurs
    If Err.Number = 380 Then
        MsgBox "Silakan pilih subkategori yang valid", vbExclamation
        cmbSubKategori.SetFocus
    Else
        MsgBox "Error " & Err.Number & ": " & Err.Description, vbCritical
    End If
End Sub

Private Function ValidasiInput() As Boolean
    ValidasiInput = False
    
    ' Validate date
    If Not IsDate(txtTanggal.Value) Then
        MsgBox "Format tanggal tidak valid. Gunakan format DD-MMM-YY", vbExclamation
        txtTanggal.SetFocus
        Exit Function
    End If
    
    ' Validate KW
    If Trim(txtKW.Value) = "" Then
        MsgBox "Nomor KW harus diisi", vbExclamation
        txtKW.SetFocus
        Exit Function
    End If
    
    ' Validate description
    If Trim(txtUraian.Value) = "" Then
        MsgBox "Uraian pengeluaran harus diisi", vbExclamation
        txtUraian.SetFocus
        Exit Function
    End If
    
    ' Validate amount
    If Not IsNumeric(txtJumlah.Value) Or CDbl(txtJumlah.Value) <= 0 Then
        MsgBox "Jumlah pengeluaran harus angka dan lebih dari 0", vbExclamation
        txtJumlah.SetFocus
        Exit Function
    End If
    
    ' Validate category
    If cmbKategori.ListIndex = -1 Then
        MsgBox "Silakan pilih kategori pengeluaran", vbExclamation
        cmbKategori.SetFocus
        Exit Function
    End If
    
    ' Validate subcategory
    If cmbSubKategori.ListIndex = -1 Then
        MsgBox "Silakan pilih sub kategori", vbExclamation
        cmbSubKategori.SetFocus
        Exit Function
    End If
    
    ValidasiInput = True
End Function

Private Sub BersihkanForm()
    ' Reset all inputs except date
    txtKW.Value = ""
    txtUraian.Value = ""
    txtJumlah.Value = "0"
    cmbKategori.ListIndex = -1
    cmbSubKategori.Clear
    cmbSubKategori.AddItem "Pilih kategori terlebih dahulu"
    cmbSubKategori.Enabled = False
    cmbSubKategori.ListIndex = 0
    txtSetor.Value = ""
End Sub

Private Sub btnCancel_Click()
    Unload Me
End Sub

Private Sub txtJumlah_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    ' Only allow numbers and backspace
    If Not (KeyAscii >= 48 And KeyAscii <= 57 Or KeyAscii = 8 Or KeyAscii = 46) Then
        KeyAscii = 0
        Beep
    End If
End Sub


--------------------------------------------
module2


Sub TampilkanFormPengeluaran()
    FormPengeluaran.Show
End Sub



-------------------------------------------

module3:



Sub kelompokkanData_Terstruktur()
    Dim wsSumber As Worksheet, wsTujuan As Worksheet, wsKategori As Worksheet
    Dim wb As Workbook
    Set wb = ThisWorkbook

    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("2")
    Set wsKategori = wb.Sheets("4")
    On Error GoTo 0

    If wsSumber Is Nothing Or wsTujuan Is Nothing Or wsKategori Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1', '2', dan '4' tersedia."
        Exit Sub
    End If

    ' Dapatkan dictionary kategori dari Sheet4
    Dim dictKategori As Object
    Set dictKategori = CreateObject("Scripting.Dictionary")
    Call BacaKategoriDanSubkategori(wsKategori, dictKategori)
    
    ' Cek jika ada data
    Dim lastRow As Long
    lastRow = wsSumber.Cells(wsSumber.Rows.Count, 1).End(xlUp).Row
    If lastRow < 4 Then
        MsgBox "Tidak ada data untuk diproses."
        Exit Sub
    End If

    ' Baca data
    Dim data As Variant
    data = wsSumber.Range("A1:L" & lastRow).Value

    ' Inisialisasi dictionary untuk pengelompokan
    Dim kelompok As Object
    Set kelompok = CreateObject("Scripting.Dictionary")

    ' Variabel untuk loop
    Dim i As Long
    Dim tgl As Variant, kwitansi As Variant, uraian As Variant, kas As Variant
    Dim kodeSub As String, bulan As String
    Dim IsUangSetoran As Boolean

    ' Membaca data dan kelompokkan
    For i = 4 To UBound(data, 1)
        ' Baca data dasar
        tgl = data(i, 1)
        kwitansi = data(i, 2)
        uraian = data(i, 3)
        kas = data(i, 4)
        
        ' Tentukan bulan
        If IsDate(tgl) And tgl <> "" Then
            bulan = Format(tgl, "MMMM YYYY")
        Else
            bulan = "Tanggal Tidak Valid"
        End If

        ' Cek kriteria Uang Setoran
        IsUangSetoran = False
        If IsNumeric(kas) And kas <> "" Then
            If Trim(data(i, 5)) = "" And Trim(data(i, 7)) = "" And _
               Trim(data(i, 9)) = "" And Trim(data(i, 11)) = "" Then
                IsUangSetoran = True
            End If
        End If

        ' Tentukan kode subkategori
        If IsUangSetoran Then
            kodeSub = "Uang Setoran"
        Else
            ' Gabungkan kode subkategori jika ada
            kodeSub = Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11))
            kodeSub = WorksheetFunction.Trim(kodeSub)
            If kodeSub = "" Then kodeSub = "Lainnya"
        End If

        ' Tambahkan ke dictionary
        If Not kelompok.exists(bulan) Then
            kelompok.Add bulan, CreateObject("Scripting.Dictionary")
        End If

        If Not kelompok(bulan).exists(kodeSub) Then
            kelompok(bulan).Add kodeSub, New Collection
        End If

        ' Tambahkan data ke collection
        kelompok(bulan)(kodeSub).Add Array(tgl, kwitansi, uraian, kas, kodeSub)
    Next i

    ' Bersihkan sheet tujuan
    wsTujuan.Cells.Clear

    ' Mulai tulis hasil ke Sheet2
    Dim startRow As Long, startCol As Long
    startCol = 1
    Dim colSpacing As Long: colSpacing = 3

    ' Urutkan bulan dengan aman
    Dim bulanKeys() As Variant
    bulanKeys = GetKeysAsArray(kelompok)
    If Not IsEmpty(bulanKeys) Then
        Call BubbleSort(bulanKeys)
    End If

    ' Loop melalui setiap bulan
    Dim bulanKey As Variant, kodeSubKey As Variant
    For Each bulanKey In bulanKeys
        startRow = 1
        
        ' Tulis header bulan
        With wsTujuan.Cells(startRow, startCol)
            .Value = UCase(CStr(bulanKey))
            .Font.Bold = True
            .Font.Size = 12
        End With
        startRow = startRow + 1

        ' Urutkan kode subkategori dengan aman
        Dim kodeSubKeys() As Variant
        kodeSubKeys = GetKeysAsArray(kelompok(bulanKey))
        If Not IsEmpty(kodeSubKeys) Then
            Call BubbleSort(kodeSubKeys)
        End If

        ' Loop melalui setiap kode subkategori
        For Each kodeSubKey In kodeSubKeys
            ' Tulis header subkategori
            With wsTujuan.Cells(startRow, startCol)
                .Value = "Subkategori: " & CStr(kodeSubKey)
                .Font.Bold = True
            End With
            startRow = startRow + 1
            
            ' Tulis header kolom
            With wsTujuan.Cells(startRow, startCol).Resize(1, 5)
                .Value = Array("Tanggal", "Kwitansi", "Uraian", "Kas", "Kode Subkategori")
                .Font.Bold = True
                .Borders(xlEdgeBottom).LineStyle = xlContinuous
            End With
            startRow = startRow + 1

            ' Tulis data
            Dim dataItem As Variant
            Dim totalKas As Double: totalKas = 0
            Dim r As Long: r = 0
            
            For Each dataItem In kelompok(bulanKey)(kodeSubKey)
                ' Pastikan ini array
                If IsArray(dataItem) Then
                    ' Tulis data dengan format
                    With wsTujuan.Cells(startRow + r, startCol)
                        .Value = dataItem(0) ' Tanggal
                        .NumberFormat = "dd-mmm-yyyy"
                    End With
                    
                    With wsTujuan.Cells(startRow + r, startCol + 1)
                        .Value = dataItem(1) ' Kwitansi
                    End With
                    
                    ' Kolom Uraian - dibatasi lebar dan wrap text
                    With wsTujuan.Cells(startRow + r, startCol + 2)
                        .Value = dataItem(2) ' Uraian
                        .WrapText = True
                        .ColumnWidth = 30 ' Lebar kolom uraian 30 karakter
                        .Rows.RowHeight = 15 ' Tinggi baris disesuaikan
                    End With
                    
                    ' Kolom Kas
                    With wsTujuan.Cells(startRow + r, startCol + 3)
                        If IsNumeric(dataItem(3)) Then
                            .Value = dataItem(3)
                            .NumberFormat = "#,##0"
                            totalKas = totalKas + CDbl(dataItem(3))
                        Else
                            .Value = dataItem(3)
                        End If
                    End With
                    
                    ' Kode Subkategori
                    With wsTujuan.Cells(startRow + r, startCol + 4)
                        .Value = dataItem(4)
                    End With
                    
                    r = r + 1
                End If
            Next dataItem

            ' Tulis total kas
            startRow = startRow + r
            With wsTujuan.Cells(startRow, startCol)
                .Value = "Total Kas " & CStr(kodeSubKey)
                .Font.Bold = True
            End With
            With wsTujuan.Cells(startRow, startCol + 3)
                .Value = totalKas
                .NumberFormat = "#,##0"
                .Font.Bold = True
                .Borders(xlEdgeTop).LineStyle = xlContinuous
            End With
            startRow = startRow + 2
        Next kodeSubKey

        ' Geser ke kolom berikutnya
        startCol = startCol + 6 + colSpacing
    Next bulanKey

    ' Format kolom secara spesifik
    Dim lastCol As Long
    lastCol = wsTujuan.Cells.Find("*", , xlFormulas, , xlByColumns, xlPrevious).Column
    
    For i = 1 To lastCol
        Select Case i Mod (6 + colSpacing)
            Case 1 ' Kolom Tanggal
                wsTujuan.Columns(i).ColumnWidth = 12
            Case 2 ' Kolom Kwitansi
                wsTujuan.Columns(i).ColumnWidth = 15
            Case 3 ' Kolom Uraian (sudah diatur sebelumnya)
                ' Tidak perlu diubah lagi
            Case 4 ' Kolom Kas
                wsTujuan.Columns(i).ColumnWidth = 15
            Case 5 ' Kolom Kode Subkategori
                wsTujuan.Columns(i).ColumnWidth = 20
            Case Else ' Kolom kosong antar kelompok
                wsTujuan.Columns(i).ColumnWidth = 3
        End Select
    Next i

    MsgBox "Pengelompokan data selesai dengan tampilan yang rapi."
End Sub

' Fungsi untuk mendapatkan keys dari dictionary sebagai array dengan aman
Function GetKeysAsArray(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long
    
    If dict.Count = 0 Then
        GetKeysAsArray = Array()
        Exit Function
    End If
    
    ReDim keys(dict.Count - 1)
    i = 0
    
    Dim key As Variant
    For Each key In dict.keys
        keys(i) = key
        i = i + 1
    Next key
    
    GetKeysAsArray = keys
End Function

' Fungsi BubbleSort yang diperbaiki untuk menangani berbagai tipe data
Sub BubbleSort(arr() As Variant)
    Dim i As Long, j As Long
    Dim temp As Variant
    
    If UBound(arr) < LBound(arr) Then Exit Sub
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Gunakan CStr untuk memastikan perbandingan string yang aman
            If CStr(arr(i)) > CStr(arr(j)) Then
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        Next j
    Next i
End Sub




----------------------------------------------

module 4:



Sub SalinTotalKeSheet3_Horizontal()
    ' Deklarasi semua variabel
    Dim wsSumber As Worksheet, wsTujuan As Worksheet, wsAnggaran As Worksheet
    Dim wb As Workbook
    Dim data As Variant
    Dim totalKas As Object, uraianDict As Object, subKategoriDict As Object
    Dim allBulan As Object, kategoriDict As Object, totalPerKategoriBulan As Object
    Dim totalPerKelompok As Object, totalKeseluruhanPerBulan As Object, uangSetoranDict As Object
    Dim tempTotalPerKelompok As Object, bulanCol As Object, anggaranDict As Object
    Dim allCategories As Object, allSubCategories As Object
    Dim i As Long, tgl As Variant, kas As Double
    Dim kodeSub As String, kategori As String, bulan As String
    Dim kelompokKey As String, kelompokTotalKey As String, uniqueKey As String, totalKey As String
    Dim bulanList() As String, idx As Long, colIndex As Long, rowIndex As Long
    Dim bulanKey As Variant, key As Variant
    Dim totalUangSetoran As Double, totalSubKategori As Double, totalKategori As Double
    Dim totalKelompok As Double, totalKeseluruhan As Double
    Dim lastCol As Long
    Dim firstRowInCategory As Long
    Dim isLastKategoriInKelompok As Boolean
    Dim k As Variant, kategoriKey As Variant, subKategoriKey As Variant
    Dim sortedKategoriKeys() As Variant, sortedSubKategoriKeys() As Variant
    Dim anggaranKey As String
    Dim hasDataInGroup As Boolean
    
    ' Set workbook dan worksheet
    Set wb = ThisWorkbook
    
    ' Pastikan sheet sumber dan tujuan ada
    On Error Resume Next
    Set wsSumber = wb.Sheets("1")
    Set wsTujuan = wb.Sheets("3")
    Set wsAnggaran = wb.Sheets("4")
    On Error GoTo 0
    
    If wsSumber Is Nothing Or wsTujuan Is Nothing Then
        MsgBox "Sheet tidak ditemukan. Pastikan '1' dan '3' tersedia.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary anggaran
    Set anggaranDict = CreateObject("Scripting.Dictionary")
    If Not wsAnggaran Is Nothing Then
        Call BacaAnggaranPendapatan(wsAnggaran, anggaranDict)
    End If
    
    ' Ambil data dari sheet sumber
    data = wsSumber.UsedRange.Value
    
    ' Pastikan ada data untuk diproses
    If UBound(data, 1) < 4 Then
        MsgBox "Tidak ada data untuk diproses.", vbExclamation
        Exit Sub
    End If
    
    ' Inisialisasi dictionary
    Set totalKas = CreateObject("Scripting.Dictionary")
    Set uraianDict = CreateObject("Scripting.Dictionary")
    Set subKategoriDict = CreateObject("Scripting.Dictionary")
    Set allBulan = CreateObject("Scripting.Dictionary")
    Set kategoriDict = CreateObject("Scripting.Dictionary")
    Set totalPerKategoriBulan = CreateObject("Scripting.Dictionary")
    Set totalPerKelompok = CreateObject("Scripting.Dictionary")
    Set totalKeseluruhanPerBulan = CreateObject("Scripting.Dictionary")
    Set uangSetoranDict = CreateObject("Scripting.Dictionary")
    Set allCategories = CreateObject("Scripting.Dictionary")
    Set allSubCategories = CreateObject("Scripting.Dictionary")
    
    ' Inisialisasi uraian kode subkategori dari Sheet4
    Call BacaKategoriDanSubkategori(wsAnggaran, uraianDict)
    
    ' Kumpulkan semua kategori dan subkategori dari uraianDict
    For Each key In uraianDict.keys
        ' Ambil kategori utama (6 karakter pertama)
        If Len(key) >= 6 Then
            kategori = Left(key, 6)
        Else
            kategori = key
        End If
        
        ' Tambahkan ke dictionary kategori jika belum ada
        If Not allCategories.exists(kategori) Then
            allCategories.Add kategori, Nothing
            allSubCategories.Add kategori, CreateObject("Scripting.Dictionary")
        End If
        
        ' Tambahkan subkategori
        If Not allSubCategories(kategori).exists(key) Then
            allSubCategories(kategori).Add key, nothing
        End If
    Next key
    
    ' Proses data sumber
    For i = 4 To UBound(data, 1)
        ' Ambil nilai kas dari kolom 4
        kas = 0
        If Not IsEmpty(data(i, 4)) And IsNumeric(data(i, 4)) Then
            kas = data(i, 4)
        End If
        
        ' Skip jika tidak ada nilai kas
        If kas = 0 Then
            GoTo NextIteration
        End If
        
        ' Ambil bulan dari tanggal (kolom 1)
        If IsDate(data(i, 1)) Then
            bulan = Format(data(i, 1), "mmmm yyyy")
        Else
            bulan = "Tidak Diketahui"
        End If
        
        ' Tambahkan bulan ke dictionary jika belum ada
        If Not allBulan.exists(bulan) Then
            allBulan.Add bulan, nothing
            totalKeseluruhanPerBulan.Add bulan, 0
        End If
        
        ' Identifikasi apakah ini Uang Setoran
        If IsUangSetoran(data, i) Then
            ' Proses khusus untuk Uang Setoran
            kategori = "Uang Setoran"
            kodeSub = "Uang Setoran"
            
            ' Akumulasi total Uang Setoran per bulan
            If uangSetoranDict.exists(bulan) Then
                uangSetoranDict(bulan) = uangSetoranDict(bulan) + kas
            Else
                uangSetoranDict.Add bulan, kas
            End If
        Else
            ' Proses untuk kategori lainnya
            kodeSub = CleanCode(Trim(data(i, 5) & " " & data(i, 7) & " " & data(i, 9) & " " & data(i, 11)))
            
            ' Skip jika kode subkategori kosong
            If kodeSub = "" Then
                GoTo NextIteration
            End If
            
            ' Ambil kategori utama (6 karakter pertama)
            If Len(kodeSub) >= 6 Then
                kategori = Left(kodeSub, 6)
            Else
                kategori = kodeSub
            End If
            
            ' Tambahkan ke dictionary kategori jika belum ada
            If Not kategoriDict.exists(kategori) Then
                kategoriDict.Add kategori, nothing
                subKategoriDict.Add kategori, CreateObject("Scripting.Dictionary")
            End If
            
            ' Buat key unik untuk total kas
            uniqueKey = kategori & "|" & kodeSub & "|" & bulan
            
            ' Akumulasi total kas per subkategori
            If Not subKategoriDict(kategori).exists(kodeSub) Then
                subKategoriDict(kategori).Add kodeSub, nothing
            End If

            If totalKas.exists(uniqueKey) Then
                totalKas(uniqueKey) = totalKas(uniqueKey) + kas
            Else
                totalKas.Add uniqueKey, kas
            End If
            
            ' Ambil 3 angka pertama untuk kelompok
            If Len(kodeSub) >= 3 Then
                kelompokKey = Left(kodeSub, 3)
            Else
                kelompokKey = kodeSub
            End If

            ' Akumulasi total per kelompok
            kelompokTotalKey = kelompokKey & "|" & bulan
            If totalPerKelompok.exists(kelompokTotalKey) Then
                totalPerKelompok(kelompokTotalKey) = totalPerKelompok(kelompokTotalKey) + kas
            Else
                totalPerKelompok.Add kelompokTotalKey, kas
            End If

            ' Akumulasi total per kategori
            totalKey = kategori & "|" & bulan
            If totalPerKategoriBulan.exists(totalKey) Then
                totalPerKategoriBulan(totalKey) = totalPerKategoriBulan(totalKey) + kas
            Else
                totalPerKategoriBulan.Add totalKey, kas
            End If
        End If
        
        ' Akumulasi total keseluruhan per bulan
        totalKeseluruhanPerBulan(bulan) = totalKeseluruhanPerBulan(bulan) + kas
        
NextIteration:
    Next i
    
    ' Bersihkan sheet tujuan dan siapkan header
    wsTujuan.Cells.Clear
    wsTujuan.Cells(1, 1).Value = "Kategori"
    wsTujuan.Cells(1, 2).Value = "Kode Subkategori"
    wsTujuan.Cells(1, 3).Value = "Uraian"
    
    ' Atur header bulan secara horizontal
    idx = 0
    ReDim bulanList(allBulan.Count - 1)
    
    For Each bulanKey In allBulan.keys
        bulanList(idx) = bulanKey
        idx = idx + 1
    Next bulanKey
    
    ' Urutkan bulan secara kronologis
    Call BubbleSort(bulanList)
    
    Set bulanCol = CreateObject("Scripting.Dictionary")
    
    colIndex = 4
    For idx = LBound(bulanList) To UBound(bulanList)
        bulanKey = bulanList(idx)
        wsTujuan.Cells(1, colIndex).Value = bulanKey
        bulanCol.Add bulanKey, colIndex
        colIndex = colIndex + 1
    Next idx
    
    ' Tambahkan kolom Total, Anggaran Pendapatan, dan Selisih
    wsTujuan.Cells(1, colIndex).Value = "Total"
    wsTujuan.Cells(1, colIndex + 1).Value = "Anggaran Pendapatan"
    wsTujuan.Cells(1, colIndex + 2).Value = "Selisih"
    
    ' Mulai menulis data ke sheet tujuan
    rowIndex = 2

    ' Tulis Uang Setoran terlebih dahulu jika ada
    If uangSetoranDict.Count > 0 Then
        wsTujuan.Cells(rowIndex, 1).Value = "Uang Setoran"
        wsTujuan.Cells(rowIndex, 2).Value = ""
        wsTujuan.Cells(rowIndex, 3).Value = ""
        
        totalUangSetoran = 0
        
        For Each bulanKey In bulanCol.keys
            If uangSetoranDict.exists(bulanKey) Then
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = uangSetoranDict(bulanKey)
                totalUangSetoran = totalUangSetoran + uangSetoranDict(bulanKey)
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(200, 255, 200) ' Hijau muda
            Else
                wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
            End If
        Next bulanKey
        
        ' Tulis total
        wsTujuan.Cells(rowIndex, colIndex).Value = totalUangSetoran
        wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(200, 255, 200)
        
        ' Kosongkan kolom anggaran pendapatan
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
        
        ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
        wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
            wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
            wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
        wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
        
        rowIndex = rowIndex + 1
    End If

    ' Proses kategori lainnya
    Set tempTotalPerKelompok = CreateObject("Scripting.Dictionary")

    ' Urutkan kategori dari allCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
    sortedKategoriKeys = GetSortedKeys(allCategories)
    
    ' Loop melalui setiap kategori
    For Each kategoriKey In sortedKategoriKeys
        ' Skip Uang Setoran jika sudah diproses
        If kategoriKey = "Uang Setoran" Then
            GoTo NextKategori
        End If
        
        firstRowInCategory = rowIndex

        ' Ambil kelompok dari 3 angka pertama kategori
        kelompokKey = Left(kategoriKey, 3)

        ' Inisialisasi total sementara per kelompok
        If Not tempTotalPerKelompok.exists(kelompokKey) Then
            tempTotalPerKelompok.Add kelompokKey, CreateObject("Scripting.Dictionary")
        End If

        ' Urutkan subkategori dari allSubCategories (gabungan antara yang ada di data dan yang ada di uraianDict)
        sortedSubKategoriKeys = GetSortedKeys(allSubCategories(kategoriKey))
        
        ' Loop melalui subkategori
        For Each subKategoriKey In sortedSubKategoriKeys
            ' Tulis data kategori dan subkategori
            wsTujuan.Cells(rowIndex, 1).Value = kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = subKategoriKey
            
            ' Tambahkan uraian jika ada
            If uraianDict.exists(subKategoriKey) Then
                wsTujuan.Cells(rowIndex, 3).Value = uraianDict(subKategoriKey)
            Else
                wsTujuan.Cells(rowIndex, 3).Value = "Uraian Tidak Diketahui"
            End If
            
            ' Tulis total per bulan
            totalSubKategori = 0
            For Each bulanKey In bulanCol.keys
                uniqueKey = kategoriKey & "|" & subKategoriKey & "|" & bulanKey
                If totalKas.exists(uniqueKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKas(uniqueKey)
                    totalSubKategori = totalSubKategori + totalKas(uniqueKey)
                    
                    ' Akumulasi total kelompok
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        tempTotalPerKelompok(kelompokKey)(bulanKey) = tempTotalPerKelompok(kelompokKey)(bulanKey) + totalKas(uniqueKey)
                    Else
                        tempTotalPerKelompok(kelompokKey).Add bulanKey, totalKas(uniqueKey)
                    End If
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            ' Tulis total subkategori
            wsTujuan.Cells(rowIndex, colIndex).Value = totalSubKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80) ' Hijau
            
            ' Isi kolom anggaran pendapatan jika ada data di Sheet4
            anggaranKey = subKategoriKey & "|" & bulanKey
            If anggaranDict.exists(anggaranKey) Then
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = anggaranDict(anggaranKey)
            Else
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = 0
            End If
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        Next subKategoriKey
        
        ' Tulis total kategori hanya jika ada transaksi untuk kategori ini
        If kategoriDict.exists(kategoriKey) Then
            wsTujuan.Cells(rowIndex, 1).Value = "Total " & kategoriKey
            wsTujuan.Cells(rowIndex, 2).Value = ""
            wsTujuan.Cells(rowIndex, 3).Value = ""
            
            totalKategori = 0
            For Each bulanKey In bulanCol.keys
                totalKey = kategoriKey & "|" & bulanKey
                If totalPerKategoriBulan.exists(totalKey) Then
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalPerKategoriBulan(totalKey)
                    totalKategori = totalKategori + totalPerKategoriBulan(totalKey)
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(146, 208, 80) ' Hijau
                Else
                    wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                End If
            Next bulanKey
            
            wsTujuan.Cells(rowIndex, colIndex).Value = totalKategori
            wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(146, 208, 80)
            
            ' Kosongkan kolom anggaran pendapatan
            wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
            
            ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
            wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
            wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
            
            rowIndex = rowIndex + 1
        End If

        ' Cek apakah ini kategori terakhir dalam kelompok
        isLastKategoriInKelompok = True
        For Each k In sortedKategoriKeys
            If Left(k, 3) = kelompokKey And k > kategoriKey Then
                isLastKategoriInKelompok = False
                Exit For
            End If
        Next k

        ' Jika ini kategori terakhir dalam kelompok, tulis total kelompok
        If isLastKategoriInKelompok Then
            ' Hitung total kelompok dari tempTotalPerKelompok
            hasDataInGroup = False
            
            ' Cek apakah ada data dalam kelompok ini
            For Each bulanKey In bulanCol.keys
                kelompokTotalKey = kelompokKey & "|" & bulanKey
                If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                    hasDataInGroup = True
                    Exit For
                End If
            Next bulanKey
            
            If hasDataInGroup Then
                wsTujuan.Cells(rowIndex, 1).Value = "Total Kelompok " & kelompokKey
                wsTujuan.Cells(rowIndex, 2).Value = ""
                wsTujuan.Cells(rowIndex, 3).Value = ""

                totalKelompok = 0
                For Each bulanKey In bulanCol.keys
                    kelompokTotalKey = kelompokKey & "|" & bulanKey
                    If tempTotalPerKelompok(kelompokKey).exists(bulanKey) Then
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = tempTotalPerKelompok(kelompokKey)(bulanKey)
                        totalKelompok = totalKelompok + tempTotalPerKelompok(kelompokKey)(bulanKey)
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(255, 255, 0) ' Kuning
                    Else
                        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = 0
                    End If
                Next bulanKey

                wsTujuan.Cells(rowIndex, colIndex).Value = totalKelompok
                wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(255, 255, 0)
                
                ' Kosongkan kolom anggaran pendapatan
                wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
                
                ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
                wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
                    wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
                    wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
                wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
                
                rowIndex = rowIndex + 1
            End If
        End If
        
NextKategori:
    Next kategoriKey

    ' Tulis Total Keseluruhan
    wsTujuan.Cells(rowIndex, 1).Value = "Total Keseluruhan"
    wsTujuan.Cells(rowIndex, 2).Value = ""
    wsTujuan.Cells(rowIndex, 3).Value = ""
    
    totalKeseluruhan = 0
    For Each bulanKey In bulanCol.keys
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Value = totalKeseluruhanPerBulan(bulanKey)
        totalKeseluruhan = totalKeseluruhan + totalKeseluruhanPerBulan(bulanKey)
        wsTujuan.Cells(rowIndex, bulanCol(bulanKey)).Interior.Color = RGB(0, 176, 240) ' Biru
    Next bulanKey
    
    wsTujuan.Cells(rowIndex, colIndex).Value = totalKeseluruhan
    wsTujuan.Cells(rowIndex, colIndex).Interior.Color = RGB(0, 176, 240)
    
    ' Kosongkan kolom anggaran pendapatan
    If IsEmpty(wsTujuan.Cells(rowIndex, colIndex + 1).Value) Then
        wsTujuan.Cells(rowIndex, colIndex + 1).Value = ""
    End If
    
    ' Tambahkan formula selisih (REVISI: menggunakan relative reference)
    wsTujuan.Cells(rowIndex, colIndex + 2).Formula = "=" & _
        wsTujuan.Cells(rowIndex, colIndex).Address(RowAbsolute:=False, ColumnAbsolute:=False) & "-" & _
        wsTujuan.Cells(rowIndex, colIndex + 1).Address(RowAbsolute:=False, ColumnAbsolute:=False)
    wsTujuan.Cells(rowIndex, colIndex + 2).NumberFormat = "#,##0"
    
    ' Format angka sebagai currency
    lastCol = wsTujuan.Cells(1, wsTujuan.Columns.Count).End(xlToLeft).Column
    wsTujuan.Range(wsTujuan.Cells(2, 4), wsTujuan.Cells(rowIndex, lastCol)).NumberFormat = "#,##0"
    
    ' Auto fit kolom
    wsTujuan.Columns.AutoFit
    
    MsgBox "Proses selesai. Data berhasil disalin ke Sheet 3.", vbInformation
End Sub

' Fungsi dan subrutin pendukung lainnya tetap sama seperti sebelumnya
Sub BacaAnggaranPendapatan(ws As Worksheet, dict As Object)
    Dim data As Variant
    Dim i As Long, j As Long
    Dim kodeSub As String, bulan As String
    Dim key As String
    
    data = ws.UsedRange.Value
    
    If UBound(data, 1) < 2 Or UBound(data, 2) < 4 Then Exit Sub ' Minimal header + 1 baris dan beberapa kolom

    For i = 2 To UBound(data, 1)
        If Trim(data(i, 2)) <> "" Then
            kodeSub = Trim(data(i, 2)) ' Asumsikan kolom ke-2 adalah Kode Subkategori
            
            For j = 4 To UBound(data, 2)
                If Trim(data(1, j)) <> "" Then
                    bulan = Trim(data(1, j))
                    key = kodeSub & "|" & bulan
                    If IsNumeric(data(i, j)) Then
                        dict(key) = data(i, j)
                    Else
                        dict(key) = 0
                    End If
                End If
            Next j
        End If
    Next i
End Sub

Function GetSortedKeys(dict As Object) As Variant
    Dim keys() As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    
    ' Ambil semua kunci dari dictionary
    keys = dict.keys
    
    ' Urutkan kunci menggunakan bubble sort
    For i = LBound(keys) To UBound(keys) - 1
        For j = i + 1 To UBound(keys)
            If keys(i) > keys(j) Then
                temp = keys(i)
                keys(i) = keys(j)
                keys(j) = temp
            End If
        Next j
    Next i
    
    GetSortedKeys = keys
End Function

Function IsUangSetoran(data As Variant, rowIndex As Long) As Boolean
    ' Cek 1: Jika semua kolom kode kosong (5,7,9,11) dan kolom nilai (4) terisi
    If Trim(data(rowIndex, 5) & data(rowIndex, 7) & data(rowIndex, 9) & data(rowIndex, 11)) = "" And _
       Not IsEmpty(data(rowIndex, 4)) Then
        IsUangSetoran = True
        Exit Function
    End If
    
    ' Cek 2: Jika ada keterangan "Uang Setoran" di kolom 13
    If Not IsEmpty(data(rowIndex, 13)) Then
        If InStr(1, CStr(data(rowIndex, 13)), "Uang Setoran", vbTextCompare) > 0 Then
            IsUangSetoran = True
            Exit Function
        End If
    End If
    
    IsUangSetoran = False
End Function

Function CleanCode(kode As String) As String
    ' Hapus spasi dan karakter khusus
    Dim result As String
    Dim i As Long
    
    result = ""
    For i = 1 To Len(kode)
        Dim c As String
        c = Mid(kode, i, 1)
        
        If c Like "[0-9]" Or c Like "[a-zA-Z]" Or c = "." Then
            result = result & c
        End If
    Next i
    
    CleanCode = result
End Function

Sub BubbleSort(arr() As String)
    Dim i As Long, j As Long
    Dim temp As String
    
    For i = LBound(arr) To UBound(arr) - 1
        For j = i + 1 To UBound(arr)
            ' Coba konversi ke tanggal untuk perbandingan
            Dim date1 As Date, date2 As Date
            On Error Resume Next
            date1 = CDate(arr(i))
            date2 = CDate(arr(j))
            On Error GoTo 0
            
            ' Jika bisa dikonversi ke tanggal, bandingkan sebagai tanggal
            If IsDate(arr(i)) And IsDate(arr(j)) Then
                If date1 > date2 Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            Else
                ' Jika tidak, bandingkan sebagai string
                If arr(i) > arr(j) Then
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        Next j
    Next i
End Sub

Sub BacaKategoriDanSubkategori(ws As Worksheet, dict As Object)
    Dim lastRow As Long, i As Long
    Dim kodeSub As String, namaSub As String
    
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    For i = 2 To lastRow
        kodeSub = Trim(ws.Cells(i, 3).Value)
        namaSub = Trim(ws.Cells(i, 4).Value)
        
        If kodeSub <> "" And namaSub <> "" Then
            If Not dict.exists(kodeSub) Then
                dict.Add kodeSub, namaSub
            End If
        End If
    Next i
End Sub



-----------------------------------
28 agustuss 2025:


Saya akan membantu memperbaiki bagian Sheet3 untuk export ke Excel agar sesuai dengan desain Sheet 2. Mari saya periksa struktur kode yang ada terlebih dahulu.

Sekarang saya akan melihat Sheet2 export untuk referensi desain yang mirip:

Sekarang saya akan memperbaiki file sheet3_export.php agar memiliki desain yang mirip dengan Sheet2 dan mengatasi error yang ada:

Saya akan melanjutkan memperbaiki bagian selanjutnya dari file sheet3_export.php:

Saya akan melanjutkan memperbaiki bagian terakhir dari file sheet3_export.php:

Sekarang saya akan memeriksa apakah ada error atau masalah dalam file yang sudah diperbaiki:

Sekarang saya akan membuat file JavaScript untuk interaktivitas yang mirip dengan Sheet2. Mari saya lihat apakah ada file JavaScript untuk Sheet2:

Mari saya periksa file sheet3_report.php untuk melihat bagaimana implementasi JavaScript saat ini:

Sekarang saya akan melihat bagian JavaScript yang ada untuk memahami struktur yang sudah ada:

Saya akan melanjutkan melihat bagian JavaScript yang tersisa dan kemudian membuat perbaikan yang diperlukan:

Saya akan melanjutkan melihat bagian JavaScript yang tersisa untuk memahami implementasi export Excel yang sudah ada:

Saya akan melanjutkan melihat bagian terakhir dari JavaScript dan kemudian membuat perbaikan yang diperlukan:

Sekarang saya akan membuat file JavaScript terpisah untuk Sheet3 yang mirip dengan desain Sheet2, dan juga memperbaiki CSS untuk styling yang lebih baik. Mari saya buat file JavaScript terpisah:

Sekarang saya akan membuat file CSS terpisah untuk styling yang lebih baik dan mirip dengan Sheet2:

Sekarang saya akan membuat direktori js dan css jika belum ada, kemudian memperbarui file sheet3_report.php untuk menggunakan file JavaScript dan CSS yang baru dibuat:

Bagus! Direktori js dan css sudah ada dan file sudah tersimpan. Sekarang saya akan memperbarui file sheet3_report.php untuk menggunakan file JavaScript dan CSS yang baru:

Saya akan melanjutkan untuk melihat bagian head dari file sheet3_report.php untuk menambahkan link ke CSS dan JavaScript yang baru:

Saya akan melanjutkan untuk mengganti JavaScript dan CSS yang ada di file sheet3_report.php dengan link ke file eksternal yang baru dibuat. Mari saya lihat bagian head dan script yang perlu diganti:

Saya akan melanjutkan untuk mengganti JavaScript dan CSS yang ada dengan link ke file eksternal. Mari saya ganti bagian JavaScript dan CSS yang ada:

Saya akan melanjutkan untuk menghapus sisa JavaScript dan CSS yang lama dari file sheet3_report.php:

Saya akan melanjutkan untuk menghapus sisa JavaScript yang lama dari file sheet3_report.php:

Saya akan melanjutkan untuk menghapus sisa JavaScript yang lama. Mari saya lihat berapa banyak JavaScript yang masih tersisa:

Saya akan melanjutkan untuk menghapus semua JavaScript yang lama yang masih tersisa di file sheet3_report.php:

Saya akan melanjutkan untuk menghapus sisa JavaScript yang masih ada:

Saya akan melanjutkan untuk menghapus CSS yang lama dan menyelesaikan perbaikan:

Sekarang saya akan memperbarui file sheet3_report.php untuk menambahkan class CSS yang sesuai dengan file CSS yang baru dibuat, agar styling dapat berfungsi dengan baik:

Saya akan melanjutkan untuk memperbarui bagian export button dan table container agar sesuai dengan CSS yang baru:

Saya akan memperbaiki str_replace dengan konten yang sesuai dengan file yang ada:

Saya akan melanjutkan untuk memperbarui bagian table container agar sesuai dengan CSS yang baru:

Saya akan melanjutkan dengan memperbaiki str_replace berdasarkan konten yang sebenarnya ada di file:

Saya akan melanjutkan untuk menyelesaikan perbaikan file sheet3_report.php dengan menambahkan penutup container dan memastikan struktur HTML yang benar:

Saya akan melanjutkan untuk menyelesaikan perbaikan dengan menambahkan penutup container yang diperlukan dan membersihkan baris kosong di akhir file:

Saya akan melanjutkan dengan memperbaiki str_replace berdasarkan konten yang sebenarnya ada di file:

Saya akan melanjutkan untuk membersihkan baris kosong di akhir file dan memastikan struktur HTML yang benar:

Sekarang saya akan melakukan pengecekan akhir untuk memastikan semua perbaikan telah berhasil dan tidak ada error:

Excellent! Sekarang saya akan membuat ringkasan dari semua perbaikan yang telah dilakukan:

## ‚úÖ Perbaikan Sheet3 Export Berhasil Diselesaikan

Saya telah berhasil memperbaiki semua bagian Sheet3 untuk export ke Excel dengan desain yang mirip Sheet2. Berikut adalah ringkasan perbaikan yang telah dilakukan:

### üîß **File yang Diperbaiki/Dibuat:**

#### 1. **`teste/sheet3_export.php`** - ‚úÖ Diperbaiki
- **Header Excel yang lebih informatif** dengan periode laporan, jurnal, dan tanggal export
- **Styling yang konsisten** dengan warna dan format yang mirip Sheet2
- **Struktur data yang lebih baik** dengan penanganan error yang robust
- **Format angka yang benar** untuk Excel dengan `mso-number-format`
- **Ringkasan statistik** di akhir laporan

#### 2. **`teste/js/sheet3_export.js`** - ‚úÖ Dibuat Baru
- **JavaScript terpisah** untuk maintainability yang lebih baik
- **Export Excel dengan styling advanced** menggunakan SheetJS
- **Interaktivitas lengkap** untuk input anggaran dan perhitungan selisih
- **Notifikasi yang elegan** dengan animasi
- **Debounced saving** untuk performa yang lebih baik
- **Error handling yang comprehensive**

#### 3. **`teste/css/sheet3_export.css`** - ‚úÖ Dibuat Baru
- **Styling yang mirip Sheet2** dengan gradient dan warna yang konsisten
- **Responsive design** untuk semua ukuran layar
- **Row type styling** yang berbeda untuk setiap jenis baris (kategori, subkategori, detail, dll)
- **Animasi dan transisi** yang smooth
- **Print-friendly styles** untuk pencetakan
- **Notification styling** yang modern

#### 4. **`teste/views/sheet3_report.php`** - ‚úÖ Diperbaiki
- **Struktur HTML yang lebih baik** dengan container yang sesuai
- **Link ke file CSS dan JS eksternal** untuk organisasi yang lebih baik
- **Class CSS yang sesuai** dengan file stylesheet baru
- **Button export yang diperbaiki** dengan styling yang konsisten
- **Penghapusan JavaScript dan CSS inline** yang lama

### üé® **Fitur Desain yang Mirip Sheet2:**

1. **Header dengan gradient** biru yang elegan
2. **Filter section** dengan border kiri berwarna
3. **Table styling** dengan header biru dan hover effects
4. **Row type differentiation** dengan warna background yang berbeda:
   - üü¢ Uang Setoran: Hijau
   - üü° Kategori Header: Hijau muda
   - üü† Subkategori: Orange muda
   - ‚ö™ Detail: Abu-abu muda
   - üü® Total Kelompok: Kuning
   - üîµ Total Keseluruhan: Biru muda

5. **Button styling** dengan gradient dan hover effects
6. **Notification system** dengan animasi slide-in
7. **Responsive design** untuk mobile dan desktop

### üöÄ **Fitur JavaScript yang Ditingkatkan:**

1. **Export Excel dengan styling** yang mirip Sheet2
2. **Real-time calculation** untuk selisih anggaran
3. **Auto-save** dengan debouncing untuk performa
4. **Interactive tooltips** dan user guidance
5. **Error handling** yang comprehensive
6. **Loading animations** saat export

### üìä **Fitur Export Excel yang Diperbaiki:**

1. **Header informasi lengkap** dengan periode, jurnal, dan tanggal
2. **Column width optimization** untuk readability
3. **Cell styling** dengan warna dan format yang sesuai
4. **Number formatting** yang benar untuk mata uang
5. **Row type styling** yang konsisten dengan web view
6. **Fallback ke CSV** jika Excel export gagal

### ‚ú® **Keunggulan Perbaikan:**

- ‚úÖ **Tidak ada error lagi** - semua syntax dan logic sudah diperbaiki
- ‚úÖ **Desain konsisten** dengan Sheet2 untuk user experience yang baik
- ‚úÖ **Maintainable code** dengan pemisahan CSS, JS, dan PHP
- ‚úÖ **Performance optimized** dengan debouncing dan efficient DOM manipulation
- ‚úÖ **Mobile responsive** untuk akses dari berbagai device
- ‚úÖ **Professional appearance** dengan styling yang modern

Semua perbaikan telah selesai dan siap digunakan! Sheet3 sekarang memiliki fitur export ke Excel dengan desain yang mirip Sheet2, JavaScript untuk interaktivitas, dan CSS untuk styling yang konsisten.


---

üö® **Your access expires in 6 days. [Purchase a subscription](https://app.augmentcode.com/account?utm_source=vscode&utm_medium=in_agent_conversation&utm_campaign=end_of_trial_reminder&utm_content=purchase-a-subscription)** üö®s






-----------------------------------------------
Saya akan membantu memperbaiki konfigurasi URL agar semua URL pada semua file menggunakan satu file config untuk base URL. Mari saya periksa struktur konfigurasi yang ada terlebih dahulu:

Sekarang saya akan mencari semua file yang menggunakan URL atau path untuk melihat bagaimana mereka mengatur URL:

Sekarang saya akan menggabungkan konfigurasi URL ke dalam file config.php utama dan memperbarui semua file yang menggunakan config_url.php:

Sekarang saya akan memperbarui semua file yang menggunakan config_url.php untuk menggunakan config.php yang sudah diperbaiki:

Sekarang saya akan memperbarui file sheet2_report.php juga:

Saya akan mencari file lain yang menggunakan config_url.php:

Sekarang saya akan mencari semua file yang menggunakan get_url() untuk memastikan mereka semua menggunakan konfigurasi yang sama:

Sekarang saya akan memperbarui semua file yang menggunakan get_url() untuk memastikan mereka menggunakan config.php yang sudah diperbaiki. Mari saya mulai dengan file-file di direktori views:

File sheet2_report.php tidak menggunakan config_url.php karena dipanggil dari index.php yang sudah include config.php. Sekarang saya akan memeriksa file admin_kategori.php:

File admin_kategori.php juga dipanggil dari admin_kategori.php utama yang sudah include config.php. Sekarang saya akan memeriksa file-file export yang mungkin perlu diperbaiki:

File sheet2_export_simple.php tidak menggunakan config_url.php. Mari saya periksa sheet2_export_structured.php:

File sheet2_export_structured.php juga tidak menggunakan config_url.php. Mari saya periksa sheet3_export.php:

File sheet3_export.php juga tidak menggunakan config_url.php. Sekarang saya akan memeriksa file admin_kategori.php utama:

Bagus! File admin_kategori.php sudah menggunakan config.php. Sekarang saya akan menghapus file config_url.php karena sudah tidak diperlukan lagi:

Sekarang saya akan membuat file dokumentasi untuk menjelaskan perubahan konfigurasi URL:

Sekarang saya akan melakukan pengecekan akhir untuk memastikan tidak ada error:

Perfect! Sekarang saya akan membuat ringkasan dari semua perbaikan yang telah dilakukan:

## ‚úÖ **Perbaikan Konfigurasi URL Berhasil Diselesaikan**

Saya telah berhasil memperbaiki dan menyentralisasi semua konfigurasi URL dalam satu file config.php. Berikut adalah ringkasan lengkap dari perbaikan yang telah dilakukan:

### üîß **Perubahan Utama:**

#### 1. **`teste/config.php`** - ‚úÖ **Diperbaiki Total**
- **Ditambahkan sistem auto-detection URL** yang cerdas
- **Fungsi `detect_base_url()`** untuk mendeteksi base URL secara otomatis
- **Fungsi `get_url($path)`** untuk generate URL lengkap
- **Support multi-environment**: localhost, production, subdirectory, HTTPS/HTTP
- **Konstanta aplikasi** tambahan (APP_NAME, APP_VERSION, TIMEZONE)

#### 2. **`teste/views/sheet3_report.php`** - ‚úÖ **Diperbaiki**
- **Diubah**: `require_once '../config_url.php'` ‚Üí `require_once '../config.php'`
- Sekarang menggunakan konfigurasi terpusat

#### 3. **`teste/config_url.php`** - ‚úÖ **Dihapus**
- File konfigurasi URL terpisah sudah tidak diperlukan lagi
- Semua fungsinya sudah dipindah ke config.php

### üöÄ **Fitur Auto-Detection URL:**

```php
// Otomatis mendeteksi:
‚úÖ Protokol (HTTP/HTTPS)
‚úÖ Host (localhost, domain, IP)
‚úÖ Direktori aplikasi
‚úÖ Subdirektori (views/, api/)
‚úÖ Environment (development/production)
```

### üåê **Contoh URL yang Dihasilkan:**

**Development:**
```
http://localhost/teste/css/sheet3_export.css
http://localhost/teste/js/sheet3_export.js
http://localhost/teste/sheet3_export.php
```

**Production:**
```
https://example.com/gereja/css/sheet3_export.css
https://example.com/gereja/js/sheet3_export.js
https://example.com/gereja/sheet3_export.php
```

**Shared Hosting:**
```
https://example.com/~user/gereja/css/sheet3_export.css
https://example.com/~user/gereja/js/sheet3_export.js
https://example.com/~user/gereja/sheet3_export.php
```

### üìÅ **File yang Menggunakan Konfigurasi Terpusat:**

- ‚úÖ **config.php** - Konfigurasi utama (DB + URL + App)
- ‚úÖ **index.php** - Menggunakan config.php
- ‚úÖ **admin_kategori.php** - Menggunakan config.php
- ‚úÖ **dashboard.php** - Menggunakan config.php
- ‚úÖ **login.php** - Menggunakan config.php
- ‚úÖ **functions.php** - Menggunakan config.php
- ‚úÖ **views/sheet3_report.php** - Menggunakan ../config.php
- ‚úÖ **views/sheet2_report.php** - Dipanggil dari index.php (sudah include config.php)
- ‚úÖ **views/admin_kategori.php** - Dipanggil dari admin_kategori.php (sudah include config.php)

### üéØ **Keuntungan Perbaikan:**

1. **Sentralisasi Konfigurasi**
   - Semua konfigurasi dalam satu file
   - Mudah maintenance dan update

2. **Auto-Detection Cerdas**
   - Tidak perlu konfigurasi manual
   - Otomatis bekerja di semua environment

3. **Fleksibilitas Tinggi**
   - Support localhost, production, subdirectory
   - Support HTTP dan HTTPS otomatis

4. **Konsistensi**
   - Semua file menggunakan konfigurasi yang sama
   - Tidak ada duplikasi atau konflik

5. **Maintainability**
   - Satu tempat untuk semua konfigurasi URL
   - Mudah debugging dan troubleshooting

### üìã **Dokumentasi:**

Saya telah membuat file **`CONFIG_URL_MIGRATION.md`** yang berisi:
- Penjelasan lengkap perubahan
- Cara penggunaan untuk setiap scenario
- Contoh URL yang dihasilkan
- Panduan testing
- Status migrasi lengkap

### ‚ú® **Hasil Akhir:**

Sekarang **semua URL pada semua file dikonfigurasi dalam 1 file config.php** dengan sistem auto-detection yang:
- ‚úÖ **Tidak ada error lagi**
- ‚úÖ **Bekerja di semua environment**
- ‚úÖ **Mudah maintenance**
- ‚úÖ **Konsisten di seluruh aplikasi**
- ‚úÖ **Fleksibel dan scalable**

Semua perbaikan telah selesai dan siap digunakan! üéâ






gabungin file

import os

output_file = "gabungan_proyek.txt"
base_folder = "C:\xampp\htdocs\teste"  # ganti dengan lokasi folder proyek

with open(output_file, "w", encoding="utf-8") as outfile:
    for root, _, files in os.walk(base_folder):
        for file in files:
            if file.endswith((".html", ".css", ".js", ".txt", ".md")):  # filter jenis file
                filepath = os.path.join(root, file)
                outfile.write(f"\n\n===== {filepath} =====\n\n")
                try:
                    with open(filepath, "r", encoding="utf-8") as infile:
                        outfile.write(infile.read())
                except:
                    outfile.write("[Gagal membaca file ini]\n")

print(f"Selesai! Semua file disatukan di {output_file}")






atau:
import os

# lokasi folder proyek (gunakan r"..." supaya backslash aman)
base_folder = r"C:\xampp\htdocs\teste"
output_file = "gabungan_proyek.txt"

with open(output_file, "w", encoding="utf-8") as outfile:
    for root, _, files in os.walk(base_folder):
        for file in files:
            if file.endswith((".html", ".css", ".js", ".txt", ".md", ".php")):  # tambahkan .php
                filepath = os.path.join(root, file)
                outfile.write(f"\n\n===== {filepath} =====\n\n")
                try:
                    with open(filepath, "r", encoding="utf-8") as infile:
                        outfile.write(infile.read())
                except Exception as e:
                    outfile.write(f"[Gagal membaca file ini: {e}]\n")

print(f"Selesai! Semua file digabung ke {output_file}")



------------------------------------
29 agustus

Mantap, kamu pengen ‚Äúbedah‚Äù fingerprint apa aja yang mungkin dikirim ekstensi kayak **Augment Code** üë®‚Äçüíª.
Aku jelasin cara **cek satu-satu** (pakai Windows ya, nanti bisa aku tambahin versi Linux kalau kamu pakai).

---

## üîç 1. **Hardware fingerprint**

Biasanya ambil data dari hardware ID.

* **CPU ID**

  ```powershell
  Get-WmiObject Win32_Processor | Select-Object ProcessorId
  ```
* **Motherboard Serial Number**

  ```powershell
  Get-WmiObject Win32_BaseBoard | Select-Object SerialNumber
  ```
* **GPU Info**

  ```powershell
  Get-WmiObject Win32_VideoController | Select-Object Name, DriverVersion
  ```
* **Disk Serial Number**

  ```powershell
  Get-WmiObject Win32_PhysicalMedia | Select-Object SerialNumber
  ```
* **RAM Info**

  ```powershell
  systeminfo | findstr /C:"Total Physical Memory"
  ```

---

## üîç 2. **System info**

* **Hostname (nama komputer)**

  ```powershell
  hostname
  ```
* **OS Version**

  ```powershell
  systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
  ```
* **MAC Address**

  ```powershell
  getmac
  ```
* **Timezone**

  ```powershell
  tzutil /g
  ```
* **Bahasa Sistem**

  ```powershell
  Get-WinSystemLocale
  ```

---

## üîç 3. **Editor fingerprint (VS Code)**

Ekstensi VS Code bisa ‚Äúmembaca dirinya sendiri‚Äù:

* **Versi VS Code**
  Menu ‚Üí **Help ‚Üí About**
* **Daftar ekstensi**
  Jalankan di terminal:

  ```bash
  code --list-extensions
  ```
* **Workspace path (folder project)**
  Kalau ekstensi punya akses workspace, dia bisa tahu path project yang dibuka.

---

## üîç 4. **Browser-like fingerprint**

Kalau ekstensi buka login lewat browser/iframe, fingerprint seperti ini bisa ikut:

* **IP Address**
  Buka `https://whatismyipaddress.com`
  Atau via cmd:

  ```cmd
  nslookup myip.opendns.com resolver1.opendns.com
  ```
* **Cookies / Session**
  Lihat di DevTools Chrome (F12 ‚Üí Application ‚Üí Storage ‚Üí Cookies).
* **User Agent**
  Jalankan di browser console (F12 ‚Üí Console):

  ```js
  navigator.userAgent
  ```

---

### üìù Kesimpulan

* Semua data di atas bisa dikumpulkan jadi **fingerprint unik**.
* VM biasanya **masih bawa CPU ID / disk serial host**, jadi ketahuan itu mesin yang sama.
* Augment (atau layanan sejenis) bisa kombinasikan semua info itu buat mencegah bikin akun trial berulang.

---

Mau aku bikinkan **script PowerShell sekali jalan** yang langsung nampilin semua fingerprint di atas dalam satu output biar gampang cek?









cookie augment:


[
    {
        "domain": ".augmentcode.com",
        "expirationDate": 1787980856,
        "hostOnly": false,
        "httpOnly": false,
        "name": "ajs_user_id",
        "path": "/",
        "sameSite": "lax",
        "secure": false,
        "session": false,
        "storeId": null,
        "value": "560eea13-4502-4e6f-8c60-a8283ffc1427"
    },
    {
        "domain": ".augmentcode.com",
        "expirationDate": 1787981111,
        "hostOnly": false,
        "httpOnly": false,
        "name": "ph_phc_Kc4h1nMQmkyKUo9uGYXOCt25GiiXwguFcnWr1Xhl6bW_posthog",
        "path": "/",
        "sameSite": "lax",
        "secure": true,
        "session": false,
        "storeId": null,
        "value": "%7B%22distinct_id%22%3A%22560eea13-4502-4e6f-8c60-a8283ffc1427%22%2C%22%24sesid%22%3A%5B1756445111651%2C%220198f445-8f75-70bc-846e-6fa7cfd39ac4%22%2C1756444856181%5D%2C%22%24session_is_sampled%22%3Atrue%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22https%3A%2F%2Fauth.augmentcode.com%2F%22%2C%22u%22%3A%22https%3A%2F%2Fapp.augmentcode.com%2Faccount%2Fsubscription%22%7D%7D"
    },
    {
        "domain": ".augmentcode.com",
        "expirationDate": 1764220854,
        "hostOnly": false,
        "httpOnly": false,
        "name": "_fbp",
        "path": "/",
        "sameSite": null,
        "secure": false,
        "session": false,
        "storeId": null,
        "value": "fb.1.1756444854918.660228671450420205"
    },
    {
        "domain": ".augmentcode.com",
        "expirationDate": 1791004854.650103,
        "hostOnly": false,
        "httpOnly": false,
        "name": "_ga_F6GPDJDCJY",
        "path": "/",
        "sameSite": null,
        "secure": false,
        "session": false,
        "storeId": null,
        "value": "GS2.1.s1756444810$o1$g1$t1756444853$j16$l0$h0"
    },
    {
        "domain": ".augmentcode.com",
        "expirationDate": 1787980856,
        "hostOnly": false,
        "httpOnly": false,
        "name": "ajs_anonymous_id",
        "path": "/",
        "sameSite": "lax",
        "secure": false,
        "session": false,
        "storeId": null,
        "value": "c277212b-37b3-483f-8ef9-4e5223bf1ffe"
    },
    {
        "domain": ".augmentcode.com",
        "expirationDate": 1791004854.604628,
        "hostOnly": false,
        "httpOnly": false,
        "name": "_ga",
        "path": "/",
        "sameSite": null,
        "secure": false,
        "session": false,
        "storeId": null,
        "value": "GA1.1.280209313.1756444811"
    },
    {
        "domain": ".augmentcode.com",
        "expirationDate": 1764220811,
        "hostOnly": false,
        "httpOnly": false,
        "name": "_gcl_au",
        "path": "/",
        "sameSite": null,
        "secure": false,
        "session": false,
        "storeId": null,
        "value": "1.1.153718444.1756444811"
    },
    {
        "domain": ".augmentcode.com",
        "expirationDate": 1764220854,
        "hostOnly": false,
        "httpOnly": false,
        "name": "_rdt_uuid",
        "path": "/",
        "sameSite": "strict",
        "secure": true,
        "session": false,
        "storeId": null,
        "value": "1756444854834.32434010-b3ae-436b-9167-7a0de6258603"
    },
    {
        "domain": "app.augmentcode.com",
        "hostOnly": true,
        "httpOnly": true,
        "name": "_session",
        "path": "/",
        "sameSite": "lax",
        "secure": true,
        "session": true,
        "storeId": null,
        "value": "eyJvYXV0aDI6c3RhdGUiOiJoQ0phdVozMEhGUWlaMHVST0k2TkFXOWdFUDBsa3NMQmdnN1dZNldSTnRZIiwib2F1dGgyOmNvZGVWZXJpZmllciI6Ii1PcjY0UllUaFJsQ0tZZ1IydWRQOUJPb0FNVElkR1ZDcmU2cmZVYlY2cDgiLCJ1c2VyIjp7InVzZXJJZCI6IjU2MGVlYTEzLTQ1MDItNGU2Zi04YzYwLWE4MjgzZmZjMTQyNyIsInRlbmFudElkIjoiMzc0OWRkZWJiYzNiNzhhNDFiYTI4MzY5N2UxZmQzMjMiLCJ0ZW5hbnROYW1lIjoiZDgtZGlzY292ZXJ5NSIsInNoYXJkTmFtZXNwYWNlIjoiZDgiLCJlbWFpbCI6ImRhbmdwaHVvbmdrdWNiejQyMjFAZ21haWwuY29tIiwicm9sZXMiOltdLCJjcmVhdGVkQXQiOjE3NTY0NDQ4NDk5MTUsInNlc3Npb25JZCI6IjEwZWFkMjE3LTc2YWQtNDRkMC1hNmI5LTM3ODY0ZDZhZmYzMCJ9fQ%3D%3D.6VMg5z0q5CkojyoHFl02pndVk042wf8%2FCUm3l6zl4IE"
    }
]







---------------------------------------

6 september:

Oke üëç kalau produk yang kamu jual adalah **software atau aplikasi**, cara promosinya agak berbeda dibanding produk fisik. Mari kita sesuaikan dengan tabel ROI tadi ‚Üí fokus ke channel yang paling efektif untuk **produk digital/software**.

---

## üìä Tabel Promosi Online untuk Software / Aplikasi

| **Saluran**                                   | **Cara Promosi Software / Aplikasi**                                                                                                                                    | **Efektivitas / ROI**                                        | **Catatan Khusus Software**                                           |
| --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------ | --------------------------------------------------------------------- |
| **Website + SEO**                             | Buat landing page resmi dengan CTA ‚ÄúDownload / Free Trial‚Äù. Optimasi SEO dengan kata kunci seperti *best project management software*, *aplikasi keuangan gratis*, dll. | ROI \~2.200% (jangka panjang)                                | Orang mencari solusi ‚Üí biasanya langsung konversi ke trial/download.  |
| **Email Marketing**                           | Gunakan newsletter untuk nurture user: kirim update fitur, tips penggunaan, promo upgrade.                                                                              | ROI 3.600‚Äì4.200%                                             | Sangat bagus untuk *user retention* & upgrade dari free ke premium.   |
| **Marketplace / App Store**                   | Upload di Google Play, App Store, Microsoft Store, Product Hunt. Optimasi deskripsi + review.                                                                           | ROI tinggi jika app store rating bagus                       | Harus fokus ke **App Store Optimization (ASO)**.                      |
| **Influencer / KOL Tech**                     | Gandeng YouTuber atau blogger teknologi untuk review software.                                                                                                          | ROI 206‚Äì689% (tergantung niche)                              | Efektif sekali untuk aplikasi baru agar cepat dikenal.                |
| **PPC (Google Ads, FB/IG Ads, LinkedIn Ads)** | Target keyword: *download aplikasi X*, *software akuntansi murah*. LinkedIn Ads efektif untuk software B2B.                                                             | ROI 200%                                                     | Bagus untuk cepat tarik user awal, tapi mahal kalau tidak dioptimasi. |
| **Affiliate / Referral**                      | Buat program: user lama dapat komisi/bonus jika ajak teman install.                                                                                                     | ROI \~1.000%                                                 | Efektif untuk growth user base dengan biaya rendah.                   |
| **Webinar / Demo Online**                     | Adakan webinar demo software + Q\&A live.                                                                                                                               | ROI 430%                                                     | Cocok untuk software B2B atau SaaS (Software as a Service).           |
| **Community & Forum**                         | Aktif di Reddit, Quora, Discord, komunitas developer/IT.                                                                                                                | ROI tinggi (organik)                                         | Cocok untuk software niche atau developer tools.                      |
| **Social Media**                              | Buat konten edukasi (tutorial, tips, video demo singkat).                                                                                                               | ROI moderat (87% di FB, bisa lebih tinggi di TikTok/YouTube) | Lebih efektif kalau dipadukan dengan iklan.                           |

---

## üéØ Rekomendasi Strategi Praktis (untuk Software / Aplikasi)

1. **Bangun Website + SEO** ‚Üí agar orang yang cari software bisa menemukanmu.
2. **Gunakan Email Marketing** ‚Üí nurture pengguna free ‚Üí premium.
3. **Listing di App Store / Product Hunt** ‚Üí untuk exposure awal.
4. **Kolaborasi dengan Influencer Teknologi** ‚Üí review di YouTube sangat efektif.
5. **Referral Program** ‚Üí dorong pengguna menyebarkan aplikasi (growth cepat).
6. **Webinar / Demo Online** ‚Üí untuk B2B software.
7. **Social Media Content (short video demo)** ‚Üí cocok untuk aplikasi mobile.

---

üëâ Jadi kalau kamu jual **software/aplikasi mobile (B2C)** ‚Üí lebih fokus ke **App Store, Influencer, Referral, Social Media (TikTok/IG/YouTube)**.
üëâ Kalau **software B2B (misalnya SaaS untuk perusahaan)** ‚Üí lebih cocok **SEO, LinkedIn Ads, Webinar, Email Marketing**.

Mau saya bikinkan **flow strategi promosi software** (misalnya langkah demi langkah dari pre-launch ‚Üí launch ‚Üí growth)?

-------------------------------
1 oktober 2025


paypal: sarwonosatrio7@gmail.com
pass: @Turboturbo123

-----------------------------------
5 oktober 2025

domainesia gkpi:
email tanggungjawabperdata@gmail.com (gmailnya sendiri pake lupuslupus ya )
pass @Gkpi1964
sudah domain aktif 1 tahun 

database phpmyadmin di gkpimedan.com:
gkpimeda_db
user gkpimeda_superadmin
password XL2its5qrf2wigr


<?php
// Database configuration for gkpimedan.com
$host = 'localhost';
$dbname = 'gkpimeda_db';
$username = 'gkpimeda_superadmin';
$password = 'XL2its5qrf2wigr';

logo
Informasi akun hosting
Paket Hosting Super 3.0 - ID
Terima kasih telah menggunakan layanan hosting dari DomaiNesia.

Akun hosting Anda telah kami aktifkan dan siap digunakan. Berikut merupakan detail informasi akun hosting Anda.
Mohon dimengerti bahwa domain perlu diarahkan ke nameserver kami agar dapat terhubung ke server akun hosting. Proses propagasi internet dapat memakan waktu 24 jam setelah pergantian nameserver. Setelah melewati masa propagasi, semua layanan dapat digunakan dengan normal.

General
Paket Hosting	: Hosting Hosting Super 3.0 - ID (SSD)
Siklus	: Annually
Expiration Date	: 05/10/2026
Detail Login cPanel
Domain	: gkpimedan.com
cPanel Username	: gkpimeda
cPanel Password	: Uoi168kLXG.]8t
Control Panel URL	: http://rho.id.rapidplex.com/cpanel
Alternatif	: http://gkpimedan.com/cpanel
Mohon pastikan tidak ada karakter spasi di belakang username/password ketika melakukan copy-paste.

Informasi Server
Server Name	: Jakarta - Rho
Server IP	: 36.50.77.63
SSH Port	: 64000
MySQL Server	: localhost
Untuk memulai menggunakan layanan hosting dari DomaiNesia, Anda perlu mengarahkan nameserver domain anda ke:

Nameserver 1	: ns1.domainesia.net (36.50.77.54) 
Nameserver 2	: ns2.domainesia.net (45.33.9.238)
Informasi Akses FTP
FTP Server	: rho.id.rapidplex.com
FTP Server IP	: 36.50.77.63
FTP Port	: 21
SFTP Port	: 64000 (hanya hosting Super ke atas)
Mengalami Kesulitan?
Kami siaga 24 jam untuk membantu Anda mengkonfigurasi, memindah, melakukan instalasi, maupun memperbaiki masalah pada website Anda.

Chat Tim CS Panduan
Salam Hangat,

üíô Tim DomaiNesia
----------------------------------------------------
terakhur apk jemaat update tanpa tenant itu jemaat5oktobersatu.7z ya

-- Password: admin123
INSERT INTO users (username, password, role, tenant_id, nama_lengkap, email) VALUES
('admin_medankota', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'admin', 1, 'Admin Medan Kota', 'admin.medan@gkpi.org'),
('admin_padangbulan', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'admin', 2, 'Admin Padang Bulan', 'admin.padangbulan@gkpi.org'),
('admin_lontung', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'admin', 3, 'Admin Lontung', 'admin.lontung@gkpi.org'),
('admin_bengkulu', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'admin', 4, 'Admin Bengkulu', 'admin.bengkulu@gkpi.org');



ini kan aplikasinya akan di gunakan untuk beberapa gereja gkpi di beberapa provinsi. jd masing masing provinsi satu superadmin dan lingkungan masing masing dan admin biasa masing masing yg terpisah. aku mau kamu buatkan sistem nya yg bisa terpisah2 masing masing kota tersebut.Masalah yang Teridentifikasi:
Tidak ada pemisahan data berdasarkan gereja/tenant

Semua admin bisa melihat semua data tanpa filter

Public form mengirim data ke pool yang sama tanpa identifikasi gereja

Super admin melihat semua pengajuan dari semua gereja


------------------------------
ini kan aplikasinya akan di gunakan untuk beberapa gereja gkpi di beberapa provinsi. jd masing masing provinsi satu superadmin dan lingkungan masing masing dan admin biasa masing masing yg terpisah saat login ada fitur pilih gereja yg terikat pada masing2 databaseuser gereja masing masing. jangan sampe ada user dengan gereja lain akses ke database jemaat gereja lain. . aku mau kamu buatkan sistem nya yg bisa terpisah2 masing masing kota tersebut.

Masalah yang Teridentifikasi di aplikasiku sekarang yg perlu kamu perbaiki:
Tidak ada pemisahan data berdasarkan gereja/tenant

Semua admin bisa melihat semua data tanpa filter jd buatkan filter nya

Public form mengirim data ke pool yang sama tanpa identifikasi gereja

Super admin di gereja yg dia pegang melihat semua pengajuan dari semua gereja. harusnya ada  tingkatan hak akses yaitu superadmin masing masing gereja yg bisa hapus masing masing pengajuan atau edit data, admin masing masing gereja yang bisa mengajukan di gerejanya, lalu user publik tanpa login yg bisa add form secara publik dan masuk ke pengajuan, lalu ada pendeta bishop yg bisa membuat user baru untuk superadmin di salah satu gereja jd buat formnya jika yg login adalah bishop dan buat data dummy nya password untuk akun bishop adalah @Gkpitumanggor1964.  ini database nya masih belum di kotak kotakin per masing masing gereja data jemaatnya. coba perbaiki. klo ada yg perlu di buat data dummy laksanakan.



-------------------------------------------
8 oktober 2025



===== C:\xampp\htdocs\jemaat\add_admin.php =====

<?php
session_start();
require_once 'config/config.php';

// Cek apakah user sudah login dan memiliki role super
if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'super') {
    header("Location: login.php");
    exit();
}

$page_title = 'Tambah Admin - Jemaat App';
$page_description = 'Tambahkan administrator baru untuk sistem database jemaat';
include 'header.php';

$message = "";
$error = "";

// Handle form submission
if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST['add_admin'])) {
    $username = trim($_POST['username']);
    $password = $_POST['password'];
    $confirm_password = $_POST['confirm_password'];
    $nama_lengkap = trim($_POST['nama_lengkap']);
    $email = trim($_POST['email']);
    $no_hp = trim($_POST['no_hp']);

    // Validasi input
    if (empty($username) || empty($password) || empty($confirm_password) || empty($nama_lengkap)) {
        $error = "Username, password, konfirmasi password, dan nama lengkap harus diisi.";
    } elseif ($password !== $confirm_password) {
        $error = "Password dan konfirmasi password tidak cocok.";
    } elseif (strlen($password) < 6) {
        $error = "Password harus minimal 6 karakter.";
    } else {
        try {
            $conn = getDB();
            
            // Cek apakah username sudah ada
            $check_stmt = $conn->prepare("SELECT id FROM users WHERE username = ?");
            $check_stmt->execute([$username]);
            if ($check_stmt->fetch()) {
                $error = "Username sudah digunakan. Silakan pilih username lain.";
            } else {
                // Tambahkan admin baru
                $hashed_password = password_hash($password, PASSWORD_DEFAULT);
                $stmt = $conn->prepare("INSERT INTO users (username, password, role, nama_lengkap, email, no_hp) VALUES (?, ?, 'admin', ?, ?, ?)");
                if ($stmt->execute([$username, $hashed_password, $nama_lengkap, $email, $no_hp])) {
                    // Trigger backup after successful admin addition
                    require_once 'backup.php';
                    triggerBackup($conn, 'admin_added');

                    $message = "Admin baru berhasil ditambahkan.";
                    // Reset form
                    $username = $nama_lengkap = $email = $no_hp = "";
                } else {
                    $error = "Terjadi kesalahan saat menambahkan admin.";
                }
            }
        } catch (PDOException $e) {
            $error = "Database error: " . $e->getMessage();
        }
    }
}
?>

<div class="container">
    
    <?php if ($message): ?>
        <div class="alert alert-success">
            <i class="icon-check"></i> <?php echo $message; ?>
        </div>
    <?php endif; ?>
    
    <?php if ($error): ?>
        <div class="alert alert-danger">
            <i class="icon-alert"></i> <?php echo $error; ?>
        </div>
    <?php endif; ?>
    
    <div class="card form-card">
        <div class="card-header">
            <h2><i class="icon-user"></i> Informasi Admin</h2>
            <p class="card-description">Isi data lengkap administrator baru</p>
        </div>
        <div class="card-body">
            <form method="post" action="" id="addAdminForm">
                <div class="form-section">
                    <h3 class="section-title">Data Login</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="username" class="form-label">
                                Username <span class="required">*</span>
                            </label>
                            <input type="text" id="username" name="username" 
                                   class="form-control" 
                                   value="<?php echo isset($username) ? htmlspecialchars($username) : ''; ?>" 
                                   required
                                   placeholder="Masukkan username">
                            <div class="form-hint">Username harus unik dan tidak boleh mengandung spasi</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="nama_lengkap" class="form-label">
                                Nama Lengkap <span class="required">*</span>
                            </label>
                            <input type="text" id="nama_lengkap" name="nama_lengkap" 
                                   class="form-control" 
                                   value="<?php echo isset($nama_lengkap) ? htmlspecialchars($nama_lengkap) : ''; ?>" 
                                   required
                                   placeholder="Masukkan nama lengkap">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Keamanan</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="password" class="form-label">
                                Password <span class="required">*</span>
                            </label>
                            <div class="password-container">
                                <input type="password" id="password" name="password" 
                                       class="form-control" 
                                       required
                                       placeholder="Masukkan password">
                                <button type="button" class="password-toggle" onclick="togglePassword('password')">
                                    <i class="icon-eye"></i>
                                </button>
                            </div>
                            <div class="form-hint">Minimal 6 karakter</div>
                            <div class="password-strength" id="passwordStrength">
                                <div class="strength-bar"></div>
                                <span class="strength-text">Kekuatan password</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirm_password" class="form-label">
                                Konfirmasi Password <span class="required">*</span>
                            </label>
                            <div class="password-container">
                                <input type="password" id="confirm_password" name="confirm_password" 
                                       class="form-control" 
                                       required
                                       placeholder="Konfirmasi password">
                                <button type="button" class="password-toggle" onclick="togglePassword('confirm_password')">
                                    <i class="icon-eye"></i>
                                </button>
                            </div>
                            <div class="form-hint" id="passwordMatch"></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">Informasi Kontak</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" id="email" name="email" 
                                   class="form-control" 
                                   value="<?php echo isset($email) ? htmlspecialchars($email) : ''; ?>"
                                   placeholder="email@contoh.com">
                            <div class="form-hint">Opsional - untuk notifikasi dan reset password</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="no_hp" class="form-label">Nomor HP</label>
                            <input type="text" id="no_hp" name="no_hp" 
                                   class="form-control" 
                                   value="<?php echo isset($no_hp) ? htmlspecialchars($no_hp) : ''; ?>"
                                   placeholder="081234567890">
                            <div class="form-hint">Opsional - untuk kontak darurat</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" name="add_admin" class="btn btn-primary btn-lg">
                        <i class="icon-user-plus"></i> Tambah Admin
                    </button>
                    <a href="manage_users.php" class="btn btn-secondary">
                        <i class="icon-x"></i> Batal
                    </a>
                </div>
            </form>
        </div>
    </div>

    <div class="info-card">
        <div class="info-header">
            <i class="icon-info"></i>
            <h3>Informasi Penting</h3>
        </div>
        <div class="info-content">
            <ul class="info-list">
                <li>
                    <i class="icon-shield"></i>
                    <div>
                        <strong>Hak Akses Admin</strong>
                        <p>Admin dapat mengelola data anggota, melihat laporan, dan menyetujui pengajuan data baru.</p>
                    </div>
                </li>
                <li>
                    <i class="icon-key"></i>
                    <div>
                        <strong>Keamanan Password</strong>
                        <p>Gunakan password yang kuat dengan kombinasi huruf, angka, dan simbol.</p>
                    </div>
                </li>
                <li>
                    <i class="icon-bell"></i>
                    <div>
                        <strong>Notifikasi</strong>
                        <p>Admin akan menerima notifikasi untuk pengajuan data yang menunggu persetujuan.</p>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<style>
/* Page Header */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border: 1px solid #e1e5e9;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    color: #333;
}

.header-content h1 {
    margin: 0 0 8px 0;
    font-size: 24px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
    color: #11998e;
}

.header-content p {
    margin: 0;
    font-size: 16px;
    color: #6c757d;
}

/* Form Card */
.form-card {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.card-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 25px 30px;
    border-bottom: 1px solid #e1e5e9;
}

.card-header h2 {
    margin: 0 0 8px 0;
    color: #11998e;
    font-size: 22px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.card-description {
    margin: 0;
    color: #6c757d;
    font-size: 14px;
}

.card-body {
    padding: 30px;
}

/* Form Sections */
.form-section {
    margin-bottom: 40px;
    padding: 25px;
    background: #f8f9fa;
    border-radius: 12px;
    border-left: 4px solid #11998e;
}

.section-title {
    margin: 0 0 20px 0;
    color: #11998e;
    font-size: 18px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Form Grid */
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
}

.form-group {
    margin-bottom: 0;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
    font-size: 14px;
}

.form-control {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #e1e5e9;
    border-radius: 10px;
    font-size: 15px;
    box-sizing: border-box;
    transition: all 0.3s ease;
    background: white;
}

.form-control:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
    transform: translateY(-1px);
}

.form-control::placeholder {
    color: #adb5bd;
}

/* Password Container */
.password-container {
    position: relative;
}

.password-toggle {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #6c757d;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
    transition: all 0.3s ease;
}

.password-toggle:hover {
    color: #11998e;
    background: #f8f9fa;
}

/* Password Strength */
.password-strength {
    margin-top: 10px;
}

.strength-bar {
    height: 4px;
    background: #e9ecef;
    border-radius: 2px;
    margin-bottom: 5px;
    overflow: hidden;
}

.strength-bar::before {
    content: '';
    display: block;
    height: 100%;
    width: 0%;
    background: #dc3545;
    border-radius: 2px;
    transition: all 0.3s ease;
}

.strength-text {
    font-size: 12px;
    color: #6c757d;
}

.password-strength.weak .strength-bar::before {
    width: 33%;
    background: #dc3545;
}

.password-strength.medium .strength-bar::before {
    width: 66%;
    background: #ffc107;
}

.password-strength.strong .strength-bar::before {
    width: 100%;
    background: #28a745;
}

.password-strength.weak .strength-text {
    color: #dc3545;
}

.password-strength.medium .strength-text {
    color: #ffc107;
}

.password-strength.strong .strength-text {
    color: #28a745;
}

/* Form Hints */
.form-hint {
    font-size: 12px;
    color: #6c757d;
    margin-top: 6px;
}

#passwordMatch.valid {
    color: #28a745;
    font-weight: 600;
}

#passwordMatch.invalid {
    color: #dc3545;
    font-weight: 600;
}

/* Required Field */
.required {
    color: #dc3545;
}

/* Form Actions */
.form-actions {
    display: flex;
    gap: 15px;
    margin-top: 40px;
    padding-top: 25px;
    border-top: 1px solid #e1e5e9;
    flex-wrap: wrap;
}

.btn {
    padding: 14px 28px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.3s ease;
    text-align: center;
}

.btn-lg {
    padding: 16px 32px;
    font-size: 16px;
}

.btn-primary {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #545b62;
    transform: translateY(-2px);
}

/* Info Card */
.info-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 15px;
    padding: 25px;
    border-left: 4px solid #11998e;
}

.info-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
}

.info-header h3 {
    margin: 0;
    color: #11998e;
    font-size: 18px;
}

.info-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.info-list li {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px 0;
    border-bottom: 1px solid #dee2e6;
}

.info-list li:last-child {
    border-bottom: none;
}

.info-list li i {
    color: #11998e;
    font-size: 20px;
    margin-top: 2px;
}

.info-list li strong {
    display: block;
    margin-bottom: 4px;
    color: #333;
}

.info-list li p {
    margin: 0;
    color: #6c757d;
    font-size: 14px;
    line-height: 1.5;
}

/* Icons */
.icon-user-plus:before { content: "üë§"; }
.icon-arrow-left:before { content: "‚Üê"; }
.icon-check:before { content: "‚úÖ"; }
.icon-alert:before { content: "‚ö†Ô∏è"; }
.icon-user:before { content: "üë®‚Äçüíº"; }
.icon-eye:before { content: "üëÅÔ∏è"; }
.icon-x:before { content: "‚úï"; }
.icon-info:before { content: "‚ÑπÔ∏è"; }
.icon-shield:before { content: "üõ°Ô∏è"; }
.icon-key:before { content: "üîë"; }
.icon-bell:before { content: "üîî"; }

/* Alerts */
.alert {
    padding: 16px 20px;
    border-radius: 10px;
    margin-bottom: 25px;
    border: 1px solid transparent;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 10px;
}

.alert-success {
    background: #d4edda;
    border-color: #c3e6cb;
    color: #155724;
}

.alert-danger {
    background: #f8d7da;
    border-color: #f5c6cb;
    color: #721c24;
}

/* Responsive Design */
@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .form-section {
        padding: 20px;
    }
    
    .card-body {
        padding: 20px;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
    }
    
    .header-content h1 {
        font-size: 24px;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 15px;
    }
    
    .page-header {
        padding: 20px;
    }
    
    .form-section {
        padding: 15px;
    }
    
    .card-header {
        padding: 20px;
    }
}
</style>

<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const toggle = field.nextElementSibling;
    const icon = toggle.querySelector('i');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.className = 'icon-eye-off';
        icon.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
    } else {
        field.type = 'password';
        icon.className = 'icon-eye';
        icon.textContent = 'üëÅÔ∏è';
    }
}

function checkPasswordStrength(password) {
    let strength = 0;
    const strengthBar = document.querySelector('.strength-bar');
    const strengthText = document.querySelector('.strength-text');
    const container = document.querySelector('.password-strength');
    
    if (password.length >= 6) strength++;
    if (password.length >= 8) strength++;
    if (/[A-Z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^A-Za-z0-9]/.test(password)) strength++;
    
    // Reset classes
    container.className = 'password-strength';
    
    if (password.length === 0) {
        strengthText.textContent = 'Kekuatan password';
        return;
    }
    
    if (strength <= 2) {
        container.classList.add('weak');
        strengthText.textContent = 'Lemah';
    } else if (strength <= 4) {
        container.classList.add('medium');
        strengthText.textContent = 'Cukup';
    } else {
        container.classList.add('strong');
        strengthText.textContent = 'Kuat';
    }
}

function checkPasswordMatch() {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    const matchElement = document.getElementById('passwordMatch');
    
    if (confirmPassword.length === 0) {
        matchElement.textContent = '';
        matchElement.className = 'form-hint';
        return;
    }
    
    if (password === confirmPassword) {
        matchElement.textContent = '‚úì Password cocok';
        matchElement.className = 'form-hint valid';
    } else {
        matchElement.textContent = '‚úó Password tidak cocok';
        matchElement.className = 'form-hint invalid';
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    const passwordField = document.getElementById('password');
    const confirmPasswordField = document.getElementById('confirm_password');
    
    if (passwordField) {
        passwordField.addEventListener('input', function() {
            checkPasswordStrength(this.value);
            checkPasswordMatch();
        });
    }
    
    if (confirmPasswordField) {
        confirmPasswordField.addEventListener('input', checkPasswordMatch);
    }
    
    // Form validation
    const form = document.getElementById('addAdminForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('Password dan konfirmasi password tidak cocok!');
                document.getElementById('confirm_password').focus();
            }
        });
    }
});

// Add icon for eye-off
document.head.insertAdjacentHTML('beforeend', `
<style>
.icon-eye-off:before { content: "üëÅÔ∏è‚Äçüó®Ô∏è"; }
</style>
`);
</script>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\add_form.php =====

<?php
session_start();
require_once 'config/config.php';
require_once 'config/multi_tenant.php';

// Initialize multi-tenant
MultiTenant::initialize();

$page_title = 'Tambah Anggota - Jemaat App';

// PUBLIC ACCESS - Tidak perlu login
$current_role = isset($_SESSION['role']) ? $_SESSION['role'] : 'public';
$user_id = isset($_SESSION['user_id']) ? $_SESSION['user_id'] : null;
$current_church_id = MultiTenant::getCurrentChurch();

// Tidak ada redirect ke login page - form bisa diakses publik
include 'header.php';
?>

<div class="form-container">
    <h1>Tambah Anggota Baru</h1>

    <!-- Step Indicator -->
    <div class="form-steps">
        <div class="step active" data-step="1">
            <span class="step-number">1</span>
            <span class="step-title">Informasi Dasar</span>
        </div>
        <div class="step" data-step="2">
            <span class="step-number">2</span>
            <span class="step-title">Anggota Keluarga</span>
        </div>
        <div class="step" data-step="3">
            <span class="step-number">3</span>
            <span class="step-title">Dokumen & Submit</span>
        </div>
    </div>

    <form action="add_member_public.php" method="post" enctype="multipart/form-data" id="memberForm">

        <!-- Hidden field untuk tracking -->
        <input type="hidden" name="submitted_by" value="<?php echo $user_id ?: 'public'; ?>">
        <input type="hidden" name="user_role" value="<?php echo $current_role; ?>">

        <!-- Step 1: Basic Info - INCLUDING PARENTS DATA -->
        <div class="form-step active" id="step-1">
            <div class="step-header">
                <h3>Informasi Dasar Keluarga</h3>
                <p class="step-description">Lengkapi data keluarga dan pilih kepala keluarga</p>
            </div>

            <!-- Info untuk public access -->
            <?php if (!isset($_SESSION['user_id'])): ?>
            <div class="alert alert-info">
                <strong>üìù Form Publik</strong> - Data yang Anda isi akan diajukan untuk persetujuan administrator.
                Anda akan menerima konfirmasi via WhatsApp setelah data disetujui.
            </div>
            <?php endif; ?>

            <!-- Contact Info untuk Public -->
            <?php if (!isset($_SESSION['user_id'])): ?>
            <div class="form-card">
                <h4>üìû Informasi Kontak Anda</h4>
                <p class="form-description">Untuk konfirmasi dan verifikasi data</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="submitter_name">Nama Lengkap Anda *</label>
                        <input type="text" id="submitter_name" name="submitter_name" required
                               placeholder="Nama lengkap Anda sebagai pengisi form">
                    </div>
                    <div class="form-group">
                        <label for="submitter_phone">No. WhatsApp *</label>
                        <input type="text" id="submitter_phone" name="submitter_phone" required
                               placeholder="Contoh: 081234567890">
                    </div>
                </div>
                <div class="form-group">
                    <label for="submitter_relation">Hubungan dengan Keluarga *</label>
                    <select id="submitter_relation" name="submitter_relation" required>
                        <option value="">Pilih Hubungan</option>
                        <option value="kepala_keluarga">Kepala Keluarga</option>
                        <option value="istri">Istri</option>
                        <option value="anak">Anak</option>
                        <option value="kerabat">Kerabat</option>
                        <option value="tetangga">Tetangga</option>
                        <option value="lainnya">Lainnya</option>
                    </select>
                </div>
            </div>
            <?php endif; ?>

            <!-- Basic Info Card -->
            <div class="form-card">
                <h4>Informasi Wajib Keluarga</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="register_number">No Register *</label>
                        <input type="text" id="register_number" name="register_number" required>
                    </div>

                    <!-- Church Selection for Public Users -->
                    <?php if (!isset($_SESSION['user_id'])): ?>
                    <div class="form-group">
                        <label for="church_id">Gereja *</label>
                        <select id="church_id" name="church_id" required onchange="loadNeighborhoods()">
                            <option value="">Pilih Gereja</option>
                            <?php
                            $conn = getDB();
                            $churches = $conn->query("SELECT * FROM churches ORDER BY church_name")->fetchAll();
                            foreach ($churches as $church) {
                                echo '<option value="' . $church['id'] . '">' . htmlspecialchars($church['church_name']) . '</option>';
                            }
                            ?>
                        </select>
                    </div>
                    <?php endif; ?>

                    <div class="form-group">
                        <label for="neighborhood">Lingkungan *</label>
                        <select id="neighborhood" name="neighborhood" required>
                            <option value="">Pilih Gereja terlebih dahulu</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="family_address">Alamat Keluarga *</label>
                    <textarea id="family_address" name="family_address" rows="3" required
                              placeholder="Masukkan alamat lengkap keluarga..."></textarea>
                </div>
            </div>

            <!-- Father Data Card -->
            <div class="form-card family-member-card" id="father-card">
                <div class="card-header">
                    <h4>Data Ayah</h4>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="father_name">Nama Lengkap *</label>
                        <input type="text" id="father_name" name="family_members[father][name]" required
                               placeholder="Nama lengkap ayah">
                    </div>
                    <div class="form-group">
                        <label for="father_birth_date">Tanggal Lahir</label>
                        <input type="date" id="father_birth_date" name="family_members[father][birth_date]">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="father_phone">No HP</label>
                        <input type="text" id="father_phone" name="family_members[father][phone]">
                    </div>
                    <div class="form-group">
                        <label for="father_education">Pendidikan *</label>
                        <select id="father_education" name="family_members[father][education]">
                            <option value="">Pilih Pendidikan</option>
                            <option value="SD/Sederajat">SD/Sederajat</option>
                            <option value="SMP/Sederajat">SMP/Sederajat</option>
                            <option value="SMA/Sederajat">SMA/Sederajat</option>
                            <option value="Diploma">Diploma</option>
                            <option value="Sarjana">Sarjana</option>
                            <option value="Magister">Magister</option>
                            <option value="Doktor">Doktor</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="father_occupation">Pekerjaan *</label>
                        <select id="father_occupation" name="family_members[father][occupation]">
                            <option value="">Pilih Pekerjaan</option>
                            <option value="Bidang Medis/Kesehatan">Bidang Medis/Kesehatan</option>
                            <option value="Teknologi & IT">Teknologi & IT</option>
                            <option value="Pendidikan & Pengajaran">Pendidikan & Pengajaran</option>
                            <option value="Pemerintahan">Pemerintahan</option>
                            <option value="Wiraswasta/Bisnis">Wiraswasta/Bisnis</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="father_notes">Keterangan</label>
                        <input type="text" id="father_notes" name="family_members[father][notes]">
                    </div>
                </div>
                <div class="form-grid documents-section">
                    <div class="form-group">
                        <label for="father_birth_file">Akte Lahir</label>
                        <input type="file" id="father_birth_file" name="family_members[father][birth_file]" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="father_baptism_file">Sertifikat Baptis</label>
                        <input type="file" id="father_baptism_file" name="family_members[father][baptism_file]" accept="image/*">
                    </div>
                </div>
                <div class="form-grid documents-section">
                    <div class="form-group">
                        <label for="father_confirmation_file">Sertifikat Sidi</label>
                        <input type="file" id="father_confirmation_file" name="family_members[father][confirmation_file]" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="father_marriage_file">Sertifikat Nikah</label>
                        <input type="file" id="father_marriage_file" name="family_members[father][marriage_file]" accept="image/*">
                    </div>
                </div>
                <input type="hidden" name="family_members[father][relationship]" value="bapa">
            </div>

            <!-- Mother Data Card -->
            <div class="form-card family-member-card" id="mother-card">
                <div class="card-header">
                    <h4>Data Ibu</h4>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="mother_name">Nama Lengkap *</label>
                        <input type="text" id="mother_name" name="family_members[mother][name]" required
                               placeholder="Nama lengkap ibu">
                    </div>
                    <div class="form-group">
                        <label for="mother_birth_date">Tanggal Lahir</label>
                        <input type="date" id="mother_birth_date" name="family_members[mother][birth_date]">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="mother_phone">No HP</label>
                        <input type="text" id="mother_phone" name="family_members[mother][phone]">
                    </div>
                    <div class="form-group">
                        <label for="mother_education">Pendidikan *</label>
                        <select id="mother_education" name="family_members[mother][education]">
                            <option value="">Pilih Pendidikan</option>
                            <option value="SD/Sederajat">SD/Sederajat</option>
                            <option value="SMP/Sederajat">SMP/Sederajat</option>
                            <option value="SMA/Sederajat">SMA/Sederajat</option>
                            <option value="Diploma">Diploma</option>
                            <option value="Sarjana">Sarjana</option>
                            <option value="Magister">Magister</option>
                            <option value="Doktor">Doktor</option>
                        </select>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="mother_occupation">Pekerjaan *</label>
                        <select id="mother_occupation" name="family_members[mother][occupation]">
                            <option value="">Pilih Pekerjaan</option>
                            <option value="Bidang Medis/Kesehatan">Bidang Medis/Kesehatan</option>
                            <option value="Teknologi & IT">Teknologi & IT</option>
                            <option value="Pendidikan & Pengajaran">Pendidikan & Pengajaran</option>
                            <option value="Pemerintahan">Pemerintahan</option>
                            <option value="Wiraswasta/Bisnis">Wiraswasta/Bisnis</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mother_notes">Keterangan</label>
                        <input type="text" id="mother_notes" name="family_members[mother][notes]">
                    </div>
                </div>
                <div class="form-grid documents-section">
                    <div class="form-group">
                        <label for="mother_birth_file">Akte Lahir</label>
                        <input type="file" id="mother_birth_file" name="family_members[mother][birth_file]" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="mother_baptism_file">Sertifikat Baptis</label>
                        <input type="file" id="mother_baptism_file" name="family_members[mother][baptism_file]" accept="image/*">
                    </div>
                </div>
                <div class="form-grid documents-section">
                    <div class="form-group">
                        <label for="mother_confirmation_file">Sertifikat Sidi</label>
                        <input type="file" id="mother_confirmation_file" name="family_members[mother][confirmation_file]" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="mother_marriage_file">Sertifikat Nikah</label>
                        <input type="file" id="mother_marriage_file" name="family_members[mother][marriage_file]" accept="image/*">
                    </div>
                </div>
                <input type="hidden" name="family_members[mother][relationship]" value="ibu">
            </div>

            <!-- Head of Family Selection Card -->
            <div class="form-card">
                <h4>Pilih Kepala Keluarga</h4>
                <p class="form-description">Pilih siapa yang akan menjadi kepala keluarga</p>

                <div class="head-options">
                    <label class="head-option">
                        <input type="radio" name="head_of_family" value="father" id="head-father" checked>
                        <span>Ayah</span>
                    </label>

                    <label class="head-option">
                        <input type="radio" name="head_of_family" value="mother" id="head-mother">
                        <span>Ibu</span>
                    </label>

                    <div id="children-head-options">
                        <!-- Dynamic child options will be added here -->
                    </div>

                    <div id="guardians-head-options">
                        <!-- Dynamic guardian options will be added here -->
                    </div>
                </div>
            </div>

            <div class="step-buttons">
                <button type="button" class="btn-next" data-next="2">Lanjut ke Anggota Keluarga</button>
            </div>
        </div>

        <!-- Step 2: Family Members (Children & Guardians) -->
        <div class="form-step" id="step-2">
            <div class="step-header">
                <h3>Anggota Keluarga Lainnya</h3>
                <p class="step-description">Tambahkan data anak-anak dan tanggungan lainnya</p>
            </div>

            <!-- Children Section -->
            <div class="family-section">
                <div class="section-header">
                    <h4>Anak-Anak</h4>
                    <button type="button" class="btn-add" id="addChild">+ Tambah Anak</button>
                </div>

                <div id="children-container">
                    <!-- Dynamic children cards will be added here -->
                </div>
            </div>

            <!-- Dependents Section -->
            <div class="family-section">
                <div class="section-header">
                    <h4>Tanggungan Lainnya</h4>
                    <button type="button" class="btn-add" id="addDependent">+ Tambah Tanggungan</button>
                </div>

                <div id="dependents-container">
                    <!-- Dynamic dependents cards will be added here -->
                </div>
            </div>

            <div class="step-buttons">
                <button type="button" class="btn-prev" data-prev="1">Kembali</button>
                <button type="button" class="btn-next" data-next="3">Lanjut ke Finalisasi</button>
            </div>
        </div>

        <!-- Step 3: Submit -->
        <div class="form-step" id="step-3">
            <div class="step-header">
                <h3>Finalisasi Data</h3>
                <p class="step-description">Periksa kembali data yang telah dimasukkan sebelum menyimpan</p>
            </div>

            <div class="form-card">
                <h4>Ringkasan Data Keluarga</h4>
                <div id="family-summary">
                    <!-- Summary will be generated by JavaScript -->
                </div>
            </div>

            <div class="form-card">
                <h4>Catatan Tambahan</h4>
                <div class="form-group">
                    <label for="additional_notes">Keterangan Tambahan</label>
                    <textarea id="additional_notes" name="additional_notes" rows="4" placeholder="Catatan tambahan untuk keluarga ini..."></textarea>
                </div>
            </div>

            <div class="step-buttons">
                <button type="button" class="btn-prev" data-prev="2">Kembali</button>
                <button type="submit" class="btn-submit">Simpan Data Keluarga</button>
            </div>
        </div>
    </form>
</div>

<!-- Template for Child Card -->
<template id="child-template">
    <div class="form-card family-member-card child-card" data-index="__INDEX__">
        <div class="card-header">
            <h4>Data Anak #__NUMBER__</h4>
            <button type="button" class="btn-remove" data-target="child" data-index="__INDEX__">√ó</button>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="child_name___INDEX__">Nama Lengkap *</label>
                <input type="text" id="child_name___INDEX__" name="family_members[children][__INDEX__][name]" required
                       placeholder="Nama lengkap anak">
            </div>
            <div class="form-group">
                <label for="child_gender___INDEX__">Jenis Kelamin</label>
                <select id="child_gender___INDEX__" name="family_members[children][__INDEX__][gender]">
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="Laki-laki">Laki-laki</option>
                    <option value="Perempuan">Perempuan</option>
                </select>
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="child_birth_date___INDEX__">Tanggal Lahir</label>
                <input type="date" id="child_birth_date___INDEX__" name="family_members[children][__INDEX__][birth_date]">
            </div>
            <div class="form-group">
                <label for="child_phone___INDEX__">No HP</label>
                <input type="text" id="child_phone___INDEX__" name="family_members[children][__INDEX__][phone]">
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="child_education___INDEX__">Pendidikan</label>
                <select id="child_education___INDEX__" name="family_members[children][__INDEX__][education]">
                    <option value="">Pilih Pendidikan</option>
                    <option value="SD/Sederajat">SD/Sederajat</option>
                    <option value="SMP/Sederajat">SMP/Sederajat</option>
                    <option value="SMA/Sederajat">SMA/Sederajat</option>
                    <option value="Diploma">Diploma</option>
                    <option value="Sarjana">Sarjana</option>
                    <option value="Magister">Magister</option>
                    <option value="Doktor">Doktor</option>
                </select>
            </div>
            <div class="form-group">
                <label for="child_occupation___INDEX__">Pekerjaan</label>
                <select id="child_occupation___INDEX__" name="family_members[children][__INDEX__][occupation]">
                    <option value="">Pilih Pekerjaan</option>
                    <option value="Bidang Medis/Kesehatan">Bidang Medis/Kesehatan</option>
                    <option value="Teknologi & IT">Teknologi & IT</option>
                    <option value="Pendidikan & Pengajaran">Pendidikan & Pengajaran</option>
                    <option value="Pemerintahan">Pemerintahan</option>
                    <option value="Wiraswasta/Bisnis">Wiraswasta/Bisnis</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>
        </div>
        <div class="form-grid documents-section">
            <div class="form-group">
                <label for="child_birth_file___INDEX__">Akte Lahir</label>
                <input type="file" id="child_birth_file___INDEX__" name="family_members[children][__INDEX__][birth_file]" accept="image/*">
            </div>
            <div class="form-group">
                <label for="child_baptism_file___INDEX__">Sertifikat Baptis</label>
                <input type="file" id="child_baptism_file___INDEX__" name="family_members[children][__INDEX__][baptism_file]" accept="image/*">
            </div>
        </div>
        <div class="form-grid documents-section">
            <div class="form-group">
                <label for="child_confirmation_file___INDEX__">Sertifikat Sidi</label>
                <input type="file" id="child_confirmation_file___INDEX__" name="family_members[children][__INDEX__][confirmation_file]" accept="image/*">
            </div>
            <div class="form-group">
                <label for="child_notes___INDEX__">Keterangan</label>
                <input type="text" id="child_notes___INDEX__" name="family_members[children][__INDEX__][notes]">
            </div>
        </div>
        <input type="hidden" name="family_members[children][__INDEX__][relationship]" value="anak">
    </div>
</template>

<!-- Template for Dependent Card -->
<template id="dependent-template">
    <div class="form-card family-member-card dependent-card" data-index="__INDEX__">
        <div class="card-header">
            <h4>Data Tanggungan #__NUMBER__</h4>
            <button type="button" class="btn-remove" data-target="dependent" data-index="__INDEX__">√ó</button>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="dependent_name___INDEX__">Nama Lengkap *</label>
                <input type="text" id="dependent_name___INDEX__" name="family_members[dependents][__INDEX__][name]" required
                       placeholder="Nama lengkap tanggungan">
            </div>
            <div class="form-group">
                <label for="dependent_gender___INDEX__">Jenis Kelamin</label>
                <select id="dependent_gender___INDEX__" name="family_members[dependents][__INDEX__][gender]">
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="Laki-laki">Laki-laki</option>
                    <option value="Perempuan">Perempuan</option>
                </select>
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="dependent_birth_date___INDEX__">Tanggal Lahir</label>
                <input type="date" id="dependent_birth_date___INDEX__" name="family_members[dependents][__INDEX__][birth_date]">
            </div>
            <div class="form-group">
                <label for="dependent_phone___INDEX__">No HP</label>
                <input type="text" id="dependent_phone___INDEX__" name="family_members[dependents][__INDEX__][phone]">
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="dependent_education___INDEX__">Pendidikan</label>
                <select id="dependent_education___INDEX__" name="family_members[dependents][__INDEX__][education]">
                    <option value="">Pilih Pendidikan</option>
                    <option value="SD/Sederajat">SD/Sederajat</option>
                    <option value="SMP/Sederajat">SMP/Sederajat</option>
                    <option value="SMA/Sederajat">SMA/Sederajat</option>
                    <option value="Diploma">Diploma</option>
                    <option value="Sarjana">Sarjana</option>
                    <option value="Magister">Magister</option>
                    <option value="Doktor">Doktor</option>
                </select>
            </div>
            <div class="form-group">
                <label for="dependent_occupation___INDEX__">Pekerjaan</label>
                <select id="dependent_occupation___INDEX__" name="family_members[dependents][__INDEX__][occupation]">
                    <option value="">Pilih Pekerjaan</option>
                    <option value="Bidang Medis/Kesehatan">Bidang Medis/Kesehatan</option>
                    <option value="Teknologi & IT">Teknologi & IT</option>
                    <option value="Pendidikan & Pengajaran">Pendidikan & Pengajaran</option>
                    <option value="Pemerintahan">Pemerintahan</option>
                    <option value="Wiraswasta/Bisnis">Wiraswasta/Bisnis</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>
        </div>
        <div class="form-grid documents-section">
            <div class="form-group">
                <label for="dependent_birth_file___INDEX__">Akte Lahir</label>
                <input type="file" id="dependent_birth_file___INDEX__" name="family_members[dependents][__INDEX__][birth_file]" accept="image/*">
            </div>
            <div class="form-group">
                <label for="dependent_baptism_file___INDEX__">Sertifikat Baptis</label>
                <input type="file" id="dependent_baptism_file___INDEX__" name="family_members[dependents][__INDEX__][baptism_file]" accept="image/*">
            </div>
        </div>
        <div class="form-grid documents-section">
            <div class="form-group">
                <label for="dependent_confirmation_file___INDEX__">Sertifikat Sidi</label>
                <input type="file" id="dependent_confirmation_file___INDEX__" name="family_members[dependents][__INDEX__][confirmation_file]" accept="image/*">
            </div>
            <div class="form-group">
                <label for="dependent_notes___INDEX__">Keterangan</label>
                <input type="text" id="dependent_notes___INDEX__" name="family_members[dependents][__INDEX__][notes]">
            </div>
        </div>
        <input type="hidden" name="family_members[dependents][__INDEX__][relationship]" value="tanggungan">
    </div>
</template>

<!-- WhatsApp Share Button -->
<div class="whatsapp-share" style="text-align: center; margin-top: 20px; padding: 20px;">
    <h3>üì± Bagikan Form Ini</h3>
    <p>Bagikan link form ini ke keluarga lain via WhatsApp</p>
    <button onclick="shareViaWhatsApp()" class="btn btn-success"
            style="background: #25D366; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer;">
        üì§ Bagikan via WhatsApp
    </button>
</div>

<script>
// Function to get device information
function getDeviceInfo() {
    const deviceInfo = {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        screenResolution: screen.width + 'x' + screen.height,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        timestamp: new Date().toISOString(),
        referrer: document.referrer || 'direct',
        pageUrl: window.location.href,
        cookiesEnabled: navigator.cookieEnabled,
        javaEnabled: navigator.javaEnabled ? navigator.javaEnabled() : false,
        doNotTrack: navigator.doNotTrack || 'unspecified'
    };
    return deviceInfo;
}

// Function to track share action
function trackShare(action = 'share') {
    const deviceInfo = getDeviceInfo();
    deviceInfo.action = action;

    // Send tracking data to server
    fetch('track_share_enhanced.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(deviceInfo)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Tracking successful:', data);
    })
    .catch(error => {
        console.log('Tracking failed, but continuing with share:', error);
    });

    return deviceInfo;
}

// Main WhatsApp share function
function shareViaWhatsApp() {
    // Track the share action
    const deviceInfo = trackShare('whatsapp_share');

    const url = window.location.href;
    const text = "üìã *FORM DATA KELUARGA GEREJA*\n\n" +
                 "Halo! Silakan isi data keluarga Anda melalui link berikut:\n\n" +
                 "üîó " + url + "\n\n" +
                 "*Form ini untuk:*\n" +
                 "‚Ä¢ Update data anggota jemaat\n" +
                 "‚Ä¢ Pendaftaran keluarga baru\n" +
                 "‚Ä¢ Perubahan data keluarga\n\n" +
                 "Terima kasih üôè";

    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
}

// Track page view for public access
document.addEventListener('DOMContentLoaded', function() {
    // Track page visit
    trackShare('page_visit');

    // Update WhatsApp share button
    const shareButton = document.querySelector('.whatsapp-share button');
    if (shareButton) {
        shareButton.onclick = shareViaWhatsApp;
    }

    // Auto-load neighborhoods for logged-in users
    <?php if (isset($_SESSION['user_id']) && $current_church_id): ?>
    loadNeighborhoodsForLoggedInUser(<?php echo $current_church_id; ?>);
    <?php endif; ?>
});

// Additional tracking for form interactions
document.addEventListener('click', function(e) {
    if (e.target.matches('button[type="submit"]') ||
        e.target.matches('input[type="submit"]') ||
        e.target.matches('.btn-submit')) {
        trackShare('form_submit_attempt');
    }
});

// Function to load neighborhoods based on selected church
function loadNeighborhoods() {
    const churchId = document.getElementById('church_id').value;
    const neighborhoodSelect = document.getElementById('neighborhood');

    if (!churchId) {
        neighborhoodSelect.innerHTML = '<option value="">Pilih Gereja terlebih dahulu</option>';
        return;
    }

    // Show loading
    neighborhoodSelect.innerHTML = '<option value="">Memuat lingkungan...</option>';

    // Fetch neighborhoods via AJAX
    fetch('get_neighborhoods.php?church_id=' + churchId)
        .then(response => response.json())
        .then(data => {
            neighborhoodSelect.innerHTML = '<option value="">Pilih Lingkungan</option>';
            data.forEach(neighborhood => {
                const option = document.createElement('option');
                option.value = neighborhood.neighborhood_name;
                option.textContent = neighborhood.neighborhood_name +
                    (neighborhood.description ? ' - ' + neighborhood.description : '');
                neighborhoodSelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error loading neighborhoods:', error);
            neighborhoodSelect.innerHTML = '<option value="">Error memuat lingkungan</option>';
        });
}

// Function to load neighborhoods for logged-in users (auto-load based on their church)
function loadNeighborhoodsForLoggedInUser(churchId) {
    const neighborhoodSelect = document.getElementById('neighborhood');

    if (!churchId) {
        neighborhoodSelect.innerHTML = '<option value="">Tidak ada gereja yang terkait</option>';
        return;
    }

    // Show loading
    neighborhoodSelect.innerHTML = '<option value="">Memuat lingkungan...</option>';

    // Fetch neighborhoods via AJAX
    fetch('get_neighborhoods.php?church_id=' + churchId)
        .then(response => response.json())
        .then(data => {
            neighborhoodSelect.innerHTML = '<option value="">Pilih Lingkungan</option>';
            data.forEach(neighborhood => {
                const option = document.createElement('option');
                option.value = neighborhood.neighborhood_name;
                option.textContent = neighborhood.neighborhood_name +
                    (neighborhood.description ? ' - ' + neighborhood.description : '');
                neighborhoodSelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error loading neighborhoods:', error);
            neighborhoodSelect.innerHTML = '<option value="">Error memuat lingkungan</option>';
        });
}
</script>

<style>
.whatsapp-share {
    background: #f8fff9;
    border: 2px solid #25D366;
    border-radius: 10px;
    margin: 20px 0;
    padding: 20px;
    text-align: center;
}

.whatsapp-share h3 {
    color: #25D366;
    margin-bottom: 10px;
}

.whatsapp-share p {
    color: #666;
    margin-bottom: 15px;
}

.btn-success {
    background: #25D366;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s ease;
}

.btn-success:hover {
    background: #1da851;
}

/* Responsive design untuk mobile */
@media (max-width: 768px) {
    .form-container {
        padding: 10px;
    }

    .form-card {
        padding: 15px;
    }

    .form-grid {
        grid-template-columns: 1fr;
    }
}

/* Style untuk public access */
.alert-info {
    background: #e3f2fd;
    border: 1px solid #2196f3;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
}
</style>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\add_form_enhanced.php =====

<?php
session_start();
require_once 'config/config.php';

$page_title = 'Tambah Anggota - Jemaat App';

// PUBLIC ACCESS - Tidak perlu login
$current_role = isset($_SESSION['role']) ? $_SESSION['role'] : 'public';
$user_id = isset($_SESSION['user_id']) ? $_SESSION['user_id'] : null;

// Tidak ada redirect ke login page - form bisa diakses publik
include 'header.php';
?>

<div class="form-container">
    <h1>Tambah Anggota Baru</h1>

    <!-- Step Indicator -->
    <div class="form-steps">
        <div class="step active" data-step="1">
            <span class="step-number">1</span>
            <span class="step-title">Informasi Dasar</span>
        </div>
        <div class="step" data-step="2">
            <span class="step-number">2</span>
            <span class="step-title">Anggota Keluarga</span>
        </div>
        <div class="step" data-step="3">
            <span class="step-number">3</span>
            <span class="step-title">Dokumen & Submit</span>
        </div>
    </div>

    <form action="add_member_public.php" method="post" enctype="multipart/form-data" id="memberForm">

        <!-- Hidden field untuk tracking -->
        <input type="hidden" name="submitted_by" value="<?php echo $user_id ?: 'public'; ?>">
        <input type="hidden" name="user_role" value="<?php echo $current_role; ?>">

        <!-- Step 1: Basic Info - INCLUDING PARENTS DATA -->
        <div class="form-step active" id="step-1">
            <div class="step-header">
                <h3>Informasi Dasar Keluarga</h3>
                <p class="step-description">Lengkapi data keluarga dan pilih kepala keluarga</p>
            </div>

            <!-- Info untuk public access -->
            <?php if (!isset($_SESSION['user_id'])): ?>
            <div class="alert alert-info">
                <strong>üìù Form Publik</strong> - Data yang Anda isi akan diajukan untuk persetujuan administrator.
                Anda akan menerima konfirmasi via WhatsApp setelah data disetujui.
            </div>
            <?php endif; ?>

            <!-- Contact Info untuk Public -->
            <?php if (!isset($_SESSION['user_id'])): ?>
            <div class="form-card">
                <h4>üìû Informasi Kontak Anda</h4>
                <p class="form-description">Untuk konfirmasi dan verifikasi data</p>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="submitter_name">Nama Lengkap Anda *</label>
                        <input type="text" id="submitter_name" name="submitter_name" required
                               placeholder="Nama lengkap Anda sebagai pengisi form">
                    </div>
                    <div class="form-group">
                        <label for="submitter_phone">No. WhatsApp *</label>
                        <input type="text" id="submitter_phone" name="submitter_phone" required
                               placeholder="Contoh: 081234567890">
                    </div>
                </div>
                <div class="form-group">
                    <label for="submitter_relation">Hubungan dengan Keluarga *</label>
                    <select id="submitter_relation" name="submitter_relation" required>
                        <option value="">Pilih Hubungan</option>
                        <option value="kepala_keluarga">Kepala Keluarga</option>
                        <option value="istri">Istri</option>
                        <option value="anak">Anak</option>
                        <option value="kerabat">Kerabat</option>
                        <option value="tetangga">Tetangga</option>
                        <option value="lainnya">Lainnya</option>
                    </select>
                </div>
            </div>
            <?php endif; ?>

            <!-- Basic Info Card -->
            <div class="form-card">
                <h4>Informasi Wajib Keluarga</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="register_number">No Register *</label>
                        <input type="text" id="register_number" name="register_number" required>
                    </div>

                    <!-- Church Selection for Public Users -->
                    <?php if (!isset($_SESSION['user_id'])): ?>
                    <div class="form-group">
                        <label for="church_id">Gereja *</label>
                        <select id="church_id" name="church_id" required onchange="loadNeighborhoods()">
                            <option value="">Pilih Gereja</option>
                            <?php
                            $conn = getDB();
                            $churches = $conn->query("SELECT * FROM churches ORDER BY church_name")->fetchAll();
                            foreach ($churches as $church) {
                                echo '<option value="' . $church['id'] . '">' . htmlspecialchars($church['church_name']) . '</option>';
                            }
                            ?>
                        </select>
                    </div>
                    <?php endif; ?>

                    <div class="form-group">
                        <label for="neighborhood">Lingkungan *</label>
                        <select id="neighborhood" name="neighborhood" required>
                            <option value="">Pilih Gereja terlebih dahulu</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="family_address">Alamat Keluarga *</label>
                    <textarea id="family_address" name="family_address" rows="3" required
                              placeholder="Masukkan alamat lengkap keluarga..."></textarea>
                </div>
            </div>

            <!-- Father Data Card -->
            <div class="form-card family-member-card" id="father-card">
                <div class="card-header">
                    <h4>Data Ayah</h4>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="father_name">Nama Lengkap *</label>
                        <input type="text" id="father_name" name="family_members[father][name]" required
                               placeholder="Nama lengkap ayah">
                    </div>
                    <div class="form-group">
                        <label for="father_birth_date">Tanggal Lahir</label>
                        <input type="date" id="father_birth_date" name="family_members[father][birth_date]">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="father_phone">No HP</label>
                        <input type="text" id="father_phone" name="family_members[father][phone]">
                    </div>
                    <div class="form-group">
                        <label for="father_education">Pendidikan</label>
                        <input type="text" id="father_education" name="family_members[father][education]">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="father_occupation">Pekerjaan</label>
                        <input type="text" id="father_occupation" name="family_members[father][occupation]">
                    </div>
                    <div class="form-group">
                        <label for="father_notes">Keterangan</label>
                        <input type="text" id="father_notes" name="family_members[father][notes]">
                    </div>
                </div>
                <div class="form-grid documents-section">
                    <div class="form-group">
                        <label for="father_birth_file">Akte Lahir</label>
                        <input type="file" id="father_birth_file" name="family_members[father][birth_file]" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="father_baptism_file">Sertifikat Baptis</label>
                        <input type="file" id="father_baptism_file" name="family_members[father][baptism_file]" accept="image/*">
                    </div>
                </div>
                <div class="form-grid documents-section">
                    <div class="form-group">
                        <label for="father_confirmation_file">Sertifikat Sidi</label>
                        <input type="file" id="father_confirmation_file" name="family_members[father][confirmation_file]" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="father_marriage_file">Sertifikat Nikah</label>
                        <input type="file" id="father_marriage_file" name="family_members[father][marriage_file]" accept="image/*">
                    </div>
                </div>
                <input type="hidden" name="family_members[father][relationship]" value="bapa">
            </div>

            <!-- Mother Data Card -->
            <div class="form-card family-member-card" id="mother-card">
                <div class="card-header">
                    <h4>Data Ibu</h4>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="mother_name">Nama Lengkap *</label>
                        <input type="text" id="mother_name" name="family_members[mother][name]" required
                               placeholder="Nama lengkap ibu">
                    </div>
                    <div class="form-group">
                        <label for="mother_birth_date">Tanggal Lahir</label>
                        <input type="date" id="mother_birth_date" name="family_members[mother][birth_date]">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="mother_phone">No HP</label>
                        <input type="text" id="mother_phone" name="family_members[mother][phone]">
                    </div>
                    <div class="form-group">
                        <label for="mother_education">Pendidikan</label>
                        <input type="text" id="mother_education" name="family_members[mother][education]">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="mother_occupation">Pekerjaan</label>
                        <input type="text" id="mother_occupation" name="family_members[mother][occupation]">
                    </div>
                    <div class="form-group">
                        <label for="mother_notes">Keterangan</label>
                        <input type="text" id="mother_notes" name="family_members[mother][notes]">
                    </div>
                </div>
                <div class="form-grid documents-section">
                    <div class="form-group">
                        <label for="mother_birth_file">Akte Lahir</label>
                        <input type="file" id="mother_birth_file" name="family_members[mother][birth_file]" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="mother_baptism_file">Sertifikat Baptis</label>
                        <input type="file" id="mother_baptism_file" name="family_members[mother][baptism_file]" accept="image/*">
                    </div>
                </div>
                <div class="form-grid documents-section">
                    <div class="form-group">
                        <label for="mother_confirmation_file">Sertifikat Sidi</label>
                        <input type="file" id="mother_confirmation_file" name="family_members[mother][confirmation_file]" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label for="mother_marriage_file">Sertifikat Nikah</label>
                        <input type="file" id="mother_marriage_file" name="family_members[mother][marriage_file]" accept="image/*">
                    </div>
                </div>
                <input type="hidden" name="family_members[mother][relationship]" value="ibu">
            </div>

            <!-- Head of Family Selection Card -->
            <div class="form-card">
                <h4>Pilih Kepala Keluarga</h4>
                <p class="form-description">Pilih siapa yang akan menjadi kepala keluarga</p>

                <div class="head-options">
                    <label class="head-option">
                        <input type="radio" name="head_of_family" value="father" id="head-father" checked>
                        <span>Ayah</span>
                    </label>

                    <label class="head-option">
                        <input type="radio" name="head_of_family" value="mother" id="head-mother">
                        <span>Ibu</span>
                    </label>

                    <div id="children-head-options">
                        <!-- Dynamic child options will be added here -->
                    </div>

                    <div id="guardians-head-options">
                        <!-- Dynamic guardian options will be added here -->
                    </div>
                </div>
            </div>

            <div class="step-buttons">
                <button type="button" class="btn-next" data-next="2">Lanjut ke Anggota Keluarga</button>
            </div>
        </div>

        <!-- Step 2: Family Members (Children & Guardians) -->
        <div class="form-step" id="step-2">
            <div class="step-header">
                <h3>Anggota Keluarga Lainnya</h3>
                <p class="step-description">Tambahkan data anak-anak dan tanggungan lainnya</p>
            </div>

            <!-- Children Section -->
            <div class="family-section">
                <div class="section-header">
                    <h4>Anak-Anak</h4>
                    <button type="button" class="btn-add" id="addChild">+ Tambah Anak</button>
                </div>

                <div id="children-container">
                    <!-- Dynamic children cards will be added here -->
                </div>
            </div>

            <!-- Dependents Section -->
            <div class="family-section">
                <div class="section-header">
                    <h4>Tanggungan Lainnya</h4>
                    <button type="button" class="btn-add" id="addDependent">+ Tambah Tanggungan</button>
                </div>

                <div id="dependents-container">
                    <!-- Dynamic dependents cards will be added here -->
                </div>
            </div>

            <div class="step-buttons">
                <button type="button" class="btn-prev" data-prev="1">Kembali</button>
                <button type="button" class="btn-next" data-next="3">Lanjut ke Finalisasi</button>
            </div>
        </div>

        <!-- Step 3: Submit -->
        <div class="form-step" id="step-3">
            <div class="step-header">
                <h3>Finalisasi Data</h3>
                <p class="step-description">Periksa kembali data yang telah dimasukkan sebelum menyimpan</p>
            </div>

            <div class="form-card">
                <h4>Ringkasan Data Keluarga</h4>
                <div id="family-summary">
                    <!-- Summary will be generated by JavaScript -->
                </div>
            </div>

            <div class="form-card">
                <h4>Catatan Tambahan</h4>
                <div class="form-group">
                    <label for="additional_notes">Keterangan Tambahan</label>
                    <textarea id="additional_notes" name="additional_notes" rows="4" placeholder="Catatan tambahan untuk keluarga ini..."></textarea>
                </div>
            </div>

            <div class="step-buttons">
                <button type="button" class="btn-prev" data-prev="2">Kembali</button>
                <button type="submit" class="btn-submit">Simpan Data Keluarga</button>
            </div>
        </div>
    </form>
</div>

<!-- Template for Child Card -->
<template id="child-template">
    <div class="form-card family-member-card child-card" data-index="__INDEX__">
        <div class="card-header">
            <h4>Data Anak #__NUMBER__</h4>
            <button type="button" class="btn-remove" data-target="child" data-index="__INDEX__">√ó</button>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="child_name___INDEX__">Nama Lengkap *</label>
                <input type="text" id="child_name___INDEX__" name="family_members[children][__INDEX__][name]" required
                       placeholder="Nama lengkap anak">
            </div>
            <div class="form-group">
                <label for="child_gender___INDEX__">Jenis Kelamin</label>
                <select id="child_gender___INDEX__" name="family_members[children][__INDEX__][gender]">
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="Laki-laki">Laki-laki</option>
                    <option value="Perempuan">Perempuan</option>
                </select>
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="child_birth_date___INDEX__">Tanggal Lahir</label>
                <input type="date" id="child_birth_date___INDEX__" name="family_members[children][__INDEX__][birth_date]">
            </div>
            <div class="form-group">
                <label for="child_phone___INDEX__">No HP</label>
                <input type="text" id="child_phone___INDEX__" name="family_members[children][__INDEX__][phone]">
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="child_education___INDEX__">Pendidikan</label>
                <input type="text" id="child_education___INDEX__" name="family_members[children][__INDEX__][education]">
            </div>
            <div class="form-group">
                <label for="child_occupation___INDEX__">Pekerjaan</label>
                <input type="text" id="child_occupation___INDEX__" name="family_members[children][__INDEX__][occupation]">
            </div>
        </div>
        <div class="form-grid documents-section">
            <div class="form-group">
                <label for="child_birth_file___INDEX__">Akte Lahir</label>
                <input type="file" id="child_birth_file___INDEX__" name="family_members[children][__INDEX__][birth_file]" accept="image/*">
            </div>
            <div class="form-group">
                <label for="child_baptism_file___INDEX__">Sertifikat Baptis</label>
                <input type="file" id="child_baptism_file___INDEX__" name="family_members[children][__INDEX__][baptism_file]" accept="image/*">
            </div>
        </div>
        <div class="form-grid documents-section">
            <div class="form-group">
                <label for="child_confirmation_file___INDEX__">Sertifikat Sidi</label>
                <input type="file" id="child_confirmation_file___INDEX__" name="family_members[children][__INDEX__][confirmation_file]" accept="image/*">
            </div>
            <div class="form-group">
                <label for="child_notes___INDEX__">Keterangan</label>
                <input type="text" id="child_notes___INDEX__" name="family_members[children][__INDEX__][notes]">
            </div>
        </div>
        <input type="hidden" name="family_members[children][__INDEX__][relationship]" value="anak">
    </div>
</template>

<!-- Template for Dependent Card -->
<template id="dependent-template">
    <div class="form-card family-member-card dependent-card" data-index="__INDEX__">
        <div class="card-header">
            <h4>Data Tanggungan #__NUMBER__</h4>
            <button type="button" class="btn-remove" data-target="dependent" data-index="__INDEX__">√ó</button>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="dependent_name___INDEX__">Nama Lengkap *</label>
                <input type="text" id="dependent_name___INDEX__" name="family_members[dependents][__INDEX__][name]" required
                       placeholder="Nama lengkap tanggungan">
            </div>
            <div class="form-group">
                <label for="dependent_gender___INDEX__">Jenis Kelamin</label>
                <select id="dependent_gender___INDEX__" name="family_members[dependents][__INDEX__][gender]">
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="Laki-laki">Laki-laki</option>
                    <option value="Perempuan">Perempuan</option>
                </select>
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="dependent_birth_date___INDEX__">Tanggal Lahir</label>
                <input type="date" id="dependent_birth_date___INDEX__" name="family_members[dependents][__INDEX__][birth_date]">
            </div>
            <div class="form-group">
                <label for="dependent_phone___INDEX__">No HP</label>
                <input type="text" id="dependent_phone___INDEX__" name="family_members[dependents][__INDEX__][phone]">
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="dependent_education___INDEX__">Pendidikan</label>
                <input type="text" id="dependent_education___INDEX__" name="family_members[dependents][__INDEX__][education]">
            </div>
            <div class="form-group">
                <label for="dependent_occupation___INDEX__">Pekerjaan</label>
                <input type="text" id="dependent_occupation___INDEX__" name="family_members[dependents][__INDEX__][occupation]">
            </div>
        </div>
        <div class="form-grid documents-section">
            <div class="form-group">
                <label for="dependent_birth_file___INDEX__">Akte Lahir</label>
                <input type="file" id="dependent_birth_file___INDEX__" name="family_members[dependents][__INDEX__][birth_file]" accept="image/*">
            </div>
            <div class="form-group">
                <label for="dependent_baptism_file___INDEX__">Sertifikat Baptis</label>
                <input type="file" id="dependent_baptism_file___INDEX__" name="family_members[dependents][__INDEX__][baptism_file]" accept="image/*">
            </div>
        </div>
        <div class="form-grid documents-section">
            <div class="form-group">
                <label for="dependent_confirmation_file___INDEX__">Sertifikat Sidi</label>
                <input type="file" id="dependent_confirmation_file___INDEX__" name="family_members[dependents][__INDEX__][confirmation_file]" accept="image/*">
            </div>
            <div class="form-group">
                <label for="dependent_notes___INDEX__">Keterangan</label>
                <input type="text" id="dependent_notes___INDEX__" name="family_members[dependents][__INDEX__][notes]">
            </div>
        </div>
        <input type="hidden" name="family_members[dependents][__INDEX__][relationship]" value="tanggungan">
    </div>
</template>

<!-- WhatsApp Share Button -->
<div class="whatsapp-share" style="text-align: center; margin-top: 20px; padding: 20px;">
    <h3>üì± Bagikan Form Ini</h3>
    <p>Bagikan link form ini ke keluarga lain via WhatsApp</p>
    <button onclick="shareViaWhatsApp()" class="btn btn-success"
            style="background: #25D366; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer;">
        üì§ Bagikan via WhatsApp
    </button>
</div>

<script>
// Function to get device information
function getDeviceInfo() {
    const deviceInfo = {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        screenResolution: screen.width + 'x' + screen.height,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        timestamp: new Date().toISOString(),
        referrer: document.referrer || 'direct',
        pageUrl: window.location.href,
        cookiesEnabled: navigator.cookieEnabled,
        javaEnabled: navigator.javaEnabled ? navigator.javaEnabled() : false,
        doNotTrack: navigator.doNotTrack || 'unspecified'
    };
    return deviceInfo;
}

// Function to track share action
function trackShare(action = 'share') {
    const deviceInfo = getDeviceInfo();
    deviceInfo.action = action;

    // Send tracking data to server
    fetch('track_share_enhanced.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(deviceInfo)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Tracking successful:', data);
    })
    .catch(error => {
        console.log('Tracking failed, but continuing with share:', error);
    });

    return deviceInfo;
}

// Main WhatsApp share function
function shareViaWhatsApp() {
    // Track the share action
    const deviceInfo = trackShare('whatsapp_share');

    const url = window.location.href;
    const text = "üìã *FORM DATA KELUARGA GEREJA*\n\n" +
                 "Halo! Silakan isi data keluarga Anda melalui link berikut:\n\n" +
                 "üîó " + url + "\n\n" +
                 "*Form ini untuk:*\n" +
                 "‚Ä¢ Update data anggota jemaat\n" +
                 "‚Ä¢ Pendaftaran keluarga baru\n" +
                 "‚Ä¢ Perubahan data keluarga\n\n" +
                 "Terima kasih üôè";

    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
}

// Track page view for public access
document.addEventListener('DOMContentLoaded', function() {
    // Track page visit
    trackShare('page_visit');

    // Update WhatsApp share button
    const shareButton = document.querySelector('.whatsapp-share button');
    if (shareButton) {
        shareButton.onclick = shareViaWhatsApp;
    }
});

// Additional tracking for form interactions
document.addEventListener('click', function(e) {
    if (e.target.matches('button[type="submit"]') ||
        e.target.matches('input[type="submit"]') ||
        e.target.matches('.btn-submit')) {
        trackShare('form_submit_attempt');
    }
});

// Function to load neighborhoods based on selected church
function loadNeighborhoods() {
    const churchId = document.getElementById('church_id').value;
    const neighborhoodSelect = document.getElementById('neighborhood');

    if (!churchId) {
        neighborhoodSelect.innerHTML = '<option value="">Pilih Gereja terlebih dahulu</option>';
        return;
    }

    // Show loading
    neighborhoodSelect.innerHTML = '<option value="">Memuat lingkungan...</option>';

    // Fetch neighborhoods via AJAX
    fetch('get_neighborhoods.php?church_id=' + churchId)
        .then(response => response.json())
        .then(data => {
            neighborhoodSelect.innerHTML = '<option value="">Pilih Lingkungan</option>';
            data.forEach(neighborhood => {
                const option = document.createElement('option');
                option.value = neighborhood.neighborhood_name;
                option.textContent = neighborhood.neighborhood_name +
                    (neighborhood.description ? ' - ' + neighborhood.description : '');
                neighborhoodSelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error loading neighborhoods:', error);
            neighborhoodSelect.innerHTML = '<option value="">Error memuat lingkungan</option>';
        });
}
</script>

<style>
.whatsapp-share {
    background: #f8fff9;
    border: 2px solid #25D366;
    border-radius: 10px;
    margin: 20px 0;
    padding: 20px;
    text-align: center;
}

.whatsapp-share h3 {
    color: #25D366;
    margin-bottom: 10px;
}

.whatsapp-share p {
    color: #666;
    margin-bottom: 15px;
}

.btn-success {
    background: #25D366;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s ease;
}

.btn-success:hover {
    background: #1da851;
}

/* Responsive design untuk mobile */
@media (max-width: 768px) {
    .form-container {
        padding: 10px;
    }

    .form-card {
        padding: 15px;
    }

    .form-grid {
        grid-template-columns: 1fr;
    }
}

/* Style untuk public access */
.alert-info {
    background: #e3f2fd;
    border: 1px solid #2196f3;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
}
</style>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\add_member.php =====

<?php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id']) || !isset($_SESSION['role'])) {
    header("Location: login.php");
    exit();
}

$page_title = 'Proses Data - Jemaat App';
include 'header.php';

// Function to handle file upload with compression
function handleFileUpload($file, $upload_dir = 'uploads/') {
    if (!file_exists($upload_dir)) {
        mkdir($upload_dir, 0777, true);
    }

    if ($file['error'] === UPLOAD_ERR_OK && !empty($file['name'])) {
        $file_extension = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));

        // Validate file type (only images)
        $allowed_types = ['jpg', 'jpeg', 'png', 'gif'];
        if (!in_array($file_extension, $allowed_types)) {
            return null;
        }

        $file_name = uniqid() . '_' . time() . '.' . $file_extension;
        $file_path = $upload_dir . $file_name;

        // Move uploaded file
        if (move_uploaded_file($file['tmp_name'], $file_path)) {
            return $file_name;
        }
    }

    return null;
}

// Function to get relationship in Indonesian
function getRelationship($relationship) {
    $relationships = [
        'father' => 'Bapa',
        'mother' => 'Ibu',
        'anak' => 'Anak',
        'tanggungan' => 'Tanggungan',
        'saudara' => 'Saudara',
        'lainnya' => 'Lainnya'
    ];

    return $relationships[$relationship] ?? $relationship;
}

// Function to process member documents
function processMemberDocuments($pdo, $member_id, $members_table, $files_data, $member_type, $member_index = null) {
    $document_types = ['birth', 'baptism', 'confirmation', 'marriage'];
    $document_mapping = [
        'birth' => 'birth_certificate',
        'baptism' => 'baptism_certificate',
        'confirmation' => 'confirmation_certificate',
        'marriage' => 'marriage_certificate'
    ];

    foreach ($document_types as $doc_type) {
        $file_field = $doc_type . '_file';

        // Handle different file structures
        $file_data = null;
        if ($member_index !== null) {
            // For children/dependent arrays
            if (isset($files_data[$member_type][$member_index][$file_field])) {
                $file_data = $files_data[$member_type][$member_index][$file_field];
            }
        } else {
            // For father/mother direct access
            if (isset($files_data[$member_type][$file_field])) {
                $file_data = $files_data[$member_type][$file_field];
            }
        }

        if ($file_data && $file_data['error'] === UPLOAD_ERR_OK && !empty($file_data['name'])) {
            $uploaded_file = handleFileUpload($file_data);
            if ($uploaded_file) {
                $doc_column = $document_mapping[$doc_type];
                $update_sql = "UPDATE {$members_table} SET {$doc_column} = ? WHERE id = ?";
                $update_stmt = $pdo->prepare($update_sql);
                $update_stmt->execute([$uploaded_file, $member_id]);
            }
        }
    }
}

// Function to insert family and members (generic for main or staging)
function insertFamilyAndMembers($pdo, $is_staging, $data, $user_id = null) {
    $family_table = $is_staging ? 'staging_families' : 'families';
    $members_table = $is_staging ? 'staging_family_members' : 'family_members';
    $family_id_field = $is_staging ? 'staging_family_id' : 'family_id';

    try {
        $pdo->beginTransaction();

        // 1. Insert family data
        if (!$is_staging) {
            $family_sql = "INSERT INTO {$family_table} (register_number, neighborhood, family_address, father_name, mother_name, head_of_family, created_at) VALUES (?, ?, ?, ?, ?, ?, NOW())";
            $family_stmt = $pdo->prepare($family_sql);
            $family_stmt->execute([
                $data['register_number'],
                $data['neighborhood'],
                $data['family_address'],
                $data['father_name'],
                $data['mother_name'],
                $data['head_of_family']
            ]);
        } else {
            $family_sql = "INSERT INTO {$family_table} (register_number, neighborhood, family_address, father_name, mother_name, head_of_family, status, submitted_by, created_at) VALUES (?, ?, ?, ?, ?, ?, 'draft', ?, NOW())";
            $family_stmt = $pdo->prepare($family_sql);
            $family_stmt->execute([
                $data['register_number'],
                $data['neighborhood'],
                $data['family_address'],
                $data['father_name'],
                $data['mother_name'],
                $data['head_of_family'],
                $user_id
            ]);
        }
        $family_id = $pdo->lastInsertId();

        // 2. Process father data
        if (!empty($data['father_name'])) {
            $father_sql = "INSERT INTO {$members_table} ({$family_id_field}, name, relationship, gender, birth_date, phone, occupation, education, status, notes, created_at) VALUES (?, ?, 'bapa', 'Laki-laki', ?, ?, ?, ?, 'Aktif', ?, NOW())";
            $father_stmt = $pdo->prepare($father_sql);
            $father_stmt->execute([
                $family_id,
                $data['father_name'],
                $data['father_birth_date'] ?? null,
                $data['father_phone'] ?? null,
                $data['father_occupation'] ?? null,
                $data['father_education'] ?? null,
                $data['father_notes'] ?? null
            ]);
            $father_id = $pdo->lastInsertId();

            // Process father documents
            if (isset($_FILES['family_members'])) {
                processMemberDocuments($pdo, $father_id, $members_table, $_FILES['family_members'], 'father');
            }
        }

        // 3. Process mother data
        if (!empty($data['mother_name'])) {
            $mother_sql = "INSERT INTO {$members_table} ({$family_id_field}, name, relationship, gender, birth_date, phone, occupation, education, status, notes, created_at) VALUES (?, ?, 'ibu', 'Perempuan', ?, ?, ?, ?, 'Aktif', ?, NOW())";
            $mother_stmt = $pdo->prepare($mother_sql);
            $mother_stmt->execute([
                $family_id,
                $data['mother_name'],
                $data['mother_birth_date'] ?? null,
                $data['mother_phone'] ?? null,
                $data['mother_occupation'] ?? null,
                $data['mother_education'] ?? null,
                $data['mother_notes'] ?? null
            ]);
            $mother_id = $pdo->lastInsertId();

            // Process mother documents
            if (isset($_FILES['family_members'])) {
                processMemberDocuments($pdo, $mother_id, $members_table, $_FILES['family_members'], 'mother');
            }
        }

        // 4. Process children
        if (isset($data['children']) && is_array($data['children'])) {
            foreach ($data['children'] as $child_index => $child_data) {
                if (!empty($child_data['name'])) {
                    $child_sql = "INSERT INTO {$members_table} ({$family_id_field}, name, relationship, gender, birth_date, phone, occupation, education, status, notes, created_at) VALUES (?, ?, 'anak', ?, ?, ?, ?, ?, 'Aktif', ?, NOW())";
                    $child_stmt = $pdo->prepare($child_sql);
                    $child_stmt->execute([
                        $family_id,
                        $child_data['name'],
                        $child_data['gender'] ?? null,
                        $child_data['birth_date'] ?? null,
                        $child_data['phone'] ?? null,
                        $child_data['occupation'] ?? null,
                        $child_data['education'] ?? null,
                        $child_data['notes'] ?? null
                    ]);
                    $child_id = $pdo->lastInsertId();

                    // Process child documents
                    if (isset($_FILES['family_members'])) {
                        processMemberDocuments($pdo, $child_id, $members_table, $_FILES['family_members'], 'children', $child_index);
                    }
                }
            }
        }

        // 5. Process dependents
        if (isset($data['dependents']) && is_array($data['dependents'])) {
            foreach ($data['dependents'] as $dependent_index => $dependent_data) {
                if (!empty($dependent_data['name'])) {
                    $dependent_sql = "INSERT INTO {$members_table} ({$family_id_field}, name, relationship, gender, birth_date, phone, occupation, education, status, notes, created_at) VALUES (?, ?, 'tanggungan', ?, ?, ?, ?, ?, 'Aktif', ?, NOW())";
                    $dependent_stmt = $pdo->prepare($dependent_sql);
                    $dependent_stmt->execute([
                        $family_id,
                        $dependent_data['name'],
                        $dependent_data['gender'] ?? null,
                        $dependent_data['birth_date'] ?? null,
                        $dependent_data['phone'] ?? null,
                        $dependent_data['occupation'] ?? null,
                        $dependent_data['education'] ?? null,
                        $dependent_data['notes'] ?? null
                    ]);
                    $dependent_id = $pdo->lastInsertId();

                    // Process dependent documents
                    if (isset($_FILES['family_members'])) {
                        processMemberDocuments($pdo, $dependent_id, $members_table, $_FILES['family_members'], 'dependents', $dependent_index);
                    }
                }
            }
        }

        $pdo->commit();

        // Trigger automatic backup after successful insert
        require_once 'backup.php';
        $conn = $pdo; // PDO connection
        triggerBackup($conn, 'data_change');

        return $family_id;

    } catch (Exception $e) {
        $pdo->rollBack();
        throw $e;
    }
}

try {
    if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
        throw new Exception('Invalid request method');
    }

    $role = $_SESSION['role'];
    $user_id = $_SESSION['user_id'];

    // Prepare data
    $data = [
        'register_number' => $_POST['register_number'] ?? '',
        'neighborhood' => $_POST['neighborhood'] ?? '',
        'family_address' => $_POST['family_address'] ?? '',
        'head_of_family' => $_POST['head_of_family'] ?? '',
        'additional_notes' => $_POST['additional_notes'] ?? ''
    ];

    // Extract father data
    $data['father_name'] = $_POST['family_members']['father']['name'] ?? '';
    $data['father_birth_date'] = $_POST['family_members']['father']['birth_date'] ?? null;
    $data['father_phone'] = $_POST['family_members']['father']['phone'] ?? null;
    $data['father_occupation'] = $_POST['family_members']['father']['occupation'] ?? null;
    $data['father_education'] = $_POST['family_members']['father']['education'] ?? null;
    $data['father_notes'] = $_POST['family_members']['father']['notes'] ?? null;

    // Extract mother data
    $data['mother_name'] = $_POST['family_members']['mother']['name'] ?? '';
    $data['mother_birth_date'] = $_POST['family_members']['mother']['birth_date'] ?? null;
    $data['mother_phone'] = $_POST['family_members']['mother']['phone'] ?? null;
    $data['mother_occupation'] = $_POST['family_members']['mother']['occupation'] ?? null;
    $data['mother_education'] = $_POST['family_members']['mother']['education'] ?? null;
    $data['mother_notes'] = $_POST['family_members']['mother']['notes'] ?? null;

    // Extract children data
    if (isset($_POST['family_members']['children']) && is_array($_POST['family_members']['children'])) {
        foreach ($_POST['family_members']['children'] as $child_index => $child_data) {
            if (!empty($child_data['name'])) {
                $data['children'][$child_index] = [
                    'name' => $child_data['name'],
                    'gender' => $child_data['gender'] ?? null,
                    'birth_date' => $child_data['birth_date'] ?? null,
                    'phone' => $child_data['phone'] ?? null,
                    'occupation' => $child_data['occupation'] ?? null,
                    'education' => $child_data['education'] ?? null,
                    'notes' => $child_data['notes'] ?? null
                ];
            }
        }
    }

    // Extract dependents data
    if (isset($_POST['family_members']['dependents']) && is_array($_POST['family_members']['dependents'])) {
        foreach ($_POST['family_members']['dependents'] as $dependent_index => $dependent_data) {
            if (!empty($dependent_data['name'])) {
                $data['dependents'][$dependent_index] = [
                    'name' => $dependent_data['name'],
                    'gender' => $dependent_data['gender'] ?? null,
                    'birth_date' => $dependent_data['birth_date'] ?? null,
                    'phone' => $dependent_data['phone'] ?? null,
                    'occupation' => $dependent_data['occupation'] ?? null,
                    'education' => $dependent_data['education'] ?? null,
                    'notes' => $dependent_data['notes'] ?? null
                ];
            }
        }
    }

    if ($role === 'admin') {
        // Insert into staging
        insertFamilyAndMembers($pdo, true, $data, $user_id);
        $_SESSION['success_message'] = "Pengajuan data keluarga berhasil dikirim untuk persetujuan!";
        header('Location: dashboard.php');
    } elseif ($role === 'super') {
        // Insert into main tables
        insertFamilyAndMembers($pdo, false, $data);
        $_SESSION['success_message'] = "Data keluarga berhasil disimpan!";
        header('Location: members.php');
    } else {
        throw new Exception('Unauthorized role');
    }

    exit;

} catch (Exception $e) {
    // Log error
    error_log("Error adding member: " . $e->getMessage());

    // Show error message
    echo '<div class="alert alert-error">';
    echo '<h3>Terjadi Kesalahan</h3>';
    echo '<p>Data gagal disimpan: ' . htmlspecialchars($e->getMessage()) . '</p>';
    echo '<div class="alert-actions">';
    echo '<a href="add_form.php" class="btn btn-primary">Kembali ke Form</a>';
    if ($_SESSION['role'] === 'super') {
        echo '<a href="members.php" class="btn btn-secondary">Lihat Data Anggota</a>';
    } else {
        echo '<a href="dashboard.php" class="btn btn-secondary">Dashboard</a>';
    }
    echo '</div>';
    echo '</div>';
}

include 'footer.php';
?>


===== C:\xampp\htdocs\jemaat\add_member_public.php =====

<?php
session_start();
require_once 'config/config.php';

// Input validation and sanitization functions
function sanitizeInput($data) {
    if (is_array($data)) {
        return array_map('sanitizeInput', $data);
    }
    return htmlspecialchars(trim($data), ENT_QUOTES, 'UTF-8');
}

function validatePhoneNumber($phone) {
    // Remove non-digit characters
    $clean_phone = preg_replace('/[^0-9]/', '', $phone);

    // Validate Indonesian phone number format (08xxxxxxxxxx)
    if (preg_match('/^08[1-9][0-9]{7,10}$/', $clean_phone)) {
        return $clean_phone;
    }
    return false;
}

// Function to validate uploaded file with enhanced security
function validateUploadedFile($file) {
    // Check file size (max 5MB)
    if ($file['size'] > 5 * 1024 * 1024) {
        error_log("File too large: " . $file['name']);
        return false;
    }

    // Check file type
    $allowed_types = [
        'image/jpeg', 'image/jpg', 'image/png', 'image/gif',
        'application/pdf'
    ];

    if (!in_array($file['type'], $allowed_types)) {
        error_log("Invalid file type: " . $file['type']);
        return false;
    }

    return true;
}

// Function to handle file upload with validation
function handleFileUpload($file, $upload_dir = 'uploads/') {
    if (!file_exists($upload_dir)) {
        mkdir($upload_dir, 0777, true);
    }

    if ($file['error'] === UPLOAD_ERR_OK && !empty($file['name'])) {
        // Validate file first
        if (!validateUploadedFile($file)) {
            return null;
        }

        $file_extension = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));

        // Additional extension validation
        $allowed_extensions = ['jpg', 'jpeg', 'png', 'gif', 'pdf'];
        if (!in_array($file_extension, $allowed_extensions)) {
            return null;
        }

        $file_name = uniqid() . '_' . time() . '.' . $file_extension;
        $file_path = $upload_dir . $file_name;

        if (move_uploaded_file($file['tmp_name'], $file_path)) {
            return $file_name;
        }
    }
    return null;
}

// Function to process member documents with CORRECTED file structure handling
function processMemberDocuments($conn, $family_id, $member_type, $member_data, $member_index = null) {
    $document_types = ['birth', 'baptism', 'confirmation', 'marriage'];
    $document_mapping = [
        'birth' => 'birth_certificate',
        'baptism' => 'baptism_certificate',
        'confirmation' => 'confirmation_certificate',
        'marriage' => 'marriage_certificate'
    ];

    foreach ($document_types as $doc_type) {
        $file_field = $doc_type . '_file';

        // CORRECTED: Handle proper $_FILES structure for nested arrays
        $file_uploaded = false;
        $file_data = null;

        if ($member_index !== null) {
            // For children/dependents: family_members[children][0][birth_file]
            if (isset($_FILES['family_members']['name'][$member_type][$member_index][$file_field]) &&
                $_FILES['family_members']['error'][$member_type][$member_index][$file_field] === UPLOAD_ERR_OK) {
                $file_data = [
                    'name' => $_FILES['family_members']['name'][$member_type][$member_index][$file_field],
                    'type' => $_FILES['family_members']['type'][$member_type][$member_index][$file_field],
                    'tmp_name' => $_FILES['family_members']['tmp_name'][$member_type][$member_index][$file_field],
                    'error' => $_FILES['family_members']['error'][$member_type][$member_index][$file_field],
                    'size' => $_FILES['family_members']['size'][$member_type][$member_index][$file_field]
                ];
                $file_uploaded = true;
            }
        } else {
            // For father/mother: family_members[father][birth_file]
            if (isset($_FILES['family_members']['name'][$member_type][$file_field]) &&
                $_FILES['family_members']['error'][$member_type][$file_field] === UPLOAD_ERR_OK) {
                $file_data = [
                    'name' => $_FILES['family_members']['name'][$member_type][$file_field],
                    'type' => $_FILES['family_members']['type'][$member_type][$file_field],
                    'tmp_name' => $_FILES['family_members']['tmp_name'][$member_type][$file_field],
                    'error' => $_FILES['family_members']['error'][$member_type][$file_field],
                    'size' => $_FILES['family_members']['size'][$member_type][$file_field]
                ];
                $file_uploaded = true;
            }
        }

        // Process file if uploaded
        if ($file_uploaded && $file_data) {
            // Validate file
            if (!validateUploadedFile($file_data)) {
                continue; // Skip invalid files
            }

            // Process upload
            $uploaded_file = handleFileUpload($file_data);
            if ($uploaded_file) {
                $doc_column = $document_mapping[$doc_type];

                // Update the specific member's document
                $update_sql = "UPDATE staging_family_members SET {$doc_column} = ?
                              WHERE staging_family_id = ? AND name = ? AND relationship = ?";
                $update_stmt = $conn->prepare($update_sql);
                $update_stmt->execute([
                    $uploaded_file,
                    $family_id,
                    $member_data['name'],
                    $member_type === 'father' ? 'bapa' :
                    ($member_type === 'mother' ? 'ibu' :
                    ($member_type === 'children' ? 'anak' : 'tanggungan'))
                ]);
            }
        }
    }
}

try {
    if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
        throw new Exception('Invalid request method');
    }

    $conn = getDB();

    // Sanitize and validate input data
    $register_number = sanitizeInput($_POST['register_number'] ?? '');
    $neighborhood = sanitizeInput($_POST['neighborhood'] ?? '');
    $family_address = sanitizeInput($_POST['family_address'] ?? '');
    $head_of_family = sanitizeInput($_POST['head_of_family'] ?? '');
    $additional_notes = sanitizeInput($_POST['additional_notes'] ?? '');

    // Data pengirim (untuk public access)
    $submitter_name = sanitizeInput($_POST['submitter_name'] ?? '');
    $submitter_phone = sanitizeInput($_POST['submitter_phone'] ?? '');
    $submitter_relation = sanitizeInput($_POST['submitter_relation'] ?? '');
    $user_role = sanitizeInput($_POST['user_role'] ?? 'public');

    // Validate required fields
    if (empty($register_number) || empty($neighborhood) || empty($family_address)) {
        throw new Exception('Data required fields are missing');
    }

    // Validate phone number if provided
    if (!empty($submitter_phone)) {
        $validated_phone = validatePhoneNumber($submitter_phone);
        if (!$validated_phone) {
            throw new Exception('Format nomor telepon tidak valid. Gunakan format 08xxxxxxxxxx');
        }
        $submitter_phone = $validated_phone;
    }

    // Untuk public access, validasi juga data kontak
    if ($user_role === 'public' && (empty($submitter_name) || empty($submitter_phone))) {
        throw new Exception('Data kontak pengirim wajib diisi');
    }

    // Validate email if provided (basic validation)
    if (!empty($_POST['submitter_email'] ?? '')) {
        $email = sanitizeInput($_POST['submitter_email']);
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            throw new Exception('Format email tidak valid');
        }
    }

    $conn->beginTransaction();

    // VALIDASI DUPLIKAT: Cek apakah sudah ada pengajuan pending dengan nomor register yang sama
    $user_id = $user_role === 'public' ? 'public' : ($_POST['submitted_by'] ?? 'public');
    $check_sql = "SELECT id FROM staging_families
                  WHERE register_number = ? AND submitted_by = ? AND status = 'pending'";
    $check_stmt = $conn->prepare($check_sql);
    $check_stmt->execute([$register_number, $user_id]);
    $check_result = $check_stmt->get_result();

    if ($check_result->num_rows > 0) {
        // Sudah ada pengajuan pending dengan nomor register yang sama
        throw new Exception('Anda sudah memiliki pengajuan pending dengan nomor register ini. Silakan tunggu persetujuan atau hubungi administrator.');
    }

    // 1. Insert ke staging_families
    $family_sql = "INSERT INTO staging_families
                  (register_number, neighborhood, family_address, father_name, mother_name, head_of_family, status, submitted_by, submitter_name, submitter_phone, submitter_relation, created_at)
                  VALUES (?, ?, ?, ?, ?, ?, 'pending', ?, ?, ?, ?, NOW())";

    $father_name = $_POST['family_members']['father']['name'] ?? '';
    $mother_name = $_POST['family_members']['mother']['name'] ?? '';

    $family_stmt = $conn->prepare($family_sql);
    $family_stmt->execute([
        $register_number,
        $neighborhood,
        $family_address,
        $father_name,
        $mother_name,
        $head_of_family,
        $user_role === 'public' ? 'public' : ($_POST['submitted_by'] ?? 'public'),
        $submitter_name,
        $submitter_phone,
        $submitter_relation
    ]);

    $family_id = $conn->lastInsertId();

    // 2. Process father data
    if (!empty($father_name)) {
        $father_data = $_POST['family_members']['father'];
        $father_sql = "INSERT INTO staging_family_members
                      (staging_family_id, name, relationship, gender, birth_date, phone, occupation, education, notes, created_at)
                      VALUES (?, ?, 'bapa', 'Laki-laki', ?, ?, ?, ?, ?, NOW())";
        $father_stmt = $conn->prepare($father_sql);
        $father_stmt->execute([
            $family_id,
            $father_data['name'],
            $father_data['birth_date'] ?? null,
            $father_data['phone'] ?? null,
            $father_data['occupation'] ?? null,
            $father_data['education'] ?? null,
            $father_data['notes'] ?? null
        ]);

        // Process father documents
        processMemberDocuments($conn, $family_id, 'father', $father_data);
    }

    // 3. Process mother data (similar to father)
    if (!empty($mother_name)) {
        $mother_data = $_POST['family_members']['mother'];
        $mother_sql = "INSERT INTO staging_family_members
                      (staging_family_id, name, relationship, gender, birth_date, phone, occupation, education, notes, created_at)
                      VALUES (?, ?, 'ibu', 'Perempuan', ?, ?, ?, ?, ?, NOW())";
        $mother_stmt = $conn->prepare($mother_sql);
        $mother_stmt->execute([
            $family_id,
            $mother_data['name'],
            $mother_data['birth_date'] ?? null,
            $mother_data['phone'] ?? null,
            $mother_data['occupation'] ?? null,
            $mother_data['education'] ?? null,
            $mother_data['notes'] ?? null
        ]);

        // Process mother documents
        processMemberDocuments($conn, $family_id, 'mother', $mother_data);
    }

    // 4. Process children
    if (isset($_POST['family_members']['children'])) {
        foreach ($_POST['family_members']['children'] as $child_index => $child_data) {
            if (!empty($child_data['name'])) {
                $child_sql = "INSERT INTO staging_family_members
                             (staging_family_id, name, relationship, gender, birth_date, phone, occupation, education, notes, created_at)
                             VALUES (?, ?, 'anak', ?, ?, ?, ?, ?, ?, NOW())";
                $child_stmt = $conn->prepare($child_sql);
                $child_stmt->execute([
                    $family_id,
                    $child_data['name'],
                    $child_data['gender'] ?? null,
                    $child_data['birth_date'] ?? null,
                    $child_data['phone'] ?? null,
                    $child_data['occupation'] ?? null,
                    $child_data['education'] ?? null,
                    $child_data['notes'] ?? null
                ]);

                // Process child documents
                processMemberDocuments($conn, $family_id, 'children', $child_data, $child_index);
            }
        }
    }

    // 5. Process dependents
    if (isset($_POST['family_members']['dependents'])) {
        foreach ($_POST['family_members']['dependents'] as $dependent_index => $dependent_data) {
            if (!empty($dependent_data['name'])) {
                $dependent_sql = "INSERT INTO staging_family_members
                                 (staging_family_id, name, relationship, gender, birth_date, phone, occupation, education, notes, created_at)
                                 VALUES (?, ?, 'tanggungan', ?, ?, ?, ?, ?, ?, NOW())";
                $dependent_stmt = $conn->prepare($dependent_sql);
                $dependent_stmt->execute([
                    $family_id,
                    $dependent_data['name'],
                    $dependent_data['gender'] ?? null,
                    $dependent_data['birth_date'] ?? null,
                    $dependent_data['phone'] ?? null,
                    $dependent_data['occupation'] ?? null,
                    $dependent_data['education'] ?? null,
                    $dependent_data['notes'] ?? null
                ]);

                // Process dependent documents
                processMemberDocuments($conn, $family_id, 'dependents', $dependent_data, $dependent_index);
            }
        }
    }

    $conn->commit();

    // Success message dengan tampilan Google Forms-like
    echo '<!DOCTYPE html>
    <html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Data Berhasil Diajukan - Jemaat App</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Google Sans", "Roboto", Arial, sans-serif;
                background: #f8f9fa;
                color: #202124;
                line-height: 1.6;
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .success-container {
                background: white;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                padding: 40px;
                max-width: 600px;
                width: 100%;
                text-align: center;
                border: 1px solid #dadce0;
            }

            .success-icon {
                width: 80px;
                height: 80px;
                background: #34a853;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 24px;
                animation: bounce 0.6s ease-in-out;
            }

            .success-icon svg {
                width: 40px;
                height: 40px;
                fill: white;
            }

            @keyframes bounce {
                0%, 20%, 60%, 100% { transform: translateY(0); }
                40% { transform: translateY(-10px); }
                80% { transform: translateY(-5px); }
            }

            .success-title {
                font-size: 28px;
                font-weight: 400;
                color: #202124;
                margin-bottom: 16px;
            }

            .success-message {
                font-size: 16px;
                color: #5f6368;
                margin-bottom: 32px;
                line-height: 1.8;
            }

            .contact-info {
                background: #f8f9fa;
                border-radius: 8px;
                padding: 20px;
                margin: 24px 0;
                border-left: 4px solid #4285f4;
                text-align: left;
            }

            .contact-info h3 {
                font-size: 16px;
                font-weight: 500;
                color: #202124;
                margin-bottom: 12px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .contact-info p {
                font-size: 14px;
                color: #5f6368;
                margin-bottom: 8px;
            }

            .action-buttons {
                display: flex;
                gap: 16px;
                justify-content: center;
                margin-top: 32px;
                flex-wrap: wrap;
            }

            .btn {
                padding: 12px 24px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 500;
                text-decoration: none;
                transition: all 0.2s ease;
                border: none;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                min-width: 140px;
                justify-content: center;
            }

            .btn-primary {
                background: #1a73e8;
                color: white;
                border: 1px solid #1a73e8;
            }

            .btn-primary:hover {
                background: #1669d6;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            }

            .btn-secondary {
                background: white;
                color: #1a73e8;
                border: 1px solid #dadce0;
            }

            .btn-secondary:hover {
                background: #f8f9fa;
                border-color: #1a73e8;
            }

            .whatsapp-share {
                margin-top: 32px;
                padding: 20px;
                background: #f8fff9;
                border: 1px solid #25D366;
                border-radius: 8px;
            }

            .whatsapp-share h3 {
                color: #25D366;
                margin-bottom: 8px;
                font-size: 16px;
                font-weight: 500;
            }

            .whatsapp-share p {
                color: #666;
                font-size: 14px;
                margin-bottom: 16px;
            }

            .btn-whatsapp {
                background: #25D366;
                color: white;
                border: 1px solid #25D366;
            }

            .btn-whatsapp:hover {
                background: #1da851;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            }

            @media (max-width: 600px) {
                .success-container {
                    padding: 24px;
                    margin: 20px;
                }

                .success-title {
                    font-size: 24px;
                }

                .action-buttons {
                    flex-direction: column;
                }

                .btn {
                    width: 100%;
                }
            }
        </style>
    </head>
    <body>
        <div class="success-container">
            <div class="success-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
            </div>

            <h1 class="success-title">‚úÖ Data Berhasil Diajukan!</h1>

            <div class="success-message">
                <p>Data keluarga Anda telah berhasil diajukan dan menunggu persetujuan administrator.</p>';

                if ($user_role === 'public') {
                    echo '<div class="contact-info">
                        <h3>üìû Informasi Kontak Anda</h3>
                        <p><strong>Nama:</strong> ' . htmlspecialchars($submitter_name) . '</p>
                        <p><strong>No. WhatsApp:</strong> ' . htmlspecialchars($submitter_phone) . '</p>
                        <p><strong>Hubungan:</strong> ' . htmlspecialchars($submitter_relation) . '</p>
                    </div>
                    <p>Kami akan menghubungi Anda via WhatsApp untuk konfirmasi setelah data disetujui.</p>';
                }

            echo '</div>

            <div class="action-buttons">
                <a href="add_form.php" class="btn btn-primary">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Tambah Data Keluarga Lain
                </a>

                <button onclick="window.location.href=\'' . ($user_role === 'public' ? 'index.php' : 'admin_pending_submissions.php') . '\'" class="btn btn-secondary">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                    Kembali
                </button>
            </div>

            <!-- WhatsApp Share Section -->
            <div class="whatsapp-share">
                <h3>üì± Bagikan Form Ini</h3>
                <p>Bagikan link form ini ke keluarga lain via WhatsApp</p>
                <button onclick="shareViaWhatsApp()" class="btn btn-whatsapp">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"/>
                    </svg>
                    Bagikan via WhatsApp
                </button>
            </div>
        </div>

        <script>
        function shareViaWhatsApp() {
            const url = window.location.origin + window.location.pathname.replace("add_member_public.php", "add_form.php");
            const text = "üìã *FORM DATA KELUARGA GEREJA*\\n\\nSilakan isi data keluarga Anda melalui link berikut:\\n" +
                         url + "\\n\\n*Form ini untuk:*\\n‚Ä¢ Update data anggota jemaat\\n‚Ä¢ Pendaftaran keluarga baru\\n‚Ä¢ Perubahan data keluarga\\n\\nTerima kasih üôè";

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(whatsappUrl, \'_blank\');
        }
        </script>
    </body>
    </html>';

} catch (Exception $e) {
    if (isset($conn)) {
        $conn->rollBack();
    }

    // Error message dengan tampilan Google Forms-like
    echo '<!DOCTYPE html>
    <html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Terjadi Kesalahan - Jemaat App</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: "Google Sans", "Roboto", Arial, sans-serif;
                background: #f8f9fa;
                color: #202124;
                line-height: 1.6;
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .error-container {
                background: white;
                border-radius: 12px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                padding: 40px;
                max-width: 600px;
                width: 100%;
                text-align: center;
                border: 1px solid #dadce0;
            }

            .error-icon {
                width: 80px;
                height: 80px;
                background: #ea4335;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 24px;
            }

            .error-icon svg {
                width: 40px;
                height: 40px;
                fill: white;
            }

            .error-title {
                font-size: 28px;
                font-weight: 400;
                color: #202124;
                margin-bottom: 16px;
            }

            .error-message {
                font-size: 16px;
                color: #5f6368;
                margin-bottom: 32px;
                line-height: 1.8;
            }

            .action-buttons {
                display: flex;
                gap: 16px;
                justify-content: center;
                margin-top: 32px;
                flex-wrap: wrap;
            }

            .btn {
                padding: 12px 24px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: 500;
                text-decoration: none;
                transition: all 0.2s ease;
                border: none;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                min-width: 140px;
                justify-content: center;
            }

            .btn-primary {
                background: #1a73e8;
                color: white;
                border: 1px solid #1a73e8;
            }

            .btn-primary:hover {
                background: #1669d6;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            }

            @media (max-width: 600px) {
                .error-container {
                    padding: 24px;
                    margin: 20px;
                }

                .error-title {
                    font-size: 24px;
                }

                .action-buttons {
                    flex-direction: column;
                }

                .btn {
                    width: 100%;
                }
            }
        </style>
    </head>
    <body>
        <div class="error-container">
            <div class="error-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                </svg>
            </div>

            <h1 class="error-title">‚ùå Terjadi Kesalahan</h1>

            <div class="error-message">
                <p>Data gagal disimpan: ' . htmlspecialchars($e->getMessage()) . '</p>
                <p>Silakan coba lagi atau hubungi administrator jika masalah berlanjut.</p>
            </div>

            <div class="action-buttons">
                <a href="add_form.php" class="btn btn-primary">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                    Kembali ke Form
                </a>
            </div>
        </div>
    </body>
    </html>';
}

include 'footer.php';
?>


===== C:\xampp\htdocs\jemaat\admin_pending_submissions.php =====

<?php
session_start();
require_once 'config/config.php';

// Initialize multi-tenant
MultiTenant::initialize();

$draft_families = [];
$pending_families = [];
$processed_families = [];

// Cek apakah user sudah login dan memiliki role admin atau superadmin
if (!isset($_SESSION['user_id']) || ($_SESSION['role'] !== 'admin' && $_SESSION['role'] !== 'superadmin')) {
    header("Location: login.php");
    exit();
}

$page_title = 'Pengajuan Tertunda - Jemaat App';
include 'header.php';

$user_id = $_SESSION['user_id'];
$role = $_SESSION['role'];
$message = '';
$error = '';

// Handle submission to superadmin
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['submit_to_superadmin'])) {
    $selected_families = $_POST['selected_families'] ?? [];

    if (empty($selected_families)) {
        $error = "Tidak ada pengajuan yang dipilih.";
    } else {
        try {
            $conn = getDB();
            $conn->beginTransaction();

            foreach ($selected_families as $family_id) {
                // Update status to 'pending' with proper church filtering
                $query = "UPDATE staging_families SET status = 'pending', updated_at = NOW() WHERE id = ?";
                $query_params = [$family_id];

                if ($role !== 'superadmin') {
                    $query .= " AND church_id = ?";
                    $query_params[] = $_SESSION['church_id'];
                }

                $update_status = $conn->prepare($query);
                $update_status->execute($query_params);
            }

            $conn->commit();
            $message = count($selected_families) . " pengajuan berhasil dikirim ke superadmin untuk persetujuan.";

        } catch (PDOException $e) {
            $conn->rollBack();
            error_log("Error in batch processing: " . $e->getMessage());
            $error = "Terjadi kesalahan database saat memproses pengajuan.";
        }
    }
}

// Handle delete draft
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['delete_draft'])) {
    $selected_families = $_POST['selected_families'] ?? [];

    if (empty($selected_families)) {
        $error = "Tidak ada draft yang dipilih.";
    } else {
        try {
            $conn = getDB();
            $conn->beginTransaction();

            foreach ($selected_families as $family_id) {
                // Delete members first with proper church filtering
                $query_members = "DELETE FROM staging_family_members WHERE staging_family_id = ?";
                $query_members_params = [$family_id];

                if ($role !== 'superadmin') {
                    $query_members .= " AND staging_family_id IN (SELECT id FROM staging_families WHERE church_id = ?)";
                    $query_members_params[] = $_SESSION['church_id'];
                }

                $delete_members = $conn->prepare($query_members);
                $delete_members->execute($query_members_params);

                // Then delete family with proper church filtering and status check
                $query_family = "DELETE FROM staging_families WHERE id = ? AND status = 'draft'";
                $query_family_params = [$family_id];

                if ($role !== 'superadmin') {
                    $query_family .= " AND church_id = ?";
                    $query_family_params[] = $_SESSION['church_id'];
                }

                $delete_family = $conn->prepare($query_family);
                $delete_family->execute($query_family_params);
            }

            $conn->commit();
            $message = count($selected_families) . " draft berhasil dihapus.";

        } catch (PDOException $e) {
            $conn->rollBack();
            error_log("Error in delete processing: " . $e->getMessage());
            $error = "Terjadi kesalahan database saat menghapus draft.";
        }
    }
}

try {
    $conn = getDB();

    // Build base query conditions for multi-tenant access
    $base_condition = "";
    $query_params = [];

    if ($role === 'superadmin') {
        // Superadmin sees all submissions
        $base_condition = "";
    } else {
        // Admin sees submissions from their church (both user submissions and public submissions)
        $base_condition = " AND sf.church_id = ?";
        $query_params = [$_SESSION['church_id']];
    }

    // Fetch draft submissions (status = 'draft')
    $draft_query = "
        SELECT sf.*,
               COALESCE(u.username, CONCAT('Public - ', sf.submitter_name)) as submitted_by_user
        FROM staging_families sf
        LEFT JOIN users u ON sf.submitted_by = u.id
        WHERE sf.status = 'draft'" . $base_condition . "
        ORDER BY sf.created_at DESC
    ";
    $draft_stmt = $conn->prepare($draft_query);
    $draft_stmt->execute($query_params);
    $draft_families = $draft_stmt->fetchAll(PDO::FETCH_ASSOC);

    // Fetch pending submissions (status = 'pending')
    $pending_query = "
        SELECT sf.*,
               COALESCE(u.username, CONCAT('Public - ', sf.submitter_name)) as submitted_by_user,
               COUNT(sfm.id) as member_count
        FROM staging_families sf
        LEFT JOIN users u ON sf.submitted_by = u.id
        LEFT JOIN staging_family_members sfm ON sf.id = sfm.staging_family_id
        WHERE sf.status = 'pending'" . $base_condition . "
        GROUP BY sf.id ORDER BY sf.created_at DESC
    ";
    $pending_stmt = $conn->prepare($pending_query);
    $pending_stmt->execute($query_params);
    $pending_families = $pending_stmt->fetchAll(PDO::FETCH_ASSOC);

    // Fetch approved/rejected submissions
    $processed_query = "
        SELECT sf.*,
               COALESCE(u.username, CONCAT('Public - ', sf.submitter_name)) as submitted_by_user
        FROM staging_families sf
        LEFT JOIN users u ON sf.submitted_by = u.id
        WHERE (sf.status = 'approved' OR sf.status = 'rejected')" . $base_condition . "
        ORDER BY sf.updated_at DESC LIMIT 20
    ";
    $processed_stmt = $conn->prepare($processed_query);
    $processed_stmt->execute($query_params);
    $processed_families = $processed_stmt->fetchAll(PDO::FETCH_ASSOC);

    // Get members for each family
    $family_members = [];
    $all_families = array_merge($draft_families, $pending_families, $processed_families);
    
    foreach ($all_families as $family) {
        $members_stmt = $conn->prepare("
            SELECT * FROM staging_family_members
            WHERE staging_family_id = ?
            ORDER BY relationship, name
        ");
        $members_stmt->execute([$family['id']]);
        $family_members[$family['id']] = $members_stmt->fetchAll(PDO::FETCH_ASSOC);
    }

} catch (PDOException $e) {
    error_log("Error fetching submissions: " . $e->getMessage());
    $error = "Error loading submissions.";
}
?>

<div class="container">
    <h1>Pengajuan Data Keluarga</h1>
    <a href="dashboard.php" class="btn btn-secondary">Kembali ke Dashboard</a>

    <?php if ($message): ?>
        <div class="alert alert-success"><?php echo $message; ?></div>
    <?php endif; ?>

    <?php if ($error): ?>
        <div class="alert alert-error"><?php echo $error; ?></div>
    <?php endif; ?>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'draft-tab')">Draft (<?php echo count($draft_families); ?>)</button>
        <button class="tab-btn" onclick="openTab(event, 'pending-tab')">Menunggu Persetujuan (<?php echo count($pending_families); ?>)</button>
        <button class="tab-btn" onclick="openTab(event, 'processed-tab')">Sudah Diproses (<?php echo count($processed_families); ?>)</button>
    </div>

    <!-- Draft Tab -->
    <div id="draft-tab" class="tab-content active">
        <?php if (empty($draft_families)): ?>
            <div class="alert alert-info">
                <p>Tidak ada draft pengajuan saat ini.</p>
            </div>
        <?php else: ?>
            <form method="post" action="admin_pending_submissions.php" id="draftForm">
                <div class="table-responsive">
                    <table class="compact-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllDraft" onclick="toggleSelectAll(this, 'draft')"></th>
                                <th>No. Register</th>
                                <th>Waktu Dibuat</th>
                                <th>Kepala Keluarga</th>
                                <th>Anggota Keluarga</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach ($draft_families as $family): ?>
                                <tr>
                                    <td><input type="checkbox" name="selected_families[]" value="<?php echo $family['id']; ?>" class="draft-checkbox"></td>
                                    <td><?php echo htmlspecialchars($family['register_number']); ?></td>
                                    <td><?php echo date('d/m/Y H:i', strtotime($family['created_at'])); ?></td>
                                    <td><?php echo htmlspecialchars($family['head_of_family']); ?></td>
                                    <td class="family-members">
                                        <?php 
                                        $member_count = [
                                            'ayah' => 0,
                                            'ibu' => 0,
                                            'anak' => 0,
                                            'tanggungan' => 0
                                        ];
                                        
                                        foreach ($family_members[$family['id']] as $member) {
                                            $relationship = strtolower($member['relationship']);
                                            if ($relationship === 'ayah') $member_count['ayah']++;
                                            else if ($relationship === 'ibu') $member_count['ibu']++;
                                            else if ($relationship === 'anak') $member_count['anak']++;
                                            else $member_count['tanggungan']++;
                                        }
                                        
                                        if ($member_count['ayah'] > 0) echo '<span class="member-badge ayah">A</span>';
                                        if ($member_count['ibu'] > 0) echo '<span class="member-badge ibu">I</span>';
                                        if ($member_count['anak'] > 0) echo '<span class="member-badge anak">CH(' . $member_count['anak'] . ')</span>';
                                        if ($member_count['tanggungan'] > 0) echo '<span class="member-badge tanggungan">T(' . $member_count['tanggungan'] . ')</span>';
                                        ?>
                                    </td>
                                    <td>
                                        <a href="edit_family.php?id=<?php echo $family['id']; ?>" class="btn btn-small btn-info">Edit</a>
                                        <a href="view_family.php?id=<?php echo $family['id']; ?>" class="btn btn-small btn-secondary">Lihat</a>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
                <div class="form-actions">
                    <button type="submit" name="delete_draft" class="btn btn-danger">Hapus Draft Terpilih</button>
                    <button type="submit" name="submit_to_superadmin" class="btn btn-primary">Kirim ke Superadmin</button>
                </div>
            </form>
        <?php endif; ?>
    </div>

    <!-- Pending Tab -->
    <div id="pending-tab" class="tab-content">
        <?php if (empty($pending_families)): ?>
            <div class="alert alert-info">
                <p>Tidak ada pengajuan yang menunggu persetujuan.</p>
            </div>
        <?php else: ?>
            <table class="compact-table">
                <thead>
                    <tr>
                        <th>No. Register</th>
                        <th>Waktu Dibuat</th>
                        <th>Kepala Keluarga</th>
                        <th>Jumlah Anggota</th>
                        <th>Pengaju</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($pending_families as $family): ?>
                        <tr>
                            <td><?php echo htmlspecialchars($family['register_number']); ?></td>
                            <td><?php echo date('d/m/Y H:i', strtotime($family['created_at'])); ?></td>
                            <td><?php echo htmlspecialchars($family['head_of_family']); ?></td>
                            <td><?php echo $family['member_count']; ?></td>
                            <td><?php echo htmlspecialchars($family['submitted_by_user']); ?></td>
                            <td>
                                <a href="approve_member.php?action=view&family_id=<?php echo $family['id']; ?>" class="btn btn-small btn-primary">Lihat & Proses</a>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        <?php endif; ?>
    </div>

    <!-- Processed Tab -->
    <div id="processed-tab" class="tab-content">
        <?php if (empty($processed_families)): ?>
            <div class="alert alert-info">
                <p>Tidak ada pengajuan yang sudah diproses.</p>
            </div>
        <?php else: ?>
            <table class="compact-table">
                <thead>
                    <tr>
                        <th>No. Register</th>
                        <th>Waktu Update</th>
                        <th>Kepala Keluarga</th>
                        <th>Status</th>
                        <th>Pengaju</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($processed_families as $family): ?>
                        <tr>
                            <td><?php echo htmlspecialchars($family['register_number']); ?></td>
                            <td><?php echo date('d/m/Y H:i', strtotime($family['updated_at'])); ?></td>
                            <td><?php echo htmlspecialchars($family['head_of_family']); ?></td>
                            <td><?php echo ucfirst($family['status']); ?></td>
                            <td><?php echo htmlspecialchars($family['submitted_by_user']); ?></td>
                            <td>
                                <a href="approve_member.php?action=view&family_id=<?php echo $family['id']; ?>" class="btn btn-small btn-primary">Lihat</a>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        <?php endif; ?>
    </div>
</div>

<script>
function openTab(evt, tabName) {
    var i, tabcontent, tabbtns;
    tabcontent = document.getElementsByClassName("tab-content");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
        tabcontent[i].classList.remove("active");
    }
    tabbtns = document.getElementsByClassName("tab-btn");
    for (i = 0; i < tabbtns.length; i++) {
        tabbtns[i].classList.remove("active");
    }
    document.getElementById(tabName).style.display = "block";
    document.getElementById(tabName).classList.add("active");
    evt.currentTarget.classList.add("active");
}

function toggleSelectAll(source, type) {
    var checkboxes = document.querySelectorAll('.' + type + '-checkbox');
    for (var i = 0; i < checkboxes.length; i++) {
        checkboxes[i].checked = source.checked;
    }
}

// Initialize first tab display
document.addEventListener('DOMContentLoaded', function(event) {
    openTab(event, 'draft-tab');
});
</script>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\approve_member.php =====

<?php
session_start();
require_once 'config/config.php';

// Initialize multi-tenant
MultiTenant::initialize();

if (!isset($_SESSION['user_id']) || !in_array($_SESSION['role'], ['super', 'superadmin'])) {
    header("Location: login.php");
    exit();
}

$page_title = 'Persetujuan Anggota - Jemaat App';
include 'header.php';

$action = $_GET['action'] ?? '';
$family_id = (int)($_GET['family_id'] ?? 0);

if ($family_id <= 0) {
    header("Location: pending_submissions.php");
    exit();
}

$message = '';
$error = '';

try {
    $conn = getDB();
    // Fetch staging family and members for view - DIPERBAIKI untuk handle public submissions
    $query = "
        SELECT sf.*, COALESCE(u.username, 'Public User') as submitted_by_user
        FROM staging_families sf
        LEFT JOIN users u ON sf.submitted_by = u.id
        WHERE sf.id = ? AND sf.status = 'pending'
    ";

    // Apply church filtering for multi-tenant support
    $query = MultiTenant::addChurchFilter($query, 'sf.church_id');
    $family_stmt = $conn->prepare($query);
    $family_stmt->execute([$family_id]);
    $staging_family = $family_stmt->fetch(PDO::FETCH_ASSOC);

    if (!$staging_family) {
        $error = "Pengajuan tidak ditemukan atau sudah diproses.";
    } else {
        $members_stmt = $conn->prepare("SELECT * FROM staging_family_members WHERE staging_family_id = ? ORDER BY relationship, name");
        $members_stmt->execute([$family_id]);
        $staging_members = $members_stmt->fetchAll(PDO::FETCH_ASSOC);

        // Handle actions
        if ($action === 'approve') {
            $conn->beginTransaction();

            // Copy family to main
            $insert_family = $conn->prepare("
                INSERT INTO families (register_number, neighborhood, family_address, father_name, mother_name, head_of_family, created_at, updated_at)
                VALUES (?, ?, ?, ?, ?, ?, ?, NOW())
            ");
            $insert_family->execute([
                $staging_family['register_number'],
                $staging_family['neighborhood'],
                $staging_family['family_address'],
                $staging_family['father_name'],
                $staging_family['mother_name'],
                $staging_family['head_of_family'],
                $staging_family['created_at']
            ]);
            $main_family_id = $conn->lastInsertId();

            // Copy members to main
            foreach ($staging_members as $member) {
                $insert_member = $conn->prepare("
                    INSERT INTO family_members (
                        family_id, name, relationship, gender, birth_date, address, phone, occupation, education, status,
                        birth_certificate, baptism_certificate, confirmation_certificate, marriage_certificate, death_certificate,
                        notes, created_at, updated_at
                    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW())
                ");
                $insert_member->execute([
                    $main_family_id,
                    $member['name'],
                    $member['relationship'],
                    $member['gender'],
                    $member['birth_date'],
                    $member['address'],
                    $member['phone'],
                    $member['occupation'],
                    $member['education'],
                    $member['status'],
                    $member['birth_certificate'],
                    $member['baptism_certificate'],
                    $member['confirmation_certificate'],
                    $member['marriage_certificate'],
                    $member['death_certificate'],
                    $member['notes'],
                    $member['created_at']
                ]);
            }

            // Update staging status
            $update_status = $conn->prepare("UPDATE staging_families SET status = 'approved', updated_at = NOW() WHERE id = ?");
            $update_status->execute([$family_id]);

            $conn->commit();

            // Trigger backup after successful approval
            require_once 'backup.php';
            triggerBackup($conn, 'member_approved');

            $message = "Pengajuan keluarga disetujui dan ditambahkan ke database utama.";
            header("Location: pending_submissions.php?success=approved");
            exit();

        } elseif ($action === 'reject') {
            // Update staging status to rejected
            $update_status = $conn->prepare("UPDATE staging_families SET status = 'rejected', updated_at = NOW() WHERE id = ?");
            $update_status->execute([$family_id]);

            // Optionally delete staging members
            $delete_members = $conn->prepare("DELETE FROM staging_family_members WHERE staging_family_id = ?");
            $delete_members->execute([$family_id]);

            // Trigger backup after successful rejection
            require_once 'backup.php';
            triggerBackup($conn, 'member_rejected');

            $message = "Pengajuan keluarga ditolak.";
            header("Location: pending_submissions.php?success=rejected");
            exit();

        } elseif ($action !== 'view') {
            $error = "Aksi tidak valid.";
        }
    }

} catch (PDOException $e) {
    error_log("Error in approve_member.php: " . $e->getMessage());
    $error = "Terjadi kesalahan database.";
}
?>

<div class="container">
    <h1><?php echo $action === 'view' ? 'Lihat Pengajuan' : 'Proses Pengajuan'; ?></h1>
    <a href="pending_submissions.php" class="btn btn-secondary">Kembali ke Daftar Pengajuan</a>

    <?php if ($message): ?>
        <div class="alert alert-success"><?php echo $message; ?></div>
    <?php endif; ?>

    <?php if ($error): ?>
        <div class="alert alert-error"><?php echo $error; ?></div>
    <?php endif; ?>

    <?php if ($action === 'view' && $staging_family): ?>
        <div class="family-card">
            <div class="family-header">
                <h3>ID Keluarga: <?php echo $staging_family['id']; ?> | No. Register: <?php echo htmlspecialchars($staging_family['register_number']); ?></h3>
                <p><strong>Lingkungan:</strong> <?php echo htmlspecialchars($staging_family['neighborhood']); ?></p>
                <p><strong>Alamat:</strong> <?php echo htmlspecialchars($staging_family['family_address']); ?></p>
                <p><strong>Kepala Keluarga:</strong> <?php echo htmlspecialchars($staging_family['head_of_family']); ?></p>
                <p><strong>Tanggal Pengajuan:</strong> <?php echo date('d/m/Y H:i', strtotime($staging_family['created_at'])); ?></p>
                <?php if (!empty($staging_family['approval_notes'])): ?>
                    <p><strong>Catatan Persetujuan:</strong> <?php echo htmlspecialchars($staging_family['approval_notes']); ?></p>
                <?php endif; ?>
            </div>

            <div class="family-members">
                <h4>Anggota Keluarga</h4>
                <?php foreach ($staging_members as $member): ?>
                    <div class="member-item">
                        <strong><?php echo htmlspecialchars($member['name']); ?></strong> 
                        - <?php echo htmlspecialchars($member['relationship']); ?> 
                        (<?php echo $member['gender'] === 'M' ? 'Laki-laki' : 'Perempuan'; ?>)
                        <?php if (!empty($member['phone'])): ?> | Telepon: <?php echo htmlspecialchars($member['phone']); ?><?php endif; ?>
                        <?php if (!empty($member['occupation'])): ?> | Pekerjaan: <?php echo htmlspecialchars($member['occupation']); ?><?php endif; ?>
                        <?php if (!empty($member['notes'])): ?> | Catatan: <?php echo htmlspecialchars($member['notes']); ?><?php endif; ?>
                        
                        <div class="documents">
                            <?php 
                            $docs = [];
                            if ($member['birth_certificate']) $docs[] = 'Akta Kelahiran';
                            if ($member['baptism_certificate']) $docs[] = 'Sertifikat Baptis';
                            if ($member['confirmation_certificate']) $docs[] = 'Sertifikat Sidi';
                            if ($member['marriage_certificate']) $docs[] = 'Sertifikat Pernikahan';
                            if (!empty($docs)): 
                            ?>
                                <strong>Dokumen:</strong> <?php echo implode(', ', $docs); ?>
                            <?php else: ?>
                                Tidak ada dokumen yang diunggah.
                            <?php endif; ?>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>

            <div class="family-actions">
                <a href="approve_member.php?action=approve&family_id=<?php echo $family_id; ?>" 
                   class="btn btn-success">Setujui Keluarga</a>
                <a href="approve_member.php?action=reject&family_id=<?php echo $family_id; ?>" 
                   class="btn btn-danger">Tolak Keluarga</a>
            </div>
        </div>
    <?php endif; ?>

    <?php if ($action === 'approve' && $staging_family): ?>
        <div class="approval-form">
            <h3>Verifikasi dan Setujui Pengajuan Keluarga</h3>
            <p>Tinjau detail di atas dan berikan catatan verifikasi sebelum menyetujui keluarga ini ke sistem utama.</p>
            <form method="post" action="approve_member.php">
                <input type="hidden" name="family_id" value="<?php echo $family_id; ?>">
                <input type="hidden" name="action" value="process_approve">
                <div class="form-group">
                    <label for="approval_notes">Catatan Verifikasi (opsional):</label>
                    <textarea id="approval_notes" name="approval_notes" rows="4" placeholder="Masukkan catatan verifikasi atau komentar..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Konfirmasi Persetujuan</button>
                    <a href="pending_submissions.php" class="btn btn-secondary">Kembali ke Daftar Pengajuan</a>
                </div>
            </form>
        </div>
    <?php endif; ?>

    <?php if ($action === 'reject' && $staging_family): ?>
        <div class="rejection-form">
            <h3>Tolak Pengajuan Keluarga</h3>
            <p>Berikan alasan penolakan. Ini akan dicatat untuk referensi.</p>
            <form method="post" action="approve_member.php">
                <input type="hidden" name="family_id" value="<?php echo $family_id; ?>">
                <input type="hidden" name="action" value="process_reject">
                <div class="form-group">
                    <label for="rejection_reason">Alasan Penolakan (wajib):</label>
                    <textarea id="rejection_reason" name="approval_notes" rows="4" required placeholder="Masukkan alasan penolakan..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-danger">Konfirmasi Penolakan</button>
                    <a href="pending_submissions.php" class="btn btn-secondary">Kembali ke Daftar Pengajuan</a>
                </div>
            </form>
        </div>
    <?php endif; ?>
</div>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\backup.php =====

<?php
// backup.php - Database backup utility for Jemaat application (FIXED VERSION)

class DatabaseBackup {
    private $conn;
    private $backup_dir;
    private $max_backups = 10;

    public function __construct($conn) {
        $this->conn = $conn;
        $this->backup_dir = 'backups/';
        $this->ensureBackupDirectory();
    }

    private function ensureBackupDirectory() {
        if (!file_exists($this->backup_dir)) {
            mkdir($this->backup_dir, 0755, true);
        }

        // Create .htaccess untuk security
        $htaccess = $this->backup_dir . '.htaccess';
        if (!file_exists($htaccess)) {
            file_put_contents($htaccess, "Deny from all\n");
        }
    }

    public function createBackup($reason = 'manual') {
        try {
            $timestamp = date('Y-m-d_H-i-s');
            $filename = "jemaat_backup_{$timestamp}_{$reason}.sql";
            $filepath = $this->backup_dir . $filename;

            $backup_content = $this->generateBackupSQL();

            if (file_put_contents($filepath, $backup_content)) {
                $this->logBackup($filename, $reason);
                $this->cleanupOldBackups();
                return [
                    'success' => true,
                    'filename' => $filename,
                    'path' => $filepath,
                    'size' => filesize($filepath)
                ];
            } else {
                return ['success' => false, 'error' => 'Failed to write backup file - check folder permissions'];
            }
        } catch (Exception $e) {
            return ['success' => false, 'error' => $e->getMessage()];
        }
    }

    private function generateBackupSQL() {
        // Daftar semua tabel yang perlu di-backup
        $tables = [
            'users', 'members', 'children', 'guardians', 'annual_contributions',
            'fathers', 'mothers', 'families', 'family_members',
            'staging_families', 'staging_family_members', 'monthly_contributions'
        ];

        $backup_sql = "-- Jemaat Database Backup\n";
        $backup_sql .= "-- Generated: " . date('Y-m-d H:i:s') . "\n";
        $backup_sql .= "-- Reason: {$reason}\n\n";
        $backup_sql .= "SET FOREIGN_KEY_CHECKS=0;\n\n";

        foreach ($tables as $table) {
            $backup_sql .= $this->backupTable($table);
        }

        $backup_sql .= "SET FOREIGN_KEY_CHECKS=1;\n";
        return $backup_sql;
    }

    private function backupTable($table) {
        $sql = "--\n-- Backup for table: $table\n--\n";

        try {
            // Drop table if exists
            $sql .= "DROP TABLE IF EXISTS `$table`;\n";

            // Get table structure
            $stmt = $this->conn->query("SHOW CREATE TABLE `$table`");
            if ($stmt && $row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                $create_sql = $row['Create Table'];
                $sql .= $create_sql . ";\n\n";
            } else {
                $sql .= "-- ERROR: Could not get structure for table $table\n\n";
                return $sql;
            }

            // Get table data
            $data_sql = $this->getTableData($table);
            if ($data_sql) {
                $sql .= $data_sql . "\n\n";
            }

        } catch (Exception $e) {
            $sql .= "-- ERROR backing up table $table: " . $e->getMessage() . "\n\n";
        }

        return $sql;
    }

    private function getTableData($table) {
        try {
            $stmt = $this->conn->query("SELECT * FROM `$table`");
            if (!$stmt) return '';

            $rows = [];
            while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                $values = [];
                foreach ($row as $value) {
                    if ($value === null) {
                        $values[] = 'NULL';
                    } else {
                        // Escape special characters for SQL
                        $escaped = str_replace(
                            ["\\", "\x00", "\n", "\r", "'", '"', "\x1a"],
                            ["\\\\", "\\0", "\\n", "\\r", "\\'", '\\"', "\\Z"],
                            $value
                        );
                        $values[] = "'" . $escaped . "'";
                    }
                }
                $rows[] = "(" . implode(", ", $values) . ")";
            }

            if (empty($rows)) {
                return "-- Table `$table` is empty\n";
            }

            // Get column names
            $columnStmt = $this->conn->query("SHOW COLUMNS FROM `$table`");
            $columns = [];
            while ($col = $columnStmt->fetch(PDO::FETCH_ASSOC)) {
                $columns[] = "`{$col['Field']}`";
            }

            return "INSERT INTO `$table` (" . implode(", ", $columns) . ") VALUES\n" .
                   implode(",\n", $rows) . ";\n";

        } catch (Exception $e) {
            return "-- ERROR getting data for table $table: " . $e->getMessage() . "\n";
        }
    }

    private function logBackup($filename, $reason) {
        $log_file = $this->backup_dir . 'backup_log.txt';
        $log_entry = date('Y-m-d H:i:s') . " | $filename | $reason\n";
        file_put_contents($log_file, $log_entry, FILE_APPEND | LOCK_EX);
    }

    private function cleanupOldBackups() {
        $backups = glob($this->backup_dir . 'jemaat_backup_*.sql');
        if (count($backups) > $this->max_backups) {
            // Sort by creation time, keep newest
            usort($backups, function($a, $b) {
                return filemtime($b) - filemtime($a);
            });

            // Remove older backups
            for ($i = $this->max_backups; $i < count($backups); $i++) {
                @unlink($backups[$i]);
            }
        }
    }

    public function listBackups() {
        $backups = glob($this->backup_dir . 'jemaat_backup_*.sql');
        $backup_info = [];

        foreach ($backups as $backup) {
            if (file_exists($backup)) {
                $backup_info[] = [
                    'filename' => basename($backup),
                    'size' => filesize($backup),
                    'created' => date('Y-m-d H:i:s', filemtime($backup)),
                    'path' => $backup
                ];
            }
        }

        // Sort by creation time, newest first
        usort($backup_info, function($a, $b) {
            return strtotime($b['created']) - strtotime($a['created']);
        });

        return $backup_info;
    }

    public function downloadBackup($filename) {
        $filepath = $this->backup_dir . $filename;

        if (file_exists($filepath)) {
            header('Content-Type: application/sql');
            header('Content-Disposition: attachment; filename="' . $filename . '"');
            header('Content-Length: ' . filesize($filepath));
            header('Cache-Control: no-cache');
            readfile($filepath);
            exit;
        } else {
            return ['success' => false, 'error' => 'Backup file not found'];
        }
    }
}

// Helper functions
function triggerBackup($conn, $reason = 'data_change') {
    $backup = new DatabaseBackup($conn);
    return $backup->createBackup($reason);
}

function getBackupList($conn) {
    $backup = new DatabaseBackup($conn);
    return $backup->listBackups();
}

function downloadBackupFile($conn, $filename) {
    $backup = new DatabaseBackup($conn);
    return $backup->downloadBackup($filename);
}
?>


===== C:\xampp\htdocs\jemaat\backup_manager.php =====

<?php
include 'db.php';
include 'backup.php';

if (!isset($_SESSION['user_id']) || $_SESSION['role'] != 'super') {
    header("Location: login.php");
    exit();
}

$page_title = 'Backup Manager - Jemaat App';
include 'header.php';

$conn = getDB();
$backup = new DatabaseBackup($conn);

// Handle immediate backup creation (from member_detail.php button)
if (isset($_GET['create_now'])) {
    $result = $backup->createBackup('manual_from_dashboard');

    if ($result['success']) {
        $success_message = "Backup berhasil dibuat: " . $result['filename'];
    } else {
        $error_message = "Gagal membuat backup: " . $result['error'];
    }

    // Redirect back to member_detail.php with message
    header("Location: member_detail.php?backup_status=" . ($result['success'] ? 'success' : 'error'));
    exit();
}

// Handle backup creation
if (isset($_POST['create_backup'])) {
    $reason = $_POST['backup_reason'] ?: 'manual';
    $result = $backup->createBackup($reason);

    if ($result['success']) {
        $success_message = "Backup berhasil dibuat: " . $result['filename'];
    } else {
        $error_message = "Gagal membuat backup: " . $result['error'];
    }
}

// Handle backup download
if (isset($_GET['download'])) {
    $filename = $_GET['download'];
    $backup->downloadBackup($filename);
    exit();
}

// Handle backup restore
if (isset($_POST['restore_backup'])) {
    $filename = $_POST['backup_file'];
    $result = $backup->restoreBackup($filename);

    if ($result['success']) {
        $success_message = "Backup berhasil direstore: " . $result['message'];
    } else {
        $error_message = "Gagal restore backup: " . $result['error'];
    }
}

// Get backup list
$backups = $backup->listBackups();
?>

        <h1>Backup Manager</h1>

        <?php if (isset($success_message)): ?>
            <div class="alert alert-success"><?php echo $success_message; ?></div>
        <?php endif; ?>

        <?php if (isset($error_message)): ?>
            <div class="alert alert-error"><?php echo $error_message; ?></div>
        <?php endif; ?>

        <!-- Create Backup Form -->
        <div class="backup-section">
            <h2>Buat Backup Baru</h2>
            <form method="post" class="backup-form">
                <div class="form-group">
                    <label for="backup_reason">Alasan Backup:</label>
                    <select id="backup_reason" name="backup_reason">
                        <option value="manual">Manual Backup</option>
                        <option value="before_update">Sebelum Update</option>
                        <option value="after_maintenance">Setelah Maintenance</option>
                        <option value="daily">Daily Backup</option>
                        <option value="weekly">Weekly Backup</option>
                    </select>
                </div>
                <button type="submit" name="create_backup" class="btn-primary">Buat Backup</button>
            </form>
        </div>

        <!-- Backup List -->
        <div class="backup-section">
            <h2>Daftar Backup</h2>
            <?php if (empty($backups)): ?>
                <p>Belum ada backup yang tersedia.</p>
            <?php else: ?>
                <div class="backup-table-container">
                    <table class="backup-table">
                        <thead>
                            <tr>
                                <th>Nama File</th>
                                <th>Tanggal Dibuat</th>
                                <th>Ukuran</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach ($backups as $backup_info): ?>
                                <tr>
                                    <td><?php echo $backup_info['filename']; ?></td>
                                    <td><?php echo $backup_info['created']; ?></td>
                                    <td><?php echo formatFileSize($backup_info['size']); ?></td>
                                    <td>
                                        <a href="?download=<?php echo urlencode($backup_info['filename']); ?>"
                                           class="btn-small btn-download">Download</a>

                                        <form method="post" style="display: inline;"
                                              onsubmit="return confirm('Apakah Anda yakin ingin restore backup ini? Data saat ini akan diganti.')">
                                            <input type="hidden" name="backup_file" value="<?php echo $backup_info['filename']; ?>">
                                            <button type="submit" name="restore_backup" class="btn-small btn-restore">Restore</button>
                                        </form>
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
            <?php endif; ?>
        </div>

        <!-- Backup Information -->
        <div class="backup-section">
            <h2>Informasi Backup</h2>
            <div class="info-box">
                <h3>Backup Otomatis</h3>
                <p>Sistem akan secara otomatis membuat backup setiap kali ada perubahan data:</p>
                <ul>
                    <li><strong>Member ditambahkan:</strong> Backup otomatis dengan label 'member_added'</li>
                    <li><strong>Member diupdate:</strong> Backup otomatis dengan label 'member_updated'</li>
                    <li><strong>Member dihapus:</strong> Backup otomatis dengan label 'member_deleted'</li>
                    <li><strong>File member diupdate:</strong> Backup otomatis dengan label 'member_files_updated'</li>
                    <li><strong>Kontribusi disimpan:</strong> Backup otomatis dengan label 'contribution_updated'</li>
                </ul>

                <h3>Retensi Backup</h3>
                <p>Sistem menyimpan maksimal 10 backup terbaru. Backup yang lebih lama akan dihapus secara otomatis.</p>

                <h3>Cara Restore</h3>
                <p>Untuk restore backup:</p>
                <ol>
                    <li>Klik tombol "Restore" pada backup yang diinginkan</li>
                    <li>Konfirmasi restore (data saat ini akan diganti)</li>
                    <li>Sistem akan memproses restore dan membuat backup tambahan dengan label 'RESTORED_...'</li>
                </ol>
            </div>
        </div>

        <style>
            .backup-section {
                margin-bottom: 30px;
                padding: 20px;
                border: 1px solid #ddd;
                border-radius: 8px;
                background: #f9f9f9;
            }

            .backup-section h2 {
                margin-top: 0;
                color: #11998e;
            }

            .backup-form {
                display: flex;
                gap: 15px;
                align-items: end;
            }

            .form-group {
                flex: 1;
            }

            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
            }

            .form-group select {
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }

            .btn-primary {
                background: #11998e;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

            .btn-primary:hover {
                background: #0d7d73;
            }

            .backup-table-container {
                overflow-x: auto;
            }

            .backup-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 15px;
            }

            .backup-table th,
            .backup-table td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }

            .backup-table th {
                background: #11998e;
                color: white;
            }

            .btn-small {
                padding: 6px 12px;
                border: none;
                border-radius: 3px;
                cursor: pointer;
                font-size: 12px;
                text-decoration: none;
                display: inline-block;
            }

            .btn-download {
                background: #28a745;
                color: white;
            }

            .btn-download:hover {
                background: #218838;
            }

            .btn-restore {
                background: #ffc107;
                color: #212529;
            }

            .btn-restore:hover {
                background: #e0a800;
            }

            .alert {
                padding: 15px;
                margin-bottom: 20px;
                border: 1px solid transparent;
                border-radius: 4px;
            }

            .alert-success {
                color: #155724;
                background-color: #d4edda;
                border-color: #c3e6cb;
            }

            .alert-error {
                color: #721c24;
                background-color: #f8d7da;
                border-color: #f5c6cb;
            }

            .info-box {
                background: white;
                padding: 20px;
                border-radius: 8px;
                border-left: 4px solid #11998e;
            }

            .info-box h3 {
                margin-top: 0;
                color: #11998e;
            }

            .info-box ul {
                margin: 10px 0;
            }

            .info-box li {
                margin-bottom: 5px;
            }

            .info-box ol {
                margin: 10px 0;
            }

            .info-box li {
                margin-bottom: 5px;
            }
        </style>

<?php
include 'footer.php';

function formatFileSize($bytes) {
    if ($bytes >= 1073741824) {
        return number_format($bytes / 1073741824, 2) . ' GB';
    } elseif ($bytes >= 1048576) {
        return number_format($bytes / 1048576, 2) . ' MB';
    } elseif ($bytes >= 1024) {
        return number_format($bytes / 1024, 2) . ' KB';
    } else {
        return $bytes . ' bytes';
    }
}
?>


===== C:\xampp\htdocs\jemaat\dashboard.php =====

<?php
// dashboard.php - Enhanced Dashboard with Detailed Grouping
session_start();
require_once 'config/config.php';

// Check if user is logged in
if (!isset($_SESSION['user_id'])) {
    header("Location: login.php");
    exit();
}

// Initialize multi-tenant
MultiTenant::initialize();

$page_title = 'Dashboard - Sistem Database Jemaat';
$page_description = 'Ringkasan data keluarga jemaat dan statistik gereja yang lengkap';

$user_id = $_SESSION['user_id'];
$role = $_SESSION['role'];
$church_id = $_SESSION['church_id'] ?? null;

// Get comprehensive statistics
$stats = [
    'totalFamilies' => 0,
    'totalMembers' => 0,
    'activeNeighborhoods' => 0,
    'ageGroups' => [
        'anak' => 0,      // 0-12 tahun
        'remaja' => 0,    // 13-17 tahun
        'dewasa_muda' => 0, // 18-35 tahun
        'dewasa' => 0,    // 36-55 tahun
        'lansia' => 0     // 56+ tahun
    ],
    'occupationGroups' => [
        'medis' => 0,
        'teknologi' => 0,
        'pendidikan' => 0,
        'pemerintahan' => 0,
        'wiraswasta' => 0,
        'lainnya' => 0
    ],
    'educationGroups' => [
        'sd' => 0,
        'smp' => 0,
        'sma' => 0,
        'diploma' => 0,
        'sarjana' => 0,
        'magister' => 0,
        'doktor' => 0
    ],
    'contributionStats' => [],
    'genderStats' => [
        'laki_laki' => 0,
        'perempuan' => 0
    ],
    'relationshipStats' => [
        'bapa' => 0,
        'ibu' => 0,
        'anak' => 0,
        'tanggungan' => 0
    ]
];

try {
    $conn = getDB();

    // Get total families and members
    $query = "SELECT COUNT(*) as total_families FROM families";
    $query = MultiTenant::addChurchFilter($query, 'church_id');
    $stmt = $conn->prepare($query);
    $stmt->execute();
    $stats['totalFamilies'] = $stmt->fetch(PDO::FETCH_ASSOC)['total_families'];

    $query = "SELECT COUNT(*) as total_members FROM family_members fm
              JOIN families f ON fm.family_id = f.id";
    $query = MultiTenant::addChurchFilter($query, 'f.church_id');
    $stmt = $conn->prepare($query);
    $stmt->execute();
    $stats['totalMembers'] = $stmt->fetch(PDO::FETCH_ASSOC)['total_members'];

    // Get active neighborhoods
    $query = "SELECT COUNT(DISTINCT neighborhood) as neighborhoods FROM families";
    $query = MultiTenant::addChurchFilter($query, 'church_id');
    $stmt = $conn->prepare($query);
    $stmt->execute();
    $stats['activeNeighborhoods'] = $stmt->fetch(PDO::FETCH_ASSOC)['neighborhoods'];

    // Get age group statistics
    $query = "SELECT
                CASE
                    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) BETWEEN 0 AND 12 THEN 'anak'
                    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) BETWEEN 13 AND 17 THEN 'remaja'
                    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) BETWEEN 18 AND 35 THEN 'dewasa_muda'
                    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) BETWEEN 36 AND 55 THEN 'dewasa'
                    WHEN TIMESTAMPDIFF(YEAR, birth_date, CURDATE()) >= 56 THEN 'lansia'
                    ELSE 'tidak_diketahui'
                END as age_group,
                COUNT(*) as count
              FROM family_members fm
              JOIN families f ON fm.family_id = f.id
              WHERE birth_date IS NOT NULL";
    $query = MultiTenant::addChurchFilter($query, 'f.church_id');
    $query .= " GROUP BY age_group";

    $stmt = $conn->prepare($query);
    $stmt->execute();
    $ageResults = $stmt->fetchAll(PDO::FETCH_ASSOC);

    foreach ($ageResults as $row) {
        if (isset($stats['ageGroups'][$row['age_group']])) {
            $stats['ageGroups'][$row['age_group']] = $row['count'];
        }
    }

    // Get occupation groups
    $query = "SELECT
                CASE
                    WHEN LOWER(occupation) LIKE '%dokter%' OR LOWER(occupation) LIKE '%perawat%' OR LOWER(occupation) LIKE '%medis%' OR LOWER(occupation) LIKE '%kesehatan%' THEN 'medis'
                    WHEN LOWER(occupation) LIKE '%it%' OR LOWER(occupation) LIKE '%programmer%' OR LOWER(occupation) LIKE '%developer%' OR LOWER(occupation) LIKE '%teknisi%' OR LOWER(occupation) LIKE '%komputer%' THEN 'teknologi'
                    WHEN LOWER(occupation) LIKE '%guru%' OR LOWER(occupation) LIKE '%dosen%' OR LOWER(occupation) LIKE '%pendidikan%' OR LOWER(occupation) LIKE '%pengajar%' THEN 'pendidikan'
                    WHEN LOWER(occupation) LIKE '%pns%' OR LOWER(occupation) LIKE '%pegawai%negeri%' OR LOWER(occupation) LIKE '%pemerintah%' OR LOWER(occupation) LIKE '%bupati%' OR LOWER(occupation) LIKE '%camat%' THEN 'pemerintahan'
                    WHEN LOWER(occupation) LIKE '%wirausaha%' OR LOWER(occupation) LIKE '%bisnis%' OR LOWER(occupation) LIKE '%dagang%' OR LOWER(occupation) LIKE '%usaha%' THEN 'wiraswasta'
                    ELSE 'lainnya'
                END as occupation_group,
                COUNT(*) as count
              FROM family_members fm
              JOIN families f ON fm.family_id = f.id
              WHERE occupation IS NOT NULL AND occupation != ''";
    $query = MultiTenant::addChurchFilter($query, 'f.church_id');
    $query .= " GROUP BY occupation_group";

    $stmt = $conn->prepare($query);
    $stmt->execute();
    $occupationResults = $stmt->fetchAll(PDO::FETCH_ASSOC);

    foreach ($occupationResults as $row) {
        if (isset($stats['occupationGroups'][$row['occupation_group']])) {
            $stats['occupationGroups'][$row['occupation_group']] = $row['count'];
        }
    }

    // Get education groups
    $query = "SELECT
                CASE
                    WHEN LOWER(education) LIKE '%sd%' OR LOWER(education) LIKE '%sekolah dasar%' THEN 'sd'
                    WHEN LOWER(education) LIKE '%smp%' OR LOWER(education) LIKE '%sltp%' THEN 'smp'
                    WHEN LOWER(education) LIKE '%sma%' OR LOWER(education) LIKE '%slta%' OR LOWER(education) LIKE '%smk%' THEN 'sma'
                    WHEN LOWER(education) LIKE '%d1%' OR LOWER(education) LIKE '%d2%' OR LOWER(education) LIKE '%d3%' OR LOWER(education) LIKE '%diploma%' THEN 'diploma'
                    WHEN LOWER(education) LIKE '%s1%' OR LOWER(education) LIKE '%sarjana%' OR LOWER(education) LIKE '%strata 1%' THEN 'sarjana'
                    WHEN LOWER(education) LIKE '%s2%' OR LOWER(education) LIKE '%magister%' OR LOWER(education) LIKE '%strata 2%' THEN 'magister'
                    WHEN LOWER(education) LIKE '%s3%' OR LOWER(education) LIKE '%doktor%' OR LOWER(education) LIKE '%strata 3%' THEN 'doktor'
                    ELSE 'tidak_diketahui'
                END as education_group,
                COUNT(*) as count
              FROM family_members fm
              JOIN families f ON fm.family_id = f.id
              WHERE education IS NOT NULL AND education != ''";
    $query = MultiTenant::addChurchFilter($query, 'f.church_id');
    $query .= " GROUP BY education_group";

    $stmt = $conn->prepare($query);
    $stmt->execute();
    $educationResults = $stmt->fetchAll(PDO::FETCH_ASSOC);

    foreach ($educationResults as $row) {
        if (isset($stats['educationGroups'][$row['education_group']])) {
            $stats['educationGroups'][$row['education_group']] = $row['count'];
        }
    }

    // Get gender statistics
    $query = "SELECT
                CASE
                    WHEN LOWER(gender) = 'laki-laki' THEN 'laki_laki'
                    WHEN LOWER(gender) = 'perempuan' THEN 'perempuan'
                    ELSE 'tidak_diketahui'
                END as gender_group,
                COUNT(*) as count
              FROM family_members fm
              JOIN families f ON fm.family_id = f.id
              WHERE gender IS NOT NULL";
    $query = MultiTenant::addChurchFilter($query, 'f.church_id');
    $query .= " GROUP BY gender_group";

    $stmt = $conn->prepare($query);
    $stmt->execute();
    $genderResults = $stmt->fetchAll(PDO::FETCH_ASSOC);

    foreach ($genderResults as $row) {
        if (isset($stats['genderStats'][$row['gender_group']])) {
            $stats['genderStats'][$row['gender_group']] = $row['count'];
        }
    }

    // Get relationship statistics
    $query = "SELECT relationship, COUNT(*) as count
              FROM family_members fm
              JOIN families f ON fm.family_id = f.id";
    $query = MultiTenant::addChurchFilter($query, 'f.church_id');
    $query .= " GROUP BY relationship";

    $stmt = $conn->prepare($query);
    $stmt->execute();
    $relationshipResults = $stmt->fetchAll(PDO::FETCH_ASSOC);

    foreach ($relationshipResults as $row) {
        if (isset($stats['relationshipStats'][$row['relationship']])) {
            $stats['relationshipStats'][$row['relationship']] = $row['count'];
        }
    }

    // Get contribution statistics for current year and previous years
    $currentYear = date('Y');
    for ($year = $currentYear - 2; $year <= $currentYear; $year++) {
        $query = "SELECT COUNT(DISTINCT member_id) as contributors,
                         SUM(amount) as total_amount
                  FROM annual_contributions ac
                  JOIN members m ON ac.member_id = m.id
                  WHERE year = ?";
        $query = MultiTenant::addChurchFilter($query, 'm.church_id');

        $stmt = $conn->prepare($query);
        $stmt->execute([$year]);
        $contributionData = $stmt->fetch(PDO::FETCH_ASSOC);

        $stats['contributionStats'][$year] = [
            'contributors' => $contributionData['contributors'] ?? 0,
            'total_amount' => $contributionData['total_amount'] ?? 0
        ];
    }

} catch (PDOException $e) {
    error_log("Dashboard stats error: " . $e->getMessage());
    // Stats remain 0 or default values
}

include 'header.php';
?>

<div class="container">
    <!-- Welcome Section -->
    <div class="welcome-section">
        <h1>Dashboard Analitik Jemaat</h1>
        <p>Ringkasan komprehensif data keluarga jemaat <?php echo htmlspecialchars($_SESSION['church_name'] ?? 'Gereja'); ?></p>
    </div>

    <!-- Main Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
            <div class="stat-content">
                <h3><?php echo number_format($stats['totalFamilies']); ?></h3>
                <p>Total Keluarga</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-content">
                <h3><?php echo number_format($stats['totalMembers']); ?></h3>
                <p>Total Anggota</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üèòÔ∏è</div>
            <div class="stat-content">
                <h3><?php echo number_format($stats['activeNeighborhoods']); ?></h3>
                <p>Lingkungan Aktif</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-content">
                <h3><?php echo number_format($stats['genderStats']['laki_laki'] + $stats['genderStats']['perempuan']); ?></h3>
                <p>Data Teranalisis</p>
            </div>
        </div>
    </div>

    <!-- Detailed Analytics Sections -->
    <div class="analytics-grid">
        <!-- Age Group Distribution -->
        <div class="analytics-card">
            <div class="analytics-header">
                <h3>üìà Distribusi Kelompok Usia</h3>
                <p>Pembagian anggota berdasarkan rentang usia</p>
            </div>
            <div class="analytics-content">
                <?php
                $ageLabels = [
                    'anak' => 'Anak (0-12)',
                    'remaja' => 'Remaja (13-17)',
                    'dewasa_muda' => 'Dewasa Muda (18-35)',
                    'dewasa' => 'Dewasa (36-55)',
                    'lansia' => 'Lansia (56+)'
                ];

                $totalAge = array_sum($stats['ageGroups']);
                foreach ($stats['ageGroups'] as $key => $count):
                    if ($count > 0):
                        $percentage = $totalAge > 0 ? round(($count / $totalAge) * 100, 1) : 0;
                ?>
                <div class="distribution-item">
                    <div class="distribution-label">
                        <span><?php echo $ageLabels[$key]; ?></span>
                        <span class="distribution-count"><?php echo number_format($count); ?> orang</span>
                    </div>
                    <div class="distribution-bar">
                        <div class="distribution-fill" style="width: <?php echo $percentage; ?>%"></div>
                    </div>
                    <div class="distribution-percentage"><?php echo $percentage; ?>%</div>
                </div>
                <?php endif; endforeach; ?>
            </div>
        </div>

        <!-- Occupation Distribution -->
        <div class="analytics-card">
            <div class="analytics-header">
                <h3>üíº Kelompok Pekerjaan</h3>
                <p>Distribusi pekerjaan anggota jemaat</p>
            </div>
            <div class="analytics-content">
                <?php
                $occupationLabels = [
                    'medis' => 'Bidang Medis/Kesehatan',
                    'teknologi' => 'Teknologi & IT',
                    'pendidikan' => 'Pendidikan & Pengajaran',
                    'pemerintahan' => 'Pemerintahan',
                    'wiraswasta' => 'Wiraswasta/Bisnis',
                    'lainnya' => 'Lainnya'
                ];

                $totalOccupation = array_sum($stats['occupationGroups']);
                foreach ($stats['occupationGroups'] as $key => $count):
                    if ($count > 0):
                        $percentage = $totalOccupation > 0 ? round(($count / $totalOccupation) * 100, 1) : 0;
                ?>
                <div class="distribution-item">
                    <div class="distribution-label">
                        <span><?php echo $occupationLabels[$key]; ?></span>
                        <span class="distribution-count"><?php echo number_format($count); ?> orang</span>
                    </div>
                    <div class="distribution-bar">
                        <div class="distribution-fill" style="width: <?php echo $percentage; ?>%"></div>
                    </div>
                    <div class="distribution-percentage"><?php echo $percentage; ?>%</div>
                </div>
                <?php endif; endforeach; ?>
            </div>
        </div>

        <!-- Education Distribution -->
        <div class="analytics-card">
            <div class="analytics-header">
                <h3>üéì Tingkat Pendidikan</h3>
                <p>Level pendidikan tertinggi yang dicapai</p>
            </div>
            <div class="analytics-content">
                <?php
                $educationLabels = [
                    'sd' => 'SD/Sederajat',
                    'smp' => 'SMP/Sederajat',
                    'sma' => 'SMA/Sederajat',
                    'diploma' => 'Diploma',
                    'sarjana' => 'Sarjana',
                    'magister' => 'Magister',
                    'doktor' => 'Doktor'
                ];

                $totalEducation = array_sum($stats['educationGroups']);
                foreach ($stats['educationGroups'] as $key => $count):
                    if ($count > 0):
                        $percentage = $totalEducation > 0 ? round(($count / $totalEducation) * 100, 1) : 0;
                ?>
                <div class="distribution-item">
                    <div class="distribution-label">
                        <span><?php echo $educationLabels[$key]; ?></span>
                        <span class="distribution-count"><?php echo number_format($count); ?> orang</span>
                    </div>
                    <div class="distribution-bar">
                        <div class="distribution-fill" style="width: <?php echo $percentage; ?>%"></div>
                    </div>
                    <div class="distribution-percentage"><?php echo $percentage; ?>%</div>
                </div>
                <?php endif; endforeach; ?>
            </div>
        </div>

        <!-- Gender and Relationship Distribution -->
        <div class="analytics-card">
            <div class="analytics-header">
                <h3>üë• Demografi & Hubungan</h3>
                <p>Distribusi gender dan hubungan keluarga</p>
            </div>
            <div class="analytics-content">
                <div class="demography-grid">
                    <div class="demography-section">
                        <h4>Jenis Kelamin</h4>
                        <?php
                        $totalGender = array_sum($stats['genderStats']);
                        foreach ($stats['genderStats'] as $key => $count):
                            if ($count > 0):
                                $percentage = $totalGender > 0 ? round(($count / $totalGender) * 100, 1) : 0;
                                $genderLabel = $key === 'laki_laki' ? 'Laki-laki' : 'Perempuan';
                        ?>
                        <div class="demography-item">
                            <span class="demography-label"><?php echo $genderLabel; ?></span>
                            <span class="demography-value"><?php echo number_format($count); ?> (<?php echo $percentage; ?>%)</span>
                        </div>
                        <?php endif; endforeach; ?>
                    </div>

                    <div class="demography-section">
                        <h4>Hubungan Keluarga</h4>
                        <?php
                        $relationshipLabels = [
                            'bapa' => 'Ayah',
                            'ibu' => 'Ibu',
                            'anak' => 'Anak',
                            'tanggungan' => 'Tanggungan'
                        ];

                        $totalRelationship = array_sum($stats['relationshipStats']);
                        foreach ($stats['relationshipStats'] as $key => $count):
                            if ($count > 0):
                                $percentage = $totalRelationship > 0 ? round(($count / $totalRelationship) * 100, 1) : 0;
                        ?>
                        <div class="demography-item">
                            <span class="demography-label"><?php echo $relationshipLabels[$key]; ?></span>
                            <span class="demography-value"><?php echo number_format($count); ?> (<?php echo $percentage; ?>%)</span>
                        </div>
                        <?php endif; endforeach; ?>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contribution Statistics -->
        <div class="analytics-card">
            <div class="analytics-header">
                <h3>üí∞ Statistik Kontribusi</h3>
                <p>Data kontribusi tahunan jemaat</p>
            </div>
            <div class="analytics-content">
                <?php
                $currentYear = date('Y');
                for ($year = $currentYear - 2; $year <= $currentYear; $year++):
                    $data = $stats['contributionStats'][$year] ?? ['contributors' => 0, 'total_amount' => 0];
                    $isCurrent = $year == $currentYear;
                ?>
                <div class="contribution-year <?php echo $isCurrent ? 'current-year' : ''; ?>">
                    <div class="year-header">
                        <h4>Tahun <?php echo $year; ?></h4>
                        <?php if ($isCurrent): ?>
                        <span class="current-badge">Tahun Ini</span>
                        <?php endif; ?>
                    </div>
                    <div class="contribution-stats">
                        <div class="contribution-stat">
                            <span class="stat-label">Jumlah Penyumbang:</span>
                            <span class="stat-value"><?php echo number_format($data['contributors']); ?> keluarga</span>
                        </div>
                        <div class="contribution-stat">
                            <span class="stat-label">Total Kontribusi:</span>
                            <span class="stat-value">Rp <?php echo number_format($data['total_amount'], 0, ',', '.'); ?></span>
                        </div>
                        <?php if ($data['contributors'] > 0): ?>
                        <div class="contribution-stat">
                            <span class="stat-label">Rata-rata per Keluarga:</span>
                            <span class="stat-value">Rp <?php echo number_format($data['total_amount'] / $data['contributors'], 0, ',', '.'); ?></span>
                        </div>
                        <?php endif; ?>
                    </div>
                </div>
                <?php endfor; ?>
            </div>
        </div>

        <!-- Quick Summary -->
        <div class="analytics-card">
            <div class="analytics-header">
                <h3>üìã Ringkasan Cepat</h3>
                <p>Statistik penting dalam satu pandangan</p>
            </div>
            <div class="analytics-content">
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-icon">üë∂</div>
                        <div class="summary-text">
                            <strong><?php echo number_format($stats['ageGroups']['anak']); ?></strong>
                            <span>Anak-anak</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon">üßë‚Äçüéì</div>
                        <div class="summary-text">
                            <strong><?php echo number_format($stats['ageGroups']['remaja']); ?></strong>
                            <span>Remaja</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon">üë®‚Äç‚öïÔ∏è</div>
                        <div class="summary-text">
                            <strong><?php echo number_format($stats['occupationGroups']['medis']); ?></strong>
                            <span>Bidang Medis</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon">üíª</div>
                        <div class="summary-text">
                            <strong><?php echo number_format($stats['occupationGroups']['teknologi']); ?></strong>
                            <span>Bidang Teknologi</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon">üèõÔ∏è</div>
                        <div class="summary-text">
                            <strong><?php echo number_format($stats['occupationGroups']['pemerintahan']); ?></strong>
                            <span>Pemerintahan</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-icon">üéì</div>
                        <div class="summary-text">
                            <strong><?php echo number_format($stats['educationGroups']['sarjana'] + $stats['educationGroups']['magister'] + $stats['educationGroups']['doktor']); ?></strong>
                            <span>Sarjana+</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2>Aksi Cepat</h2>
        <div class="action-buttons">
            <a href="add_form.php" class="action-btn primary">
                <span class="action-icon">‚ûï</span>
                <span>Tambah Keluarga Baru</span>
            </a>

            <a href="member_detail.php" class="action-btn secondary">
                <span class="action-icon">üìã</span>
                <span>Lihat Data Keluarga</span>
            </a>

            <?php if ($role === 'super'): ?>
                <a href="pending_submissions.php" class="action-btn warning">
                    <span class="action-icon">‚è≥</span>
                    <span>Pending Approval</span>
                </a>

                <a href="manage_users.php" class="action-btn info">
                    <span class="action-icon">üë•</span>
                    <span>Kelola Pengguna</span>
                </a>
            <?php elseif ($role === 'admin'): ?>
                <a href="admin_pending_submissions.php" class="action-btn warning">
                    <span class="action-icon">üìã</span>
                    <span>Pengajuan Form</span>
                </a>
            <?php endif; ?>
        </div>
    </div>
</div>

<style>
/* Enhanced Dashboard Styles */
.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.analytics-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    border: 1px solid #e1e5e9;
    transition: all 0.3s ease;
}

.analytics-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}

.analytics-header {
    margin-bottom: 20px;
    border-bottom: 2px solid #f8f9fa;
    padding-bottom: 15px;
}

.analytics-header h3 {
    margin: 0 0 8px 0;
    color: #11998e;
    font-size: 18px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.analytics-header p {
    margin: 0;
    color: #666;
    font-size: 14px;
}

.analytics-content {
    max-height: 400px;
    overflow-y: auto;
}

/* Distribution Items */
.distribution-item {
    margin-bottom: 15px;
    padding: 10px 0;
}

.distribution-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 500;
}

.distribution-count {
    color: #666;
    font-size: 12px;
    font-weight: 400;
}

.distribution-bar {
    width: 100%;
    height: 8px;
    background: #f8f9fa;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 5px;
}

.distribution-fill {
    height: 100%;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    border-radius: 4px;
    transition: width 0.5s ease;
}

.distribution-percentage {
    text-align: right;
    font-size: 12px;
    color: #666;
    font-weight: 600;
}

/* Demography Grid */
.demography-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.demography-section h4 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 16px;
    font-weight: 600;
}

.demography-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f8f9fa;
}

.demography-label {
    color: #555;
    font-size: 14px;
}

.demography-value {
    color: #333;
    font-weight: 600;
    font-size: 14px;
}

/* Contribution Styles */
.contribution-year {
    padding: 15px;
    margin-bottom: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    border-left: 4px solid #11998e;
}

.contribution-year.current-year {
    background: #f0fff4;
    border-left-color: #28a745;
}

.year-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.year-header h4 {
    margin: 0;
    color: #333;
    font-size: 16px;
    font-weight: 600;
}

.current-badge {
    background: #28a745;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
}

.contribution-stats {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.contribution-stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
}

.stat-label {
    color: #666;
}

.stat-value {
    color: #333;
    font-weight: 600;
}

/* Summary Grid */
.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.summary-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.summary-item:hover {
    background: #e9ecef;
    transform: translateY(-2px);
}

.summary-icon {
    font-size: 24px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    border-radius: 50%;
    color: white;
}

.summary-text {
    display: flex;
    flex-direction: column;
}

.summary-text strong {
    font-size: 18px;
    font-weight: 700;
    color: #333;
    line-height: 1.2;
}

.summary-text span {
    font-size: 12px;
    color: #666;
    font-weight: 500;
}

/* Responsive Design */
@media (max-width: 768px) {
    .analytics-grid {
        grid-template-columns: 1fr;
    }

    .demography-grid {
        grid-template-columns: 1fr;
    }

    .summary-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .analytics-card {
        padding: 20px;
    }

    .distribution-label {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }

    .contribution-stat {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
}

@media (max-width: 480px) {
    .summary-grid {
        grid-template-columns: 1fr;
    }

    .analytics-card {
        padding: 15px;
    }

    .summary-item {
        padding: 12px;
    }
}

/* Scrollbar Styling */
.analytics-content::-webkit-scrollbar {
    width: 6px;
}

.analytics-content::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.analytics-content::-webkit-scrollbar-thumb {
    background: #11998e;
    border-radius: 3px;
}

.analytics-content::-webkit-scrollbar-thumb:hover {
    background: #0d7d73;
}
</style>

<script>
// Animate distribution bars when they come into view
document.addEventListener('DOMContentLoaded', function() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const distributionFills = entry.target.querySelectorAll('.distribution-fill');
                distributionFills.forEach(fill => {
                    const width = fill.style.width;
                    fill.style.width = '0%';
                    setTimeout(() => {
                        fill.style.width = width;
                    }, 100);
                });
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.analytics-card').forEach(card => {
        observer.observe(card);
    });
});

// Refresh stats every 5 minutes
setInterval(() => {
    // You can add AJAX call here to refresh stats without page reload
    console.log('Stats refresh interval reached');
}, 300000);
</script>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\delete_member.php =====

<?php
require_once 'config/config.php';

if (!isset($_SESSION['user_id']) || $_SESSION['role'] != 'super') {
    header("Location: login.php");
    exit();
}

$id = $_GET['id'];

$conn = getDB();
$stmt = $conn->prepare("SELECT * FROM members WHERE id = ?");
$stmt->bind_param("i", $id);
$stmt->execute();
$result = $stmt->get_result();
$member = $result->fetch_assoc();
$stmt->close();

if ($member) {
    // Delete files
    $upload_dir = 'uploads/';
    $files = ['birth_file', 'baptism_file', 'confirmation_file', 'marriage_file', 'death_file'];
    foreach ($files as $file) {
        if ($member[$file] && file_exists($upload_dir . $member[$file])) {
            unlink($upload_dir . $member[$file]);
        }
    }

    // Delete from DB
    $stmt = $conn->prepare("DELETE FROM members WHERE id = ?");
    $stmt->bind_param("i", $id);
    $stmt->execute();
    $stmt->close();

    // Trigger backup after successful member deletion
    triggerBackup($conn, 'member_deleted');
}

$conn->close();
header("Location: rincian.php");
exit();
?>


===== C:\xampp\htdocs\jemaat\edit_member.php =====

<?php
session_start();
require_once 'config/config.php';

$page_title = 'Edit Anggota Keluarga - Jemaat App';

// Check if user is logged in
if (!isset($_SESSION['user_id'])) {
    header("Location: login.php");
    exit();
}

$user_id = $_SESSION['user_id'];
$role = $_SESSION['role'];

// Get member ID from URL
$id = isset($_GET['id']) ? (int)$_GET['id'] : 0;

if (!$id) {
    header("Location: member_detail.php");
    exit();
}

$conn = getDB();

// Get family member data with family information
$stmt = $conn->prepare("
    SELECT fm.*, f.family_address, f.neighborhood, f.register_number, f.id as family_id
    FROM family_members fm
    JOIN families f ON fm.family_id = f.id
    WHERE fm.id = ?
");
$stmt->execute([$id]);
$member = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$member) {
    header("Location: member_detail.php");
    exit();
}

// Check permissions - only super admin or family creator can edit
if ($role != 'super' && $member['created_by'] != $user_id) {
    header("Location: member_detail.php");
    exit();
}

// Initialize variables to avoid undefined warnings
$member = array_merge([
    'name' => '',
    'gender' => '',
    'birth_date' => '',
    'phone' => '',
    'occupation' => '',
    'education' => '',
    'notes' => '',
    'birth_certificate' => '',
    'baptism_certificate' => '',
    'confirmation_certificate' => '',
    'marriage_certificate' => '',
    'death_certificate' => '',
    'register_number' => '',
    'neighborhood' => '',
    'family_address' => '',
    'family_id' => '',
    'relationship' => '',
    'status' => 'Aktif',
    'baptism_date' => '',
    'confirmation_date' => '',
    'marriage_date' => '',
    'death_date' => '',
    'is_deceased' => 0
], $member);

include 'header.php';

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    try {
        $name = trim($_POST['name']);
        $gender = $_POST['gender'] ?? '';
        $birth_date = $_POST['birth_date'] ?? '';
        $phone = trim($_POST['phone'] ?? '');
        $occupation = trim($_POST['occupation'] ?? '');
        $education = trim($_POST['education'] ?? '');
        $notes = trim($_POST['notes'] ?? '');
        $relationship = $_POST['relationship'] ?? '';
        $status = $_POST['status'] ?? 'Aktif';
        $is_deceased = isset($_POST['is_deceased']) ? 1 : 0;

        // Tanggal-tanggal penting
        $baptism_date = $_POST['baptism_date'] ?? '';
        $confirmation_date = $_POST['confirmation_date'] ?? '';
        $marriage_date = $_POST['marriage_date'] ?? '';
        $death_date = $_POST['death_date'] ?? '';

        // Data keluarga (jika diubah)
        $family_address = trim($_POST['family_address'] ?? '');
        $neighborhood = $_POST['neighborhood'] ?? '';

        // Handle file uploads
        $upload_dir = 'uploads/';
        if (!is_dir($upload_dir)) {
            mkdir($upload_dir, 0755, true);
        }

        $date_prefix = date('Ymd');
        $files = [
            'birth_file' => 'akte_lahir',
            'baptism_file' => 'sertifikat_baptis',
            'confirmation_file' => 'sertifikat_sidi',
            'marriage_file' => 'sertifikat_nikah',
            'death_file' => 'sertifikat_kematian'
        ];

        $file_names = [
            'birth_certificate' => $member['birth_certificate'],
            'baptism_certificate' => $member['baptism_certificate'],
            'confirmation_certificate' => $member['confirmation_certificate'],
            'marriage_certificate' => $member['marriage_certificate'],
            'death_certificate' => $member['death_certificate']
        ];

        foreach ($files as $field => $type) {
            if (isset($_FILES[$field]) && $_FILES[$field]['error'] == 0) {
                // Delete old file if exists
                $old_file_field = str_replace('_file', '_certificate', $field);
                if (!empty($member[$old_file_field]) && file_exists($upload_dir . $member[$old_file_field])) {
                    unlink($upload_dir . $member[$old_file_field]);
                }

                $file_extension = strtolower(pathinfo($_FILES[$field]['name'], PATHINFO_EXTENSION));
                $new_name = $date_prefix . '_' . $member['register_number'] . '_' . $type . '.' . $file_extension;

                if (move_uploaded_file($_FILES[$field]['tmp_name'], $upload_dir . $new_name)) {
                    $file_names[$old_file_field] = $new_name;
                }
            }
        }

        // Update data keluarga jika diubah
        if ($family_address !== $member['family_address'] || $neighborhood !== $member['neighborhood']) {
            $stmt_family = $conn->prepare("
                UPDATE families SET
                family_address = ?,
                neighborhood = ?,
                updated_at = NOW()
                WHERE id = ?
            ");
            $stmt_family->execute([$family_address, $neighborhood, $member['family_id']]);
        }

        // Update family member data
        $stmt = $conn->prepare("
            UPDATE family_members SET
                name = ?,
                gender = ?,
                birth_date = ?,
                phone = ?,
                occupation = ?,
                education = ?,
                notes = ?,
                relationship = ?,
                status = ?,
                is_deceased = ?,
                baptism_date = ?,
                confirmation_date = ?,
                marriage_date = ?,
                death_date = ?,
                birth_certificate = ?,
                baptism_certificate = ?,
                confirmation_certificate = ?,
                marriage_certificate = ?,
                death_certificate = ?,
                updated_at = NOW()
            WHERE id = ?
        ");

        $stmt->execute([
            $name,
            $gender,
            $birth_date,
            $phone,
            $occupation,
            $education,
            $notes,
            $relationship,
            $status,
            $is_deceased,
            $baptism_date,
            $confirmation_date,
            $marriage_date,
            $death_date,
            $file_names['birth_certificate'],
            $file_names['baptism_certificate'],
            $file_names['confirmation_certificate'],
            $file_names['marriage_certificate'],
            $file_names['death_certificate'],
            $id
        ]);

        // Log the update
        error_log("Family member updated: ID $id by user $user_id");

        // Redirect back to family view page
        header("Location: view_family.php?family_id=" . $member['family_id'] . "&updated=1");
        exit();

    } catch (Exception $e) {
        $error_message = "Error updating member: " . $e->getMessage();
        error_log($error_message);
    }
}
?>

<div class="form-container">
    <h1>Edit Anggota Keluarga</h1>

    <?php if (isset($error_message)): ?>
        <div class="alert alert-error" style="margin-bottom: 20px; padding: 15px; border-radius: 8px; border: 1px solid #dc3545; background: #f8d7da; color: #721c24;">
            <?php echo htmlspecialchars($error_message); ?>
        </div>
    <?php endif; ?>

    <form action="" method="post" enctype="multipart/form-data" id="editMemberForm">
        <div class="form-card">
            <h3>Informasi Keluarga</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="register_number">No. Register</label>
                    <input type="text" id="register_number" name="register_number" value="<?php echo htmlspecialchars($member['register_number']); ?>" readonly style="background-color: #f8f9fa;">
                    <small class="form-text text-muted">No. Register tidak dapat diubah</small>
                </div>

                <div class="form-group">
                    <label for="neighborhood">Lingkungan *</label>
                    <select id="neighborhood" name="neighborhood" required>
                        <option value="">Pilih Lingkungan</option>
                        <option value="Alfa" <?php echo ($member['neighborhood'] == 'Alfa') ? 'selected' : ''; ?>>Alfa</option>
                        <option value="Beta" <?php echo ($member['neighborhood'] == 'Beta') ? 'selected' : ''; ?>>Beta</option>
                        <option value="Teta" <?php echo ($member['neighborhood'] == 'Teta') ? 'selected' : ''; ?>>Teta</option>
                        <option value="Delta" <?php echo ($member['neighborhood'] == 'Delta') ? 'selected' : ''; ?>>Delta</option>
                        <option value="Epsilon" <?php echo ($member['neighborhood'] == 'Epsilon') ? 'selected' : ''; ?>>Epsilon</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="family_address">Alamat Keluarga *</label>
                <textarea id="family_address" name="family_address" rows="3" required><?php echo htmlspecialchars($member['family_address']); ?></textarea>
            </div>
        </div>

        <div class="form-card">
            <h3>Data Pribadi</h3>

            <div class="form-grid">
                <div class="form-group">
                    <label for="name">Nama Lengkap *</label>
                    <input type="text" id="name" name="name" value="<?php echo htmlspecialchars($member['name']); ?>" required>
                </div>

                <div class="form-group">
                    <label for="gender">Jenis Kelamin *</label>
                    <select id="gender" name="gender" required>
                        <option value="">Pilih Jenis Kelamin</option>
                        <option value="Laki-laki" <?php echo ($member['gender'] == 'Laki-laki') ? 'selected' : ''; ?>>Laki-laki</option>
                        <option value="Perempuan" <?php echo ($member['gender'] == 'Perempuan') ? 'selected' : ''; ?>>Perempuan</option>
                    </select>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="relationship">Hubungan dalam Keluarga *</label>
                    <select id="relationship" name="relationship" required>
                        <option value="">Pilih Hubungan</option>
                        <option value="bapa" <?php echo ($member['relationship'] == 'bapa') ? 'selected' : ''; ?>>Bapa (Ayah)</option>
                        <option value="ibu" <?php echo ($member['relationship'] == 'ibu') ? 'selected' : ''; ?>>Ibu</option>
                        <option value="anak" <?php echo ($member['relationship'] == 'anak') ? 'selected' : ''; ?>>Anak</option>
                        <option value="tanggungan" <?php echo ($member['relationship'] == 'tanggungan') ? 'selected' : ''; ?>>Tanggungan</option>
                        <option value="saudara" <?php echo ($member['relationship'] == 'saudara') ? 'selected' : ''; ?>>Saudara</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="status">Status Keanggotaan *</label>
                    <select id="status" name="status" required>
                        <option value="Aktif" <?php echo ($member['status'] == 'Aktif') ? 'selected' : ''; ?>>Aktif</option>
                        <option value="Pasif" <?php echo ($member['status'] == 'Pasif') ? 'selected' : ''; ?>>Pasif</option>
                        <option value="Pindah" <?php echo ($member['status'] == 'Pindah') ? 'selected' : ''; ?>>Pindah</option>
                    </select>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="birth_date">Tanggal Lahir</label>
                    <input type="date" id="birth_date" name="birth_date" value="<?php echo htmlspecialchars($member['birth_date']); ?>">
                </div>

                <div class="form-group">
                    <label for="phone">No. HP</label>
                    <input type="text" id="phone" name="phone" value="<?php echo htmlspecialchars($member['phone']); ?>">
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="occupation">Pekerjaan</label>
                    <input type="text" id="occupation" name="occupation" value="<?php echo htmlspecialchars($member['occupation']); ?>">
                </div>

                <div class="form-group">
                    <label for="education">Pendidikan</label>
                    <input type="text" id="education" name="education" value="<?php echo htmlspecialchars($member['education']); ?>">
                </div>
            </div>

            <div class="form-group">
                <label for="notes">Keterangan</label>
                <textarea id="notes" name="notes" rows="3"><?php echo htmlspecialchars($member['notes']); ?></textarea>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="is_deceased" name="is_deceased" value="1" <?php echo ($member['is_deceased'] == 1) ? 'checked' : ''; ?>>
                    <span class="checkmark"></span>
                    Meninggal Dunia
                </label>
            </div>
        </div>

        <div class="form-card">
            <h3>Tanggal Penting</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="baptism_date">Tanggal Baptis</label>
                    <input type="date" id="baptism_date" name="baptism_date" value="<?php echo htmlspecialchars($member['baptism_date']); ?>">
                </div>

                <div class="form-group">
                    <label for="confirmation_date">Tanggal Sidi</label>
                    <input type="date" id="confirmation_date" name="confirmation_date" value="<?php echo htmlspecialchars($member['confirmation_date']); ?>">
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="marriage_date">Tanggal Menikah</label>
                    <input type="date" id="marriage_date" name="marriage_date" value="<?php echo htmlspecialchars($member['marriage_date']); ?>">
                </div>

                <div class="form-group">
                    <label for="death_date">Tanggal Meninggal</label>
                    <input type="date" id="death_date" name="death_date" value="<?php echo htmlspecialchars($member['death_date']); ?>" <?php echo ($member['is_deceased'] == 1) ? '' : 'disabled'; ?>>
                </div>
            </div>
        </div>

        <div class="form-card">
            <h3>Dokumen</h3>

            <div class="form-grid documents-section">
                <div class="form-group">
                    <label for="birth_file">Akte Lahir</label>
                    <input type="file" id="birth_file" name="birth_file" accept="image/*,.pdf,.doc,.docx">
                    <?php if (!empty($member['birth_certificate'])): ?>
                        <small>Current: <a href="uploads/<?php echo htmlspecialchars($member['birth_certificate']); ?>" target="_blank"><?php echo htmlspecialchars($member['birth_certificate']); ?></a></small>
                    <?php endif; ?>
                </div>

                <div class="form-group">
                    <label for="baptism_file">Sertifikat Baptis</label>
                    <input type="file" id="baptism_file" name="baptism_file" accept="image/*,.pdf,.doc,.docx">
                    <?php if (!empty($member['baptism_certificate'])): ?>
                        <small>Current: <a href="uploads/<?php echo htmlspecialchars($member['baptism_certificate']); ?>" target="_blank"><?php echo htmlspecialchars($member['baptism_certificate']); ?></a></small>
                    <?php endif; ?>
                </div>
            </div>

            <div class="form-grid documents-section">
                <div class="form-group">
                    <label for="confirmation_file">Sertifikat Sidi</label>
                    <input type="file" id="confirmation_file" name="confirmation_file" accept="image/*,.pdf,.doc,.docx">
                    <?php if (!empty($member['confirmation_certificate'])): ?>
                        <small>Current: <a href="uploads/<?php echo htmlspecialchars($member['confirmation_certificate']); ?>" target="_blank"><?php echo htmlspecialchars($member['confirmation_certificate']); ?></a></small>
                    <?php endif; ?>
                </div>

                <div class="form-group">
                    <label for="marriage_file">Sertifikat Nikah</label>
                    <input type="file" id="marriage_file" name="marriage_file" accept="image/*,.pdf,.doc,.docx">
                    <?php if (!empty($member['marriage_certificate'])): ?>
                        <small>Current: <a href="uploads/<?php echo htmlspecialchars($member['marriage_certificate']); ?>" target="_blank"><?php echo htmlspecialchars($member['marriage_certificate']); ?></a></small>
                    <?php endif; ?>
                </div>
            </div>

            <div class="form-grid documents-section">
                <div class="form-group">
                    <label for="death_file">Sertifikat Kematian</label>
                    <input type="file" id="death_file" name="death_file" accept="image/*,.pdf,.doc,.docx">
                    <?php if (!empty($member['death_certificate'])): ?>
                        <small>Current: <a href="uploads/<?php echo htmlspecialchars($member['death_certificate']); ?>" target="_blank"><?php echo htmlspecialchars($member['death_certificate']); ?></a></small>
                    <?php endif; ?>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <a href="view_family.php?family_id=<?php echo $member['family_id']; ?>" class="btn btn-secondary">Kembali</a>
            <button type="submit" class="btn btn-primary">Update Data</button>
        </div>
    </form>
</div>

<style>
.form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.form-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e1e5e9;
}

.form-card h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #11998e;
    border-bottom: 2px solid #11998e;
    padding-bottom: 10px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    font-weight: 600;
    margin-bottom: 5px;
    color: #333;
}

.form-group input,
.form-group select,
.form-group textarea {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 2px rgba(17, 153, 142, 0.1);
}

.form-group input[readonly] {
    background-color: #f8f9fa;
    cursor: not-allowed;
}

.form-text {
    font-size: 12px;
    color: #6c757d;
    margin-top: 5px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: normal;
}

.checkbox-label input[type="checkbox"] {
    margin-right: 10px;
}

.documents-section {
    border-top: 1px solid #eee;
    padding-top: 15px;
    margin-top: 15px;
}

.form-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    margin-top: 30px;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s ease;
}

.btn-primary {
    background: #11998e;
    color: white;
}

.btn-primary:hover {
    background: #0d7d73;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #545b62;
    transform: translateY(-2px);
}

.alert {
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
}

.alert-error {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
}

@media (max-width: 768px) {
    .form-container {
        padding: 10px;
    }

    .form-grid {
        grid-template-columns: 1fr;
    }

    .form-actions {
        flex-direction: column;
    }

    .btn {
        width: 100%;
        text-align: center;
    }
}
</style>

<script>
// Form validation
document.getElementById('editMemberForm').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();
    const gender = document.getElementById('gender').value;
    const relationship = document.getElementById('relationship').value;
    const status = document.getElementById('status').value;
    const neighborhood = document.getElementById('neighborhood').value;
    const familyAddress = document.getElementById('family_address').value.trim();

    if (!name || !gender || !relationship || !status || !neighborhood || !familyAddress) {
        alert('Semua field yang bertanda * harus diisi!');
        e.preventDefault();
        return false;
    }

    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.textContent = 'Menyimpan...';
    submitBtn.disabled = true;
});

// File upload validation
document.querySelectorAll('input[type="file"]').forEach(input => {
    input.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('File terlalu besar! Maksimal 5MB.');
                this.value = '';
                return;
            }

            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!allowedTypes.includes(file.type)) {
                alert('Format file tidak didukung! Gunakan JPG, PNG, GIF, PDF, atau DOC.');
                this.value = '';
                return;
            }
        }
    });
});

// Enable/disable death date based on deceased checkbox
document.getElementById('is_deceased').addEventListener('change', function() {
    const deathDateInput = document.getElementById('death_date');
    if (this.checked) {
        deathDateInput.disabled = false;
    } else {
        deathDateInput.disabled = true;
        deathDateInput.value = '';
    }
});
</script>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\footer.php =====

            </div> <!-- content-body -->
        </main> <!-- main-content -->
    </div> <!-- app-container -->
</body>
</html>


===== C:\xampp\htdocs\jemaat\get_neighborhoods.php =====

<?php
require_once 'config/config.php';

header('Content-Type: application/json');

try {
    if (!isset($_GET['church_id']) || empty($_GET['church_id'])) {
        throw new Exception('Church ID is required');
    }

    $churchId = $_GET['church_id'];

    $conn = getDB();
    $stmt = $conn->prepare("
        SELECT neighborhood_name, description
        FROM church_neighborhoods
        WHERE church_id = ?
        ORDER BY neighborhood_name
    ");
    $stmt->execute([$churchId]);
    $neighborhoods = $stmt->fetchAll(PDO::FETCH_ASSOC);

    echo json_encode($neighborhoods);

} catch (Exception $e) {
    http_response_code(400);
    echo json_encode(['error' => $e->getMessage()]);
}
?>


===== C:\xampp\htdocs\jemaat\header.php =====

<?php
// header.php - UPDATED FOR MULTI-TENANT
if (session_status() == PHP_SESSION_NONE) {
    session_start();
}

require_once 'config/database.php';
require_once 'config/multi_tenant.php';

// Initialize multi-tenant system
MultiTenant::initialize();

if (!isset($_SESSION['user_id']) && basename($_SERVER['PHP_SELF']) != 'login.php' && basename($_SERVER['PHP_SELF']) != 'index.php') {
    header("Location: login.php");
    exit();
}

$role = isset($_SESSION['role']) ? $_SESSION['role'] : '';
$user_id = isset($_SESSION['user_id']) ? $_SESSION['user_id'] : '';
$church_id = isset($_SESSION['church_id']) ? $_SESSION['church_id'] : '';
$church_name = isset($_SESSION['church_name']) ? $_SESSION['church_name'] : '';

// Get church info if logged in
if (isset($_SESSION['user_id'])) {
    try {
        $conn = getDB();
        $stmt = $conn->prepare("
            SELECT c.*, u.is_super_admin
            FROM users u
            LEFT JOIN churches c ON u.church_id = c.id
            WHERE u.id = ?
        ");
        $stmt->execute([$_SESSION['user_id']]);
        $user_church = $stmt->fetch(PDO::FETCH_ASSOC);

        if ($user_church) {
            $_SESSION['church_name'] = $user_church['church_name'] ?? 'System Admin';
            $_SESSION['is_super_admin'] = $user_church['is_super_admin'] ?? false;
        }
    } catch (PDOException $e) {
        error_log("Church info error: " . $e->getMessage());
    }
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo isset($page_title) ? $page_title : 'Sistem Database Jemaat'; ?></title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/script.js" defer></script>
</head>
<body>
    <?php if (isset($_SESSION['user_id'])): ?>
    <?php
    $pending_count = 0;
    if ($role === 'super') {
        try {
            $conn = getDB();
            $pending_stmt = $conn->prepare("SELECT COUNT(*) as count FROM staging_families WHERE status = 'pending'");
            $pending_stmt->execute();
            $pending_count = $pending_stmt->fetch(PDO::FETCH_ASSOC)['count'];
        } catch (PDOException $e) {
            error_log("Error fetching pending count: " . $e->getMessage());
        }
    }
    ?>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.php" class="nav-logo">‚õ™ <?php echo htmlspecialchars($_SESSION['church_name'] ?? 'Jemaat App'); ?></a>
            <span class="hamburger" onclick="toggleMenu()">‚ò∞</span>
            <ul class="nav-menu" id="nav-menu">
                <?php if ($role === 'super'): ?>
                    <li><a href="pending_submissions.php" class="nav-link <?php echo $pending_count > 0 ? 'has-notification' : ''; ?>">
                        Pending Approval
                        <?php if ($pending_count > 0): ?>
                            <span class="notification-badge"><?php echo $pending_count; ?></span>
                        <?php endif; ?>
                    </a></li>
                    <li><a href="add_admin.php">Tambah Admin</a></li>
                    <li><a href="manage_users.php">Manage Users</a></li>
                    <li><a href="backup_manager.php">Backup Manager</a></li>
                <?php elseif ($role === 'admin'): ?>
                    <li><a href="admin_pending_submissions.php" class="nav-link">
                        Pengajuan Form
                    </a></li>
                <?php endif; ?>
                
                <li><a href="member_detail.php">Daftar Keluarga</a></li>
                <li><a href="add_form.php">Tambah Anggota</a></li>
                
                <li><a href="logout.php">Logout</a></li>
            </ul>
        </div>
    </nav>
    <?php endif; ?>
    <div class="container">


===== C:\xampp\htdocs\jemaat\index.php =====

<?php
// index.php - Redirect to login page
header("Location: login.php");
exit();
?>


===== C:\xampp\htdocs\jemaat\login.php =====

<?php
// login.php - UPDATED FOR MULTI-TENANT WITH CSRF PROTECTION
if (session_status() == PHP_SESSION_NONE) {
    session_start();
}
require_once 'config/config.php';

// Check rate limiting for login attempts
$rateLimitResult = checkRateLimit('login');
if (!$rateLimitResult['allowed']) {
    $error = "Terlalu banyak percobaan login. Silakan coba lagi dalam " . ceil($rateLimitResult['wait_time'] / 60) . " menit.";
    LogManager::warning('Login rate limit exceeded', [
        'ip' => $_SERVER['REMOTE_ADDR'],
        'wait_time' => $rateLimitResult['wait_time']
    ]);
}

if (isset($_SESSION['user_id'])) {
    header("Location: member_detail.php");
    exit();
}

// Generate CSRF token if not exists
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}

$error = "";

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Validate CSRF token
    if (!isset($_POST['csrf_token']) || $_POST['csrf_token'] !== $_SESSION['csrf_token']) {
        $error = "Token keamanan tidak valid.";
        error_log("CSRF token mismatch from IP: " . $_SERVER['REMOTE_ADDR']);
    } else {
        $username = $_POST['username'];
        $password = $_POST['password'];

        $conn = getDB();
        $stmt = $conn->prepare("
            SELECT u.*, c.church_name, c.province, c.city
            FROM users u
            LEFT JOIN churches c ON u.church_id = c.id
            WHERE u.username = ? AND u.role IN ('admin', 'super')
        ");
        $stmt->execute([$username]);
        $user = $stmt->fetch(PDO::FETCH_ASSOC);

        if ($user && password_verify($password, $user['password'])) {
            $_SESSION['user_id'] = $user['id'];
            $_SESSION['role'] = $user['role'];
            $_SESSION['church_id'] = $user['church_id'];
            $_SESSION['church_name'] = $user['church_name'] ?? 'System Admin';
            $_SESSION['province'] = $user['province'] ?? '';
            $_SESSION['city'] = $user['city'] ?? '';
            $_SESSION['username'] = $username;

            // Initialize multi-tenant
            MultiTenant::setCurrentChurch($user['church_id']);

            // Regenerate CSRF token after successful login
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));

            // Redirect berdasarkan role
            if ($user['role'] === 'super') {
                header("Location: pending_submissions.php");
            } else {
                header("Location: admin_pending_submissions.php");
            }
            exit();
        } else {
            $error = "Username atau password salah.";
            // Regenerate CSRF token after failed login attempt
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
        }
    }
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login - Sistem Database Jemaat</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="login-body">
    <div class="login-container">
        <div class="login-card">
            <div class="logo">‚õ™</div>
            <h1>Sistem Database Jemaat</h1>
            <p>Masuk untuk mengakses data anggota jemaat</p>
            <?php if ($error) echo "<p class='error'>$error</p>"; ?>
            <form method="post" action="">
                <input type="hidden" name="csrf_token" value="<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>">
                <div class="input-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-btn">Masuk</button>
            </form>
        </div>
    </div>
</body>
</html>


===== C:\xampp\htdocs\jemaat\logout.php =====

<?php
session_start();
session_destroy();
header("Location: login.php");
exit();
?>


===== C:\xampp\htdocs\jemaat\manage_churches.php =====

<?php
// manage_churches.php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'super') {
    header("Location: login.php");
    exit();
}

$page_title = 'Manajemen Gereja - Sistem Multi-Tenant';
include 'header.php';

$message = '';
$error = '';

try {
    $conn = getDB();
    
    // Handle add church
    if ($_POST['add_church']) {
        $church_name = $_POST['church_name'];
        $province = $_POST['province'];
        $city = $_POST['city'];
        $address = $_POST['address'];
        $phone = $_POST['phone'];
        $email = $_POST['email'];
        
        $stmt = $conn->prepare("INSERT INTO churches (church_name, province, city, address, phone, email) VALUES (?, ?, ?, ?, ?, ?)");
        $stmt->execute([$church_name, $province, $city, $address, $phone, $email]);
        
        $message = "Gereja berhasil ditambahkan";
    }
    
    // Handle add neighborhood
    if ($_POST['add_neighborhood']) {
        $church_id = $_POST['church_id'];
        $neighborhood_name = $_POST['neighborhood_name'];
        $description = $_POST['description'];
        
        $stmt = $conn->prepare("INSERT INTO church_neighborhoods (church_id, neighborhood_name, description) VALUES (?, ?, ?)");
        $stmt->execute([$church_id, $neighborhood_name, $description]);
        
        $message = "Lingkungan berhasil ditambahkan";
    }
    
    // Get all churches
    $churches = $conn->query("SELECT * FROM churches WHERE is_active = TRUE ORDER BY province, city")->fetchAll();
    
    // Get neighborhoods for each church
    $neighborhoods = [];
    foreach ($churches as $church) {
        $stmt = $conn->prepare("SELECT * FROM church_neighborhoods WHERE church_id = ?");
        $stmt->execute([$church['id']]);
        $neighborhoods[$church['id']] = $stmt->fetchAll();
    }
    
} catch (PDOException $e) {
    $error = "Error: " . $e->getMessage();
}
?>

<div class="container">
    <h1>Manajemen Gereja & Lingkungan</h1>
    
    <?php if ($message): ?>
        <div class="alert alert-success"><?php echo $message; ?></div>
    <?php endif; ?>
    
    <?php if ($error): ?>
        <div class="alert alert-error"><?php echo $error; ?></div>
    <?php endif; ?>
    
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'churches-tab')">Daftar Gereja</button>
        <button class="tab-btn" onclick="openTab(event, 'add-church-tab')">Tambah Gereja</button>
        <button class="tab-btn" onclick="openTab(event, 'neighborhoods-tab')">Kelola Lingkungan</button>
    </div>
    
    <!-- Churches List Tab -->
    <div id="churches-tab" class="tab-content active">
        <h3>Daftar Gereja Terdaftar</h3>
        <div class="table-responsive">
            <table class="compact-table">
                <thead>
                    <tr>
                        <th>Nama Gereja</th>
                        <th>Provinsi</th>
                        <th>Kota</th>
                        <th>Alamat</th>
                        <th>Kontak</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($churches as $church): ?>
                    <tr>
                        <td><?php echo htmlspecialchars($church['church_name']); ?></td>
                        <td><?php echo htmlspecialchars($church['province']); ?></td>
                        <td><?php echo htmlspecialchars($church['city']); ?></td>
                        <td><?php echo htmlspecialchars($church['address']); ?></td>
                        <td>
                            <?php if ($church['phone']): ?>
                                Tel: <?php echo htmlspecialchars($church['phone']); ?><br>
                            <?php endif; ?>
                            <?php if ($church['email']): ?>
                                Email: <?php echo htmlspecialchars($church['email']); ?>
                            <?php endif; ?>
                        </td>
                        <td>
                            <span class="status-badge approved">Aktif</span>
                            <br>
                            <small><?php echo count($neighborhoods[$church['id']] ?? []); ?> Lingkungan</small>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Add Church Tab -->
    <div id="add-church-tab" class="tab-content">
        <h3>Tambah Gereja Baru</h3>
        <form method="post" class="church-form">
            <input type="hidden" name="add_church" value="1">
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="church_name">Nama Gereja *</label>
                    <input type="text" id="church_name" name="church_name" required>
                </div>
                
                <div class="form-group">
                    <label for="province">Provinsi *</label>
                    <select id="province" name="province" required>
                        <option value="">Pilih Provinsi</option>
                        <option value="Sumatera Utara">Sumatera Utara</option>
                        <option value="DKI Jakarta">DKI Jakarta</option>
                        <option value="Jawa Barat">Jawa Barat</option>
                        <option value="Jawa Tengah">Jawa Tengah</option>
                        <option value="Jawa Timur">Jawa Timur</option>
                        <option value="Kalimantan Timur">Kalimantan Timur</option>
                        <option value="Sulawesi Utara">Sulawesi Utara</option>
                    </select>
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="city">Kota *</label>
                    <input type="text" id="city" name="city" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Telepon</label>
                    <input type="text" id="phone" name="phone">
                </div>
            </div>
            
            <div class="form-group">
                <label for="address">Alamat Lengkap</label>
                <textarea id="address" name="address" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email">
            </div>
            
            <button type="submit" class="btn btn-primary">Tambah Gereja</button>
        </form>
    </div>
    
    <!-- Neighborhoods Tab -->
    <div id="neighborhoods-tab" class="tab-content">
        <h3>Kelola Lingkungan per Gereja</h3>
        
        <?php foreach ($churches as $church): ?>
        <div class="church-section">
            <h4><?php echo htmlspecialchars($church['church_name']); ?> - <?php echo htmlspecialchars($church['city']); ?></h4>
            
            <!-- Add Neighborhood Form -->
            <form method="post" class="neighborhood-form">
                <input type="hidden" name="add_neighborhood" value="1">
                <input type="hidden" name="church_id" value="<?php echo $church['id']; ?>">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="neighborhood_name_<?php echo $church['id']; ?>">Nama Lingkungan *</label>
                        <input type="text" id="neighborhood_name_<?php echo $church['id']; ?>" name="neighborhood_name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="description_<?php echo $church['id']; ?>">Keterangan</label>
                        <input type="text" id="description_<?php echo $church['id']; ?>" name="description" placeholder="Contoh: Wilayah Pusat Kota">
                    </div>
                    
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="submit" class="btn btn-small">Tambah Lingkungan</button>
                    </div>
                </div>
            </form>
            
            <!-- Neighborhoods List -->
            <?php if (!empty($neighborhoods[$church['id']])): ?>
            <div class="neighborhoods-list">
                <h5>Daftar Lingkungan:</h5>
                <div class="neighborhood-tags">
                    <?php foreach ($neighborhoods[$church['id']] as $neighborhood): ?>
                    <span class="neighborhood-tag">
                        <?php echo htmlspecialchars($neighborhood['neighborhood_name']); ?>
                        <?php if ($neighborhood['description']): ?>
                            <small>(<?php echo htmlspecialchars($neighborhood['description']); ?>)</small>
                        <?php endif; ?>
                    </span>
                    <?php endforeach; ?>
                </div>
            </div>
            <?php endif; ?>
        </div>
        <hr>
        <?php endforeach; ?>
    </div>
</div>

<style>
.neighborhood-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.neighborhood-tag {
    background: #11998e;
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 14px;
}

.church-section {
    margin-bottom: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
}

.neighborhood-form {
    margin-bottom: 15px;
}
</style>

<script>
function openTab(evt, tabName) {
    const tabContents = document.getElementsByClassName("tab-content");
    for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove("active");
    }

    const tabButtons = document.getElementsByClassName("tab-btn");
    for (let i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove("active");
    }

    document.getElementById(tabName).classList.add("active");
    evt.currentTarget.classList.add("active");
}
</script>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\manage_users.php =====

<?php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'super') {
    header("Location: login.php");
    exit();
}

$page_title = 'Kelola Pengguna - Jemaat App';
include 'header.php';

$conn = getDB();
$message = "";

// Get churches for dropdown
$churches = $conn->query("SELECT id, church_name, province, city FROM churches ORDER BY church_name");

// Handle add user
if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST['add_user'])) {
    $username = $_POST['username'];
    $password = $_POST['password'];
    $role = $_POST['role'];
    $church_id = $_POST['church_id'];

    if (!empty($username) && !empty($password) && !empty($church_id)) {
        $hashed_password = password_hash($password, PASSWORD_DEFAULT);
        $stmt = $conn->prepare("INSERT INTO users (username, password, role, church_id) VALUES (?, ?, ?, ?)");
        if ($stmt->execute([$username, $hashed_password, $role, $church_id])) {
            // Trigger backup after successful user addition
            require_once 'backup.php';
            triggerBackup($conn, 'user_added');

            $message = "User berhasil ditambahkan.";
        } else {
            $message = "Error menambahkan user.";
        }
    } else {
        $message = "Username, password, dan gereja wajib diisi.";
    }
}

// Handle edit user
if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST['edit_user'])) {
    $id = $_POST['id'];
    $username = $_POST['username'];
    $password = $_POST['password'];
    $role = $_POST['role'];
    $church_id = $_POST['church_id'];

    if (!empty($username) && !empty($church_id)) {
        if (!empty($password)) {
            $hashed_password = password_hash($password, PASSWORD_DEFAULT);
            $stmt = $conn->prepare("UPDATE users SET username = ?, password = ?, role = ?, church_id = ? WHERE id = ?");
            $success = $stmt->execute([$username, $hashed_password, $role, $church_id, $id]);
        } else {
            $stmt = $conn->prepare("UPDATE users SET username = ?, role = ?, church_id = ? WHERE id = ?");
            $success = $stmt->execute([$username, $role, $church_id, $id]);
        }
        if ($success) {
            // Trigger backup after successful user update
            require_once 'backup.php';
            triggerBackup($conn, 'user_updated');

            $message = "User berhasil diupdate.";
        } else {
            $message = "Error mengupdate user.";
        }
    } else {
        $message = "Username dan gereja wajib diisi.";
    }
}

// Handle delete user
if (isset($_GET['delete'])) {
    $id = $_GET['delete'];
    $stmt = $conn->prepare("DELETE FROM users WHERE id = ?");
    if ($stmt->execute([$id])) {
        $message = "User berhasil dihapus.";
    } else {
        $message = "Error menghapus user.";
    }
}

$users = $conn->query("SELECT u.id, u.username, u.role, c.church_name, c.province, c.city FROM users u LEFT JOIN churches c ON u.church_id = c.id ORDER BY u.id");

$edit_user = null;
if (isset($_GET['edit'])) {
    $edit_id = $_GET['edit'];
    $stmt = $conn->prepare("SELECT u.id, u.username, u.role, u.church_id, c.church_name FROM users u LEFT JOIN churches c ON u.church_id = c.id WHERE u.id = ?");
    $stmt->execute([$edit_id]);
    $edit_user = $stmt->fetch(PDO::FETCH_ASSOC);
}

$conn = null;
?>

<div class="container">
    <div class="page-header">
        <h1>Kelola Pengguna</h1>
        <a href="dashboard.php" class="btn btn-secondary">Kembali ke Dashboard</a>
    </div>

    <?php if ($message): ?>
        <div class="alert <?php echo strpos($message, 'berhasil') !== false ? 'alert-success' : 'alert-error'; ?>">
            <?php echo $message; ?>
        </div>
    <?php endif; ?>

    <div class="card">
        <div class="card-body">
            <h2>Tambah User Baru</h2>
            <form method="post" action="">
                <input type="hidden" name="add_user" value="1">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="username">Username *</label>
                        <input type="text" id="username" name="username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password *</label>
                        <input type="password" id="password" name="password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="role">Role *</label>
                        <select id="role" name="role" class="form-control" required>
                            <option value="admin">Admin</option>
                            <option value="super">Super Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="church_id">Gereja *</label>
                        <select id="church_id" name="church_id" class="form-control" required>
                            <option value="">Pilih Gereja</option>
                            <?php while ($church = $churches->fetch(PDO::FETCH_ASSOC)): ?>
                                <option value="<?php echo $church['id']; ?>">
                                    <?php echo htmlspecialchars($church['church_name'] . ' - ' . $church['province'] . ', ' . $church['city']); ?>
                                </option>
                            <?php endwhile; ?>
                        </select>
                    </div>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">Tambah User</button>
                </div>
            </form>
        </div>
    </div>

    <?php if ($edit_user): ?>
    <div class="card">
        <div class="card-body">
            <h2>Edit User</h2>
            <form method="post" action="">
                <input type="hidden" name="edit_user" value="1">
                <input type="hidden" name="id" value="<?php echo $edit_user['id']; ?>">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="edit_username">Username *</label>
                        <input type="text" id="edit_username" name="username" value="<?php echo htmlspecialchars($edit_user['username']); ?>" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="edit_password">Password (kosongkan jika tidak diubah)</label>
                        <input type="password" id="edit_password" name="password" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="edit_role">Role *</label>
                        <select id="edit_role" name="role" class="form-control" required>
                            <option value="admin" <?php if ($edit_user['role'] == 'admin') echo 'selected'; ?>>Admin</option>
                            <option value="super" <?php if ($edit_user['role'] == 'super') echo 'selected'; ?>>Super Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit_church_id">Gereja *</label>
                        <select id="edit_church_id" name="church_id" class="form-control" required>
                            <option value="">Pilih Gereja</option>
                            <?php
                            $churches->execute(); // Reset the cursor
                            while ($church = $churches->fetch(PDO::FETCH_ASSOC)): ?>
                                <option value="<?php echo $church['id']; ?>" <?php if ($edit_user['church_id'] == $church['id']) echo 'selected'; ?>>
                                    <?php echo htmlspecialchars($church['church_name'] . ' - ' . $church['province'] . ', ' . $church['city']); ?>
                                </option>
                            <?php endwhile; ?>
                        </select>
                    </div>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">Update User</button>
                    <a href="manage_users.php" class="btn btn-secondary">Batal</a>
                </div>
            </form>
        </div>
    </div>
    <?php endif; ?>

    <div class="card">
        <div class="card-body">
            <h2>Daftar Pengguna</h2>
            <div class="table-responsive">
                <table class="compact-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Gereja</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php while ($user = $users->fetch(PDO::FETCH_ASSOC)): ?>
                        <tr>
                            <td><?php echo htmlspecialchars($user['username']); ?></td>
                            <td>
                                <span class="status-badge <?php echo $user['role'] === 'super' ? 'approved' : 'pending'; ?>">
                                    <?php echo ucfirst($user['role']); ?>
                                </span>
                            </td>
                            <td><?php echo htmlspecialchars($user['church_name'] ?? 'N/A'); ?><br>
                                <small><?php echo htmlspecialchars(($user['province'] ?? '') . ', ' . ($user['city'] ?? '')); ?></small>
                            </td>
                            <td>
                                <a href="?edit=<?php echo $user['id']; ?>" class="btn btn-small btn-info">Edit</a>
                                <a href="?delete=<?php echo $user['id']; ?>" class="btn btn-small btn-danger" onclick="return confirm('Hapus user ini?')">Hapus</a>
                            </td>
                        </tr>
                        <?php endwhile; ?>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
}

.form-control {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

.form-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    font-size: 14px;
}

.btn-primary {
    background: #11998e;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-info {
    background: #17a2b8;
    color: white;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-small {
    padding: 5px 10px;
    font-size: 12px;
}

.btn:hover {
    opacity: 0.9;
}

.table-responsive {
    overflow-x: auto;
}

.compact-table {
    width: 100%;
    border-collapse: collapse;
}

.compact-table th,
.compact-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.compact-table th {
    background: #f8f9fa;
    font-weight: 600;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.status-badge.approved {
    background: #d4edda;
    color: #155724;
}

.status-badge.pending {
    background: #fff3cd;
    color: #856404;
}

.alert {
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
}

.alert-success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
}

.alert-error {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
}

.card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    border: 1px solid #e1e5e9;
}

.card-body {
    padding: 20px;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.page-header h1 {
    margin: 0;
    color: #11998e;
}
</style>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\members.php =====

<?php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id'])) {
    header("Location: login.php");
    exit();
}

$page_title = 'Daftar Anggota Keluarga - Jemaat App';
include 'header.php';

// Fetch all families with their members
try {
    $sql = "SELECT f.*, COUNT(fm.id) as member_count 
            FROM families f 
            LEFT JOIN family_members fm ON f.id = fm.family_id 
            GROUP BY f.id 
            ORDER BY f.created_at DESC";
    $stmt = $pdo->prepare($sql);
    $stmt->execute();
    $families = $stmt->fetchAll();
} catch (PDOException $e) {
    error_log("Error fetching families: " . $e->getMessage());
    $families = [];
}

// Function to get relationship display name
function getRelationshipDisplay($relationship) {
    $relationships = [
        'bapa' => 'Bapa',
        'ibu' => 'Ibu',
        'anak' => 'Anak',
        'tanggungan' => 'Tanggungan',
        'saudara' => 'Saudara',
        'lainnya' => 'Lainnya'
    ];
    return $relationships[$relationship] ?? ucfirst($relationship);
}
?>

<div class="container">
    <div class="page-header">
        <h1>Daftar Keluarga & Anggota</h1>
        <p>Total <?php echo count($families); ?> keluarga terdaftar</p>
        <a href="add_form.php" class="btn btn-primary">Tambah Keluarga Baru</a>
    </div>

    <?php if (empty($families)): ?>
        <div class="empty-state">
            <h3>Belum ada data keluarga</h3>
            <p>Mulai dengan menambahkan keluarga pertama Anda.</p>
            <a href="add_form.php" class="btn btn-primary">Tambah Keluarga</a>
        </div>
    <?php else: ?>
        <div class="families-list">
            <?php foreach ($families as $family): ?>
                <div class="family-card">
                    <div class="family-header">
                        <h3>Keluarga <?php echo htmlspecialchars($family['register_number']); ?></h3>
                        <div class="family-meta">
                            <span class="neighborhood"><?php echo htmlspecialchars($family['neighborhood']); ?></span>
                            <span class="member-count"><?php echo $family['member_count']; ?> anggota</span>
                            <span class="date">Dibuat: <?php echo date('d/m/Y', strtotime($family['created_at'])); ?></span>
                        </div>
                    </div>

                    <div class="family-info">
                        <div class="parents-info">
                            <?php if (!empty($family['father_name'])): ?>
                                <div class="parent">
                                    <strong>Ayah:</strong> <?php echo htmlspecialchars($family['father_name']); ?>
                                </div>
                            <?php endif; ?>
                            <?php if (!empty($family['mother_name'])): ?>
                                <div class="parent">
                                    <strong>Ibu:</strong> <?php echo htmlspecialchars($family['mother_name']); ?>
                                </div>
                            <?php endif; ?>
                            <?php if (empty($family['father_name']) && empty($family['mother_name'])): ?>
                                <div class="parent">Informasi orang tua belum lengkap</div>
                            <?php endif; ?>
                        </div>

                        <div class="address">
                            <strong>Alamat:</strong> <?php echo htmlspecialchars($family['family_address']); ?>
                        </div>

                        <div class="head-of-family">
                            <strong>Kepala Keluarga:</strong> 
                            <?php 
                            $head_display = $family['head_of_family'];
                            if ($family['head_of_family'] === 'father') $head_display = $family['father_name'] ?: 'Ayah';
                            elseif ($family['head_of_family'] === 'mother') $head_display = $family['mother_name'] ?: 'Ibu';
                            echo htmlspecialchars($head_display);
                            ?>
                        </div>
                    </div>

                    <!-- Fetch and display family members -->
                    <?php
                    $members_sql = "SELECT * FROM family_members WHERE family_id = ? ORDER BY relationship, name";
                    $members_stmt = $pdo->prepare($members_sql);
                    $members_stmt->execute([$family['id']]);
                    $members = $members_stmt->fetchAll();
                    ?>

                    <?php if (!empty($members)): ?>
                        <div class="members-section">
                            <h4>Anggota Keluarga (<?php echo count($members); ?>)</h4>
                            <div class="members-grid">
                                <?php foreach ($members as $member): ?>
                                    <div class="member-card">
                                        <div class="member-name">
                                            <?php echo htmlspecialchars($member['name']); ?>
                                        </div>
                                        <div class="member-relationship">
                                            <span class="relationship-label">
                                                <?php echo getRelationshipDisplay($member['relationship']); ?>
                                            </span>
                                            <?php if ($member['gender']): ?>
                                                <span class="gender"><?php echo $member['gender']; ?></span>
                                            <?php endif; ?>
                                        </div>
                                        <?php if ($member['phone']): ?>
                                            <div class="member-phone">
                                                <strong>HP:</strong> <?php echo htmlspecialchars($member['phone']); ?>
                                            </div>
                                        <?php endif; ?>
                                        <?php if ($member['occupation']): ?>
                                            <div class="member-occupation">
                                                <strong>Pekerjaan:</strong> <?php echo htmlspecialchars($member['occupation']); ?>
                                            </div>
                                        <?php endif; ?>
                                        <?php if ($member['status'] === 'Pasif'): ?>
                                            <div class="member-status inactive">Status: <?php echo $member['status']; ?></div>
                                        <?php endif; ?>

                                        <!-- Documents -->
                                        <?php 
                                        $documents = [];
                                        if ($member['birth_certificate']) $documents[] = 'Akte Lahir';
                                        if ($member['baptism_certificate']) $documents[] = 'Sertifikat Baptis';
                                        if ($member['confirmation_certificate']) $documents[] = 'Sertifikat Sidi';
                                        if ($member['marriage_certificate']) $documents[] = 'Sertifikat Nikah';
                                        ?>
                                        <?php if (!empty($documents)): ?>
                                            <div class="member-documents">
                                                <strong>Dokumen:</strong>
                                                <?php foreach ($documents as $doc): ?>
                                                    <span class="doc-tag"><?php echo $doc; ?></span>
                                                <?php endforeach; ?>
                                            </div>
                                        <?php endif; ?>

                                        <div class="member-actions">
                                            <a href="member_detail.php?id=<?php echo $member['id']; ?>" class="btn btn-small btn-info">Detail</a>
                                            <a href="edit_member.php?id=<?php echo $member['id']; ?>" class="btn btn-small btn-secondary">Edit</a>
                                        </div>
                                    </div>
                                <?php endforeach; ?>
                            </div>
                        </div>
                    <?php endif; ?>

                    <div class="family-actions">
                        <a href="family_detail.php?id=<?php echo $family['id']; ?>" class="btn btn-info">Lihat Detail Keluarga</a>
                        <a href="edit_family.php?id=<?php echo $family['id']; ?>" class="btn btn-secondary">Edit Keluarga</a>
                        <?php if ($_SESSION['role'] === 'superadmin'): ?>
                            <button class="btn btn-danger" onclick="confirmDeleteFamily(<?php echo $family['id']; ?>)">Hapus Keluarga</button>
                        <?php endif; ?>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>
    <?php endif; ?>
</div>

<!-- JavaScript for delete confirmation -->
<script>
function confirmDeleteFamily(id) {
    if (confirm('Apakah Anda yakin ingin menghapus keluarga ini beserta semua anggotanya?')) {
        window.location.href = 'delete_family.php?id=' + id;
    }
}
</script>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\member_detail.php =====

<?php
session_start();
require_once 'config/config.php';

// Initialize multi-tenant
MultiTenant::initialize();

$page_title = 'Daftar Keluarga Jemaat';
include 'header.php';

$conn = getDB();

// Handle search functionality
$search = '';
$members = [];

if (isset($_GET['search']) && !empty($_GET['search'])) {
    $search = trim($_GET['search']);
    $search_param = "%{$search}%";

    $query = "SELECT m.*,
                     f.name as father_name_actual,
                     f.phone as father_phone_actual,
                     f.occupation as father_occupation_actual,
                     f.education as father_education_actual,
                     f.death_date as father_death_date,
                     mo.name as mother_name_actual,
                     mo.phone as mother_phone_actual,
                     mo.occupation as mother_occupation_actual,
                     mo.education as mother_education_actual,
                     mo.death_date as mother_death_date
              FROM members m
              LEFT JOIN fathers f ON m.id = f.member_id
              LEFT JOIN mothers mo ON m.id = mo.member_id
              WHERE (m.name LIKE ? OR
                     f.name LIKE ? OR
                     mo.name LIKE ? OR
                     m.address LIKE ? OR
                     m.neighborhood LIKE ? OR
                     m.register_number LIKE ? OR
                     m.phone LIKE ?)";

    $query = MultiTenant::addChurchFilter($query, 'm.church_id');
    $query .= " ORDER BY m.neighborhood, m.register_number";
    $params = array_fill(0, 7, $search_param);

    $stmt = $conn->prepare($query);
    $stmt->execute($params);
    $members = $stmt->fetchAll(PDO::FETCH_ASSOC);
} else {
    // Query default - semua data valid
    $query = "SELECT m.*,
                     f.name as father_name_actual,
                     f.phone as father_phone_actual,
                     f.occupation as father_occupation_actual,
                     f.education as father_education_actual,
                     f.death_date as father_death_date,
                     mo.name as mother_name_actual,
                     mo.phone as mother_phone_actual,
                     mo.occupation as mother_occupation_actual,
                     mo.education as mother_education_actual,
                     mo.death_date as mother_death_date
              FROM members m
              LEFT JOIN fathers f ON m.id = f.member_id
              LEFT JOIN mothers mo ON m.id = mo.member_id";

    $params = [];
    $query = MultiTenant::addChurchFilterWithParams($query, 'm.church_id', $params);
    $query .= " ORDER BY m.neighborhood, m.register_number";
    $stmt = $conn->prepare($query);
    $stmt->execute($params);
    $members = $stmt->fetchAll(PDO::FETCH_ASSOC);
}

// Function to determine head of family
function getHeadOfFamily($family) {
    $current_date = date('Y-m-d');
    
    // Check if father is alive
    $father_alive = empty($family['father_death_date']) || $family['father_death_date'] > $current_date;
    
    // Check if mother is alive  
    $mother_alive = empty($family['mother_death_date']) || $family['mother_death_date'] > $current_date;
    
    if ($father_alive && !empty($family['father_name_actual'])) {
        return [
            'name' => $family['father_name_actual'],
            'relationship' => 'Ayah',
            'is_alive' => true
        ];
    } elseif ($mother_alive && !empty($family['mother_name_actual'])) {
        return [
            'name' => $family['mother_name_actual'],
            'relationship' => 'Ibu', 
            'is_alive' => true
        ];
    } else {
        // If both parents deceased, show father as head but mark as deceased
        return [
            'name' => !empty($family['father_name_actual']) ? $family['father_name_actual'] : $family['mother_name_actual'],
            'relationship' => !empty($family['father_name_actual']) ? 'Ayah' : 'Ibu',
            'is_alive' => false
        ];
    }
}

// Group members by neighborhood
$members_by_neighborhood = [];
foreach ($members as $member) {
    $neighborhood = $member['neighborhood'];
    if (!isset($members_by_neighborhood[$neighborhood])) {
        $members_by_neighborhood[$neighborhood] = [];
    }
    $members_by_neighborhood[$neighborhood][] = $member;
}

// Define neighborhood order
$neighborhood_order = ['Efata', 'Bethania', 'Sion', 'Moria', 'Kanaan'];
?>

<style>
/* Modern Dashboard Styles */
.dashboard-header {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 30px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.dashboard-header h1 {
    margin: 0 0 10px 0;
    font-size: 2.5em;
    font-weight: 700;
}

.dashboard-header p {
    margin: 0;
    font-size: 1.2em;
    opacity: 0.9;
}

.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    border-left: 4px solid #11998e;
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-number {
    font-size: 2.5em;
    font-weight: 700;
    color: #11998e;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.9em;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Search Section */
.search-section {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    margin-bottom: 30px;
}

.search-container {
    display: flex;
    gap: 15px;
    align-items: center;
}

.search-input {
    flex: 1;
    padding: 15px 20px;
    border: 2px solid #e1e5e9;
    border-radius: 10px;
    font-size: 16px;
    transition: all 0.3s ease;
}

.search-input:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
}

.search-btn {
    background: #11998e;
    color: white;
    border: none;
    padding: 15px 25px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.search-btn:hover {
    background: #0d7d73;
    transform: translateY(-2px);
}

/* Family Grid */
.family-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.family-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid #f0f0f0;
}

.family-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
}

.family-header {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 20px;
    position: relative;
}

.family-neighborhood {
    position: relative;
    font-size: 0.9em;
    opacity: 0.9;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.family-register {
    background: rgba(255,255,255,0.2);
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: 600;
    display: inline-block;
    width: fit-content;
}

.family-name {
    font-size: 1.4em;
    font-weight: 700;
    margin-bottom: 5px;
}

.family-body {
    padding: 20px;
}

.family-info {
    margin-bottom: 20px;
}

.info-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    padding: 8px 0;
    border-bottom: 1px solid #f5f5f5;
}

.info-label {
    font-weight: 600;
    color: #555;
}

.info-value {
    color: #333;
    text-align: right;
}

.family-members {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.member-tag {
    display: inline-block;
    background: white;
    padding: 5px 10px;
    margin: 3px;
    border-radius: 20px;
    font-size: 0.8em;
    border: 1px solid #e1e5e9;
}

.member-father {
    border-left: 3px solid #11998e;
}

.member-mother {
    border-left: 3px solid #e83e8c;
}

.member-child {
    border-left: 3px solid #6f42c1;
}

/* Contributions Carousel */
.contributions-section {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    margin-top: 15px;
}

.contributions-title {
    font-size: 0.9em;
    font-weight: 600;
    margin-bottom: 10px;
    color: #555;
    text-align: center;
}

.contributions-carousel {
    position: relative;
}

.carousel-container {
    overflow: hidden;
    border-radius: 8px;
}

.carousel-track {
    display: flex;
    gap: 8px;
    transition: transform 0.3s ease;
}

.contribution-slide {
    flex: 0 0 80px;
    text-align: center;
    background: white;
    padding: 8px 5px;
    border-radius: 8px;
    border: 1px solid #e1e5e9;
    min-width: 80px;
}

.carousel-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
}

.carousel-btn {
    background: #11998e;
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.carousel-btn:hover {
    background: #0d7d73;
    transform: scale(1.1);
}

.carousel-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
}

.carousel-dots {
    display: flex;
    gap: 5px;
}

.dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #ddd;
    cursor: pointer;
    transition: all 0.3s ease;
}

.dot.active {
    background: #11998e;
}

.dot:hover {
    background: #0d7d73;
}

/* Checkbox Styles */
.checkbox-container {
    display: block;
    position: relative;
    padding-left: 35px;
    cursor: pointer;
    font-size: 22px;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.checkbox-container input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
}

.checkmark {
    position: absolute;
    top: 0;
    left: 0;
    height: 25px;
    width: 25px;
    background-color: #eee;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.checkbox-container:hover input ~ .checkmark {
    background-color: #ccc;
}

.checkbox-container input:checked ~ .checkmark {
    background-color: #11998e;
}

.checkmark:after {
    content: "";
    position: absolute;
    display: none;
    transition: all 0.2s ease;
}

.checkbox-container input:checked ~ .checkmark:after {
    display: block;
}

.checkbox-container .checkmark:after {
    left: 9px;
    top: 5px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
}

.amount-display {
    font-size: 0.7em;
    color: #11998e;
    font-weight: 600;
    margin-top: 5px;
}

/* Action Buttons */
.family-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.btn {
    flex: 1;
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    transition: all 0.3s ease;
}

.btn-primary {
    background: #11998e;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
}

.empty-state h3 {
    margin-bottom: 10px;
    color: #333;
    font-size: 1.5em;
}

/* Quick Actions */
.quick-actions {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.action-btn {
    flex: 1;
    min-width: 200px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    text-decoration: none;
    color: #333;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.action-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: #11998e;
    color: #11998e;
}

.action-icon {
    font-size: 2em;
    margin-bottom: 10px;
    display: block;
}

/* Responsive Design */
@media (max-width: 768px) {
    .family-grid {
        grid-template-columns: 1fr;
    }

    .search-container {
        flex-direction: column;
    }

    .stats-container {
        grid-template-columns: 1fr;
    }

    .quick-actions {
        flex-direction: column;
    }

    .contributions-grid {
        grid-template-columns: repeat(3, 1fr);
    }

    .dashboard-header {
        padding: 20px;
    }

    .dashboard-header h1 {
        font-size: 2em;
    }
}

/* Status Badges */
.status-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.7em;
    font-weight: 600;
    margin-left: 5px;
}

.status-alive {
    background: #d4edda;
    color: #155724;
}

.status-deceased {
    background: #f8d7da;
    color: #721c24;
}

/* Loading Animation */
.loading {
    opacity: 0.6;
    pointer-events: none;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.family-card {
    animation: fadeIn 0.5s ease;
}

/* Additional styles for head of family logic */
.head-family-deceased {
    color: #dc3545 !important;
    text-decoration: line-through;
}

.family-name.deceased {
    color: #dc3545;
}

.status-deceased {
    background: #f8d7da;
    color: #721c24;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.7em;
    font-weight: 600;
}
</style>

<div class="container">
    <!-- Backup Status Messages -->
    <?php if (isset($_GET['backup_status'])): ?>
        <div class="alert <?php echo $_GET['backup_status'] == 'success' ? 'alert-success' : 'alert-error'; ?>" style="margin-bottom: 20px; padding: 15px; border-radius: 8px; border: 1px solid <?php echo $_GET['backup_status'] == 'success' ? '#28a745' : '#dc3545'; ?>; background: <?php echo $_GET['backup_status'] == 'success' ? '#d4edda' : '#f8d7da'; ?>; color: <?php echo $_GET['backup_status'] == 'success' ? '#155724' : '#721c24'; ?>;">
            <?php if ($_GET['backup_status'] == 'success'): ?>
                ‚úÖ Backup berhasil dibuat! File backup telah disimpan di folder backups.
            <?php else: ?>
                ‚ùå Gagal membuat backup. Silakan coba lagi atau hubungi administrator.
            <?php endif; ?>
        </div>
    <?php endif; ?>

    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <h1>üìä Data Keluarga Jemaat</h1>
        <p><?php echo htmlspecialchars(MultiTenant::getCurrentChurchName()); ?> - Sistem Manajemen Data Jemaat</p>
    </div>

    <!-- Statistics -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-number"><?php echo count($members); ?></div>
            <div class="stat-label">Total Keluarga</div>
        </div>
        <div class="stat-card">
            <div class="stat-number"><?php echo count($members_by_neighborhood); ?></div>
            <div class="stat-label">Lingkungan</div>
        </div>
        <div class="stat-card">
            <div class="stat-number"><?php echo array_sum(array_map('count', $members_by_neighborhood)); ?></div>
            <div class="stat-label">Total Anggota</div>
        </div>
    </div>

    <!-- Quick Actions -->
<?php
// Handle immediate backup request
if (isset($_GET['create_backup_now'])) {
require_once 'config/config.php';
    require_once 'backup.php';

    $conn = getDB();
    $result = triggerBackup($conn, 'manual_from_dashboard');

    if ($result['success']) {
        $_SESSION['backup_message'] = "‚úÖ Backup berhasil dibuat: " . $result['filename'] . " (" . formatFileSize($result['size']) . ")";
    } else {
        $_SESSION['backup_message'] = "‚ùå Backup gagal: " . $result['error'];
    }

    echo "<script>window.location.href = 'member_detail.php';</script>";
    exit();
}

// Display backup message if exists
if (isset($_SESSION['backup_message'])) {
    $backup_message = $_SESSION['backup_message'];
    unset($_SESSION['backup_message']);
}

function formatFileSize($bytes) {
    if ($bytes >= 1073741824) {
        return number_format($bytes / 1073741824, 2) . ' GB';
    } elseif ($bytes >= 1048576) {
        return number_format($bytes / 1048576, 2) . ' MB';
    } elseif ($bytes >= 1024) {
        return number_format($bytes / 1024, 2) . ' KB';
    } else {
        return $bytes . ' bytes';
    }
}
?>

<div class="quick-actions">
        <a href="add_form.php" class="action-btn">
            <span class="action-icon">‚ûï</span>
            <strong>Tambah Keluarga Baru</strong>
            <small>Input data keluarga baru</small>
        </a>
        <a href="pending_submissions.php" class="action-btn">
            <span class="action-icon">‚è≥</span>
            <strong>Pengajuan Tertunda</strong>
            <small>Review data yang menunggu</small>
        </a>
        <a href="member_detail.php?create_backup_now=1" class="action-btn">
            <span class="action-icon">‚ö°</span>
            <strong>Backup Sekarang</strong>
            <small>Buat backup manual langsung</small>
        </a>
    </div>

<?php if (isset($backup_message)): ?>
<div class="alert <?php echo strpos($backup_message, '‚úÖ') !== false ? 'alert-success' : 'alert-error'; ?>"
     style="margin: 20px 0; padding: 15px; border-radius: 8px;">
    <?php echo $backup_message; ?>
</div>
<?php endif; ?>

    <!-- Search Section -->
    <div class="search-section">
        <form method="GET" action="">
            <div class="search-container">
                <input type="text" name="search" value="<?php echo htmlspecialchars($search); ?>"
                       placeholder="üîç Cari berdasarkan nama, alamat, lingkungan, no register..."
                       class="search-input">
                <button type="submit" class="search-btn">Cari Data</button>
                <?php if (!empty($search)): ?>
                    <a href="member_detail.php" class="btn btn-secondary" style="text-decoration: none;">
                        ‚ùå Hapus Pencarian
                    </a>
                <?php endif; ?>
            </div>
        </form>

        <?php if (!empty($search)): ?>
            <div style="text-align: center; margin-top: 15px; color: #666;">
                <p>Hasil pencarian untuk: "<strong><?php echo htmlspecialchars($search); ?></strong>"</p>
                <p>Ditemukan <?php echo count($members); ?> keluarga</p>
            </div>
        <?php endif; ?>
    </div>

    <?php if (empty($members)): ?>
        <div class="empty-state">
            <h3><?php echo !empty($search) ? 'Data tidak ditemukan' : 'Belum ada data keluarga'; ?></h3>
            <p><?php echo !empty($search) ? 'Silakan coba dengan kata kunci lain' : 'Mulai dengan menambahkan keluarga pertama'; ?></p>
            <a href="<?php echo !empty($search) ? 'member_detail.php' : 'add_form.php'; ?>"
               class="btn btn-primary" style="display: inline-block; width: auto; padding: 12px 25px;">
                <?php echo !empty($search) ? 'Tampilkan Semua Data' : 'Tambah Keluarga Pertama'; ?>
            </a>
        </div>
    <?php else: ?>
        <!-- Display data per lingkungan -->
        <?php foreach ($neighborhood_order as $neighborhood): ?>
            <?php if (isset($members_by_neighborhood[$neighborhood])): ?>
                <div class="neighborhood-section">
                    <h2 style="color: #11998e; border-bottom: 2px solid #11998e; padding-bottom: 10px; margin-bottom: 20px;">
                        Lingkungan <?php echo $neighborhood; ?>
                    </h2>

                    <div class="family-grid">
                        <?php foreach ($members_by_neighborhood[$neighborhood] as $member): ?>
                            <?php
                            // Determine head of family
                            $head_family = getHeadOfFamily($member);

                            // Fetch contributions
                            $contributions = [];
                            $stmt = $conn->prepare("SELECT year, amount FROM annual_contributions WHERE member_id = ?");
                            $stmt->execute([$member['id']]);
                            while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                                $contributions[$row['year']] = $row['amount'];
                            }

                            // Fetch children and guardians for display
                            $children = [];
                            $guardians = [];

                            // Get children
                            $stmt = $conn->prepare("SELECT name FROM children WHERE member_id = ?");
                            $stmt->execute([$member['id']]);
                            while ($child = $stmt->fetch(PDO::FETCH_ASSOC)) {
                                $children[] = $child['name'];
                            }

                            // Get guardians
                            $stmt = $conn->prepare("SELECT name FROM guardians WHERE member_id = ?");
                            $stmt->execute([$member['id']]);
                            while ($guardian = $stmt->fetch(PDO::FETCH_ASSOC)) {
                                $guardians[] = $guardian['name'];
                            }
                            ?>

                            <div class="family-card">
                                <!-- Family Header -->
                                <div class="family-header">
                                    <div class="family-name <?php echo !$head_family['is_alive'] ? 'deceased' : ''; ?>">
                                        <?php echo htmlspecialchars($head_family['name']); ?>
                                        <span class="status-badge <?php echo $head_family['is_alive'] ? 'status-alive' : 'status-deceased'; ?>">
                                            <?php echo $head_family['is_alive'] ? 'Hidup' : 'Meninggal'; ?>
                                        </span>
                                    </div>
                                    <div class="family-neighborhood">
                                        Lingkungan <?php echo htmlspecialchars($member['neighborhood']); ?>
                                        <span class="family-register">No. Register: <?php echo htmlspecialchars($member['register_number']); ?></span>
                                    </div>
                                </div>

                                <!-- Family Body -->
                                <div class="family-body">
                                    <!-- Basic Information -->
                                    <div class="family-info">
                                        <div class="info-row">
                                            <span class="info-label">Kepala Keluarga:</span>
                                            <span class="info-value <?php echo !$head_family['is_alive'] ? 'head-family-deceased' : ''; ?>">
                                                <?php echo htmlspecialchars($head_family['name']); ?> (<?php echo $head_family['relationship']; ?>)
                                                <?php if (!$head_family['is_alive']): ?>
                                                    <br><small style="color: #dc3545;">Telah Meninggal</small>
                                                <?php endif; ?>
                                            </span>
                                        </div>

                                        <div class="info-row">
                                            <span class="info-label">Alamat:</span>
                                            <span class="info-value"><?php echo htmlspecialchars($member['address']); ?></span>
                                        </div>

                                        <!-- Father's Information -->
                                        <?php if ($member['father_name_actual']): ?>
                                            <div class="info-row">
                                                <span class="info-label">Ayah:</span>
                                                <span class="info-value <?php echo (!empty($member['father_death_date']) && $member['father_death_date'] <= date('Y-m-d')) ? 'head-family-deceased' : ''; ?>">
                                                    <?php echo htmlspecialchars($member['father_name_actual']); ?>
                                                    <?php if (!empty($member['father_death_date']) && $member['father_death_date'] <= date('Y-m-d')): ?>
                                                        <span class="status-deceased">Meninggal</span>
                                                    <?php endif; ?>
                                                </span>
                                            </div>
                                        <?php endif; ?>

                                        <!-- Mother's Information -->
                                        <?php if ($member['mother_name_actual']): ?>
                                            <div class="info-row">
                                                <span class="info-label">Ibu:</span>
                                                <span class="info-value <?php echo (!empty($member['mother_death_date']) && $member['mother_death_date'] <= date('Y-m-d')) ? 'head-family-deceased' : ''; ?>">
                                                    <?php echo htmlspecialchars($member['mother_name_actual']); ?>
                                                    <?php if (!empty($member['mother_death_date']) && $member['mother_death_date'] <= date('Y-m-d')): ?>
                                                        <span class="status-deceased">Meninggal</span>
                                                    <?php endif; ?>
                                                </span>
                                            </div>
                                        <?php endif; ?>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="family-actions">
                                        <a href="item_detail.php?id=<?php echo $member['id']; ?>"
                                           class="btn btn-primary" target="_blank">
                                            üëÅÔ∏è Detail Lengkap
                                        </a>
                                        <a href="edit_member.php?id=<?php echo $member['id']; ?>"
                                           class="btn btn-secondary">
                                            ‚úèÔ∏è Edit
                                        </a>
                                    </div>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                </div>
            <?php endif; ?>
        <?php endforeach; ?>
    <?php endif; ?>
</div>

<script>
function toggleContribution(memberId, year, isChecked) {
    // Show loading state
    const container = event.target.closest('.checkbox-container');
    container.classList.add('loading');

    // Determine amount based on checkbox state
    const amount = isChecked ? 75000 : 0; // Default amount when checked

    fetch('save_contribution.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'member_id=' + memberId + '&year=' + year + '&amount=' + amount
    })
    .then(response => response.text())
    .then(data => {
        console.log('Contribution saved:', data);
        container.classList.remove('loading');

        if (data === 'Saved') {
            // Update display
            const amountDisplay = container.querySelector('.amount-display');
            if (isChecked) {
                if (!amountDisplay) {
                    const newDisplay = document.createElement('span');
                    newDisplay.className = 'amount-display';
                    newDisplay.textContent = 'Rp ' + amount.toLocaleString('id-ID');
                    container.appendChild(newDisplay);
                }
                // Success feedback
                container.style.color = '#28a745';
                setTimeout(() => {
                    container.style.color = '';
                }, 2000);
            } else {
                if (amountDisplay) {
                    amountDisplay.remove();
                }
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        container.classList.remove('loading');
        container.style.color = '#dc3545';
        setTimeout(() => {
            container.style.color = '';
        }, 2000);
    });
}

// Carousel functionality
function scrollContributions(button, direction) {
    const carousel = button.closest('.contributions-carousel');
    const track = carousel.querySelector('.carousel-track');
    const slides = track.children;
    const dots = carousel.querySelectorAll('.dot');

    // Find current active slide
    let currentIndex = 0;
    dots.forEach((dot, index) => {
        if (dot.classList.contains('active')) {
            currentIndex = index;
        }
    });

    // Calculate new index
    let newIndex = currentIndex + direction;
    if (newIndex < 0) newIndex = 0;
    if (newIndex >= slides.length) newIndex = slides.length - 1;

    // Scroll to new slide
    scrollToSlideIndex(carousel, newIndex);
}

function scrollToSlide(dot, index) {
    const carousel = dot.closest('.contributions-carousel');
    scrollToSlideIndex(carousel, index);
}

function scrollToSlideIndex(carousel, index) {
    const track = carousel.querySelector('.carousel-track');
    const dots = carousel.querySelectorAll('.dot');
    const slideWidth = 88; // 80px width + 8px gap

    // Update track position
    track.style.transform = `translateX(-${index * slideWidth}px)`;

    // Update dots
    dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
    });
}

// Auto-focus search input
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.search-input');
    if (searchInput) {
        searchInput.focus();
    }

    // Add smooth scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
});
</script>

<?php
$conn = null;
include 'footer.php';
?>


===== C:\xampp\htdocs\jemaat\migration_001_create_churches_table.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    // Create churches table
    $sql = "CREATE TABLE IF NOT EXISTS churches (
        id INT PRIMARY KEY AUTO_INCREMENT,
        church_name VARCHAR(255) NOT NULL,
        province VARCHAR(100) NOT NULL,
        city VARCHAR(100) NOT NULL,
        address TEXT,
        phone VARCHAR(20),
        email VARCHAR(255),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        is_active BOOLEAN DEFAULT TRUE,
        INDEX idx_province_city (province, city)
    )";

    $conn->exec($sql);
    echo "<div style='color: green; font-weight: bold;'>‚úÖ Migration 001: Created churches table successfully</div><br>";
    echo "<strong>Table structure:</strong><br>";
    echo "‚Ä¢ id (Primary Key)<br>";
    echo "‚Ä¢ church_name<br>";
    echo "‚Ä¢ province, city<br>";
    echo "‚Ä¢ address, phone, email<br>";
    echo "‚Ä¢ is_active flag<br><br>";
    echo "<strong>Next step:</strong> Run migration_002_create_church_neighborhoods.php";

} catch (PDOException $e) {
    echo "<div style='color: red; font-weight: bold;'>‚ùå Migration 001 failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\migration_002_create_church_neighborhoods.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    // Create church_neighborhoods table
    $sql = "CREATE TABLE IF NOT EXISTS church_neighborhoods (
        id INT PRIMARY KEY AUTO_INCREMENT,
        church_id INT NOT NULL,
        neighborhood_name VARCHAR(100) NOT NULL,
        description TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (church_id) REFERENCES churches(id) ON DELETE CASCADE,
        INDEX idx_church_id (church_id),
        UNIQUE KEY unique_church_neighborhood (church_id, neighborhood_name)
    )";

    $conn->exec($sql);
    echo "<div style='color: green; font-weight: bold;'>‚úÖ Migration 002: Created church_neighborhoods table successfully</div><br>";
    echo "<strong>Table structure:</strong><br>";
    echo "‚Ä¢ id (Primary Key)<br>";
    echo "‚Ä¢ church_id (Foreign Key to churches)<br>";
    echo "‚Ä¢ neighborhood_name<br>";
    echo "‚Ä¢ description<br>";
    echo "‚Ä¢ Unique constraint: church_id + neighborhood_name<br><br>";
    echo "<strong>Next step:</strong> Run migration_003_add_church_id_to_users.php";

} catch (PDOException $e) {
    echo "<div style='color: red; font-weight: bold;'>‚ùå Migration 002 failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\migration_003_add_church_id_to_users.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    // Add church_id column to users table
    $conn->exec("ALTER TABLE users ADD COLUMN church_id INT NULL AFTER id");
    echo "‚úÖ Added church_id column to users table<br>";

    // Add is_super_admin column
    $conn->exec("ALTER TABLE users ADD COLUMN is_super_admin BOOLEAN DEFAULT FALSE AFTER role");
    echo "‚úÖ Added is_super_admin column to users table<br>";

    // Update existing users (assign to default church)
    $conn->exec("UPDATE users SET church_id = 1 WHERE church_id IS NULL");
    echo "‚úÖ Updated existing users with default church<br>";

    // Add foreign key separately
    $conn->exec("ALTER TABLE users ADD CONSTRAINT fk_users_church
                FOREIGN KEY (church_id) REFERENCES churches(id) ON DELETE SET NULL");
    echo "‚úÖ Added foreign key constraint to users table<br>";

    echo "<div style='color: green; font-weight: bold;'>‚úÖ Migration 003: Users table updated successfully</div><br>";
    echo "<strong>Changes made:</strong><br>";
    echo "‚Ä¢ Added church_id column<br>";
    echo "‚Ä¢ Added is_super_admin column<br>";
    echo "‚Ä¢ Set existing users to church_id = 1<br>";
    echo "‚Ä¢ Added foreign key to churches table<br><br>";
    echo "<strong>Next step:</strong> Run migration_004_add_church_id_to_families.php";

} catch (PDOException $e) {
    echo "<div style='color: red; font-weight: bold;'>‚ùå Migration 003 failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\migration_003_add_church_id_to_users_safe.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    // Check if church_id column exists in users table
    $stmt = $conn->query("SHOW COLUMNS FROM users LIKE 'church_id'");
    $church_id_exists = $stmt->fetch();

    if (!$church_id_exists) {
        // Add church_id column to users table
        $conn->exec("ALTER TABLE users ADD COLUMN church_id INT NULL AFTER id");
        echo "‚úÖ Added church_id column to users table<br>";
    } else {
        echo "‚ÑπÔ∏è church_id column already exists in users table<br>";
    }

    // Check if is_super_admin column exists
    $stmt = $conn->query("SHOW COLUMNS FROM users LIKE 'is_super_admin'");
    $super_admin_exists = $stmt->fetch();

    if (!$super_admin_exists) {
        // Add is_super_admin column
        $conn->exec("ALTER TABLE users ADD COLUMN is_super_admin BOOLEAN DEFAULT FALSE AFTER role");
        echo "‚úÖ Added is_super_admin column to users table<br>";
    } else {
        echo "‚ÑπÔ∏è is_super_admin column already exists in users table<br>";
    }

    // Update existing users (assign to default church)
    $conn->exec("UPDATE users SET church_id = 1 WHERE church_id IS NULL");
    echo "‚úÖ Updated existing users with default church<br>";

    // Check if foreign key exists
    $stmt = $conn->query("
        SELECT CONSTRAINT_NAME
        FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS
        WHERE TABLE_NAME = 'users'
        AND CONSTRAINT_TYPE = 'FOREIGN KEY'
        AND CONSTRAINT_NAME = 'fk_users_church'
    ");
    $fk_exists = $stmt->fetch();

    if (!$fk_exists) {
        // Add foreign key separately
        $conn->exec("ALTER TABLE users ADD CONSTRAINT fk_users_church
                    FOREIGN KEY (church_id) REFERENCES churches(id) ON DELETE SET NULL");
        echo "‚úÖ Added foreign key constraint to users table<br>";
    } else {
        echo "‚ÑπÔ∏è Foreign key already exists in users table<br>";
    }

    echo "<div style='color: green; font-weight: bold;'>‚úÖ Migration 003: Users table updated successfully</div><br>";
    echo "<strong>Changes made:</strong><br>";
    echo "‚Ä¢ Added church_id column (if not exists)<br>";
    echo "‚Ä¢ Added is_super_admin column (if not exists)<br>";
    echo "‚Ä¢ Set existing users to church_id = 1<br>";
    echo "‚Ä¢ Added foreign key constraint (if not exists)<br><br>";
    echo "<strong>Next step:</strong> Run migration_004_add_church_id_to_families_safe.php";

} catch (PDOException $e) {
    echo "<div style='color: red; font-weight: bold;'>‚ùå Migration 003 failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\migration_004_add_church_id_to_families.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    // Add church_id to families table
    $conn->exec("ALTER TABLE families ADD COLUMN church_id INT NULL AFTER id");
    echo "‚úÖ Added church_id to families table<br>";

    // Add church_id to staging_families table
    $conn->exec("ALTER TABLE staging_families ADD COLUMN church_id INT NULL AFTER id");
    echo "‚úÖ Added church_id to staging_families table<br>";

    // Update existing data with default church
    $conn->exec("UPDATE families SET church_id = 1 WHERE church_id IS NULL");
    $conn->exec("UPDATE staging_families SET church_id = 1 WHERE church_id IS NULL");
    echo "‚úÖ Updated existing families with default church<br>";

    // Add foreign keys
    $conn->exec("ALTER TABLE families ADD CONSTRAINT fk_families_church
                FOREIGN KEY (church_id) REFERENCES churches(id) ON DELETE CASCADE");
    $conn->exec("ALTER TABLE staging_families ADD CONSTRAINT fk_staging_families_church
                FOREIGN KEY (church_id) REFERENCES churches(id) ON DELETE CASCADE");
    echo "‚úÖ Added foreign keys to families tables<br>";

    echo "<div style='color: green; font-weight: bold;'>‚úÖ Migration 004: Families tables updated successfully</div><br>";
    echo "<strong>Changes made:</strong><br>";
    echo "‚Ä¢ Added church_id to families table<br>";
    echo "‚Ä¢ Added church_id to staging_families table<br>";
    echo "‚Ä¢ Set existing families to church_id = 1<br>";
    echo "‚Ä¢ Added foreign key constraints<br><br>";
    echo "<strong>Next step:</strong> Run migration_005_create_default_data.php";

} catch (PDOException $e) {
    echo "<div style='color: red; font-weight: bold;'>‚ùå Migration 004 failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\migration_004_add_church_id_to_families_safe.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    // Check if church_id column exists in families table
    $stmt = $conn->query("SHOW COLUMNS FROM families LIKE 'church_id'");
    $church_id_exists = $stmt->fetch();

    if (!$church_id_exists) {
        // Add church_id to families table
        $conn->exec("ALTER TABLE families ADD COLUMN church_id INT NULL AFTER id");
        echo "‚úÖ Added church_id to families table<br>";
    } else {
        echo "‚ÑπÔ∏è church_id column already exists in families table<br>";
    }

    // Check if church_id column exists in staging_families table
    $stmt = $conn->query("SHOW COLUMNS FROM staging_families LIKE 'church_id'");
    $staging_church_id_exists = $stmt->fetch();

    if (!$staging_church_id_exists) {
        // Add church_id to staging_families table
        $conn->exec("ALTER TABLE staging_families ADD COLUMN church_id INT NULL AFTER id");
        echo "‚úÖ Added church_id to staging_families table<br>";
    } else {
        echo "‚ÑπÔ∏è church_id column already exists in staging_families table<br>";
    }

    // Update existing data with default church
    $conn->exec("UPDATE families SET church_id = 1 WHERE church_id IS NULL");
    $conn->exec("UPDATE staging_families SET church_id = 1 WHERE church_id IS NULL");
    echo "‚úÖ Updated existing families with default church<br>";

    // Check if foreign keys exist
    $fk_checks = [
        ['families', 'fk_families_church'],
        ['staging_families', 'fk_staging_families_church']
    ];

    foreach ($fk_checks as $fk_check) {
        $table = $fk_check[0];
        $fk_name = $fk_check[1];

        $stmt = $conn->query("
            SELECT CONSTRAINT_NAME
            FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS
            WHERE TABLE_NAME = '$table'
            AND CONSTRAINT_TYPE = 'FOREIGN KEY'
            AND CONSTRAINT_NAME = '$fk_name'
        ");
        $fk_exists = $stmt->fetch();

        if (!$fk_exists) {
            // Add foreign key
            $conn->exec("ALTER TABLE $table ADD CONSTRAINT $fk_name
                        FOREIGN KEY (church_id) REFERENCES churches(id) ON DELETE CASCADE");
            echo "‚úÖ Added foreign key constraint to $table table<br>";
        } else {
            echo "‚ÑπÔ∏è Foreign key already exists in $table table<br>";
        }
    }

    echo "<div style='color: green; font-weight: bold;'>‚úÖ Migration 004: Families tables updated successfully</div><br>";
    echo "<strong>Changes made:</strong><br>";
    echo "‚Ä¢ Added church_id to families table (if not exists)<br>";
    echo "‚Ä¢ Added church_id to staging_families table (if not exists)<br>";
    echo "‚Ä¢ Set existing families to church_id = 1<br>";
    echo "‚Ä¢ Added foreign key constraints (if not exists)<br><br>";
    echo "<strong>Next step:</strong> Run migration_005_create_default_data.php";

} catch (PDOException $e) {
    echo "<div style='color: red; font-weight: bold;'>‚ùå Migration 004 failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\migration_005_create_default_data.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    // Create default churches
    $churches = [
        ['GKPI Medan Kota', 'Sumatera Utara', 'Medan', 'Jl. Sudirman No. 123', '061-123456', 'medan@gkpi.org'],
        ['GKPI Jakarta Pusat', 'DKI Jakarta', 'Jakarta', 'Jl. Thamrin No. 45', '021-654321', 'jakarta@gkpi.org'],
        ['GKPI Bandung', 'Jawa Barat', 'Bandung', 'Jl. Asia Afrika No. 67', '022-789012', 'bandung@gkpi.org'],
        ['GKPI Surabaya', 'Jawa Timur', 'Surabaya', 'Jl. Tunjungan No. 89', '031-345678', 'surabaya@gkpi.org']
    ];

    foreach ($churches as $church) {
        $stmt = $conn->prepare("INSERT IGNORE INTO churches (church_name, province, city, address, phone, email) VALUES (?, ?, ?, ?, ?, ?)");
        $stmt->execute($church);
    }
    echo "‚úÖ Created default churches<br>";

    // Create neighborhoods for each church
    $neighborhoods = [
        [1, 'Efata', 'Wilayah Pusat Medan'],
        [1, 'Bethania', 'Wilayah Medan Selatan'],
        [1, 'Sion', 'Wilayah Medan Barat'],
        [2, 'Alfa', 'Wilayah Jakarta Pusat'],
        [2, 'Beta', 'Wilayah Jakarta Selatan'],
        [3, 'Zion', 'Wilayah Bandung Pusat'],
        [3, 'Nazareth', 'Wilayah Bandung Utara'],
        [4, 'Ebenhaezer', 'Wilayah Surabaya Pusat'],
        [4, 'Getsemani', 'Wilayah Surabaya Barat']
    ];

    foreach ($neighborhoods as $neighborhood) {
        $stmt = $conn->prepare("INSERT IGNORE INTO church_neighborhoods (church_id, neighborhood_name, description) VALUES (?, ?, ?)");
        $stmt->execute($neighborhood);
    }
    echo "‚úÖ Created default neighborhoods<br>";

    // Create bishop user
    $hashed_password = password_hash('@Gkpitumanggor1964', PASSWORD_DEFAULT);
    $stmt = $conn->prepare("INSERT IGNORE INTO users (username, password, role, nama_lengkap, is_super_admin) VALUES (?, ?, 'bishop', 'Bishop GKPI', TRUE)");
    $stmt->execute(['bishop', $hashed_password]);
    echo "‚úÖ Created bishop user<br>";

    // Update existing super users to be superadmin for church 1
    $stmt = $conn->prepare("UPDATE users SET role = 'superadmin', church_id = 1, is_super_admin = TRUE WHERE role = 'super'");
    $stmt->execute();
    echo "‚úÖ Updated existing super users<br>";

    echo "<div style='color: green; font-weight: bold;'>‚úÖ Migration 005: Default data created successfully</div><br>";
    echo "<strong>Data created:</strong><br>";
    echo "‚Ä¢ 4 churches (Medan, Jakarta, Bandung, Surabaya)<br>";
    echo "‚Ä¢ 9 neighborhoods across churches<br>";
    echo "‚Ä¢ Bishop user (username: bishop, password: @Gkpitumanggor1964)<br>";
    echo "‚Ä¢ Updated existing super users to superadmin role<br><br>";
    echo "<strong>Next step:</strong> Run verify_migration.php to check everything is working";

} catch (PDOException $e) {
    echo "<div style='color: red; font-weight: bold;'>‚ùå Migration 005 failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\migration_006_standardize_dropdown_data.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    // Standardize education data
    $education_mappings = [
        // SD variations
        "sd" => "SD/Sederajat",
        "sekolah dasar" => "SD/Sederajat",
        "elementary" => "SD/Sederajat",
        "elementary school" => "SD/Sederajat",

        // SMP variations
        "smp" => "SMP/Sederajat",
        "sltp" => "SMP/Sederajat",
        "junior high" => "SMP/Sederajat",
        "junior high school" => "SMP/Sederajat",

        // SMA variations
        "sma" => "SMA/Sederajat",
        "slta" => "SMA/Sederajat",
        "senior high" => "SMA/Sederajat",
        "senior high school" => "SMA/Sederajat",
        "smk" => "SMA/Sederajat",
        "smk" => "SMA/Sederajat",

        // Diploma variations
        "d1" => "Diploma",
        "d2" => "Diploma",
        "d3" => "Diploma",
        "diploma" => "Diploma",
        "ahli madya" => "Diploma",

        // Sarjana variations
        "s1" => "Sarjana",
        "sarjana" => "Sarjana",
        "strata 1" => "Sarjana",
        "bachelor" => "Sarjana",
        "bachelor degree" => "Sarjana",

        // Magister variations
        "s2" => "Magister",
        "magister" => "Magister",
        "strata 2" => "Magister",
        "master" => "Magister",
        "master degree" => "Magister",

        // Doktor variations
        "s3" => "Doktor",
        "doktor" => "Doktor",
        "strata 3" => "Doktor",
        "phd" => "Doktor",
        "doctor" => "Doktor",
        "doctorate" => "Doktor"
    ];

    // Update education in family_members table
    foreach ($education_mappings as $old_value => $new_value) {
        $stmt = $conn->prepare("UPDATE family_members SET education = ? WHERE LOWER(education) = ?");
        $stmt->execute([$new_value, $old_value]);
    }

    // Update education in staging_family_members table
    foreach ($education_mappings as $old_value => $new_value) {
        $stmt = $conn->prepare("UPDATE staging_family_members SET education = ? WHERE LOWER(education) = ?");
        $stmt->execute([$new_value, $old_value]);
    }

    echo "‚úÖ Education data standardized<br>";

    // Standardize occupation data
    $occupation_mappings = [
        // Medis variations
        "dokter" => "Bidang Medis/Kesehatan",
        "perawat" => "Bidang Medis/Kesehatan",
        "bidan" => "Bidang Medis/Kesehatan",
        "apoteker" => "Bidang Medis/Kesehatan",
        "medis" => "Bidang Medis/Kesehatan",
        "kesehatan" => "Bidang Medis/Kesehatan",
        "nurse" => "Bidang Medis/Kesehatan",
        "doctor" => "Bidang Medis/Kesehatan",

        // Teknologi variations
        "it" => "Teknologi & IT",
        "programmer" => "Teknologi & IT",
        "developer" => "Teknologi & IT",
        "teknisi" => "Teknologi & IT",
        "komputer" => "Teknologi & IT",
        "software" => "Teknologi & IT",
        "engineer" => "Teknologi & IT",
        "teknologi" => "Teknologi & IT",

        // Pendidikan variations
        "guru" => "Pendidikan & Pengajaran",
        "dosen" => "Pendidikan & Pengajaran",
        "pengajar" => "Pendidikan & Pengajaran",
        "pendidikan" => "Pendidikan & Pengajaran",
        "teacher" => "Pendidikan & Pengajaran",
        "lecturer" => "Pendidikan & Pengajaran",

        // Pemerintahan variations
        "pns" => "Pemerintahan",
        "pegawai negeri" => "Pemerintahan",
        "pemerintah" => "Pemerintahan",
        "bupati" => "Pemerintahan",
        "camat" => "Pemerintahan",
        "kepala desa" => "Pemerintahan",
        "lurah" => "Pemerintahan",
        "polisi" => "Pemerintahan",
        "tentara" => "Pemerintahan",
        "government" => "Pemerintahan",

        // Wiraswasta variations
        "wirausaha" => "Wiraswasta/Bisnis",
        "bisnis" => "Wiraswasta/Bisnis",
        "dagang" => "Wiraswasta/Bisnis",
        "usaha" => "Wiraswasta/Bisnis",
        "entrepreneur" => "Wiraswasta/Bisnis",
        "business" => "Wiraswasta/Bisnis",
        "trader" => "Wiraswasta/Bisnis"
    ];

    // Update occupation in family_members table
    foreach ($occupation_mappings as $old_value => $new_value) {
        $stmt = $conn->prepare("UPDATE family_members SET occupation = ? WHERE LOWER(occupation) LIKE ?");
        $stmt->execute([$new_value, '%' . $old_value . '%']);
    }

    // Update occupation in staging_family_members table
    foreach ($occupation_mappings as $old_value => $new_value) {
        $stmt = $conn->prepare("UPDATE staging_family_members SET occupation = ? WHERE LOWER(occupation) LIKE ?");
        $stmt->execute([$new_value, '%' . $old_value . '%']);
    }

    echo "‚úÖ Occupation data standardized<br>";

    // Standardize gender data
    $gender_mappings = [
        "laki-laki" => "Laki-laki",
        "laki laki" => "Laki-laki",
        "pria" => "Laki-laki",
        "male" => "Laki-laki",
        "perempuan" => "Perempuan",
        "wanita" => "Perempuan",
        "female" => "Perempuan"
    ];

    // Update gender in family_members table
    foreach ($gender_mappings as $old_value => $new_value) {
        $stmt = $conn->prepare("UPDATE family_members SET gender = ? WHERE LOWER(gender) = ?");
        $stmt->execute([$new_value, $old_value]);
    }

    // Update gender in staging_family_members table
    foreach ($gender_mappings as $old_value => $new_value) {
        $stmt = $conn->prepare("UPDATE staging_family_members SET gender = ? WHERE LOWER(gender) = ?");
        $stmt->execute([$new_value, $old_value]);
    }

    echo "‚úÖ Gender data standardized<br>";

    // Standardize relationship data
    $relationship_mappings = [
        "bapa" => "Bapa",
        "ayah" => "Bapa",
        "father" => "Bapa",
        "ibu" => "Ibu",
        "mother" => "Ibu",
        "anak" => "Anak",
        "child" => "Anak",
        "tanggungan" => "Tanggungan",
        "dependent" => "Tanggungan"
    ];

    // Update relationship in family_members table
    foreach ($relationship_mappings as $old_value => $new_value) {
        $stmt = $conn->prepare("UPDATE family_members SET relationship = ? WHERE LOWER(relationship) = ?");
        $stmt->execute([$new_value, $old_value]);
    }

    // Update relationship in staging_family_members table
    foreach ($relationship_mappings as $old_value => $new_value) {
        $stmt = $conn->prepare("UPDATE staging_family_members SET relationship = ? WHERE LOWER(relationship) = ?");
        $stmt->execute([$new_value, $old_value]);
    }

    echo "‚úÖ Relationship data standardized<br>";

    echo "<div style='color: green; font-weight: bold;'>‚úÖ Migration 006: Dropdown data standardization completed successfully</div><br>";
    echo "<strong>Changes made:</strong><br>";
    echo "‚Ä¢ Standardized education levels to predefined categories<br>";
    echo "‚Ä¢ Standardized occupation categories<br>";
    echo "‚Ä¢ Standardized gender values<br>";
    echo "‚Ä¢ Standardized relationship values<br>";
    echo "‚Ä¢ Updated both family_members and staging_family_members tables<br><br>";
    echo "<strong>Next step:</strong> Update the add_form.php to use dropdowns instead of text inputs";

} catch (PDOException $e) {
    echo "<div style='color: red; font-weight: bold;'>‚ùå Migration 006 failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\pending_submissions.php =====

<?php
session_start();
require_once 'config/config.php';

// Cek apakah user sudah login dan memiliki role super
if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'super') {
    header("Location: login.php");
    exit();
}

// Initialize multi-tenant
MultiTenant::initialize();

$page_title = 'Pengajuan Tertunda - Super View';
include 'header.php';

$user_id = $_SESSION['user_id'];
$role = $_SESSION['role'];
$message = '';
$error = '';

$pending_families = [];

try {
    $conn = getDB();

    // Query yang DIPERBAIKI untuk superadmin - tampilkan pengajuan pending dengan filter multi-tenant
    $query = "
        SELECT
            sf.*,
            COALESCE(u.username, 'Public User') as submitted_by_user,
            COUNT(sfm.id) as member_count
        FROM staging_families sf
        LEFT JOIN users u ON sf.submitted_by = u.id
        LEFT JOIN staging_family_members sfm ON sf.id = sfm.staging_family_id
        WHERE sf.status = 'pending'
        GROUP BY sf.id
        ORDER BY sf.created_at DESC
    ";

    // Apply church filtering for multi-tenant support
    $query = MultiTenant::addChurchFilter($query, 'sf.church_id');
    $pending_stmt = $conn->prepare($query);
    $pending_stmt->execute();
    $pending_families = $pending_stmt->fetchAll(PDO::FETCH_ASSOC);

    // Get members for each family
    $family_members = [];
    foreach ($pending_families as $family) {
        $members_stmt = $conn->prepare("
            SELECT * FROM staging_family_members
            WHERE staging_family_id = ?
            ORDER BY
                CASE relationship
                    WHEN 'bapa' THEN 1
                    WHEN 'ibu' THEN 2
                    WHEN 'anak' THEN 3
                    WHEN 'tanggungan' THEN 4
                    ELSE 5
                END, name
        ");
        $members_stmt->execute([$family['id']]);
        $family_members[$family['id']] = $members_stmt->fetchAll(PDO::FETCH_ASSOC);
    }

} catch (PDOException $e) {
    error_log("Error fetching submissions: " . $e->getMessage());
    $error = "Error loading submissions: " . $e->getMessage();
}
?>

<div class="container">
    <h1>Pengajuan Data Keluarga 
        <?php if ($role === 'super'): ?>
            <small>(Super View - Semua Pengajuan)</small>
        <?php else: ?>
            <small>(Admin View - Pengajuan Saya)</small>
        <?php endif; ?>
    </h1>
    <a href="dashboard.php" class="btn btn-secondary">Kembali ke Dashboard</a>

    <?php if ($message): ?>
        <div class="alert alert-success"><?php echo $message; ?></div>
    <?php endif; ?>

    <?php if ($error): ?>
        <div class="alert alert-error"><?php echo $error; ?></div>
    <?php endif; ?>

    <!-- Pending Tab - Only show pending submissions for superadmin -->
    <?php if (empty($pending_families)): ?>
        <div class="alert alert-info">
            <p>Tidak ada pengajuan yang menunggu persetujuan saat ini.</p>
        </div>
    <?php else: ?>
        <div class="table-responsive">
            <table class="compact-table">
                <thead>
                    <tr>
                        <th>No. Register</th>
                        <th>Waktu Diajukan</th>
                        <th>Kepala Keluarga</th>
                        <th>Anggota Keluarga</th>
                        <th>Diajukan Oleh</th>
                        <th>Status</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($pending_families as $family): ?>
                        <tr>
                            <td><?php echo htmlspecialchars($family['register_number']); ?></td>
                            <td><?php echo date('d/m/Y H:i', strtotime($family['created_at'])); ?></td>
                            <td>
                                <?php
                                // Tampilkan kepala keluarga dengan benar
                                if ($family['head_of_family'] === 'father' && !empty($family['father_name'])) {
                                    echo htmlspecialchars($family['father_name']) . ' (Ayah)';
                                } elseif ($family['head_of_family'] === 'mother' && !empty($family['mother_name'])) {
                                    echo htmlspecialchars($family['mother_name']) . ' (Ibu)';
                                } else {
                                    echo htmlspecialchars($family['head_of_family']);
                                }
                                ?>
                            </td>
                            <td class="family-members">
                                <?php
                                $member_count = [
                                    'ayah' => 0,
                                    'ibu' => 0,
                                    'anak' => 0,
                                    'tanggungan' => 0
                                ];

                                if (isset($family_members[$family['id']])) {
                                    foreach ($family_members[$family['id']] as $member) {
                                        $relationship = strtolower($member['relationship']);
                                        if ($relationship === 'bapa') $member_count['ayah']++;
                                        else if ($relationship === 'ibu') $member_count['ibu']++;
                                        else if ($relationship === 'anak') $member_count['anak']++;
                                        else $member_count['tanggungan']++;
                                    }

                                    if ($member_count['ayah'] > 0) echo '<span class="member-badge ayah">A</span>';
                                    if ($member_count['ibu'] > 0) echo '<span class="member-badge ibu">I</span>';
                                    if ($member_count['anak'] > 0) echo '<span class="member-badge anak">CH(' . $member_count['anak'] . ')</span>';
                                    if ($member_count['tanggungan'] > 0) echo '<span class="member-badge tanggungan">T(' . $member_count['tanggungan'] . ')</span>';
                                }
                                ?>
                            </td>
                            <td><?php echo htmlspecialchars($family['submitted_by_user']); ?></td>
                            <td><span class="status-badge pending">Menunggu</span></td>
                            <td>
                                <a href="view_family.php?id=<?php echo $family['id']; ?>" class="btn btn-small btn-secondary">Lihat</a>
                                <?php if ($role === 'super'): ?>
                                    <a href="approve_member.php?action=approve&family_id=<?php echo $family['id']; ?>" class="btn btn-small btn-success" onclick="return confirm('Yakin ingin menyetujui pengajuan ini?')">Setujui</a>
                                    <a href="approve_member.php?action=reject&family_id=<?php echo $family['id']; ?>" class="btn btn-small btn-danger" onclick="return confirm('Yakin ingin menolak pengajuan ini?')">Tolak</a>
                                <?php endif; ?>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    <?php endif; ?>
</div>

<script>
function openTab(evt, tabName) {
    // Hide all tab content
    const tabContents = document.getElementsByClassName("tab-content");
    for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove("active");
    }

    // Remove active class from all tab buttons
    const tabButtons = document.getElementsByClassName("tab-btn");
    for (let i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove("active");
    }

    // Show the selected tab content and mark the button as active
    document.getElementById(tabName).classList.add("active");
    evt.currentTarget.classList.add("active");
}

function toggleSelectAll(source, type) {
    const checkboxes = document.querySelectorAll(`.${type}-checkbox`);
    checkboxes.forEach(checkbox => checkbox.checked = source.checked);
    updateSelectedCount(type);
}

function updateSelectedCount(type) {
    const selected = document.querySelectorAll(`.${type}-checkbox:checked`).length;
    document.getElementById(`selected${type.charAt(0).toUpperCase() + type.slice(1)}Count`).textContent = selected + ' dipilih';
}

document.addEventListener('change', function(e) {
    if (e.target.classList.contains('draft-checkbox')) {
        updateSelectedCount('draft');
    }
});

// Initialize tab counts
document.addEventListener('DOMContentLoaded', function() {
    updateSelectedCount('draft');
});
</script>

<?php include 'footer.php'; ?>


===== C:\xampp\htdocs\jemaat\README.md =====

# Sistem Database Jemaat

## Deskripsi Aplikasi

Sistem Database Jemaat adalah aplikasi web berbasis PHP yang dirancang untuk mengelola data anggota jemaat gereja. Aplikasi ini menyediakan fitur lengkap untuk manajemen data keluarga, kontribusi tahunan, dan sistem backup otomatis.

## Teknologi yang Digunakan

- **Backend**: PHP 7.x+
- **Database**: MySQL/MariaDB
- **Frontend**: HTML5, CSS3, JavaScript (Vanilla)
- **Server**: Apache (via XAMPP)

## Arsitektur Aplikasi

### Struktur Direktori

```
c:/xampp/htdocs/jemaat/
‚îú‚îÄ‚îÄ index.php              # Entry point, redirect ke login
‚îú‚îÄ‚îÄ login.php              # Halaman login
‚îú‚îÄ‚îÄ logout.php             # Logout handler
‚îú‚îÄ‚îÄ member_detail.php      # Halaman utama daftar anggota
‚îú‚îÄ‚îÄ item_detail.php        # Detail anggota individual
‚îú‚îÄ‚îÄ add_form.php           # Form tambah anggota baru
‚îú‚îÄ‚îÄ add_member.php         # Handler tambah anggota
‚îú‚îÄ‚îÄ edit_member.php        # Handler edit anggota
‚îú‚îÄ‚îÄ delete_member.php      # Handler hapus anggota
‚îú‚îÄ‚îÄ save_contribution.php  # Handler simpan kontribusi
‚îú‚îÄ‚îÄ update_member_files.php # Handler upload file anggota
‚îú‚îÄ‚îÄ manage_users.php       # Manajemen pengguna (admin)
‚îú‚îÄ‚îÄ backup.php             # Class utility backup
‚îú‚îÄ‚îÄ backup_manager.php     # Interface manajemen backup
‚îú‚îÄ‚îÄ db.php                 # Koneksi database
‚îú‚îÄ‚îÄ header.php             # Template header
‚îú‚îÄ‚îÄ footer.php             # Template footer
‚îú‚îÄ‚îÄ css/style.css          # Styling utama
‚îú‚îÄ‚îÄ js/script.js           # JavaScript utilities
‚îú‚îÄ‚îÄ uploads/               # Direktori upload file
‚îú‚îÄ‚îÄ backups/               # Direktori backup database
‚îú‚îÄ‚îÄ database_fix.sql       # Script perbaikan database
‚îú‚îÄ‚îÄ add_data.sql           # Script tambah data sample
‚îú‚îÄ‚îÄ setup.php              # Script setup awal
‚îú‚îÄ‚îÄ test.php               # File testing
‚îú‚îÄ‚îÄ test_db.php            # Test koneksi database
‚îú‚îÄ‚îÄ TODO.md                # Daftar tugas pengembangan
‚îî‚îÄ‚îÄ setup_output.txt       # Log output setup
```

### Skema Database

Database utama: `jemaat_db`

#### Tabel Utama

1. **users**
   - `id` (INT, PRIMARY KEY)
   - `username` (VARCHAR)
   - `password` (VARCHAR, hashed)
   - `role` (VARCHAR: 'user', 'admin', 'super')

2. **members**
   - `id` (INT, PRIMARY KEY)
   - `name` (VARCHAR) - Nama keluarga
   - `address` (VARCHAR)
   - `neighborhood` (VARCHAR) - Lingkungan
   - `register_number` (VARCHAR) - No register
   - `father_name` (VARCHAR)
   - `mother_name` (VARCHAR)
   - `phone` (VARCHAR)
   - `occupation` (VARCHAR)
   - `education` (VARCHAR)
   - `notes` (TEXT)
   - `death_date` (DATE)
   - `status` (VARCHAR: 'Hidup'/'Meninggal')
   - `is_alive` (BOOLEAN)
   - `father_phone`, `father_education`, `father_notes`
   - `mother_phone`, `mother_education`, `mother_notes`
   - `created_by` (INT, FK to users)

3. **children**
   - `id` (INT, PRIMARY KEY)
   - `member_id` (INT, FK to members)
   - `name` (VARCHAR)
   - `gender` (VARCHAR)
   - `birth_date` (DATE)
   - `baptism_date` (DATE)
   - `phone` (VARCHAR)
   - `occupation` (VARCHAR)
   - `education` (VARCHAR)
   - `notes` (TEXT)
   - `death_date` (DATE)
   - `status` (VARCHAR)
   - `is_alive` (BOOLEAN)

4. **guardians**
   - Struktur sama dengan children, untuk tanggungan lain

5. **annual_contributions**
   - `id` (INT, PRIMARY KEY)
   - `member_id` (INT, FK to members)
   - `year` (INT)
   - `amount` (DECIMAL)

## Fitur Utama

### 1. Autentikasi Pengguna
- Login dengan username/password
- Role-based access control (user/admin/super)
- Session management

### 2. Manajemen Anggota
- **CRUD Operations**: Tambah, lihat, edit, hapus anggota
- **Struktur Keluarga**: Ayah, ibu, anak-anak, tanggungan
- **Pencarian Komprehensif**: Berdasarkan nama, alamat, HP, dll
- **Tracking Status**: Hidup/meninggal dengan tanggal kematian

### 3. Kontribusi Tahunan
- Input kontribusi per tahun per keluarga
- Tampilan tabel 5 tahun (tahun-2 sampai tahun+2)
- Update real-time via AJAX

### 4. Sistem Backup
- **Otomatis**: Trigger pada setiap perubahan data
- **Manual**: Backup sesuai permintaan
- **Restore**: Dari file backup
- **Management**: List, download, cleanup otomatis (10 backup terbaru)

### 5. Upload File
- Upload dokumen per anggota (KTP, akte, dll)
- Preview dan download file

### 6. Admin Features
- Manajemen pengguna
- Backup management
- Database maintenance

## Alur Kerja Aplikasi

1. **Login**: User login via login.php
2. **Dashboard**: Redirect ke member_detail.php (daftar anggota)
3. **Manajemen Data**:
   - Cari/filter anggota
   - Lihat detail via item_detail.php
   - Tambah/edit/hapus via form terkait
4. **Kontribusi**: Update langsung di tabel
5. **Backup**: Otomatis atau manual via backup_manager.php

## Dependencies

- PHP 7.0+
- MySQL 5.7+
- XAMPP/WAMP untuk development
- Browser modern dengan JavaScript enabled

## Dokumentasi Lengkap

### üìñ Manual Pengguna (MANUAL.md)
Manual lengkap dengan 12 bab yang mencakup:
- **Instalasi lengkap** dari nol (XAMPP, database, aplikasi)
- **Panduan phpMyAdmin** komprehensif untuk manajemen database
- **Penggunaan aplikasi** step-by-step untuk semua fitur
- **Administrasi sistem** (user management, backup)
- **Troubleshooting** dan pemecahan masalah
- **Keamanan** dan best practices
- **Maintenance** dan update procedures
- **FAQ** dan dukungan teknis

### üìã File Dokumentasi Tambahan
- `database_fix.sql` - Script setup database lengkap
- `add_data.sql` - Data sample untuk testing
- `TODO.md` - Daftar pengembangan dan fitur
- `setup.php` - Script setup awal aplikasi
- `test_db.php` - Test koneksi database

## Quick Start

1. **Install XAMPP** (Apache + MySQL + PHP)
2. **Setup Database** via phpMyAdmin (lihat Bab 1 MANUAL.md)
3. **Extract aplikasi** ke `C:\xampp\htdocs\jemaat\`
4. **Konfigurasi db.php** dengan kredensial database
5. **Akses aplikasi** di `http://localhost/jemaat/`
6. **Login default**: `superadmin` / `password`

## Pengembang

Dikembangkan untuk keperluan manajemen data jemaat gereja.

## Lisensi

Internal use only.

User Biasa
Halaman Utama (index.php): View data anggota, search, filter
Detail Anggota (member_detail.php): Lihat detail lengkap anggota
Update Kontribusi: Bisa edit kolom kontribusi di tabel utama
Tidak bisa: Tambah/Edit/Hapus anggota, Upload file, Manage users, Backup
Admin
Semua akses User Biasa +
Tambah Anggota (add_member.php): Input data anggota baru
Edit Anggota (edit_member.php): Update data anggota existing
Upload File: Upload gambar dokumen di form anggota
Manage Users (manage_users.php): Tambah/edit user biasa dan admin
Tidak bisa: Backup management, system configuration
Super Admin
Semua akses Admin +
Backup Manager (backup_manager.php): Create, download, restore backup
System Configuration: Full access ke semua fitur sistem
Manage All Users: Termasuk edit superadmin lain (dengan hati-hati)

===== C:\xampp\htdocs\jemaat\save_contribution.php =====

<?php
require_once 'config/config.php';

if (!isset($_SESSION['user_id'])) {
    echo "Unauthorized";
    exit();
}

$member_id = $_POST['member_id'];
$year = $_POST['year'];
$amount = $_POST['amount'];

$conn = getDB();

if ($amount == '') {
    // Delete if empty
    $stmt = $conn->prepare("DELETE FROM annual_contributions WHERE member_id = ? AND year = ?");
    $stmt->execute([$member_id, $year]);
} else {
    // Insert or update
    $stmt = $conn->prepare("INSERT INTO annual_contributions (member_id, year, amount) VALUES (?, ?, ?) ON DUPLICATE KEY UPDATE amount = ?");
    $stmt->execute([$member_id, $year, $amount, $amount]);
}

if ($stmt->rowCount() > 0 || $amount != '') {
    echo "Saved";

    // Trigger backup after successful contribution save
    triggerBackup($conn, 'contribution_updated');
} else {
    echo "Error";
}
?>


===== C:\xampp\htdocs\jemaat\save_monthly_contribution.php =====

<?php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id'])) {
    echo json_encode(['success' => false, 'error' => 'Unauthorized']);
    exit();
}

$member_id = $_POST['member_id'];
$year = $_POST['year'];
$month = $_POST['month'];

$conn = getDB();

try {
    // Check if contribution exists
    $stmt = $conn->prepare("SELECT * FROM monthly_contributions WHERE member_id = ? AND year = ? AND month = ?");
    $stmt->execute([$member_id, $year, $month]);
    $existing = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($existing) {
        // Toggle payment status
        $new_status = !$existing['paid'];
        $payment_date = $new_status ? date('Y-m-d') : null;

        $stmt = $conn->prepare("UPDATE monthly_contributions SET paid = ?, payment_date = ? WHERE member_id = ? AND year = ? AND month = ?");
        $stmt->execute([$new_status, $payment_date, $member_id, $year, $month]);
    } else {
        // Create new contribution record
        $stmt = $conn->prepare("INSERT INTO monthly_contributions (member_id, year, month, paid, payment_date) VALUES (?, ?, ?, TRUE, ?)");
        $stmt->execute([$member_id, $year, $month, date('Y-m-d')]);
        $new_status = true;
        $payment_date = date('Y-m-d');
    }

    echo json_encode([
        'success' => true,
        'paid' => $new_status,
        'payment_date' => $payment_date ? date('d/m', strtotime($payment_date)) : null
    ]);

} catch (Exception $e) {
    echo json_encode(['success' => false, 'error' => $e->getMessage()]);
}

$conn = null;
?>


===== C:\xampp\htdocs\jemaat\TODO.md =====

# Security Implementation TODO - PLAN APPROVED

## 1. Database Security (config/database.php)
- [x] Update database credentials to use specific user instead of root
- [x] Add prepared statement helper functions (executeQuery, fetchAll, fetchOne, insert, update)

## 2. CSRF Protection (login.php)
- [x] Add CSRF token generation in session
- [x] Add CSRF token validation in POST request
- [x] Add hidden CSRF token input to login form

## 3. Input Validation (add_member_public.php)
- [x] Add sanitizeInput function
- [x] Add validatePhoneNumber function
- [x] Add email validation
- [x] Improve file upload security with better validation

## 4. Session Management (config/session_config.php - NEW)
- [x] Create secure session configuration file
- [x] Set httponly, secure, samesite flags
- [x] Add session regeneration function

## 5. Error Handling (config/error_handler.php - NEW)
- [x] Create custom error handler
- [x] Create custom exception handler
- [x] Define environment variable

## 6. Rate Limiting (config/rate_limiter.php - NEW)
- [x] Create RateLimiter class
- [x] Implement session-based rate limiting

## 7. Logging System (config/logger.php - NEW)
- [x] Create Logger class
- [x] Implement log rotation
- [x] Add helper methods for different log levels

## 8. Main Configuration (config/config.php - NEW)
- [x] Define all application constants
- [x] Include all config files
- [x] Set up global configurations

## 9. Integration
- [x] Update main application files to use config.php (10/10 completed)
- [x] Update remaining utility/migration files to use config.php (16/24 completed)
- [ ] Test all functionality
- [ ] Ensure no breaking changes


===== C:\xampp\htdocs\jemaat\update_member_files.php =====

<?php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id'])) {
    header("Location: login.php");
    exit();
}

$user_id = $_SESSION['user_id'];
$role = $_SESSION['role'];

$id = $_POST['id'];

$conn = getDB();
$stmt = $conn->prepare("SELECT * FROM members WHERE id = ?");
$stmt->execute([$id]);
$member = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$member) {
    header("Location: member_detail.php");
    exit();
}

if ($role != 'super' && $member['created_by'] != $user_id) {
    header("Location: member_detail.php");
    exit();
}

// Handle file uploads with validation
$upload_dir = 'uploads/';
$date_prefix = date('Ymd');

$files = [
    'birth_file' => 'lahir',
    'baptism_file' => 'baptis',
    'confirmation_file' => 'sidi',
    'marriage_file' => 'menikah',
    'death_file' => 'meninggal'
];

$file_names = $member; // start with old
foreach ($files as $field => $type) {
    if (isset($_FILES[$field]) && $_FILES[$field]['error'] === UPLOAD_ERR_OK) {
        $file = $_FILES[$field];

        // Validate file size (max 5MB)
        if ($file['size'] > 5 * 1024 * 1024) {
            error_log("File too large: " . $file['name']);
            continue;
        }

        // Validate file type
        $allowed_types = [
            'image/jpeg', 'image/jpg', 'image/png', 'image/gif',
            'application/pdf'
        ];

        if (!in_array($file['type'], $allowed_types)) {
            error_log("Invalid file type: " . $file['type']);
            continue;
        }

        // Delete old file if exists
        if ($member[$field] && file_exists($upload_dir . $member[$field])) {
            unlink($upload_dir . $member[$field]);
        }

        $ext = pathinfo($file['name'], PATHINFO_EXTENSION);
        $new_name = $date_prefix . '_' . $member['register_number'] . '_' . $type . '.' . $ext;
        move_uploaded_file($file['tmp_name'], $upload_dir . $new_name);
        $file_names[$field] = $new_name;
    }
}

// Update database using PDO
$conn = getDB();
$stmt = $conn->prepare("UPDATE members SET birth_date=?, baptism_date=?, confirmation_date=?, marriage_date=?, death_date=?, birth_file=?, baptism_file=?, confirmation_file=?, marriage_file=?, death_file=? WHERE id=?");
$stmt->execute([
    $_POST['birth_date'],
    $_POST['baptism_date'],
    $_POST['confirmation_date'],
    $_POST['marriage_date'],
    $_POST['death_date'],
    $file_names['birth_file'],
    $file_names['baptism_file'],
    $file_names['confirmation_file'],
    $file_names['marriage_file'],
    $file_names['death_file'],
    $id
]);

// Trigger backup after successful file update
$backup_conn = getDB();
triggerBackup($backup_conn, 'member_files_updated');

header("Location: item_detail.php?id=$id");
exit();
?>

<?php
// Handle delete request
if (isset($_POST['delete']) && isset($_POST['type']) && isset($_POST['id'])) {
    $type = $_POST['type'];
    $id = $_POST['id'];
    $field = $type . '_file';

    $conn = getDB();
    $stmt = $conn->prepare("SELECT $field FROM members WHERE id = ?");
    $stmt->execute([$id]);
    $member = $stmt->fetch(PDO::FETCH_ASSOC);

    if ($member[$field] && file_exists('uploads/' . $member[$field])) {
        unlink('uploads/' . $member[$field]);
    }

    $stmt = $conn->prepare("UPDATE members SET $field = NULL WHERE id = ?");
    $stmt->execute([$id]);

    // Trigger backup after successful file deletion
    $backup_conn = getDB();
    triggerBackup($backup_conn, 'member_file_deleted');

    echo "Deleted";
    exit();
}
?>


===== C:\xampp\htdocs\jemaat\verify_migration.php =====

<?php
require_once 'config/config.php';

try {
    $conn = getDB();

    echo "<h3>üîç Verifying Migration...</h3>";

    // Check tables
    $tables = ['churches', 'church_neighborhoods'];
    foreach ($tables as $table) {
        $stmt = $conn->query("SHOW TABLES LIKE '$table'");
        if ($stmt->fetch()) {
            echo "<div style='color: green;'>‚úÖ Table '$table' exists</div>";
        } else {
            echo "<div style='color: red;'>‚ùå Table '$table' missing</div>";
        }
    }

    // Check columns
    $columns_to_check = [
        'users' => ['church_id', 'is_super_admin'],
        'families' => ['church_id'],
        'staging_families' => ['church_id']
    ];

    foreach ($columns_to_check as $table => $columns) {
        foreach ($columns as $column) {
            $stmt = $conn->query("SHOW COLUMNS FROM $table LIKE '$column'");
            if ($stmt->fetch()) {
                echo "<div style='color: green;'>‚úÖ Column '$table.$column' exists</div>";
            } else {
                echo "<div style='color: red;'>‚ùå Column '$table.$column' missing</div>";
            }
        }
    }

    // Check data
    $church_count = $conn->query("SELECT COUNT(*) as count FROM churches")->fetch()['count'];
    echo "<div style='color: green;'>‚úÖ Churches in database: $church_count</div>";

    $bishop_exists = $conn->query("SELECT COUNT(*) as count FROM users WHERE username = 'bishop'")->fetch()['count'];
    echo "<div style='color: green;'>‚úÖ Bishop user exists: " . ($bishop_exists ? 'Yes' : 'No') . "</div>";

    echo "<h4>üéâ Migration verification complete!</h4>";

} catch (PDOException $e) {
    echo "<div style='color: red;'>‚ùå Verification failed: " . $e->getMessage() . "</div>";
}
?>


===== C:\xampp\htdocs\jemaat\view_family.php =====

<?php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id'])) {
    header("Location: login.php");
    exit();
}

$page_title = 'Detail Keluarga - Jemaat App';
include 'header.php';

$id = $_GET['id'] ?? null;

if (!$id) {
    echo '<div class="container"><div class="alert alert-error">ID keluarga tidak ditemukan.</div></div>';
    include 'footer.php';
    exit();
}

$conn = getDB();

try {
    // Query untuk mengambil data keluarga
    $stmt = $conn->prepare("
        SELECT sf.*,
               COALESCE(u.username, 'Public User') as submitted_by_user
        FROM staging_families sf
        LEFT JOIN users u ON sf.submitted_by = u.id
        WHERE sf.id = ?
    ");
    $stmt->execute([$id]);
    $family = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$family) {
        echo '<div class="container"><div class="alert alert-error">Data keluarga tidak ditemukan.</div></div>';
        include 'footer.php';
        exit();
    }

    // Query untuk mengambil anggota keluarga
    $stmt = $conn->prepare("
        SELECT * FROM staging_family_members
        WHERE staging_family_id = ?
        ORDER BY relationship, name
    ");
    $stmt->execute([$id]);
    $family_members = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    echo '<div class="container"><div class="alert alert-error">Error: ' . $e->getMessage() . '</div></div>';
    include 'footer.php';
    exit();
}
?>

<div class="container">
    <div class="family-header">
        <h1>Detail Keluarga</h1>
        <div class="family-info">
            <div class="info-card">
                <h3>Informasi Keluarga</h3>
                <div class="info-row">
                    <strong>No. Register:</strong> <?php echo htmlspecialchars($family['register_number']); ?>
                </div>
                <div class="info-row">
                    <strong>Lingkungan:</strong> <?php echo htmlspecialchars($family['neighborhood']); ?>
                </div>
                <div class="info-row">
                    <strong>Alamat:</strong> <?php echo htmlspecialchars($family['family_address']); ?>
                </div>
                <div class="info-row">
                    <strong>Status:</strong>
                    <span class="status-badge status-<?php echo $family['status']; ?>">
                        <?php echo ucfirst($family['status']); ?>
                    </span>
                </div>
                <div class="info-row">
                    <strong>Diajukan Oleh:</strong> <?php echo htmlspecialchars($family['submitted_by_user']); ?>
                </div>
                <div class="info-row">
                    <strong>Tanggal Submit:</strong> <?php echo date('d/m/Y H:i', strtotime($family['created_at'])); ?>
                </div>
            </div>
        </div>
    </div>

    <div class="family-members">
        <h2>Anggota Keluarga (<?php echo count($family_members); ?> orang)</h2>

        <?php if (empty($family_members)): ?>
            <div class="alert alert-warning">Tidak ada data anggota keluarga.</div>
        <?php else: ?>
            <div class="members-grid">
                <?php foreach ($family_members as $member): ?>
                    <div class="member-card">
                        <div class="member-header">
                            <h4><?php echo htmlspecialchars($member['name']); ?></h4>
                            <span class="relationship-badge"><?php echo htmlspecialchars($member['relationship']); ?></span>
                        </div>

                        <div class="member-details">
                            <div class="detail-row">
                                <strong>Jenis Kelamin:</strong> <?php echo htmlspecialchars($member['gender']); ?>
                            </div>
                            <?php if ($member['birth_date']): ?>
                                <div class="detail-row">
                                    <strong>Tanggal Lahir:</strong> <?php echo date('d/m/Y', strtotime($member['birth_date'])); ?>
                                </div>
                            <?php endif; ?>
                            <?php if ($member['phone']): ?>
                                <div class="detail-row">
                                    <strong>Telepon:</strong> <?php echo htmlspecialchars($member['phone']); ?>
                                </div>
                            <?php endif; ?>
                            <?php if ($member['occupation']): ?>

.members-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.members-table th {
    background: #11998e;
    color: white;
    padding: 15px;
    text-align: left;
    font-weight: 600;
}

.members-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
}

.relationship-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: 600;
    text-transform: uppercase;
}

.badge-father {
    background: #11998e;
    color: white;
}

.badge-mother {
    background: #e83e8c;
    color: white;
}

.badge-child {
    background: #6f42c1;
    color: white;
}

.badge-dependent {
    background: #fd7e14;
    color: white;
}

.action-buttons {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    justify-content: center;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.btn-primary {
    background: #11998e;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
</style>

<div class="detail-container">
    <!-- Family Header -->
    <div class="family-header">
        <h1>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Detail Pengajuan Keluarga</h1>
        <p>No. Register: <?php echo htmlspecialchars($family['register_number']); ?></p>
    </div>

    <!-- Family Information -->
    <div class="family-info">
        <h3 style="color: #11998e; margin-bottom: 20px;">üìã Informasi Keluarga</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">No. Registrasi</div>
                <div class="info-value"><?php echo htmlspecialchars($family['register_number']); ?></div>
            </div>

            <div class="info-item">
                <div class="info-label">Lingkungan</div>
                <div class="info-value"><?php echo htmlspecialchars($family['neighborhood']); ?></div>
            </div>

            <div class="info-item">
                <div class="info-label">Alamat Keluarga</div>
                <div class="info-value"><?php echo htmlspecialchars($family['family_address']); ?></div>
            </div>

            <div class="info-item">
                <div class="info-label">Kepala Keluarga</div>
                <div class="info-value">
                    <?php 
                    if ($family['head_of_family'] === 'father' && !empty($family['father_name'])) {
                        echo htmlspecialchars($family['father_name']) . ' (Ayah)';
                    } elseif ($family['head_of_family'] === 'mother' && !empty($family['mother_name'])) {
                        echo htmlspecialchars($family['mother_name']) . ' (Ibu)';
                    } else {
                        echo htmlspecialchars($family['head_of_family']);
                    }
                    ?>
                </div>
            </div>

            <?php if (!empty($family['father_name'])): ?>
            <div class="info-item">
                <div class="info-label">Nama Ayah</div>
                <div class="info-value"><?php echo htmlspecialchars($family['father_name']); ?></div>
            </div>
            <?php endif; ?>

            <?php if (!empty($family['mother_name'])): ?>
            <div class="info-item">
                <div class="info-label">Nama Ibu</div>
                <div class="info-value"><?php echo htmlspecialchars($family['mother_name']); ?></div>
            </div>
            <?php endif; ?>

            <div class="info-item">
                <div class="info-label">Diajukan Oleh</div>
                <div class="info-value"><?php echo htmlspecialchars($family['submitted_by_user']); ?></div>
            </div>

            <div class="info-item">
                <div class="info-label">Tanggal Pengajuan</div>
                <div class="info-value"><?php echo date('d/m/Y H:i', strtotime($family['created_at'])); ?></div>
            </div>

            <?php if (!empty($family['submitter_name'])): ?>
            <div class="info-item">
                <div class="info-label">Nama Pengirim</div>
                <div class="info-value"><?php echo htmlspecialchars($family['submitter_name']); ?></div>
            </div>
            <?php endif; ?>

            <?php if (!empty($family['submitter_phone'])): ?>
            <div class="info-item">
                <div class="info-label">No. HP Pengirim</div>
                <div class="info-value"><?php echo htmlspecialchars($family['submitter_phone']); ?></div>
            </div>
            <?php endif; ?>

            <?php if (!empty($family['submitter_relation'])): ?>
            <div class="info-item">
                <div class="info-label">Hubungan dengan Keluarga</div>
                <div class="info-value"><?php echo htmlspecialchars($family['submitter_relation']); ?></div>
            </div>
            <?php endif; ?>
        </div>
    </div>

    <!-- Family Members -->
    <div class="family-info">
        <h3 style="color: #11998e; margin-bottom: 20px;">üë• Anggota Keluarga</h3>

        <?php if (!empty($family_members)): ?>
            <table class="members-table">
                <thead>
                    <tr>
                        <th>Hubungan</th>
                        <th>Nama</th>
                        <th>Jenis Kelamin</th>
                        <th>Tanggal Lahir</th>
                        <th>No. HP</th>
                        <th>Pekerjaan</th>
                        <th>Pendidikan</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($family_members as $member): ?>
                        <?php
                        $relationship_class = '';
                        $relationship_label = '';

                        switch ($member['relationship']) {
                            case 'bapa':
                                $relationship_class = 'badge-father';
                                $relationship_label = 'Ayah';
                                break;
                            case 'ibu':
                                $relationship_class = 'badge-mother';
                                $relationship_label = 'Ibu';
                                break;
                            case 'anak':
                                $relationship_class = 'badge-child';
                                $relationship_label = 'Anak';
                                break;
                            case 'tanggungan':
                                $relationship_class = 'badge-dependent';
                                $relationship_label = 'Tanggungan';
                                break;
                            default:
                                $relationship_class = 'badge-dependent';
                                $relationship_label = ucfirst($member['relationship']);
                        }
                        ?>
                        <tr>
                            <td>
                                <span class="relationship-badge <?php echo $relationship_class; ?>">
                                    <?php echo $relationship_label; ?>
                                </span>
                            </td>
                            <td><strong><?php echo htmlspecialchars($member['name']); ?></strong></td>
                            <td><?php echo htmlspecialchars($member['gender'] ?: '-'); ?></td>
                            <td><?php echo $member['birth_date'] ? date('d/m/Y', strtotime($member['birth_date'])) : '-'; ?></td>
                            <td><?php echo htmlspecialchars($member['phone'] ?: '-'); ?></td>
                            <td><?php echo htmlspecialchars($member['occupation'] ?: '-'); ?></td>
                            <td><?php echo htmlspecialchars($member['education'] ?: '-'); ?></td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        <?php else: ?>
            <div style="text-align: center; padding: 40px; color: #666;">
                <p>Tidak ada data anggota keluarga yang tercatat.</p>
            </div>
        <?php endif; ?>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="pending_submissions.php" class="btn btn-secondary">üìã Kembali ke Daftar</a>
        <?php if ($_SESSION['role'] === 'super'): ?>
            <a href="approve_member.php?action=approve&family_id=<?php echo $id; ?>" class="btn btn-success" onclick="return confirm('Yakin ingin menyetujui pengajuan ini?')">‚úÖ Setujui</a>
            <a href="approve_member.php?action=reject&family_id=<?php echo $id; ?>" class="btn btn-danger" onclick="return confirm('Yakin ingin menolak pengajuan ini?')">‚ùå Tolak</a>
        <?php endif; ?>
    </div>
</div>

<?php
$conn = null;
include 'footer.php';
?>


===== C:\xampp\htdocs\jemaat\api\get_stats.php =====

<?php
// api/get_stats.php - Get statistics for header display
header('Content-Type: application/json');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET');
header('Access-Control-Allow-Headers: Content-Type');

require_once '../config/config.php';
require_once '../config/multi_tenant.php';

// Initialize multi-tenant system
MultiTenant::initialize();

try {
    $conn = getDB();
    $church_id = isset($_SESSION['church_id']) ? $_SESSION['church_id'] : null;

    // Build queries based on user role and church
    $whereClause = "";
    $params = [];

    if ($church_id && isset($_SESSION['role']) && $_SESSION['role'] !== 'super') {
        $whereClause = "WHERE f.church_id = ?";
        $params[] = $church_id;
    }

    // Get total families count
    $familiesQuery = "SELECT COUNT(DISTINCT f.id) as count FROM families f $whereClause";
    $stmt = $conn->prepare($familiesQuery);
    $stmt->execute($params);
    $totalFamilies = $stmt->fetch(PDO::FETCH_ASSOC)['count'];

    // Get total members count
    $membersQuery = "SELECT COUNT(*) as count FROM members m
                     INNER JOIN families f ON m.family_id = f.id $whereClause";
    $stmt = $conn->prepare($membersQuery);
    $stmt->execute($params);
    $totalMembers = $stmt->fetch(PDO::FETCH_ASSOC)['count'];

    // Get active neighborhoods count
    $neighborhoodsQuery = "SELECT COUNT(DISTINCT neighborhood) as count FROM families f $whereClause";
    $stmt = $conn->prepare($neighborhoodsQuery);
    $stmt->execute($params);
    $activeNeighborhoods = $stmt->fetch(PDO::FETCH_ASSOC)['count'];

    // Return JSON response
    echo json_encode([
        'success' => true,
        'totalFamilies' => (int)$totalFamilies,
        'totalMembers' => (int)$totalMembers,
        'activeNeighborhoods' => (int)$activeNeighborhoods
    ]);

} catch (PDOException $e) {
    error_log("Stats API error: " . $e->getMessage());
    echo json_encode([
        'success' => false,
        'error' => 'Database error occurred',
        'totalFamilies' => 0,
        'totalMembers' => 0,
        'activeNeighborhoods' => 0
    ]);
} catch (Exception $e) {
    error_log("Stats API general error: " . $e->getMessage());
    echo json_encode([
        'success' => false,
        'error' => 'An error occurred',
        'totalFamilies' => 0,
        'totalMembers' => 0,
        'activeNeighborhoods' => 0
    ]);
}
?>


===== C:\xampp\htdocs\jemaat\backups\backup_log.txt =====

2025-10-06 18:17:28 | jemaat_backup_2025-10-06_18-17-27_manual_from_dashboard.sql | manual_from_dashboard
2025-10-06 19:23:28 | jemaat_backup_2025-10-06_19-23-27_manual_from_dashboard.sql | manual_from_dashboard
2025-10-07 14:12:17 | jemaat_backup_2025-10-07_14-12-16_manual_from_dashboard.sql | manual_from_dashboard


===== C:\xampp\htdocs\jemaat\config\config.php =====

<?php
/**
 * Main Application Configuration
 * Includes all configuration files and defines global constants
 */

// Define application constants
define('APP_NAME', 'Jemaat App');
define('APP_VERSION', '2.0.0');
define('APP_ENV', getenv('APP_ENV') ?: 'development');

// Define paths
define('ROOT_DIR', dirname(__DIR__));
define('CONFIG_DIR', __DIR__);
define('LOGS_DIR', ROOT_DIR . '/logs');
define('UPLOADS_DIR', ROOT_DIR . '/uploads');
define('BACKUPS_DIR', ROOT_DIR . '/backups');

// Define security constants
define('CSRF_TOKEN_LENGTH', 32);
define('SESSION_LIFETIME', 3600); // 1 hour
define('RATE_LIMIT_WINDOW', 900); // 15 minutes
define('MAX_LOGIN_ATTEMPTS', 5);
define('BLOCK_DURATION', 1800); // 30 minutes

// Define file upload constants
define('MAX_FILE_SIZE', 5 * 1024 * 1024); // 5MB
define('ALLOWED_FILE_TYPES', ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf']);
define('ALLOWED_EXTENSIONS', ['jpg', 'jpeg', 'png', 'gif', 'pdf']);

// Define database constants
define('DB_HOST', getenv('DB_HOST') ?: 'localhost');
define('DB_NAME', getenv('DB_NAME') ?: 'jemaat_db');
define('DB_USER', getenv('DB_USER') ?: 'jemaat_user');
define('DB_PASS', getenv('DB_PASS') ?: 'secure_password_2024');
define('DB_CHARSET', 'utf8mb4');

// Define email constants (for future use)
define('SMTP_HOST', getenv('SMTP_HOST') ?: 'smtp.gmail.com');
define('SMTP_PORT', getenv('SMTP_PORT') ?: 587);
define('SMTP_USER', getenv('SMTP_USER') ?: '');
define('SMTP_PASS', getenv('SMTP_PASS') ?: '');
define('FROM_EMAIL', getenv('FROM_EMAIL') ?: 'noreply@jemaatapp.com');
define('FROM_NAME', getenv('FROM_NAME') ?: 'Jemaat App');

// Include all configuration files in the correct order
require_once CONFIG_DIR . '/error_handler.php';     // Must be first for error handling
require_once CONFIG_DIR . '/session_config.php';    // Session management
require_once CONFIG_DIR . '/database.php';          // Database connection
require_once CONFIG_DIR . '/rate_limiter.php';      // Rate limiting
require_once CONFIG_DIR . '/logger.php';            // Logging system
require_once CONFIG_DIR . '/multi_tenant.php';      // Multi-tenant configuration

/**
 * Initialize application
 * This function should be called at the beginning of every PHP script
 */
function initApplication() {
    // Start secure session
    initSecureSession();

    // Log application start
    LogManager::info('Application initialized', [
        'version' => APP_VERSION,
        'environment' => APP_ENV,
        'user_agent' => $_SERVER['HTTP_USER_AGENT'] ?? 'unknown',
        'request_uri' => $_SERVER['REQUEST_URI'] ?? 'unknown'
    ]);
}

/**
 * Get application configuration
 * @return array Application configuration array
 */
function getAppConfig() {
    return [
        'name' => APP_NAME,
        'version' => APP_VERSION,
        'environment' => APP_ENV,
        'paths' => [
            'root' => ROOT_DIR,
            'config' => CONFIG_DIR,
            'logs' => LOGS_DIR,
            'uploads' => UPLOADS_DIR,
            'backups' => BACKUPS_DIR
        ],
        'security' => [
            'csrf_token_length' => CSRF_TOKEN_LENGTH,
            'session_lifetime' => SESSION_LIFETIME,
            'rate_limit_window' => RATE_LIMIT_WINDOW,
            'max_login_attempts' => MAX_LOGIN_ATTEMPTS,
            'block_duration' => BLOCK_DURATION
        ],
        'uploads' => [
            'max_file_size' => MAX_FILE_SIZE,
            'allowed_types' => ALLOWED_FILE_TYPES,
            'allowed_extensions' => ALLOWED_EXTENSIONS
        ],
        'database' => [
            'host' => DB_HOST,
            'name' => DB_NAME,
            'user' => DB_USER,
            'charset' => DB_CHARSET
        ],
        'email' => [
            'smtp_host' => SMTP_HOST,
            'smtp_port' => SMTP_PORT,
            'from_email' => FROM_EMAIL,
            'from_name' => FROM_NAME
        ]
    ];
}

/**
 * Check if application is in production mode
 * @return bool True if in production
 */
function isProduction() {
    return APP_ENV === 'production';
}

/**
 * Check if application is in development mode
 * @return bool True if in development
 */
function isDevelopment() {
    return APP_ENV === 'development';
}

/**
 * Get current timestamp in MySQL format
 * @return string Current timestamp
 */
function now() {
    return date('Y-m-d H:i:s');
}

/**
 * Generate a secure random string
 * @param int $length Length of the string
 * @return string Random string
 */
function generateSecureToken($length = 32) {
    return bin2hex(random_bytes($length / 2));
}

/**
 * Clean and validate input data
 * @param mixed $data Input data
 * @param string $type Validation type (email, url, int, float, string)
 * @return mixed Cleaned data or false on validation failure
 */
function cleanInput($data, $type = 'string') {
    switch ($type) {
        case 'email':
            $cleaned = filter_var($data, FILTER_SANITIZE_EMAIL);
            return filter_var($cleaned, FILTER_VALIDATE_EMAIL) ? $cleaned : false;

        case 'url':
            $cleaned = filter_var($data, FILTER_SANITIZE_URL);
            return filter_var($cleaned, FILTER_VALIDATE_URL) ? $cleaned : false;

        case 'int':
            $cleaned = filter_var($data, FILTER_SANITIZE_NUMBER_INT);
            return filter_var($cleaned, FILTER_VALIDATE_INT) ? (int)$cleaned : false;

        case 'float':
            $cleaned = filter_var($data, FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
            return filter_var($cleaned, FILTER_VALIDATE_FLOAT) ? (float)$cleaned : false;

        case 'string':
        default:
            return htmlspecialchars(trim($data), ENT_QUOTES, 'UTF-8');
    }
}

/**
 * Check if request is AJAX
 * @return bool True if AJAX request
 */
function isAjaxRequest() {
    return !empty($_SERVER['HTTP_X_REQUESTED_WITH']) &&
           strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) === 'xmlhttprequest';
}

/**
 * Get request method
 * @return string Request method
 */
function getRequestMethod() {
    return $_SERVER['REQUEST_METHOD'] ?? 'GET';
}

/**
 * Check if request is POST
 * @return bool True if POST request
 */
function isPostRequest() {
    return getRequestMethod() === 'POST';
}

/**
 * Check if request is GET
 * @return bool True if GET request
 */
function isGetRequest() {
    return getRequestMethod() === 'GET';
}

/**
 * Redirect to URL
 * @param string $url URL to redirect to
 * @param int $status_code HTTP status code
 */
function redirect($url, $status_code = 302) {
    if (!headers_sent()) {
        http_response_code($status_code);
        header("Location: $url");
    } else {
        echo "<script>window.location.href='$url';</script>";
    }
    exit;
}

/**
 * Display a user-friendly error message
 * @param string $message Error message
 * @param int $code HTTP status code
 */
function showError($message, $code = 500) {
    if (!headers_sent()) {
        http_response_code($code);
    }

    if (isAjaxRequest()) {
        header('Content-Type: application/json');
        echo json_encode([
            'success' => false,
            'message' => $message,
            'code' => $code
        ]);
    } else {
        echo "<!DOCTYPE html>
        <html>
        <head>
            <title>Error - " . APP_NAME . "</title>
            <style>
                body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
                .error { color: #d32f2f; }
            </style>
        </head>
        <body>
            <h1 class='error'>Error $code</h1>
            <p>$message</p>
            <p><a href='" . (isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '/') . "'>Go Back</a></p>
        </body>
        </html>";
    }
    exit;
}

/**
 * Display a success message
 * @param string $message Success message
 * @param string $redirect_url Optional redirect URL
 */
function showSuccess($message, $redirect_url = null) {
    if (isAjaxRequest()) {
        header('Content-Type: application/json');
        echo json_encode([
            'success' => true,
            'message' => $message,
            'redirect' => $redirect_url
        ]);
    } else {
        echo "<!DOCTYPE html>
        <html>
        <head>
            <title>Success - " . APP_NAME . "</title>
            <style>
                body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
                .success { color: #388e3c; }
            </style>
        </head>
        <body>
            <h1 class='success'>Success!</h1>
            <p>$message</p>";
        if ($redirect_url) {
            echo "<p>Redirecting...</p>
            <script>setTimeout(function(){ window.location.href='$redirect_url'; }, 2000);</script>";
        }
        echo "</body></html>";
    }
    exit;
}

// Initialize application on include
initApplication();
?>


===== C:\xampp\htdocs\jemaat\config\database.php =====

<?php
// Database configuration for XAMPP
$host = 'localhost';
$dbname = 'jemaat_db';
$username = 'root'; // XAMPP default user
$password = ''; // XAMPP default password (empty)

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8mb4", $username, $password, [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES => false // Use native prepared statements
    ]);
} catch (PDOException $e) {
    error_log("Database connection failed: " . $e->getMessage());
    die("Database connection failed. Please try again later.");
}

// Backward compatibility function for mysqli
function getDB() {
    global $pdo;
    return $pdo;
}

// Prepared statement helper functions
function executeQuery($sql, $params = []) {
    global $pdo;

    try {
        $stmt = $pdo->prepare($sql);
        $stmt->execute($params);
        return $stmt;
    } catch (PDOException $e) {
        error_log("SQL Error: " . $e->getMessage() . " - Query: " . $sql);
        throw new Exception("Database error occurred");
    }
}

function fetchAll($sql, $params = []) {
    $stmt = executeQuery($sql, $params);
    return $stmt->fetchAll();
}

function fetchOne($sql, $params = []) {
    $stmt = executeQuery($sql, $params);
    return $stmt->fetch();
}

function insert($table, $data) {
    global $pdo;

    $columns = implode(', ', array_keys($data));
    $placeholders = ':' . implode(', :', array_keys($data));

    $sql = "INSERT INTO $table ($columns) VALUES ($placeholders)";
    executeQuery($sql, $data);

    return $pdo->lastInsertId();
}

function update($table, $data, $where, $where_params = []) {
    $set_clause = implode(', ', array_map(function($col) {
        return "$col = :$col";
    }, array_keys($data)));

    $sql = "UPDATE $table SET $set_clause WHERE $where";
    $params = array_merge($data, $where_params);

    $stmt = executeQuery($sql, $params);
    return $stmt->rowCount();
}
?>


===== C:\xampp\htdocs\jemaat\config\error_handler.php =====

<?php
/**
 * Custom Error Handler and Exception Handler
 * Provides secure error handling and logging
 */

// Define environment - set to 'production' for live sites
define('ENVIRONMENT', getenv('APP_ENV') ?: 'development');

/**
 * Custom error handler
 */
function customErrorHandler($errno, $errstr, $errfile, $errline) {
    // Log the error
    $error_message = "Error [$errno]: $errstr in $errfile on line $errline";
    error_log($error_message);

    // In development, show errors; in production, hide them
    if (ENVIRONMENT === 'development') {
        echo "<div style='background: #ffebee; border: 1px solid #f44336; padding: 10px; margin: 10px;'>";
        echo "<strong>PHP Error:</strong> $error_message";
        echo "</div>";
    } else {
        // In production, show a generic error message
        if (!headers_sent()) {
            http_response_code(500);
        }
        echo "<div style='background: #ffebee; border: 1px solid #f44336; padding: 10px; margin: 10px; text-align: center;'>";
        echo "<strong>Terjadi kesalahan sistem.</strong> Silakan coba lagi nanti atau hubungi administrator.";
        echo "</div>";
    }

    // Don't execute PHP's internal error handler
    return true;
}

/**
 * Custom exception handler
 */
function customExceptionHandler($exception) {
    // Log the exception
    $error_message = "Uncaught Exception: " . $exception->getMessage() . " in " . $exception->getFile() . " on line " . $exception->getLine();
    error_log($error_message);

    // Log stack trace for debugging
    error_log("Stack trace: " . $exception->getTraceAsString());

    if (ENVIRONMENT === 'development') {
        echo "<div style='background: #ffebee; border: 1px solid #f44336; padding: 10px; margin: 10px;'>";
        echo "<strong>Uncaught Exception:</strong> " . htmlspecialchars($exception->getMessage()) . "<br>";
        echo "<strong>File:</strong> " . htmlspecialchars($exception->getFile()) . "<br>";
        echo "<strong>Line:</strong> " . $exception->getLine() . "<br>";
        echo "<strong>Stack Trace:</strong><pre>" . htmlspecialchars($exception->getTraceAsString()) . "</pre>";
        echo "</div>";
    } else {
        // In production, show a generic error message
        if (!headers_sent()) {
            http_response_code(500);
        }
        echo "<div style='background: #ffebee; border: 1px solid #f44336; padding: 10px; margin: 10px; text-align: center;'>";
        echo "<strong>Terjadi kesalahan sistem.</strong> Silakan coba lagi nanti atau hubungi administrator.";
        echo "</div>";
    }
}

/**
 * Custom shutdown function to catch fatal errors
 */
function customShutdownFunction() {
    $error = error_get_last();
    if ($error !== null && in_array($error['type'], [E_ERROR, E_PARSE, E_CORE_ERROR, E_COMPILE_ERROR])) {
        // Log fatal error
        $error_message = "Fatal Error: " . $error['message'] . " in " . $error['file'] . " on line " . $error['line'];
        error_log($error_message);

        if (ENVIRONMENT === 'development') {
            echo "<div style='background: #ffebee; border: 1px solid #f44336; padding: 10px; margin: 10px;'>";
            echo "<strong>Fatal Error:</strong> " . htmlspecialchars($error['message']) . "<br>";
            echo "<strong>File:</strong> " . htmlspecialchars($error['file']) . "<br>";
            echo "<strong>Line:</strong> " . $error['line'];
            echo "</div>";
        } else {
            // In production, show a generic error message
            if (!headers_sent()) {
                http_response_code(500);
            }
            echo "<div style='background: #ffebee; border: 1px solid #f44336; padding: 10px; margin: 10px; text-align: center;'>";
            echo "<strong>Terjadi kesalahan sistem.</strong> Silakan coba lagi nanti atau hubungi administrator.";
            echo "</div>";
        }
    }
}

/**
 * Secure database error handler
 */
function handleDatabaseError($e, $query = null) {
    // Log the database error with query if provided
    $error_message = "Database Error: " . $e->getMessage();
    if ($query) {
        $error_message .= " | Query: " . $query;
    }
    error_log($error_message);

    if (ENVIRONMENT === 'development') {
        throw $e; // Re-throw in development for debugging
    } else {
        // In production, throw a generic exception
        throw new Exception("Terjadi kesalahan database. Silakan coba lagi nanti.");
    }
}

/**
 * Initialize error handling
 */
function initErrorHandling() {
    // Set error reporting based on environment
    if (ENVIRONMENT === 'development') {
        error_reporting(E_ALL);
        ini_set('display_errors', 1);
    } else {
        error_reporting(E_ALL & ~E_NOTICE & ~E_DEPRECATED & ~E_STRICT);
        ini_set('display_errors', 0);
    }

    // Set custom error handlers
    set_error_handler('customErrorHandler');
    set_exception_handler('customExceptionHandler');
    register_shutdown_function('customShutdownFunction');

    // Set error log file
    ini_set('error_log', __DIR__ . '/../logs/php_errors.log');

    // Create logs directory if it doesn't exist
    $log_dir = __DIR__ . '/../logs';
    if (!file_exists($log_dir)) {
        mkdir($log_dir, 0755, true);
    }
}

// Initialize error handling
initErrorHandling();
?>


===== C:\xampp\htdocs\jemaat\config\logger.php =====

<?php
/**
 * Logging System
 * Provides structured logging with different levels and log rotation
 */

class Logger {
    const EMERGENCY = 'EMERGENCY';
    const ALERT = 'ALERT';
    const CRITICAL = 'CRITICAL';
    const ERROR = 'ERROR';
    const WARNING = 'WARNING';
    const NOTICE = 'NOTICE';
    const INFO = 'INFO';
    const DEBUG = 'DEBUG';

    private $log_file;
    private $max_file_size;
    private $max_files;
    private $log_level;

    /**
     * Constructor
     * @param string $log_file Path to log file
     * @param int $max_file_size Maximum file size in bytes (default: 10MB)
     * @param int $max_files Maximum number of log files to keep (default: 5)
     * @param string $log_level Minimum log level to record
     */
    public function __construct($log_file = null, $max_file_size = 10485760, $max_files = 5, $log_level = self::INFO) {
        if ($log_file === null) {
            $log_file = __DIR__ . '/../logs/app.log';
        }

        $this->log_file = $log_file;
        $this->max_file_size = $max_file_size;
        $this->max_files = $max_files;
        $this->log_level = $log_level;

        // Create logs directory if it doesn't exist
        $log_dir = dirname($this->log_file);
        if (!file_exists($log_dir)) {
            mkdir($log_dir, 0755, true);
        }
    }

    /**
     * Log a message
     * @param string $level Log level
     * @param string $message Log message
     * @param array $context Additional context data
     * @param string $category Log category (optional)
     */
    public function log($level, $message, $context = [], $category = 'APP') {
        // Check if this log level should be recorded
        if (!$this->shouldLog($level)) {
            return;
        }

        // Rotate log file if needed
        $this->rotateLogFile();

        // Format the log entry
        $timestamp = date('Y-m-d H:i:s');
        $ip = $this->getClientIP();
        $user_id = isset($_SESSION['user_id']) ? $_SESSION['user_id'] : 'guest';
        $request_id = $this->getRequestId();

        $log_entry = sprintf(
            "[%s] [%s] [%s] [%s] [%s] [%s] %s",
            $timestamp,
            $level,
            $category,
            $ip,
            $user_id,
            $request_id,
            $this->formatMessage($message, $context)
        );

        // Write to log file
        $this->writeToFile($log_entry);

        // Also log to PHP error log for critical errors
        if (in_array($level, [self::EMERGENCY, self::ALERT, self::CRITICAL, self::ERROR])) {
            error_log($log_entry);
        }
    }

    /**
     * Log emergency message
     */
    public function emergency($message, $context = [], $category = 'APP') {
        $this->log(self::EMERGENCY, $message, $context, $category);
    }

    /**
     * Log alert message
     */
    public function alert($message, $context = [], $category = 'APP') {
        $this->log(self::ALERT, $message, $context, $category);
    }

    /**
     * Log critical message
     */
    public function critical($message, $context = [], $category = 'APP') {
        $this->log(self::CRITICAL, $message, $context, $category);
    }

    /**
     * Log error message
     */
    public function error($message, $context = [], $category = 'APP') {
        $this->log(self::ERROR, $message, $context, $category);
    }

    /**
     * Log warning message
     */
    public function warning($message, $context = [], $category = 'APP') {
        $this->log(self::WARNING, $message, $context, $category);
    }

    /**
     * Log notice message
     */
    public function notice($message, $context = [], $category = 'APP') {
        $this->log(self::NOTICE, $message, $context, $category);
    }

    /**
     * Log info message
     */
    public function info($message, $context = [], $category = 'APP') {
        $this->log(self::INFO, $message, $context, $category);
    }

    /**
     * Log debug message
     */
    public function debug($message, $context = [], $category = 'APP') {
        $this->log(self::DEBUG, $message, $context, $category);
    }

    /**
     * Log security-related events
     */
    public function security($message, $context = []) {
        $this->log(self::WARNING, $message, $context, 'SECURITY');
    }

    /**
     * Log authentication events
     */
    public function auth($message, $context = []) {
        $this->log(self::INFO, $message, $context, 'AUTH');
    }

    /**
     * Log database events
     */
    public function database($message, $context = []) {
        $this->log(self::INFO, $message, $context, 'DATABASE');
    }

    /**
     * Check if the log level should be recorded
     */
    private function shouldLog($level) {
        $levels = [
            self::DEBUG => 0,
            self::INFO => 1,
            self::NOTICE => 2,
            self::WARNING => 3,
            self::ERROR => 4,
            self::CRITICAL => 5,
            self::ALERT => 6,
            self::EMERGENCY => 7
        ];

        return $levels[$level] >= $levels[$this->log_level];
    }

    /**
     * Format message with context
     */
    private function formatMessage($message, $context = []) {
        if (empty($context)) {
            return $message;
        }

        // Replace placeholders in message
        foreach ($context as $key => $value) {
            if (is_string($value) || is_numeric($value)) {
                $message = str_replace("{{$key}}", $value, $message);
            }
        }

        // Add context as JSON if there are remaining placeholders or additional data
        $context_str = json_encode($context, JSON_UNESCAPED_UNICODE);
        return $message . " | Context: " . $context_str;
    }

    /**
     * Write to log file
     */
    private function writeToFile($log_entry) {
        $fp = fopen($this->log_file, 'a');
        if ($fp) {
            fwrite($fp, $log_entry . PHP_EOL);
            fclose($fp);
        }
    }

    /**
     * Rotate log file if it exceeds maximum size
     */
    private function rotateLogFile() {
        if (!file_exists($this->log_file)) {
            return;
        }

        if (filesize($this->log_file) < $this->max_file_size) {
            return;
        }

        // Rotate existing files
        for ($i = $this->max_files - 1; $i >= 1; $i--) {
            $old_file = $this->log_file . '.' . $i;
            $new_file = $this->log_file . '.' . ($i + 1);

            if (file_exists($old_file)) {
                if ($i == $this->max_files - 1) {
                    unlink($old_file); // Delete oldest file
                } else {
                    rename($old_file, $new_file);
                }
            }
        }

        // Move current log file
        rename($this->log_file, $this->log_file . '.1');
    }

    /**
     * Get client IP address
     */
    private function getClientIP() {
        $ip_headers = [
            'HTTP_CF_CONNECTING_IP',
            'HTTP_CLIENT_IP',
            'HTTP_X_FORWARDED_FOR',
            'HTTP_X_FORWARDED',
            'HTTP_X_CLUSTER_CLIENT_IP',
            'HTTP_FORWARDED_FOR',
            'HTTP_FORWARDED',
            'REMOTE_ADDR'
        ];

        foreach ($ip_headers as $header) {
            if (!empty($_SERVER[$header])) {
                $ip = $_SERVER[$header];

                // Handle comma-separated IPs
                if (strpos($ip, ',') !== false) {
                    $ip = trim(explode(',', $ip)[0]);
                }

                // Validate IP
                if (filter_var($ip, FILTER_VALIDATE_IP)) {
                    return $ip;
                }
            }
        }

        return $_SERVER['REMOTE_ADDR'] ?? '127.0.0.1';
    }

    /**
     * Get or generate request ID
     */
    private function getRequestId() {
        if (!isset($_SESSION['request_id'])) {
            $_SESSION['request_id'] = uniqid('req_', true);
        }
        return $_SESSION['request_id'];
    }

    /**
     * Get log statistics
     */
    public function getStats() {
        $stats = [
            'current_size' => 0,
            'total_files' => 0,
            'oldest_entry' => null,
            'newest_entry' => null
        ];

        if (file_exists($this->log_file)) {
            $stats['current_size'] = filesize($this->log_file);
            $stats['total_files'] = 1;

            // Count rotated files
            for ($i = 1; $i <= $this->max_files; $i++) {
                if (file_exists($this->log_file . '.' . $i)) {
                    $stats['total_files']++;
                }
            }

            // Get date range from current log file
            $lines = file($this->log_file);
            if (!empty($lines)) {
                $first_line = trim($lines[0]);
                $last_line = trim(end($lines));

                if (preg_match('/\[(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\]/', $first_line, $matches)) {
                    $stats['oldest_entry'] = $matches[1];
                }

                if (preg_match('/\[(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\]/', $last_line, $matches)) {
                    $stats['newest_entry'] = $matches[1];
                }
            }
        }

        return $stats;
    }
}

/**
 * Global logger instance
 */
class LogManager {
    private static $logger;

    public static function getLogger() {
        if (self::$logger === null) {
            // Set log level based on environment
            $log_level = (getenv('APP_ENV') === 'production') ? Logger::WARNING : Logger::DEBUG;

            self::$logger = new Logger(null, 10485760, 5, $log_level); // 10MB, 5 files
        }
        return self::$logger;
    }

    public static function emergency($message, $context = []) {
        self::getLogger()->emergency($message, $context);
    }

    public static function alert($message, $context = []) {
        self::getLogger()->alert($message, $context);
    }

    public static function critical($message, $context = []) {
        self::getLogger()->critical($message, $context);
    }

    public static function error($message, $context = []) {
        self::getLogger()->error($message, $context);
    }

    public static function warning($message, $context = []) {
        self::getLogger()->warning($message, $context);
    }

    public static function notice($message, $context = []) {
        self::getLogger()->notice($message, $context);
    }

    public static function info($message, $context = []) {
        self::getLogger()->info($message, $context);
    }

    public static function debug($message, $context = []) {
        self::getLogger()->debug($message, $context);
    }

    public static function security($message, $context = []) {
        self::getLogger()->security($message, $context);
    }

    public static function auth($message, $context = []) {
        self::getLogger()->auth($message, $context);
    }

    public static function database($message, $context = []) {
        self::getLogger()->database($message, $context);
    }
}

// Initialize global logger
$logger = LogManager::getLogger();
?>


===== C:\xampp\htdocs\jemaat\config\multi_tenant.php =====

<?php
// config/multi_tenant.php

class MultiTenant {
    private static $current_church = null;
    
    public static function initialize() {
        if (isset($_SESSION['church_id'])) {
            self::$current_church = $_SESSION['church_id'];
        }
    }
    
    public static function getCurrentChurch() {
        return self::$current_church;
    }
    
    public static function setCurrentChurch($church_id) {
        $_SESSION['church_id'] = $church_id;
        self::$current_church = $church_id;
    }
    
    public static function checkChurchAccess($church_id) {
        if ($_SESSION['role'] === 'super') {
            return true; // Super admin bisa akses semua
        }
        return self::$current_church == $church_id;
    }
    
    public static function getCurrentChurchName() {
        if (!self::$current_church) {
            return 'Jemaat App';
        }

        // Get church name from database (using churches table)
        try {
            $conn = getDB();
            $stmt = $conn->prepare("SELECT church_name FROM churches WHERE id = ?");
            $stmt->execute([self::$current_church]);
            $church = $stmt->fetch(PDO::FETCH_ASSOC);

            return $church ? $church['church_name'] : 'Jemaat App';
        } catch (Exception $e) {
            return 'Jemaat App';
        }
    }

    // Helper function untuk query dengan filter tenant
    public static function addChurchFilter($query, $tenant_field = 'tenant_id') {
        if ($_SESSION['role'] !== 'super' && self::$current_church) {
            if (stripos($query, 'WHERE') !== false) {
                $query .= " AND $tenant_field = " . self::$current_church;
            } else {
                $query .= " WHERE $tenant_field = " . self::$current_church;
            }
        }
        return $query;
    }

    // NEW METHOD: Add church filter with parameters array
    public static function addChurchFilterWithParams($query, $tenant_field = 'tenant_id', &$params = []) {
        if ($_SESSION['role'] !== 'super' && self::$current_church) {
            if (stripos($query, 'WHERE') !== false) {
                $query .= " AND $tenant_field = ?";
            } else {
                $query .= " WHERE $tenant_field = ?";
            }
            $params[] = self::$current_church;
        }
        return $query;
    }

    // NEW METHOD: Add church filter for prepared statements
    public static function addChurchCondition($conditions = [], $tenant_field = 'tenant_id') {
        if ($_SESSION['role'] !== 'super' && self::$current_church) {
            $conditions[] = "$tenant_field = ?";
        }
        return $conditions;
    }

    // NEW METHOD: Get church parameters for prepared statements
    public static function getChurchParams($params = [], $tenant_field = 'tenant_id') {
        if ($_SESSION['role'] !== 'super' && self::$current_church) {
            $params[] = self::$current_church;
        }
        return $params;
    }
}
?>


===== C:\xampp\htdocs\jemaat\config\rate_limiter.php =====

<?php
/**
 * Rate Limiting System
 * Implements session-based rate limiting to prevent abuse
 */

class RateLimiter {
    private $max_attempts;
    private $window_seconds;
    private $block_duration;

    /**
     * Constructor
     * @param int $max_attempts Maximum attempts allowed in the time window
     * @param int $window_seconds Time window in seconds
     * @param int $block_duration Block duration in seconds after exceeding limit
     */
    public function __construct($max_attempts = 5, $window_seconds = 900, $block_duration = 1800) {
        $this->max_attempts = $max_attempts;
        $this->window_seconds = $window_seconds;
        $this->block_duration = $block_duration;
    }

    /**
     * Check if the action is allowed
     * @param string $action_key Unique key for the action (e.g., 'login', 'form_submit')
     * @param string $identifier Unique identifier (e.g., IP address, user ID)
     * @return bool True if allowed, false if rate limited
     */
    public function isAllowed($action_key, $identifier = null) {
        // Use IP address as default identifier if not provided
        if ($identifier === null) {
            $identifier = $this->getClientIP();
        }

        $session_key = "rate_limit_{$action_key}_{$identifier}";
        $block_key = "rate_limit_block_{$action_key}_{$identifier}";

        // Check if currently blocked
        if (isset($_SESSION[$block_key])) {
            $block_time = $_SESSION[$block_key];
            if (time() - $block_time < $this->block_duration) {
                return false; // Still blocked
            } else {
                // Block expired, remove it
                unset($_SESSION[$block_key]);
            }
        }

        // Initialize or get current attempts
        if (!isset($_SESSION[$session_key])) {
            $_SESSION[$session_key] = [
                'attempts' => 0,
                'window_start' => time()
            ];
        }

        $data = $_SESSION[$session_key];

        // Check if we need to reset the window
        if (time() - $data['window_start'] > $this->window_seconds) {
            $data = [
                'attempts' => 0,
                'window_start' => time()
            ];
        }

        // Check if limit exceeded
        if ($data['attempts'] >= $this->max_attempts) {
            // Block the action
            $_SESSION[$block_key] = time();
            return false;
        }

        return true;
    }

    /**
     * Record an attempt
     * @param string $action_key Unique key for the action
     * @param string $identifier Unique identifier
     */
    public function recordAttempt($action_key, $identifier = null) {
        if ($identifier === null) {
            $identifier = $this->getClientIP();
        }

        $session_key = "rate_limit_{$action_key}_{$identifier}";

        if (!isset($_SESSION[$session_key])) {
            $_SESSION[$session_key] = [
                'attempts' => 0,
                'window_start' => time()
            ];
        }

        $data = $_SESSION[$session_key];

        // Reset window if needed
        if (time() - $data['window_start'] > $this->window_seconds) {
            $data = [
                'attempts' => 0,
                'window_start' => time()
            ];
        }

        // Increment attempts
        $data['attempts']++;
        $_SESSION[$session_key] = $data;
    }

    /**
     * Get remaining attempts
     * @param string $action_key Unique key for the action
     * @param string $identifier Unique identifier
     * @return int Number of remaining attempts
     */
    public function getRemainingAttempts($action_key, $identifier = null) {
        if ($identifier === null) {
            $identifier = $this->getClientIP();
        }

        $session_key = "rate_limit_{$action_key}_{$identifier}";
        $block_key = "rate_limit_block_{$action_key}_{$identifier}";

        // Check if blocked
        if (isset($_SESSION[$block_key])) {
            $block_time = $_SESSION[$block_key];
            if (time() - $block_time < $this->block_duration) {
                return 0; // Blocked
            }
        }

        if (!isset($_SESSION[$session_key])) {
            return $this->max_attempts;
        }

        $data = $_SESSION[$session_key];

        // Reset window if needed
        if (time() - $data['window_start'] > $this->window_seconds) {
            return $this->max_attempts;
        }

        return max(0, $this->max_attempts - $data['attempts']);
    }

    /**
     * Get time until unblock
     * @param string $action_key Unique key for the action
     * @param string $identifier Unique identifier
     * @return int Seconds until unblock, 0 if not blocked
     */
    public function getTimeUntilUnblock($action_key, $identifier = null) {
        if ($identifier === null) {
            $identifier = $this->getClientIP();
        }

        $block_key = "rate_limit_block_{$action_key}_{$identifier}";

        if (!isset($_SESSION[$block_key])) {
            return 0;
        }

        $block_time = $_SESSION[$block_key];
        $elapsed = time() - $block_time;

        if ($elapsed >= $this->block_duration) {
            return 0; // No longer blocked
        }

        return $this->block_duration - $elapsed;
    }

    /**
     * Get client IP address
     * @return string Client IP address
     */
    private function getClientIP() {
        $ip_headers = [
            'HTTP_CF_CONNECTING_IP',
            'HTTP_CLIENT_IP',
            'HTTP_X_FORWARDED_FOR',
            'HTTP_X_FORWARDED',
            'HTTP_X_CLUSTER_CLIENT_IP',
            'HTTP_FORWARDED_FOR',
            'HTTP_FORWARDED',
            'REMOTE_ADDR'
        ];

        foreach ($ip_headers as $header) {
            if (!empty($_SERVER[$header])) {
                $ip = $_SERVER[$header];

                // Handle comma-separated IPs (like X-Forwarded-For)
                if (strpos($ip, ',') !== false) {
                    $ip = trim(explode(',', $ip)[0]);
                }

                // Validate IP
                if (filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) {
                    return $ip;
                }
            }
        }

        return $_SERVER['REMOTE_ADDR'] ?? '127.0.0.1';
    }

    /**
     * Clear rate limit data for testing or manual reset
     * @param string $action_key Unique key for the action
     * @param string $identifier Unique identifier
     */
    public function clearLimit($action_key, $identifier = null) {
        if ($identifier === null) {
            $identifier = $this->getClientIP();
        }

        $session_key = "rate_limit_{$action_key}_{$identifier}";
        $block_key = "rate_limit_block_{$action_key}_{$identifier}";

        unset($_SESSION[$session_key]);
        unset($_SESSION[$block_key]);
    }
}

/**
 * Global rate limiter instances for common actions
 */
class RateLimitManager {
    private static $login_limiter;
    private static $form_limiter;
    private static $api_limiter;

    public static function getLoginLimiter() {
        if (self::$login_limiter === null) {
            // 5 attempts per 15 minutes, block for 30 minutes
            self::$login_limiter = new RateLimiter(5, 900, 1800);
        }
        return self::$login_limiter;
    }

    public static function getFormLimiter() {
        if (self::$form_limiter === null) {
            // 3 form submissions per hour, block for 1 hour
            self::$form_limiter = new RateLimiter(3, 3600, 3600);
        }
        return self::$form_limiter;
    }

    public static function getApiLimiter() {
        if (self::$api_limiter === null) {
            // 100 API calls per hour, block for 1 hour
            self::$api_limiter = new RateLimiter(100, 3600, 3600);
        }
        return self::$api_limiter;
    }
}

/**
 * Helper function to check and record rate limit
 * @param string $action Action key
 * @param string $identifier Optional identifier
 * @return array ['allowed' => bool, 'remaining' => int, 'wait_time' => int]
 */
function checkRateLimit($action, $identifier = null) {
    $limiter = null;

    switch ($action) {
        case 'login':
            $limiter = RateLimitManager::getLoginLimiter();
            break;
        case 'form_submit':
            $limiter = RateLimitManager::getFormLimiter();
            break;
        case 'api':
            $limiter = RateLimitManager::getApiLimiter();
            break;
        default:
            // Default limiter: 10 attempts per minute, block for 5 minutes
            $limiter = new RateLimiter(10, 60, 300);
    }

    $allowed = $limiter->isAllowed($action, $identifier);

    if ($allowed) {
        $limiter->recordAttempt($action, $identifier);
    }

    return [
        'allowed' => $allowed,
        'remaining' => $limiter->getRemainingAttempts($action, $identifier),
        'wait_time' => $limiter->getTimeUntilUnblock($action, $identifier)
    ];
}
?>


===== C:\xampp\htdocs\jemaat\config\session_config.php =====

<?php
/**
 * Secure Session Configuration
 * Implements secure session management with proper flags and regeneration
 */

// Start session with secure configuration
function initSecureSession() {
    // Only set session cookie parameters if session is not already active
    if (session_status() == PHP_SESSION_NONE) {
        // Set session cookie parameters before starting session
        $sessionParams = [
            'lifetime' => 3600, // 1 hour
            'path' => '/',
            'domain' => $_SERVER['HTTP_HOST'] ?? 'localhost', // Fallback for CLI
            'secure' => isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on', // Only send over HTTPS
            'httponly' => true, // Prevent JavaScript access
            'samesite' => 'Strict' // Strict same-site policy
        ];

        session_set_cookie_params($sessionParams);
        session_start();
    }

    // Regenerate session ID periodically for security
    if (!isset($_SESSION['last_regeneration'])) {
        $_SESSION['last_regeneration'] = time();
    } elseif (time() - $_SESSION['last_regeneration'] > 300) { // Regenerate every 5 minutes
        session_regenerate_id(true);
        $_SESSION['last_regeneration'] = time();
    }

    // Set session timeout (30 minutes of inactivity)
    if (isset($_SESSION['last_activity']) && (time() - $_SESSION['last_activity'] > 1800)) {
        session_unset();
        session_destroy();
        session_start();
    }
    $_SESSION['last_activity'] = time();
}

/**
 * Regenerate session ID securely
 */
function regenerateSession() {
    session_regenerate_id(true);
    $_SESSION['last_regeneration'] = time();
}

/**
 * Check if user is logged in
 */
function isLoggedIn() {
    return isset($_SESSION['user_id']) && !empty($_SESSION['user_id']);
}

/**
 * Get current user ID
 */
function getCurrentUserId() {
    return $_SESSION['user_id'] ?? null;
}

/**
 * Get current user role
 */
function getCurrentUserRole() {
    return $_SESSION['role'] ?? null;
}

/**
 * Secure logout function
 */
function secureLogout() {
    // Clear all session variables
    $_SESSION = [];

    // Destroy session cookie
    if (isset($_COOKIE[session_name()])) {
        setcookie(session_name(), '', time() - 3600, '/');
    }

    // Destroy session
    session_destroy();
}

/**
 * Check session validity
 */
function validateSession() {
    if (!isLoggedIn()) {
        return false;
    }

    // Check if session has expired
    if (isset($_SESSION['last_activity']) && (time() - $_SESSION['last_activity'] > 1800)) {
        secureLogout();
        return false;
    }

    return true;
}

// Initialize secure session
initSecureSession();
?>


===== C:\xampp\htdocs\jemaat\css\manage_users.css =====

/* Manage Users Page Styles */

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    margin: 0;
    padding: 0;
    min-height: 100vh;
}

.container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 30px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    border: 1px solid rgba(255,255,255,0.2);
}

h1 {
    color: #333;
    text-align: center;
    margin-bottom: 40px;
    font-size: 32px;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: relative;
}

h1::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
}

.back-link {
    display: inline-block;
    margin-bottom: 30px;
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
    padding: 10px 20px;
    border: 2px solid #667eea;
    border-radius: 25px;
    transition: all 0.3s ease;
    background: rgba(102, 126, 234, 0.1);
}

.back-link:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
}

.message {
    padding: 15px 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    font-weight: 500;
    text-align: center;
    animation: slideIn 0.5s ease;
}

.message.success {
    background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
    color: white;
    border-left: 4px solid #2E7D32;
}

.message.error {
    background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
    color: white;
    border-left: 4px solid #B71C1C;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Form Sections */
.form-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
    border: 1px solid rgba(0,0,0,0.1);
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.form-section:hover {
    transform: translateY(-2px);
}

.form-section h2 {
    color: #495057;
    margin-bottom: 25px;
    font-size: 24px;
    font-weight: 600;
    text-align: center;
    position: relative;
}

.form-section h2::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 3px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 2px;
}

/* Form Groups */
.form-group {
    margin-bottom: 20px;
    position: relative;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #495057;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.form-group input[type="text"],
.form-group input[type="password"],
.form-group select {
    width: 100%;
    padding: 15px 20px;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    font-size: 16px;
    background: white;
    transition: all 0.3s ease;
    box-sizing: border-box;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1), inset 0 2px 4px rgba(0,0,0,0.1);
    transform: translateY(-1px);
}

.form-group select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 16px;
    padding-right: 45px;
}

/* Buttons */
.btn {
    padding: 15px 30px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-block;
    text-decoration: none;
    text-align: center;
    min-width: 120px;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.btn-primary:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
}

.btn-danger {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
}

.btn-danger:hover {
    background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
}

/* Table Styles */
.table-container {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    margin-top: 30px;
}

.table-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    text-align: center;
    font-size: 20px;
    font-weight: 600;
}

.users-table {
    width: 100%;
    border-collapse: collapse;
}

.users-table th {
    background: linear-gradient(135deg, #495057 0%, #343a40 100%);
    color: white;
    padding: 18px 15px;
    text-align: left;
    font-weight: 600;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 3px solid #dee2e6;
}

.users-table td {
    padding: 15px;
    border-bottom: 1px solid #e9ecef;
    vertical-align: middle;
    transition: background-color 0.3s ease;
}

.users-table tbody tr:nth-child(even) {
    background-color: #f8f9fa;
}

.users-table tbody tr:hover {
    background-color: rgba(102, 126, 234, 0.05);
    transform: scale(1.01);
    transition: all 0.2s ease;
}

.users-table tbody tr:hover td {
    color: #495057;
}

/* Action Links */
.action-links {
    display: flex;
    gap: 10px;
}

.action-link {
    padding: 8px 15px;
    border-radius: 20px;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    display: inline-block;
    text-align: center;
    min-width: 60px;
}

.action-link.edit {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
}

.action-link.edit:hover {
    background: linear-gradient(135deg, #218838 0%, #1aa085 100%);
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);
}

.action-link.delete {
    background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
    color: white;
}

.action-link.delete:hover {
    background: linear-gradient(135deg, #c82333 0%, #e8680d 100%);
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        margin: 20px;
        padding: 20px;
    }

    h1 {
        font-size: 28px;
    }

    .form-section {
        padding: 20px;
    }

    .form-group input,
    .form-group select {
        padding: 12px 15px;
        font-size: 16px; /* Prevent zoom on iOS */
    }

    .btn {
        padding: 12px 20px;
        font-size: 14px;
        min-width: 100px;
    }

    .users-table {
        font-size: 14px;
    }

    .users-table th,
    .users-table td {
        padding: 10px 8px;
    }

    .action-links {
        flex-direction: column;
        gap: 5px;
    }

    .action-link {
        padding: 6px 12px;
        font-size: 12px;
        min-width: 50px;
    }
}

@media (max-width: 480px) {
    .container {
        margin: 10px;
        padding: 15px;
    }

    .form-section {
        padding: 15px;
    }

    .table-container {
        margin-top: 20px;
    }

    .users-table th,
    .users-table td {
        padding: 8px 6px;
        font-size: 12px;
    }
}

/* Loading Animation */
.loading {
    opacity: 0.6;
    pointer-events: none;
}

.loading::after {
    content: '';
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-left: 10px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Success/Error Animations */
@keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
}

.message {
    animation: bounceIn 0.6s ease;
}

/* Focus states for accessibility */
.btn:focus,
.form-group input:focus,
.form-group select:focus {
    outline: 2px solid #667eea;
    outline-offset: 2px;
}

/* Print styles */
@media print {
    body {
        background: white !important;
    }

    .container {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
    }

    .btn,
    .back-link {
        display: none !important;
    }
}


===== C:\xampp\htdocs\jemaat\css\monthly_contributions.css =====

/* Monthly Contributions Styles */
.monthly-contributions-grid {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.monthly-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.month-item {
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    padding: 15px 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
}

.month-item.paid {
    border-color: #28a745;
    background: #f8fff9;
}

.month-item.unpaid {
    border-color: #ffc107;
    background: #fffdf6;
}

.month-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.month-name {
    font-weight: 600;
    margin-bottom: 8px;
    color: #333;
}

.payment-status {
    font-size: 18px;
}

.status-paid {
    color: #28a745;
    font-weight: bold;
}

.status-unpaid {
    color: #ffc107;
    font-weight: bold;
}

.contribution-stats {
    display: flex;
    justify-content: space-around;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #11998e;
}

.stat-item {
    text-align: center;
}

.stat-label {
    display: block;
    font-size: 14px;
    color: #666;
    margin-bottom: 5px;
}

.stat-value {
    display: block;
    font-size: 18px;
    font-weight: bold;
    color: #11998e;
}

/* Responsive Design for Monthly Contributions */
@media (max-width: 768px) {
    .monthly-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 480px) {
    .monthly-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .contribution-stats {
        flex-direction: column;
        gap: 10px;
    }
}


===== C:\xampp\htdocs\jemaat\css\new_style.css =====



===== C:\xampp\htdocs\jemaat\css\style.css =====

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}



.disabled-link {
    opacity: 0.5;
    cursor: not-allowed;
}

.disabled-link:hover {
    background-color: transparent !important;
}

.login-body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 50%, #56ab2f 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    position: relative;
    overflow: hidden;
}

.login-body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
    opacity: 0.5;
    animation: float 20s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.login-container {
    width: 100%;
    max-width: 350px;
    padding: 20px;
    z-index: 1;
}

.login-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 30px 25px;
    border-radius: 15px;
    box-shadow: 0 15px 45px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
    text-align: center;
    border: 1px solid rgba(255,255,255,0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.login-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.2);
}

.logo {
    font-size: 50px;
    margin-bottom: 15px;
    color: #11998e;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.login-card h1 {
    margin-bottom: 10px;
    color: #333;
    font-size: 24px;
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.login-card p {
    margin-bottom: 20px;
    color: #666;
    font-size: 14px;
    line-height: 1.4;
}

.input-group {
    margin-bottom: 15px;
    text-align: left;
    position: relative;
}

.input-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #444;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.input-group input {
    width: 100%;
    padding: 10px 15px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.8);
}

.input-group input:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
    background: white;
}

.login-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 3px 12px rgba(17, 153, 142, 0.3);
}

.login-btn:hover {
    background: linear-gradient(135deg, #0e7c6b 0%, #32d66b 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
}

.login-btn:active {
    transform: translateY(0);
}

.error {
    color: #e74c3c;
    margin-bottom: 15px;
    background: rgba(231, 76, 60, 0.1);
    padding: 8px;
    border-radius: 5px;
    border-left: 4px solid #e74c3c;
    font-weight: 500;
    font-size: 14px;
}

.container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h1, h2 {
    color: #333;
}

form {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
}

input[type="text"], input[type="password"], input[type="date"], textarea, select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

input[type="radio"] {
    margin-right: 5px;
}

button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
}

button:hover {
    background-color: #45a049;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

table, th, td {
    border: 1px solid #ddd;
}

th, td {
    padding: 8px;
    text-align: left;
}

th {
    background-color: #f2f2f2;
}

.error {
    color: red;
}

a {
    color: #007BFF;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

fieldset {
    border: 1px solid #ccc;
    padding: 10px;
    margin-top: 10px;
}

legend {
    font-weight: bold;
}

/* Form Card Styles */
.form-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 15px 45px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    margin-top: 20px;
}

.form-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.2);
}

.form-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 10px;
    border-left: 4px solid #11998e;
}

.form-section h3 {
    margin-top: 0;
    color: #11998e;
    font-size: 18px;
    margin-bottom: 15px;
}

.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.form-row .form-group {
    flex: 1;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #444;
    font-size: 14px;
}

.form-group input[type="text"],
.form-group input[type="password"],
.form-group input[type="date"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px 15px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.8);
}

.form-group input[type="file"] {
    margin-top: 5px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
    background: white;
}

.radio-group {
    display: flex;
    gap: 15px;
    align-items: center;
}

.radio-group input[type="radio"] {
    margin: 0;
}

.submit-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 3px 12px rgba(17, 153, 142, 0.3);
}

.submit-btn:hover {
    background: linear-gradient(135deg, #0e7c6b 0%, #32d66b 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
}

.submit-btn:active {
    transform: translateY(0);
}

/* Responsive Design */
@media (max-width: 768px) {
    .nav-container {
        flex-direction: column;
        padding: 10px 20px;
    }

    .nav-menu {
        display: none;
        flex-direction: column;
        width: 100%;
        margin-top: 10px;
    }

    .nav-menu.active {
        display: flex;
    }

    .nav-menu li {
        margin: 0;
        text-align: center;
    }

    .nav-menu a {
        padding: 10px;
    }

    .hamburger {
        display: block;
        cursor: pointer;
        font-size: 24px;
        color: white;
    }

    .container {
        margin: 10px;
        padding: 15px;
    }

    .form-row {
        flex-direction: column;
        gap: 0;
    }

    .form-card {
        padding: 20px;
    }

    .form-section {
        padding: 15px;
    }

    table {
        font-size: 14px;
    }

    th, td {
        padding: 6px;
    }

    .table-responsive {
        overflow-x: auto;
    }
}

@media (min-width: 769px) {
    .hamburger {
        display: none;
    }
}

/* Enhanced Table Styles */
.table-responsive {
    overflow-x: auto;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
}

th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 15px 10px;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 10;
}

td {
    padding: 12px 10px;
    border-bottom: 1px solid #e1e5e9;
    vertical-align: top;
}

tbody tr:nth-child(even) {
    background-color: #f9f9f9;
}

tbody tr:hover {
    background-color: rgba(17, 153, 142, 0.05);
    transform: scale(1.01);
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.family-details {
    max-height: 60px;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.family-details.expanded {
    max-height: 200px;
}

.toggle-btn {
    background: #11998e;
    color: white;
    text-decoration: none;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    margin-top: 5px;
    transition: background 0.3s ease;
    display: inline-block;
}

.toggle-btn:hover {
    background: #0e7c6b;
    color: white;
}

.action-links a {
    color: #11998e;
    text-decoration: none;
    margin-right: 10px;
    padding: 5px 10px;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.action-links a:hover {
    background: #11998e;
    color: white;
}

/* Detail Table Styles */
.detail-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.detail-table th, .detail-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #e1e5e9;
}

.detail-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    font-weight: 600;
}

.detail-table tr:nth-child(even) {
    background-color: #f9f9f9;
}

/* Contributions Table Styles */
.contributions-section {
    margin-top: 20px;
}

.contributions-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.contributions-table th, .contributions-table td {
    padding: 8px;
    text-align: center;
    border: 1px solid #e1e5e9;
}

.contributions-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    font-weight: 600;
}

.contributions-table input {
    width: 100%;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
}

/* Contribution Table Styles (Legacy) */
.contribution-table {
    width: 100%;
    max-width: 100%;
    margin: 20px auto;
    border-collapse: collapse;
    background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
    animation: fadeIn 0.5s ease-in-out;
    table-layout: fixed;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.contribution-table th, .contribution-table td {
    padding: 8px 4px;
    text-align: center;
    border: 1px solid #e1e5e9;
    transition: all 0.3s ease;
    word-wrap: break-word;
}

.contribution-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;
    overflow: hidden;
    font-size: 10px;
}

.contribution-table th::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.contribution-table th:hover::before {
    left: 100%;
}

.contribution-table td {
    vertical-align: middle;
    background: rgba(255,255,255,0.8);
}

/* Tetapkan lebar kolom */
.contribution-table th:nth-child(1),
.contribution-table td:nth-child(1) { /* Nama Keluarga */
    width: 20%; /* Lebar lebih besar untuk daftar anggota */
    max-width: 200px;
    text-align: left;
}
.contribution-table th:nth-child(2),
.contribution-table td:nth-child(2) { /* Alamat */
    width: 15%;
    max-width: 150px;
}
.contribution-table th:nth-child(3),
.contribution-table td:nth-child(3) { /* No HP */
    width: 10%;
    max-width: 100px;
}
.contribution-table th:nth-child(4),
.contribution-table td:nth-child(4) { /* Pendidikan */
    width: 10%;
    max-width: 100px;
}
.contribution-table th:nth-child(5),
.contribution-table td:nth-child(5) { /* Keterangan */
    width: 15%;
    max-width: 150px;
}
.contribution-table th:nth-child(n+6),
.contribution-table td:nth-child(n+6) { /* Kolom tahun */
    width: 5%;
    max-width: 50px;
}

.family-members-list {
    max-height: 100px; /* Batasi tinggi */
    overflow-y: auto; /* Gulir jika terlalu panjang */
    padding: 5px;
}

.family-member {
    margin: 2px 0;
    font-size: 12px;
}

.contribution-table input {
    width: 60px;
    padding: 4px 6px;
    border: 2px solid #ddd;
    border-radius: 8px;
    text-align: center;
    font-size: 12px;
    font-weight: 500;
    background: white;
    transition: all 0.3s ease;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    -webkit-appearance: none;
    -moz-appearance: textfield;
}

.contribution-table input::-webkit-outer-spin-button,
.contribution-table input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.contribution-table input:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.2), inset 0 1px 3px rgba(0,0,0,0.1);
    transform: scale(1.05);
}

.contribution-table tbody tr:nth-child(even) {
    background: linear-gradient(135deg, #f9f9f9 0%, #f0f0f0 100%);
}

.contribution-table tbody tr:hover {
    background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(17, 153, 142, 0.05) 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.contribution-table tbody tr:hover td {
    color: #11998e;
}

/* Simple Contributions Section Styles */
.contributions-section {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.contributions-section h2 {
    color: #11998e;
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 20px;
}

.contributions-info {
    background: #f9f9f9;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
    border-left: 3px solid #11998e;
}

.contributions-info p {
    margin: 5px 0;
    font-size: 14px;
    color: #555;
}

.contributions-table-container {
    overflow-x: auto;
}

.contributions-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    margin: 0;
}

.contributions-table th,
.contributions-table td {
    padding: 12px 8px;
    text-align: left;
    border: 1px solid #ddd;
}

.contributions-table th {
    background: #11998e;
    color: white;
    font-weight: 600;
    font-size: 14px;
}

.contributions-table tbody tr:nth-child(even) {
    background: #f9f9f9;
}

.contributions-table tbody tr:hover {
    background: #f0f8ff;
}

.contributions-table tbody tr.current-year {
    background: #e8f5e8;
    font-weight: 600;
}

.year-cell {
    font-weight: 600;
    color: #333;
    position: relative;
}

.current-year-label {
    display: inline-block;
    background: #11998e;
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.amount-cell {
    width: 80px;
}

.amount-input {
    width: 100%;
    padding: 4px 6px;
    border: 1px solid #ccc;
    border-radius: 3px;
    text-align: right;
    font-size: 12px;
    background: white;
    box-sizing: border-box;
    height: 28px;
}

.amount-input:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 2px rgba(17, 153, 142, 0.1);
}

.status-cell {
    width: 120px;
}

.status-paid {
    color: #28a745;
    font-weight: 600;
    font-size: 13px;
}

.status-unpaid {
    color: #ffc107;
    font-weight: 600;
    font-size: 13px;
}

/* Responsive Design for Simple Contributions */
@media (max-width: 768px) {
    .contributions-section {
        padding: 15px;
    }

    .contributions-table-container {
        font-size: 14px;
    }

    .contributions-table th,
    .contributions-table td {
        padding: 8px 4px;
    }

    .amount-cell {
        width: 120px;
    }

    .status-cell {
        width: 100px;
    }

    .amount-input {
        font-size: 12px;
        padding: 6px;
    }
}

/* File cell hover styles */
.file-cell {
    position: relative;
    cursor: pointer;
    padding: 10px;
    border: 1px solid #e1e5e9;
    border-radius: 8px;
    background: rgba(255,255,255,0.8);
    transition: all 0.3s ease;
    min-height: 60px;
}

.file-cell:hover {
    background: rgba(17, 153, 142, 0.1);
    border-color: #11998e;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.file-options {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    border: 1px solid #ccc;
    padding: 5px;
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    border-radius: 5px;
    min-width: 100px;
    transform: translateY(-5px);
}

.file-cell:hover .file-options {
    display: block;
}

/* Pastikan tabel nggak memotong submenu */
.family-table {
    position: relative;
    overflow: visible;
    z-index: 1;
}

/* Tambah padding di bawah baris untuk ruang hover */
.family-table td {
    padding-bottom: 20px;
}

/* Family Members List Styles */
.family-members-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 8px;
    background: rgba(17, 153, 142, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(17, 153, 142, 0.1);
}

.main-member {
    font-weight: bold;
    font-size: 16px;
    color: #11998e;
    padding: 4px 0;
    border-bottom: 2px solid #11998e;
    margin-bottom: 8px;
}

.family-member {
    font-size: 14px;
    color: #555;
    padding: 2px 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.family-member::before {
    font-size: 12px;
    opacity: 0.7;
}

/* Detail container styles */
.detail-container {
    max-width: 900px;
    margin: 15px auto;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.family-info {
    background: linear-gradient(135deg, #f9f9f9 0%, #f0f0f0 100%);
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 3px solid #11998e;
}

.family-info h3 {
    margin-top: 0;
    color: #11998e;
    font-size: 18px;
}

.family-info p {
    margin: 10px 0;
    font-size: 16px;
    color: #555;
}

.family-table-section {
    margin-bottom: 25px;
}

.family-table-section h2 {
    color: #11998e;
    margin-bottom: 20px;
    text-align: center;
    font-size: 28px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Head of Family Selection Styles */
.head-of-family-section {
    background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border: 1px solid rgba(17, 153, 142, 0.1);
}

.head-of-family-section h3 {
    color: #11998e;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 20px;
    text-align: center;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.head-selection {
    margin-bottom: 25px;
}

.head-selection p {
    font-size: 16px;
    color: #555;
    margin-bottom: 15px;
    text-align: center;
    font-weight: 500;
}

.head-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
    margin: 0 auto;
}

.head-option {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    background: white;
    border: 2px solid #e1e5e9;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    color: #555;
}

.head-option:hover {
    border-color: #11998e;
    background: rgba(17, 153, 142, 0.05);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(17, 153, 142, 0.15);
}

.head-option input[type="radio"] {
    margin-right: 12px;
    width: 18px;
    height: 18px;
    accent-color: #11998e;
}

.head-option input[type="radio"]:checked + span {
    color: #11998e;
    font-weight: 600;
}

.head-option span {
    transition: color 0.3s ease;
}

.head-of-family-table {
    margin-top: 20px;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.head-of-family-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 15px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.head-of-family-table td {
    padding: 15px;
    text-align: center;
    font-size: 16px;
    font-weight: 500;
}

/* Auto-fill display styles */
.auto-fill-display {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    border: 1px solid rgba(17, 153, 142, 0.2);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.display-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
}

.display-row:last-child {
    border-bottom: none;
}

.display-row strong {
    color: #11998e;
    font-weight: 600;
    min-width: 150px;
}

.display-row span {
    color: #333;
    font-weight: 500;
    text-align: right;
    flex: 1;
}

/* Responsive adjustments for head selection */
@media (max-width: 768px) {
    .head-options {
        max-width: 100%;
    }

    .head-option {
        padding: 10px 12px;
        font-size: 13px;
    }

    .head-of-family-section {
        padding: 20px;
    }

    .auto-fill-display {
        padding: 15px;
    }

    .display-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }

    .display-row strong {
        min-width: auto;
    }

    .display-row span {
        text-align: left;
    }
}

/* Step-based Form Styles */
.form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.form-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    position: relative;
}

.form-steps::before {
    content: '';
    position: absolute;
    top: 15px;
    left: 0;
    right: 0;
    height: 2px;
    background: #ddd;
    z-index: 1;
}

.step {
    position: relative;
    z-index: 2;
    background: white;
    padding: 10px 20px;
    border: 2px solid #ddd;
    border-radius: 20px;
    text-align: center;
    flex: 1;
    margin: 0 5px;
}

.step.active {
    border-color: #11998e;
    background: #11998e;
    color: white;
}

.step-number {
    display: block;
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 5px;
}

.step-title {
    display: block;
    font-size: 12px;
    font-weight: 500;
}

.form-step {
    display: none;
}

.form-step.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.family-section {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.family-member {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: #f9f9f9;
}

.member-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.btn-remove {
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    cursor: pointer;
}

.step-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
}

.btn-next, .btn-prev, .btn-submit, .btn-add {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.btn-next, .btn-submit {
    background: #11998e;
    color: white;
}

.btn-prev {
    background: #95a5a6;
    color: white;
}

.btn-add {
    background: #27ae60;
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

.form-group input.error,
.form-group select.error,
.form-group textarea.error {
    border-color: #e74c3c;
}

.field-error {
    color: #e74c3c;
    font-size: 12px;
    margin-top: 5px;
}

.file-preview {
    font-size: 12px;
    margin-top: 5px;
    padding: 5px;
    background: #f8f9fa;
    border-radius: 3px;
}

/* Notification Styles */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 5px;
    color: white;
    font-weight: 500;
    z-index: 10000;
    transform: translateX(100%);
    transition: transform 0.3s ease;
}

.notification.show {
    transform: translateX(0);
}

.notification-success {
    background: #27ae60;
}

.notification-error {
    background: #e74c3c;
}

.notification-info {
    background: #3498db;
}

/* Responsive Design for Step Form */
@media (max-width: 768px) {
    .form-container {
        padding: 15px;
    }

    .form-steps {
        flex-direction: column;
        gap: 10px;
    }

    .step {
        margin: 0;
    }

    .form-grid {
        grid-template-columns: 1fr;
    }

    .step-buttons {
        flex-direction: column;
        gap: 10px;
    }

    .section-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }
}
/* Google Forms-like Step-based Form Styles */
.form-container { max-width: 800px; margin: 0 auto; padding: 20px; font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }

/* Real-time feedback styles */
.head-option input:disabled + span {
    color: #ccc !important;
    cursor: not-allowed;
}

.auto-fill-display .display-row {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
    transition: all 0.3s ease;
}

.auto-fill-display .display-row:last-child {
    border-bottom: none;
}

/* Loading animation for real-time updates */
.auto-fill-display.updating {
    opacity: 0.7;
}

/* Success state when head is selected */
.auto-fill-display.valid .display-row {
    color: #27ae60;
}

/* Status Badges */
.status-badge {
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    text-align: center;
    display: inline-block;
}

.status-badge.pending {
    background-color: #ffc107;
    color: #000;
}

.status-badge.approved {
    background-color: #28a745;
    color: #fff;
}

.status-badge.rejected {
    background-color: #dc3545;
    color: #fff;
}

/* Member Badges */
.member-badge {
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
    text-align: center;
    display: inline-block;
    margin-right: 5px;
}

.member-badge.ayah {
    background-color: #007bff;
    color: #fff;
}

.member-badge.ibu {
    background-color: #e83e8c;
    color: #fff;
}

.member-badge.anak {
    background-color: #6f42c1;
    color: #fff;
}

.member-badge.tanggungan {
    background-color: #fd7e14;
    color: #fff;
}

/* Compact Table */
.compact-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    margin-bottom: 20px;
}

.compact-table th {
    background-color: #f8f9fa;
    padding: 8px;
    text-align: left;
    border-bottom: 2px solid #dee2e6;
    font-weight: bold;
}

.compact-table td {
    padding: 8px;
    border-bottom: 1px solid #dee2e6;
    vertical-align: middle;
}

.compact-table tr:hover {
    background-color: #f1f1f1;
}

.family-members {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

/* Notification Badge Styles */
.notification-badge {
    background: #e74c3c;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 10px;
    margin-left: 5px;
    vertical-align: super;
}

.nav-link.has-notification {
    font-weight: bold;
    color: #e74c3c !important;
}

/* Required field indicator */
.required {
    color: #e74c3c;
}

/* Card styles for forms */
.card {
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.card-body {
    padding: 20px;
}

.form-control {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

.form-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.btn-primary {
    background: #11998e;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.btn-secondary {
    background: #6c757d;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.btn-primary:hover {
    background: #0d7d73;
}

.btn-secondary:hover {
    background: #545b62;
}

/* Premium Header Styles */
.navbar {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    border-bottom: 2px solid #e74c3c;
    position: relative;
    overflow: hidden;
}

.navbar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.03)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.03)"/><circle cx="50" cy="50" r="0.5" fill="rgba(255,255,255,0.02)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>') repeat;
    opacity: 0.8;
    pointer-events: none;
}

.navbar::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(231, 76, 60, 0.1), transparent);
    animation: shimmer 3s ease-in-out infinite;
    pointer-events: none;
}

@keyframes shimmer {
    0% { left: -100%; }
    50% { left: 100%; }
    100% { left: -100%; }
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 2;
}

.nav-logo {
    color: #ffffff;
    text-decoration: none;
    font-size: 28px;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    letter-spacing: 1px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 0;
}

.nav-logo:hover {
    color: #e74c3c;
    transform: translateY(-2px);
    text-shadow: 0 4px 8px rgba(231, 76, 60, 0.4);
}

.nav-logo::before {
    content: "‚õ™";
    font-size: 32px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    from { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
    to { filter: drop-shadow(0 2px 6px rgba(231, 76, 60, 0.3)); }
}

.hamburger {
    display: none;
    cursor: pointer;
    font-size: 28px;
    color: #ffffff;
    padding: 10px;
    border-radius: 8px;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.hamburger:hover {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
    transform: scale(1.1);
}

.nav-menu {
    list-style: none;
    display: flex;
    margin: 0;
    padding: 0;
    align-items: center;
    gap: 5px;
}

.nav-menu li {
    position: relative;
}

.nav-menu a {
    color: #ffffff;
    text-decoration: none;
    padding: 15px 20px;
    display: block;
    transition: all 0.3s ease;
    font-weight: 500;
    font-size: 14px;
    letter-spacing: 0.5px;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
}

.nav-menu a::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(231, 76, 60, 0.2), transparent);
    transition: left 0.5s ease;
}

.nav-menu a:hover::before {
    left: 100%;
}

.nav-menu a:hover {
    background: rgba(231, 76, 60, 0.15);
    color: #ffffff;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
}

.nav-link.has-notification {
    position: relative;
}

.nav-link.has-notification::after {
    content: '';
    position: absolute;
    top: 8px;
    right: 8px;
    width: 8px;
    height: 8px;
    background: #e74c3c;
    border-radius: 50%;
    animation: pulse-notification 2s infinite;
}

@keyframes pulse-notification {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
}

.notification-badge {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    border-radius: 50%;
    padding: 3px 8px;
    font-size: 11px;
    font-weight: 700;
    margin-left: 8px;
    vertical-align: super;
    box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
    border: 2px solid rgba(255,255,255,0.2);
    animation: bounce-in 0.5s ease;
}

@keyframes bounce-in {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.user-info {
    color: #ecf0f1;
    font-size: 13px;
    padding: 12px 18px;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    border-radius: 25px;
    border: 1px solid rgba(255,255,255,0.2);
    margin-left: 15px;
    font-weight: 500;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.user-info:hover {
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.2) 0%, rgba(231, 76, 60, 0.1) 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
    color: #ffffff;
}

/* Responsive Design */
@media (max-width: 768px) {
    .nav-container {
        flex-direction: column;
        padding: 15px 20px;
        gap: 15px;
    }

    .nav-logo {
        font-size: 24px;
        padding: 10px 0;
    }

    .nav-logo::before {
        font-size: 28px;
    }

    .nav-menu {
        display: none;
        flex-direction: column;
        width: 100%;
        gap: 0;
        background: rgba(26, 26, 46, 0.95);
        backdrop-filter: blur(15px);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        border: 1px solid rgba(255,255,255,0.1);
    }

    .nav-menu.active {
        display: flex;
    }

    .nav-menu li {
        width: 100%;
        margin: 0;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .nav-menu li:last-child {
        border-bottom: none;
    }

    .nav-menu a {
        padding: 15px 20px;
        border-radius: 8px;
        margin: 2px 0;
    }

    .nav-menu a:hover {
        background: rgba(231, 76, 60, 0.2);
        transform: translateX(5px);
    }

    .hamburger {
        display: block;
        position: absolute;
        top: 15px;
        right: 20px;
    }

    .user-info {
        margin-left: 0;
        text-align: center;
        font-size: 12px;
        padding: 10px 15px;
    }
}

@media (max-width: 480px) {
    .nav-logo {
        font-size: 20px;
    }

    .nav-logo::before {
        font-size: 24px;
    }

    .nav-menu {
        padding: 15px;
    }

    .nav-menu a {
        padding: 12px 15px;
        font-size: 13px;
    }

    .notification-badge {
        font-size: 10px;
        padding: 2px 6px;
    }
}




===== C:\xampp\htdocs\jemaat\js\script.js =====

// Optimized Form Handler for Step-by-Step Form
class OptimizedFormHandler {
    constructor() {
        this.currentStep = 1;
        this.childCount = 0;
        this.dependentCount = 0;
        this.init();
    }

    init() {
        this.setupStepNavigation();
        this.setupFamilyMembers();
        this.setupFormValidation();
        this.setupImageCompression();
        this.setupHeadOfFamilySelection();
        this.setupSummaryGeneration();

        // Initialize head options
        setTimeout(() => {
            this.updateFamilyMemberHeadOptions();
        }, 100);
    }

    setupStepNavigation() {
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-next')) {
                const nextStep = parseInt(e.target.dataset.next);
                if (this.validateStep(this.currentStep)) {
                    this.goToStep(nextStep);
                    
                    // Generate summary when going to step 3
                    if (nextStep === 3) {
                        this.generateFamilySummary();
                    }
                }
            } else if (e.target.classList.contains('btn-prev')) {
                const prevStep = parseInt(e.target.dataset.prev);
                this.goToStep(prevStep);
            }
        });
    }

    setupFamilyMembers() {
        // Setup add child button
        const addChildButton = document.getElementById('addChild');
        if (addChildButton) {
            addChildButton.addEventListener('click', () => {
                this.addChild();
            });
        }
        
        // Setup add dependent button
        const addDependentButton = document.getElementById('addDependent');
        if (addDependentButton) {
            addDependentButton.addEventListener('click', () => {
                this.addDependent();
            });
        }
        
        // Setup remove buttons for dynamic cards
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-remove')) {
                const target = e.target.dataset.target;
                const index = e.target.dataset.index;
                
                if (target === 'child') {
                    this.removeChild(index);
                } else if (target === 'dependent') {
                    this.removeDependent(index);
                }
            }
        });
    }

    goToStep(step) {
        // Hide current step
        const currentStepElement = document.querySelector(`#step-${this.currentStep}`);
        const currentStepIndicator = document.querySelector(`.step[data-step="${this.currentStep}"]`);

        if (currentStepElement) currentStepElement.classList.remove('active');
        if (currentStepIndicator) currentStepIndicator.classList.remove('active');

        // Show new step
        this.currentStep = step;
        const newStepElement = document.querySelector(`#step-${step}`);
        const newStepIndicator = document.querySelector(`.step[data-step="${step}"]`);

        if (newStepElement) newStepElement.classList.add('active');
        if (newStepIndicator) newStepIndicator.classList.add('active');

        // Scroll to top of form
        document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
    }

    validateStep(step) {
        const stepElement = document.querySelector(`#step-${step}`);
        if (!stepElement) return true;

        const requiredFields = stepElement.querySelectorAll('[required]');
        let isValid = true;

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                this.showFieldError(field, 'Field ini wajib diisi');
                isValid = false;
            } else {
                this.clearFieldError(field);
            }
        });

        return isValid;
    }

    showFieldError(field, message) {
        field.classList.add('error');
        let errorElement = field.parentNode.querySelector('.field-error');
        if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.className = 'field-error';
            field.parentNode.appendChild(errorElement);
        }
        errorElement.textContent = message;
    }

    clearFieldError(field) {
        field.classList.remove('error');
        const errorElement = field.parentNode.querySelector('.field-error');
        if (errorElement) {
            errorElement.remove();
        }
    }

    addFamilyMember() {
        this.familyMemberCount++;
        const container = document.getElementById('family-members-container');
        if (!container) return;

        const memberHtml = `
            <div class="family-member" data-index="${this.familyMemberCount}">
                <div class="member-header">
                    <h5>Anggota Keluarga ${this.familyMemberCount}</h5>
                    <button type="button" class="btn-remove" onclick="formHandler.removeFamilyMember(${this.familyMemberCount})">√ó</button>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Nama Lengkap *</label>
                        <input type="text" name="family_members[${this.familyMemberCount}][name]" required
                               oninput="formHandler.updateFamilyMemberHeadOptions()">
                    </div>
                    <div class="form-group">
                        <label>Hubungan *</label>
                        <select name="family_members[${this.familyMemberCount}][relationship]" required
                                onchange="formHandler.updateFamilyMemberHeadOptions()">
                            <option value="">Pilih Hubungan</option>
                            <option value="anak">Anak</option>
                            <option value="tanggungan">Tanggungan</option>
                            <option value="saudara">Saudara</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Jenis Kelamin</label>
                        <select name="family_members[${this.familyMemberCount}][gender]"
                                onchange="formHandler.updateFamilyMemberHeadOptions()">
                            <option value="">Pilih Jenis Kelamin</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tanggal Lahir</label>
                        <input type="date" name="family_members[${this.familyMemberCount}][birth_date]">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>No HP *</label>
                        <input type="text" name="family_members[${this.familyMemberCount}][phone]" required
                               placeholder="Contoh: 081234567890">
                    </div>
                    <div class="form-group">
                        <label>Pekerjaan *</label>
                        <input type="text" name="family_members[${this.familyMemberCount}][occupation]" required
                               placeholder="Contoh: Guru, Wiraswasta, dll">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Pendidikan</label>
                        <input type="text" name="family_members[${this.familyMemberCount}][education]"
                               placeholder="Contoh: SMA, S1, dll">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select name="family_members[${this.familyMemberCount}][status]">
                            <option value="Aktif">Aktif</option>
                            <option value="Pasif">Pasif</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Keterangan Tambahan</label>
                    <textarea name="family_members[${this.familyMemberCount}][notes]" rows="2"
                              placeholder="Catatan tambahan tentang anggota keluarga..."></textarea>
                </div>
            </div>
        `;

        container.insertAdjacentHTML('beforeend', memberHtml);
        this.showNotification(`Anggota keluarga ${this.familyMemberCount} berhasil ditambahkan`, 'success');

        // Update head options after adding new member
        setTimeout(() => {
            this.updateFamilyMemberHeadOptions();
        }, 100);
    }

    removeFamilyMember(index) {
        const member = document.querySelector(`.family-member[data-index="${index}"]`);
        if (member) {
            member.remove();
            this.showNotification('Anggota keluarga berhasil dihapus', 'info');

            // Update head options after removal
            setTimeout(() => {
                this.updateFamilyMemberHeadOptions();

                // Check if removed member was selected as head
                const selectedHead = document.querySelector('input[name="head_of_family"]:checked');
                if (selectedHead && selectedHead.value.includes(`-${index}`)) {
                    // Reset head selection if removed member was selected
                    document.querySelector('input[name="head_of_family"]').checked = false;
                }
            }, 100);
        }
    }

    setupFormValidation() {
        const form = document.getElementById('memberForm');
        if (form) {
            form.addEventListener('submit', (e) => {
                if (!this.validateStep(this.currentStep)) {
                    e.preventDefault();
                    this.showNotification('Harap perbaiki error sebelum submit', 'error');
                } else {
                    this.showNotification('Data sedang diproses...', 'info');
                }
            });
        }
    }

    setupImageCompression() {
        // Add event listeners for file inputs to show compression preview
        document.addEventListener('change', (e) => {
            if (e.target.type === 'file' && e.target.accept.includes('image')) {
                this.handleImagePreview(e.target);
            }
        });
    }

    setupHeadOfFamilySelection() {
        console.log('üöÄ Setting up head of family selection...');

        // Listen for head of family radio button changes
        document.addEventListener('change', (e) => {
            if (e.target.name === 'head_of_family') {
                console.log('‚úÖ Head selection changed:', e.target.value);
            }
        });

        // Update when switching steps
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-next') || e.target.classList.contains('btn-prev')) {
                setTimeout(() => {
                    this.updateFamilyMemberHeadOptions();
                }, 100);
            }
        });
    }





    updateFamilyMemberHeadOptions() {
        // Update child head options
        const childrenContainer = document.getElementById('children-head-options');
        if (childrenContainer) {
            childrenContainer.innerHTML = '';

            // Get all family member inputs
            const memberNameInputs = document.querySelectorAll('input[name^="family_members"][name$="[name]"]');

            memberNameInputs.forEach((input, index) => {
                const relationshipSelect = document.querySelector(`select[name="family_members[${index + 1}][relationship]"]`);
                const relationship = relationshipSelect ? relationshipSelect.value : '';

                if (input.value.trim() && relationship === 'anak') {
                    const option = document.createElement('label');
                    option.className = 'head-option';
                    option.innerHTML = `
                        <input type="radio" name="head_of_family" value="child-${index + 1}" id="head-child-${index + 1}">
                        <span>Anak: ${input.value.trim()}</span>
                    `;
                    childrenContainer.appendChild(option);
                }
            });
        }

        // Update guardian head options
        const guardiansContainer = document.getElementById('guardians-head-options');
        if (guardiansContainer) {
            guardiansContainer.innerHTML = '';

            // Get all family member inputs
            const memberNameInputs = document.querySelectorAll('input[name^="family_members"][name$="[name]"]');

            memberNameInputs.forEach((input, index) => {
                const relationshipSelect = document.querySelector(`select[name="family_members[${index + 1}][relationship]"]`);
                const relationship = relationshipSelect ? relationshipSelect.value : '';

                if (input.value.trim() && (relationship === 'tanggungan' || relationship === 'saudara' || relationship === 'lainnya')) {
                    const option = document.createElement('label');
                    option.className = 'head-option';
                    option.innerHTML = `
                        <input type="radio" name="head_of_family" value="guardian-${index + 1}" id="head-guardian-${index + 1}">
                        <span>Tanggungan: ${input.value.trim()}</span>
                    `;
                    guardiansContainer.appendChild(option);
                }
            });
        }
    }





    async handleImagePreview(input) {
        const file = input.files[0];
        if (!file) return;

        const fileSize = (file.size / 1024 / 1024).toFixed(2);
        const previewText = `File: ${file.name} (${fileSize} MB) - Akan dikompresi otomatis`;

        // Show preview info
        let previewElement = input.parentNode.querySelector('.file-preview');
        if (!previewElement) {
            previewElement = document.createElement('div');
            previewElement.className = 'file-preview';
            input.parentNode.appendChild(previewElement);
        }
        previewElement.textContent = previewText;
        previewElement.style.color = fileSize > 3.5 ? '#e74c3c' : '#27ae60';
    }

    showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.textContent = message;

        // Add to page
        document.body.appendChild(notification);

        // Show notification
        setTimeout(() => notification.classList.add('show'), 100);

        // Hide after 3 seconds
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    goToStep(step) {
        // Hide current step
        const currentStepElement = document.querySelector(`#step-${this.currentStep}`);
        const currentStepIndicator = document.querySelector(`.step[data-step="${this.currentStep}"]`);

        if (currentStepElement) currentStepElement.classList.remove('active');
        if (currentStepIndicator) currentStepIndicator.classList.remove('active');

        // Show new step
        this.currentStep = step;
        const newStepElement = document.querySelector(`#step-${step}`);
        const newStepIndicator = document.querySelector(`.step[data-step="${step}"]`);

        if (newStepElement) newStepElement.classList.add('active');
        if (newStepIndicator) newStepIndicator.classList.add('active');

        // Scroll to top of form
        document.querySelector('.form-container').scrollIntoView({ behavior: 'smooth' });
    }

    validateStep(step) {
        const stepElement = document.querySelector(`#step-${step}`);
        if (!stepElement) return true;

        const requiredFields = stepElement.querySelectorAll('[required]');
        let isValid = true;

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                this.showFieldError(field, 'Field ini wajib diisi');
                isValid = false;
            } else {
                this.clearFieldError(field);
            }
        });

        return isValid;
    }

    showFieldError(field, message) {
        field.classList.add('error');
        let errorElement = field.parentNode.querySelector('.field-error');
        if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.className = 'field-error';
            field.parentNode.appendChild(errorElement);
        }
        errorElement.textContent = message;
    }

    clearFieldError(field) {
        field.classList.remove('error');
        const errorElement = field.parentNode.querySelector('.field-error');
        if (errorElement) {
            errorElement.remove();
        }
    }

    addChild() {
        const childrenContainer = document.getElementById('children-container');
        const template = document.getElementById('child-template');
        
        if (!childrenContainer || !template) return;
        
        const childIndex = this.childCount;
        const childNumber = this.childCount + 1;
        
        // Clone template and replace placeholders
        const childHtml = template.innerHTML
            .replace(/__INDEX__/g, childIndex)
            .replace(/__NUMBER__/g, childNumber);
        
        // Create new child element
        const childElement = document.createElement('div');
        childElement.innerHTML = childHtml;
        childElement.firstElementChild.dataset.index = childIndex;
        
        // Add to container
        childrenContainer.appendChild(childElement.firstElementChild);
        
        // Update head of family options
        this.addHeadOfFamilyOption('child', childIndex, `Anak #${childNumber}`);
        
        // Increment counter
        this.childCount++;
    }
    
    removeChild(index) {
        const childCard = document.querySelector(`.child-card[data-index="${index}"]`);
        if (childCard) {
            childCard.remove();
            this.removeHeadOfFamilyOption('child', index);
        }
    }
    
    addDependent() {
        const dependentsContainer = document.getElementById('dependents-container');
        const template = document.getElementById('dependent-template');
        
        if (!dependentsContainer || !template) return;
        
        const dependentIndex = this.dependentCount;
        const dependentNumber = this.dependentCount + 1;
        
        // Clone template and replace placeholders
        const dependentHtml = template.innerHTML
            .replace(/__INDEX__/g, dependentIndex)
            .replace(/__NUMBER__/g, dependentNumber);
        
        // Create new dependent element
        const dependentElement = document.createElement('div');
        dependentElement.innerHTML = dependentHtml;
        dependentElement.firstElementChild.dataset.index = dependentIndex;
        
        // Add to container
        dependentsContainer.appendChild(dependentElement.firstElementChild);
        
        // Update head of family options
        this.addHeadOfFamilyOption('dependent', dependentIndex, `Tanggungan #${dependentNumber}`);
        
        // Increment counter
        this.dependentCount++;
    }
    
    removeDependent(index) {
        const dependentCard = document.querySelector(`.dependent-card[data-index="${index}"]`);
        if (dependentCard) {
            dependentCard.remove();
            this.removeHeadOfFamilyOption('dependent', index);
        }
    }
    
    setupHeadOfFamilySelection() {
        // Initial setup for head of family radio buttons
        const headFatherRadio = document.getElementById('head-father');
        const headMotherRadio = document.getElementById('head-mother');
        
        if (headFatherRadio && headMotherRadio) {
            headFatherRadio.addEventListener('change', () => this.updateHeadOfFamily('father'));
            headMotherRadio.addEventListener('change', () => this.updateHeadOfFamily('mother'));
        }
    }
    
    updateHeadOfFamily(type) {
        // Update head of family selection
        document.querySelectorAll('[name="head_of_family"]').forEach(radio => {
            if (radio.value === type) {
                radio.checked = true;
            }
        });
    }
    
    addHeadOfFamilyOption(type, index, label) {
        const container = type === 'child' ? 
            document.getElementById('children-head-options') : 
            document.getElementById('guardians-head-options');
            
        if (!container) return;
        
        const optionId = `head-${type}-${index}`;
        const optionValue = `${type}_${index}`;
        
        const optionLabel = document.createElement('label');
        optionLabel.className = 'head-option';
        optionLabel.innerHTML = `
            <input type="radio" name="head_of_family" value="${optionValue}" id="${optionId}">
            <span>${label}</span>
        `;
        
        container.appendChild(optionLabel);
        
        // Add event listener
        const radio = document.getElementById(optionId);
        if (radio) {
            radio.addEventListener('change', () => this.updateHeadOfFamily(optionValue));
        }
    }
    
    removeHeadOfFamilyOption(type, index) {
        const optionId = `head-${type}-${index}`;
        const radio = document.getElementById(optionId);
        
        if (radio) {
            const label = radio.closest('.head-option');
            if (label) {
                label.remove();
            }
        }
    }
    
    updateFamilyMemberHeadOptions() {
        // This function can be used to refresh all head options if needed
        // Currently not needed as we add/remove options dynamically
    }
    
    setupFormValidation() {
        const form = document.getElementById('memberForm');
        if (form) {
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Validate all steps before submission
                let isValid = true;
                for (let i = 1; i <= 3; i++) {
                    if (!this.validateStep(i)) {
                        isValid = false;
                        this.goToStep(i);
                        break;
                    }
                }
                
                if (isValid) {
                    form.submit();
                }
            });
        }
    }
    
    setupImageCompression() {
        // Setup image compression for file uploads if needed
        // This is a placeholder for future implementation
    }
    
    setupSummaryGeneration() {
        // This will be called when going to step 3
    }
    
    generateFamilySummary() {
        const summaryContainer = document.getElementById('family-summary');
        if (!summaryContainer) return;
        
        let summaryHtml = '<div class="summary-section">';
        
        // Basic info
        const registerNumber = document.getElementById('register_number').value;
        const neighborhood = document.getElementById('neighborhood').value;
        const familyAddress = document.getElementById('family_address').value;
        
        summaryHtml += `
            <div class="summary-item">
                <strong>No Register:</strong> ${registerNumber}
            </div>
            <div class="summary-item">
                <strong>Lingkungan:</strong> ${neighborhood}
            </div>
            <div class="summary-item">
                <strong>Alamat Keluarga:</strong> ${familyAddress}
            </div>
        `;
        
        // Father info
        const fatherName = document.getElementById('father_name').value;
        summaryHtml += `
            <div class="summary-item">
                <strong>Nama Ayah:</strong> ${fatherName}
            </div>
        `;
        
        // Mother info
        const motherName = document.getElementById('mother_name').value;
        summaryHtml += `
            <div class="summary-item">
                <strong>Nama Ibu:</strong> ${motherName}
            </div>
        `;
        
        // Head of family
        const headOfFamily = document.querySelector('input[name="head_of_family"]:checked').value;
        let headOfFamilyText = '';
        
        if (headOfFamily === 'father') {
            headOfFamilyText = `Ayah (${fatherName})`;
        } else if (headOfFamily === 'mother') {
            headOfFamilyText = `Ibu (${motherName})`;
        } else if (headOfFamily.startsWith('child_')) {
            const childIndex = headOfFamily.split('_')[1];
            const childName = document.getElementById(`child_name_${childIndex}`).value;
            headOfFamilyText = `Anak (${childName})`;
        } else if (headOfFamily.startsWith('dependent_')) {
            const dependentIndex = headOfFamily.split('_')[1];
            const dependentName = document.getElementById(`dependent_name_${dependentIndex}`).value;
            headOfFamilyText = `Tanggungan (${dependentName})`;
        }
        
        summaryHtml += `
            <div class="summary-item">
                <strong>Kepala Keluarga:</strong> ${headOfFamilyText}
            </div>
        `;
        
        // Children count
        const childrenCount = document.querySelectorAll('.child-card').length;
        summaryHtml += `
            <div class="summary-item">
                <strong>Jumlah Anak:</strong> ${childrenCount}
            </div>
        `;
        
        // Dependents count
        const dependentsCount = document.querySelectorAll('.dependent-card').length;
        summaryHtml += `
            <div class="summary-item">
                <strong>Jumlah Tanggungan:</strong> ${dependentsCount}
            </div>
        `;
        
        summaryHtml += '</div>';
        
        // Update summary container
        summaryContainer.innerHTML = summaryHtml;
    }
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    window.formHandler = new OptimizedFormHandler();
});

// Legacy functions for backward compatibility
function confirmDelete() {
    return confirm('Apakah Anda yakin ingin menghapus anggota ini?');
}

window.toggleMenu = () => {
    const menu = document.getElementById('nav-menu');
    if (menu) menu.classList.toggle('active');
};

// Close mobile menu when clicking outside
document.addEventListener('click', (e) => {
    const menu = document.getElementById('nav-menu');
    const hamburger = document.querySelector('.hamburger');
    
    if (menu && hamburger && !menu.contains(e.target) && !hamburger.contains(e.target)) {
        menu.classList.remove('active');
    }
});

// Set active menu based on current page
document.addEventListener('DOMContentLoaded', () => {
    const currentPage = window.location.pathname.split('/').pop();
    const menuLinks = document.querySelectorAll('.nav-menu a');
    
    menuLinks.forEach(link => {
        const linkPage = link.getAttribute('href');
        if (linkPage === currentPage) {
            link.classList.add('active');
        }
    });
});

window.toggleFamily = (id) => {
    const details = document.getElementById('family-' + id);
    const btn = details?.nextElementSibling;
    if (details && btn) {
        details.classList.toggle('expanded');
        btn.textContent = details.classList.contains('expanded') ? 'Sembunyikan' : 'Selengkapnya';
    }
};

window.viewFile = (file) => {
    if (file) window.open('uploads/' + file, '_blank');
};

// Professional Header Stats Animation
class HeaderStats {
    constructor() {
        this.stats = {
            totalFamilies: 0,
            totalMembers: 0,
            activeNeighborhoods: 0
        };
        this.init();
    }

    init() {
        this.loadStats();
        this.animateCounters();
    }

    async loadStats() {
        try {
            // Fetch stats from server (you can replace this with actual API call)
            const response = await fetch('api/get_stats.php');
            if (response.ok) {
                const data = await response.json();
                this.stats = data;
            } else {
                // Fallback to demo data
                this.stats = {
                    totalFamilies: 1250,
                    totalMembers: 4850,
                    activeNeighborhoods: 15
                };
            }
        } catch (error) {
            console.log('Using demo stats due to API unavailability');
            // Demo data for development
            this.stats = {
                totalFamilies: 1250,
                totalMembers: 4850,
                activeNeighborhoods: 15
            };
        }
    }

    animateCounters() {
        // Animate each counter
        this.animateCounter('totalFamilies', this.stats.totalFamilies);
        this.animateCounter('totalMembers', this.stats.totalMembers);
        this.animateCounter('activeNeighborhoods', this.stats.activeNeighborhoods);
    }

    animateCounter(elementId, targetValue) {
        const element = document.getElementById(elementId);
        if (!element) return;

        const duration = 2000; // 2 seconds
        const startValue = 0;
        const startTime = performance.now();

        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);

            // Easing function for smooth animation
            const easeOutQuart = 1 - Math.pow(1 - progress, 4);
            const currentValue = Math.floor(startValue + (targetValue - startValue) * easeOutQuart);

            element.textContent = this.formatNumber(currentValue);

            if (progress < 1) {
                requestAnimationFrame(animate);
            }
        };

        requestAnimationFrame(animate);
    }

    formatNumber(num) {
        if (num >= 1000) {
            return (num / 1000).toFixed(1) + 'K';
        }
        return num.toString();
    }
}

// Initialize header stats when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    new HeaderStats();
});


------------------------------------------------
8 oktober 
database apk jemaat :

-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: Oct 08, 2025 at 07:23 AM
-- Server version: 10.4.32-MariaDB
-- PHP Version: 8.2.12

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `jemaat_db`
--

-- --------------------------------------------------------

--
-- Table structure for table `annual_contributions`
--

CREATE TABLE `annual_contributions` (
  `id` int(11) NOT NULL,
  `member_id` int(11) DEFAULT NULL,
  `year` int(11) DEFAULT NULL,
  `amount` int(11) DEFAULT NULL,
  `tenant_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `annual_contributions`
--

INSERT INTO `annual_contributions` (`id`, `member_id`, `year`, `amount`, `tenant_id`) VALUES
(1, 1, 2023, 750000, 1),
(2, 1, 2024, 800000, 1),
(3, 2, 2023, 600000, 1),
(4, 2, 2024, 650000, 1),
(5, 3, 2023, 900000, 1),
(6, 3, 2024, 950000, 1),
(7, 4, 2023, 1200000, 1),
(8, 4, 2024, 1250000, 1),
(9, 5, 2023, 450000, 1),
(10, 5, 2024, 500000, 1),
(11, 1, 2023, 500000, 1),
(12, 1, 2024, 550000, 1),
(13, 2, 2023, 750000, 1),
(14, 2, 2024, 800000, 1),
(15, 3, 2023, 1000000, 1),
(16, 3, 2024, 1100000, 1),
(17, 1, 2023, 500000, 1),
(18, 1, 2024, 550000, 1),
(19, 2, 2023, 750000, 1),
(20, 2, 2024, 800000, 1),
(21, 3, 2023, 1000000, 1),
(22, 3, 2024, 1100000, 1),
(23, 1, 2023, 500000, 1),
(24, 1, 2024, 550000, 1),
(25, 2, 2023, 750000, 1),
(26, 2, 2024, 800000, 1),
(27, 3, 2023, 1000000, 1),
(28, 3, 2024, 1100000, 1),
(29, 1, 2023, 500000, 1),
(30, 1, 2024, 550000, 1),
(31, 2, 2023, 750000, 1),
(32, 2, 2024, 800000, 1),
(33, 3, 2023, 1000000, 1),
(34, 3, 2024, 1100000, 1),
(35, 1, 2023, 500000, 1),
(36, 1, 2024, 550000, 1),
(37, 2, 2023, 750000, 1),
(38, 2, 2024, 800000, 1),
(39, 3, 2023, 1000000, 1),
(40, 3, 2024, 1100000, 1),
(41, 37, 2023, 600000, 1),
(42, 37, 2024, 650000, 1),
(43, 38, 2023, 800000, 1),
(44, 38, 2024, 850000, 1),
(45, 39, 2023, 550000, 1),
(46, 39, 2024, 600000, 1),
(47, 40, 2023, 700000, 1),
(48, 40, 2024, 750000, 1),
(49, 41, 2023, 900000, 1),
(50, 41, 2024, 950000, 1),
(51, 42, 2023, 750000, 1),
(52, 42, 2024, 800000, 1),
(53, 43, 2023, 500000, 1),
(54, 43, 2024, 550000, 1),
(55, 44, 2023, 650000, 1),
(56, 44, 2024, 700000, 1),
(57, 45, 2023, 450000, 1),
(58, 45, 2024, 500000, 1),
(59, 46, 2023, 1100000, 1),
(60, 46, 2024, 1150000, 1),
(61, 47, 2023, 600000, 1),
(62, 47, 2024, 650000, 1),
(63, 48, 2023, 850000, 1),
(64, 48, 2024, 900000, 1),
(65, 49, 2023, 950000, 1),
(66, 49, 2024, 1000000, 1),
(67, 50, 2024, 500000, 2),
(68, 51, 2024, 500000, 2),
(69, 52, 2024, 500000, 3),
(70, 53, 2024, 500000, 3),
(74, 50, 2024, 500000, 2),
(75, 51, 2024, 500000, 2),
(76, 56, 2024, 500000, 2),
(77, 57, 2024, 500000, 2),
(78, 52, 2024, 500000, 3),
(79, 53, 2024, 500000, 3),
(80, 58, 2024, 500000, 3),
(81, 59, 2024, 500000, 3),
(82, 60, 2024, 500000, 4),
(83, 61, 2024, 500000, 4);

-- --------------------------------------------------------

--
-- Table structure for table `children`
--

CREATE TABLE `children` (
  `id` int(11) NOT NULL,
  `member_id` int(11) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `gender` varchar(10) DEFAULT NULL,
  `birth_date` date DEFAULT NULL,
  `baptism_date` date DEFAULT NULL,
  `confirmation_date` date DEFAULT NULL,
  `marriage_date` date DEFAULT NULL,
  `death_date` date DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `occupation` varchar(100) DEFAULT NULL,
  `education` varchar(100) DEFAULT NULL,
  `notes` text DEFAULT NULL,
  `status` varchar(20) DEFAULT 'Hidup',
  `is_alive` tinyint(1) DEFAULT 1,
  `tenant_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `children`
--

INSERT INTO `children` (`id`, `member_id`, `name`, `gender`, `birth_date`, `baptism_date`, `confirmation_date`, `marriage_date`, `death_date`, `phone`, `occupation`, `education`, `notes`, `status`, `is_alive`, `tenant_id`) VALUES
(1, 1, 'Rafael Wijaya', 'Laki-laki', '2015-05-12', '2015-06-12', NULL, NULL, NULL, '-', 'Pelajar', 'SD', 'Anak pertama, hobi bermain piano', 'Hidup', 1, 1),
(2, 1, 'Gabriella Wijaya', 'Perempuan', '2018-10-28', '2018-11-28', NULL, NULL, NULL, '-', 'Pelajar', 'TK', 'Anak kedua, senang menari balet', 'Hidup', 1, 1),
(3, 1, 'Dominic Wijaya', 'Laki-laki', '2021-02-14', '2021-03-14', NULL, NULL, NULL, '-', 'Balita', '-', 'Anak bungsu, lucu dan aktif', 'Hidup', 1, 1),
(4, 2, 'Arjuna Hartono', 'Laki-laki', '2013-12-05', '2014-01-05', '2023-12-05', NULL, NULL, '085811223344', 'Pelajar', 'SMP', 'Anak pertama, juara olimpiade matematika', 'Hidup', 1, 1),
(5, 2, 'Kirana Hartono', 'Perempuan', '2016-07-19', '2016-08-19', NULL, NULL, NULL, '-', 'Pelajar', 'SD', 'Anak kedua, pandai menggambar', 'Hidup', 1, 1),
(6, 3, 'Leonardo Chen', 'Laki-laki', '2004-06-22', '2004-07-22', '2014-06-22', NULL, NULL, '085922334455', 'Mahasiswa', 'S1', 'Kuliah kedokteran, semester 5', 'Hidup', 1, 1),
(7, 3, 'Isabella Chen', 'Perempuan', '2007-11-15', '2007-12-15', '2017-11-15', NULL, NULL, '085033445566', 'Pelajar', 'SMA', 'Kelas 12, jurusan IPA', 'Hidup', 1, 1),
(8, 4, 'Nathan Pratama', 'Laki-laki', '2011-08-08', '2011-09-08', '2021-08-08', NULL, NULL, '085144556677', 'Pelajar', 'SMP', 'Anak pertama, aktif pramuka', 'Hidup', 1, 1),
(9, 4, 'Zoe Pratama', 'Perempuan', '2014-01-23', '2014-02-23', NULL, NULL, NULL, '-', 'Pelajar', 'SD', 'Anak kedua, suka membaca', 'Hidup', 1, 1),
(10, 4, 'Evan Pratama', 'Laki-laki', '2019-04-17', '2019-05-17', NULL, NULL, NULL, '-', 'Balita', '-', 'Anak bungsu, periang', 'Hidup', 1, 1),
(11, 5, 'Aurora Prabowo', 'Perempuan', '2008-12-30', '2009-01-30', '2018-12-30', NULL, NULL, '085255667788', 'Pelajar', 'SMP', 'Anak tunggal, juara lomba pidato', 'Hidup', 1, 1),
(12, 6, 'Sebastian Gunawan', 'Laki-laki', '2017-03-25', '2017-04-25', NULL, NULL, NULL, '-', 'Pelajar', 'TK', 'Anak pertama, cerdas dan kritis', 'Hidup', 1, 1),
(13, 6, 'Chloe Gunawan', 'Perempuan', '2020-06-08', '2020-07-08', NULL, NULL, NULL, '-', 'Balita', '-', 'Anak kedua, imut dan manja', 'Hidup', 1, 1),
(14, 7, 'Aiden Santosa', 'Laki-laki', '2012-09-11', '2012-10-11', '2022-09-11', NULL, NULL, '085366778899', 'Pelajar', 'SD', 'Kelas 6, pandai bahasa Inggris', 'Hidup', 1, 1),
(15, 8, 'Julian Halim', 'Laki-laki', '2005-01-28', '2005-02-28', '2015-01-28', NULL, NULL, '085477889900', 'Mahasiswa', 'D3', 'Kuliah desain grafis', 'Hidup', 1, 1),
(16, 8, 'Natalie Halim', 'Perempuan', '2009-05-14', '2009-06-14', '2019-05-14', NULL, NULL, '085588990011', 'Pelajar', 'SMP', 'Kelas 9, suka menyanyi', 'Hidup', 1, 1),
(25, 37, 'Kevin Setiawan', 'Laki-laki', '2010-03-15', '2010-04-15', NULL, NULL, NULL, '-', 'Pelajar', 'SMP', 'Anak pertama, juara matematika', 'Hidup', 1, 1),
(26, 37, 'Sofia Setiawan', 'Perempuan', '2014-07-22', '2014-08-22', NULL, NULL, NULL, '-', 'Pelajar', 'SD', 'Anak kedua, suka menari', 'Hidup', 1, 1),
(27, 38, 'Michelle Halim', 'Perempuan', '2016-12-08', '2017-01-08', NULL, NULL, NULL, '-', 'Pelajar', 'TK', 'Anak tunggal, pintar bernyanyi', 'Hidup', 1, 1),
(28, 39, 'Ryan Santoso', 'Laki-laki', '2008-05-20', '2008-06-20', NULL, NULL, NULL, '085811223344', 'Pelajar', 'SMA', 'Anak pertama, aktif basket', 'Hidup', 1, 1),
(29, 40, 'Diana Anggraeni', 'Perempuan', '2019-09-11', '2019-10-11', NULL, NULL, NULL, '-', 'Balita', '-', 'Anak bungsu, lucu dan aktif', 'Hidup', 1, 1),
(30, 41, 'Steven Wijaya', 'Laki-laki', '2015-02-28', '2015-03-28', NULL, NULL, NULL, '-', 'Pelajar', 'SD', 'Anak pertama, hobi robotik', 'Hidup', 1, 1),
(31, 42, 'Jessica Lim', 'Perempuan', '2012-11-05', '2012-12-05', NULL, NULL, NULL, '-', 'Pelajar', 'SMP', 'Anak tunggal, juara pidato', 'Hidup', 1, 1);

-- --------------------------------------------------------

--
-- Table structure for table `churches`
--

CREATE TABLE `churches` (
  `id` int(11) NOT NULL,
  `church_name` varchar(255) NOT NULL DEFAULT 'Gereja Default',
  `province` varchar(100) DEFAULT 'Sumatera Utara',
  `city` varchar(100) DEFAULT 'Medan',
  `address` text DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT 1,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `churches`
--

INSERT INTO `churches` (`id`, `church_name`, `province`, `city`, `address`, `phone`, `email`, `is_active`, `created_at`) VALUES
(1, 'Gereja Default', 'Sumatera Utara', 'Medan', NULL, NULL, NULL, 1, '2025-10-06 14:57:19'),
(2, 'GKPI Medan Kota', 'Sumatera Utara', 'Medan', 'Jl. Sudirman No. 123', '061-123456', 'medan@gkpi.org', 1, '2025-10-06 16:58:37'),
(3, 'GKPI Jakarta Pusat', 'DKI Jakarta', 'Jakarta', 'Jl. Thamrin No. 45', '021-654321', 'jakarta@gkpi.org', 1, '2025-10-06 16:58:37'),
(4, 'GKPI Bandung', 'Jawa Barat', 'Bandung', 'Jl. Asia Afrika No. 67', '022-789012', 'bandung@gkpi.org', 1, '2025-10-06 16:58:38'),
(5, 'GKPI Surabaya', 'Jawa Timur', 'Surabaya', 'Jl. Tunjungan No. 89', '031-345678', 'surabaya@gkpi.org', 1, '2025-10-06 16:58:38');

-- --------------------------------------------------------

--
-- Table structure for table `church_neighborhoods`
--

CREATE TABLE `church_neighborhoods` (
  `id` int(11) NOT NULL,
  `church_id` int(11) NOT NULL,
  `neighborhood_name` varchar(100) NOT NULL,
  `description` text DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `church_neighborhoods`
--

INSERT INTO `church_neighborhoods` (`id`, `church_id`, `neighborhood_name`, `description`, `created_at`) VALUES
(1, 1, 'Efata', 'Wilayah Pusat Medan', '2025-10-06 16:58:38'),
(2, 1, 'Bethania', 'Wilayah Medan Selatan', '2025-10-06 16:58:38'),
(3, 1, 'Sion', 'Wilayah Medan Barat', '2025-10-06 16:58:38'),
(4, 2, 'Alfa', 'Wilayah Jakarta Pusat', '2025-10-06 16:58:38'),
(5, 2, 'Beta', 'Wilayah Jakarta Selatan', '2025-10-06 16:58:38'),
(6, 3, 'Zion', 'Wilayah Bandung Pusat', '2025-10-06 16:58:38'),
(7, 3, 'Nazareth', 'Wilayah Bandung Utara', '2025-10-06 16:58:38'),
(8, 4, 'Ebenhaezer', 'Wilayah Surabaya Pusat', '2025-10-06 16:58:38'),
(9, 4, 'Getsemani', 'Wilayah Surabaya Barat', '2025-10-06 16:58:38');

-- --------------------------------------------------------

--
-- Table structure for table `families`
--

CREATE TABLE `families` (
  `id` int(11) NOT NULL,
  `church_id` int(11) DEFAULT NULL,
  `tenant_id` int(11) NOT NULL,
  `register_number` varchar(50) NOT NULL,
  `neighborhood` varchar(50) NOT NULL,
  `family_address` text NOT NULL,
  `father_name` varchar(100) DEFAULT NULL,
  `mother_name` varchar(100) DEFAULT NULL,
  `head_of_family` varchar(50) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  `updated_at` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `families`
--

INSERT INTO `families` (`id`, `church_id`, `tenant_id`, `register_number`, `neighborhood`, `family_address`, `father_name`, `mother_name`, `head_of_family`, `created_at`, `updated_at`) VALUES
(1, 1, 1, 'r45432445', 'Beta', 'asdfdsf', '', '', 'father', '2025-10-04 13:02:12', NULL),
(2, 1, 2, 'REG-PB-001', 'Alpha', 'Jl. Padang Bulan No. 123', 'Budi Santoso', 'Sari Dewi', 'father', '2025-10-06 11:05:35', NULL),
(3, 1, 3, 'REG-LT-001', 'Beta', 'Jl. Lontung No. 45', 'Joko Widodo', 'Maya Sari', 'father', '2025-10-06 11:05:35', NULL),
(4, 1, 4, 'REG-HP-001', 'Gamma', 'Jl. Hutapadang No. 67', 'Ahmad Yani', 'Diana Putri', 'father', '2025-10-06 11:05:35', NULL),
(8, 1, 2, 'FAM-PB-001', 'Alpha', 'Jl. Padang Bulan No. 123, Medan', 'Budi Santoso', 'Sari Dewi', 'father', '2025-10-06 11:12:32', NULL),
(9, 1, 2, 'FAM-PB-002', 'Beta', 'Jl. Padang Bulan No. 456, Medan', 'Ahmad Pratama', 'Rina Wijaya', 'father', '2025-10-06 11:12:32', NULL),
(10, 1, 3, 'FAM-LT-001', 'Gamma', 'Desa Pardomuan, Pulau Samosir', 'Toga Sitorus', 'Maria Lumban Gaol', 'father', '2025-10-06 11:12:32', NULL),
(11, 1, 3, 'FAM-LT-002', 'Delta', 'Desa Pardomuan, Pulau Samosir', 'Jonatan Simanjuntak', 'Borua Sihombing', 'father', '2025-10-06 11:12:32', NULL),
(12, 1, 2, 'FAM-PB-501', 'Alpha', 'Jl. Padang Bulan No. 123, Medan', 'Budi Santoso', 'Sari Dewi', 'father', '2025-10-06 11:19:50', NULL),
(13, 1, 2, 'FAM-PB-502', 'Beta', 'Jl. Padang Bulan No. 456, Medan', 'Ahmad Pratama', 'Rina Wijaya', 'father', '2025-10-06 11:19:50', NULL),
(14, 1, 3, 'FAM-LT-501', 'Gamma', 'Desa Pardomuan, Pulau Samosir', 'Toga Sitorus', 'Maria Lumban Gaol', 'father', '2025-10-06 11:19:50', NULL),
(15, 1, 3, 'FAM-LT-502', 'Delta', 'Desa Pardomuan, Pulau Samosir', 'Jonatan Simanjuntak', 'Borua Sihombing', 'father', '2025-10-06 11:19:50', NULL),
(16, 1, 4, 'FAM-HP-501', 'Epsilon', 'Jl. Hutapadang No. 78, Tapanuli Selatan', 'Slamet Riyadi', 'Rina Hutapadang', 'father', '2025-10-06 11:19:50', NULL),
(17, 1, 4, 'FAM-HP-502', 'Zeta', 'Jl. Hutapadang No. 90, Tapanuli Selatan', 'Surya Dharma', 'Murni Lestari', 'father', '2025-10-06 11:19:50', NULL);

-- --------------------------------------------------------

--
-- Table structure for table `family_members`
--

CREATE TABLE `family_members` (
  `id` int(11) NOT NULL,
  `tenant_id` int(11) NOT NULL,
  `family_id` int(11) NOT NULL,
  `name` varchar(100) NOT NULL,
  `relationship` enum('bapa','ibu','anak','tanggungan','saudara','lainnya') NOT NULL,
  `gender` enum('Laki-laki','Perempuan') DEFAULT NULL,
  `birth_date` date DEFAULT NULL,
  `address` text DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `occupation` varchar(100) DEFAULT NULL,
  `education` varchar(100) DEFAULT NULL,
  `status` enum('Aktif','Pasif','Pindah') DEFAULT 'Aktif',
  `is_deceased` tinyint(1) DEFAULT 0,
  `baptism_date` date DEFAULT NULL,
  `confirmation_date` date DEFAULT NULL,
  `marriage_date` date DEFAULT NULL,
  `death_date` date DEFAULT NULL,
  `created_by` int(11) DEFAULT NULL,
  `birth_certificate` varchar(255) DEFAULT NULL,
  `baptism_certificate` varchar(255) DEFAULT NULL,
  `confirmation_certificate` varchar(255) DEFAULT NULL,
  `marriage_certificate` varchar(255) DEFAULT NULL,
  `death_certificate` varchar(255) DEFAULT NULL,
  `notes` text DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  `updated_at` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `family_members`
--

INSERT INTO `family_members` (`id`, `tenant_id`, `family_id`, `name`, `relationship`, `gender`, `birth_date`, `address`, `phone`, `occupation`, `education`, `status`, `is_deceased`, `baptism_date`, `confirmation_date`, `marriage_date`, `death_date`, `created_by`, `birth_certificate`, `baptism_certificate`, `confirmation_certificate`, `marriage_certificate`, `death_certificate`, `notes`, `created_at`, `updated_at`) VALUES
(1, 1, 1, '', 'bapa', '', NULL, 'asdfdsf', '', '', '', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '', '2025-10-04 13:02:12', NULL),
(2, 1, 1, 'sdfadf', 'bapa', NULL, '2025-10-31', NULL, '434343', 'Pemerintahan', 'SMA/Sederajat', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'sudah wafat', '2025-10-04 13:02:12', NULL),
(3, 1, 1, 'ruslan', 'ibu', NULL, '2025-10-13', NULL, '0897667867', 'Pendidikan & Pengajaran', 'SMA/Sederajat', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'hidup', '2025-10-04 13:02:12', NULL),
(4, 2, 2, 'Budi Santoso', 'bapa', 'Laki-laki', '1975-05-15', NULL, '081234567890', 'Pemerintahan', 'Sarjana', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2025-10-06 11:05:36', NULL),
(5, 2, 2, 'Sari Dewi', 'ibu', 'Perempuan', '1978-08-20', NULL, '081234567891', 'Pendidikan & Pengajaran', 'Sarjana', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2025-10-06 11:05:36', NULL),
(6, 3, 3, 'Joko Widodo', 'bapa', 'Laki-laki', '1970-03-10', NULL, '081234567892', 'Wiraswasta', 'SMA/Sederajat', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2025-10-06 11:05:36', NULL),
(7, 3, 3, 'Maya Sari', 'ibu', 'Perempuan', '1972-11-25', NULL, '081234567893', 'Ibu Rumah Tangga', 'SMA/Sederajat', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2025-10-06 11:05:36', NULL),
(8, 2, 2, 'Budi Santoso', 'bapa', 'Laki-laki', '1975-05-15', NULL, '081234567890', 'Pemerintahan', 'Sarjana', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2025-10-06 11:08:19', NULL),
(9, 2, 2, 'Sari Dewi', 'ibu', 'Perempuan', '1978-08-20', NULL, '081234567891', 'Pendidikan & Pengajaran', 'Sarjana', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2025-10-06 11:08:19', NULL),
(10, 3, 3, 'Joko Widodo', 'bapa', 'Laki-laki', '1970-03-10', NULL, '081234567892', 'Wiraswasta', 'SMA/Sederajat', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2025-10-06 11:08:19', NULL),
(11, 3, 3, 'Maya Sari', 'ibu', 'Perempuan', '1972-11-25', NULL, '081234567893', 'Ibu Rumah Tangga', 'SMA/Sederajat', 'Aktif', 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2025-10-06 11:08:19', NULL);

-- --------------------------------------------------------

--
-- Table structure for table `fathers`
--

CREATE TABLE `fathers` (
  `id` int(11) NOT NULL,
  `member_id` int(11) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `gender` varchar(10) DEFAULT 'Laki-laki',
  `birth_date` date DEFAULT NULL,
  `baptism_date` date DEFAULT NULL,
  `confirmation_date` date DEFAULT NULL,
  `marriage_date` date DEFAULT NULL,
  `death_date` date DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `occupation` varchar(100) DEFAULT NULL,
  `education` varchar(100) DEFAULT NULL,
  `notes` text DEFAULT NULL,
  `status` varchar(20) DEFAULT 'Hidup',
  `is_alive` tinyint(1) DEFAULT 1,
  `tenant_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `fathers`
--

INSERT INTO `fathers` (`id`, `member_id`, `name`, `gender`, `birth_date`, `baptism_date`, `confirmation_date`, `marriage_date`, `death_date`, `phone`, `occupation`, `education`, `notes`, `status`, `is_alive`, `tenant_id`) VALUES
(1, 1, 'Raden Wijaya Kusuma', 'Laki-laki', '1957-04-18', '1957-05-18', '1967-04-18', '1983-09-22', NULL, '085711223344', 'Arsitek', 'S1', 'Ayah Anton, spesialis desain bangunan tradisional', 'Hidup', 1, 1),
(2, 2, 'Surya Dharma Putra', 'Laki-laki', '1961-08-25', '1961-09-25', '1971-08-25', '1987-12-15', '2019-03-08', '085822334455', 'Ahli Pertanian', 'S2', 'Ayah Budi, peneliti tanaman pangan', 'Meninggal', 0, 1),
(3, 3, 'Alexander Chen', 'Laki-laki', '1952-12-12', '1953-01-12', '1963-12-12', '1976-07-28', NULL, '085933445566', 'Dokter Bedah', 'S3', 'Ayah Caroline, spesialis bedah jantung', 'Hidup', 1, 1),
(4, 4, 'Bambang Suryanto', 'Laki-laki', '1959-03-07', '1959-04-07', '1969-03-07', '1985-10-18', NULL, '085044556677', 'Kontraktor Jalan', 'D3', 'Ayah Dian, ahli konstruksi infrastruktur', 'Hidup', 1, 1),
(5, 5, 'Joko Prabowo', 'Laki-laki', '1954-11-21', '1954-12-21', '1964-11-21', '1980-08-12', '2021-11-05', '085155667788', 'Petani Kopi', 'SMP', 'Ayah Eko, petani kopi organik', 'Meninggal', 0, 1),
(6, 6, 'Richard Gunawan', 'Laki-laki', '1951-06-14', '1951-07-14', '1961-06-14', '1977-04-03', NULL, '085266778899', 'Konsultan Pajak', 'S1', 'Ayah John, konsultan keuangan perusahaan', 'Hidup', 1, 1),
(7, 7, 'William Santosa', 'Laki-laki', '1947-02-28', '1947-03-28', '1957-02-28', '1973-11-17', '2016-09-22', '085377889900', 'Guru Besar', 'S3', 'Ayah Jane, profesor linguistik', 'Meninggal', 0, 1),
(8, 8, 'Robert Halim', 'Laki-laki', '1949-09-05', '1949-10-05', '1959-09-05', '1974-05-20', NULL, '085488990011', 'Pengusaha Hotel', 'SMA', 'Ayah Bob, pemilik jaringan hotel', 'Hidup', 1, 1),
(21, 21, 'Hendra Setiawan', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(22, 22, 'Charles Halim', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(23, 23, 'Budi Santoso', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(24, 24, 'Joni Anggraeni', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(25, 25, 'Tony Wijaya', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(26, 26, 'Michael Lim', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(27, 27, 'Roni Pratama', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(28, 28, 'Slamet Lestari', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(29, 29, 'Surya Kencana', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(30, 30, 'Richard Wang', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(31, 31, 'Suharto Prasetyo', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(32, 32, 'Albert Halim', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(33, 33, 'Haryanto Setia', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(34, 34, 'Budi Santoso', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(35, 35, 'William Chen', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(36, 36, 'Robert Wijaya', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(50, 37, 'Hendra Setiawan', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(51, 38, 'Charles Halim', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(52, 39, 'Budi Santoso', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(53, 40, 'Joni Anggraeni', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(54, 41, 'Tony Wijaya', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(55, 42, 'Michael Lim', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(56, 43, 'Roni Pratama', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(57, 44, 'Slamet Lestari', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(58, 45, 'Surya Kencana', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(59, 46, 'Richard Wang', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(60, 47, 'Suharto Prasetyo', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(61, 48, 'Albert Halim', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(62, 49, 'Haryanto Setia', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 1),
(63, 56, 'Budi Santoso', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 2),
(64, 57, 'Joko Widodo', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 2),
(65, 58, 'Toga Sitorus', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 3),
(66, 59, 'Mangara Sinaga', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 3),
(67, 60, 'Slamet Riyadi', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 4),
(68, 61, 'Surya Dharma', 'Laki-laki', NULL, NULL, NULL, NULL, NULL, NULL, 'Retired', NULL, NULL, 'Hidup', 1, 4);

--
-- Triggers `fathers`
--
DELIMITER $$
CREATE TRIGGER `after_fathers_delete` AFTER DELETE ON `fathers` FOR EACH ROW BEGIN
    UPDATE members SET
        father_name = NULL,
        father_phone = NULL,
        father_education = NULL,
        father_notes = NULL
    WHERE id = OLD.member_id;
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `after_fathers_update` AFTER UPDATE ON `fathers` FOR EACH ROW BEGIN
    UPDATE members SET
        father_name = NEW.name,
        father_phone = NEW.phone,
        father_education = NEW.education,
        father_notes = NEW.notes
    WHERE id = NEW.member_id;
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `guardians`
--

CREATE TABLE `guardians` (
  `id` int(11) NOT NULL,
  `member_id` int(11) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `gender` varchar(10) DEFAULT NULL,
  `birth_date` date DEFAULT NULL,
  `baptism_date` date DEFAULT NULL,
  `confirmation_date` date DEFAULT NULL,
  `marriage_date` date DEFAULT NULL,
  `death_date` date DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `occupation` varchar(100) DEFAULT NULL,
  `education` varchar(100) DEFAULT NULL,
  `notes` text DEFAULT NULL,
  `status` varchar(20) DEFAULT 'Hidup',
  `is_alive` tinyint(1) DEFAULT 1,
  `tenant_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `guardians`
--

INSERT INTO `guardians` (`id`, `member_id`, `name`, `gender`, `birth_date`, `baptism_date`, `confirmation_date`, `marriage_date`, `death_date`, `phone`, `occupation`, `education`, `notes`, `status`, `is_alive`, `tenant_id`) VALUES
(1, 1, 'Felix Kurniawan', 'Laki-laki', '1974-09-15', '1974-10-15', '1984-09-15', '1999-07-25', NULL, '085811223377', 'IT Consultant', 'S1', 'Saudara ipar, wali teknologi', 'Hidup', 1, 1),
(2, 1, 'Gisella Dewi', 'Perempuan', '1979-04-28', '1979-05-28', '1989-04-28', '2004-12-18', NULL, '085922334488', 'Dosen Bahasa', 'S2', 'Sepupu, wali pendidikan bahasa', 'Hidup', 1, 1),
(3, 2, 'Rangga Aditya', 'Laki-laki', '1967-01-08', '1967-02-08', '1977-01-08', '1994-10-05', NULL, '085033445599', 'Pengusaha Transportasi', 'SMA', 'Paman, wali logistik', 'Hidup', 1, 1),
(4, 3, 'Victoria Chen', 'Perempuan', '1981-07-19', '1981-08-19', '1991-07-19', '2009-06-15', NULL, '085144556600', 'Dokter Umum', 'S1', 'Sepupu, wali kesehatan umum', 'Hidup', 1, 1),
(5, 3, 'Nicholas Chen', 'Laki-laki', '1977-12-03', '1978-01-03', '1988-12-03', '2007-09-25', NULL, '085255667711', 'Manajer Proyek', 'S2', 'Saudara, wali manajemen', 'Hidup', 1, 1),
(6, 4, 'Melati Sari', 'Perempuan', '1969-05-16', '1969-06-16', '1979-05-16', '1997-03-02', NULL, '085366778822', 'Ibu Rumah Tangga', 'SMA', 'Bibi, wali pengasuhan harian', 'Hidup', 1, 1),
(7, 5, 'Darmawan Putra', 'Laki-laki', '1964-08-29', '1964-09-29', '1974-08-29', '1991-12-13', '2022-04-07', '085477889933', 'Pensiunan Bank', 'S1', 'Paman, wali keuangan sebelumnya', 'Meninggal', 0, 1),
(8, 6, 'Gregory Gunawan', 'Laki-laki', '1971-02-11', '1971-03-11', '1981-02-11', '2001-10-08', NULL, '085588990044', 'Pengacara Perdata', 'S2', 'Saudara, wali hukum perdata', 'Hidup', 1, 1),
(9, 7, 'Helena Santosa', 'Perempuan', '1974-11-24', '1974-12-24', '1984-11-24', '2002-02-21', NULL, '085699001155', 'Dokter Spesialis', 'S2', 'Saudara, wali medis spesialis', 'Hidup', 1, 1),
(10, 8, 'Frederick Halim', 'Laki-laki', '1959-03-17', '1959-04-17', '1969-03-17', '1984-08-03', NULL, '085700112266', 'Pengusaha Properti', 'S1', 'Paman, wali investasi properti', 'Hidup', 1, 1);

-- --------------------------------------------------------

--
-- Table structure for table `members`
--

CREATE TABLE `members` (
  `id` int(11) NOT NULL,
  `church_id` int(11) NOT NULL DEFAULT 1,
  `name` varchar(100) NOT NULL,
  `address` text DEFAULT NULL,
  `neighborhood` varchar(50) DEFAULT NULL,
  `register_number` varchar(50) DEFAULT NULL,
  `father_name` varchar(100) DEFAULT NULL,
  `mother_name` varchar(100) DEFAULT NULL,
  `child_name` varchar(100) DEFAULT NULL,
  `guardian` varchar(100) DEFAULT NULL,
  `gender` varchar(10) DEFAULT NULL,
  `birth_date` date DEFAULT NULL,
  `baptism_date` date DEFAULT NULL,
  `confirmation_date` date DEFAULT NULL,
  `marriage_date` date DEFAULT NULL,
  `death_date` date DEFAULT NULL,
  `birth_file` varchar(255) DEFAULT NULL,
  `baptism_file` varchar(255) DEFAULT NULL,
  `confirmation_file` varchar(255) DEFAULT NULL,
  `marriage_file` varchar(255) DEFAULT NULL,
  `death_file` varchar(255) DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `occupation` varchar(100) DEFAULT NULL,
  `education` varchar(100) DEFAULT NULL,
  `created_by` int(11) DEFAULT NULL,
  `status` varchar(20) DEFAULT 'Hidup',
  `is_alive` tinyint(1) DEFAULT 1,
  `notes` text DEFAULT NULL,
  `father_phone` varchar(20) DEFAULT NULL,
  `father_education` varchar(100) DEFAULT NULL,
  `father_notes` text DEFAULT NULL,
  `mother_phone` varchar(20) DEFAULT NULL,
  `mother_education` varchar(100) DEFAULT NULL,
  `mother_notes` text DEFAULT NULL,
  `tenant_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `members`
--

INSERT INTO `members` (`id`, `church_id`, `name`, `address`, `neighborhood`, `register_number`, `father_name`, `mother_name`, `child_name`, `guardian`, `gender`, `birth_date`, `baptism_date`, `confirmation_date`, `marriage_date`, `death_date`, `birth_file`, `baptism_file`, `confirmation_file`, `marriage_file`, `death_file`, `phone`, `occupation`, `education`, `created_by`, `status`, `is_alive`, `notes`, `father_phone`, `father_education`, `father_notes`, `mother_phone`, `mother_education`, `mother_notes`, `tenant_id`) VALUES
(1, 1, 'Anton Tanuwijaya', 'Jl. Merdeka 123', 'Efata', 'REG202401', 'Raden Wijaya Kusuma', 'Liana Dewi', 'Michael Tanuwijaya', 'Bambang Tanuwijaya', 'Laki-laki', '1990-08-15', '1990-09-15', '2000-08-15', '2015-06-20', NULL, NULL, NULL, NULL, NULL, NULL, '08123456789', 'Software Engineer', 'Bachelor', 1, 'Hidup', 1, 'Notes for John', '08123456780', 'High School', 'Father notes', '08123456781', 'Middle School', 'Mother notes', 1),
(2, 1, 'Budi Hartono', 'Jl. Sudirman 456', 'Bethania', 'REG202402', 'Surya Dharma Putra', 'Sofia Anggraeni', 'Kevin Hartono', 'Tono Hartono', 'Laki-laki', '1985-03-25', '1985-04-25', '1995-03-25', '2010-11-15', NULL, NULL, NULL, NULL, NULL, NULL, '08134567890', 'Teacher', 'Master', 1, 'Hidup', 1, 'Notes for Jane', '08198765430', 'Bachelor', 'Father Smith notes', '08198765431', 'Associate', 'Mother Mary notes', 1),
(3, 1, 'Caroline Lim', 'Jl. Thamrin 789', 'Sion', 'REG202403', 'Alexander Chen', 'Elizabeth Wang', 'Jessica Lim', 'Robert Lim', 'Perempuan', '1980-12-10', '1981-01-10', '1991-12-10', '2003-04-05', NULL, NULL, NULL, NULL, NULL, NULL, '08145678901', 'Doctor', 'Specialist', 2, 'Hidup', 1, 'Notes for Bob', '08111222330', 'PhD', 'Father Wilson notes', '08111222331', 'Masters', 'Mother Alice notes', 1),
(4, 1, 'Dian Pratama', 'Jl. Gatot Subroto 321', 'Moria', 'REG202404', 'Bambang Suryanto', 'Sari Indah', 'Daniel Pratama', 'Surya Pratama', 'Perempuan', '1993-07-18', '1993-08-18', '2003-07-18', '2018-09-12', NULL, NULL, NULL, NULL, NULL, NULL, '08156789012', 'Architect', 'Bachelor', 2, 'Hidup', 1, 'Choir member', '08188990011', 'High School', 'Father notes for Dian', '08199001122', 'High School', 'Mother notes for Dian', 1),
(5, 1, 'Eko Santoso', 'Jl. Ahmad Yani 654', 'Kanaan', 'REG202405', 'Joko Prabowo', 'Rina Permatasari', 'Ahmad Santoso', 'Slamet Santoso', 'Laki-laki', '1978-02-28', '1978-03-28', '1988-02-28', '2000-10-08', '2024-01-15', NULL, NULL, NULL, NULL, NULL, '08167890123', 'Businessman', 'High School', 1, 'Meninggal', 0, 'Passed away due to illness', '08111222333', 'High School', 'Father notes for Eko', '08122334455', 'Middle School', 'Mother notes for Eko', 1),
(6, 1, 'John Doe', 'Jl. Sudirman 123', 'Alfa', 'REG001', 'Richard Gunawan', 'Jennifer Susanto', 'Child John', 'Guardian John', 'Laki-laki', '1990-01-01', '1990-02-01', '2000-01-01', '2010-01-01', NULL, NULL, NULL, NULL, NULL, NULL, '08123456789', 'Engineer', 'Bachelor', 1, 'Hidup', 1, 'Notes for John', '08123456780', 'High School', 'Father notes', '08123456781', 'Middle School', 'Mother notes', 1),
(7, 1, 'Jane Smith', 'Jl. Thamrin 456', 'Beta', 'REG002', 'William Santosa', 'Mary Theresia', 'Child Jane', 'Guardian Jane', 'Perempuan', '1985-05-05', '1985-06-05', '1995-05-05', '2005-05-05', NULL, NULL, NULL, NULL, NULL, NULL, '08198765432', 'Teacher', 'Master', 1, 'Hidup', 1, 'Notes for Jane', '08198765430', 'Bachelor', 'Father Smith notes', '08198765431', 'Associate', 'Mother Mary notes', 1),
(8, 1, 'Bob Wilson', 'Jl. Malioboro 789', 'Teta', 'REG003', 'Robert Halim', 'Patricia Halim', 'Child Bob', 'Guardian Bob', 'Laki-laki', '1975-10-10', '1975-11-10', '1985-10-10', '1995-10-10', '2020-10-10', NULL, NULL, NULL, NULL, NULL, '08111222333', 'Doctor', 'Doctorate', 1, 'Hidup', 1, 'Notes for Bob', '08111222330', 'PhD', 'Father Wilson notes', '08111222331', 'Masters', 'Mother Alice notes', 1),
(21, 1, 'David Setiawan', 'Jl. Diponegoro 101', 'Efata', 'REG202406', 'Hendra Setiawan', 'Maya Sari', 'Kevin Setiawan', 'Rudi Setiawan', 'Laki-laki', '1982-04-12', '1982-05-12', '1992-04-12', '2007-08-20', NULL, NULL, NULL, NULL, NULL, NULL, '08178901234', 'Akuntan', 'S1', 1, 'Hidup', 1, 'Aktif di kegiatan pemuda gereja', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(22, 1, 'Lisa Halim', 'Jl. Gajah Mada 202', 'Bethania', 'REG202407', 'Charles Halim', 'Susan Wijaya', 'Michelle Halim', 'Andrew Halim', 'Perempuan', '1988-09-25', '1988-10-25', '1998-09-25', '2013-11-15', NULL, NULL, NULL, NULL, NULL, NULL, '08189012345', 'Dokter Gigi', 'S2', 1, 'Hidup', 1, 'Spesialis ortodonti', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(23, 1, 'Rudi Santoso', 'Jl. Hayam Wuruk 303', 'Sion', 'REG202408', 'Budi Santoso', 'Dewi Lestari', 'Ryan Santoso', 'Ari Santoso', 'Laki-laki', '1975-12-08', '1976-01-08', '1986-12-08', '1998-05-30', NULL, NULL, NULL, NULL, NULL, NULL, '08190123456', 'Pengusaha', 'SMA', 1, 'Hidup', 1, 'Pemilik restoran keluarga', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(24, 1, 'Maya Anggraeni', 'Jl. Pahlawan 404', 'Moria', 'REG202409', 'Joni Anggraeni', 'Rita Susanti', 'Diana Anggraeni', 'Eko Anggraeni', 'Perempuan', '1991-03-17', '1991-04-17', '2001-03-17', '2016-07-22', NULL, NULL, NULL, NULL, NULL, NULL, '08201234567', 'Guru SD', 'S1', 1, 'Hidup', 1, 'Wali kelas 3', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(25, 1, 'Kevin Wijaya', 'Jl. Merdeka Timur 505', 'Kanaan', 'REG202410', 'Tony Wijaya', 'Lily Chen', 'Steven Wijaya', 'Brian Wijaya', 'Laki-laki', '1987-06-30', '1987-07-30', '1997-06-30', '2012-04-18', NULL, NULL, NULL, NULL, NULL, NULL, '08212345678', 'Programmer', 'S1', 1, 'Hidup', 1, 'Fullstack developer', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(26, 1, 'Sarah Lim', 'Jl. Sudirman Barat 606', 'Efata', 'REG202411', 'Michael Lim', 'Anna Tan', 'Jessica Lim', 'Daniel Lim', 'Perempuan', '1984-11-14', '1984-12-14', '1994-11-14', '2009-09-08', NULL, NULL, NULL, NULL, NULL, NULL, '08223456789', 'Marketing Manager', 'S2', 1, 'Hidup', 1, 'Head of marketing department', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(27, 1, 'Andi Pratama', 'Jl. Thamrin Utara 707', 'Bethania', 'REG202412', 'Roni Pratama', 'Siska Dewi', 'Ahmad Pratama', 'Fajar Pratama', 'Laki-laki', '1979-02-28', '1979-03-28', '1989-02-28', '2004-12-10', NULL, NULL, NULL, NULL, NULL, NULL, '08234567890', 'Kontraktor', 'D3', 1, 'Hidup', 1, 'Spesialis bangunan rumah', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(28, 1, 'Dewi Lestari', 'Jl. Gatot Subroto 808', 'Sion', 'REG202413', 'Slamet Lestari', 'Murni Lestari', 'Rina Lestari', 'Joko Lestari', 'Perempuan', '1986-08-05', '1986-09-05', '1996-08-05', '2011-06-25', NULL, NULL, NULL, NULL, NULL, NULL, '08245678901', 'Perawat', 'D3', 1, 'Hidup', 1, 'Bekerja di RS umum', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(29, 1, 'Bambang Surya', 'Jl. Ahmad Yani 909', 'Moria', 'REG202414', 'Surya Kencana', 'Maya Surya', 'Rizky Surya', 'Dodi Surya', 'Laki-laki', '1972-05-19', '1972-06-19', '1982-05-19', '1995-03-14', NULL, NULL, NULL, NULL, NULL, NULL, '08256789012', 'Wiraswasta', 'SMA', 1, 'Hidup', 1, 'Pemilik toko material bangunan', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(30, 1, 'Cynthia Wang', 'Jl. Diponegoro 1010', 'Kanaan', 'REG202415', 'Richard Wang', 'Linda Wang', 'Victoria Wang', 'Steven Wang', 'Perempuan', '1993-01-22', '1993-02-22', '2003-01-22', '2018-10-05', NULL, NULL, NULL, NULL, NULL, NULL, '08267890123', 'Desainer Interior', 'S1', 1, 'Hidup', 1, 'Spesialis desain rumah minimalis', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(31, 1, 'Eko Prasetyo', 'Jl. Gajah Mada 1111', 'Efata', 'REG202416', 'Suharto Prasetyo', 'Sari Prasetyo', 'Dimas Prasetyo', 'Toni Prasetyo', 'Laki-laki', '1980-07-07', '1980-08-07', '1990-07-07', '2005-01-28', NULL, NULL, NULL, NULL, NULL, NULL, '08278901234', 'PNS', 'S1', 1, 'Hidup', 1, 'Bekerja di dinas pendidikan', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(32, 1, 'Fiona Halim', 'Jl. Hayam Wuruk 1212', 'Bethania', 'REG202417', 'Albert Halim', 'Grace Halim', 'Natalie Halim', 'Kevin Halim', 'Perempuan', '1989-04-15', '1989-05-15', '1999-04-15', '2014-08-12', NULL, NULL, NULL, NULL, NULL, NULL, '08289012345', 'Dosen', 'S3', 1, 'Hidup', 1, 'Dosen fakultas ekonomi', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(33, 1, 'Gunawan Setia', 'Jl. Pahlawan 1313', 'Sion', 'REG202418', 'Haryanto Setia', 'Yuni Setia', 'Rendra Setia', 'Ari Setia', 'Laki-laki', '1977-10-03', '1977-11-03', '1987-10-03', '2002-02-20', NULL, NULL, NULL, NULL, NULL, NULL, '08290123456', 'Manager Bank', 'S2', 1, 'Hidup', 1, 'Branch manager bank BCA', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(34, 1, 'Hana Santoso', 'Jl. Merdeka Barat 1414', 'Moria', 'REG202419', 'Budi Santoso', 'Ani Santoso', 'Lia Santoso', 'Rudi Santoso', 'Perempuan', '1983-12-18', '1984-01-18', '1994-12-18', '2008-07-30', NULL, NULL, NULL, NULL, NULL, NULL, '08301234567', 'Apoteker', 'S1', 1, 'Hidup', 1, 'Pemilik apotek', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(35, 1, 'Ivan Chen', 'Jl. Sudirman Timur 1515', 'Kanaan', 'REG202420', 'William Chen', 'Sarah Chen', 'Jason Chen', 'Ryan Chen', 'Laki-laki', '1974-09-09', '1974-10-09', '1984-09-09', '1999-04-22', NULL, NULL, NULL, NULL, NULL, NULL, '08312345678', 'Konsultan IT', 'S2', 1, 'Hidup', 1, 'IT consultant untuk perusahaan multinasional', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(36, 1, 'Julia Wijaya', 'Jl. Thamrin Selatan 1616', 'Efata', 'REG202421', 'Robert Wijaya', 'Maria Wijaya', 'Claudia Wijaya', 'David Wijaya', 'Perempuan', '1990-06-24', '1990-07-24', '2000-06-24', '2015-12-08', NULL, NULL, NULL, NULL, NULL, NULL, '08323456789', 'Psikolog', 'S2', 1, 'Hidup', 1, 'Konsultan psikologi anak', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(37, 1, 'David Setiawan', 'Jl. Diponegoro 101', 'Efata', 'REG202437', 'Hendra Setiawan', NULL, 'Kevin Setiawan', 'Rudi Setiawan', 'Laki-laki', '1982-04-12', '1982-05-12', '1992-04-12', '2007-08-20', NULL, NULL, NULL, NULL, NULL, NULL, '08178901234', 'Akuntan', 'S1', 1, 'Hidup', 1, 'Aktif di kegiatan pemuda gereja', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(38, 1, 'Lisa Halim', 'Jl. Gajah Mada 202', 'Bethania', 'REG202438', 'Charles Halim', NULL, 'Michelle Halim', 'Andrew Halim', 'Perempuan', '1988-09-25', '1988-10-25', '1998-09-25', '2013-11-15', NULL, NULL, NULL, NULL, NULL, NULL, '08189012345', 'Dokter Gigi', 'S2', 1, 'Hidup', 1, 'Spesialis ortodonti', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(39, 1, 'Rudi Santoso', 'Jl. Hayam Wuruk 303', 'Sion', 'REG202439', 'Budi Santoso', NULL, 'Ryan Santoso', 'Ari Santoso', 'Laki-laki', '1975-12-08', '1976-01-08', '1986-12-08', '1998-05-30', NULL, NULL, NULL, NULL, NULL, NULL, '08190123456', 'Pengusaha', 'SMA', 1, 'Hidup', 1, 'Pemilik restoran keluarga', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(40, 1, 'Maya Anggraeni', 'Jl. Pahlawan 404', 'Moria', 'REG202440', 'Joni Anggraeni', NULL, 'Diana Anggraeni', 'Eko Anggraeni', 'Perempuan', '1991-03-17', '1991-04-17', '2001-03-17', '2016-07-22', NULL, NULL, NULL, NULL, NULL, NULL, '08201234567', 'Guru SD', 'S1', 1, 'Hidup', 1, 'Wali kelas 3', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(41, 1, 'Kevin Wijaya', 'Jl. Merdeka Timur 505', 'Kanaan', 'REG202441', 'Tony Wijaya', NULL, 'Steven Wijaya', 'Brian Wijaya', 'Laki-laki', '1987-06-30', '1987-07-30', '1997-06-30', '2012-04-18', NULL, NULL, NULL, NULL, NULL, NULL, '08212345678', 'Programmer', 'S1', 1, 'Hidup', 1, 'Fullstack developer', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(42, 1, 'Sarah Lim', 'Jl. Sudirman Barat 606', 'Efata', 'REG202442', 'Michael Lim', NULL, 'Jessica Lim', 'Daniel Lim', 'Perempuan', '1984-11-14', '1984-12-14', '1994-11-14', '2009-09-08', NULL, NULL, NULL, NULL, NULL, NULL, '08223456789', 'Marketing Manager', 'S2', 1, 'Hidup', 1, 'Head of marketing department', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(43, 1, 'Andi Pratama', 'Jl. Thamrin Utara 707', 'Bethania', 'REG202443', 'Roni Pratama', NULL, 'Ahmad Pratama', 'Fajar Pratama', 'Laki-laki', '1979-02-28', '1979-03-28', '1989-02-28', '2004-12-10', NULL, NULL, NULL, NULL, NULL, NULL, '08234567890', 'Kontraktor', 'D3', 1, 'Hidup', 1, 'Spesialis bangunan rumah', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(44, 1, 'Dewi Lestari', 'Jl. Gatot Subroto 808', 'Sion', 'REG202444', 'Slamet Lestari', NULL, 'Rina Lestari', 'Joko Lestari', 'Perempuan', '1986-08-05', '1986-09-05', '1996-08-05', '2011-06-25', NULL, NULL, NULL, NULL, NULL, NULL, '08245678901', 'Perawat', 'D3', 1, 'Hidup', 1, 'Bekerja di RS umum', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(45, 1, 'Bambang Surya', 'Jl. Ahmad Yani 909', 'Moria', 'REG202445', 'Surya Kencana', NULL, 'Rizky Surya', 'Dodi Surya', 'Laki-laki', '1972-05-19', '1972-06-19', '1982-05-19', '1995-03-14', NULL, NULL, NULL, NULL, NULL, NULL, '08256789012', 'Wiraswasta', 'SMA', 1, 'Hidup', 1, 'Pemilik toko material bangunan', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(46, 1, 'Cynthia Wang', 'Jl. Diponegoro 1010', 'Kanaan', 'REG202446', 'Richard Wang', NULL, 'Victoria Wang', 'Steven Wang', 'Perempuan', '1993-01-22', '1993-02-22', '2003-01-22', '2018-10-05', NULL, NULL, NULL, NULL, NULL, NULL, '08267890123', 'Desainer Interior', 'S1', 1, 'Hidup', 1, 'Spesialis desain rumah minimalis', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(47, 1, 'Eko Prasetyo', 'Jl. Gajah Mada 1111', 'Efata', 'REG202447', 'Suharto Prasetyo', NULL, 'Dimas Prasetyo', 'Toni Prasetyo', 'Laki-laki', '1980-07-07', '1980-08-07', '1990-07-07', '2005-01-28', NULL, NULL, NULL, NULL, NULL, NULL, '08278901234', 'PNS', 'S1', 1, 'Hidup', 1, 'Bekerja di dinas pendidikan', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(48, 1, 'Fiona Halim', 'Jl. Hayam Wuruk 1212', 'Bethania', 'REG202448', 'Albert Halim', NULL, 'Natalie Halim', 'Kevin Halim', 'Perempuan', '1989-04-15', '1989-05-15', '1999-04-15', '2014-08-12', NULL, NULL, NULL, NULL, NULL, NULL, '08289012345', 'Dosen', 'S3', 1, 'Hidup', 1, 'Dosen fakultas ekonomi', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(49, 1, 'Gunawan Setia', 'Jl. Pahlawan 1313', 'Sion', 'REG202449', 'Haryanto Setia', NULL, 'Rendra Setia', 'Ari Setia', 'Laki-laki', '1977-10-03', '1977-11-03', '1987-10-03', '2002-02-20', NULL, NULL, NULL, NULL, NULL, NULL, '08290123456', 'Manager Bank', 'S2', 1, 'Hidup', 1, 'Branch manager bank BCA', NULL, NULL, NULL, NULL, NULL, NULL, 1),
(50, 1, 'Sari Dewi', 'Jl. Padang Bulan No. 45', 'Alpha', 'REG-PB-001', 'Budi Santoso', 'Maya Sari', NULL, NULL, 'Perempuan', '1980-05-15', '1980-06-15', '1990-05-15', '2005-08-20', NULL, NULL, NULL, NULL, NULL, NULL, '081234567890', 'Guru', 'S1', 1, 'Hidup', 1, 'Aktif di kegiatan wanita gereja', NULL, NULL, NULL, NULL, NULL, NULL, 2),
(51, 1, 'Ahmad Pratama', 'Jl. Padang Bulan No. 67', 'Beta', 'REG-PB-002', 'Joko Widodo', 'Dewi Lestari', NULL, NULL, 'Laki-laki', '1975-12-10', '1976-01-10', '1986-12-10', '2000-11-15', NULL, NULL, NULL, NULL, NULL, NULL, '081234567891', 'Wiraswasta', 'SMA', 1, 'Hidup', 1, 'Pengusaha konveksi', NULL, NULL, NULL, NULL, NULL, NULL, 2),
(52, 1, 'Maria Lumban Gaol', 'Desa Pardomuan, Lontung', 'Gamma', 'REG-LT-001', 'Toga Sitorus', 'Borua Sihombing', NULL, NULL, 'Perempuan', '1978-08-20', '1978-09-20', '1988-08-20', '2003-06-25', NULL, NULL, NULL, NULL, NULL, NULL, '081345678901', 'Ibu Rumah Tangga', 'SMA', 1, 'Hidup', 1, 'Anggota aktif persekutuan doa', NULL, NULL, NULL, NULL, NULL, NULL, 3),
(53, 1, 'Jonatan Simanjuntak', 'Desa Pardomuan, Lontung', 'Delta', 'REG-LT-002', 'Mangara Sinaga', 'Lumban Tobing', NULL, NULL, 'Laki-laki', '1972-03-12', '1972-04-12', '1982-03-12', '1998-09-18', NULL, NULL, NULL, NULL, NULL, NULL, '081345678902', 'Petani', 'SMP', 1, 'Hidup', 1, 'Petani kopi tradisional', NULL, NULL, NULL, NULL, NULL, NULL, 3),
(56, 1, 'Sari Dewi Padang', 'Jl. Padang Bulan No. 45', 'Alpha', 'REG-PB-501', 'Budi Santoso', 'Maya Sari', NULL, NULL, 'Perempuan', '1980-05-15', '1980-06-15', '1990-05-15', '2005-08-20', NULL, NULL, NULL, NULL, NULL, NULL, '081234567890', 'Guru', 'S1', 1, 'Hidup', 1, 'Aktif di kegiatan wanita gereja', NULL, NULL, NULL, NULL, NULL, NULL, 2),
(57, 1, 'Ahmad Pratama Padang', 'Jl. Padang Bulan No. 67', 'Beta', 'REG-PB-502', 'Joko Widodo', 'Dewi Lestari', NULL, NULL, 'Laki-laki', '1975-12-10', '1976-01-10', '1986-12-10', '2000-11-15', NULL, NULL, NULL, NULL, NULL, NULL, '081234567891', 'Wiraswasta', 'SMA', 1, 'Hidup', 1, 'Pengusaha konveksi', NULL, NULL, NULL, NULL, NULL, NULL, 2),
(58, 1, 'Maria Lumban Gaol', 'Desa Pardomuan, Lontung', 'Gamma', 'REG-LT-501', 'Toga Sitorus', 'Borua Sihombing', NULL, NULL, 'Perempuan', '1978-08-20', '1978-09-20', '1988-08-20', '2003-06-25', NULL, NULL, NULL, NULL, NULL, NULL, '081345678901', 'Ibu Rumah Tangga', 'SMA', 1, 'Hidup', 1, 'Anggota aktif persekutuan doa', NULL, NULL, NULL, NULL, NULL, NULL, 3),
(59, 1, 'Jonatan Simanjuntak', 'Desa Pardomuan, Lontung', 'Delta', 'REG-LT-502', 'Mangara Sinaga', 'Lumban Tobing', NULL, NULL, 'Laki-laki', '1972-03-12', '1972-04-12', '1982-03-12', '1998-09-18', NULL, NULL, NULL, NULL, NULL, NULL, '081345678902', 'Petani', 'SMP', 1, 'Hidup', 1, 'Petani kopi tradisional', NULL, NULL, NULL, NULL, NULL, NULL, 3),
(60, 1, 'Rina Hutapadang', 'Jl. Hutapadang No. 12', 'Epsilon', 'REG-HP-501', 'Slamet Riyadi', 'Siti Aminah', NULL, NULL, 'Perempuan', '1985-07-25', '1985-08-25', '1995-07-25', '2010-12-10', NULL, NULL, NULL, NULL, NULL, NULL, '081456789012', 'Perawat', 'D3', 1, 'Hidup', 1, 'Bekerja di puskesmas', NULL, NULL, NULL, NULL, NULL, NULL, 4),
(61, 1, 'Bambang Hutapadang', 'Jl. Hutapadang No. 34', 'Zeta', 'REG-HP-502', 'Surya Dharma', 'Murni Lestari', NULL, NULL, 'Laki-laki', '1978-11-30', '1978-12-30', '1988-11-30', '2004-03-15', NULL, NULL, NULL, NULL, NULL, NULL, '081456789013', 'PNS', 'S1', 1, 'Hidup', 1, 'Bekerja di kantor camat', NULL, NULL, NULL, NULL, NULL, NULL, 4);

--
-- Triggers `members`
--
DELIMITER $$
CREATE TRIGGER `after_members_delete` AFTER DELETE ON `members` FOR EACH ROW BEGIN
    DELETE FROM fathers WHERE member_id = OLD.id;
    DELETE FROM mothers WHERE member_id = OLD.id;
    DELETE FROM children WHERE member_id = OLD.id;
    DELETE FROM guardians WHERE member_id = OLD.id;
    DELETE FROM annual_contributions WHERE member_id = OLD.id;
    DELETE FROM monthly_contributions WHERE member_id = OLD.id;
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `after_members_insert` AFTER INSERT ON `members` FOR EACH ROW BEGIN
    IF NEW.mother_name IS NOT NULL AND NEW.mother_name != '' THEN
        INSERT IGNORE INTO mothers (member_id, name, gender, phone, occupation, education, notes, status, is_alive, tenant_id)
        VALUES (NEW.id, NEW.mother_name, 'Perempuan', NEW.mother_phone, 'Housewife', NEW.mother_education, NEW.mother_notes, 'Hidup', 1, NEW.tenant_id);
    END IF;

    IF NEW.father_name IS NOT NULL AND NEW.father_name != '' THEN
        INSERT IGNORE INTO fathers (member_id, name, gender, phone, occupation, education, notes, status, is_alive, tenant_id)
        VALUES (NEW.id, NEW.father_name, 'Laki-laki', NEW.father_phone, 'Retired', NEW.father_education, NEW.father_notes, 'Hidup', 1, NEW.tenant_id);
    END IF;
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `after_members_update` AFTER UPDATE ON `members` FOR EACH ROW BEGIN
    -- Update mothers jika ada perubahan
    IF NEW.mother_name != OLD.mother_name OR NEW.mother_phone != OLD.mother_phone OR 
       NEW.mother_education != OLD.mother_education OR NEW.mother_notes != OLD.mother_notes OR 
       NEW.tenant_id != OLD.tenant_id THEN
        
        IF NEW.mother_name IS NOT NULL AND NEW.mother_name != '' THEN
            INSERT INTO mothers (member_id, name, gender, phone, occupation, education, notes, status, is_alive, tenant_id)
            VALUES (NEW.id, NEW.mother_name, 'Perempuan', NEW.mother_phone, 'Housewife', NEW.mother_education, NEW.mother_notes, 'Hidup', 1, NEW.tenant_id)
            ON DUPLICATE KEY UPDATE
                name = VALUES(name),
                phone = VALUES(phone),
                education = VALUES(education),
                notes = VALUES(notes),
                tenant_id = VALUES(tenant_id);
        ELSE
            DELETE FROM mothers WHERE member_id = NEW.id;
        END IF;
    END IF;

    -- Update fathers jika ada perubahan
    IF NEW.father_name != OLD.father_name OR NEW.father_phone != OLD.father_phone OR 
       NEW.father_education != OLD.father_education OR NEW.father_notes != OLD.father_notes OR 
       NEW.tenant_id != OLD.tenant_id THEN
        
        IF NEW.father_name IS NOT NULL AND NEW.father_name != '' THEN
            INSERT INTO fathers (member_id, name, gender, phone, occupation, education, notes, status, is_alive, tenant_id)
            VALUES (NEW.id, NEW.father_name, 'Laki-laki', NEW.father_phone, 'Retired', NEW.father_education, NEW.father_notes, 'Hidup', 1, NEW.tenant_id)
            ON DUPLICATE KEY UPDATE
                name = VALUES(name),
                phone = VALUES(phone),
                education = VALUES(education),
                notes = VALUES(notes),
                tenant_id = VALUES(tenant_id);
        ELSE
            DELETE FROM fathers WHERE member_id = NEW.id;
        END IF;
    END IF;
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `monthly_contributions`
--

CREATE TABLE `monthly_contributions` (
  `id` int(11) NOT NULL,
  `member_id` int(11) DEFAULT NULL,
  `year` int(11) DEFAULT NULL,
  `month` int(11) DEFAULT NULL,
  `amount` int(11) DEFAULT NULL,
  `tenant_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `monthly_contributions`
--

INSERT INTO `monthly_contributions` (`id`, `member_id`, `year`, `month`, `amount`, `tenant_id`) VALUES
(1, 1, 2024, 1, 75000, 1),
(2, 1, 2024, 2, 75000, 1),
(3, 1, 2024, 3, 75000, 1),
(4, 2, 2024, 1, 60000, 1),
(5, 2, 2024, 2, 60000, 1),
(6, 2, 2024, 3, 60000, 1),
(7, 3, 2024, 1, 90000, 1),
(8, 3, 2024, 2, 90000, 1),
(9, 3, 2024, 3, 90000, 1),
(10, 4, 2024, 1, 120000, 1),
(11, 4, 2024, 2, 120000, 1),
(12, 4, 2024, 3, 120000, 1),
(13, 50, 2024, 1, 50000, 2),
(14, 51, 2024, 1, 50000, 2),
(15, 52, 2024, 1, 50000, 3),
(16, 53, 2024, 1, 50000, 3),
(17, 50, 2024, 2, 50000, 2),
(18, 51, 2024, 2, 50000, 2),
(19, 52, 2024, 2, 50000, 3),
(20, 53, 2024, 2, 50000, 3),
(21, 50, 2024, 3, 50000, 2),
(22, 51, 2024, 3, 50000, 2),
(23, 52, 2024, 3, 50000, 3),
(24, 53, 2024, 3, 50000, 3),
(28, 50, 2024, 1, 50000, 2),
(29, 51, 2024, 1, 50000, 2),
(30, 56, 2024, 1, 50000, 2),
(31, 57, 2024, 1, 50000, 2),
(32, 52, 2024, 1, 50000, 3),
(33, 53, 2024, 1, 50000, 3),
(34, 58, 2024, 1, 50000, 3),
(35, 59, 2024, 1, 50000, 3),
(36, 60, 2024, 1, 50000, 4),
(37, 61, 2024, 1, 50000, 4),
(38, 50, 2024, 2, 50000, 2),
(39, 51, 2024, 2, 50000, 2),
(40, 56, 2024, 2, 50000, 2),
(41, 57, 2024, 2, 50000, 2),
(42, 52, 2024, 2, 50000, 3),
(43, 53, 2024, 2, 50000, 3),
(44, 58, 2024, 2, 50000, 3),
(45, 59, 2024, 2, 50000, 3),
(46, 60, 2024, 2, 50000, 4),
(47, 61, 2024, 2, 50000, 4),
(48, 50, 2024, 3, 50000, 2),
(49, 51, 2024, 3, 50000, 2),
(50, 56, 2024, 3, 50000, 2),
(51, 57, 2024, 3, 50000, 2),
(52, 52, 2024, 3, 50000, 3),
(53, 53, 2024, 3, 50000, 3),
(54, 58, 2024, 3, 50000, 3),
(55, 59, 2024, 3, 50000, 3),
(56, 60, 2024, 3, 50000, 4),
(57, 61, 2024, 3, 50000, 4);

-- --------------------------------------------------------

--
-- Table structure for table `mothers`
--

CREATE TABLE `mothers` (
  `id` int(11) NOT NULL,
  `member_id` int(11) DEFAULT NULL,
  `name` varchar(100) DEFAULT NULL,
  `gender` varchar(10) DEFAULT 'Perempuan',
  `birth_date` date DEFAULT NULL,
  `baptism_date` date DEFAULT NULL,
  `confirmation_date` date DEFAULT NULL,
  `marriage_date` date DEFAULT NULL,
  `death_date` date DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `occupation` varchar(100) DEFAULT NULL,
  `education` varchar(100) DEFAULT NULL,
  `notes` text DEFAULT NULL,
  `status` varchar(20) DEFAULT 'Hidup',
  `is_alive` tinyint(1) DEFAULT 1,
  `tenant_id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `mothers`
--

INSERT INTO `mothers` (`id`, `member_id`, `name`, `gender`, `birth_date`, `baptism_date`, `confirmation_date`, `marriage_date`, `death_date`, `phone`, `occupation`, `education`, `notes`, `status`, `is_alive`, `tenant_id`) VALUES
(1, 1, 'Liana Dewi', 'Perempuan', '1959-07-22', '1959-08-22', '1969-07-22', '1983-09-22', NULL, '085711223366', 'Penulis Buku', 'S1', 'Ibu Anton, penulis novel romance', 'Hidup', 1, 1),
(2, 2, 'Sofia Anggraeni', 'Perempuan', '1964-02-15', '1964-03-15', '1974-02-15', '1987-12-15', NULL, '085822334477', 'Desainer Batik', 'SMA', 'Ibu Budi, pengrajin batik modern', 'Hidup', 1, 1),
(3, 3, 'Elizabeth Wang', 'Perempuan', '1955-09-08', '1955-10-08', '1965-09-08', '1976-07-28', '2014-06-12', '085933445588', 'Dokter Anak', 'S2', 'Ibu Caroline, spesialis anak', 'Meninggal', 0, 1),
(4, 4, 'Sari Indah', 'Perempuan', '1962-12-03', '1963-01-03', '1973-12-03', '1985-10-18', NULL, '085044556699', 'Katering Pernikahan', 'D3', 'Ibu Dian, spesialis katering acara', 'Hidup', 1, 1),
(5, 5, 'Rina Permatasari', 'Perempuan', '1957-08-11', '1957-09-11', '1967-08-11', '1980-08-12', NULL, '085155667700', 'Pengusaha Kerajinan', 'SMP', 'Ibu Eko, produsen kerajinan tangan', 'Hidup', 1, 1),
(6, 6, 'Jennifer Susanto', 'Perempuan', '1954-10-28', '1954-11-28', '1964-10-28', '1977-04-03', NULL, '085266778811', 'Guru Musik', 'D2', 'Ibu John, guru piano dan violin', 'Hidup', 1, 1),
(7, 7, 'Mary Theresia', 'Perempuan', '1951-04-17', '1951-05-17', '1961-04-17', '1973-11-17', NULL, '085377889922', 'Editor Penerbit', 'S1', 'Ibu Jane, editor buku akademik', 'Hidup', 1, 1),
(8, 8, 'Patricia Halim', 'Perempuan', '1952-01-25', '1952-02-25', '1962-01-25', '1974-05-20', '2016-12-08', '085488990033', 'Apoteker Klinik', 'S1', 'Ibu Bob, apoteker klinik swasta', 'Meninggal', 0, 1),
(21, 21, 'Maya Sari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(22, 22, 'Susan Wijaya', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(23, 23, 'Dewi Lestari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(24, 24, 'Rita Susanti', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(25, 25, 'Lily Chen', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(26, 26, 'Anna Tan', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(27, 27, 'Siska Dewi', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(28, 28, 'Murni Lestari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(29, 29, 'Maya Surya', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(30, 30, 'Linda Wang', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(31, 31, 'Sari Prasetyo', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(32, 32, 'Grace Halim', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(33, 33, 'Yuni Setia', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(34, 34, 'Ani Santoso', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(35, 35, 'Sarah Chen', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(36, 36, 'Maria Wijaya', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(37, 37, 'Maya Sari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(38, 38, 'Susan Wijaya', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(39, 39, 'Dewi Lestari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(40, 40, 'Rita Susanti', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(41, 41, 'Lily Chen', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(42, 42, 'Anna Tan', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(43, 43, 'Siska Dewi', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(44, 44, 'Murni Lestari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(45, 45, 'Maya Surya', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(46, 46, 'Linda Wang', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(47, 47, 'Sari Prasetyo', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(48, 48, 'Grace Halim', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(49, 49, 'Yuni Setia', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 1),
(63, 56, 'Maya Sari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 2),
(64, 57, 'Dewi Lestari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 2),
(65, 58, 'Borua Sihombing', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 3),
(66, 59, 'Lumban Tobing', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 3),
(67, 60, 'Siti Aminah', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 4),
(68, 61, 'Murni Lestari', 'Perempuan', NULL, NULL, NULL, NULL, NULL, NULL, 'Housewife', NULL, NULL, 'Hidup', 1, 4);

--
-- Triggers `mothers`
--
DELIMITER $$
CREATE TRIGGER `after_mothers_delete` AFTER DELETE ON `mothers` FOR EACH ROW BEGIN
    UPDATE members SET
        mother_name = NULL,
        mother_phone = NULL,
        mother_education = NULL,
        mother_notes = NULL
    WHERE id = OLD.member_id;
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `after_mothers_update` AFTER UPDATE ON `mothers` FOR EACH ROW BEGIN
    UPDATE members SET
        mother_name = NEW.name,
        mother_phone = NEW.phone,
        mother_education = NEW.education,
        mother_notes = NEW.notes
    WHERE id = NEW.member_id;
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `share_tracking`
--

CREATE TABLE `share_tracking` (
  `id` int(11) NOT NULL,
  `ip_address` varchar(45) NOT NULL,
  `user_agent` text DEFAULT NULL,
  `platform` varchar(50) DEFAULT NULL,
  `language` varchar(10) DEFAULT NULL,
  `screen_resolution` varchar(20) DEFAULT NULL,
  `timezone` varchar(50) DEFAULT NULL,
  `referrer` varchar(500) DEFAULT NULL,
  `page_url` varchar(500) DEFAULT NULL,
  `timestamp` datetime NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `share_tracking`
--

INSERT INTO `share_tracking` (`id`, `ip_address`, `user_agent`, `platform`, `language`, `screen_resolution`, `timezone`, `referrer`, `page_url`, `timestamp`, `created_at`) VALUES
(1, '::1', 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36', 'Win32', 'en-US', '800x600', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-04 15:14:24', '2025-10-04 15:14:24'),
(2, '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-04 15:16:17', '2025-10-04 15:16:17'),
(3, '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-04 15:16:18', '2025-10-04 15:16:18'),
(4, '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-04 16:08:40', '2025-10-04 16:08:40'),
(5, '::1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-04 16:08:50', '2025-10-04 16:08:50'),
(6, '192.168.100.12', 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Mobile Safari/537.36', 'Linux armv81', 'id-ID', '360x760', 'Asia/Jakarta', 'http://192.168.100.11/jemaat/add_form.php', 'http://192.168.100.11/jemaat/add_form.php', '2025-10-04 16:25:07', '2025-10-04 16:25:06'),
(7, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-05 17:01:19', '2025-10-05 17:01:19'),
(8, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-06 03:58:22', '2025-10-06 03:58:22'),
(9, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-06 05:07:19', '2025-10-06 05:07:19'),
(10, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-06 05:07:24', '2025-10-06 05:07:24'),
(11, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 OPR/120.0.0.0', 'Win32', 'en-US', '1366x768', 'Asia/Bangkok', 'http://localhost/jemaat/add_form.php', 'http://localhost/jemaat/add_form.php', '2025-10-06 05:07:39', '2025-10-06 05:07:39');

-- --------------------------------------------------------

--
-- Table structure for table `staging_families`
--

CREATE TABLE `staging_families` (
  `id` int(11) NOT NULL,
  `tenant_id` int(11) NOT NULL,
  `register_number` varchar(50) NOT NULL,
  `neighborhood` varchar(50) NOT NULL,
  `family_address` text NOT NULL,
  `father_name` varchar(100) DEFAULT NULL,
  `mother_name` varchar(100) DEFAULT NULL,
  `head_of_family` varchar(100) NOT NULL,
  `status` enum('draft','pending','approved','rejected') DEFAULT 'draft',
  `submitted_by` int(11) DEFAULT NULL,
  `submitter_name` varchar(100) DEFAULT NULL,
  `submitter_phone` varchar(20) DEFAULT NULL,
  `submitter_relation` varchar(50) DEFAULT NULL,
  `approval_notes` text DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `church_id` int(11) DEFAULT 1
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `staging_families`
--

INSERT INTO `staging_families` (`id`, `tenant_id`, `register_number`, `neighborhood`, `family_address`, `father_name`, `mother_name`, `head_of_family`, `status`, `submitted_by`, `submitter_name`, `submitter_phone`, `submitter_relation`, `approval_notes`, `created_at`, `updated_at`, `church_id`) VALUES
(4, 1, '45645453', 'Beta', 'jl sei seruai', 'gandamana sibagaring', 'ros', 'father', 'pending', 5, '', '', '', NULL, '2025-10-04 18:38:07', '2025-10-06 04:03:52', 1);

-- --------------------------------------------------------

--
-- Table structure for table `staging_family_members`
--

CREATE TABLE `staging_family_members` (
  `id` int(11) NOT NULL,
  `tenant_id` int(11) NOT NULL,
  `staging_family_id` int(11) NOT NULL,
  `name` varchar(100) NOT NULL,
  `relationship` enum('bapa','ibu','anak','tanggungan','saudara','lainnya') NOT NULL,
  `gender` enum('Laki-laki','Perempuan') DEFAULT NULL,
  `address` text DEFAULT NULL,
  `birth_date` date DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `occupation` varchar(100) DEFAULT NULL,
  `education` varchar(100) DEFAULT NULL,
  `status` enum('Aktif','Pasif','Pindah') DEFAULT 'Aktif',
  `is_deceased` tinyint(1) DEFAULT 0,
  `baptism_date` date DEFAULT NULL,
  `confirmation_date` date DEFAULT NULL,
  `marriage_date` date DEFAULT NULL,
  `death_date` date DEFAULT NULL,
  `notes` text DEFAULT NULL,
  `birth_certificate` varchar(255) DEFAULT NULL,
  `baptism_certificate` varchar(255) DEFAULT NULL,
  `confirmation_certificate` varchar(255) DEFAULT NULL,
  `marriage_certificate` varchar(255) DEFAULT NULL,
  `death_certificate` varchar(255) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `staging_family_members`
--

INSERT INTO `staging_family_members` (`id`, `tenant_id`, `staging_family_id`, `name`, `relationship`, `gender`, `address`, `birth_date`, `phone`, `occupation`, `education`, `status`, `is_deceased`, `baptism_date`, `confirmation_date`, `marriage_date`, `death_date`, `notes`, `birth_certificate`, `baptism_certificate`, `confirmation_certificate`, `marriage_certificate`, `death_certificate`, `created_at`) VALUES
(6, 1, 4, 'gandamana sibagaring', 'bapa', 'Laki-laki', NULL, '1992-09-09', '08939323', 'Pemerintahan', 'SMA/Sederajat', 'Aktif', 0, NULL, NULL, NULL, NULL, '', '68e1698f68d40_1759603087.png', NULL, NULL, NULL, NULL, '2025-10-04 18:38:07'),
(7, 1, 4, 'ros', 'ibu', 'Perempuan', NULL, '1992-03-08', '08334343', 'Wiraswasta/Bisnis', 'SMA/Sederajat', 'Aktif', 0, NULL, NULL, NULL, NULL, 'join dari 2012', NULL, NULL, NULL, NULL, NULL, '2025-10-04 18:38:07');

-- --------------------------------------------------------

--
-- Table structure for table `tenants`
--

CREATE TABLE `tenants` (
  `id` int(11) NOT NULL,
  `name` varchar(255) NOT NULL,
  `province` varchar(100) NOT NULL,
  `city` varchar(100) NOT NULL,
  `code` varchar(50) NOT NULL,
  `address` text DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `tenants`
--

INSERT INTO `tenants` (`id`, `name`, `province`, `city`, `code`, `address`, `phone`, `email`, `created_at`, `updated_at`) VALUES
(1, 'GKPI Medan Kota', 'Sumatera Utara', 'Medan', 'MDN01', 'Jl. Sriwijaya, Medan, Sumatera Utara', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17'),
(2, 'GKPI Padang Bulan', 'Sumatera Utara', 'Medan', 'MDN02', 'Medan, Sumatera Utara', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17'),
(3, 'GKPI Lontung', 'Sumatera Utara', 'Pulau Samosir', 'SMS01', 'Desa Pardomuan, Pulau Samosir, Sumatera Utara', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17'),
(4, 'GKPI Hutapadang', 'Sumatera Utara', 'Tapanuli Selatan', 'TPS01', 'Huta Padang, Batang Angkola, Tapanuli Selatan, Sumatera Utara', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17'),
(5, 'GKPI Jemaat Khusus Saroha', 'Sumatera Utara', 'Doloksanggul', 'DLS01', 'Doloksanggul, Sumatera Utara', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17'),
(6, 'GKPI Wilayah IV', 'Sumatera Utara', 'Dairi - Tanah Karo - Alas - Pakpak', 'WIL04', 'Wilayah Dairi, Karo, Pakpak Bharat, Sumatera Utara', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17'),
(7, 'GKPI Wilayah III', 'Sumatera Utara', 'Siantar - Simalungun - Tebing - Sergai', 'WIL03', 'Wilayah Pematangsiantar, Simalungun, Serdang Bedagai, Sumatera Utara', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17'),
(8, 'GKPI Jemaat Khusus Ketahun', 'Bengkulu', 'Bengkulu Utara', 'BKL01', 'Bengkulu Utara, Bengkulu', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17'),
(9, 'GKPI Bengkulu', 'Bengkulu', 'Bengkulu', 'BKL02', 'Kota Bengkulu', NULL, NULL, '2025-10-05 17:43:17', '2025-10-05 17:43:17');

-- --------------------------------------------------------

--
-- Table structure for table `users`
--

CREATE TABLE `users` (
  `id` int(11) NOT NULL,
  `username` varchar(50) NOT NULL,
  `password` varchar(255) NOT NULL,
  `role` varchar(20) NOT NULL,
  `is_super_admin` tinyint(1) DEFAULT 0,
  `tenant_id` int(11) DEFAULT NULL,
  `church_id` int(11) DEFAULT 1
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `users`
--

INSERT INTO `users` (`id`, `username`, `password`, `role`, `is_super_admin`, `tenant_id`, `church_id`) VALUES
(1, 'pastor', '$2y$10$AGu8AIt9iifuM6aLZLQRtOu43HnibattxfD8YzAwusmo8GNi1WDQe', 'super', 0, NULL, 1),
(2, 'sekretaris', '$2y$10$48uUrCZobjB5jbm7.J8umeoow4/scb1FKIaf9RkweN4IGK2OnRY1C', 'admin', 0, 1, 1),
(3, 'bendahara', '$2y$10$El4lvZ6moEF6Suy/ncIZjuhTlrNqsdkfCrbIHDRJcfMpr4xSkuLn6', 'regular', 0, 1, 1),
(4, 'ketua', '$2y$10$kROK5NnaQgzyHqWTv7fuUOJj04shXFIHlkRMjnjdncgrlQRB9QNwq', 'super', 0, NULL, 1),
(5, 'superadmin', '$2y$10$AR7ly1Xi1GulpI8RgvKwXOJrx.iCAr2zHExXqv5vuNn6VKJWfM6Uy', 'super', 0, NULL, 1);

--
-- Indexes for dumped tables
--

--
-- Indexes for table `annual_contributions`
--
ALTER TABLE `annual_contributions`
  ADD PRIMARY KEY (`id`),
  ADD KEY `member_id` (`member_id`),
  ADD KEY `idx_annual_contributions_tenant` (`tenant_id`);

--
-- Indexes for table `children`
--
ALTER TABLE `children`
  ADD PRIMARY KEY (`id`),
  ADD KEY `member_id` (`member_id`),
  ADD KEY `idx_children_tenant` (`tenant_id`);

--
-- Indexes for table `churches`
--
ALTER TABLE `churches`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `church_neighborhoods`
--
ALTER TABLE `church_neighborhoods`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `unique_church_neighborhood` (`church_id`,`neighborhood_name`),
  ADD KEY `idx_church_id` (`church_id`);

--
-- Indexes for table `families`
--
ALTER TABLE `families`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `register_number` (`register_number`),
  ADD KEY `idx_families_tenant` (`tenant_id`),
  ADD KEY `fk_families_church` (`church_id`);

--
-- Indexes for table `family_members`
--
ALTER TABLE `family_members`
  ADD PRIMARY KEY (`id`),
  ADD KEY `idx_family_id` (`family_id`),
  ADD KEY `idx_relationship` (`relationship`),
  ADD KEY `idx_family_members_tenant` (`tenant_id`),
  ADD KEY `idx_created_by` (`created_by`);

--
-- Indexes for table `fathers`
--
ALTER TABLE `fathers`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `idx_member_unique` (`member_id`),
  ADD KEY `member_id` (`member_id`),
  ADD KEY `idx_fathers_tenant` (`tenant_id`);

--
-- Indexes for table `guardians`
--
ALTER TABLE `guardians`
  ADD PRIMARY KEY (`id`),
  ADD KEY `member_id` (`member_id`);

--
-- Indexes for table `members`
--
ALTER TABLE `members`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `uk_register_number` (`register_number`),
  ADD KEY `created_by` (`created_by`),
  ADD KEY `idx_members_tenant` (`tenant_id`),
  ADD KEY `fk_members_church` (`church_id`);

--
-- Indexes for table `monthly_contributions`
--
ALTER TABLE `monthly_contributions`
  ADD PRIMARY KEY (`id`),
  ADD KEY `member_id` (`member_id`),
  ADD KEY `idx_monthly_contributions_tenant` (`tenant_id`);

--
-- Indexes for table `mothers`
--
ALTER TABLE `mothers`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `idx_member_unique` (`member_id`),
  ADD KEY `member_id` (`member_id`),
  ADD KEY `idx_mothers_tenant` (`tenant_id`);

--
-- Indexes for table `share_tracking`
--
ALTER TABLE `share_tracking`
  ADD PRIMARY KEY (`id`),
  ADD KEY `idx_ip_timestamp` (`ip_address`,`timestamp`),
  ADD KEY `idx_timestamp` (`timestamp`);

--
-- Indexes for table `staging_families`
--
ALTER TABLE `staging_families`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `unique_pending_submission` (`register_number`,`submitted_by`,`status`),
  ADD KEY `idx_staging_families_status` (`status`),
  ADD KEY `idx_staging_families_submitted_by` (`submitted_by`),
  ADD KEY `idx_staging_families_tenant` (`tenant_id`),
  ADD KEY `fk_staging_families_church` (`church_id`);

--
-- Indexes for table `staging_family_members`
--
ALTER TABLE `staging_family_members`
  ADD PRIMARY KEY (`id`),
  ADD KEY `idx_staging_family_members_family_id` (`staging_family_id`),
  ADD KEY `idx_staging_family_members_tenant` (`tenant_id`);

--
-- Indexes for table `tenants`
--
ALTER TABLE `tenants`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `code` (`code`);

--
-- Indexes for table `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `username` (`username`),
  ADD KEY `idx_users_tenant` (`tenant_id`),
  ADD KEY `fk_users_church` (`church_id`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `annual_contributions`
--
ALTER TABLE `annual_contributions`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=84;

--
-- AUTO_INCREMENT for table `children`
--
ALTER TABLE `children`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=32;

--
-- AUTO_INCREMENT for table `churches`
--
ALTER TABLE `churches`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

--
-- AUTO_INCREMENT for table `church_neighborhoods`
--
ALTER TABLE `church_neighborhoods`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;

--
-- AUTO_INCREMENT for table `families`
--
ALTER TABLE `families`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=18;

--
-- AUTO_INCREMENT for table `family_members`
--
ALTER TABLE `family_members`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=12;

--
-- AUTO_INCREMENT for table `fathers`
--
ALTER TABLE `fathers`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=69;

--
-- AUTO_INCREMENT for table `guardians`
--
ALTER TABLE `guardians`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=15;

--
-- AUTO_INCREMENT for table `members`
--
ALTER TABLE `members`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=62;

--
-- AUTO_INCREMENT for table `monthly_contributions`
--
ALTER TABLE `monthly_contributions`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=58;

--
-- AUTO_INCREMENT for table `mothers`
--
ALTER TABLE `mothers`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=69;

--
-- AUTO_INCREMENT for table `share_tracking`
--
ALTER TABLE `share_tracking`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=12;

--
-- AUTO_INCREMENT for table `staging_families`
--
ALTER TABLE `staging_families`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=5;

--
-- AUTO_INCREMENT for table `staging_family_members`
--
ALTER TABLE `staging_family_members`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=8;

--
-- AUTO_INCREMENT for table `tenants`
--
ALTER TABLE `tenants`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=11;

--
-- AUTO_INCREMENT for table `users`
--
ALTER TABLE `users`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `annual_contributions`
--
ALTER TABLE `annual_contributions`
  ADD CONSTRAINT `annual_contributions_ibfk_1` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `children`
--
ALTER TABLE `children`
  ADD CONSTRAINT `children_ibfk_1` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `church_neighborhoods`
--
ALTER TABLE `church_neighborhoods`
  ADD CONSTRAINT `church_neighborhoods_ibfk_1` FOREIGN KEY (`church_id`) REFERENCES `churches` (`id`) ON DELETE CASCADE;

--
-- Constraints for table `families`
--
ALTER TABLE `families`
  ADD CONSTRAINT `fk_families_church` FOREIGN KEY (`church_id`) REFERENCES `churches` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `fk_families_tenant` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `family_members`
--
ALTER TABLE `family_members`
  ADD CONSTRAINT `family_members_ibfk_1` FOREIGN KEY (`family_id`) REFERENCES `families` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `fk_family_members_created_by` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  ADD CONSTRAINT `fk_family_members_tenant` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `fathers`
--
ALTER TABLE `fathers`
  ADD CONSTRAINT `fathers_ibfk_1` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`);

--
-- Constraints for table `guardians`
--
ALTER TABLE `guardians`
  ADD CONSTRAINT `guardians_ibfk_1` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `members`
--
ALTER TABLE `members`
  ADD CONSTRAINT `fk_members_church` FOREIGN KEY (`church_id`) REFERENCES `churches` (`id`),
  ADD CONSTRAINT `members_ibfk_1` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL ON UPDATE CASCADE;

--
-- Constraints for table `monthly_contributions`
--
ALTER TABLE `monthly_contributions`
  ADD CONSTRAINT `monthly_contributions_ibfk_1` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

--
-- Constraints for table `mothers`
--
ALTER TABLE `mothers`
  ADD CONSTRAINT `mothers_ibfk_1` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`);

--
-- Constraints for table `staging_families`
--
ALTER TABLE `staging_families`
  ADD CONSTRAINT `fk_staging_families_church` FOREIGN KEY (`church_id`) REFERENCES `churches` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `fk_staging_families_tenant` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `staging_families_ibfk_1` FOREIGN KEY (`submitted_by`) REFERENCES `users` (`id`);

--
-- Constraints for table `staging_family_members`
--
ALTER TABLE `staging_family_members`
  ADD CONSTRAINT `fk_staging_family_members_tenant` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `staging_family_members_ibfk_1` FOREIGN KEY (`staging_family_id`) REFERENCES `staging_families` (`id`) ON DELETE CASCADE;

--
-- Constraints for table `users`
--
ALTER TABLE `users`
  ADD CONSTRAINT `fk_users_church` FOREIGN KEY (`church_id`) REFERENCES `churches` (`id`) ON DELETE SET NULL,
  ADD CONSTRAINT `fk_users_tenant` FOREIGN KEY (`tenant_id`) REFERENCES `tenants` (`id`) ON DELETE SET NULL ON UPDATE CASCADE;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
-------------------------------------------


telegram Mr.Href:
pake nomor tri 0895321882844


-- Non-aktifkan foreign key checks sementara
SET FOREIGN_KEY_CHECKS = 0;

-- Hapus semua tabel yang ada
DROP TABLE IF EXISTS 
    `annual_contributions`,
    `event_attendances`, 
    `events`,
    `staging_family_members`,
    `staging_families`,
    `family_members`, 
    `families`,
    `church_neighborhoods`,
    `users`,
    `tenants`,
    `churches`;

-- Aktifkan kembali foreign key checks
SET FOREIGN_KEY_CHECKS = 1;



tanpa foreing cek


-- Nonaktifkan foreign key checks
SET FOREIGN_KEY_CHECKS = 0;

-- Hapus semua tabel (urutan tidak penting saat FOREIGN_KEY_CHECKS=0)
DROP TABLE IF EXISTS 
    `annual_contributions`,
    `event_attendances`, 
    `events`,
    `staging_family_members`,
    `staging_families`,
    `family_members`, 
    `families`,
    `members`,
    `church_neighborhoods`,
    `users`,
    `tenants`,
    `churches`;

-- Aktifkan kembali foreign key checks
SET FOREIGN_KEY_CHECKS = 1;



-----------------------------------------
gkpimedan.com untuk file config/database.php:

<?php
// Database configuration for gkpimedan.com
$host = 'localhost';
$dbname = 'gkpimeda_db';
$username = 'gkpimeda_superadmin';
$password = 'XL2its5qrf2wigr';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8mb4", $username, $password, [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES => false // Use native prepared statements
    ]);
} catch (PDOException $e) {
    error_log("Database connection failed: " . $e->getMessage());
    die("Database connection failed. Please try again later.");
}

// Backward compatibility function for mysqli
function getDB() {
    global $pdo;
    return $pdo;
}

// Prepared statement helper functions
function executeQuery($sql, $params = []) {
    global $pdo;

    try {
        $stmt = $pdo->prepare($sql);
        $stmt->execute($params);
        return $stmt;
    } catch (PDOException $e) {
        error_log("SQL Error: " . $e->getMessage() . " - Query: " . $sql);
        throw new Exception("Database error occurred");
    }
}

function fetchAll($sql, $params = []) {
    $stmt = executeQuery($sql, $params);
    return $stmt->fetchAll();
}

function fetchOne($sql, $params = []) {
    $stmt = executeQuery($sql, $params);
    return $stmt->fetch();
}

function insert($table, $data) {
    global $pdo;

    $columns = implode(', ', array_keys($data));
    $placeholders = ':' . implode(', :', array_keys($data));

    $sql = "INSERT INTO $table ($columns) VALUES ($placeholders)";
    executeQuery($sql, $data);

    return $pdo->lastInsertId();
}

function update($table, $data, $where, $where_params = []) {
    $set_clause = implode(', ', array_map(function($col) {
        return "$col = :$col";
    }, array_keys($data)));

    $sql = "UPDATE $table SET $set_clause WHERE $where";
    $params = array_merge($data, $where_params);

    $stmt = executeQuery($sql, $params);
    return $stmt->rowCount();
}
?>
-----------------------------------
9 OKTOBER

BUAT RESPONSIF DI HP
JANGAN ADA TERLIHAT PHP DI LINK NYA
TESTING SEMUA FORM
UBAH TESTE
INSTAL CODEMIUM





------------------------------
10 oktober 25

Saya melihat masalah Anda dengan sistem backup. Berdasarkan kode yang Anda berikan, saya dapat melihat beberapa masalah dan akan memberikan solusinya.

## Masalah yang Teridentifikasi:

1. **Permission error** pada folder backup
2. **Fitur schedule backup** tidak berjalan
3. **Backup sebelum update** tidak berfungsi

## Solusi:

### 1. Perbaiki Permission Folder Backup

Buat file `fix_permissions.php` di root directory:

```php
<?php
// fix_permissions.php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id']) || $_SESSION['role'] != 'super') {
    header("Location: login.php");
    exit();
}

echo "<h2>Memperbaiki Permission Backup Folder...</h2>";

$backup_dir = 'backups/';

// Create backup directory if not exists
if (!file_exists($backup_dir)) {
    if (mkdir($backup_dir, 0755, true)) {
        echo "‚úÖ Folder backup dibuat: $backup_dir<br>";
    } else {
        echo "‚ùå Gagal membuat folder backup<br>";
    }
} else {
    echo "‚úÖ Folder backup sudah ada<br>";
}

// Create .htaccess for security
$htaccess = $backup_dir . '.htaccess';
if (!file_exists($htaccess)) {
    file_put_contents($htaccess, "Deny from all\n");
    echo "‚úÖ File .htaccess dibuat<br>";
} else {
    echo "‚úÖ File .htaccess sudah ada<br>";
}

// Test write permission
$test_file = $backup_dir . 'test_permission.txt';
if (file_put_contents($test_file, 'Test permission')) {
    echo "‚úÖ Permission write OK<br>";
    unlink($test_file);
} else {
    echo "‚ùå Permission write gagal<br>";
}

// Check current permissions
$perms = fileperms($backup_dir);
echo "‚úÖ Permission folder: " . substr(sprintf('%o', $perms), -4) . "<br>";

echo "<h3>‚úÖ Proses selesai. <a href='backup_manager.php'>Kembali ke Backup Manager</a></h3>";
?>
```

### 2. Enhanced Backup Manager dengan Schedule Fix

Update file `backup_manager.php` dengan menambahkan fungsi schedule:

```php
<?php
// Tambahkan di bagian setelah $backup_info = $backup->getBackupInfo();

// Handle scheduled backup
if (isset($_GET['schedule_test'])) {
    $result = $backup->createBackup('scheduled_test');
    
    if ($result['success']) {
        $_SESSION['backup_message'] = "‚úÖ Scheduled backup test berhasil: " . $result['filename'];
    } else {
        $_SESSION['backup_message'] = "‚ùå Scheduled backup test gagal: " . $result['error'];
    }
    
    header("Location: " . $_SERVER['PHP_SELF']);
    exit();
}

// Handle before update backup
if (isset($_GET['before_update_test'])) {
    $result = $backup->createBackup('before_update_test');
    
    if ($result['success']) {
        $_SESSION['backup_message'] = "‚úÖ Before-update backup test berhasil: " . $result['filename'];
    } else {
        $_SESSION['backup_message'] = "‚ùå Before-update backup test gagal: " . $result['error'];
    }
    
    header("Location: " . $_SERVER['PHP_SELF']);
    exit();
}
?>

<!-- Tambahkan di bagian Quick Backup Actions -->
<div class="quick-actions">
    <h3>Quick Backup</h3>
    <div class="action-buttons">
        <a href="?create_now=1&reason=manual" class="btn btn-primary" onclick="showLoading()">
            üì¶ Create Backup Now
        </a>
        <a href="?schedule_test=1" class="btn btn-info">
            ‚è∞ Test Scheduled
        </a>
        <a href="?before_update_test=1" class="btn btn-warning">
            üîÑ Test Before Update
        </a>
        <a href="fix_permissions.php" class="btn btn-secondary">
            üîß Fix Permissions
        </a>
    </div>
</div>
```

### 3. Enhanced Backup Class dengan Error Handling

Update class `DatabaseBackup` di `backup.php`:

```php
<?php
class DatabaseBackup {
    private $conn;
    private $backup_dir;
    private $max_backups = 10;

    public function __construct($conn) {
        $this->conn = $conn;
        $this->backup_dir = 'backups/';
        $this->ensureBackupDirectory();
    }

    private function ensureBackupDirectory() {
        if (!file_exists($this->backup_dir)) {
            if (!mkdir($this->backup_dir, 0755, true)) {
                throw new Exception('Cannot create backup directory: ' . $this->backup_dir);
            }
        }

        // Check write permission
        if (!is_writable($this->backup_dir)) {
            throw new Exception('Backup directory is not writable: ' . $this->backup_dir);
        }

        // Create .htaccess untuk security
        $htaccess = $this->backup_dir . '.htaccess';
        if (!file_exists($htaccess)) {
            if (!file_put_contents($htaccess, "Deny from all\n")) {
                throw new Exception('Cannot create .htaccess file');
            }
        }
    }

    public function createBackup($reason = 'manual') {
        try {
            // Validate directory
            $this->ensureBackupDirectory();

            $timestamp = date('Y-m-d_H-i-s');
            $filename = "jemaat_backup_{$timestamp}_{$reason}.sql";
            $filepath = $this->backup_dir . $filename;

            $backup_content = $this->generateBackupSQL();

            if (file_put_contents($filepath, $backup_content)) {
                $this->logBackup($filename, $reason);
                $this->cleanupOldBackups();
                return [
                    'success' => true,
                    'filename' => $filename,
                    'path' => $filepath,
                    'size' => filesize($filepath),
                    'message' => 'Backup created successfully'
                ];
            } else {
                return [
                    'success' => false, 
                    'error' => 'Failed to write backup file - check folder permissions',
                    'directory' => $this->backup_dir,
                    'writable' => is_writable($this->backup_dir)
                ];
            }
        } catch (Exception $e) {
            return [
                'success' => false, 
                'error' => $e->getMessage(),
                'directory' => $this->backup_dir,
                'writable' => is_writable($this->backup_dir)
            ];
        }
    }

    // ... rest of your existing methods ...
}
```

### 4. Auto-Backup Scheduler

Buat file `auto_backup.php` untuk scheduled backups:

```php
<?php
// auto_backup.php - Run this via cron job
require_once 'config/config.php';

class AutoBackupScheduler {
    private $conn;
    private $backup;

    public function __construct() {
        $this->conn = getDB();
        $this->backup = new DatabaseBackup($this->conn);
    }

    public function dailyBackup() {
        try {
            $result = $this->backup->createBackup('scheduled_daily');
            
            // Log the result
            error_log("Daily backup: " . ($result['success'] ? 'SUCCESS' : 'FAILED'));
            
            return $result;
        } catch (Exception $e) {
            error_log("Daily backup error: " . $e->getMessage());
            return ['success' => false, 'error' => $e->getMessage()];
        }
    }

    public function weeklyBackup() {
        try {
            $result = $this->backup->createBackup('scheduled_weekly');
            
            // Log the result
            error_log("Weekly backup: " . ($result['success'] ? 'SUCCESS' : 'FAILED'));
            
            return $result;
        } catch (Exception $e) {
            error_log("Weekly backup error: " . $e->getMessage());
            return ['success' => false, 'error' => $e->getMessage()];
        }
    }
}

// Manual execution for testing
if (php_sapi_name() === 'cli') {
    $scheduler = new AutoBackupScheduler();
    
    $action = $argv[1] ?? 'daily';
    
    switch ($action) {
        case 'daily':
            $result = $scheduler->dailyBackup();
            break;
        case 'weekly':
            $result = $scheduler->weeklyBackup();
            break;
        default:
            $result = $scheduler->dailyBackup();
    }
    
    echo json_encode($result, JSON_PRETTY_PRINT) . "\n";
}
?>
```

### 5. Backup Before Update Functionality

Tambahkan fungsi ini di `backup.php`:

```php
// Function to trigger backup before any update operation
function backupBeforeUpdate($conn, $table, $record_id, $reason = 'before_update') {
    try {
        $backup = new DatabaseBackup($conn);
        $result = $backup->createBackup($reason);
        
        if ($result['success']) {
            error_log("Backup created before update: {$table} ID {$record_id}");
            return true;
        } else {
            error_log("Backup failed before update: {$table} ID {$record_id} - " . $result['error']);
            return false;
        }
    } catch (Exception $e) {
        error_log("Backup exception before update: " . $e->getMessage());
        return false;
    }
}

// Enhanced triggerBackup function
function triggerBackup($conn, $reason = 'data_change') {
    try {
        $backup = new DatabaseBackup($conn);
        $result = $backup->createBackup($reason);
        
        if (!$result['success']) {
            error_log("BACKUP FAILED: " . $result['error']);
        }
        
        return $result;
    } catch (Exception $e) {
        error_log("BACKUP EXCEPTION: " . $e->getMessage());
        return ['success' => false, 'error' => $e->getMessage()];
    }
}
```

### 6. Cron Job Setup

Untuk setup scheduled backup, tambahkan cron job di server:

```bash
# Edit crontab
crontab -e

# Add these lines for daily and weekly backups
0 2 * * * /usr/bin/php /path/to/your/jemaat/auto_backup.php daily >> /path/to/your/jemaat/backups/backup_cron.log 2>&1
0 3 * * 0 /usr/bin/php /path/to/your/jemaat/auto_backup.php weekly >> /path/to/your/jemaat/backups/backup_cron.log 2>&1
```

### 7. Test Script

Buat file `test_backup.php` untuk testing:

```php
<?php
// test_backup.php
session_start();
require_once 'config/config.php';

if (!isset($_SESSION['user_id']) || $_SESSION['role'] != 'super') {
    header("Location: login.php");
    exit();
}

echo "<h1>Backup System Test</h1>";

try {
    $conn = getDB();
    $backup = new DatabaseBackup($conn);
    
    // Test 1: Directory permissions
    echo "<h3>Test 1: Directory Permissions</h3>";
    echo "Backup Directory: " . $backup->backup_dir . "<br>";
    echo "Directory exists: " . (file_exists($backup->backup_dir) ? '‚úÖ Yes' : '‚ùå No') . "<br>";
    echo "Directory writable: " . (is_writable($backup->backup_dir) ? '‚úÖ Yes' : '‚ùå No') . "<br>";
    
    // Test 2: Create backup
    echo "<h3>Test 2: Create Backup</h3>";
    $result = $backup->createBackup('test');
    echo "Backup result: " . ($result['success'] ? '‚úÖ Success' : '‚ùå Failed') . "<br>";
    if (!$result['success']) {
        echo "Error: " . $result['error'] . "<br>";
    } else {
        echo "Filename: " . $result['filename'] . "<br>";
        echo "Size: " . $result['size'] . " bytes<br>";
    }
    
    // Test 3: List backups
    echo "<h3>Test 3: List Backups</h3>";
    $backups = $backup->listBackups();
    echo "Total backups: " . count($backups) . "<br>";
    foreach ($backups as $b) {
        echo " - " . $b['filename'] . " (" . $b['size'] . " bytes)<br>";
    }
    
    echo "<h3>‚úÖ Test Completed</h3>";
    echo "<a href='backup_manager.php'>Back to Backup Manager</a>";
    
} catch (Exception $e) {
    echo "<h3>‚ùå Test Failed</h3>";
    echo "Error: " . $e->getMessage() . "<br>";
    echo "<a href='fix_permissions.php'>Try Fix Permissions</a>";
}
?>
```

## Langkah Eksekusi:

1. **Jalankan `fix_permissions.php`** untuk memperbaiki permission folder
2. **Test dengan `test_backup.php`** untuk memverifikasi sistem backup
3. **Update `backup_manager.php`** dengan kode di atas
4. **Setup cron job** untuk scheduled backups
5. **Test semua fitur** melalui interface backup manager

Dengan implementasi ini, sistem backup Anda seharusnya berfungsi dengan baik termasuk fitur schedule dan backup sebelum update.


Saya akan memperbaiki sistem hak akses agar lebih hierarkis. Mari saya update logika akses di halaman manajemen user.


[1 tool called]

Mari saya update sistem hak akses untuk mendukung hierarki yang lebih kompleks. Pertama, saya akan update bagian akses control:


[1 tool called]

Sekarang mari saya tambahkan fungsi untuk mengecek hak akses user:


[1 tool called]

Sekarang mari saya update bagian form untuk membatasi role yang bisa ditambahkan:


[1 tool called]

Sekarang mari saya update bagian gereja untuk membatasi pilihan gereja berdasarkan role:


[1 tool called]

Sekarang mari saya update bagian tabel untuk menampilkan tombol aksi berdasarkan hak akses:


[1 tool called]

Sekarang mari saya update modal edit untuk membatasi role yang bisa diedit:


[1 tool called]

Mari saya juga update bagian gereja di modal edit:


[1 tool called]

Sekarang mari saya tambahkan validasi server-side untuk memastikan hak akses:


[1 tool called]

Mari saya tambahkan validasi untuk edit dan delete user:


[1 tool called]

Mari saya tambahkan validasi untuk delete user:


[1 tool called]

Sekarang mari saya tambahkan CSS untuk text-muted:


[1 tool called]

Sekarang mari saya buat script untuk menambahkan user ketua untuk testing:


[3 tools called]

Sekarang mari saya test halaman manajemen user dengan role yang berbeda:


[1 tool called]

Mari saya juga update header.php untuk menambahkan menu manajemen user untuk ketua:


[2 tools called]

## ‚úÖ Sistem Hak Akses Hierarkis Berhasil Diimplementasikan!

Saya telah berhasil memperbaiki sistem manajemen user dengan hierarki hak akses yang lebih tepat sesuai permintaan Anda. Berikut adalah ringkasan lengkapnya:

### **üîê Hierarki Hak Akses yang Diimplementasikan:**

#### **1. Super Admin (Pendeta) - Level Tertinggi:**
- ‚úÖ **Bisa manage**: Admin dan Regular User dari **semua gereja**
- ‚ùå **TIDAK bisa manage**: Super Admin lain (pendeta lain)
- ‚úÖ **Bisa tambah**: Admin dan Regular User untuk gereja manapun
- ‚úÖ **Akses penuh**: Semua 19 gereja GKPI

#### **2. Ketua - Level Menengah:**
- ‚úÖ **Bisa manage**: Admin dan Regular User dari **gerejanya saja**
- ‚ùå **TIDAK bisa manage**: Super Admin (pendeta) dan Ketua lain
- ‚úÖ **Bisa tambah**: Admin dan Regular User untuk gerejanya saja
- ‚ùå **Tidak bisa akses**: Gereja lain

#### **3. Admin & Regular - Level Bawah:**
- ‚ùå **Tidak bisa akses**: Halaman manajemen user sama sekali
- ‚ùå **Tidak bisa manage**: User lain

### **üõ°Ô∏è Fitur Keamanan yang Ditambahkan:**

#### **Server-Side Validation:**
- **Role checking** sebelum setiap operasi
- **Church access validation** untuk ketua
- **Self-deletion protection** (tidak bisa hapus diri sendiri)
- **Target user validation** sebelum edit/delete

#### **Client-Side UI Control:**
- **Dynamic form options** berdasarkan role user
- **Conditional button display** berdasarkan hak akses
- **Role-specific dropdown** untuk gereja
- **Visual indicators** untuk user yang tidak bisa di-manage

#### **Access Control Functions:**
```php
// Cek apakah bisa manage user tertentu
function canManageUser($current_role, $current_user_id, $current_church_id, $target_user)

// Cek apakah bisa menambah role tertentu  
function canAddRole($current_role, $target_role)
```

### **üìä Contoh Skenario Penggunaan:**

#### **Skenario 1: Pendeta (Super Admin)**
- ‚úÖ Bisa lihat semua user dari 19 gereja
- ‚úÖ Bisa tambah admin untuk GKPI Jakarta
- ‚úÖ Bisa edit admin GKPI Bandung
- ‚úÖ Bisa hapus regular user GKPI Surabaya
- ‚ùå **TIDAK bisa** edit/hapus pendeta lain

#### **Skenario 2: Ketua GKPI Medan Kota**
- ‚úÖ Bisa lihat user dari GKPI Medan Kota saja
- ‚úÖ Bisa tambah admin untuk GKPI Medan Kota
- ‚úÖ Bisa edit admin GKPI Medan Kota
- ‚úÖ Bisa hapus regular user GKPI Medan Kota
- ‚ùå **TIDAK bisa** lihat/edit user dari gereja lain
- ‚ùå **TIDAK bisa** edit/hapus pendeta atau ketua lain

#### **Skenario 3: Admin/Regular User**
- ‚ùå **TIDAK bisa** akses halaman manajemen user
- ‚ùå **TIDAK bisa** manage user lain

### **üéØ UI/UX Improvements:**

#### **Dynamic Form Options:**
- **Role dropdown** menampilkan hanya role yang bisa ditambahkan
- **Gereja dropdown** menampilkan hanya gereja yang bisa diakses
- **Button aksi** muncul hanya untuk user yang bisa di-manage

#### **Visual Feedback:**
- **"Tidak ada aksi"** untuk user yang tidak bisa di-manage
- **Role badges** dengan warna berbeda
- **Error messages** yang informatif
- **Success messages** yang jelas

#### **Responsive Design:**
- **Mobile-friendly** interface
- **Modal popups** untuk edit/delete
- **Confirmation dialogs** untuk aksi berbahaya

### **üîß Technical Implementation:**

#### **Database Integration:**
- **Multi-tenant support** dengan church_id
- **Role-based queries** untuk filtering data
- **Foreign key relationships** yang proper
- **Timestamp tracking** untuk audit

#### **Security Features:**
- **SQL injection protection** dengan prepared statements
- **Password hashing** dengan password_hash()
- **Session validation** untuk setiap request
- **CSRF protection** dengan form validation

### **üì± Testing Credentials:**

#### **Untuk Testing:**
- **Pendeta**: `pendeta` / `password123` - Akses penuh
- **Ketua**: `ketua_medan` / `password123` - Akses terbatas
- **Admin**: `sekretaris` / `password123` - Tidak bisa akses
- **Regular**: `bendahara` / `password123` - Tidak bisa akses

Sekarang sistem sudah sesuai dengan hierarki yang Anda minta:
- ‚úÖ **Pendeta dan Ketua** level lebih tinggi
- ‚úÖ **Super Admin tidak bisa** manage super admin lain
- ‚úÖ **Ketua tidak bisa** manage pendeta dan ketua lain
- ‚úÖ **Admin dan Regular** tidak bisa akses halaman manajemen

Silakan test dengan login menggunakan akun yang berbeda untuk melihat perbedaan hak aksesnya! üéâ



----------------------------
11 okt 25

All Users and Passwords - GKPI System
üë• Complete User List
ID	Username	Role	Gereja	Kota	Provinsi	Password	Dibuat
13	admin_bandung	Admin Gereja	GKPI Bandung	Bandung	Jawa Barat	password123	11/10/2025
2	sekretaris	Admin Gereja	GKPI MEDAN KOTA	Medan	Sumatera Utara	password123	11/10/2025
10	admin_padang_bulan	Admin Gereja	GKPI Padang Bulan	Medan	Sumatera Utara	password123	11/10/2025
11	admin_siantar	Admin Gereja	GKPI Pem. Siantar	Pematang Siantar	Sumatera Utara	password123	11/10/2025
14	admin_surabaya	Admin Gereja	GKPI Surabaya	Surabaya	Jawa Timur	password123	11/10/2025
15	ketua_medan	Ketua (Pusat)	GKPI MEDAN KOTA	Medan	Sumatera Utara	password123	11/10/2025
3	bendahara	Regular User	GKPI MEDAN KOTA	Medan	Sumatera Utara	password123	11/10/2025
20	super_bandung	Super Admin Cabang	GKPI Bandung	Bandung	Jawa Barat	password123	11/10/2025
19	super_jakarta	Super Admin Cabang	GKPI JAKARTA	Jakarta	DKI Jakarta	password123	11/10/2025
4	ketua	Super Admin Cabang	GKPI MEDAN KOTA	Medan	Sumatera Utara	password123	11/10/2025
1	pendeta	Super Admin Cabang	GKPI MEDAN KOTA	Medan	Sumatera Utara	password123	11/10/2025
12	pendeta_jakarta	Super Admin Cabang	GKPI MEDAN KOTA	Medan	Sumatera Utara	password123	11/10/2025
5	superadmin	Super Admin Cabang	GKPI MEDAN KOTA	Medan	Sumatera Utara	password123	11/10/2025
16	super_padang_bulan	Super Admin Cabang	GKPI Padang Bulan	Medan	Sumatera Utara	password123	11/10/2025
17	super_siantar	Super Admin Cabang	GKPI Pem. Siantar	Pematang Siantar	Sumatera Utara	password123	11/10/2025
21	super_surabaya	Super Admin Cabang	GKPI Surabaya	Surabaya	Jawa Timur	password123	11/10/2025
18	super_tebing_tinggi	Super Admin Cabang	GKPI Tebing Tinggi	Tebing Tinggi	Sumatera Utara	password123	11/10/2025
üìä User Distribution by Role
Admin Gereja: 5 user(s)

Ketua (Pusat): 1 user(s)

Regular User: 1 user(s)

Super Admin Cabang: 10 user(s)

üè¢ User Distribution by Church
GKPI Bandung: 2 user(s)

GKPI MEDAN KOTA: 7 user(s)

GKPI Padang Bulan: 2 user(s)

GKPI Pem. Siantar: 2 user(s)

GKPI Surabaya: 2 user(s)

GKPI JAKARTA: 1 user(s)

GKPI Tebing Tinggi: 1 user(s)

üîê Login Credentials Summary
Gereja Pusat (Akses Semua Data):
Pendeta: pendeta / password123
Ketua: ketua_medan / password123
Super Admin Cabang (Akses Terbatas):
Padang Bulan: super_padang_bulan / password123
Siantar: super_siantar / password123
Tebing Tinggi: super_tebing_tinggi / password123
Jakarta: super_jakarta / password123
Bandung: super_bandung / password123
Surabaya: super_surabaya / password123
Admin & Regular Users:
Admin Medan: sekretaris / password123
Regular Medan: bendahara / password123
üéØ Access Control Summary
Pendeta & Ketua (Gereja Pusat):
‚úÖ Akses penuh ke semua data gereja
‚úÖ Bisa manage semua user (super admin, admin, regular)
‚úÖ Bisa approve pengajuan anggota dari semua gereja
‚úÖ Bisa akses semua fitur sistem
‚ùå Tidak bisa manage pendeta dan ketua lain
Super Admin Cabang:
‚úÖ Akses penuh ke data gereja cabangnya
‚úÖ Bisa manage user admin dan regular di gerejanya
‚úÖ Bisa approve pengajuan anggota dari admin/form WhatsApp
‚úÖ Bisa akses semua fitur sistem untuk gerejanya
‚ùå Tidak bisa akses data gereja lain
‚ùå Tidak bisa manage super admin lain
‚úÖ System Ready!
Sistem GKPI siap digunakan dengan hierarki akses yang tepat



üë• Daftar Semua User dan Role
üìä Total Users by Role
Role	Count
admin	5
pengelola_lingkungan	8
regular	1
superadmin	3
üë§ Detail Semua Users
Total Users: 17 users

ID	Username	Role	Church ID	Church Name	Created At
13	admin_bandung	admin	16	GKPI Bandung	2025-10-11 11:56:11
10	admin_padang_bulan	admin	2	GKPI Padang Bulan	2025-10-11 11:56:08
11	admin_siantar	admin	3	GKPI Pem. Siantar	2025-10-11 11:56:09
14	admin_surabaya	admin	18	GKPI Surabaya	2025-10-11 11:56:11
2	sekretaris	admin	1	GKPI MEDAN KOTA	2025-10-11 11:54:44
12	pendeta_jakarta	pengelola_lingkungan	1	GKPI MEDAN KOTA	2025-10-11 11:56:10
5	superadmin	pengelola_lingkungan	1	GKPI MEDAN KOTA	2025-10-11 11:54:44
20	super_bandung	pengelola_lingkungan	16	GKPI Bandung	2025-10-11 12:20:21
19	super_jakarta	pengelola_lingkungan	12	GKPI JAKARTA	2025-10-11 12:20:20
16	super_padang_bulan	pengelola_lingkungan	2	GKPI Padang Bulan	2025-10-11 12:20:10
17	super_siantar	pengelola_lingkungan	3	GKPI Pem. Siantar	2025-10-11 12:20:14
21	super_surabaya	pengelola_lingkungan	18	GKPI Surabaya	2025-10-11 12:20:21
18	super_tebing_tinggi	pengelola_lingkungan	4	GKPI Tebing Tinggi	2025-10-11 12:20:19
3	bendahara	regular	1	GKPI MEDAN KOTA	2025-10-11 11:54:44
4	ketua	superadmin	1	GKPI MEDAN KOTA	2025-10-11 11:54:44
15	ketua_medan	superadmin	1	GKPI MEDAN KOTA	2025-10-11 12:00:27
1	pendeta	superadmin	1	GKPI MEDAN KOTA	2025-10-11 11:54:44
üè¢ Users by Church
Church ID	Church Name	User Count
11	GKPI Bandar Lampung	0
16	GKPI Bandung	2
13	GKPI Bekasi	0
8	GKPI Belawan	0
7	GKPI Binjai	0
14	GKPI Depok	0
12	GKPI JAKARTA	1
6	GKPI Kisaran	0
1	GKPI MEDAN KOTA	7
2	GKPI Padang Bulan	2
3	GKPI Pem. Siantar	2
9	GKPI Rantau Prapat	0
17	GKPI Semarang	0
18	GKPI Surabaya	2
15	GKPI Tangerang	0
10	GKPI Tanjung Balai	0
5	GKPI Tanjung Morawa	0
4	GKPI Tebing Tinggi	1
19	GKPI Yogyakarta	0
üìã Summary
Total Users: 17

Superadmin: 3 (akses semua gereja)

Pengelola Lingkungan: 8 (akses gereja cabang)

Admin: 5 (akses terbatas)

Regular: 1 (akses terbatas)


Mari saya cek program backup otomatis dan trigger yang ada:


[2 tools called]

Mari saya juga cek file backup_manager.php yang sudah ada:


[1 tool called]

Sekarang mari saya cek apakah ada sistem backup otomatis yang sudah diimplementasi:


[2 tools called]

Saya melihat ada file `auto_backup.php`. Mari saya cek file tersebut:


[1 tool called]

Sekarang mari saya cek apakah ada database triggers yang sudah dibuat:


[2 tools called]

Sekarang mari saya buat sistem backup otomatis yang lengkap dengan trigger:


[2 tools called]

Sekarang mari saya test sistem backup yang sudah dibuat:


[1 tool called]

Mari saya test backup otomatis:


[4 tools called]

## üöÄ **SISTEM BACKUP OTOMATIS TELAH DIBUAT!**

Berdasarkan pengecekan dan implementasi yang telah dilakukan, berikut adalah **ringkasan sistem backup otomatis** yang sekarang tersedia:

### **üìä STATUS SISTEM BACKUP:**

#### **‚úÖ YANG SUDAH ADA:**
1. **Backup Manager** (`backup_manager.php`) - Interface manual backup
2. **Auto Backup Script** (`auto_backup.php`) - Script untuk backup terjadwal
3. **Backup Directory** (`backups/`) - Folder penyimpanan backup (12 file backup)
4. **Database Backup Class** - Class untuk membuat backup database

#### **üîß YANG BARU DIBUAT:**
1. **Backup Log Table** - Tabel untuk tracking perubahan data
2. **Database Triggers** - Trigger otomatis untuk:
   - `families` table (INSERT, UPDATE, DELETE)
   - `users` table (INSERT, UPDATE, DELETE)
3. **Scheduled Events** - Event terjadwal untuk:
   - Daily backup (setiap hari jam 2:00 AM)
   - Weekly backup (setiap minggu jam 3:00 AM)
   - Cleanup (pembersihan log lama setiap hari jam 4:00 AM)
4. **Backup Monitor** (`backup_monitor.php`) - Script monitoring sistem
5. **Windows Batch Script** (`daily_backup.bat`) - Script untuk Task Scheduler

### **‚öôÔ∏è CARA KERJA SISTEM:**

#### **üîÑ TRIGGER OTOMATIS:**
- **Setiap ada perubahan data** di tabel `families` atau `users`
- **Sistem otomatis mencatat** di `backup_log` table
- **User ID tercatat** untuk audit trail

#### **‚è∞ BACKUP TERJADWAL:**
- **Daily Backup:** Setiap hari jam 2:00 AM
- **Weekly Backup:** Setiap minggu jam 3:00 AM  
- **Cleanup:** Pembersihan log lama setiap hari jam 4:00 AM

#### **üìÅ RETENTION POLICY:**
- **Backup files:** Maksimal 20 file (bisa diubah)
- **Log retention:** 30 hari (bisa diubah)

### **üõ†Ô∏è CARA SETUP OTOMATIS (Windows):**

1. **Buka Task Scheduler**
2. **Create Basic Task**
3. **Set Trigger:** Daily at 2:00 AM
4. **Set Action:** Run `C:\xampp\htdocs\jemaat\daily_backup.bat`

### **üß™ TESTING:**
- **Test Backup:** `http://localhost/jemaat/auto_backup.php?test=1`
- **Monitor System:** `http://localhost/jemaat/backup_monitor.php?check=1`
- **Manual Backup:** `http://localhost/jemaat/backup_manager.php`

### **üìà MONITORING:**
- **Backup Log:** Cek tabel `backup_log` untuk tracking perubahan
- **Backup Files:** Cek folder `backups/` untuk file backup
- **System Status:** Gunakan `backup_monitor.php` untuk status sistem

**Sistem backup otomatis sudah siap digunakan!** üéâ


--------------------------------
Gabung.php:
mengabungkan beberapa file jd satu txt:


<?php
// File: C:\xampp\htdocs\jemaat\gabung_file.php

// Fungsi untuk mendapatkan semua file dalam direktori dan subdirektori
function getAllFiles($dir, $baseDir = '') {
    $files = [];
    $items = scandir($dir);
    
    foreach ($items as $item) {
        if ($item == '.' || $item == '..') continue;
        
        $path = $dir . DIRECTORY_SEPARATOR . $item;
        $relativePath = ($baseDir ? $baseDir . '/' : '') . $item;
        
        if (is_dir($path)) {
            // Jika direktori, rekursif cari file di dalamnya
            $files = array_merge($files, getAllFiles($path, $relativePath));
        } else {
            // Jika file (semua ekstensi), tambahkan ke array
            $files[$relativePath] = [
                'path' => $path,
                'extension' => pathinfo($path, PATHINFO_EXTENSION),
                'size' => filesize($path),
                'modified' => filemtime($path)
            ];
        }
    }
    
    return $files;
}

// Fungsi untuk membaca konten file dengan security check
function getFileContentSafe($filePath) {
    $base_dir = 'C:/xampp/htdocs/jemaat';
    $real_base = realpath($base_dir);
    $real_file = realpath($filePath);
    
    if ($real_file && strpos($real_file, $real_base) === 0 && is_file($real_file)) {
        $content = file_get_contents($real_file);
        return $content;
    } else {
        return "// Error: File tidak dapat diakses atau tidak ditemukan: " . $filePath;
    }
}

// Fungsi untuk format ukuran file
function formatBytes($size, $precision = 2) {
    if ($size == 0) return '0 B';
    
    $units = ['B', 'KB', 'MB', 'GB', 'TB'];
    $bytes = max($size, 0);
    $pow = floor(($bytes ? log($bytes) : 0) / log(1024));
    $pow = min($pow, count($units) - 1);
    $bytes /= pow(1024, $pow);
    
    return round($bytes, $precision) . ' ' . $units[$pow];
}

// Handle AJAX request untuk mendapatkan konten file
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action']) && $_POST['action'] === 'get_file_content') {
    header('Content-Type: text/plain; charset=utf-8');
    if (isset($_POST['file_path'])) {
        $file_path = $_POST['file_path'];
        echo getFileContentSafe($file_path);
    } else {
        echo "// Error: Parameter file_path tidak diberikan";
    }
    exit;
}

// Ambil semua file
$baseDir = 'C:/xampp/htdocs/jemaat';
$allFiles = getAllFiles($baseDir);

// Kelompokkan file berdasarkan ekstensi untuk filter
$extensions = [];
foreach ($allFiles as $fileInfo) {
    $ext = $fileInfo['extension'] ?: 'no-extension';
    if (!in_array($ext, $extensions)) {
        $extensions[] = $ext;
    }
}
sort($extensions);
?>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penggabung File - Copy ke Clipboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: white; 
            padding: 0;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            min-height: 80vh;
        }
        
        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            padding: 25px;
            overflow-y: auto;
        }
        
        .content {
            padding: 25px;
            display: flex;
            flex-direction: column;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
        }
        
        .filter-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }
        
        select, input[type="text"] {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        
        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .file-list { 
            height: 500px;
            overflow-y: auto; 
            border: 2px solid #e9ecef; 
            border-radius: 10px;
            background: white;
        }
        
        .file-item { 
            padding: 15px;
            background: white; 
            border-bottom: 1px solid #f1f3f4; 
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }
        
        .file-item:hover { 
            background: #f8f9fa; 
        }
        
        .file-item.selected {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
        }
        
        .folder { 
            font-weight: 600; 
            color: #2c3e50; 
            padding: 15px;
            background: #e9ecef;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .file-name {
            font-weight: 500;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-details {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #6c757d;
        }
        
        .file-extension {
            background: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .file-size {
            color: #495057;
        }
        
        .file-path {
            color: #adb5bd;
            font-size: 11px;
            font-family: 'Courier New', monospace;
        }
        
        .actions { 
            margin: 20px 0; 
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        button { 
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white; 
            border: none; 
            padding: 15px 25px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: center;
        }
        
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-copy {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
        }
        
        .btn-copy:hover {
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }
        
        .btn-copy.copied {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }
        
        .btn-reset:hover {
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.3);
        }
        
        .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }
        
        .preview-header {
            background: #2c3e50;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .preview { 
            flex: 1;
            background: #1e1e1e; 
            color: #d4d4d4;
            padding: 20px; 
            white-space: pre-wrap; 
            font-family: 'Consolas', 'Courier New', monospace; 
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .select-all { 
            margin-bottom: 15px; 
            padding: 15px;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 2px solid #bbdefb;
        }
        
        .stats {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #c8e6c9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .file-count {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .extension-badge {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 11px;
            margin-left: 8px;
        }
        
        input[type="checkbox"] {
            margin: 0;
            transform: scale(1.3);
            cursor: pointer;
        }
        
        label {
            cursor: pointer;
            user-select: none;
            margin: 0;
        }
        
        .search-box input {
            width: 100%;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.error {
            background: #e74c3c;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-state .icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .file-list {
                height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .actions {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .file-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .file-details {
                flex-wrap: wrap;
                gap: 8px;
            }
        }
        
        /* Scrollbar styling */
        .file-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .file-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .file-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        .file-list::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÅ File Merger & Clipboard</h1>
            <p>Pilih file dan langsung copy ke clipboard dengan satu klik!</p>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="controls">
                    <div class="filter-section">
                        <div class="filter-group">
                            <label>üîç Cari File:</label>
                            <input type="text" id="searchFilter" placeholder="Ketik nama file...">
                        </div>
                        
                        <div class="filter-group">
                            <label>üìÑ Filter Ekstensi:</label>
                            <select id="extensionFilter">
                                <option value="all">Semua Ekstensi</option>
                                <?php foreach ($extensions as $ext): ?>
                                    <option value="<?php echo $ext; ?>"><?php echo strtoupper($ext); ?></option>
                                <?php endforeach; ?>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="stats">
                    <div>
                        üìä <strong><?php echo count($allFiles); ?></strong> file ditemukan
                        <span class="extension-badge"><?php echo count($extensions); ?> ekstensi</span>
                    </div>
                    <div id="selectedStats">
                        ‚úÖ <strong>0</strong> dipilih
                    </div>
                </div>
                
                <div class="select-all">
                    <input type="checkbox" id="selectAll">
                    <label for="selectAll"><strong>Pilih Semua yang Tampil</strong></label>
                </div>
                
                <div class="file-list" id="fileListContainer">
                    <?php
                    $currentFolder = '';
                    $folderFiles = [];
                    
                    // Kelompokkan file berdasarkan folder
                    foreach ($allFiles as $relativePath => $fileInfo) {
                        $folder = dirname($relativePath);
                        if ($folder === '.') {
                            $folder = 'Root';
                        }
                        
                        if (!isset($folderFiles[$folder])) {
                            $folderFiles[$folder] = [];
                        }
                        $folderFiles[$folder][] = [
                            'relativePath' => $relativePath,
                            'fileInfo' => $fileInfo,
                            'filename' => basename($relativePath)
                        ];
                    }
                    
                    // Tampilkan file berdasarkan folder
                    foreach ($folderFiles as $folder => $files) {
                        echo '<div class="folder" data-folder="' . htmlspecialchars($folder) . '">';
                        echo 'üìÅ ' . htmlspecialchars($folder);
                        echo ' <span class="file-count">' . count($files) . '</span>';
                        echo '</div>';
                        
                        foreach ($files as $file) {
                            $extension = $file['fileInfo']['extension'] ?: 'no-ext';
                            echo '<div class="file-item" data-extension="' . $extension . '" data-folder="' . htmlspecialchars($folder) . '" data-path="' . htmlspecialchars($file['fileInfo']['path']) . '">';
                            echo '<input type="checkbox" class="file-checkbox" data-path="' . htmlspecialchars($file['fileInfo']['path']) . '">';
                            echo '<div class="file-info">';
                            echo '<div class="file-name">';
                            echo 'üìÑ ' . htmlspecialchars($file['filename']);
                            echo '</div>';
                            echo '<div class="file-details">';
                            echo '<span class="file-extension">' . strtoupper($extension) . '</span>';
                            echo '<span class="file-size">' . formatBytes($file['fileInfo']['size']) . '</span>';
                            echo '</div>';
                            echo '<div class="file-path">' . htmlspecialchars($file['relativePath']) . '</div>';
                            echo '</div>';
                            echo '</div>';
                        }
                    }
                    
                    if (empty($allFiles)) {
                        echo '<div class="empty-state">';
                        echo '<div class="icon">üìÅ</div>';
                        echo '<h3>Tidak ada file ditemukan</h3>';
                        echo '<p>Folder C:\\xampp\\htdocs\\jemaat kosong atau tidak dapat diakses</p>';
                        echo '</div>';
                    }
                    ?>
                </div>
            </div>
            
            <div class="content">
                <div class="preview-container">
                    <div class="preview-header">
                        <div>
                            <strong>üìã Preview & Hasil</strong>
                            <small style="opacity: 0.8; margin-left: 10px;">Konten akan muncul di sini</small>
                        </div>
                        <div id="previewStats">0 file dipilih</div>
                    </div>
                    <div class="preview" id="previewContent">
// Pilih file dari panel kiri untuk melihat preview di sini
// Hasil gabungan file akan ditampilkan di area ini
// Klik tombol "Copy ke Clipboard" untuk menyalin hasilnya
                    </div>
                </div>
                
                <div class="actions">
                    <button type="button" id="btnCopy" class="btn-copy">
                        üìã Copy ke Clipboard
                    </button>
                    <button type="button" id="btnReset" class="btn-reset">
                        üîÑ Reset Pilihan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        ‚úÖ Berhasil disalin ke clipboard!
    </div>

    <script>
        let selectedFiles = new Set();
        let combinedContent = '';
        
        // Fungsi untuk update statistik
        function updateStats() {
            const selectedCount = selectedFiles.size;
            document.getElementById('selectedStats').innerHTML = 
                '‚úÖ <strong>' + selectedCount + '</strong> dipilih';
            document.getElementById('previewStats').textContent = 
                selectedCount + ' file dipilih';
        }
        
        // Fungsi untuk update preview
        async function updatePreview() {
            if (selectedFiles.size === 0) {
                document.getElementById('previewContent').textContent = 
                    '// Pilih file dari panel kiri untuk melihat preview di sini\n' +
                    '// Hasil gabungan file akan ditampilkan di area ini\n' +
                    '// Klik tombol "Copy ke Clipboard" untuk menyalin hasilnya';
                combinedContent = '';
                return;
            }
            
            // Show loading in preview
            document.getElementById('previewContent').innerHTML = 
                '<div style="display: flex; align-items: center; gap: 10px; color: #3498db;">' +
                '<div class="loading"></div> Memuat konten file...' +
                '</div>';
            
            try {
                // Build combined content
                combinedContent = "// File yang digabungkan\n";
                combinedContent += "// Dibuat pada: " + new Date().toLocaleString() + "\n";
                combinedContent += "// Total file: " + selectedFiles.size + "\n\n";
                
                let loadedCount = 0;
                
                for (const filePath of selectedFiles) {
                    const response = await fetch('<?php echo $_SERVER["PHP_SELF"]; ?>', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: 'action=get_file_content&file_path=' + encodeURIComponent(filePath)
                    });
                    
                    const content = await response.text();
                    const fileName = filePath.split(/[\\/]/).pop();
                    
                    combinedContent += "\n" + "=".repeat(80) + "\n";
                    combinedContent += "===== " + filePath + " =====\n";
                    combinedContent += "=".repeat(80) + "\n\n";
                    combinedContent += content + "\n";
                    
                    loadedCount++;
                    
                    // Update loading progress
                    document.getElementById('previewContent').innerHTML = 
                        '<div style="display: flex; align-items: center; gap: 10px; color: #3498db;">' +
                        '<div class="loading"></div> Memuat file (' + loadedCount + '/' + selectedFiles.size + ')...' +
                        '</div>';
                }
                
                document.getElementById('previewContent').textContent = combinedContent;
                
            } catch (error) {
                document.getElementById('previewContent').textContent = 
                    '‚ùå Error memuat konten file:\n' + error.message;
                console.error('Error loading file content:', error);
            }
        }
        
        // Fungsi untuk copy ke clipboard
        async function copyToClipboard() {
            if (selectedFiles.size === 0) {
                showToast('‚ùå Pilih setidaknya satu file!', 'error');
                return;
            }
            
            if (!combinedContent) {
                await updatePreview();
            }
            
            try {
                await navigator.clipboard.writeText(combinedContent);
                showToast('‚úÖ Berhasil disalin ke clipboard!');
                
                // Update button state
                const btn = document.getElementById('btnCopy');
                btn.innerHTML = '‚úÖ Tersalin!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.innerHTML = 'üìã Copy ke Clipboard';
                    btn.classList.remove('copied');
                }, 2000);
                
            } catch (err) {
                // Fallback untuk browser yang tidak support clipboard API
                const textArea = document.createElement('textarea');
                textArea.value = combinedContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                showToast('‚úÖ Berhasil disalin ke clipboard!');
            }
        }
        
        // Fungsi untuk show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type === 'error' ? 'error' : 'show');
            if (type !== 'error') {
                toast.classList.add('show');
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Fungsi untuk filter file
        function filterFiles() {
            const extensionFilter = document.getElementById('extensionFilter').value;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
            
            const fileItems = document.querySelectorAll('.file-item');
            let visibleCount = 0;
            
            fileItems.forEach(item => {
                const extension = item.getAttribute('data-extension');
                const fileName = item.querySelector('.file-name').textContent.toLowerCase();
                const filePath = item.querySelector('.file-path').textContent.toLowerCase();
                
                const extensionMatch = extensionFilter === 'all' || extension === extensionFilter;
                const searchMatch = !searchFilter || 
                    fileName.includes(searchFilter) || 
                    filePath.includes(searchFilter);
                
                if (extensionMatch && searchMatch) {
                    item.style.display = 'flex';
                    visibleCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Sembunyikan folder yang kosong
            const folders = document.querySelectorAll('.folder');
            folders.forEach(folder => {
                const folderName = folder.getAttribute('data-folder');
                const folderFiles = document.querySelectorAll('.file-item[data-folder="' + folderName + '"]:not([style*="display: none"])');
                
                if (folderFiles.length > 0) {
                    folder.style.display = 'flex';
                } else {
                    folder.style.display = 'none';
                }
            });
            
            updateStats();
        }
        
        // Event Listeners
        document.getElementById('selectAll').addEventListener('change', function() {
            const visibleCheckboxes = document.querySelectorAll('.file-item:not([style*="display: none"]) .file-checkbox');
            visibleCheckboxes.forEach(checkbox => {
                const filePath = checkbox.getAttribute('data-path');
                if (this.checked) {
                    selectedFiles.add(filePath);
                    checkbox.checked = true;
                    checkbox.closest('.file-item').classList.add('selected');
                } else {
                    selectedFiles.delete(filePath);
                    checkbox.checked = false;
                    checkbox.closest('.file-item').classList.remove('selected');
                }
            });
            updateStats();
            updatePreview();
        });
        
        // File checkbox change
        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('file-checkbox')) {
                const filePath = e.target.getAttribute('data-path');
                if (e.target.checked) {
                    selectedFiles.add(filePath);
                    e.target.closest('.file-item').classList.add('selected');
                } else {
                    selectedFiles.delete(filePath);
                    e.target.closest('.file-item').classList.remove('selected');
                }
                updateStats();
                updatePreview();
            }
        });
        
        // File item click (toggle selection)
        document.addEventListener('click', function(e) {
            if (e.target.closest('.file-item') && !e.target.matches('input[type="checkbox"]')) {
                const fileItem = e.target.closest('.file-item');
                const checkbox = fileItem.querySelector('.file-checkbox');
                const filePath = checkbox.getAttribute('data-path');
                
                checkbox.checked = !checkbox.checked;
                if (checkbox.checked) {
                    selectedFiles.add(filePath);
                    fileItem.classList.add('selected');
                } else {
                    selectedFiles.delete(filePath);
                    fileItem.classList.remove('selected');
                }
                updateStats();
                updatePreview();
            }
        });
        
        // Filter events
        document.getElementById('searchFilter').addEventListener('input', filterFiles);
        document.getElementById('extensionFilter').addEventListener('change', filterFiles);
        
        // Button events
        document.getElementById('btnCopy').addEventListener('click', copyToClipboard);
        
        document.getElementById('btnReset').addEventListener('click', function() {
            selectedFiles.clear();
            document.querySelectorAll('.file-checkbox').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.closest('.file-item').classList.remove('selected');
            });
            document.getElementById('selectAll').checked = false;
            updateStats();
            updatePreview();
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
        });
    </script>
</body>
</html>


---------------------------------------

14 oktober 25

hapus database jemaat di phpmyadmin:
Untuk menghapus semua database dengan urutan constraint yang benar, Anda perlu memperhatikan urutan penghapusan tabel berdasarkan foreign key constraints. Berikut adalah script DROP TABLE dengan urutan yang tepat:

```sql
-- Nonaktifkan foreign key checks sementara
SET FOREIGN_KEY_CHECKS = 0;

-- Mulai menghapus tabel dalam urutan yang benar (dari child ke parent)

-- 1. Hapus tabel-tabel yang memiliki foreign key ke tabel utama
DROP TABLE IF EXISTS `edit_requests`;
DROP TABLE IF EXISTS `event_attendances`;
DROP TABLE IF EXISTS `annual_contributions`;
DROP TABLE IF EXISTS `monthly_contributions`;
DROP TABLE IF EXISTS `backup_log`;
DROP TABLE IF EXISTS `share_tracking`;
DROP TABLE IF EXISTS `staging_family_members`;
DROP TABLE IF EXISTS `staging_families`;
DROP TABLE IF EXISTS `user_neighborhoods`;
DROP TABLE IF EXISTS `children`;
DROP TABLE IF EXISTS `guardians`;
DROP TABLE IF EXISTS `fathers`;
DROP TABLE IF EXISTS `mothers`;
DROP TABLE IF EXISTS `family_members`;
DROP TABLE IF EXISTS `events`;

-- 2. Hapus tabel-tabel utama
DROP TABLE IF EXISTS `members`;
DROP TABLE IF EXISTS `families`;
DROP TABLE IF EXISTS `users`;
DROP TABLE IF EXISTS `church_neighborhoods`;
DROP TABLE IF EXISTS `tenants`;
DROP TABLE IF EXISTS `churches`;

-- Aktifkan kembali foreign key checks
SET FOREIGN_KEY_CHECKS = 1;
```

**Penjelasan urutan penghapusan:**

1. **Tabel dengan foreign key multiple**: `edit_requests`, `event_attendances`, dll.
2. **Tabel transaksi/child**: `annual_contributions`, `monthly_contributions`
3. **Tabel log/tracking**: `backup_log`, `share_tracking`
4. **Tabel staging**: `staging_family_members`, `staging_families`
5. **Tabel relasi many-to-many**: `user_neighborhoods`
6. **Tabel data keluarga**: `children`, `guardians`, `fathers`, `mothers`, `family_members`
7. **Tabel events**: `events`
8. **Tabel utama**: `members`, `families`
9. **Tabel users**: `users`
10. **Tabel referensi**: `church_neighborhoods`, `tenants`, `churches`

**Atau jika ingin lebih sederhana, bisa menggunakan pendekatan ini:**

```sql
-- Nonaktifkan foreign key checks
SET FOREIGN_KEY_CHECKS = 0;

-- Dapatkan semua nama tabel
SELECT CONCAT('DROP TABLE IF EXISTS `', TABLE_NAME, '`;') 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'gkpimeda_db';

-- Hasil query di atas akan menghasilkan DROP statements untuk semua tabel
-- Kemudian jalankan DROP statements tersebut

-- Aktifkan kembali foreign key checks
SET FOREIGN_KEY_CHECKS = 1;
```

**Untuk eksekusi langsung, gunakan script ini:**

```sql
SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS 
    `edit_requests`,
    `event_attendances`, 
    `annual_contributions`,
    `monthly_contributions`,
    `backup_log`,
    `share_tracking`,
    `staging_family_members`,
    `staging_families`,
    `user_neighborhoods`,
    `children`,
    `guardians`,
    `fathers`,
    `mothers`,
    `family_members`,
    `events`,
    `members`,
    `families`,
    `users`,
    `church_neighborhoods`,
    `tenants`,
    `churches`;

SET FOREIGN_KEY_CHECKS = 1;
```

**Catatan penting:**
- `SET FOREIGN_KEY_CHECKS = 0` menonaktifkan pengecekan foreign key sementara
- Urutan penghapusan dari child table ke parent table
- Pastikan Anda benar-benar ingin menghapus semua data, karena ini tidak dapat dibatalkan
- Disarankan untuk backup database terlebih dahulu sebelum menjalankan perintah ini






-----------------------------------------------
23oktober

a



dibawah ini aplikasi laporan keuangannya:
// File yang digabungkan
// Dibuat pada: 10/23/2025, 1:42:55 PM
// Total file: 4


================================================================================
===== C:/xampp/htdocs/teste\config.php =====
================================================================================

<?php
// Error reporting untuk development (comment untuk production)
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Konfigurasi Database
define('DB_HOST', 'localhost');
define('DB_USER', 'root');
define('DB_PASS', '');
define('DB_NAME', 'gereja');

// Koneksi ke Database
$conn = new mysqli(DB_HOST, DB_USER, DB_PASS, DB_NAME);

if ($conn->connect_error) {
    die("Koneksi gagal: " . $conn->connect_error);
}

// Set timezone
date_default_timezone_set('Asia/Jakarta');

// Base URL Configuration
// Deteksi otomatis base URL atau set manual
function getBaseUrl() {
    // Check if running from CLI
    if (php_sapi_name() === 'cli') {
        return 'http://localhost/teste';
    }
    
    $protocol = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off') ? 'https://' : 'http://';
    $host = $_SERVER['HTTP_HOST'] ?? 'localhost';
    $script = $_SERVER['SCRIPT_NAME'] ?? '';
    $path = dirname($script);

    // Normalisasi path
    $path = str_replace('\\', '/', $path);
    $path = rtrim($path, '/');

    return $protocol . $host . $path;
}

// Set base URL
define('BASE_URL', getBaseUrl()); // Auto-detection untuk development

// Manual base URL untuk production (uncomment dan edit sesuai domain, lalu comment baris di atas)
// define('BASE_URL', 'http://localhost/teste');
// define('BASE_URL', 'https://yourdomain.com/gereja');
// define('BASE_URL', 'https://gerejaku.com/keuangan');

// Hapus/komentari fungsi URL helper dari config.php untuk menghindari konflik
// Semua fungsi URL helper sekarang ada di includes/url_helper.php
/*
// Helper functions untuk URL - DIPINDAH KE includes/url_helper.php
function url($path = '') {
    $path = ltrim($path, '/');
    return BASE_URL . ($path ? '/' . $path : '');
}

function asset($path = '') {
    return url($path);
}

function redirect($path = '') {
    header('Location: ' . url($path));
    exit;
}

// Helper functions untuk file paths - DIPINDAH KE includes/url_helper.php
function base_path($path = '') {
    return __DIR__ . ($path ? DIRECTORY_SEPARATOR . $path : '');
}

function views_path($path = '') {
    return base_path('views' . ($path ? DIRECTORY_SEPARATOR . $path : ''));
}

function include_view($view) {
    return include views_path($view);
}
*/

// Ambil daftar jurnal dari database
$daftar_jurnal = [];
$sql = "SELECT id_jurnal, kode_jurnal, nama_jurnal FROM jurnal ORDER BY id_jurnal";
$result = $conn->query($sql);

if ($result && $result->num_rows > 0) {
    while($row = $result->fetch_assoc()) {
        $daftar_jurnal[$row['id_jurnal']] = $row['nama_jurnal'];
    }
} else {
    // Fallback jika tabel jurnal kosong atau error
    $daftar_jurnal = [
        1 => 'Pengeluaran Jemaat',
        2 => 'Penerimaan Jemaat',
        3 => 'Penerimaan Saldo Bank',
        4 => 'Penerimaan GSG',
        5 => 'JURNAL PENERIMAAN JEMAAT SALDO BANK MANDIRI'
    ];
}
?>

================================================================================
===== C:/xampp/htdocs/teste\functions.php =====
================================================================================

<?php
function showForm() {
    global $conn, $daftar_jurnal;
    
    // Ambil data jurnal
    $jurnal = [];
    $sql = "SELECT * FROM jurnal ORDER BY nama_jurnal";
    $result = $conn->query($sql);
    if ($result->num_rows > 0) {
        while($row = $result->fetch_assoc()) {
            $jurnal[] = $row;
        }
    }
    
    // Ambil data kategori untuk jurnal pertama sebagai default
    $kategori = [];
    if (!empty($jurnal)) {
        $first_journal = $jurnal[0]['id_jurnal'];
        $sql = "SELECT * FROM kategori WHERE id_jurnal = ? ORDER BY kode_kategori";
        $stmt = $conn->prepare($sql);
        $stmt->bind_param("i", $first_journal);
        $stmt->execute();
        $result = $stmt->get_result();
        
        while($row = $result->fetch_assoc()) {
            $kategori[] = $row;
        }
    }
    
    include 'views/form.php';
}

function getKategoriByJurnal() {
    global $conn;
    
    $id_jurnal = isset($_GET['id_jurnal']) ? intval($_GET['id_jurnal']) : 0;
    
    $kategori = [];
    $sql = "SELECT * FROM kategori WHERE id_jurnal = ? ORDER BY kode_kategori";
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("i", $id_jurnal);
    $stmt->execute();
    $result = $stmt->get_result();
    
    while($row = $result->fetch_assoc()) {
        $kategori[] = $row;
    }
    
    header('Content-Type: application/json');
    echo json_encode($kategori);
    exit;
}

function getSubkategori() {
    global $conn;
    
    $id_kategori = isset($_GET['id_kategori']) ? intval($_GET['id_kategori']) : 0;
    
    // Debug log
    error_log("getSubkategori called with id_kategori: " . $id_kategori);
    
    $subkategori = [];
    $sql = "SELECT * FROM subkategori WHERE id_kategori = ? ORDER BY kode_subkategori";
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("i", $id_kategori);
    $stmt->execute();
    $result = $stmt->get_result();
    
    while($row = $result->fetch_assoc()) {
        $subkategori[] = $row;
    }
    
    // Debug log
    error_log("Subkategori found: " . count($subkategori));
    error_log("Data: " . json_encode($subkategori));
    
    header('Content-Type: application/json');
    echo json_encode($subkategori);
    exit;
}

function sanitizeSimple($input) {
    // Hapus karakter tanda baca sederhana kecuali spasi, huruf, angka, dash dan slash
    return preg_replace('/[^a-zA-Z0-9\s\-\/]/', '', trim($input));
}

function submitForm() {
    global $conn;

    // Validasi input
    $errors = [];

    // Common validations for both modes
    if (empty($_POST['tanggal'])) {
        $errors[] = "Tanggal harus diisi";
    }

    if (empty($_POST['no_kwitansi'])) {
        $errors[] = "Nomor KW harus diisi";
    }

    if (empty($_POST['id_jurnal'])) {
        $errors[] = "Silakan pilih jurnal";
    }

    // Sanitize simple inputs
    $no_kwitansi = isset($_POST['no_kwitansi']) ? sanitizeSimple($_POST['no_kwitansi']) : '';
    $uraian = isset($_POST['uraian']) ? sanitizeSimple($_POST['uraian']) : '';
    $diterima_dari = isset($_POST['diterima_dari']) ? sanitizeSimple($_POST['diterima_dari']) : '';

    // Assign id_jurnal from POST
    $id_jurnal = isset($_POST['id_jurnal']) ? intval($_POST['id_jurnal']) : null;

    // Determine input mode
    $jenis_input = isset($_POST['jenis_input']) ? $_POST['jenis_input'] : 'lengkap';

    if ($jenis_input === 'setoran') {
        // Setoran mode: only validate setoran amount
        if (empty($_POST['setoran']) || !is_numeric($_POST['setoran']) || $_POST['setoran'] <= 0) {
            $errors[] = "Setoran harus angka dan lebih dari 0";
        }
    } else {
        // Lengkap mode: validate all fields
        if (empty($_POST['jumlah']) || !is_numeric($_POST['jumlah']) || $_POST['jumlah'] <= 0) {
            $errors[] = "Jumlah harus angka dan lebih dari 0";
        }

        if (empty($_POST['id_kategori'])) {
            $errors[] = "Silakan pilih kategori";
        }

        if (empty($_POST['id_subkategori'])) {
            $errors[] = "Silakan pilih sub kategori";
        }
    }

    if (count($errors) > 0) {
        $_SESSION['errors'] = $errors;
        header("Location: index.php");
        exit;
    }

    // Determine uang_dari_bank based on jurnal ID and input mode
    $is_income = in_array($id_jurnal, [2, 3, 4, 5]);

    // Simpan data
    $tanggal = date('Y-m-d', strtotime($_POST['tanggal']));

    if ($jenis_input === 'setoran') {
        // Setoran mode: save setoran amount, set jumlah to 0, no kategori/subkategori
        $jumlah = 0;
        $id_subkategori = null;
        $setoran = $_POST['setoran'];
        $uang_dari_bank = $is_income ? $setoran : NULL;

        $sql = "INSERT INTO transaksi (tanggal, no_kwitansi, uraian, jumlah, id_jurnal, id_subkategori, setoran, uang_dari_bank)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?)";
        $stmt = $conn->prepare($sql);
        $stmt->bind_param("sssdidds", $tanggal, $no_kwitansi, $uraian, $jumlah, $id_jurnal, $id_subkategori, $setoran, $uang_dari_bank);
    } else {
        // Lengkap mode: save all fields normally
        $jumlah = $_POST['jumlah'];
        $id_subkategori = $_POST['id_subkategori'];
        $setoran = isset($_POST['setoran']) ? $_POST['setoran'] : 0;
        $uang_dari_bank = $is_income ? $jumlah : NULL;

        $sql = "INSERT INTO transaksi (tanggal, no_kwitansi, uraian, jumlah, id_jurnal, id_subkategori, setoran, uang_dari_bank)
                VALUES (?, ?, ?, ?, ?, ?, ?, ?)";
        $stmt = $conn->prepare($sql);
        $stmt->bind_param("sssdidds", $tanggal, $no_kwitansi, $uraian, $jumlah, $id_jurnal, $id_subkategori, $setoran, $uang_dari_bank);
    }

    if ($stmt->execute()) {
        $_SESSION['success'] = "Data transaksi berhasil disimpan!";

        // Proses laporan (Sheet 2 dan Sheet 3)
        generateReports();
    } else {
        $_SESSION['errors'] = ["Gagal menyimpan data: " . $conn->error];
    }

    header("Location: index.php");
    exit;
}

// Fungsi untuk menghasilkan laporan Sheet 2 (Terstruktur) dengan filter
function generateSheet2Report($jurnal_filter = null, $tahun_filter = null) {
    global $conn;
    
    $where_conditions = [];
    $params = [];
    $types = "";
    
    if ($jurnal_filter) {
        $where_conditions[] = "j.id_jurnal = ?";
        $params[] = $jurnal_filter;
        $types .= "i";
    }
    
    if ($tahun_filter) {
        $where_conditions[] = "YEAR(t.tanggal) = ?";
        $params[] = $tahun_filter;
        $types .= "i";
    }
    
    $where_clause = "";
    if (!empty($where_conditions)) {
        $where_clause = "WHERE " . implode(" AND ", $where_conditions);
    }
    
    $sql = "SELECT
                DATE_FORMAT(t.tanggal, '%M %Y') as bulan,
                CONCAT(k.kode_kategori, ' - ', k.nama_kategori) as kategori,
                s.kode_subkategori,
                s.nama_subkategori,
                CONCAT(s.kode_subkategori, ' - ', s.nama_subkategori) as subkategori,
                t.tanggal,
                t.no_kwitansi,
                t.uraian,
                t.jumlah,
                t.setoran,
                t.uang_dari_bank,
                j.nama_jurnal,
                j.id_jurnal
            FROM transaksi t
            JOIN jurnal j ON t.id_jurnal = j.id_jurnal
            LEFT JOIN subkategori s ON t.id_subkategori = s.id_subkategori
            LEFT JOIN kategori k ON s.id_kategori = k.id_kategori
            $where_clause
            ORDER BY t.tanggal, j.nama_jurnal, k.kode_kategori, s.kode_subkategori";
    
    $stmt = $conn->prepare($sql);
    
    if (!empty($params)) {
        $stmt->bind_param($types, ...$params);
    }
    
    $stmt->execute();
    $result = $stmt->get_result();
    $transactions = [];
    
    if ($result->num_rows > 0) {
        while($row = $result->fetch_assoc()) {
            $transactions[] = $row;
        }
    }
    
    // Kelompokkan data berdasarkan jurnal, bulan, level 1 subkategori, dan level 2 subkategori
    $structured_data = [];

    foreach ($transactions as $trx) {
        $jurnal = $trx['nama_jurnal'];
        $bulan = $trx['bulan'];

        if ($trx['kode_subkategori']) {
            $level1_kode = substr($trx['kode_subkategori'], 0, 6);
            $level1_nama = $trx['nama_subkategori'] ? substr($trx['nama_subkategori'], 0, strpos($trx['nama_subkategori'], ' - ') ?: strlen($trx['nama_subkategori'])) : ($trx['kategori'] ?? 'Tidak ada kategori');
            $level1 = $level1_kode . ' - ' . $level1_nama;
            $level2 = $trx['subkategori'];
        } else {
            // Determine label based on journal type: "Uang dari Bank" for income journals, "Uang Setoran" for expense journals
            $is_income_journal = in_array($trx['id_jurnal'], [2,3,4,5]);
            $uang_setoran_label = $is_income_journal ? "Uang dari Bank" : "Uang Setoran";
            $level1 = $uang_setoran_label;
            $level2 = $uang_setoran_label;
        }

        if (!isset($structured_data[$jurnal])) {
            $structured_data[$jurnal] = [];
        }

        if (!isset($structured_data[$jurnal][$bulan])) {
            $structured_data[$jurnal][$bulan] = [];
        }

        if (!isset($structured_data[$jurnal][$bulan][$level1])) {
            $structured_data[$jurnal][$bulan][$level1] = [
                'kategori' => $trx['kategori'] ?? 'Tidak ada kategori',
                'subcategories' => [],
                'total' => 0
            ];
        }

        if (!isset($structured_data[$jurnal][$bulan][$level1]['subcategories'][$level2])) {
            $structured_data[$jurnal][$bulan][$level1]['subcategories'][$level2] = [
                'transactions' => [],
                'total' => 0
            ];
        }

        // Determine amount based on journal type
        $is_income_journal = in_array($trx['id_jurnal'], [2, 3, 4, 5]);
        $is_expense_journal = in_array($trx['id_jurnal'], [1]);

        if ($is_income_journal) {
            // For income journals, use uang_dari_bank, setoran, or jumlah
            $amount = $trx['uang_dari_bank'] ?? ($trx['setoran'] ?? $trx['jumlah']);
        } elseif ($is_expense_journal) {
            // For expense journals, use setoran or jumlah
            $amount = $trx['setoran'] ?? $trx['jumlah'];
        } else {
            // Fallback for other journals
            $amount = $trx['jumlah'] + ($trx['setoran'] ?? 0);
        }

        $structured_data[$jurnal][$bulan][$level1]['subcategories'][$level2]['transactions'][] = [
            'tanggal' => $trx['tanggal'],
            'no_kwitansi' => $trx['no_kwitansi'],
            'uraian' => $trx['uraian'],
            'jumlah' => $trx['jumlah'],
            'setoran' => $trx['setoran'] ?? 0,
            'uang_dari_bank' => $trx['uang_dari_bank'] ?? 0
        ];

        $structured_data[$jurnal][$bulan][$level1]['subcategories'][$level2]['total'] += $amount;
        $structured_data[$jurnal][$bulan][$level1]['total'] += $amount;
    }
    
    // Simpan ke session untuk ditampilkan
    $_SESSION['sheet2_report'] = $structured_data;
}

// Fungsi untuk menghasilkan laporan Sheet 3 (Horizontal) dengan filter
function generateSheet3Report($jurnal_filter = null, $tahun_filter = null, $bulan_filter = null) {
    global $conn;

    $where_conditions = [];
    $params = [];
    $types = "";

    if ($jurnal_filter) {
        $where_conditions[] = "t.id_jurnal = ?";
        $params[] = $jurnal_filter;
        $types .= "i";
    }

    if ($tahun_filter) {
        $where_conditions[] = "YEAR(t.tanggal) = ?";
        $params[] = $tahun_filter;
        $types .= "i";
    }

    if ($bulan_filter) {
        $where_conditions[] = "MONTH(t.tanggal) = ?";
        $params[] = $bulan_filter;
        $types .= "i";
    }

    $where_clause = "";
    if (!empty($where_conditions)) {
        $where_clause = "WHERE " . implode(" AND ", $where_conditions);
    }

    $sql = "SELECT
                t.*,
                j.nama_jurnal,
                j.id_jurnal,
                k.kode_kategori,
                k.nama_kategori,
                k.id_jurnal as kategori_jurnal_id,
                s.kode_subkategori,
                s.nama_subkategori,
                DATE_FORMAT(t.tanggal, '%M %Y') as bulan_format
            FROM transaksi t
            JOIN jurnal j ON t.id_jurnal = j.id_jurnal
            LEFT JOIN subkategori s ON t.id_subkategori = s.id_subkategori
            LEFT JOIN kategori k ON s.id_kategori = k.id_kategori
            $where_clause
            ORDER BY t.tanggal";

    $stmt = $conn->prepare($sql);

    if (!empty($params)) {
        $stmt->bind_param($types, ...$params);
    }

    $stmt->execute();
    $result = $stmt->get_result();
    $transactions = [];

    if ($result && $result->num_rows > 0) {
        while ($row = $result->fetch_assoc()) {
            $transactions[] = $row;
        }
    }

    // Anggaran (opsional; guard jika tabel belum ada)
    $anggaranDict = [];
    if ($conn->query("SHOW TABLES LIKE 'anggaran_pendapatan'")->num_rows) {
        // Cek struktur tabel untuk memastikan kolom 'type' ada
        $checkColumn = $conn->query("SHOW COLUMNS FROM anggaran_pendapatan LIKE 'type'");

        if ($checkColumn && $checkColumn->num_rows > 0) {
            // Kolom type ada, gunakan query dengan type
            $sqlAnggaran = "SELECT kode_subkategori, bulan, jumlah, type FROM anggaran_pendapatan";
            if ($resA = $conn->query($sqlAnggaran)) {
                while ($r = $resA->fetch_assoc()) {
                    $key = $r['kode_subkategori'] . '|' . $r['bulan'] . '|' . $r['type'];
                    $anggaranDict[$key] = (float)$r['jumlah'];
                }
            }
        } else {
            // Kolom type belum ada, gunakan query tanpa type (fallback)
            $sqlAnggaran = "SELECT kode_subkategori, bulan, jumlah FROM anggaran_pendapatan";
            if ($resA = $conn->query($sqlAnggaran)) {
                while ($r = $resA->fetch_assoc()) {
                    $key = $r['kode_subkategori'] . '|' . $r['bulan'] . '|subkategori';
                    $anggaranDict[$key] = (float)$r['jumlah'];
                }
            }
        }
    }

    // Uraian subkategori
    $uraianDict = [];
    if ($resU = $conn->query("SELECT kode_subkategori, nama_subkategori FROM subkategori")) {
        while ($r = $resU->fetch_assoc()) {
            $uraianDict[$r['kode_subkategori']] = $r['nama_subkategori'];
        }
    }

    $allBulan = [];
    $totalKas = [];
    $kategoriDict = [];
    $subKategoriDict = [];
    $totalPerKategoriBulan = [];
    $totalPerKelompok = [];
    $totalKeseluruhanPerBulan = [];
    $uangSetoranDict = [];
    $uangDariBankDict = [];
    $allCategories = [];
    $allSubCategories = [];

    // Kumpulkan kategori dan subkategori dari master
    foreach ($uraianDict as $kode => $nama) {
        $kategori = (strlen($kode) >= 6) ? substr($kode, 0, 6) : $kode;
        if (!in_array($kategori, $allCategories)) {
            $allCategories[] = $kategori;
            $allSubCategories[$kategori] = [];
        }
        if (!in_array($kode, $allSubCategories[$kategori])) {
            $allSubCategories[$kategori][] = $kode;
        }
    }

    foreach ($transactions as $trx) {
        $bulan = $trx['bulan_format'];
        $namaJurnal = strtolower($trx['nama_jurnal'] ?? '');

        $jumlah = (float)($trx['jumlah'] ?? 0);
        $setoran = (float)($trx['setoran'] ?? 0);
        $uangDariBank = (float)($trx['uang_dari_bank'] ?? 0);

        $isIncomeJournal = strpos($namaJurnal, 'penerimaan') !== false;
        $isExpenseJournal = strpos($namaJurnal, 'pengeluaran') !== false;

        // Tentukan alokasi khusus setoran/uang dari bank berdasarkan jenis jurnal
        $allocatedToSpecialRow = false;
        if ($isIncomeJournal && $uangDariBank > 0) {
            // Jurnal penerimaan: pakai uang_dari_bank sebagai pemasukan khusus
            if (!in_array($bulan, $allBulan)) {
                $allBulan[] = $bulan;
                $totalKeseluruhanPerBulan[$bulan] = 0;
            }
            $uangDariBankDict[$bulan] = ($uangDariBankDict[$bulan] ?? 0) + $uangDariBank;
            $totalKeseluruhanPerBulan[$bulan] += $uangDariBank;
            $allocatedToSpecialRow = true;
        } elseif ($isExpenseJournal && $setoran > 0) {
            // Jurnal pengeluaran: setoran sebagai baris khusus (misal pembayaran via setoran)
            if (!in_array($bulan, $allBulan)) {
                $allBulan[] = $bulan;
                $totalKeseluruhanPerBulan[$bulan] = 0;
            }
            $uangSetoranDict[$bulan] = ($uangSetoranDict[$bulan] ?? 0) + $setoran;
            $totalKeseluruhanPerBulan[$bulan] += $setoran;
            // Catatan: untuk pengeluaran, nilai kategori akan menggunakan (jumlah - setoran) di bawah
        }

        // Nilai kategori per subkategori
        $kas = 0;
        if ($isExpenseJournal) {
            // Pengeluaran: nominal subkategori = jumlah - setoran
            $kas = max(0, $jumlah - $setoran);
        } else {
            // Penerimaan: nominal subkategori = jumlah (setoran dikelola terpisah untuk income via uang_dari_bank)
            $kas = $jumlah;
        }
        if ($kas == 0) {
            continue;
        }

        $kodeSub = cleanCode($trx['kode_subkategori'] ?? '');
        if ($kodeSub === '') {
            // Coba gunakan kode_kategori jika tersedia agar tidak ter-skip
            $kodeKategori = cleanCode($trx['kode_kategori'] ?? '');
            if ($kodeKategori !== '') {
                $kategori = (strlen($kodeKategori) >= 3) ? substr($kodeKategori, 0, 3) : $kodeKategori;
                // Placeholder subkategori agar bisa ditampilkan
                $kodeSub = $kodeKategori . '.00.000';
            } else {
                // Tidak punya subkategori maupun kategori, lewati
                continue;
            }
        }

        // Tentukan kode kategori level-1 (xxx.xx)
        if (strlen($kodeSub) >= 6) {
            $kategori = substr($kodeSub, 0, 6);
        } else {
            $kategori = strlen($kodeSub) >= 3 ? substr($kodeSub, 0, 3) : $kodeSub;
        }

        if (!isset($kategoriDict[$kategori])) {
            $kategoriDict[$kategori] = true;
            $subKategoriDict[$kategori] = [];
        }
        if (!in_array($kodeSub, $subKategoriDict[$kategori])) {
            $subKategoriDict[$kategori][] = $kodeSub;
        }

        $uniqueKey = $kategori.'|'.$kodeSub.'|'.$bulan;
        $totalKas[$uniqueKey] = ($totalKas[$uniqueKey] ?? 0) + $kas;

        // Debug: Log nilai yang disimpan
        // error_log("DEBUG Sheet3: Saving to totalKas[$uniqueKey] = " . $totalKas[$uniqueKey] . " (added $kas)");

        $kelompokKey = substr($kategori, 0, 3);
        $kelompokTotalKey = $kelompokKey.'|'.$bulan;
        $totalPerKelompok[$kelompokTotalKey] = ($totalPerKelompok[$kelompokTotalKey] ?? 0) + $kas;

        $totalKey = $kategori.'|'.$bulan;
        $totalPerKategoriBulan[$totalKey] = ($totalPerKategoriBulan[$totalKey] ?? 0) + $kas;

        // Pastikan inisialisasi untuk total keseluruhan per bulan
        if (!array_key_exists($bulan, $totalKeseluruhanPerBulan)) {
            $totalKeseluruhanPerBulan[$bulan] = 0;
        }
        $totalKeseluruhanPerBulan[$bulan] += $kas;
    }

    // Fallback: jika belum ada bulan terisi (misal karena proses sebelumnya melewati semua),
    // turunkan daftar bulan dari kunci koleksi yang ada
    if (empty($allBulan)) {
        $bulanSet = [];
        foreach (array_keys($totalKas) as $k) {
            $parts = explode('|', $k);
            if (count($parts) === 3) $bulanSet[$parts[2]] = true;
        }
        foreach (array_keys($totalPerKategoriBulan) as $k) {
            $parts = explode('|', $k);
            if (count($parts) === 2) $bulanSet[$parts[1]] = true;
        }
        foreach (array_keys($totalPerKelompok) as $k) {
            $parts = explode('|', $k);
            if (count($parts) === 2) $bulanSet[$parts[1]] = true;
        }
        foreach (array_keys($uangSetoranDict) as $b) $bulanSet[$b] = true;
        foreach (array_keys($uangDariBankDict) as $b) $bulanSet[$b] = true;
        $allBulan = array_keys($bulanSet);
    }

    usort($allBulan, fn($a,$b)=> strtotime($a)-strtotime($b));
    sort($allCategories);
    foreach ($allSubCategories as $k => $arr) sort($allSubCategories[$k]);

    $_SESSION['sheet3_report'] = [
        'bulan' => $allBulan,
        'uang_setoran' => $uangSetoranDict,
        'uang_dari_bank' => $uangDariBankDict,
        'total_kas' => $totalKas,
        'kategori_dict' => $kategoriDict,
        'subkategori_dict' => $subKategoriDict,
        'total_per_kategori_bulan' => $totalPerKategoriBulan,
        'total_per_kelompok' => $totalPerKelompok,
        'total_keseluruhan_per_bulan' => $totalKeseluruhanPerBulan,
        'all_categories' => $allCategories,
        'all_sub_categories' => $allSubCategories,
        'uraian_dict' => $uraianDict,
        'anggaran_dict' => $anggaranDict
    ];

    // Simpan daftar jurnal ke session untuk export
    global $daftar_jurnal;
    $_SESSION['daftar_jurnal'] = $daftar_jurnal;

    // Kembalikan report untuk pemanggilan programatik (audit)
    return $_SESSION['sheet3_report'];
}

function isUangSetoran($trx) {
    // Primary check: treat uang_dari_bank as nominal; jika > 0 maka setoran/transfer
    if (isset($trx['uang_dari_bank']) && (float)$trx['uang_dari_bank'] > 0) {
        return true;
    }

    // Fallback checks for backward compatibility
    // Check if it's a setoran transaction (setoran > 0 and jumlah = 0)
    if ((float)($trx['setoran'] ?? 0) > 0 && (float)$trx['jumlah'] == 0) return true;
    // Legacy check for transactions without subkategori but with jumlah > 0
    if (empty($trx['kode_subkategori']) && (float)$trx['jumlah'] > 0) return true;
    // Check uraian for "Uang Setoran"
    if (!empty($trx['uraian']) && stripos($trx['uraian'], 'Uang Setoran') !== false) return true;
    return false;
}

function cleanCode($kode) {
    if (empty($kode)) return '';
    return preg_replace('/[^0-9.]/', '', $kode);
}

// Alias kompatibilitas bila ada pemanggilan lama
function generateHorizontalReport() {
    generateSheet3Report();
}

// Modifikasi fungsi generateReports untuk memanggil semua laporan
function generateReports() {
    generateSheet1Report();     // Sheet 1
    generateSheet2Report();     // Sheet 2
    generateSheet3Report();     // Sheet 3
}

/**
 * Fungsi untuk menghasilkan laporan keuangan saluran GKPI Medan Kota per bulan
 * dengan pembagian penerimaan dan pengeluaran berdasarkan jurnal
 */
function generateLaporanKeuangan($tahun = null, $jurnal_filter = null) {
    global $conn;

    // Mapping nama jurnal ke singkatan
    $jurnal_abbreviations = [
        'Penerimaan Jemaat' => 'PJ',
        'Penerimaan Persembahan' => 'PP',
        'Penerimaan Lain-lain' => 'PL',
        'Pengeluaran Operasional' => 'PO',
        'Pengeluaran Program' => 'PPG',
        'Pengeluaran Lain-lain' => 'PLN',
        'Penerimaan Saldo Bank' => 'PSB',
        'Penerimaan GSG' => 'PGSG',
        'JURNAL PENERIMAAN & PENGELUARAN JEMAAT di Bank Mandiri' => 'JPM',
        // Tambahkan mapping lainnya sesuai kebutuhan
    ];

    // Ambil daftar jurnal penerimaan dan pengeluaran berdasarkan nama jurnal
    $sql_jurnal = "SELECT id_jurnal, nama_jurnal FROM jurnal";
    $result_jurnal = $conn->query($sql_jurnal);
    $jurnal_penerimaan = [];
    $jurnal_pengeluaran = [];

    if ($result_jurnal && $result_jurnal->num_rows > 0) {
        while ($row = $result_jurnal->fetch_assoc()) {
            $nama = strtolower($row['nama_jurnal']);
            if (strpos($nama, 'penerimaan') !== false) {
                $jurnal_penerimaan[] = $row['id_jurnal'];
            } elseif (strpos($nama, 'pengeluaran') !== false) {
                $jurnal_pengeluaran[] = $row['id_jurnal'];
            }
        }
    }

    // Ambil transaksi penerimaan dan pengeluaran per bulan dengan filter jurnal jika ada
    $sql = "SELECT 
                DATE_FORMAT(t.tanggal, '%Y-%m') as bulan,
                t.tanggal,
                t.uraian,
                t.no_kwitansi,
                t.jumlah,
                j.id_jurnal,
                j.nama_jurnal,
                k.kode_kategori
            FROM transaksi t
            JOIN jurnal j ON t.id_jurnal = j.id_jurnal
            LEFT JOIN subkategori s ON t.id_subkategori = s.id_subkategori
            LEFT JOIN kategori k ON s.id_kategori = k.id_kategori
            WHERE YEAR(t.tanggal) = ?";

    if ($jurnal_filter !== null && $jurnal_filter !== '') {
        $sql .= " AND t.id_jurnal = ?";
    }

    $sql .= " ORDER BY t.tanggal ASC";

    $stmt = $conn->prepare($sql);

    if ($jurnal_filter !== null && $jurnal_filter !== '') {
        $stmt->bind_param("ii", $tahun, $jurnal_filter);
    } else {
        $stmt->bind_param("i", $tahun);
    }

    $stmt->execute();
    $result = $stmt->get_result();

    $data_per_bulan = [];

    while ($row = $result->fetch_assoc()) {
        $bulan = $row['bulan'];
        if (!isset($data_per_bulan[$bulan])) {
            $data_per_bulan[$bulan] = [
                'penerimaan' => [],
                'pengeluaran' => [],
                'total_penerimaan' => 0,
                'total_pengeluaran' => 0,
                'saldo_awal' => 0,
                'saldo_akhir' => 0,
            ];
        }

        // Ambil singkatan jurnal
        $jurnal_abbr = $jurnal_abbreviations[$row['nama_jurnal']] ?? substr($row['nama_jurnal'], 0, 2);

        $item = [
            'tanggal' => date('d-m-Y', strtotime($row['tanggal'])),
            'uraian' => $row['uraian'],
            'no_bukti' => $row['no_kwitansi'],
            'jumlah' => $row['jumlah'],
            'kode' => $row['kode_kategori'] ?? '',
            'nama_jurnal' => $row['nama_jurnal'] ?? '',
            'jurnal_abbr' => $jurnal_abbr,
        ];

        // Calculate the correct amount (jumlah + setoran)
        $total_amount = $row['jumlah'] + ($row['setoran'] ?? 0);

        if (in_array($row['id_jurnal'], $jurnal_penerimaan)) {
            $data_per_bulan[$bulan]['penerimaan'][] = $item;
            $data_per_bulan[$bulan]['total_penerimaan'] += $total_amount;
        } elseif (in_array($row['id_jurnal'], $jurnal_pengeluaran)) {
            $data_per_bulan[$bulan]['pengeluaran'][] = $item;
            $data_per_bulan[$bulan]['total_pengeluaran'] += $total_amount;
        }
    }

    // Hitung saldo awal (saldo akhir tahun sebelumnya)
    $saldo_awal_tahun = 0;
    if ($tahun > 2000) { // Pastikan tahun valid
        $sql_saldo_akhir = "SELECT
            SUM(CASE WHEN j.nama_jurnal LIKE '%penerimaan%' THEN (t.jumlah + COALESCE(t.setoran, 0)) ELSE 0 END) -
            SUM(CASE WHEN j.nama_jurnal LIKE '%pengeluaran%' THEN (t.jumlah + COALESCE(t.setoran, 0)) ELSE 0 END) as saldo_akhir
            FROM transaksi t
            JOIN jurnal j ON t.id_jurnal = j.id_jurnal
            WHERE YEAR(t.tanggal) = ?";

        $stmt_saldo = $conn->prepare($sql_saldo_akhir);
        $tahun_sebelumnya = $tahun - 1;
        $stmt_saldo->bind_param("i", $tahun_sebelumnya);
        $stmt_saldo->execute();
        $result_saldo = $stmt_saldo->get_result();

        if ($result_saldo && $result_saldo->num_rows > 0) {
            $row_saldo = $result_saldo->fetch_assoc();
            $saldo_awal_tahun = $row_saldo['saldo_akhir'] ?? 0;
        }
    }

    // Hitung saldo awal dan saldo akhir per bulan
    $saldo_sebelumnya = $saldo_awal_tahun;
    ksort($data_per_bulan);
    foreach ($data_per_bulan as $bulan => &$data) {
        $data['saldo_awal'] = $saldo_sebelumnya;
        $data['saldo_akhir'] = $saldo_sebelumnya + $data['total_penerimaan'] - $data['total_pengeluaran'];
        $saldo_sebelumnya = $data['saldo_akhir'];
    }
    unset($data);

    // Simpan ke session untuk export
    $_SESSION['laporan_keuangan_data'] = $data_per_bulan;
    $_SESSION['laporan_keuangan_filters'] = [
        'tahun' => $tahun,
        'jurnal_filter' => $jurnal_filter
    ];

    return $data_per_bulan;
}



/**
 * Validasi format kode kategori
 * @param string $kode
 * @return bool
 */
function validateKategoriCode($kode) {
    return preg_match('/^[0-9]{3}$/', $kode);
}

/**
 * Validasi format kode subkategori
 * @param string $kode
 * @return bool
 */
function validateSubkategoriCode($kode) {
    // Format: xxx.xx.xx atau xxx.xx.xxx
    return preg_match('/^[0-9]{3}\.[0-9]{2}(\.[0-9]{2,3})?$/', $kode);
}

/**
 * Generate kode subkategori otomatis berdasarkan kategori
 * @param string $kode_kategori
 * @param int $level
 * @return string
 */
function generateSubkategoriCode($kode_kategori, $level = 1) {
    if (!validateKategoriCode($kode_kategori)) {
        return false;
    }
    
    switch ($level) {
        case 1:
            return $kode_kategori . '.01';
        case 2:
            return $kode_kategori . '.01.001';
        default:
            return false;
    }
}

/**
 * Parse kode subkategori untuk mendapatkan informasi level
 * @param string $kode
 * @return array
 */
function parseSubkategoriCode($kode) {
    if (!validateSubkategoriCode($kode)) {
        return false;
    }
    
    $parts = explode('.', $kode);
    return [
        'kategori' => $parts[0],
        'sub_level_1' => $parts[1],
        'sub_level_2' => isset($parts[2]) ? $parts[2] : null,
        'total_levels' => count($parts)
    ];
}

// Fungsi untuk menghasilkan laporan Sheet 1 (Data Transaksi) dengan filter tambahan
function generateSheet1Report($jurnal_filter = null, $tahun_filter = null, $uraian_filter = null, $kwitansi_filter = null) {
    global $conn;
    
    $where_conditions = [];
    $params = [];
    $types = "";
    
    if ($jurnal_filter) {
        $where_conditions[] = "t.id_jurnal = ?";
        $params[] = $jurnal_filter;
        $types .= "i";
    }
    
    if ($tahun_filter) {
        $where_conditions[] = "YEAR(t.tanggal) = ?";
        $params[] = $tahun_filter;
        $types .= "i";
    }
    
    if ($uraian_filter) {
        $where_conditions[] = "t.uraian LIKE ?";
        $params[] = "%" . $uraian_filter . "%";
        $types .= "s";
    }
    
    if ($kwitansi_filter) {
        $where_conditions[] = "t.no_kwitansi LIKE ?";
        $params[] = "%" . $kwitansi_filter . "%";
        $types .= "s";
    }
    
    $where_clause = "";
    if (!empty($where_conditions)) {
        $where_clause = "WHERE " . implode(" AND ", $where_conditions);
    }
    
    $sql = "SELECT 
                t.*,
                j.nama_jurnal,
                k.kode_kategori,
                k.nama_kategori,
                s.kode_subkategori,
                s.nama_subkategori
            FROM transaksi t
            JOIN jurnal j ON t.id_jurnal = j.id_jurnal
            LEFT JOIN subkategori s ON t.id_subkategori = s.id_subkategori
            LEFT JOIN kategori k ON s.id_kategori = k.id_kategori
            $where_clause
            ORDER BY t.tanggal DESC, t.created_at DESC";
    
    $stmt = $conn->prepare($sql);
    
    if (!empty($params)) {
        $stmt->bind_param($types, ...$params);
    }
    
    $stmt->execute();
    $result = $stmt->get_result();
    $transactions = [];
    
    if ($result->num_rows > 0) {
        while($row = $result->fetch_assoc()) {
            $transactions[] = $row;
        }
    }
    
    // Simpan ke session untuk ditampilkan
    $_SESSION['sheet1_report'] = $transactions;
    $_SESSION['sheet1_filters'] = [
        'jurnal_filter' => $jurnal_filter,
        'tahun_filter' => $tahun_filter,
        'uraian_filter' => $uraian_filter,
        'kwitansi_filter' => $kwitansi_filter
    ];
}

/**
 * Simpan data anggaran pendapatan ke database
 */
function saveAnggaranPendapatan($data) {
    global $conn;
    
    $kode_subkategori = $data['kode_subkategori'] ?? '';
    $bulan = $data['bulan'] ?? '';
    $jumlah = $data['jumlah'] ?? 0;
    $type = $data['type'] ?? 'subkategori';
    
    // Validasi
    if (empty($bulan) || !is_numeric($jumlah)) {
        return ['success' => false, 'message' => 'Data tidak valid'];
    }
    
    // Cek apakah tabel anggaran_pendapatan ada
    $table_exists = $conn->query("SHOW TABLES LIKE 'anggaran_pendapatan'")->num_rows > 0;
    
    if (!$table_exists) {
        // Buat tabel jika belum ada (dengan kolom type)
        $create_table = "CREATE TABLE anggaran_pendapatan (
            id INT PRIMARY KEY AUTO_INCREMENT,
            kode_subkategori VARCHAR(50),
            bulan VARCHAR(20) NOT NULL,
            jumlah DECIMAL(15,2) NOT NULL DEFAULT 0.00,
            type ENUM('uang-setoran', 'kelompok', 'subkategori', 'keseluruhan') NOT NULL DEFAULT 'subkategori',
            UNIQUE KEY unique_anggaran (kode_subkategori, bulan, type)
        )";
        
        if (!$conn->query($create_table)) {
            return ['success' => false, 'message' => 'Gagal membuat tabel: ' . $conn->error];
        }
    }
    
    // Cek apakah kolom 'type' sudah ada di tabel
    $column_exists = $conn->query("SHOW COLUMNS FROM anggaran_pendapatan LIKE 'type'")->num_rows > 0;
    
    if ($column_exists) {
        // Query paling sederhana - tanpa ON DUPLICATE KEY
        // Cek dulu apakah data sudah ada
        $check_sql = "SELECT id FROM anggaran_pendapatan 
                     WHERE kode_subkategori = ? AND bulan = ? AND type = ?";
        $check_stmt = $conn->prepare($check_sql);
        $check_stmt->bind_param("sss", $kode_subkategori, $bulan, $type);
        $check_stmt->execute();
        $check_result = $check_stmt->get_result();
        
        if ($check_result->num_rows > 0) {
            // Update data yang sudah ada - HANYA update jumlah
            $sql = "UPDATE anggaran_pendapatan SET jumlah = ? 
                    WHERE kode_subkategori = ? AND bulan = ? AND type = ?";
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("dsss", $jumlah, $kode_subkategori, $bulan, $type);
        } else {
            // Insert data baru
            $sql = "INSERT INTO anggaran_pendapatan (kode_subkategori, bulan, jumlah, type) 
                    VALUES (?, ?, ?, ?)";
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("ssds", $kode_subkategori, $bulan, $jumlah, $type);
        }
    } else {
        // Fallback: query tanpa kolom type
        // Cek dulu apakah data sudah ada
        $check_sql = "SELECT id FROM anggaran_pendapatan 
                     WHERE kode_subkategori = ? AND bulan = ?";
        $check_stmt = $conn->prepare($check_sql);
        $check_stmt->bind_param("ss", $kode_subkategori, $bulan);
        $check_stmt->execute();
        $check_result = $check_stmt->get_result();
        
        if ($check_result->num_rows > 0) {
            // Update data yang sudah ada
            $sql = "UPDATE anggaran_pendapatan SET jumlah = ? 
                    WHERE kode_subkategori = ? AND bulan = ?";
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("dss", $jumlah, $kode_subkategori, $bulan);
        } else {
            // Insert data baru
            $sql = "INSERT INTO anggaran_pendapatan (kode_subkategori, bulan, jumlah) 
                    VALUES (?, ?, ?)";
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("ssd", $kode_subkategori, $bulan, $jumlah);
        }
    }
    
    if ($stmt->execute()) {
        return ['success' => true, 'message' => 'Anggaran berhasil disimpan'];
    } else {
        return ['success' => false, 'message' => 'Gagal menyimpan: ' . $conn->error];
    }
}

/**
 * API endpoint untuk menyimpan anggaran
 */
function handleSaveAnggaran() {
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $input = json_decode(file_get_contents('php://input'), true);

        if (!$input) {
            echo json_encode(['success' => false, 'message' => 'Data tidak valid']);
            exit;
        }

        $result = saveAnggaranPendapatan($input);
        echo json_encode($result);
        exit;
    }
}

/**
 * Fungsi saveAnggaranPendapatan yang sangat sederhana (alternatif)
 * Gunakan ini jika fungsi utama masih error
 */
function saveAnggaranPendapatanSimple($data) {
    global $conn;
    
    $kode_subkategori = $data['kode_subkategori'] ?? '';
    $bulan = $data['bulan'] ?? '';
    $jumlah = $data['jumlah'] ?? 0;
    $type = $data['type'] ?? 'subkategori';
    
    try {
        // Coba update dulu
        $sql = "UPDATE anggaran_pendapatan SET jumlah = ? 
                WHERE kode_subkategori = ? AND bulan = ? AND type = ?";
        $stmt = $conn->prepare($sql);
        $stmt->bind_param("dsss", $jumlah, $kode_subkategori, $bulan, $type);
        
        if ($stmt->execute() && $stmt->affected_rows > 0) {
            return ['success' => true, 'message' => 'Anggaran berhasil diupdate'];
        }
        
        // Jika update tidak ada yang diubah, coba insert
        $sql = "INSERT INTO anggaran_pendapatan (kode_subkategori, bulan, jumlah, type) 
                VALUES (?, ?, ?, ?)";
        $stmt = $conn->prepare($sql);
        $stmt->bind_param("ssds", $kode_subkategori, $bulan, $jumlah, $type);
        
        if ($stmt->execute()) {
            return ['success' => true, 'message' => 'Anggaran berhasil disimpan'];
        }
        
        return ['success' => false, 'message' => 'Gagal menyimpan'];
        
    } catch (Exception $e) {
        return ['success' => false, 'message' => 'Error: ' . $e->getMessage()];
    }
}

/**
 * Fungsi untuk mendeteksi informasi browser dan device dari user agent
 * @param string $user_agent User agent string
 * @return array Informasi device yang terdeteksi
 */
function detectDeviceInfo($user_agent = null) {
    if ($user_agent === null) {
        $user_agent = $_SERVER['HTTP_USER_AGENT'] ?? '';
    }
    
    $info = [
        'browser' => 'Unknown',
        'browser_version' => '',
        'operating_system' => 'Unknown',
        'device_type' => 'Desktop',
        'device_model' => '',
        'platform' => ''
    ];
    
    // Detect Browser
    if (preg_match('/MSIE/i', $user_agent) && !preg_match('/Opera/i', $user_agent)) {
        $info['browser'] = 'Internet Explorer';
        if (preg_match('/MSIE\s([0-9\.]+)/i', $user_agent, $matches)) {
            $info['browser_version'] = $matches[1];
        }
    } elseif (preg_match('/Firefox/i', $user_agent)) {
        $info['browser'] = 'Firefox';
        if (preg_match('/Firefox\/([0-9\.]+)/i', $user_agent, $matches)) {
            $info['browser_version'] = $matches[1];
        }
    } elseif (preg_match('/Chrome/i', $user_agent)) {
        $info['browser'] = 'Chrome';
        if (preg_match('/Chrome\/([0-9\.]+)/i', $user_agent, $matches)) {
            $info['browser_version'] = $matches[1];
        }
    } elseif (preg_match('/Safari/i', $user_agent)) {
        $info['browser'] = 'Safari';
        if (preg_match('/Version\/([0-9\.]+)/i', $user_agent, $matches)) {
            $info['browser_version'] = $matches[1];
        }
    } elseif (preg_match('/Opera/i', $user_agent)) {
        $info['browser'] = 'Opera';
        if (preg_match('/Opera\/([0-9\.]+)/i', $user_agent, $matches)) {
            $info['browser_version'] = $matches[1];
        }
    } elseif (preg_match('/Edge/i', $user_agent)) {
        $info['browser'] = 'Edge';
        if (preg_match('/Edge\/([0-9\.]+)/i', $user_agent, $matches)) {
            $info['browser_version'] = $matches[1];
        }
    }
    
    // Detect Operating System
    if (preg_match('/Windows NT 10/i', $user_agent)) {
        $info['operating_system'] = 'Windows 10/11';
    } elseif (preg_match('/Windows NT 6\.3/i', $user_agent)) {
        $info['operating_system'] = 'Windows 8.1';
    } elseif (preg_match('/Windows NT 6\.2/i', $user_agent)) {
        $info['operating_system'] = 'Windows 8';
    } elseif (preg_match('/Windows NT 6\.1/i', $user_agent)) {
        $info['operating_system'] = 'Windows 7';
    } elseif (preg_match('/Windows NT 6\.0/i', $user_agent)) {
        $info['operating_system'] = 'Windows Vista';
    } elseif (preg_match('/Windows NT 5\.1/i', $user_agent)) {
        $info['operating_system'] = 'Windows XP';
    } elseif (preg_match('/Macintosh|Mac OS X/i', $user_agent)) {
        $info['operating_system'] = 'macOS';
        if (preg_match('/Mac OS X ([0-9_]+)/i', $user_agent, $matches)) {
            $info['operating_system'] = 'macOS ' . str_replace('_', '.', $matches[1]);
        }
    } elseif (preg_match('/Linux/i', $user_agent)) {
        $info['operating_system'] = 'Linux';
    } elseif (preg_match('/Android/i', $user_agent)) {
        $info['operating_system'] = 'Android';
        if (preg_match('/Android ([0-9\.]+)/i', $user_agent, $matches)) {
            $info['operating_system'] = 'Android ' . $matches[1];
        }
    } elseif (preg_match('/iPhone|iPad|iPod/i', $user_agent)) {
        $info['operating_system'] = 'iOS';
        if (preg_match('/OS ([0-9_]+)/i', $user_agent, $matches)) {
            $info['operating_system'] = 'iOS ' . str_replace('_', '.', $matches[1]);
        }
    }
    
    // Detect Device Type
    if (preg_match('/Mobile|Android|iPhone|iPad|iPod/i', $user_agent)) {
        $info['device_type'] = 'Mobile';
        if (preg_match('/iPhone/i', $user_agent)) {
            $info['device_model'] = 'iPhone';
        } elseif (preg_match('/iPad/i', $user_agent)) {
            $info['device_model'] = 'iPad';
        } elseif (preg_match('/iPod/i', $user_agent)) {
            $info['device_model'] = 'iPod';
        } elseif (preg_match('/Android/i', $user_agent)) {
            $info['device_model'] = 'Android Device';
        }
    } elseif (preg_match('/Tablet|iPad/i', $user_agent)) {
        $info['device_type'] = 'Tablet';
    }
    
    // Detect Platform
    if (preg_match('/Windows/i', $user_agent)) {
        $info['platform'] = 'Windows';
    } elseif (preg_match('/Mac/i', $user_agent)) {
        $info['platform'] = 'Mac';
    } elseif (preg_match('/Linux/i', $user_agent)) {
        $info['platform'] = 'Linux';
    } elseif (preg_match('/Android/i', $user_agent)) {
        $info['platform'] = 'Android';
    } elseif (preg_match('/iPhone|iPad|iPod/i', $user_agent)) {
        $info['platform'] = 'iOS';
    }
    
    return $info;
}

/**
 * Fungsi untuk menyimpan log login ke database
 * @param string $username Username yang login
 * @return bool True jika berhasil disimpan
 */
function saveLoginLog($username) {
    global $conn;

    $ip_address = $_SERVER['REMOTE_ADDR'] ?? 'Unknown';
    $user_agent = $_SERVER['HTTP_USER_AGENT'] ?? '';
    $fingerprint = hash('sha256', $ip_address . $user_agent);

    // Deteksi informasi device
    $device_info = detectDeviceInfo($user_agent);

    error_log("saveLoginLog called for user: $username");
    error_log("IP: $ip_address, User Agent: " . substr($user_agent, 0, 100));
    
    $sql = "INSERT INTO login_logs (
        username, waktu_login, ip_address, user_agent,
        browser, operating_system,
        device_type, device_model, fingerprint
    ) VALUES (?, NOW(), ?, ?, ?, ?, ?, ?, ?)";

    $stmt = $conn->prepare($sql);
    if ($stmt) {
        $stmt->bind_param(
            "ssssssss",
            $username, $ip_address, $user_agent,
            $device_info['browser'],
            $device_info['operating_system'], $device_info['device_type'],
            $device_info['device_model'], $fingerprint
        );

        if (!$stmt->execute()) {
            error_log("saveLoginLog failed: " . $stmt->error);
            return false;
        }
        error_log("saveLoginLog succeeded");
        return true;
    } else {
        error_log("saveLoginLog prepare failed: " . $conn->error);
    }

    return false;
}

/**
 * Fungsi untuk mendapatkan informasi sesi login terbaru
 * @param string $username Username
 * @return array|null Informasi sesi atau null jika tidak ditemukan
 */
function getLatestLoginInfo($username) {
    global $conn;
    
    $sql = "SELECT * FROM login_logs 
            WHERE username = ? 
            ORDER BY waktu_login DESC 
            LIMIT 1";
    
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("s", $username);
    $stmt->execute();
    $result = $stmt->get_result();
    
    if ($result && $result->num_rows > 0) {
        return $result->fetch_assoc();
    }
    
    return null;
}

/**
 * Fungsi untuk mendapatkan semua sesi login aktif
 * @param string $username Username
 * @return array Daftar sesi aktif
 */
function getActiveSessions($username) {
    global $conn;
    
    $sql = "SELECT * FROM login_logs 
            WHERE username = ? 
            ORDER BY waktu_login DESC";
    
    $stmt = $conn->prepare($sql);
    $stmt->bind_param("s", $username);
    $stmt->execute();
    $result = $stmt->get_result();
    
    $sessions = [];
    if ($result && $result->num_rows > 0) {
        while ($row = $result->fetch_assoc()) {
            $sessions[] = $row;
        }
    }
    
    return $sessions;
}

/**
 * Fungsi untuk menampilkan dashboard dengan info sesi login
 */
function showDashboard() {
    global $conn;
    
    // Ambil info sesi login terbaru untuk user yang sedang login
    $username = $_SESSION['username'] ?? 'Unknown';
    $current_fingerprint = hash('sha256', ($_SERVER['REMOTE_ADDR'] ?? '') . ($_SERVER['HTTP_USER_AGENT'] ?? ''));
    
    // Query untuk mendapatkan log login terbaru user ini
    $login_logs = [];
    $is_active_session = false;
    
    // Cek apakah tabel login_logs ada
    $table_check = $conn->query("SHOW TABLES LIKE 'login_logs'");
    if ($table_check && $table_check->num_rows > 0) {
        $sql = "SELECT * FROM login_logs 
                WHERE username = ? 
                ORDER BY waktu_login DESC 
                LIMIT 10";
        $stmt = $conn->prepare($sql);
        if ($stmt) {
            $stmt->bind_param("s", $username);
            $stmt->execute();
            $result = $stmt->get_result();
            
            if ($result && $result->num_rows > 0) {
                while ($row = $result->fetch_assoc()) {
                    $login_logs[] = $row;
                }
                
                // Cek apakah sesi saat ini aktif (fingerprint cocok dengan yang terbaru)
                $latest_log = $login_logs[0];
                $is_active_session = ($latest_log['fingerprint'] === $current_fingerprint);
            }
        }
    }
    
    include __DIR__ . '/views/dashboard.php';
}

/**
 * Delete selected transactions from Sheet 1 report.
 * @param array $ids Array of transaction IDs to delete.
 * @return array Result with success status and message.
 */
function deleteSheet1Transactions($ids) {
    global $conn;

    if (empty($ids) || !is_array($ids)) {
        return ['success' => false, 'message' => 'No transactions selected for deletion.'];
    }

    // Sanitize IDs to integers
    $ids = array_map('intval', $ids);

    // Prepare placeholders for the query
    $placeholders = implode(',', array_fill(0, count($ids), '?'));

    $sql = "DELETE FROM transaksi WHERE id_transaksi IN ($placeholders)";
    $stmt = $conn->prepare($sql);

    if ($stmt === false) {
        return ['success' => false, 'message' => 'Failed to prepare delete statement.'];
    }

    // Bind parameters dynamically using call_user_func_array
    $types = str_repeat('i', count($ids));
    $bind_names[] = $types;
    for ($i=0; $i<count($ids); $i++) {
        $bind_name = 'bind' . $i;
        $$bind_name = $ids[$i];
        $bind_names[] = &$$bind_name;
    }
    call_user_func_array([$stmt, 'bind_param'], $bind_names);

    if ($stmt->execute()) {
        $affected_rows = $stmt->affected_rows;
        return ['success' => true, 'message' => "$affected_rows transactions deleted successfully."];
    } else {
        return ['success' => false, 'message' => 'Failed to execute delete statement.'];
    }
}


================================================================================
===== C:/xampp/htdocs/teste\index.php =====
================================================================================

<?php
require_once 'config.php';
require_once 'functions.php';
require_once 'includes/url_helper.php';

session_start();

// Jika belum login, redirect ke halaman login
if (!isset($_SESSION['logged_in']) || $_SESSION['logged_in'] !== true) {
    header("Location: login.php");
    exit;
}

// Set judul halaman default
$page_title = "Dashboard - Sistem Keuangan Gereja";

$action = isset($_POST['action']) ? $_POST['action'] : (isset($_GET['action']) ? $_GET['action'] : 'form');

switch ($action) {
    case 'form':
        showForm();
        break;
    case 'submit':
        submitForm();
        break;
    case 'delete_sheet1_transactions':
        if ($_SERVER['REQUEST_METHOD'] === 'POST') {
            $ids = isset($_POST['selected_ids']) ? $_POST['selected_ids'] : [];
            $jurnal_filter = isset($_POST['jurnal_filter']) ? $_POST['jurnal_filter'] : '';
            $tahun_filter = isset($_POST['tahun_filter']) ? $_POST['tahun_filter'] : date('Y');
            $search = isset($_POST['search']) ? $_POST['search'] : '';

            $result = deleteSheet1Transactions($ids);

            // Set flash message
            if ($result['success']) {
                $_SESSION['success'] = $result['message'];
            } else {
                $_SESSION['errors'] = [$result['message']];
            }

            // Redirect back to sheet1_report with same filters
            $redirect_url = "index.php?action=sheet1_report";
            if ($jurnal_filter) $redirect_url .= "&jurnal_filter=" . urlencode($jurnal_filter);
            if ($tahun_filter) $redirect_url .= "&tahun_filter=" . urlencode($tahun_filter);
            if ($search) $redirect_url .= "&search=" . urlencode($search);

            header("Location: $redirect_url");
            exit;
        }
        break;

    case 'sheet1_report':
        $jurnal_filter = isset($_GET['jurnal_filter']) ? $_GET['jurnal_filter'] : null;
        $tahun_filter = isset($_GET['tahun_filter']) ? $_GET['tahun_filter'] : date('Y');
        generateSheet1Report($jurnal_filter, $tahun_filter);
        include 'views/sheet1_report.php';
        break;
    case 'sheet2_report':
        $jurnal_filter = isset($_GET['jurnal_filter']) ? $_GET['jurnal_filter'] : null;
        $tahun_filter = isset($_GET['tahun_filter']) ? $_GET['tahun_filter'] : date('Y');
        generateSheet2Report($jurnal_filter, $tahun_filter);
        include 'views/sheet2_report.php';
        break;
    case 'sheet3_report':
        $jurnal_filter = isset($_GET['jurnal_filter']) ? $_GET['jurnal_filter'] : null;
        $tahun_filter = isset($_GET['tahun_filter']) ? $_GET['tahun_filter'] : date('Y');
        $bulan_filter = isset($_GET['bulan_filter']) ? intval($_GET['bulan_filter']) : null;
        $report = generateSheet3Report($jurnal_filter, $tahun_filter, $bulan_filter);
        include 'views/sheet3_report.php';
        break;
    case 'laporan_keuangan':
        header("Location: laporankeuangan.php");
        exit;
        break;
    case 'laporan_keuangan_bulanan':
        header("Location: laporankeuangan.php?tahun=" . date('Y'));
        exit;
        break;
    case 'in_out':
        header("Location: in_out.php?tahun=2025");
        exit;
        break;
    case 'get_kategori':
        getKategoriByJurnal();
        break;
    case 'get_subkategori':
        getSubkategori();
        break;
    case 'dashboard':
        // Redirect to dashboard.php directly to show backup button
        header("Location: dashboard.php");
        exit;
        break;
    case 'login_sessions':
        // Include login sessions view
        include 'views/login_sessions.php';
        break;
    default:
        showDashboard();
}

// Include header
include 'views/header.php';

// ... existing content ...

// Include footer
include 'views/footer.php';
?>

================================================================================
===== C:/xampp/htdocs/teste\views\form.php =====
================================================================================

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024, initial-scale=1.0, user-scalable=no">
    <title>Form Transaksi Gereja</title>
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-bg: #f8f9fa;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
        }
        
        .card-form {
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: none;
        }
        
        .form-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .form-control, .form-select {
            border-radius: 6px;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .btn-submit {
            background-color: var(--secondary-color) !important;
            color: white !important;
            border: none !important;
            padding: 10px 20px !important;
            font-weight: 600 !important;
            transition: all 0.3s !important;
            display: inline-block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .btn-submit:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .nav-pills .nav-link.active {
            background-color: var(--primary-color);
        }
        
        .nav-pills .nav-link {
            color: var(--primary-color);
        }
        
        .transaction-type {
            border-left: 4px solid var(--secondary-color);
            background-color: rgba(52, 152, 219, 0.1);
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 0 6px 6px 0;
        }
        
        .amount-input {
            position: relative;
        }
        
        .amount-input span {
            position: absolute;
            left: 15px;
            top: 38px; /* Posisi yang lebih tepat */
            font-weight: 600;
            color: var(--primary-color);
            line-height: 1.5;
        }
        
        .amount-input input {
            padding-left: 40px !important;
        }
        
        .error-message {
            color: var(--accent-color);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .text-end {
            text-align: right !important;
        }
        
        /* Tambahan untuk form validation */
        .form-control:invalid {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.25rem rgba(231, 76, 60, 0.25);
        }
        
        .form-control:valid {
            border-color: #28a745;
            border-width: 2px;
            box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25);
        }
        /* Highlight untuk field setoran/uang dari bank */
        .highlight-field {
            border: 2px solid var(--secondary-color) !important;
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25) !important;
            background-color: rgba(52, 152, 219, 0.06);
        }
        .highlight-label {
            color: var(--secondary-color) !important;
        }
        
        .form-text {
            font-size: 0.875rem;
            color: #6c757d;
            line-height: 1.4;
        }
        
        .form-text i {
            color: var(--secondary-color);
        }
        
        .form-text strong {
            color: var(--primary-color);
        }
        
        .form-text .text-muted {
            color: #6c757d !important;
        }
        
        .form-text .text-success {
            color: #28a745 !important;
        }
        
        /* Styling untuk input yang sedang difokuskan */
        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        /* Styling untuk placeholder */
        .form-control::placeholder {
            color: #adb5bd;
            font-style: italic;
        }

        /* Receipt Styles */
        .receipt-container {
            width: 100%;
            max-width: 550px;
            min-height: 350px;
            background: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            font-size: 10px;
            font-family: 'Arial', sans-serif;
            margin: 0 auto;
        }

        .editable-field {
            border: 1px dashed transparent;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.2s;
            min-height: 16px;
            display: inline-block;
            cursor: text;
        }

        .editable-field:hover {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
        }

        .editable-field:focus {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
            outline: none;
        }

        .editable-field[contenteditable="true"] {
            background-color: rgba(255, 255, 0, 0.1);
        }

        .receipt {
            background: #fff;
            border: 2px solid #d63384;
            border-radius: 6px;
            padding: 12px;
            position: relative;
            min-height: 320px;
        }

        .receipt-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 2px solid #d63384;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        /* Gaya untuk header gereja di kedua template */
        #income-receipt .church-info,
        #expense-receipt .church-info {
            text-align: center;
            font-family: 'Arial', sans-serif;
            margin-bottom: 10px;
        }

        #income-receipt .church-info p:nth-child(2),
        #expense-receipt .church-info h2 {
            font-weight: bold;
            font-size: 10px;
            color: #d63384;
            margin-bottom: 2px;
            line-height: 1.2;
        }

        #income-receipt .church-info p:nth-child(3),
        #expense-receipt .church-info p {
            font-size: 8px;
            margin-bottom: 2px;
            line-height: 1.1;
        }

        .receipt-details {
            text-align: right;
        }

        .receipt-number-large {
            position: absolute;
            top: 10px;
            right: 15px;
            font-weight: bold;
            color: #d63384;
            font-size: 10pt;
            background: white;
            padding: 2px 8px;
            border: 1px solid #d63384;
            border-radius: 3px;
        }

        .bank-info-section {
            margin-top: 10px;
        }

        .bank-info {
            display: flex;
            margin-bottom: 5px;
        }

        .bank-label {
            width: 80px;
            font-weight: bold;
            font-size: 10px;
        }

        .bank-value {
            flex: 1;
            font-size: 10px;
            min-height: 12px;
            padding: 1px 2px;
            border-radius: 2px;
            cursor: text;
        }

        .bank-value.editable-field {
            border: 1px dashed transparent;
            transition: all 0.2s;
        }

        .bank-value.editable-field:hover {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
        }

        .bank-value.editable-field:focus {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
            outline: none;
        }

        .receipt-title {
            text-align: center;
            font-weight: bold;
            font-size: 12pt;
            color: #d63384;
            margin-bottom: 10px;
            margin-top: 5px;
        }

        .form-title {
            text-align: center;
            font-weight: bold;
            font-size: 12pt;
            color: #d63384;
            margin-bottom: 10px;
            margin-top: 5px;
        }

        .payment-type {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            font-size: 11px;
        }

        .payment-type div {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .box {
            width: 12px;
            height: 12px;
            border: 1px solid #333;
            display: inline-block;
        }

        .checked {
            background: #d63384;
            position: relative;
        }

        .checked:after {
            content: "‚úì";
            color: white;
            font-size: 8px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .vertical-data {
            display: flex;
            flex-direction: column;
            gap: 0.0078125px;
            margin-bottom: 2px;
        }

        .data-row {
            display: flex;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.015625px;
        }

        .data-label {
            width: 130px;
            font-weight: bold;
            color: #555;
            font-size: 11px;
        }

        .data-value {
            flex: 1;
            font-size: 11px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .amount-section {
            display: flex;
            justify-content: space-between;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            border-radius: 4px;
            overflow: hidden;
        }

        .payment-method {
            padding: 10px;
            width: 65%;
            border-right: 1px solid #ddd;
        }

        .payment-amount {
            padding: 10px;
            width: 35%;
            text-align: center;
        }

        .amount {
            font-size: 12pt;
            font-weight: bold;
            color: #d63384;
            margin-top: 5px;
        }

        .signature-section {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        .signature-table {
            width: 100%;
            border-collapse: collapse;
        }

        .signature-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: center;
            vertical-align: bottom;
        }

        .signature-label {
            font-weight: bold;
            background: #f9f9f9;
            width: 100px;
            font-size: 11px;
        }

        .signature-space {
            height: 50px;
            border-bottom: 1px dashed #999;
            margin-top: 5px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 3px;
        }

        .footer {
            margin-top: 8px;
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #777;
        }

        /* Print styles */
        @media print {
            .receipt-container {
                box-shadow: none;
                max-width: 100%;
                width: 100%;
                min-height: auto;
                font-size: 11px;
                margin: 0;
                float: none;
                page-break-inside: avoid;
            }

            .receipt {
                border: 1px solid #d63384;
                padding: 5px;
                min-height: auto;
                margin: 0;
            }

            .church-info h2 {
                font-size: 12px;
            }

            .receipt-number {
                font-size: 10px;
            }

            .amount {
                font-size: 12pt;
            }

            .signature-space {
                height: 35px;
            }

            .receipt-title {
                font-size: 12pt;
            }

            .form-title {
                font-size: 12pt;
            }
        }
    </style>
</head>
<body>
    <div class="container py-3">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card card-form">
                    <div class="card-header form-header">
                        <h4 class="mb-0"><i class="bi bi-journal-plus me-2"></i>Form Input Transaksi</h4>
                    </div>

                    <div class="card-body px-4 py-3">
                        <?php if (isset($_SESSION['success'])): ?>
                            <div class="alert alert-success alert-dismissible fade show">
                                <?php echo $_SESSION['success']; unset($_SESSION['success']); ?>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        <?php endif; ?>
                        
                        <?php if (isset($_SESSION['errors'])): ?>
                            <div class="alert alert-danger alert-dismissible fade show">
                                <h5 class="alert-heading">Terjadi Kesalahan!</h5>
                                <ul class="mb-0">
                                    <?php foreach ($_SESSION['errors'] as $error): ?>
                                        <li><?php echo $error; ?></li>
                                    <?php endforeach; ?>
                                </ul>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                <?php unset($_SESSION['errors']); ?>
                            </div>
                        <?php endif; ?>
                        
                        <ul class="nav nav-pills mb-4">
                            <li class="nav-item">
                                <a class="nav-link" href="index.php"><i class="bi bi-house-door me-1"></i> Beranda</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.php?action=sheet1_report"><i class="bi bi-table me-1"></i> Sheet 1 Report</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.php?action=sheet2_report"><i class="bi bi-list-check me-1"></i> Sheet 2 Report</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="index.php?action=sheet3_report"><i class="bi bi-graph-up me-1"></i> Sheet 3 Report</a>
                            </li>
                        </ul>
                        
                        <form action="index.php?action=submit" method="post" id="transaksiForm">
                            <div class="transaction-type">
                                <h5 class="fw-bold text-primary mb-3"><i class="bi bi-journal-text me-2"></i>Jenis Transaksi</h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="id_jurnal" class="form-label">Jurnal</label>
                                        <select id="id_jurnal" name="id_jurnal" class="form-select" required>
                                            <option value="" selected disabled>Pilih Jurnal</option>
                                            <?php foreach ($jurnal as $jur): ?>
                                                <option value="<?php echo $jur['id_jurnal']; ?>">
                                                    <?php echo $jur['nama_jurnal']; ?>
                                                </option>
                                            <?php endforeach; ?>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="tanggal" class="form-label">Tanggal Transaksi</label>
                                        <input type="date" id="tanggal" name="tanggal" class="form-control"
                                               value="<?php echo date('Y-m-d'); ?>" required>
                                    </div>
                                </div>

                                <!-- Pilihan jenis input -->
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Jenis Input:</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="jenis_input" id="input_lengkap" value="lengkap" checked>
                                        <label class="form-check-label" for="input_lengkap">
                                            Input Lengkap (dengan Kategori & Subkategori)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="jenis_input" id="input_setoran" value="setoran">
                                        <label class="form-check-label" for="input_setoran">
                                            Input Setoran/Uang dari Bank saja
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <h5 class="fw-bold text-primary mb-3"><i class="bi bi-card-text me-2"></i>Detail Transaksi</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="no_kwitansi" class="form-label">Nomor Kwitansi</label>
                                        <input type="text" id="no_kwitansi" name="no_kwitansi" class="form-control"
                                               placeholder="Masukkan nomor kwitansi" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="diterima_dari" class="form-label">Diterima Dari</label>
                                        <input type="text" id="diterima_dari" name="diterima_dari" class="form-control"
                                               placeholder="Nama penerima">
                                    </div>
                                </div>

                                <div class="row" id="kategori-row">
                                    <div class="col-md-6 mb-3">
                                        <label for="id_kategori" class="form-label">Kategori</label>
                                        <select id="id_kategori" name="id_kategori" class="form-select" required disabled>
                                            <option value="" selected disabled>Pilih jurnal terlebih dahulu</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="id_subkategori" class="form-label">Sub Kategori</label>
                                        <select id="id_subkategori" name="id_subkategori" class="form-select" required disabled>
                                            <option value="" selected disabled>Pilih kategori terlebih dahulu</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <label for="uraian" class="form-label">Uraian/Keterangan</label>
                                        <textarea id="uraian" name="uraian" class="form-control" rows="4"
                                                  placeholder="Deskripsi transaksi" required></textarea>
                                    </div>
                                </div>

                                <div class="row mb-3" id="setoran-row-container" style="display: none;">
                                    <div class="col-md-12 mb-3 amount-input" id="setoran-row">
                                        <label for="setoran" class="form-label" id="setoran-label">Setoran/Uang dari Bank</label>
                                        <span>Rp</span>
                                        <input type="number" id="setoran" name="setoran" class="form-control"
                                               min="0" step="0.01" disabled>
                                    </div>
                                </div>

                                <div class="row" id="subkategori-row">
                                    <div class="col-md-6 mb-3 amount-input" id="jumlah-row">
                                        <label for="jumlah" class="form-label">Jumlah</label>
                                        <span>Rp</span>
                                        <input type="number" id="jumlah" name="jumlah" class="form-control"
                                               min="0" step="0.01" required>
                                    </div>
                                </div>

                                <!-- Payment Method Selection -->
                                <!-- Removed to avoid duplication -->
                                <!--
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <label class="form-label fw-bold">Metode Pembayaran</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="is_giro_check" name="is_giro_check" value="1" style="cursor: pointer; z-index: 10;">
                                            <label class="form-check-label" for="is_giro_check" style="cursor: pointer;">
                                                <i class="bi bi-check-circle me-1"></i>Check/Giro No.
                                            </label>
                                            <small class="text-muted d-block">Centang jika pembayaran menggunakan cek/giro</small>
                                        </div>
                                    </div>
                                </div>
                                -->
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button type="reset" class="btn btn-outline-secondary me-md-2">
                                    <i class="bi bi-arrow-counterclockwise me-1"></i> Reset
                                </button>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-save me-1"></i> Simpan Transaksi
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <!-- Receipt Section -->
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-receipt me-2"></i>Preview Bukti <span id="receipt-type-title">Penerimaan</span></h5>
                    </div>
                    <div class="card-body p-0">
                        <!-- Income Receipt Template -->
                        <div class="receipt-container" id="income-receipt" style="display: block;">
                            <div class="receipt">
                                <div class="receipt-title"></div>

                <div class="receipt-header">
                    <div class="church-info">
                        <p>BUKTI PENERIMAAN KAS</p>
                        <p>GEREJA KRISTEN PROTESTAN INDONESIA (GKPI)</p>
                        <p>Jemaat Medan Kota</p>
                    </div>
                    <div class="receipt-details">
                        <div class="receipt-number-large" id="receipt-number">No.KW: -</div>
                    </div>
                </div>

                                <div class="vertical-data">
                                    <div class="data-row">
                                        <div class="data-label">Diterima dari</div>
                                        <div class="data-value" id="received-from">-</div>
                                    </div>
                                    <div class="data-row">
                                        <div class="data-label">Jumlah Uang</div>
                                        <div class="data-value" id="amount-text">Rp 0,-</div>
                                    </div>
                                    <div class="data-row">
                                        <div class="data-label">Untuk</div>
                                        <div class="data-value" id="purpose">KAS JEMAAT GKPI MEDAN KOTA</div>
                                    </div>
                                    <div class="data-row">
                                        <div class="data-label">No.Subkategori</div>
                                        <div class="data-value" id="subcategory-code">-</div>
                                    </div>
                                    <div class="data-row">
                                        <div class="data-label">Uraian</div>
                                        <div class="data-value" id="description-text">-</div>
                                    </div>
                                </div>

                                <div class="amount-section">
                                    <div class="payment-method">
                                        <strong>Bentuk Penerimaan</strong>
                                        <div class="payment-type" style="margin-top: 5px;">
                                            <div>
                                                <input type="checkbox" id="kas-checkbox" class="payment-checkbox">
                                                <label for="kas-checkbox" class="payment-label">Kas</label>
                                            </div>
                                            <div>
                                                <input type="checkbox" id="giro-checkbox" class="payment-checkbox">
                                                <label for="giro-checkbox" class="payment-label">Check/Giro No.:</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="payment-amount">
                                        <strong>Jumlah</strong>
                                        <div class="amount" id="total-amount">Rp 0,-</div>
                                    </div>
                                </div>

                                <div class="signature-section">
                                    <table class="signature-table">
                                        <tr>
                                            <td class="signature-label">Diperiksa Oleh</td>
                                            <td class="signature-label">Disetujui Oleh</td>
                                            <td class="signature-label">Dibukukan Oleh</td>
                                            <td class="signature-label">Tanggal Penerimaan</td>
                                            <td class="signature-label">Tanda Tangan Kasir</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="signature-space"></div>
                                                <div>(Bendahara)</div>
                                            </td>
                                            <td>
                                                <div class="signature-space"></div>
                                                <div>(Guru Jemaat)</div>
                                            </td>
                                            <td>
                                                <div class="signature-space"></div>
                                                <div>(Sekretaris)</div>
                                            </td>
                                            <td>
                                                <div class="signature-space" id="receipt-date">-</div>
                                                <div>(Tanggal)</div>
                                            </td>
                                            <td>
                                                <div class="signature-space"></div>
                                                <div>(Kasir)</div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <div class="footer">
                                    <div id="print-date">Dicetak pada: -</div>
                                    <div>GKPI Medan Kota - Sistem Informasi Keuangan</div>
                                </div>
                            </div>
                        </div>

                        <!-- Expense Receipt Template -->
                        <div class="receipt-container" id="expense-receipt" style="display: none;">
                            <div class="receipt">
                                <div class="receipt-number-large" id="expense-receipt-number">No : -</div>
                                <div class="form-title">BUKTI PENGELUARAN KAS</div>

                                <div class="receipt-header">
                                    <div class="bank-info-section">
                                        <div class="bank-info">
                                            <div class="bank-label">Bank</div>
                                            <div class="bank-value" id="bank-value">:</div>
                                        </div>
                                        <div class="bank-info">
                                            <div class="bank-label">Tanggal</div>
                                            <div class="bank-value" id="expense-date">: -</div>
                                        </div>
                                    </div>
                                    <div class="church-info">
                                        <h2>GEREJA KRISTEN PROTESTAN INDONESIA (GKPI)</h2>
                                        <p>Jemaat GKPI Medan Kota</p>
                                    </div>
                                </div>

                                <div class="vertical-data">
                                    <div class="data-row">
                                        <div class="data-label">Diterima dari</div>
                                        <div class="data-value" id="expense-received-from">-</div>
                                    </div>
                                    <div class="data-row">
                                        <div class="data-label">Penerima</div>
                                        <div class="data-value" id="expense-receiver">-</div>
                                    </div>
                                    <div class="data-row">
                                        <div class="data-label">Alamat Penerima</div>
                                        <div class="data-value" id="expense-address">-</div>
                                    </div>
                                    <div class="data-row">
                                        <div class="data-label">No. Subkategori</div>
                                        <div class="data-value" id="expense-subcategory-code">-</div>
                                    </div>
                                    <div class="data-row">
                                        <div class="data-label">Uraian</div>
                                        <div class="data-value" id="expense-description-text">-</div>
                                    </div>
                                </div>

                                <div class="amount-section">
                                    <div class="payment-method">
                                        <strong>Bentuk Pembayaran</strong>
                                        <div class="payment-type" style="margin-top: 5px;">
                                            <div>
                                                <input type="checkbox" id="expense-kas-checkbox" class="payment-checkbox">
                                                <label for="expense-kas-checkbox" class="payment-label">Kas</label>
                                            </div>
                                            <div>
                                                <input type="checkbox" id="expense-giro-checkbox" class="payment-checkbox">
                                                <label for="expense-giro-checkbox" class="payment-label">Check/Giro No.:</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="payment-amount">
                                        <strong>Jumlah</strong>
                                        <div class="amount" id="expense-total-amount">Rp 0,-</div>
                                    </div>
                                </div>

                                <div class="signature-section">
                                    <table class="signature-table">
                                        <tr>
                                            <td class="signature-label">Diperiksa Oleh</td>
                                            <td class="signature-label">Disetujui Oleh</td>
                                            <td class="signature-label">Dibukukan</td>
                                            <td class="signature-label">Telah Menerima Jumlah Tsb Diatas</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="signature-space">Diperiksa Oleh</div>
                                            </td>
                                            <td>
                                                <div class="signature-space">Bendahara</div>
                                                <div class="signature-space" style="margin-top: 5px;">Guru Jemaat</div>
                                            </td>
                                            <td>
                                                <div class="signature-space">Paraf</div>
                                                <div class="signature-space" style="margin-top: 5px;" id="expense-booked-date">-</div>
                                            </td>
                                            <td>
                                                <div class="signature-space">Tanda Tangan</div>
                                                <div class="signature-space" style="margin-top: 5px;">Tanggal</div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <div class="footer">
                                    <div id="expense-print-date">Dicetak pada: -</div>
                                    <div>GKPI Medan Kota - Sistem Informasi Keuangan</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer text-center">
                        <button onclick="printReceipt()" class="btn btn-success btn-lg">
                            <i class="bi bi-printer me-2"></i>Cetak Kuitansi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentJurnalId = null;
        let isExpenseJournal = false;

        // Function to detect if journal is expense journal
        function detectExpenseJournal(jurnalName) {
            const expenseKeywords = ['pengeluaran', 'biaya', 'beban', 'expense', 'pengeluaran', 'kas keluar', 'penggunaan'];
            const lowerName = jurnalName.toLowerCase();
            return expenseKeywords.some(keyword => lowerName.includes(keyword));
        }

        // Function to load receipt templates
        function loadReceiptTemplate(isExpenseJournal) {
            const incomeReceipt = document.getElementById('income-receipt');
            const expenseReceipt = document.getElementById('expense-receipt');
            const receiptTypeTitle = document.getElementById('receipt-type-title');

            if (isExpenseJournal) {
                incomeReceipt.style.display = 'none';
                expenseReceipt.style.display = 'block';
                receiptTypeTitle.textContent = 'Pengeluaran';
            } else {
                incomeReceipt.style.display = 'block';
                expenseReceipt.style.display = 'none';
                receiptTypeTitle.textContent = 'Penerimaan';
            }
        }

        // Show/hide fields based on jenis input
        function updateFields() {
            const jenisInput = document.querySelector('input[name="jenis_input"]:checked').value;
            const kategoriSelect = document.getElementById('id_kategori');
            const subkategoriSelect = document.getElementById('id_subkategori');
            const jumlahInput = document.getElementById('jumlah');
            const setoranInput = document.getElementById('setoran');
            const setoranLabel = document.getElementById('setoran-label');
            const noKwitansiInput = document.getElementById('no_kwitansi');
            const tanggalInput = document.getElementById('tanggal');
            const uraianInput = document.getElementById('uraian');
            const uraianLabel = document.querySelector('label[for="uraian"]');
            const kategoriRow = document.getElementById('kategori-row');
            const subkategoriRow = document.getElementById('subkategori-row');
            const jumlahRow = document.getElementById('jumlah-row');
            const setoranRow = document.getElementById('setoran-row');
            const setoranRowContainer = document.getElementById('setoran-row-container');

            if (jenisInput === 'setoran') {
                // Hide kategori row
                if (kategoriRow) kategoriRow.style.display = 'none';
                // Hide subkategori-row and show setoran row container
                if (subkategoriRow) subkategoriRow.style.display = 'none';
                if (jumlahRow) jumlahRow.style.display = 'none';
                if (setoranRowContainer) setoranRowContainer.style.display = 'block';
                if (setoranRow) setoranRow.style.display = 'block';

                // Disable kategori, subkategori, jumlah inputs
                kategoriSelect.disabled = true;
                kategoriSelect.value = '';
                subkategoriSelect.disabled = true;
                subkategoriSelect.value = '';
                jumlahInput.disabled = true;
                jumlahInput.value = '0';

                // Enable setoran and required fields
                setoranInput.disabled = false;
                setoranLabel.textContent = isExpenseJournal ? 'Setoran' : 'Uang dari Bank';

                // Ensure required fields are enabled and required
                noKwitansiInput.disabled = false;
                noKwitansiInput.required = true;
                tanggalInput.disabled = false;
                tanggalInput.required = true;
                uraianInput.disabled = false;
                uraianInput.required = true;
                setoranInput.required = true;

                // Update uraian label based on jurnal
                if (currentJurnalId) {
                    const selectedJurnal = document.querySelector(`#id_jurnal option[value="${currentJurnalId}"]`);
                    if (selectedJurnal) {
                        const jurnalName = selectedJurnal.textContent.toLowerCase();
                        if (jurnalName.includes('bank')) {
                            uraianLabel.textContent = 'Uraian Setoran';
                        } else {
                            uraianLabel.textContent = 'Uraian';
                        }
                    }
                } else {
                    uraianLabel.textContent = 'Uraian';
                }
            } else {
                // Show kategori, subkategori, jumlah rows
                if (kategoriRow) kategoriRow.style.display = 'block';
                if (subkategoriRow) subkategoriRow.style.display = 'block';
                if (jumlahRow) jumlahRow.style.display = 'block';

                // Hide setoran row container
                if (setoranRowContainer) setoranRowContainer.style.display = 'none';
                if (setoranRow) setoranRow.style.display = 'none';

                // Enable all fields for lengkap mode
                kategoriSelect.disabled = false;
                kategoriSelect.required = true;
                subkategoriSelect.disabled = false;
                subkategoriSelect.required = true;
                jumlahInput.disabled = false;
                jumlahInput.required = true;
                setoranInput.disabled = true;
                setoranInput.value = '0';
                setoranInput.required = false;
                setoranLabel.textContent = isExpenseJournal ? 'Setoran (Opsional)' : 'Uang dari Bank (Opsional)';

                // Ensure all fields are enabled and required
                noKwitansiInput.disabled = false;
                noKwitansiInput.required = true;
                tanggalInput.disabled = false;
                tanggalInput.required = true;
                uraianInput.disabled = false;
                uraianInput.required = true;
                uraianLabel.textContent = 'Uraian/Keterangan';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Attach event listeners to jenis input radios
            const jenisInputRadios = document.getElementsByName('jenis_input');
            const setoranInput = document.getElementById('setoran');
            const setoranLabel = document.getElementById('setoran-label');
            const jumlahInput = document.getElementById('jumlah');
            const jumlahLabel = document.querySelector("label[for='jumlah']");
            jenisInputRadios.forEach(radio => {
                radio.addEventListener('change', updateFields);
                // Tambah highlight saat user ubah jenis input
                radio.addEventListener('change', function() {
                    // Bersihkan highlight
                    [setoranInput, jumlahInput].forEach(el => el && el.classList.remove('highlight-field'));
                    [setoranLabel, jumlahLabel].forEach(el => el && el.classList.remove('highlight-label'));

                    if (this.value === 'setoran') {
                        if (setoranInput) setoranInput.classList.add('highlight-field');
                        if (setoranLabel) setoranLabel.classList.add('highlight-label');
                    }
                });
            });

            // Initial call to set default state
            updateFields();
        });

        // Fungsi untuk memuat kategori berdasarkan jurnal
        document.getElementById('id_jurnal').addEventListener('change', function() {
            const jurnalId = this.value;
            currentJurnalId = jurnalId;
            const kategoriSelect = document.getElementById('id_kategori');
            const jenisInputRadios = document.getElementsByName('jenis_input');
            const setoranInput = document.getElementById('setoran');
            const setoranLabel = document.getElementById('setoran-label');
            const jumlahInput = document.getElementById('jumlah');
            const jumlahLabel = document.querySelector("label[for='jumlah']");
            const subkategoriSelect = document.getElementById('id_subkategori');

            // Detect if this is an expense journal
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption && selectedOption.textContent) {
                isExpenseJournal = detectExpenseJournal(selectedOption.textContent);
            } else {
                isExpenseJournal = false;
            }

            // Switch receipt template based on journal type
            loadReceiptTemplate(isExpenseJournal);

        // Reset jenis input to default (lengkap) on jurnal change
        const jurnalName = selectedOption.textContent.toLowerCase();
        console.log('Selected journal name:', jurnalName); // Debug log

        // More flexible matching for journal names
        // Lock to setoran-only mode for Saluran, Pembangunan, and Bank Mandiri (saldo bank)
        const shouldLock = (
            jurnalName.includes('saluran') ||
            jurnalName.includes('pembangunan') ||
            jurnalName.includes('mandiri') ||
            jurnalName.includes('saldo bank') ||
            jurnalName.includes('bank mandiri') ||
            jurnalName.includes('channel') ||
            jurnalName.includes('construction') ||
            jurnalName.includes('development')
        );

        console.log('Should lock jenis input:', shouldLock); // Debug log

        if (shouldLock) {
            // Set jenis input to 'setoran' and disable radios (lock)
            jenisInputRadios.forEach(radio => {
                if (radio.value === 'setoran') {
                    radio.checked = true;
                }
                radio.disabled = true;
            });
            console.log('Locked to setoran mode'); // Debug log
        } else {
            // Enable radios and set default to 'lengkap'
            jenisInputRadios.forEach(radio => {
                radio.disabled = false;
                radio.checked = radio.value === 'lengkap';
            });
            console.log('Enabled lengkap mode'); // Debug log
        }

        // Update label untuk setoran/uang dari bank sesuai tipe jurnal
        if (setoranLabel) {
            setoranLabel.textContent = isExpenseJournal ? 'Setoran' : 'Uang dari Bank';
        }

        // Update fields after resetting radio buttons
        updateFields();

        // Highlight otomatis sesuai tipe jurnal
        const isIncomeJournal = !isExpenseJournal;
        // Bersihkan highlight
        [setoranInput, jumlahInput].forEach(el => el && el.classList.remove('highlight-field'));
        [setoranLabel, jumlahLabel].forEach(el => el && el.classList.remove('highlight-label'));

        if (isIncomeJournal) {
            // Penerimaan ‚Üí tekankan Uang dari Bank (setoran field)
            if (setoranInput) setoranInput.classList.add('highlight-field');
            if (setoranLabel) setoranLabel.classList.add('highlight-label');
        } else {
            // Pengeluaran ‚Üí tetap tekankan Setoran
            if (setoranInput) setoranInput.classList.add('highlight-field');
            if (setoranLabel) setoranLabel.classList.add('highlight-label');
        }

            if (jurnalId) {
                fetch(`index.php?action=get_kategori&id_jurnal=${jurnalId}`)
                    .then(response => response.json())
                    .then(data => {
                        kategoriSelect.innerHTML = '';

                        if (data.length > 0) {
                            kategoriSelect.disabled = false;
                            const defaultOption = document.createElement('option');
                            defaultOption.value = '';
                            defaultOption.textContent = 'Pilih Kategori';
                            defaultOption.selected = true;
                            defaultOption.disabled = true;
                            kategoriSelect.appendChild(defaultOption);

                            data.forEach(kat => {
                                const option = document.createElement('option');
                                option.value = kat.id_kategori;
                                option.textContent = `${kat.kode_kategori} - ${kat.nama_kategori}`;
                                kategoriSelect.appendChild(option);
                            });

                            // Automatically trigger change event on kategori to load subkategori
                            if (kategoriSelect.options.length > 1) {
                                kategoriSelect.selectedIndex = 1;
                                const event = new Event('change');
                                kategoriSelect.dispatchEvent(event);
                            }
                        } else {
                            kategoriSelect.disabled = true;
                            const option = document.createElement('option');
                            option.textContent = 'Tidak ada kategori tersedia';
                            option.disabled = true;
                            kategoriSelect.appendChild(option);
                        }

                        // Reset subkategori
                        subkategoriSelect.innerHTML = '';
                        subkategoriSelect.disabled = true;
                        const subOption = document.createElement('option');
                        subOption.textContent = 'Pilih kategori terlebih dahulu';
                        subOption.disabled = true;
                        subOption.selected = true;
                        subkategoriSelect.appendChild(subOption);
                    });
            } else {
                kategoriSelect.innerHTML = '';
                kategoriSelect.disabled = true;
                const option = document.createElement('option');
                option.textContent = 'Pilih jurnal terlebih dahulu';
                option.disabled = true;
                option.selected = true;
                kategoriSelect.appendChild(option);

                // Reset subkategori
                subkategoriSelect.innerHTML = '';
                subkategoriSelect.disabled = true;
                const subOption = document.createElement('option');
                subOption.textContent = 'Pilih kategori terlebih dahulu';
                subOption.disabled = true;
                subOption.selected = true;
                subkategoriSelect.appendChild(subOption);
            }
        });
        
        // Fungsi untuk memuat subkategori berdasarkan kategori
        document.getElementById('id_kategori').addEventListener('change', function() {
            const kategoriId = this.value;
            const subkategoriSelect = document.getElementById('id_subkategori');
            
            if (kategoriId) {
                const url = `index.php?action=get_subkategori&id_kategori=${kategoriId}`;
                
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        
                        subkategoriSelect.innerHTML = '';
                        
                        if (data.length > 0) {
                            subkategoriSelect.disabled = false;
                            const defaultOption = document.createElement('option');
                            defaultOption.value = '';
                            defaultOption.textContent = 'Pilih Subkategori';
                            defaultOption.selected = true;
                            defaultOption.disabled = true;
                            subkategoriSelect.appendChild(defaultOption);
                            
                            data.forEach(sub => {
                                const option = document.createElement('option');
                                option.value = sub.id_subkategori;

                                // Handle both simple and complex code formats
                                const displayCode = formatSubkategoriCode(sub.kode_subkategori);
                                option.textContent = `${displayCode} - ${sub.nama_subkategori}`;
                                subkategoriSelect.appendChild(option);
                            });

                            // Automatically select first subkategori and trigger change event after a short delay
                            if (subkategoriSelect.options.length > 1) {
                                setTimeout(() => {
                                    subkategoriSelect.selectedIndex = 1;
                                    const event = new Event('change');
                                    subkategoriSelect.dispatchEvent(event);
                                }, 300);
                            }
                        } else {
                            subkategoriSelect.disabled = true;
                            const option = document.createElement('option');
                            option.textContent = 'Tidak ada subkategori tersedia';
                            option.disabled = true;
                            subkategoriSelect.appendChild(option);
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Error fetching subkategori:', error); // Debug log
                        // Tampilkan error ke user
                        subkategoriSelect.innerHTML = '';
                        subkategoriSelect.disabled = true;
                        const option = document.createElement('option');
                        option.textContent = 'Error: ' + error.message;
                        option.disabled = true;
                        subkategoriSelect.appendChild(option);
                    });
            } else {
                subkategoriSelect.innerHTML = '';
                subkategoriSelect.disabled = true;
                const option = document.createElement('option');
                option.textContent = 'Pilih kategori terlebih dahulu';
                option.disabled = true;
                option.selected = true;
                subkategoriSelect.appendChild(option);
            }
        });
        
        // Auto-fill uraian berdasarkan subkategori yang dipilih
        document.getElementById('id_subkategori').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption.textContent.includes('-')) {
                const uraian = selectedOption.textContent.split('-')[1].trim();
                document.getElementById('uraian').value = uraian;
            }
        });
        
        // Format input jumlah saat kehilangan fokus
        const jumlahInput = document.getElementById('jumlah');
        jumlahInput.addEventListener('blur', function() {
            if (this.value !== '' && this.value !== '0') {
                let num = parseFloat(this.value);
                this.value = num % 1 === 0 ? num.toString() : num.toFixed(2);
            }
        });
        jumlahInput.addEventListener('focus', function() {
            if (this.value === '0.00' || this.value === '0') {
                this.value = '';
            }
        });

        // Format input setoran saat kehilangan fokus
        const setoranInput = document.getElementById('setoran');
        setoranInput.addEventListener('blur', function() {
            let num = parseFloat(this.value || 0);
            this.value = num % 1 === 0 ? num.toString() : num.toFixed(2);
        });
        setoranInput.addEventListener('focus', function() {
            if (this.value === '0.00' || this.value === '0') {
                this.value = '';
            }
        });

        // Fungsi untuk memformat kode subkategori agar mudah dibaca
        function formatSubkategoriCode(code) {
            if (!code) return '';
            
            // Jika kode sudah dalam format yang benar, kembalikan as is
            if (code.includes('.')) {
                return code;
            }
            
            // Jika kode adalah angka 3 digit, tambahkan .00
            if (/^[0-9]{3}$/.test(code)) {
                return code + '.00';
            }
            
            return code;
        }

        // Fungsi untuk validasi format kode subkategori
        function validateSubkategoriCode(code) {
            // Format: xxx.xx.xx atau xxx.xx.xxx
            const pattern = /^[0-9]{3}\.[0-9]{2}(\.[0-9]{2,3})?$/;
            return pattern.test(code);
        }

        // Event listener untuk validasi real-time pada input kode subkategori
        document.addEventListener('DOMContentLoaded', function() {
            const subkategoriInput = document.getElementById('kode_subkategori');
            if (subkategoriInput) {
                subkategoriInput.addEventListener('input', function() {
                    const code = this.value;
                    if (code && !validateSubkategoriCode(code)) {
                        this.setCustomValidity('Format tidak valid. Gunakan: xxx.xx.xx atau xxx.xx.xxx');
                        this.classList.add('is-invalid');
                    } else {
                        this.setCustomValidity('');
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    }
                });
            }
        });

        document.getElementById('transaksiForm').addEventListener('submit', function() {
            const kat = document.getElementById('id_kategori');
            const sub = document.getElementById('id_subkategori');
            const jenisInput = document.querySelector('input[name="jenis_input"]:checked').value;
            const setoranInput = document.getElementById('setoran');
            const jumlahInput = document.getElementById('jumlah');

            // Enable disabled fields for form submission
            if (kat && kat.disabled && kat.value) kat.disabled = false;
            if (sub && sub.disabled && sub.value) sub.disabled = false;

            // Handle validation based on jenis input
            if (jenisInput === 'setoran') {
                // For setoran mode, setoran is required, kategori/subkategori are optional
                setoranInput.required = true;
                setoranInput.disabled = false;
                if (kat) kat.required = false;
                if (sub) sub.required = false;
                if (jumlahInput) jumlahInput.required = false;
            } else {
                // For lengkap mode, kategori/subkategori are required, setoran is optional
                setoranInput.required = false;
                setoranInput.disabled = true;
                if (kat) kat.required = true;
                if (sub) sub.required = true;
                if (jumlahInput) jumlahInput.required = true;
            }
        });

        // Function to update payment method checkboxes with real-time sync
        function updatePaymentMethod(jenisInput) {
            if (isExpenseJournal) {
                // Update expense receipt checkboxes
                const expenseKasCheckbox = document.getElementById('expense-kas-checkbox');
                const expenseGiroCheckbox = document.getElementById('expense-giro-checkbox');

                if (expenseKasCheckbox && expenseGiroCheckbox) {
                    // Default behavior - kas is checked by default if no specific selection
                    if (!expenseKasCheckbox.checked && !expenseGiroCheckbox.checked) {
                        expenseKasCheckbox.checked = true;
                        expenseGiroCheckbox.checked = false;
                    }
                }
            } else {
                // Update income receipt checkboxes
                const kasCheckbox = document.getElementById('kas-checkbox');
                const giroCheckbox = document.getElementById('giro-checkbox');

                if (kasCheckbox && giroCheckbox) {
                    // Default behavior - kas is checked by default if no specific selection
                    if (!kasCheckbox.checked && !giroCheckbox.checked) {
                        kasCheckbox.checked = true;
                        giroCheckbox.checked = false;
                    }
                }
            }
        }

        // Function to sync checkbox states between income and expense receipts
        function syncCheckboxStates() {
            if (isExpenseJournal) {
                // Sync from income to expense when switching to expense journal
                const kasCheckbox = document.getElementById('kas-checkbox');
                const giroCheckbox = document.getElementById('giro-checkbox');
                const expenseKasCheckbox = document.getElementById('expense-kas-checkbox');
                const expenseGiroCheckbox = document.getElementById('expense-giro-checkbox');

                if (kasCheckbox && giroCheckbox && expenseKasCheckbox && expenseGiroCheckbox) {
                    expenseKasCheckbox.checked = kasCheckbox.checked;
                    expenseGiroCheckbox.checked = giroCheckbox.checked;
                }
            } else {
                // Sync from expense to income when switching to income journal
                const kasCheckbox = document.getElementById('kas-checkbox');
                const giroCheckbox = document.getElementById('giro-checkbox');
                const expenseKasCheckbox = document.getElementById('expense-kas-checkbox');
                const expenseGiroCheckbox = document.getElementById('expense-giro-checkbox');

                if (kasCheckbox && giroCheckbox && expenseKasCheckbox && expenseGiroCheckbox) {
                    kasCheckbox.checked = expenseKasCheckbox.checked;
                    giroCheckbox.checked = expenseGiroCheckbox.checked;
                }
            }
        }

        // Receipt update functions
        function updateReceipt() {
            if (isExpenseJournal) {
                updateExpenseReceipt();
            } else {
                updateIncomeReceipt();
            }
        }

        function updateIncomeReceipt() {
            // Update receipt number
            const noKwitansi = document.getElementById('no_kwitansi').value;
            document.getElementById('receipt-number').textContent = noKwitansi ? `No.KW: ${noKwitansi}` : 'No.KW: -';

            // Update description
            const uraian = document.getElementById('uraian').value;
            document.getElementById('description-text').textContent = uraian || '-';

            // Update received from
            const diterimaDari = document.getElementById('diterima_dari').value;
            document.getElementById('received-from').textContent = diterimaDari || '-';

            // Update date
            const tanggal = document.getElementById('tanggal').value;
            if (tanggal) {
                const dateObj = new Date(tanggal);
                const formattedDate = dateObj.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                document.getElementById('receipt-date').textContent = formattedDate;
            } else {
                document.getElementById('receipt-date').textContent = '-';
            }

            // Update amount
            const jenisInput = document.querySelector('input[name="jenis_input"]:checked').value;
            let amount = 0;
            if (jenisInput === 'setoran') {
                amount = parseFloat(document.getElementById('setoran').value) || 0;
            } else {
                amount = parseFloat(document.getElementById('jumlah').value) || 0;
            }

            const formattedAmount = new Intl.NumberFormat('id-ID').format(amount);
            document.getElementById('amount-text').textContent = `Rp ${formattedAmount},-`;
            document.getElementById('total-amount').textContent = `Rp ${formattedAmount},-`;

            // Update payment method
            updatePaymentMethod(jenisInput);

            // Update subcategory code
            const subkategoriSelect = document.getElementById('id_subkategori');
            const selectedOption = subkategoriSelect.options[subkategoriSelect.selectedIndex];
            if (selectedOption && selectedOption.value && selectedOption.textContent.includes('-')) {
                const code = selectedOption.textContent.split(' - ')[0];
                document.getElementById('subcategory-code').textContent = code;
            } else {
                document.getElementById('subcategory-code').textContent = '-';
            }

            // Update print date
            const now = new Date();
            const printDate = now.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('print-date').textContent = `Dicetak pada: ${printDate}`;
        }

        function updateExpenseReceipt() {
            // Update receipt number
            const noKwitansi = document.getElementById('no_kwitansi').value;
            document.getElementById('expense-receipt-number').textContent = noKwitansi ? `No : ${noKwitansi}` : 'No : -';

            // Update received from (for expense, this is the recipient)
            const diterimaDari = document.getElementById('diterima_dari').value;
            document.getElementById('expense-received-from').textContent = diterimaDari || '-';

            // Update receiver (same as received from for expense)
            document.getElementById('expense-receiver').textContent = diterimaDari || '-';

            // Update address (placeholder for now)
            document.getElementById('expense-address').textContent = '-';

            // Update description
            const uraian = document.getElementById('uraian').value;
            document.getElementById('expense-description-text').textContent = uraian || '-';

            // Update date
            const tanggal = document.getElementById('tanggal').value;
            if (tanggal) {
                const dateObj = new Date(tanggal);
                const formattedDate = dateObj.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });
                document.getElementById('expense-date').textContent = `: ${formattedDate}`;
                document.getElementById('expense-booked-date').textContent = formattedDate;
            } else {
                document.getElementById('expense-date').textContent = ': -';
                document.getElementById('expense-booked-date').textContent = '-';
            }

            // Update amount
            const jenisInput = document.querySelector('input[name="jenis_input"]:checked').value;
            let amount = 0;
            if (jenisInput === 'setoran') {
                amount = parseFloat(document.getElementById('setoran').value) || 0;
            } else {
                amount = parseFloat(document.getElementById('jumlah').value) || 0;
            }

            const formattedAmount = new Intl.NumberFormat('id-ID').format(amount);
            document.getElementById('expense-total-amount').textContent = `Rp ${formattedAmount},-`;

            // Update subcategory code
            const subkategoriSelect = document.getElementById('id_subkategori');
            const selectedOption = subkategoriSelect.options[subkategoriSelect.selectedIndex];
            if (selectedOption && selectedOption.value && selectedOption.textContent.includes('-')) {
                const code = selectedOption.textContent.split(' - ')[0];
                document.getElementById('expense-subcategory-code').textContent = code;
            } else {
                document.getElementById('expense-subcategory-code').textContent = '-';
            }

            // Update print date
            const now = new Date();
            const printDate = now.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('expense-print-date').textContent = `Dicetak pada: ${printDate}`;
        }





        function printReceipt() {
            // Select the currently visible receipt template
            let receiptElement;
            let receiptTitle;

            if (isExpenseJournal) {
                receiptElement = document.getElementById('expense-receipt').querySelector('.receipt');
                receiptTitle = 'Bukti Pengeluaran';
            } else {
                receiptElement = document.getElementById('income-receipt').querySelector('.receipt');
                receiptTitle = 'Bukti Penerimaan';
            }

            // Clone the receipt element to modify it for printing
            const receiptClone = receiptElement.cloneNode(true);

            // Fix checkbox states for printing
            const checkboxes = receiptClone.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                const checkboxId = checkbox.id;
                const originalCheckbox = document.getElementById(checkboxId);

                if (originalCheckbox && originalCheckbox.checked) {
                    // Create a visual representation of checked checkbox
                    const checkboxContainer = document.createElement('div');
                    checkboxContainer.style.display = 'inline-block';
                    checkboxContainer.style.width = '12px';
                    checkboxContainer.style.height = '12px';
                    checkboxContainer.style.border = '1px solid #333';
                    checkboxContainer.style.background = '#d63384';
                    checkboxContainer.style.position = 'relative';
                    checkboxContainer.style.marginRight = '5px';

                    // Add checkmark
                    const checkmark = document.createElement('span');
                    checkmark.textContent = '‚úì';
                    checkmark.style.color = 'white';
                    checkmark.style.fontSize = '8px';
                    checkmark.style.position = 'absolute';
                    checkmark.style.top = '50%';
                    checkmark.style.left = '50%';
                    checkmark.style.transform = 'translate(-50%, -50%)';

                    checkboxContainer.appendChild(checkmark);

                    // Replace the checkbox with visual representation
                    checkbox.parentNode.replaceChild(checkboxContainer, checkbox);
                } else {
                    // Create a visual representation of unchecked checkbox
                    const checkboxContainer = document.createElement('div');
                    checkboxContainer.style.display = 'inline-block';
                    checkboxContainer.style.width = '12px';
                    checkboxContainer.style.height = '12px';
                    checkboxContainer.style.border = '1px solid #333';
                    checkboxContainer.style.background = 'white';
                    checkboxContainer.style.marginRight = '5px';

                    // Replace the checkbox with visual representation
                    checkbox.parentNode.replaceChild(checkboxContainer, checkbox);
                }
            });

            const printWindow = window.open('', '_blank');
            const styles = `
                <style>
                    body { font-family: Arial, sans-serif; margin: 0; padding: 10px; }
                    .receipt { border: 1px solid #d63384; padding: 10px; max-width: 500px; margin: 0 auto; }
                    .receipt-title { text-align: center; font-weight: bold; font-size: 14px; color: #d63384; margin-bottom: 8px; }
                    .receipt-header { display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 1px solid #d63384; padding-bottom: 8px; margin-bottom: 10px; }
                    .church-info h2 { font-size: 11px; color: #d63384; margin-bottom: 2px; }
                    .receipt-number-large { font-weight: bold; color: #d63384; font-size: 12px; }
                    .vertical-data { display: flex; flex-direction: column; gap: 1px; margin-bottom: 4px; }
                    .data-row { display: flex; border-bottom: 1px solid #eee; padding-bottom: 1px; }
                    .data-label { width: 120px; font-weight: bold; color: #555; font-size: 10px; }
                    .data-value { flex: 1; font-size: 10px; }
                    .amount-section { display: flex; justify-content: space-between; border: 1px solid #ddd; margin-bottom: 10px; }
                    .payment-method { padding: 8px; width: 65%; border-right: 1px solid #ddd; }
                    .payment-amount { padding: 8px; width: 35%; text-align: center; }
                    .amount { font-size: 14px; font-weight: bold; color: #d63384; margin-top: 3px; }
                    .signature-section { border: 1px solid #ddd; }
                    .signature-table { width: 100%; border-collapse: collapse; }
                    .signature-table td { padding: 6px; border: 1px solid #ddd; text-align: center; vertical-align: bottom; font-size: 11px; }
                    .signature-label { font-weight: bold; background: #f9f9f9; font-size: 11px; }
                    .signature-space { height: 40px; border-bottom: 1px dashed #999; margin-top: 3px; }
                    .footer { margin-top: 8px; display: flex; justify-content: space-between; font-size: 11px; color: #777; }
                    .payment-type { display: flex; gap: 8px; margin-top: 3px; font-size: 10px; }
                    .payment-type div { display: flex; align-items: center; }
                    .form-title { text-align: center; font-weight: bold; font-size: 14px; color: #d63384; margin-bottom: 8px; }
                    .bank-info { display: flex; margin-bottom: 5px; }
                    .bank-label { width: 80px; font-weight: bold; font-size: 10px; }
                    .bank-value { flex: 1; font-size: 10px; }
                    @media print {
                        body { margin: 0; }
                        .receipt { border: 1px solid #d63384 !important; padding: 5px !important; }
                    }
                </style>
            `;

            const receiptNumber = document.getElementById('no_kwitansi').value || 'No.KW';

            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${receiptTitle} - ${receiptNumber}</title>
                    ${styles}
                </head>
                <body>
                    ${receiptClone.outerHTML}
                </body>
                </html>
            `);

            printWindow.document.close();
            printWindow.print();
        }

        // Initialize receipt update on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateReceipt();

            // Add event listeners to all form fields for real-time updates
            const formFields = [
                'no_kwitansi', 'uraian', 'tanggal', 'jumlah', 'setoran',
                'id_jurnal', 'id_kategori', 'id_subkategori'
            ];

            formFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.addEventListener('input', updateReceipt);
                    element.addEventListener('change', updateReceipt);
                }
            });

            // Add event listeners to radio buttons
            const jenisInputRadios = document.getElementsByName('jenis_input');
            jenisInputRadios.forEach(radio => {
                radio.addEventListener('change', updateReceipt);
            });

            // Add event listener to payment method checkbox for real-time preview update
            const isGiroCheck = document.getElementById('is_giro_check');
            if (isGiroCheck) {
                isGiroCheck.addEventListener('change', function() {
                    updatePaymentMethod();
                    updateReceipt();
                });
            }

            // Initialize editable receipt fields
            initializeEditableReceipt();

            // Add event listeners to expense receipt boxes
            const expenseCekBox = document.getElementById('expense-cek-box');
            const expenseJumlahBox = document.getElementById('expense-jumlah-box');

            if (expenseCekBox) {
                expenseCekBox.addEventListener('click', function() {
                    this.classList.toggle('checked');
                });
            }

            if (expenseJumlahBox) {
                expenseJumlahBox.addEventListener('click', function() {
                    this.classList.toggle('checked');
                });
            }

            // Add event listeners to payment method checkboxes for real-time updates
            const kasCheckbox = document.getElementById('kas-checkbox');
            const giroCheckbox = document.getElementById('giro-checkbox');
            const expenseKasCheckbox = document.getElementById('expense-kas-checkbox');
            const expenseGiroCheckbox = document.getElementById('expense-giro-checkbox');

            // Income receipt checkboxes
            if (kasCheckbox) {
                kasCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        giroCheckbox.checked = false;
                    } else if (!giroCheckbox.checked) {
                        this.checked = true; // Ensure at least one is checked
                    }
                    updateReceipt();
                });
            }

            if (giroCheckbox) {
                giroCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        kasCheckbox.checked = false;
                    } else if (!kasCheckbox.checked) {
                        this.checked = true; // Ensure at least one is checked
                    }
                    updateReceipt();
                });
            }

            // Expense receipt checkboxes
            if (expenseKasCheckbox) {
                expenseKasCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        expenseGiroCheckbox.checked = false;
                    } else if (!expenseGiroCheckbox.checked) {
                        this.checked = true; // Ensure at least one is checked
                    }
                    updateReceipt();
                });
            }

            if (expenseGiroCheckbox) {
                expenseGiroCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        expenseKasCheckbox.checked = false;
                    } else if (!expenseKasCheckbox.checked) {
                        this.checked = true; // Ensure at least one is checked
                    }
                    updateReceipt();
                });
            }
        });

        // Function to make receipt fields editable
        function initializeEditableReceipt() {
            // Make receipt fields editable
            const editableFields = [
                'receipt-number',
                'received-from',
                'amount-text',
                'purpose',
                'subcategory-code',
                'description-text',
                'receipt-date',
                'total-amount'
            ];

            editableFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.classList.add('editable-field');
                    element.setAttribute('contenteditable', 'true');

                    // Add event listeners for editing
                    element.addEventListener('input', function() {
                        // Sync changes back to form if needed
                        syncReceiptToForm(fieldId, this.textContent);
                    });

                    element.addEventListener('blur', function() {
                        // Format content when leaving the field
                        formatEditableField(fieldId, this);
                    });

                    element.addEventListener('keydown', function(e) {
                        // Handle Enter key to prevent line breaks in single-line fields
                        if (e.key === 'Enter' && !fieldId.includes('description')) {
                            e.preventDefault();
                            this.blur();
                        }
                    });
                }
            });

            // Also make expense receipt fields editable
            const expenseEditableFields = [
                'expense-receipt-number',
                'expense-received-from',
                'expense-receiver',
                'expense-address',
                'expense-subcategory-code',
                'expense-description-text',
                'expense-total-amount',
                'expense-date',
                'expense-booked-date',
                'expense-print-date',
                'bank-value'
            ];

            expenseEditableFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) {
                    element.classList.add('editable-field');
                    element.setAttribute('contenteditable', 'true');

                    element.addEventListener('input', function() {
                        syncReceiptToForm(fieldId, this.textContent);
                    });

                    element.addEventListener('blur', function() {
                        formatEditableField(fieldId, this);
                    });

                    element.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' && !fieldId.includes('description')) {
                            e.preventDefault();
                            this.blur();
                        }
                    });
                }
            });
        }

        // Function to sync receipt changes back to form
        function syncReceiptToForm(fieldId, content) {
            switch(fieldId) {
                case 'receipt-number':
                case 'expense-receipt-number':
                    // Extract number from "No.KW: XXX" format
                    const numberMatch = content.match(/No\.?\s*:?\s*(\w+)/i);
                    if (numberMatch) {
                        document.getElementById('no_kwitansi').value = numberMatch[1];
                    }
                    break;
                case 'received-from':
                case 'expense-received-from':
                    document.getElementById('diterima_dari').value = content.trim();
                    break;
                case 'description-text':
                case 'expense-description-text':
                    document.getElementById('uraian').value = content.trim();
                    break;
                case 'amount-text':
                case 'total-amount':
                case 'expense-total-amount':
                    // Extract number from "Rp XXX,XXX,-" format
                    const amountMatch = content.match(/Rp\s*([\d,]+)/);
                    if (amountMatch) {
                        const cleanAmount = amountMatch[1].replace(/,/g, '');
                        const jenisInput = document.querySelector('input[name="jenis_input"]:checked').value;
                        if (jenisInput === 'setoran') {
                            document.getElementById('setoran').value = cleanAmount;
                        } else {
                            document.getElementById('jumlah').value = cleanAmount;
                        }
                    }
                    break;
            }
        }

        // Function to format editable fields
        function formatEditableField(fieldId, element) {
            let content = element.textContent.trim();

            switch(fieldId) {
                case 'receipt-number':
                    if (content && !content.includes('No.KW:')) {
                        element.textContent = `No.KW: ${content}`;
                    }
                    break;
                case 'expense-receipt-number':
                    if (content && !content.includes('No :')) {
                        element.textContent = `No : ${content}`;
                    }
                    break;
                case 'amount-text':
                case 'total-amount':
                case 'expense-total-amount':
                    if (content && !content.includes('Rp')) {
                        // Format as currency
                        const numValue = parseFloat(content.replace(/[^\d]/g, ''));
                        if (!isNaN(numValue)) {
                            const formatted = new Intl.NumberFormat('id-ID').format(numValue);
                            element.textContent = `Rp ${formatted},-`;
                        }
                    }
                    break;
                case 'receipt-date':
                    // Keep date as is
                    break;
            }
        }

    </script>

    <script>
        // Fungsi untuk menyalin header gereja
        function copyChurchHeader() {
            const incomeChurchHeader = document.querySelector('#income-receipt .church-info p:nth-child(2)');
            const incomeChurchLocation = document.querySelector('#income-receipt .church-info p:nth-child(3)');

            if (incomeChurchHeader && incomeChurchLocation) {
                const expenseChurchHeader = document.querySelector('#expense-receipt .church-info h2');
                const expenseChurchLocation = document.querySelector('#expense-receipt .church-info p');

                if (expenseChurchHeader && expenseChurchLocation) {
                    expenseChurchHeader.textContent = incomeChurchHeader.textContent;
                    expenseChurchLocation.textContent = incomeChurchLocation.textContent.replace('Jemaat ', '');
                }
            }
        }

        // Panggil fungsi ketika halaman dimuat
        document.addEventListener('DOMContentLoaded', copyChurchHeader);
    </script>
</body>
</html>

 

 dibawah ini program aplikasi sistem jemaatnya:


[1 tool called]

Berdasarkan analisis yang telah saya lakukan, saya dapat menjelaskan tentang tabel terkait bakti bulanan dan logika pemrogramannya:

## **Tabel Bakti Bulanan (Monthly Contributions)**

### **Struktur Tabel `monthly_contributions`:**

```sql
CREATE TABLE `monthly_contributions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `member_id` int(11) DEFAULT NULL,
  `year` int(11) DEFAULT NULL,
  `month` int(11) DEFAULT NULL,
  `amount` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `member_id` (`member_id`),
  CONSTRAINT `monthly_contributions_ibfk_1` FOREIGN KEY (`member_id`) REFERENCES `members` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
```

### **Penjelasan Kolom:**
- **`id`**: Primary key auto increment
- **`member_id`**: Foreign key ke tabel `members` (anggota jemaat)
- **`year`**: Tahun bakti (contoh: 2024)
- **`month`**: Bulan (1-12)
- **`amount`**: Jumlah bakti dalam rupiah

### **Logika Pemrograman:**

#### **1. Sistem Input Data:**
- Setiap anggota jemaat dapat memiliki multiple record untuk setiap bulan dalam setahun
- Data disimpan per individu (member_id), bukan per keluarga
- Sistem mendukung tracking bakti bulanan untuk setiap anggota

#### **2. Contoh Data:**
```sql
INSERT INTO `monthly_contributions` VALUES
('1', '1', '2024', '1', '75000'),  -- Member ID 1, Januari 2024, Rp 75.000
('2', '1', '2024', '2', '75000'),  -- Member ID 1, Februari 2024, Rp 75.000
('3', '1', '2024', '3', '75000'),  -- Member ID 1, Maret 2024, Rp 75.000
```

#### **3. Relasi Database:**
- **Foreign Key**: `member_id` ‚Üí `members.id`
- **Cascade Delete**: Jika anggota dihapus, semua bakti bulanannya juga terhapus
- **Index**: Ada index pada `member_id` untuk performa query

#### **4. Logika Bisnis:**
- **Per Anggota**: Setiap anggota jemaat memiliki bakti bulanan individual
- **Fleksibilitas**: Jumlah bakti bisa berbeda setiap bulan
- **Tracking**: Sistem dapat melacak konsistensi pembayaran bakti
- **Reporting**: Dapat dibuat laporan per bulan, per tahun, atau per anggota

#### **5. Fitur yang Didukung:**
- **Input Manual**: Admin dapat input bakti bulanan per anggota
- **Laporan**: Sistem dapat generate laporan bakti bulanan
- **Tracking**: Melacak siapa yang sudah/t belum membayar bakti
- **Analisis**: Dapat dianalisis trend pembayaran bakti

#### **6. Perbedaan dengan Annual Contributions:**
- **Monthly**: Per bulan, per anggota individual
- **Annual**: Per tahun, per keluarga (family_annual_contributions)

### **Implementasi dalam Aplikasi:**
Sistem ini terintegrasi dengan:
- **Multi-tenant**: Setiap gereja memiliki data terpisah
- **User Management**: Hanya admin yang dapat input/edit
- **Backup System**: Data ter-backup otomatis
- **Reporting**: Dapat di-generate laporan bakti bulanan

Sistem bakti bulanan ini memungkinkan gereja untuk melacak kontribusi finansial anggota jemaat secara detail per bulan, yang sangat penting untuk manajemen keuangan gereja.


ini program aplikasi jemaat:
// File yang digabungkan
// Dibuat pada: 10/23/2025, 1:45:20 PM
// Total file: 9


================================================================================
===== C:/xampp/htdocs/jemaat\backup.php =====
================================================================================

<?php
// backup.php - Database backup utility for Jemaat app (FIXED VERSION)

class DatabaseBackup {
    private $conn;
    private $backup_dir;
    private $max_backups = 200;

    public function __construct($conn) {
        $this->conn = $conn;
        $this->backup_dir = 'backups/';
        $this->ensureBackupDirectory();
    }

    private function ensureBackupDirectory() {
        if (!file_exists($this->backup_dir)) {
            if (!mkdir($this->backup_dir, 0755, true)) {
                throw new Exception('Cannot create backup directory: ' . $this->backup_dir);
            }
        }

        // Check write permission
        if (!is_writable($this->backup_dir)) {
            throw new Exception('Backup directory is not writable: ' . $this->backup_dir);
        }

        // Create .htaccess untuk security
        $htaccess = $this->backup_dir . '.htaccess';
        if (!file_exists($htaccess)) {
            if (!file_put_contents($htaccess, "Deny from all\n")) {
                throw new Exception('Cannot create .htaccess file');
            }
        }
    }

    public function createBackup($reason = 'manual') {
        try {
            // Validasi directory dengan lebih robust
            $this->ensureBackupDirectory();

            $backup_dir = $this->backup_dir;

            // Debug info
            error_log("Backup attempt - Directory: $backup_dir, Writable: " . (is_writable($backup_dir) ? 'Yes' : 'No'));

            if (!is_writable($backup_dir)) {
                // Try to fix permissions automatically
                @chmod($backup_dir, 0755);

                if (!is_writable($backup_dir)) {
                    return [
                        'success' => false,
                        'error' => 'Backup directory is not writable. Please run the permission fix tool.',
                        'directory' => realpath($backup_dir),
                        'permissions' => substr(sprintf('%o', fileperms($backup_dir)), -4),
                        'writable' => is_writable($backup_dir)
                    ];
                }
            }

            $timestamp = date('Y-m-d_H-i-s');
            $filename = "jemaat_backup_{$timestamp}_{$reason}.sql";
            $filepath = $backup_dir . $filename;

            $backup_content = $this->generateBackupSQL();

            // Try to create backup file
            $bytes_written = file_put_contents($filepath, $backup_content);

            if ($bytes_written === false) {
                return [
                    'success' => false,
                    'error' => 'Failed to write backup file',
                    'filepath' => $filepath,
                    'directory_writable' => is_writable($backup_dir)
                ];
            }

            // Set file permissions
            chmod($filepath, 0644);

            $this->logBackup($filename, $reason);
            $this->cleanupOldBackups();

            return [
                'success' => true,
                'filename' => $filename,
                'path' => $filepath,
                'size' => $bytes_written,
                'message' => 'Backup created successfully'
            ];

        } catch (Exception $e) {
            error_log("Backup creation failed: " . $e->getMessage());
            return [
                'success' => false,
                'error' => $e->getMessage(),
                'directory' => $this->backup_dir,
                'writable' => is_writable($this->backup_dir)
            ];
        }
    }

    private function generateBackupSQL() {
        // Ambil semua tabel dan views dari database
        $all_tables = [];
        $all_views = [];
        
        try {
            // Query untuk mendapatkan BASE TABLE
            $stmt = $this->conn->query("
                SELECT TABLE_NAME 
                FROM INFORMATION_SCHEMA.TABLES 
                WHERE TABLE_SCHEMA = DATABASE() 
                AND TABLE_TYPE = 'BASE TABLE'
            ");
            while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
                $all_tables[] = $row[0];
            }
            
            // Query untuk mendapatkan VIEW
            $stmt = $this->conn->query("
                SELECT TABLE_NAME 
                FROM INFORMATION_SCHEMA.TABLES 
                WHERE TABLE_SCHEMA = DATABASE() 
                AND TABLE_TYPE = 'VIEW'
            ");
            while ($row = $stmt->fetch(PDO::FETCH_NUM)) {
                $all_views[] = $row[0];
            }
        } catch (Exception $e) {
            // Fallback ke daftar manual jika gagal - LENGKAP untuk semua tabel
            $all_tables = [
                // Core Jemaat tables
                'churches', 'users', 'church_neighborhoods', 'tenants',
                'families', 'family_members', 'fathers', 'mothers', 'children', 'guardians',
                'members', 'events', 'event_attendances',
                'staging_families', 'staging_family_members',
                'annual_contributions', 'family_annual_contributions', 'monthly_contributions', 
                'attendance_logs', 'share_tracking', 'chat_messages', 'edit_requests', 
                'user_neighborhoods', 'worship_schedules', 'worship_proposals',
                // Portal tables
                'portal_posts', 'portal_messages', 'portal_users', 'portal_asm_stories', 
                'portal_comments', 'portal_live_streaming',
                // System tables
                'backup_log'
            ];
            $all_views = ['v_family_all_members']; // Include known views
        }

        // Urutkan tabel sesuai dengan dependency (tabel yang direferensikan harus duluan)
        $priority_tables = [
            // Core tables first - urutan yang benar untuk dependency
            'churches', 'users', 'church_neighborhoods', 'tenants',
            'families', 'family_members', 'members', // members harus sebelum fathers/mothers/children/guardians
            'fathers', 'mothers', 'children', 'guardians', // tabel ini mereferensikan members
            'staging_families', 'staging_family_members',
            'events', 'event_attendances', 'attendance_logs', 'chat_messages',
            'annual_contributions', 'family_annual_contributions', 'monthly_contributions', 
            'share_tracking', 'edit_requests', 'user_neighborhoods',
            'worship_schedules', 'worship_proposals',
            // Portal tables - ordered by dependency
            'portal_users', 'portal_posts', 'portal_messages', 'portal_asm_stories', 
            'portal_comments', 'portal_live_streaming',
            // System tables
            'backup_log'
        ];

        // Pastikan semua tabel priority ada dalam daftar
        $priority_tables = array_intersect($priority_tables, $all_tables);
        // Tambahkan tabel lainnya yang belum ada dalam priority
        $other_tables = array_diff($all_tables, $priority_tables);
        // Gabungkan dengan urutan yang benar
        $tables = array_merge($priority_tables, $other_tables);

        // phpMyAdmin-like header to ensure easy import
        $backup_sql = "-- phpMyAdmin SQL Dump\n";
        $backup_sql .= "-- Generated: " . date('Y-m-d H:i:s') . "\n";
        $backup_sql .= "-- Host: 127.0.0.1\n";
        $backup_sql .= "-- Database: `" . $this->getDatabaseName() . "`\n\n";
        $backup_sql .= "SET SQL_MODE = 'NO_AUTO_VALUE_ON_ZERO';\n";
        $backup_sql .= "START TRANSACTION;\n";
        $backup_sql .= "SET time_zone = '+00:00';\n\n";
        $backup_sql .= "/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;\n";
        $backup_sql .= "/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;\n";
        $backup_sql .= "/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;\n";
        $backup_sql .= "/*!40101 SET NAMES utf8mb4 */;\n\n";
        // Kategorisasi tabel
        $jemaat_tables = array_filter($tables, function($table) {
            return strpos($table, 'portal_') === false;
        });
        $portal_tables = array_filter($tables, function($table) {
            return strpos($table, 'portal_') !== false;
        });
        
        $backup_sql .= "-- Jemaat Tables: " . implode(', ', $jemaat_tables) . "\n";
        $backup_sql .= "-- Portal Tables: " . implode(', ', $portal_tables) . "\n";
        $backup_sql .= "-- Views: " . implode(', ', $all_views) . "\n";
        $backup_sql .= "-- Total Tables: " . count($tables) . " (Jemaat: " . count($jemaat_tables) . ", Portal: " . count($portal_tables) . "), Views: " . count($all_views) . "\n\n";
        $backup_sql .= "SET FOREIGN_KEY_CHECKS=0;\n";
        $backup_sql .= "SET UNIQUE_CHECKS=0;\n";
        $backup_sql .= "SET AUTOCOMMIT=0;\n";
        $backup_sql .= "SET SQL_MODE='NO_AUTO_VALUE_ON_ZERO';\n\n";

        // Backup semua tabel fisik terlebih dahulu
        foreach ($tables as $table) {
            $backup_sql .= $this->backupTable($table);
        }

        // Backup semua VIEW setelah tabel fisik
        if (!empty($all_views)) {
            $backup_sql .= "\n-- Views\n";
            foreach ($all_views as $view) {
                $backup_sql .= $this->backupView($view);
            }
        }

        $backup_sql .= "COMMIT;\n";
        $backup_sql .= "SET FOREIGN_KEY_CHECKS=1;\n";
        $backup_sql .= "SET UNIQUE_CHECKS=1;\n";
        $backup_sql .= "/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;\n";
        $backup_sql .= "/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;\n";
        $backup_sql .= "/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;\n";

        return $backup_sql;
    }

    private function backupTable($table) {
        $sql = "--\n-- Backup for table: $table\n--\n";

        try {
            // Cek jika tabel exists
            $check_stmt = $this->conn->query("SHOW TABLES LIKE '$table'");
            if (!$check_stmt->fetch()) {
                return "-- Table $table does not exist, skipping\n\n";
            }

            // Cek apakah ini adalah VIEW
            if ($this->isView($table)) {
                return $this->backupView($table);
            }

            // Drop table if exists
            $sql .= "DROP TABLE IF EXISTS `$table`;\n";

            // Get table structure - PERBAIKAN: Hapus foreign key ke tenants
            $stmt = $this->conn->query("SHOW CREATE TABLE `$table`");
            if ($stmt && $row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                $create_sql = $row['Create Table'];

                // HAPUS semua foreign key constraints yang merujuk ke tenants
                $create_sql = $this->removeTenantForeignKeys($create_sql);

                $sql .= $create_sql . ";\n\n";
            } else {
                $sql .= "-- ERROR: Could not get structure for table $table\n\n";
                return $sql;
            }

            // Get table data
            $data_sql = $this->getTableData($table);
            if ($data_sql) {
                $sql .= $data_sql . "\n\n";
            }

        } catch (Exception $e) {
            $sql .= "-- ERROR backing up table $table: " . $e->getMessage() . "\n\n";
        }

        return $sql;
    }

    /**
     * Cek apakah tabel adalah VIEW
     */
    private function isView($table) {
        try {
            $stmt = $this->conn->query("
                SELECT TABLE_TYPE 
                FROM INFORMATION_SCHEMA.TABLES 
                WHERE TABLE_SCHEMA = DATABASE() 
                AND TABLE_NAME = '$table'
            ");
            $row = $stmt->fetch(PDO::FETCH_ASSOC);
            return $row && $row['TABLE_TYPE'] === 'VIEW';
        } catch (Exception $e) {
            // Fallback: cek berdasarkan konvensi nama
            return strpos($table, 'v_') === 0;
        }
    }

    /**
     * Backup VIEW structure tanpa data
     */
    private function backupView($table) {
        $sql = "--\n-- Backup for VIEW: $table\n--\n";
        
        try {
            // Drop view if exists
            $sql .= "DROP VIEW IF EXISTS `$table`;\n";
            
            // Get CREATE VIEW statement
            $stmt = $this->conn->query("SHOW CREATE VIEW `$table`");
            if ($stmt && $row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                $create_view = $row['Create View'];
                
                // Remove DEFINER clause to avoid SUPER privilege requirement
                $create_view = $this->removeDefinerFromView($create_view);
                
                $sql .= $create_view . ";\n\n";
            } else {
                $sql .= "-- ERROR: Could not get VIEW structure for $table\n\n";
            }
            
            // Tidak ada data untuk VIEW - ini yang menyebabkan error sebelumnya
            $sql .= "-- Note: VIEWs don't contain data, only structure\n";
            $sql .= "-- No INSERT statements for VIEWs to prevent import errors\n\n";
            
        } catch (Exception $e) {
            $sql .= "-- ERROR backing up VIEW $table: " . $e->getMessage() . "\n\n";
        }
        
        return $sql;
    }

    /**
     * Remove DEFINER clause from CREATE VIEW to avoid SUPER privilege requirement
     */
    private function removeDefinerFromView($create_view) {
        // Remove DEFINER clause and SQL SECURITY DEFINER
        $create_view = preg_replace('/DEFINER=`[^`]+`@`[^`]+`\s*/', '', $create_view);
        $create_view = preg_replace('/SQL SECURITY DEFINER\s*/', '', $create_view);
        
        // Clean up any double spaces
        $create_view = preg_replace('/\s+/', ' ', $create_view);
        
        return $create_view;
    }

    /**
     * Hapus foreign key constraints yang merujuk ke tabel tenants
     * Portal tables tidak memiliki tenant_id, jadi tidak perlu dihapus
     */
    private function removeTenantForeignKeys($create_sql) {
        // Guard: jika kosong, kembalikan apa adanya
        if (empty($create_sql)) {
            return $create_sql;
        }

        // Cek apakah ini tabel portal - jika ya, tidak perlu menghapus tenant_id
        $is_portal_table = strpos($create_sql, 'portal_') !== false;
        if ($is_portal_table) {
            return $create_sql; // Portal tables tidak memiliki tenant_id
        }

        // Hapus semua CONSTRAINT yang merujuk ke tenants dengan string replacement yang lebih sederhana
        $lines = explode("\n", $create_sql);
        $clean_lines = [];

        foreach ($lines as $line) {
            // Skip lines that contain tenant references
            if (strpos($line, 'REFERENCES `tenants`') !== false ||
                strpos($line, 'KEY `idx_') !== false && strpos($line, 'tenant') !== false ||
                strpos($line, '`tenant_id` int(') !== false) {
                continue;
            }
            $clean_lines[] = $line;
        }

        $create_sql = implode("\n", $clean_lines);

        // Hapus koma berlebih yang mungkin tertinggal
        $create_sql = preg_replace('/,(\s*,)/', ',', $create_sql);
        $create_sql = preg_replace('/,(\s*\))/', '$1', $create_sql);
        $create_sql = preg_replace('/,(\s*ENGINE)/', '$1', $create_sql);

        return $create_sql;
    }

    private function getTableData($table) {
        try {
            // Cek apakah ini tabel portal
            $is_portal_table = strpos($table, 'portal_') !== false;
            
            // Hapus kolom tenant_id dari query SELECT (kecuali untuk portal tables)
            $stmt = $this->conn->query("SELECT * FROM `$table`");
            if (!$stmt) return '';

            $rows = [];
            while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
                // Hapus tenant_id dari data (kecuali untuk portal tables)
                if (!$is_portal_table) {
                    unset($row['tenant_id']);
                }

                // Jika setelah di-unset tidak ada kolom lain, skip
                if (empty($row)) {
                    continue;
                }

                $values = [];
                foreach ($row as $value) {
                    if ($value === null) {
                        $values[] = 'NULL';
                    } else {
                        // Untuk tabel dengan string panjang, gunakan HEX encoding
                        if (in_array($table, ['share_tracking', 'portal_posts', 'portal_comments']) || strlen($value) > 500) {
                            $values[] = "0x" . bin2hex($value);
                        } else {
                            // Escape special characters for SQL dengan mysqli_real_escape_string equivalent
                            $escaped = str_replace(
                                ["\\", "\x00", "\n", "\r", "'", '"', "\x1a"],
                                ["\\\\", "\\0", "\\n", "\\r", "\\'", '\\"', "\\Z"],
                                $value
                            );
                            
                            // Untuk string yang sangat panjang, gunakan HEX encoding
                            if (strlen($escaped) > 1000) {
                                $values[] = "0x" . bin2hex($value);
                            } else {
                                $values[] = "'" . $escaped . "'";
                            }
                        }
                    }
                }
                $rows[] = "(" . implode(", ", $values) . ")";
            }

            if (empty($rows)) {
                return "-- Table `$table` is empty\n";
            }

            // Get column names (exclude tenant_id untuk non-portal tables)
            $columnStmt = $this->conn->query("SHOW COLUMNS FROM `$table`");
            $columns = [];
            while ($col = $columnStmt->fetch(PDO::FETCH_ASSOC)) {
                if ($is_portal_table || $col['Field'] !== 'tenant_id') {
                    $columns[] = "`{$col['Field']}`";
                }
            }

            if (empty($columns)) {
                return "-- No columns to insert for table $table\n";
            }

            return "INSERT INTO `$table` (" . implode(", ", $columns) . ") VALUES\n" .
                   implode(",\n", $rows) . ";\n";

        } catch (Exception $e) {
            return "-- ERROR getting data for table $table: " . $e->getMessage() . "\n";
        }
    }

    private function logBackup($filename, $reason) {
        $log_file = $this->backup_dir . 'backup_log.txt';
        $log_entry = date('Y-m-d H:i:s') . " | $filename | $reason\n";
        file_put_contents($log_file, $log_entry, FILE_APPEND | LOCK_EX);
    }

    private function cleanupOldBackups() {
        $backups = glob($this->backup_dir . 'jemaat_backup_*.sql');
        if (count($backups) > $this->max_backups) {
            // Sort by creation time, keep newest
            usort($backups, function($a, $b) {
                return filemtime($b) - filemtime($a);
            });

            // Remove older backups
            for ($i = $this->max_backups; $i < count($backups); $i++) {
                @unlink($backups[$i]);
            }
        }
    }

    public function listBackups() {
        $backups = glob($this->backup_dir . 'jemaat_backup_*.sql');
        $backup_info = [];

        foreach ($backups as $backup) {
            if (file_exists($backup)) {
                $backup_info[] = [
                    'filename' => basename($backup),
                    'size' => filesize($backup),
                    'created' => date('Y-m-d H:i:s', filemtime($backup)),
                    'path' => $backup
                ];
            }
        }

        // Sort by creation time, newest first
        usort($backup_info, function($a, $b) {
            return strtotime($b['created']) - strtotime($a['created']);
        });

        return $backup_info;
    }

    public function downloadBackup($filename) {
        $filepath = $this->backup_dir . $filename;

        if (file_exists($filepath)) {
            header('Content-Type: application/sql');
            header('Content-Disposition: attachment; filename="' . $filename . '"');
            header('Content-Length: ' . filesize($filepath));
            header('Cache-Control: no-cache');
            readfile($filepath);
            exit;
        } else {
            return ['success' => false, 'error' => 'Backup file not found'];
        }
    }

    // Method untuk mendapatkan info backup
    public function getBackupInfo() {
        $backups = $this->listBackups();
        $total_size = 0;

        foreach ($backups as $backup) {
            $total_size += $backup['size'];
        }

        return [
            'total_backups' => count($backups),
            'total_size' => $total_size,
            'oldest_backup' => !empty($backups) ? end($backups)['created'] : null,
            'newest_backup' => !empty($backups) ? $backups[0]['created'] : null
        ];
    }

    private function getDatabaseName() {
        try {
            $stmt = $this->conn->query("SELECT DATABASE() as db_name");
            $result = $stmt->fetch(PDO::FETCH_ASSOC);
            return $result['db_name'] ?? 'unknown';
        } catch (Exception $e) {
            return 'unknown';
        }
    }
}

// Helper functions
// Function to trigger backup before any update operation
function backupBeforeUpdate($conn, $table, $record_id, $reason = 'before_update') {
    try {
        $backup = new DatabaseBackup($conn);
        $result = $backup->createBackup($reason);

        if ($result['success']) {
            error_log("Backup created before update: {$table} ID {$record_id}");
            return true;
        } else {
            error_log("Backup failed before update: {$table} ID {$record_id} - " . $result['error']);
            return false;
        }
    } catch (Exception $e) {
        error_log("Backup exception before update: " . $e->getMessage());
        return false;
    }
}

// Enhanced triggerBackup function
function triggerBackup($conn, $reason = 'data_change') {
    try {
        $backup = new DatabaseBackup($conn);
        $result = $backup->createBackup($reason);

        if (!$result['success']) {
            error_log("BACKUP FAILED: " . $result['error']);
        }

        return $result;
    } catch (Exception $e) {
        error_log("BACKUP EXCEPTION: " . $e->getMessage());
        return ['success' => false, 'error' => $e->getMessage()];
    }
}

function getBackupList($conn) {
    $backup = new DatabaseBackup($conn);
    return $backup->listBackups();
}

function downloadBackupFile($conn, $filename) {
    $backup = new DatabaseBackup($conn);
    return $backup->downloadBackup($filename);
}

function getBackupInfo($conn) {
    $backup = new DatabaseBackup($conn);
    return $backup->getBackupInfo();
}
?>


================================================================================
===== C:/xampp/htdocs/jemaat\backup_manager.php =====
================================================================================

<?php
// Di bagian atas backup_manager.php - GANTI dengan ini:
ob_start();
session_start();
require_once 'config/config.php';
require_once 'backup.php';

error_log("Backup Manager Access - User ID: " . ($_SESSION['user_id'] ?? 'none') . ", Role: " . ($_SESSION['role'] ?? 'none'));

// Check authorization - lebih sederhana dan konsisten
if (!isset($_SESSION['user_id'])) {
    ob_end_clean();
    header("Location: login.php");
    exit();
}

// Allow roles yang sama dengan yang ada di header.php
$allowed_roles = ['pendeta', 'ketua', 'super', 'pengelola_lingkungan', 'superadmin'];

// Debug info
error_log("USER DEBUG - ID: " . $_SESSION['user_id'] . ", Role: " . $_SESSION['role'] . ", Church: " . ($_SESSION['church_id'] ?? 'none'));
error_log("Allowed roles: " . implode(', ', $allowed_roles));
error_log("Access granted: " . (in_array($_SESSION['role'], $allowed_roles) ? 'YES' : 'NO'));
if (!in_array($_SESSION['role'], $allowed_roles)) {
    // Tampilkan error page yang lebih informatif
    include 'header.php';
    echo "<div class='container'>";
    echo "<div class='alert alert-error'>";
    echo "<h2>Akses Ditolak</h2>";
    echo "<p>Anda tidak memiliki izin untuk mengakses manajer backup.</p>";
    echo "<p>Role Anda: " . ($_SESSION['role'] ?? 'Tidak ada') . "</p>";
    echo "<p>Role yang diperlukan: " . implode(', ', $allowed_roles) . "</p>";
    echo "<a href='dashboard.php' class='btn btn-secondary'>Kembali ke Dashboard</a>";
    echo "</div>";
    echo "</div>";
    include 'footer.php';
    exit();
}

$page_title = 'Manajer Backup - Aplikasi Jemaat';
?>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<?php
$conn = getDB();
$backup = new DatabaseBackup($conn);

// Permission check for backup directory (moved up for POST handling)
$backup_dir = 'backups/';
if (!file_exists($backup_dir)) {
    mkdir($backup_dir, 0755, true);
}
if (!is_writable($backup_dir)) {
    $permission_error = "<div class='alert alert-error'>Error: Backup directory is not writable. Please run fix_backup_permissions.php.</div>";
}

// Handle immediate backup creation
if (isset($_POST['create_now'])) {
    $reason = $_POST['reason'] ?? 'manual';

    // Check permissions first
    if (!is_writable($backup_dir)) {
        $_SESSION['backup_message'] = "‚ùå Backup gagal: Backup directory tidak writable. Run fix_backup_permissions.php terlebih dahulu.";
        ob_end_clean();
        header("Location: backup_manager.php");
        exit();
    }

    $result = $backup->createBackup($reason);

    if ($result['success']) {
        $_SESSION['backup_message'] = "‚úÖ Backup berhasil dibuat: " . $result['filename'] .
                                    " (" . formatFileSize($result['size']) . ")";
    } else {
        $_SESSION['backup_message'] = "‚ùå Backup gagal: " . $result['error'];
    }

    ob_end_clean();
    header("Location: backup_manager.php");
    exit();
}

// Handle scheduled backup test
if (isset($_GET['schedule_test'])) {
    $result = $backup->createBackup('scheduled_test');

    if ($result['success']) {
        $_SESSION['backup_message'] = "‚úÖ Scheduled backup test berhasil: " . $result['filename'];
    } else {
        $_SESSION['backup_message'] = "‚ùå Scheduled backup test gagal: " . $result['error'];
    }

    ob_end_clean();
    header("Location: backup_manager.php");
    exit();
}

// Handle before update backup test
if (isset($_GET['before_update_test'])) {
    $result = $backup->createBackup('before_update_test');

    if ($result['success']) {
        $_SESSION['backup_message'] = "‚úÖ Before-update backup test berhasil: " . $result['filename'];
    } else {
        $_SESSION['backup_message'] = "‚ùå Before-update backup test gagal: " . $result['error'];
    }

    ob_end_clean();
    header("Location: backup_manager.php");
    exit();
}

// Handle direct download requests
if (isset($_GET['download']) && !empty($_GET['download'])) {
    $filename = basename($_GET['download']);
    $filepath = 'backups/' . $filename;

    if (file_exists($filepath) && preg_match('/^jemaat_backup_.*\.sql$/', $filename)) {
        // Clear any previous output
        while (ob_get_level()) {
            ob_end_clean();
        }

        header('Content-Type: application/sql');
        header('Content-Disposition: attachment; filename="' . $filename . '"');
        header('Content-Length: ' . filesize($filepath));
        header('Cache-Control: no-cache');
        header('Pragma: no-cache');
        header('Expires: 0');
        readfile($filepath);
        exit;
    } else {
        die("File backup tidak ditemukan atau tidak valid");
    }
}

// Get backup list and info - limit to 10 most recent
$all_backups = $backup->listBackups();
$backups = array_slice($all_backups, 0, 10); // Show only 10 most recent
$backup_info = $backup->getBackupInfo();

// Display backup message if exists
if (isset($_SESSION['backup_message'])) {
    $backup_message = $_SESSION['backup_message'];
    unset($_SESSION['backup_message']);
}

function formatFileSize($bytes) {
    if ($bytes >= 1073741824) {
        return number_format($bytes / 1073741824, 2) . ' GB';
    } elseif ($bytes >= 1048576) {
        return number_format($bytes / 1048576, 2) . ' MB';
    } elseif ($bytes >= 1024) {
        return number_format($bytes / 1024, 2) . ' KB';
    } else {
        return $bytes . ' bytes';
    }
}
include 'header.php';
?>

<div class="container">
    <h1>üíæ Manajer Backup</h1>

    <?php if (isset($backup_message)): ?>
        <div class="alert <?php echo strpos($backup_message, '‚úÖ') !== false ? 'alert-success' : 'alert-error'; ?>">
            <?php echo $backup_message; ?>
        </div>
    <?php endif; ?>

    <!-- Backup Statistics -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-number"><?php echo $backup_info['total_backups']; ?></div>
            <div class="stat-label">Total Backup</div>
        </div>
        <div class="stat-card">
            <div class="stat-number"><?php echo formatFileSize($backup_info['total_size']); ?></div>
            <div class="stat-label">Total Ukuran</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">
                <?php echo $backup_info['newest_backup'] ? date('d/m/Y', strtotime($backup_info['newest_backup'])) : 'Tidak ada'; ?>
            </div>
            <div class="stat-label">Backup Terbaru</div>
        </div>
    </div>

    <!-- Quick Backup Actions -->
    <div class="quick-actions">
        <h3>Backup Cepat</h3>
        <div class="action-buttons">
            <form method="post" action="" style="display: inline;" onsubmit="showLoading(event)">
                <input type="hidden" name="create_now" value="1">
                <input type="hidden" name="reason" value="manual">
                <button type="submit" class="btn btn-primary">üì¶ Buat Backup Sekarang</button>
            </form>
            <form method="post" action="" style="display: inline;">
                <input type="hidden" name="create_now" value="1">
                <input type="hidden" name="reason" value="before_update">
                <button type="submit" class="btn btn-secondary">üîÑ Sebelum Update</button>
            </form>
            <form method="post" action="" style="display: inline;">
                <input type="hidden" name="create_now" value="1">
                <input type="hidden" name="reason" value="scheduled">
                <button type="submit" class="btn btn-info">‚è∞ Terjadwal</button>
            </form>
        </div>
    </div>

    <!-- Backup List -->
    <div class="backup-section">
        <h3>Daftar Backup Tersedia</h3>

        <?php if (empty($backups)): ?>
            <div class="alert alert-info">
                <p>Belum ada backup tersedia. Buat backup pertama Anda!</p>
            </div>
        <?php else: ?>
            <div class="table-responsive">
                <table class="backup-table">
                    <thead>
                        <tr>
                            <th>Nama File</th>
                            <th>Dibuat</th>
                            <th>Ukuran</th>
                            <th>Alasan</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($backups as $backup_item):
                            $reason = explode('_', pathinfo($backup_item['filename'], PATHINFO_FILENAME));
                            $reason = end($reason);
                        ?>
                            <tr>
                                <td>
                                    <strong><?php echo $backup_item['filename']; ?></strong>
                                </td>
                                <td><?php echo $backup_item['created']; ?></td>
                                <td><?php echo formatFileSize($backup_item['size']); ?></td>
                                <td>
                                    <span class="reason-badge reason-<?php echo $reason; ?>">
                                        <?php echo ucfirst($reason); ?>
                                    </span>
                                </td>
                                <td class="action-buttons">
                                    <a href="backup_manager.php?download=<?php echo urlencode($backup_item['filename']); ?>"
                                       class="btn btn-small btn-download" title="Unduh">
                                        üì• Unduh
                                    </a>
                                    <button onclick="confirmDelete('<?php echo $backup_item['filename']; ?>')"
                                            class="btn btn-small btn-danger" title="Hapus">
                                        üóëÔ∏è Hapus
                                    </button>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        <?php endif; ?>
    </div>

    <!-- Backup Information -->
    <div class="info-section">
        <h3>üìã Informasi Backup</h3>
        <div class="info-grid">
            <div class="info-item">
                <strong>Tabel yang Disertakan:</strong>
                <ul>
                    <li>churches, users, church_neighborhoods, tenants</li>
                    <li>families, family_members, fathers, mothers, children, guardians</li>
                    <li>members, events, event_attendances, attendance_logs</li>
                    <li>staging_families, staging_family_members</li>
                    <li>annual_contributions, family_annual_contributions, monthly_contributions</li>
                    <li>chat_messages, edit_requests, user_neighborhoods</li>
                    <li>worship_schedules, worship_proposals, share_tracking</li>
                    <li>portal_posts, portal_messages, portal_users, portal_asm_stories</li>
                    <li>portal_comments, portal_live_streaming</li>
                    <li>backup_log, v_family_all_members (view)</li>
                </ul>
            </div>
            <div class="info-item">
                <strong>Backup Otomatis:</strong>
                <ul>
                    <li>‚úÖ Saat anggota ditambah/diperbarui</li>
                    <li>‚úÖ Saat keluarga disetujui</li>
                    <li>‚úÖ Saat acara dibuat</li>
                    <li>‚úÖ Backup manual dari halaman ini</li>
                </ul>
            </div>
            <div class="info-item">
                <strong>Kebijakan Penyimpanan:</strong>
                <ul>
                    <li>üîí Maksimal 200 backup disimpan</li>
                    <li>üîÑ Backup lama otomatis dihapus setelah 200 backup</li>
                    <li>üíæ File disimpan di direktori /backups/</li>
                    <li>üîê Dilindungi oleh .htaccess</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    border-left: 4px solid #11998e;
}

.stat-number {
    font-size: 2.5em;
    font-weight: 700;
    color: #11998e;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.9em;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.quick-actions {
    background: white;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.action-buttons {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.backup-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.backup-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 15px;
    text-align: left;
    font-weight: 600;
}

.backup-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #e1e5e9;
}

.backup-table tr:hover {
    background-color: rgba(17, 153, 142, 0.05);
}

.reason-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.reason-manual { background: #11998e; color: white; }
.reason-scheduled { background: #6f42c1; color: white; }
.reason-before_update { background: #fd7e14; color: white; }
.reason-data_change { background: #20c997; color: white; }

.info-section {
    background: white;
    padding: 25px;
    border-radius: 12px;
    margin-top: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.info-item {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    border-left: 3px solid #11998e;
}

.info-item ul {
    margin: 10px 0;
    padding-left: 20px;
}

.info-item li {
    margin-bottom: 5px;
    font-size: 14px;
}

.btn-small {
    padding: 6px 12px;
    font-size: 12px;
    text-decoration: none;
    border-radius: 4px;
    display: inline-block;
    margin: 2px;
}

.btn-download { background: #28a745; color: white; }
.btn-info { background: #17a2b8; color: white; }
.btn-danger { background: #dc3545; color: white; }

.loading {
    opacity: 0.6;
    pointer-events: none;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .stats-container {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .stat-card {
        padding: 20px;
    }
    
    .stat-number {
        font-size: 2em;
    }
    
    .action-buttons {
        flex-direction: column;
        gap: 10px;
    }
    
    .btn {
        width: 100%;
        text-align: center;
    }
    
    .backup-table {
        font-size: 14px;
    }
    
    .backup-table th,
    .backup-table td {
        padding: 8px;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .info-item {
        padding: 15px;
    }
    
    .btn-small {
        padding: 4px 8px;
        font-size: 11px;
        margin: 1px;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 5px;
    }
    
    .stat-card {
        padding: 15px;
    }
    
    .stat-number {
        font-size: 1.8em;
    }
    
    .backup-table {
        font-size: 12px;
    }
    
    .backup-table th,
    .backup-table td {
        padding: 6px;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .btn-small {
        padding: 3px 6px;
        font-size: 10px;
    }
}
</style>

<script>
function showLoading(event) {
    const btn = event.target.closest('button');
    btn.classList.add('loading');
    btn.innerHTML = '‚è≥ Membuat Backup...';
    btn.disabled = true;
}

function confirmDelete(filename) {
    if (confirm('Apakah Anda yakin ingin menghapus backup: ' + filename + '?')) {
        // Implement delete functionality here
        alert('Fungsi hapus akan diimplementasikan di sini');
    }
}

// Auto-refresh backup list every 30 seconds
setTimeout(() => {
    window.location.reload();
}, 30000);
</script>

<?php include 'footer.php'; ob_end_flush(); ?>


================================================================================
===== C:/xampp/htdocs/jemaat\chat.php =====
================================================================================

<?php
session_start();
require_once 'config/config.php';
require_once 'config/url_helper.php';
require_once 'config/multi_tenant.php';

// Initialize multi-tenant
MultiTenant::initialize();

// Check if user is logged in
if (!isset($_SESSION['user_id'])) {
    redirect_to('login');
    exit();
}

$page_title = 'Chat Pengelola - Aplikasi Jemaat';
include 'header.php';

$user_id = $_SESSION['user_id'];
$user_role = $_SESSION['role'];
$church_id = $_SESSION['church_id'] ?? 1;

// Update last_seen for current user
try {
    $conn = getDB();
    $stmt = $conn->prepare("UPDATE users SET last_seen = NOW() WHERE id = ?");
    $stmt->execute([$user_id]);
} catch (Exception $e) {
    // Ignore error
}

// Get all users in the same church for chat
try {
    $conn = getDB();
    $stmt = $conn->prepare("
        SELECT u.id, u.username, u.role, u.last_seen,
               CASE 
                   WHEN u.last_seen IS NULL THEN 0
                   WHEN u.last_seen < DATE_SUB(NOW(), INTERVAL 5 MINUTE) THEN 0
                   ELSE 1 
               END as is_online,
               TIMESTAMPDIFF(MINUTE, u.last_seen, NOW()) as minutes_ago
        FROM users u 
        WHERE u.church_id = ? AND u.id != ?
        ORDER BY is_online DESC, u.username ASC
    ");
    $stmt->execute([$church_id, $user_id]);
    $users = $stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (Exception $e) {
    $users = [];
}

// Get recent messages
try {
    $stmt = $conn->prepare("
        SELECT c.*, u.username, u.role as user_role
        FROM chat_messages c
        JOIN users u ON c.sender_id = u.id
        WHERE (c.sender_id = ? OR c.receiver_id = ? OR c.receiver_id IS NULL)
        AND (c.church_id = ? OR c.church_id IS NULL)
        ORDER BY c.created_at DESC
        LIMIT 50
    ");
    $stmt->execute([$user_id, $user_id, $church_id]);
    $messages = array_reverse($stmt->fetchAll(PDO::FETCH_ASSOC));
} catch (Exception $e) {
    $messages = [];
}

// Get unread count
try {
    $stmt = $conn->prepare("
        SELECT COUNT(*) as unread_count
        FROM chat_messages 
        WHERE receiver_id = ? AND is_read = 0
    ");
    $stmt->execute([$user_id]);
    $unread_count = $stmt->fetchColumn();
} catch (Exception $e) {
    $unread_count = 0;
}
?>

<style>
.chat-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 8px;
    background: #f8f9fa;
    min-height: calc(100vh - 100px);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.chat-header {
    background: #075E54;
    color: white;
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 12px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(7, 94, 84, 0.2);
}

.chat-header h1 {
    margin: 0 0 4px 0;
    font-size: 1.4em;
    font-weight: 600;
}

.chat-header p {
    margin: 0;
    font-size: 0.85em;
    opacity: 0.9;
}

.chat-layout {
    display: grid;
    grid-template-columns: 220px 1fr;
    gap: 12px;
    height: calc(100vh - 180px);
}

.users-panel {
    background: white;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    overflow: hidden;
    border: 1px solid #e9ecef;
    display: flex;
    flex-direction: column;
}

.users-panel h3 {
    margin: 0 0 8px 0;
    font-size: 1.1em;
    font-weight: 600;
    color: #333;
    padding-bottom: 6px;
    border-bottom: 1px solid #f0f0f0;
}

#users-list {
    flex: 1;
    overflow-y: auto;
    padding-right: 4px;
}

.chat-panel {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    display: flex;
    flex-direction: column;
    border: 1px solid #e9ecef;
    overflow: hidden;
}

.chat-messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
    background: #fafafa;
    border-bottom: 1px solid #e9ecef;
    scroll-behavior: smooth;
    min-height: 200px;
}

.chat-messages::-webkit-scrollbar {
    width: 4px;
}

.chat-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 2px;
}

.chat-messages::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 2px;
}

.chat-input {
    padding: 12px;
    border-top: 1px solid #e9ecef;
    background: white;
}

.user-item {
    display: flex;
    align-items: center;
    padding: 8px;
    margin-bottom: 4px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid transparent;
    position: relative;
    background: #fafbfc;
}

.user-item:hover {
    background: #eef7f3;
    border-color: #128C7E;
}

.user-item.active {
    background: #e6f4ea;
    border-color: #128C7E;
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #128C7E, #25D366);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-right: 8px;
    position: relative;
    font-size: 13px;
}

.user-avatar.online::after {
    content: '';
    position: absolute;
    bottom: 2px;
    right: 2px;
    width: 10px;
    height: 10px;
    background: #28a745;
    border-radius: 50%;
    border: 2px solid white;
}

.user-avatar:not(.online)::after {
    content: '';
    position: absolute;
    bottom: 2px;
    right: 2px;
    width: 10px;
    height: 10px;
    background: #6c757d;
    border-radius: 50%;
    border: 2px solid white;
}

.user-info {
    flex: 1;
    min-width: 0;
}

.user-name {
    font-weight: 600;
    color: #333;
    margin-bottom: 2px;
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.user-role {
    font-size: 11px;
    color: #666;
    text-transform: uppercase;
    font-weight: 500;
    letter-spacing: 0.3px;
}

.message-item {
    margin-bottom: 8px;
    display: flex;
    align-items: flex-start;
}

.message-item.own {
    flex-direction: row-reverse;
}

.message-bubble {
    max-width: 75%;
    padding: 8px 12px;
    border-radius: 12px;
    position: relative;
    word-wrap: break-word;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.message-item.own .message-bubble {
    background: #dcf8c6;
    color: #1b1b1b;
    border-bottom-right-radius: 4px;
}

.message-item:not(.own) .message-bubble {
    background: white;
    color: #1b1b1b;
    border-bottom-left-radius: 4px;
    border: 1px solid #e9ecef;
}

.message-meta {
    font-size: 9px;
    color: #666;
    margin-top: 2px;
    text-align: right;
}

.message-item:not(.own) .message-meta {
    text-align: left;
}

.message-input {
    display: flex;
    gap: 8px;
    align-items: flex-end;
    margin-top: 8px;
}

.message-textarea {
    flex: 1;
    min-height: 32px;
    max-height: 80px;
    padding: 8px 12px;
    border: 1px solid #e9ecef;
    border-radius: 18px;
    resize: none;
    font-family: inherit;
    font-size: 13px;
    transition: all 0.2s ease;
    background: #fafbfc;
    width: 100%;
    box-sizing: border-box;
}

.message-textarea:focus {
    outline: none;
    border-color: #128C7E;
    background: white;
    box-shadow: 0 0 0 2px rgba(18, 140, 126, 0.1);
}

.send-btn {
    background: #128C7E;
    color: white;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 16px;
}

.send-btn:hover {
    background: #0d6e63;
    transform: scale(1.05);
}

.send-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.character-count {
    font-size: 11px;
    color: #888;
    text-align: right;
    margin-top: 2px;
}

.character-count.warning {
    color: #ff9800;
}

.character-count.danger {
    color: #f44336;
}

.badge {
    display: inline-block;
    min-width: 12px;
    height: 12px;
    padding: 0 3px;
    border-radius: 6px;
    background: #e53935;
    color: #fff;
    font-size: 9px;
    font-weight: 700;
    line-height: 12px;
    text-align: center;
    vertical-align: middle;
    margin-left: 4px;
}

.debug-link {
    color: white;
    text-decoration: underline;
    font-size: 11px;
    margin-top: 6px;
    display: inline-block;
}

.debug-link:hover {
    color: #e0e0e0;
}

.debug-btn {
    margin-left: 8px;
    padding: 3px 6px;
    background: rgba(255,255,255,0.2);
    color: white;
    border: 1px solid rgba(255,255,255,0.5);
    border-radius: 3px;
    cursor: pointer;
    font-size: 11px;
}

.debug-btn:hover {
    background: rgba(255,255,255,0.3);
}

/* Mention suggestions */
.mention-suggestions {
    position: absolute;
    max-height: 160px;
    overflow-y: auto;
    background: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    z-index: 50;
    display: none;
    width: 200px;
}

.mention-suggestions ul {
    list-style: none;
    margin: 0;
    padding: 4px 0;
}

.mention-suggestions li {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 12px;
}

.mention-suggestions li:hover,
.mention-suggestions li.active {
    background: #e6f9f1;
}

.mention-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: #128C7E;
    color: #fff;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 11px;
}

.mention-name {
    font-size: 12px;
    color: #333;
    font-weight: 600;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .chat-container {
        padding: 6px;
        min-height: calc(100vh - 80px);
    }
    
    .chat-header {
        padding: 10px;
        margin-bottom: 10px;
    }
    
    .chat-header h1 {
        font-size: 1.2em;
    }
    
    .chat-header p {
        font-size: 0.8em;
    }
    
    .chat-layout {
        grid-template-columns: 1fr;
        height: auto;
        gap: 10px;
    }
    
    .users-panel {
        max-height: 180px;
        margin-bottom: 10px;
        padding: 10px;
    }
    
    .users-panel h3 {
        font-size: 1em;
        margin-bottom: 6px;
    }
    
    .user-item {
        padding: 6px;
        margin-bottom: 3px;
    }
    
    .user-avatar {
        width: 28px;
        height: 28px;
        font-size: 12px;
        margin-right: 6px;
    }
    
    .user-name {
        font-size: 11px;
    }
    
    .user-role {
        font-size: 10px;
    }
    
    .chat-messages {
        padding: 10px;
        max-height: 300px;
    }
    
    .message-bubble {
        max-width: 85%;
        padding: 6px 10px;
    }
    
    .message-textarea {
        min-height: 28px;
        padding: 6px 10px;
        font-size: 12px;
    }
    
    .send-btn {
        width: 32px;
        height: 32px;
        font-size: 14px;
    }
    
    .message-input {
        gap: 6px;
        margin-top: 6px;
    }
    
    .character-count {
        font-size: 10px;
    }
}

@media (max-width: 480px) {
    .chat-container {
        padding: 4px;
    }
    
    .chat-header {
        padding: 8px;
        margin-bottom: 8px;
    }
    
    .chat-header h1 {
        font-size: 1.1em;
    }
    
    .users-panel {
        padding: 8px;
        max-height: 150px;
    }
    
    .user-item {
        padding: 5px;
    }
    
    .user-avatar {
        width: 24px;
        height: 24px;
        font-size: 11px;
        margin-right: 5px;
    }
    
    .user-name {
        font-size: 10px;
    }
    
    .user-role {
        font-size: 9px;
    }
    
    .chat-messages {
        padding: 8px;
        max-height: 250px;
    }
    
    .message-bubble {
        max-width: 90%;
        padding: 5px 8px;
    }
    
    .message-textarea {
        min-height: 26px;
        padding: 5px 8px;
        font-size: 11px;
    }
    
    .send-btn {
        width: 30px;
        height: 30px;
        font-size: 13px;
    }
}

/* Loading and empty states */
.chat-messages:empty::before {
    content: "Belum ada pesan. Mulai percakapan dengan memilih user di sebelah kiri.";
    display: block;
    text-align: center;
    color: #666;
    font-style: italic;
    padding: 30px 15px;
    font-size: 13px;
}

.users-panel:empty::before {
    content: "Tidak ada user yang tersedia.";
    display: block;
    text-align: center;
    color: #666;
    font-style: italic;
    padding: 30px 15px;
    font-size: 13px;
}

/* Custom scrollbar for users list */
#users-list::-webkit-scrollbar {
    width: 4px;
}

#users-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 2px;
}

#users-list::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 2px;
}

#users-list::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Debug info styling */
.debug-info {
    font-size: 9px;
    color: #999;
    margin-top: 2px;
    line-height: 1.2;
}
</style>

<div class="chat-container">
    <div class="chat-header">
        <h1>üí¨ Chat Pengelola</h1>
        <p>Komunikasi dengan sesama jemaat</p>
        <?php if ($unread_count > 0): ?>
            <span class="badge" id="unread-badge"><?php echo $unread_count; ?></span>
        <?php else: ?>
            <span class="badge" id="unread-badge" style="display:none;">0</span>
        <?php endif; ?>
        <?php if ($_SESSION['role'] === 'superadmin'): ?>
            <div>
                <a href="test_online_status.php" target="_blank" class="debug-link">
                    üîç Debug Online Status
                </a>
                <button onclick="testSendMessage()" class="debug-btn">
                    üß™ Test Send
                </button>
            </div>
        <?php endif; ?>
    </div>

    <div class="chat-layout">
        <!-- Users Panel -->
        <div class="users-panel">
            <h3>üë• Anggota</h3>
            <div id="users-list">
                <?php foreach ($users as $user): ?>
                    <div class="user-item" data-user-id="<?php echo $user['id']; ?>" data-username="<?php echo htmlspecialchars($user['username']); ?>" data-online="<?php echo $user['is_online']; ?>">
                        <div class="user-avatar <?php echo $user['is_online'] ? 'online' : ''; ?>">
                            <?php echo strtoupper(substr($user['username'], 0, 1)); ?>
                        </div>
                        <div class="user-info">
                            <div class="user-name"><?php echo htmlspecialchars($user['username']); ?></div>
                            <div class="user-role"><?php echo htmlspecialchars($user['role']); ?></div>
                            <?php if ($_SESSION['role'] === 'superadmin'): ?>
                                <div class="debug-info">
                                    Last: <?php echo $user['last_seen'] ? date('H:i', strtotime($user['last_seen'])) : 'Never'; ?> 
                                    | Online: <?php echo $user['is_online'] ? 'Yes' : 'No'; ?>
                                </div>
                            <?php endif; ?>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>

        <!-- Chat Panel -->
        <div class="chat-panel">
            <div class="chat-messages" id="chat-messages">
                <?php foreach ($messages as $message): ?>
                    <div class="message-item <?php echo $message['sender_id'] == $user_id ? 'own' : ''; ?>">
                        <div class="message-bubble">
                            <div><?php echo nl2br(htmlspecialchars($message['message'])); ?></div>
                            <div class="message-meta">
                                <?php echo htmlspecialchars($message['username']); ?> ‚Ä¢ 
                                <?php echo date('H:i', strtotime($message['created_at'])); ?>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>

            <div class="chat-input" style="position: relative;">
                <form id="message-form">
                    <textarea 
                        id="message-text" 
                        class="message-textarea" 
                        placeholder="Ketik pesan/mention @ (maksimal 1000 karakter)"
                        maxlength="1000"
                        rows="1"
                    ></textarea>
                    <div id="mention-suggestions" class="mention-suggestions" role="listbox" aria-label="Saran mention">
                        <ul id="mention-list"></ul>
                    </div>
                    <div class="character-count" id="char-count">0/1000</div>
                    <div class="message-input">
                        <button type="submit" class="send-btn" id="send-btn" aria-label="Kirim">
                            ‚û§
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
let selectedUserId = null;
let allUsersForMention = [];
let mentionActive = false;
let mentionStartIndex = -1;
let mentionSelectedIndex = 0;

// Character counter
const messageText = document.getElementById('message-text');
const charCount = document.getElementById('char-count');
const sendBtn = document.getElementById('send-btn');
const unreadBadge = document.getElementById('unread-badge');

messageText.addEventListener('input', function() {
    const length = this.value.length;
    charCount.textContent = length + '/1000';
    
    if (length > 900) {
        charCount.className = 'character-count danger';
    } else if (length > 800) {
        charCount.className = 'character-count warning';
    } else {
        charCount.className = 'character-count';
    }
    
    // Auto-resize textarea
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 80) + 'px';
});

// Submit on Enter (Shift+Enter untuk baris baru)
messageText.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        document.getElementById('message-form').dispatchEvent(new Event('submit', { cancelable: true }));
    }
});

// User selection - attach to existing elements
function attachUserClickEvents() {
    document.querySelectorAll('.user-item').forEach(item => {
        item.addEventListener('click', function() {
            document.querySelectorAll('.user-item').forEach(u => u.classList.remove('active'));
            this.classList.add('active');
            selectedUserId = this.dataset.userId;
            
            // Load messages for this user
            loadMessages(selectedUserId);
        });
    });
}

// Attach events to initial users
attachUserClickEvents();

// Event delegation for dynamically added users
document.getElementById('users-list').addEventListener('click', function(e) {
    const userItem = e.target.closest('.user-item');
    if (userItem) {
        document.querySelectorAll('.user-item').forEach(u => u.classList.remove('active'));
        userItem.classList.add('active');
        selectedUserId = userItem.dataset.userId;
        loadMessages(selectedUserId);
    }
});

// Message form submission
document.getElementById('message-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const message = messageText.value.trim();
    
    if (!message) {
        return;
    }
    
    if (message.length > 1000) {
        alert('Pesan terlalu panjang! Maksimal 1000 karakter.');
        return;
    }
    
    sendMessage(message, selectedUserId);
});

// Send message function
function sendMessage(message, receiverId = null) {
    const formData = new FormData();
    formData.append('action', 'send_message');
    formData.append('message', message);
    if (receiverId) {
        formData.append('receiver_id', receiverId);
    }
    
    fetch('chat_api.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            messageText.value = '';
            charCount.textContent = '0/1000';
            charCount.className = 'character-count';
            messageText.style.height = 'auto';
            // Optimistic UI: append sent message immediately
            appendOwnMessageToDom(message);
            // Sync with server to ensure ordering and metadata
            setTimeout(() => loadMessages(selectedUserId), 150);
        } else {
            alert('Gagal mengirim pesan: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Terjadi kesalahan saat mengirim pesan');
    });
}

// Load messages function
function loadMessages(receiverId = null) {
    const url = new URL('chat_api.php', window.location.origin);
    url.searchParams.append('action', 'get_messages');
    if (receiverId) {
        url.searchParams.append('receiver_id', receiverId);
    }
    
    fetch(url)
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            displayMessages(data.messages);
        }
    })
    .catch(error => {
        console.error('Error loading messages:', error);
    });
}

// Refresh users list
function refreshUsersList() {
    fetch('chat_api.php?action=get_users')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateUsersList(data.users);
            allUsersForMention = data.users || [];
        }
    })
    .catch(error => console.error('Error refreshing users:', error));
}

// Update users list in DOM
function updateUsersList(users) {
    const container = document.getElementById('users-list');
    container.innerHTML = '';
    
    users.forEach(user => {
        const userDiv = document.createElement('div');
        userDiv.className = `user-item`;
        userDiv.dataset.userId = user.id;
        userDiv.dataset.username = user.username;
        userDiv.dataset.online = user.is_online;
        
        userDiv.innerHTML = `
            <div class="user-avatar ${user.is_online ? 'online' : ''}">
                ${user.username.charAt(0).toUpperCase()}
            </div>
            <div class="user-info">
                <div class="user-name">${user.username}</div>
                <div class="user-role">${user.role}</div>
                ${<?php echo $_SESSION['role'] === 'superadmin' ? 'true' : 'false'; ?> ? `
                    <div class="debug-info">
                        Last: ${user.last_seen ? new Date(user.last_seen).toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'}) : 'Never'} 
                        | Online: ${user.is_online ? 'Yes' : 'No'}
                    </div>
                ` : ''}
            </div>
        `;
        
        userDiv.addEventListener('click', function() {
            document.querySelectorAll('.user-item').forEach(u => u.classList.remove('active'));
            this.classList.add('active');
            selectedUserId = this.dataset.userId;
            loadMessages(selectedUserId);
        });
        
        container.appendChild(userDiv);
    });
}

// Display messages
function displayMessages(messages) {
    const container = document.getElementById('chat-messages');
    container.innerHTML = '';
    
    if (!messages || messages.length === 0) {
        return;
    }
    
    messages.forEach(message => {
        const isOwn = message.sender_id == <?php echo $user_id; ?>;
        const messageDiv = document.createElement('div');
        messageDiv.className = `message-item ${isOwn ? 'own' : ''}`;
        messageDiv.innerHTML = `
            <div class="message-bubble">
                <div>${message.message.replace(/\n/g, '<br>')}</div>
                <div class="message-meta">
                    ${message.username} ‚Ä¢ ${message.time}
                </div>
            </div>
        `;
        container.appendChild(messageDiv);
    });
    
    // Scroll to bottom
    container.scrollTop = container.scrollHeight;
}

// Append own message instantly (optimistic UI)
function appendOwnMessageToDom(message) {
    const container = document.getElementById('chat-messages');
    if (!container) return;
    const wrapper = document.createElement('div');
    wrapper.className = 'message-item own';
    const timeStr = new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute: '2-digit'});
    wrapper.innerHTML = `
        <div class="message-bubble">
            <div>${message.replace(/\n/g, '<br>')}</div>
            <div class="message-meta">Anda ‚Ä¢ ${timeStr}</div>
        </div>
    `;
    container.appendChild(wrapper);
    container.scrollTop = container.scrollHeight;
}

// Auto-refresh messages every 3 seconds
setInterval(() => {
    loadMessages(selectedUserId);
}, 3000);

// Refresh users list every 10 seconds to update online status
setInterval(() => {
    refreshUsersList();
}, 10000);

// Update last_seen every 30 seconds
setInterval(() => {
    const formData = new FormData();
    formData.append('action', 'update_last_seen');
    
    fetch('chat_api.php', {
        method: 'POST',
        body: formData
    }).catch(error => console.error('Error updating last_seen:', error));
}, 30000);

// Poll unread count every 5 seconds
function pollUnread() {
    fetch('chat_api.php?action=get_unread_count')
        .then(r => r.json())
        .then(data => {
            if (!data.success) return;
            const c = data.unread_count || 0;
            if (c > 0) {
                unreadBadge.textContent = c;
                unreadBadge.style.display = 'inline-block';
            } else {
                unreadBadge.textContent = '0';
                unreadBadge.style.display = 'none';
            }
        })
        .catch(() => {});
}
setInterval(pollUnread, 5000);
pollUnread();

// Clicking the badge marks all as read
if (unreadBadge) {
    unreadBadge.style.cursor = 'pointer';
    unreadBadge.title = 'Tandai semua terbaca';
    unreadBadge.addEventListener('click', () => {
        const formData = new FormData();
        formData.append('action', 'mark_all_read');
        fetch('chat_api.php', { method: 'POST', body: formData })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    unreadBadge.style.display = 'none';
                    unreadBadge.textContent = '0';
                }
            })
            .catch(() => {});
    });
}

// Test send message function
function testSendMessage() {
    sendMessage('Test message from debug', selectedUserId);
}

// Initial load
loadMessages();
// Prime users cache for mentions
refreshUsersList();

// Mention handling
const mentionBox = document.getElementById('mention-suggestions');
const mentionList = document.getElementById('mention-list');

function openMentionBox(items, position) {
    renderMentionItems(items);
    mentionBox.style.display = 'block';
    mentionBox.style.top = position.top + 'px';
    mentionBox.style.left = position.left + 'px';
}

function closeMentionBox() {
    mentionBox.style.display = 'none';
    mentionList.innerHTML = '';
    mentionSelectedIndex = 0;
}

function renderMentionItems(items) {
    mentionList.innerHTML = '';
    items.slice(0, 8).forEach((u, idx) => {
        const li = document.createElement('li');
        li.setAttribute('role', 'option');
        li.className = idx === mentionSelectedIndex ? 'active' : '';
        li.innerHTML = `
            <span class="mention-avatar">${(u.username||'').charAt(0).toUpperCase()}</span>
            <span class="mention-name">${u.username}</span>
        `;
        li.addEventListener('mouseenter', () => {
            mentionSelectedIndex = idx;
            highlightMentionSelection();
        });
        li.addEventListener('mousedown', (e) => {
            e.preventDefault();
            applyMention(u.username);
        });
        mentionList.appendChild(li);
    });
}

function highlightMentionSelection() {
    Array.from(mentionList.children).forEach((child, i) => {
        if (i === mentionSelectedIndex) child.classList.add('active');
        else child.classList.remove('active');
    });
}

function getCaretCoordinates(textarea) {
    const rect = textarea.getBoundingClientRect();
    return { top: textarea.offsetTop + textarea.offsetHeight + 4, left: textarea.offsetLeft + 8 };
}

function filterUsersByQuery(query) {
    const q = (query || '').toLowerCase();
    return (allUsersForMention || []).filter(u => (u.username||'').toLowerCase().includes(q));
}

function applyMention(username) {
    const value = messageText.value;
    const before = value.slice(0, mentionStartIndex);
    const after = value.slice(messageText.selectionStart);
    const mentionToken = '@' + username + ' ';
    messageText.value = before + mentionToken + after;
    const caretPos = (before + mentionToken).length;
    messageText.setSelectionRange(caretPos, caretPos);
    mentionActive = false;
    closeMentionBox();
    messageText.dispatchEvent(new Event('input'));
    messageText.focus();
}

messageText.addEventListener('keydown', (e) => {
    if (!mentionActive) return;
    const currentItems = filterUsersByQuery(messageText.value.slice(mentionStartIndex + 1, messageText.selectionStart));
    if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (currentItems.length === 0) return;
        mentionSelectedIndex = (mentionSelectedIndex + 1) % Math.min(currentItems.length, 8);
        highlightMentionSelection();
    } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (currentItems.length === 0) return;
        mentionSelectedIndex = (mentionSelectedIndex - 1 + Math.min(currentItems.length, 8)) % Math.min(currentItems.length, 8);
        highlightMentionSelection();
    } else if (e.key === 'Enter' || e.key === 'Tab') {
        if (mentionBox.style.display === 'block' && currentItems.length > 0) {
            e.preventDefault();
            applyMention(currentItems[mentionSelectedIndex]?.username || '');
        }
    } else if (e.key === 'Escape') {
        closeMentionBox();
        mentionActive = false;
    }
});

messageText.addEventListener('input', function() {
    const pos = this.selectionStart;
    const val = this.value;
    if (!mentionActive) {
        if (val[pos - 1] === '@') {
            mentionActive = true;
            mentionStartIndex = pos - 1;
            mentionSelectedIndex = 0;
        } else {
            return;
        }
    }
    if (mentionActive) {
        const query = val.slice(mentionStartIndex + 1, pos);
        const items = filterUsersByQuery(query);
        if (items.length === 0) {
            closeMentionBox();
            return;
        }
        const coords = getCaretCoordinates(this);
        openMentionBox(items, coords);
        highlightMentionSelection();
    }
});

// Close mention on blur or click outside
document.addEventListener('click', (e) => {
    if (!mentionBox.contains(e.target) && e.target !== messageText) {
        closeMentionBox();
        mentionActive = false;
    }
});
</script>

<?php include 'footer.php'; ?>

================================================================================
===== C:/xampp/htdocs/jemaat\edit_family.php =====
================================================================================

<?php
require_once 'config/config.php';

initApplication();
MultiTenant::initialize();

// Helper: cek kolom ada
if (!function_exists('tableHasColumn')) {
    function tableHasColumn(PDO $pdo, string $table, string $column): bool {
        try {
            $sql = "SELECT 1 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = :t AND COLUMN_NAME = :c LIMIT 1";
            $st = $pdo->prepare($sql);
            $st->execute(['t' => $table, 'c' => $column]);
            return (bool)$st->fetchColumn();
        } catch (Throwable $e) { return false; }
    }
}

// Helper: normalisasi tanggal ke format YYYY-MM-DD; jika tidak valid -> null
if (!function_exists('normalizeDateYmd')) {
    function normalizeDateYmd(?string $value): ?string {
        if (!$value) return null;
        $v = trim($value);
        if ($v === '' || $v === '-' || stripos($v, 'dd/mm') !== false) return null;
        // Sudah format Y-m-d
        if (preg_match('/^\d{4}-\d{2}-\d{2}$/', $v)) return $v;
        // Coba d/m/Y atau dd/mm/yyyy
        if (preg_match('/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/', $v, $m)) {
            $d = (int)$m[1]; $M = (int)$m[2]; $y = (int)$m[3];
            if (checkdate($M, $d, $y)) return sprintf('%04d-%02d-%02d', $y, $M, $d);
            return null;
        }
        // Gunakan strtotime fallback
        $ts = strtotime($v);
        if ($ts && $ts > 0) { return date('Y-m-d', $ts); }
        return null;
    }
}

// Helper: upsert staging_families untuk status 'pending' per register_number
if (!function_exists('upsertStagingFamily')) {
    function upsertStagingFamily(PDO $conn, array $payload): int {
        $hasTenant = tableHasColumn($conn, 'staging_families', 'tenant_id');
        $columns = ['church_id','register_number','neighborhood','family_address','father_name','mother_name','head_of_family','submitted_by'];
        $values = [$payload['church_id'],$payload['register_number'],$payload['neighborhood'],$payload['family_address'],$payload['father_name'],$payload['mother_name'],$payload['head_of_family'],$payload['submitted_by']];
        if ($hasTenant) { array_unshift($columns, 'tenant_id'); array_unshift($values, $payload['tenant_id'] ?? 1); }

        $colList = implode(',', $columns);
        $phList = implode(',', array_fill(0, count($columns), '?'));
        try {
            $sql = "INSERT INTO staging_families (".$colList.", status, created_at) VALUES (".$phList.", 'pending', NOW())";
            $st = $conn->prepare($sql);
            $st->execute($values);
            return (int)$conn->lastInsertId();
        } catch (PDOException $e) {
            // Jika duplikat pending, update baris yang ada dan pakai id itu
            if ((int)$e->getCode() === 23000) {
                $sel = $conn->prepare("SELECT id FROM staging_families WHERE register_number = ? AND status = 'pending' ORDER BY id DESC LIMIT 1");
                $sel->execute([$payload['register_number']]);
                $id = (int)($sel->fetchColumn() ?: 0);
                if ($id > 0) {
                    $set = "church_id=?, neighborhood=?, family_address=?, father_name=?, mother_name=?, head_of_family=?, submitted_by=?, updated_at = NOW()";
                    $vals = [$payload['church_id'],$payload['neighborhood'],$payload['family_address'],$payload['father_name'],$payload['mother_name'],$payload['head_of_family'],$payload['submitted_by'],$id];
                    if ($hasTenant) { $set = "tenant_id=?, ".$set; array_unshift($vals, $payload['tenant_id'] ?? 1); }
                    $upd = $conn->prepare("UPDATE staging_families SET $set WHERE id = ?");
                    $upd->execute($vals);
                    return $id;
                }
            }
            throw $e;
        }
    }
}

// Check if user is logged in
if (!isset($_SESSION['user_id'])) {
    header("Location: login");
    exit();
}

$page_title = 'Edit Data Keluarga';
include 'header.php';

$conn = getDB();
$role = $_SESSION['role'] ?? 'public';
$current_church_id = $_SESSION['church_id'] ?? null;

// Get family ID from URL
$family_id = $_GET['id'] ?? null;
$error_message = '';
$success_message = '';

if (!$family_id) {
    header("Location: member_detail");
    exit();
}

// Fetch family data
try {
    $stmt = $conn->prepare("SELECT * FROM families WHERE id = ?");
    $stmt->execute([$family_id]);
    $family = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if (!$family) {
        $error_message = "Data keluarga tidak ditemukan.";
    } else {
        // Check access permission
        if ($role === 'super' || $role === 'admin' || $role === 'regular') {
            if ($family['church_id'] != $current_church_id) {
                $error_message = "Anda tidak memiliki akses untuk mengedit data keluarga ini.";
            }
        }
    }
} catch (Exception $e) {
    $error_message = "Terjadi kesalahan: " . $e->getMessage();
}

// Handle delete request
if (isset($_POST['delete_family']) && ($role === 'pendeta' || $role === 'ketua' || $role === 'super')) {
    try {
        // Delete family data
        $stmt = $conn->prepare("DELETE FROM families WHERE id = ?");
        $stmt->execute([$family_id]);
        
        // Redirect with success message
        $_SESSION['delete_success'] = "Data keluarga berhasil dihapus!";
        header("Location: member_detail");
        exit();
        
    } catch (Exception $e) {
        $error_message = "Gagal menghapus data: " . $e->getMessage();
    }
}

// Handle form submission
if ($_SERVER['REQUEST_METHOD'] === 'POST' && !$error_message && !isset($_POST['delete_family']) && !isset($_POST['save_members'])) {
    try {
        $register_number = $_POST['register_number'] ?? '';
        $neighborhood = $_POST['neighborhood'] ?? '';
        $family_address = $_POST['family_address'] ?? '';
        $father_name = $_POST['father_name'] ?? '';
        $mother_name = $_POST['mother_name'] ?? '';
        $head_of_family = $_POST['head_of_family'] ?? '';
        
        if ($role === 'admin') {
            // Jika admin mengirim submit_all, gabungkan juga data anggota dari form kedua bila ada di POST
            $membersPayload = $_POST['members'] ?? [];
            // Admin: ajukan perubahan ke staging_families (status pending)
            $payload = [
                'tenant_id' => 1,
                'church_id' => $current_church_id ?? $family['church_id'],
                'register_number' => $register_number ?: ($family['register_number'] ?? ''),
                'neighborhood' => $neighborhood ?: ($family['neighborhood'] ?? ''),
                'family_address' => $family_address ?: ($family['family_address'] ?? ''),
                'father_name' => $father_name ?: ($family['father_name'] ?? ''),
                'mother_name' => $mother_name ?: ($family['mother_name'] ?? ''),
                'head_of_family' => $head_of_family ?: ($family['head_of_family'] ?? ''),
                'submitted_by' => $_SESSION['user_id']
            ];
            $stagingId = upsertStagingFamily($conn, $payload);

            // Jika ada anggota ikut tersubmit (submit_all), simpan ke staging_family_members
            if (!empty($_POST['submit_all']) && is_array($membersPayload)) {
                // Jika pending sudah ada, bersihkan anggota lama agar sinkron
                try {
                    $conn->prepare("DELETE FROM staging_family_members WHERE staging_family_id = ?")->execute([$stagingId]);
                } catch (Throwable $e) {}

                $hasTenantM = tableHasColumn($conn, 'staging_family_members', 'tenant_id');
                if ($hasTenantM) {
                    $insm = $conn->prepare("INSERT INTO staging_family_members (tenant_id, staging_family_id, name, relationship, gender, birth_date, phone, occupation, education, status, notes) VALUES (1, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
                } else {
                    $insm = $conn->prepare("INSERT INTO staging_family_members (staging_family_id, name, relationship, gender, birth_date, phone, occupation, education, status, notes) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
                }
                foreach ($membersPayload as $m) {
                    $name = trim($m['name'] ?? '');
                    if ($name === '') { continue; }
                    $birth = normalizeDateYmd($m['birth_date'] ?? null);
                    if ($hasTenantM) {
                        $insm->execute([
                            $stagingId,
                            $name,
                            $m['relationship'] ?? '',
                            $m['gender'] ?? null,
                            $birth,
                            $m['phone'] ?? null,
                            $m['occupation'] ?? null,
                            $m['education'] ?? null,
                            $m['status'] ?? 'Aktif',
                            $m['notes'] ?? null
                        ]);
                    } else {
                        $insm->execute([
                            $stagingId,
                            $name,
                            $m['relationship'] ?? '',
                            $m['gender'] ?? null,
                            $birth,
                            $m['phone'] ?? null,
                            $m['occupation'] ?? null,
                            $m['education'] ?? null,
                            $m['status'] ?? 'Aktif',
                            $m['notes'] ?? null
                        ]);
                    }
                }
            }
            $success_message = "Pengajuan perubahan data keluarga telah dikirim dan menunggu persetujuan.";
        } else {
            // Role tinggi: update langsung
        $stmt = $conn->prepare("
            UPDATE families 
            SET register_number = ?,
                neighborhood = ?,
                family_address = ?,
                father_name = ?,
                mother_name = ?,
                head_of_family = ?
            WHERE id = ?
        ");
        $stmt->execute([
            $register_number,
            $neighborhood,
            $family_address,
            $father_name,
            $mother_name,
            $head_of_family,
            $family_id
        ]);
        $success_message = "Data keluarga berhasil diupdate!";
        }
        
        // Refresh family data
        $stmt = $conn->prepare("SELECT * FROM families WHERE id = ?");
        $stmt->execute([$family_id]);
        $family = $stmt->fetch(PDO::FETCH_ASSOC);
        
    } catch (Exception $e) {
        $error_message = "Gagal mengupdate data: " . $e->getMessage();
    }
}

// Handle save members submission
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['save_members']) && !$error_message) {
    try {
        $members = $_POST['members'] ?? [];
        if ($role === 'admin') {
            // Buat pengajuan staging untuk perubahan anggota
            $payload = [
                'tenant_id' => 1,
                'church_id' => $current_church_id ?? $family['church_id'],
                'register_number' => $family['register_number'],
                'neighborhood' => $family['neighborhood'],
                'family_address' => $family['family_address'],
                'father_name' => $family['father_name'],
                'mother_name' => $family['mother_name'],
                'head_of_family' => $family['head_of_family'],
                'submitted_by' => $_SESSION['user_id']
            ];
            $stagingId = upsertStagingFamily($conn, $payload);
            $insm = $conn->prepare("INSERT INTO staging_family_members (staging_family_id, name, relationship, gender, birth_date, phone, occupation, education, status, notes) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
            foreach ($members as $m) {
                $name = trim($m['name'] ?? '');
                if ($name === '') { continue; }
                $insm->execute([
                    $stagingId,
                    $name,
                    $m['relationship'] ?? '',
                    $m['gender'] ?? null,
                    !empty($m['birth_date']) ? $m['birth_date'] : null,
                    $m['phone'] ?? null,
                    $m['occupation'] ?? null,
                    $m['education'] ?? null,
                    $m['status'] ?? 'Aktif',
                    $m['notes'] ?? null
                ]);
            }
            $success_message = $success_message ? ($success_message.' | Pengajuan perubahan anggota dikirim') : 'Pengajuan perubahan anggota dikirim!';
        } else {
        foreach ($members as $m) {
            $memberId   = isset($m['id']) ? (int)$m['id'] : 0;
            $toDelete   = isset($m['delete']) && (string)$m['delete'] === '1';
            $name       = trim($m['name'] ?? '');
            $relationship = $m['relationship'] ?? '';
            $gender     = $m['gender'] ?? null;
            $birth_date = !empty($m['birth_date']) ? $m['birth_date'] : null;
            $phone      = $m['phone'] ?? null;
            $occupation = $m['occupation'] ?? null;
            $education  = $m['education'] ?? null;
            $status     = $m['status'] ?? 'Aktif';
            $notes      = $m['notes'] ?? null;

            if ($memberId > 0 && $toDelete) {
                $stmt = $conn->prepare("DELETE FROM family_members WHERE id = ? AND family_id = ?");
                $stmt->execute([$memberId, $family_id]);
                continue;
            }
                if ($name === '') { continue; }
            if ($memberId > 0) {
                $stmt = $conn->prepare("UPDATE family_members
                    SET name = ?, relationship = ?, gender = ?, birth_date = ?, phone = ?, occupation = ?, education = ?, status = ?, notes = ?, updated_at = NOW()
                    WHERE id = ? AND family_id = ?");
                $stmt->execute([$name, $relationship, $gender, $birth_date, $phone, $occupation, $education, $status, $notes, $memberId, $family_id]);
            } else {
                $stmt = $conn->prepare("INSERT INTO family_members (tenant_id, family_id, name, relationship, gender, birth_date, phone, occupation, education, status, notes, created_at, updated_at)
                    VALUES (1, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())");
                $stmt->execute([$family_id, $name, $relationship, $gender, $birth_date, $phone, $occupation, $education, $status, $notes]);
            }
        }
        $success_message = $success_message ? ($success_message.' | Anggota tersimpan') : 'Anggota keluarga berhasil disimpan!';
        }
    } catch (Exception $e) {
        $error_message = 'Gagal menyimpan anggota: '.$e->getMessage();
    }
}

// Fetch family members for editing table
$family_members_rows = [];
try {
    $stmt = $conn->prepare("SELECT id, name, relationship, gender, birth_date, phone, occupation, education, status, notes FROM family_members WHERE family_id = ? ORDER BY 
        CASE relationship WHEN 'bapa' THEN 1 WHEN 'ibu' THEN 2 WHEN 'anak' THEN 3 WHEN 'tanggungan' THEN 4 ELSE 5 END, name");
    $stmt->execute([$family_id]);
    $family_members_rows = $stmt->fetchAll(PDO::FETCH_ASSOC);
} catch (Exception $e) {
    // ignore
}

// Get neighborhoods for the church
$neighborhoods = [];
try {
    $stmt = $conn->prepare("SELECT DISTINCT neighborhood FROM families WHERE church_id = ? ORDER BY neighborhood");
    $stmt->execute([$current_church_id ?? 1]);
    $neighborhoods = $stmt->fetchAll(PDO::FETCH_COLUMN);
} catch (Exception $e) {
    // Ignore error
}
?>

<style>
.edit-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.edit-card {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.edit-header {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    text-align: center;
}

.edit-header h1 {
    margin: 0;
    font-size: 1.8em;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #333;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
}

.form-group textarea {
    resize: vertical;
    min-height: 100px;
}

.form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
}

.btn {
    flex: 1;
    padding: 15px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    transition: all 0.3s ease;
}

.btn-primary {
    background: #11998e;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.delete-section {
    margin-top: 40px;
    padding-top: 30px;
    border-top: 2px solid #f0f0f0;
}

.delete-warning {
    background: #fff3cd;
    border-left: 4px solid #ffc107;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
}

.delete-warning p {
    margin: 0;
    color: #856404;
}

.alert {
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.alert-error {
    background: #ffebee;
    color: #c62828;
    border-left: 4px solid #c62828;
}

.alert-success {
    background: #e8f5e9;
    color: #2e7d32;
    border-left: 4px solid #2e7d32;
}

.info-box {
    background: #e3f2fd;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #2196f3;
}

.info-box p {
    margin: 5px 0;
    color: #1565c0;
}

/* Responsive table editing for members */
.table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    border: 1px solid #e1e5e9;
    border-radius: 10px;
    background: #fff;
}
.family-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1100px; /* beri ruang agar input tidak bertumpuk */
}
.family-table th,
.family-table td {
    border: 1px solid #e1e5e9;
    padding: 8px;
    vertical-align: top;
}
.family-table input[type="text"],
.family-table input[type="date"],
.family-table select {
    width: 100%;
    min-width: 160px;
    padding: 8px;
    border: 2px solid #e1e5e9;
    border-radius: 6px;
    font-size: 14px;
    box-sizing: border-box;
}
.family-table td:nth-child(1) {
    min-width: 70px;
    text-align: center;
}
.family-table td:nth-child(2) { min-width: 150px; }
.family-table td:nth-child(3) { min-width: 220px; }
.family-table td:nth-child(4) { min-width: 150px; }
.family-table td:nth-child(5) { min-width: 170px; }
.family-table td:nth-child(6) { min-width: 170px; }
.family-table td:nth-child(7) { min-width: 180px; }
.family-table td:nth-child(8) { min-width: 160px; }
.family-table td:nth-child(9) { min-width: 140px; }
.family-table td:nth-child(10){ min-width: 220px; }

@media (max-width: 768px) {
    .edit-container { padding: 12px; }
    .edit-card { padding: 16px; }
    .family-table { min-width: 900px; }
    .family-table input[type="text"],
    .family-table input[type="date"],
    .family-table select { min-width: 140px; font-size: 13px; padding: 8px; }
}
</style>

<div class="edit-container">
    <div class="edit-header">
        <h1>‚úèÔ∏è Edit Data Keluarga</h1>
        <p>Update informasi keluarga jemaat</p>
    </div>

    <?php if ($error_message): ?>
        <div class="alert alert-error">
            <strong>‚ö†Ô∏è Error:</strong> <?php echo htmlspecialchars($error_message); ?>
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <a href="member_detail" class="btn btn-secondary" style="display: inline-block; width: auto;">
                ‚Üê Kembali ke Daftar Keluarga
            </a>
        </div>
    <?php else: ?>
        
        <?php if ($success_message): ?>
            <div class="alert alert-success">
                <strong>‚úÖ Sukses:</strong> <?php echo htmlspecialchars($success_message); ?>
            </div>
        <?php endif; ?>

        <div class="edit-card">
            <div class="info-box">
                <p><strong>ID Keluarga:</strong> <?php echo htmlspecialchars($family['id']); ?></p>
                <p><strong>Gereja:</strong> <?php echo htmlspecialchars($_SESSION['church_name'] ?? 'GKPI'); ?></p>
            </div>

            <form method="POST" action="" id="familyForm">
                <?php if ($role === 'admin'): ?>
                <input type="hidden" name="submit_all" value="1">
                <?php endif; ?>
                <div class="form-group">
                    <label for="register_number">Nomor Register *</label>
                    <input type="text" id="register_number" name="register_number" 
                           value="<?php echo htmlspecialchars($family['register_number']); ?>" required>
                </div>

                <div class="form-group">
                    <label for="neighborhood">Lingkungan *</label>
                    <select id="neighborhood" name="neighborhood" required>
                        <option value="">-- Pilih Lingkungan --</option>
                        <?php foreach ($neighborhoods as $n): ?>
                            <option value="<?php echo htmlspecialchars($n); ?>" 
                                    <?php echo ($family['neighborhood'] == $n) ? 'selected' : ''; ?>>
                                <?php echo htmlspecialchars($n); ?>
                            </option>
                        <?php endforeach; ?>
                        <option value="other">-- Input Manual --</option>
                    </select>
                </div>

                <div class="form-group" id="manual_neighborhood_group" style="display: none;">
                    <label for="manual_neighborhood">Nama Lingkungan Baru</label>
                    <input type="text" id="manual_neighborhood" name="manual_neighborhood" 
                           placeholder="Masukkan nama lingkungan baru">
                </div>

                <div class="form-group">
                    <label for="family_address">Alamat Keluarga *</label>
                    <textarea id="family_address" name="family_address" required><?php echo htmlspecialchars($family['family_address']); ?></textarea>
                </div>

                <div class="form-group">
                    <label for="father_name">Nama Ayah *</label>
                    <input type="text" id="father_name" name="father_name" 
                           value="<?php echo htmlspecialchars($family['father_name']); ?>" required>
                </div>

                <div class="form-group">
                    <label for="mother_name">Nama Ibu *</label>
                    <input type="text" id="mother_name" name="mother_name" 
                           value="<?php echo htmlspecialchars($family['mother_name']); ?>" required>
                </div>

                <div class="form-group">
                    <label for="head_of_family">Kepala Keluarga *</label>
                    <select id="head_of_family" name="head_of_family" required>
                        <option value="">-- Pilih Kepala Keluarga --</option>
                        <option value="<?php echo htmlspecialchars($family['father_name']); ?>" 
                                <?php echo ($family['head_of_family'] == $family['father_name']) ? 'selected' : ''; ?>>
                            <?php echo htmlspecialchars($family['father_name']); ?> (Ayah)
                        </option>
                        <option value="<?php echo htmlspecialchars($family['mother_name']); ?>" 
                                <?php echo ($family['head_of_family'] == $family['mother_name']) ? 'selected' : ''; ?>>
                            <?php echo htmlspecialchars($family['mother_name']); ?> (Ibu)
                        </option>
                    </select>
                </div>

                <div class="form-actions">
                    <?php if ($role !== 'admin'): ?>
                    <button type="submit" class="btn btn-primary">üíæ Simpan Perubahan</button>
                    <a href="member_detail" class="btn btn-secondary">‚ùå Batal</a>
                    <?php else: ?>
                    <!-- Admin: tombol disatukan di bagian bawah (setelah tabel anggota) -->
                    <a href="member_detail" class="btn btn-secondary">‚ùå Batal</a>
                    <?php endif; ?>
                </div>
            </form>

            <?php if ($role === 'pendeta' || $role === 'ketua' || $role === 'super'): ?>
            <!-- Delete Section -->
            <div class="delete-section">
                <h3 style="color: #dc3545; margin-bottom: 15px;">‚ö†Ô∏è Zona Bahaya</h3>
                <div class="delete-warning">
                    <p><strong>Peringatan:</strong> Menghapus data keluarga ini akan menghapus semua informasi secara permanen dan tidak dapat dikembalikan!</p>
                </div>
                <form method="POST" action="" onsubmit="return confirm('Apakah Anda yakin ingin menghapus data keluarga ini? Tindakan ini tidak dapat dibatalkan!');">
                    <input type="hidden" name="delete_family" value="1">
                    <button type="submit" class="btn btn-danger" style="width: 100%;">
                        üóëÔ∏è Hapus Data Keluarga Ini
                    </button>
                </form>
            </div>
            <?php endif; ?>
        </div>
        <div class="edit-card" style="margin-top:20px;">
            <h2 style="margin-bottom: 15px;">üë• Anggota Keluarga</h2>
            <?php if ($role === 'admin'): ?>
            <div id="membersForm">
            <?php else: ?>
            <form method="POST" action="" id="membersForm">
                <input type="hidden" name="save_members" value="1">
            <?php endif; ?>
                <div class="table-responsive">
                    <table class="family-table" style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Hapus</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Hubungan</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Nama</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Jenis Kelamin</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Tanggal Lahir</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">No HP</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Pekerjaan</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Pendidikan</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Status</th>
                                <th style="border:1px solid #e1e5e9; padding:8px;">Keterangan</th>
                            </tr>
                        </thead>
                        <tbody id="members-body">
                            <?php foreach ($family_members_rows as $idx => $m): ?>
                                <tr>
                                    <td style="border:1px solid #e1e5e9; padding:4px; text-align:center;">
                                        <input type="hidden" name="members[<?php echo $idx; ?>][id]" value="<?php echo (int)$m['id']; ?>">
                                        <input type="checkbox" name="members[<?php echo $idx; ?>][delete]" value="1">
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <select name="members[<?php echo $idx; ?>][relationship]">
                                            <option value="bapa" <?php echo $m['relationship']==='bapa'?'selected':''; ?>>Bapa</option>
                                            <option value="ibu" <?php echo $m['relationship']==='ibu'?'selected':''; ?>>Ibu</option>
                                            <option value="anak" <?php echo $m['relationship']==='anak'?'selected':''; ?>>Anak</option>
                                            <option value="tanggungan" <?php echo $m['relationship']==='tanggungan'?'selected':''; ?>>Tanggungan</option>
                                            <option value="lainnya" <?php echo $m['relationship']==='lainnya'?'selected':''; ?>>Lainnya</option>
                                        </select>
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <input type="text" name="members[<?php echo $idx; ?>][name]" value="<?php echo htmlspecialchars($m['name'] ?? ''); ?>">
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <select name="members[<?php echo $idx; ?>][gender]">
                                            <option value="">-</option>
                                            <option value="Laki-laki" <?php echo ($m['gender']==='Laki-laki')?'selected':''; ?>>Laki-laki</option>
                                            <option value="Perempuan" <?php echo ($m['gender']==='Perempuan')?'selected':''; ?>>Perempuan</option>
                                        </select>
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <input type="date" name="members[<?php echo $idx; ?>][birth_date]" value="<?php echo !empty($m['birth_date']) ? htmlspecialchars($m['birth_date']) : ''; ?>">
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <input type="text" name="members[<?php echo $idx; ?>][phone]" value="<?php echo htmlspecialchars($m['phone'] ?? ''); ?>">
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <input type="text" name="members[<?php echo $idx; ?>][occupation]" value="<?php echo htmlspecialchars($m['occupation'] ?? ''); ?>">
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <input type="text" name="members[<?php echo $idx; ?>][education]" value="<?php echo htmlspecialchars($m['education'] ?? ''); ?>">
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <select name="members[<?php echo $idx; ?>][status]">
                                            <option value="Aktif" <?php echo ($m['status']==='Aktif')?'selected':''; ?>>Aktif</option>
                                            <option value="Pasif" <?php echo ($m['status']==='Pasif')?'selected':''; ?>>Pasif</option>
                                            <option value="Pindah" <?php echo ($m['status']==='Pindah')?'selected':''; ?>>Pindah</option>
                                        </select>
                                    </td>
                                    <td style="border:1px solid #e1e5e9; padding:4px;">
                                        <input type="text" name="members[<?php echo $idx; ?>][notes]" value="<?php echo htmlspecialchars($m['notes'] ?? ''); ?>">
                                    </td>
                                </tr>
                            <?php endforeach; ?>
                            <tr>
                                <td style="border:1px solid #e1e5e9; padding:4px; text-align:center;">+</td>
                                <td style="border:1px solid #e1e5e9; padding:4px;">
                                    <select name="members[new][relationship]">
                                        <option value="">-</option>
                                        <option value="bapa">Bapa</option>
                                        <option value="ibu">Ibu</option>
                                        <option value="anak">Anak</option>
                                        <option value="tanggungan">Tanggungan</option>
                                        <option value="lainnya">Lainnya</option>
                                    </select>
                                </td>
                                <td style="border:1px solid #e1e5e9; padding:4px;"><input type="text" name="members[new][name]"></td>
                                <td style="border:1px solid #e1e5e9; padding:4px;">
                                    <select name="members[new][gender]">
                                        <option value="">-</option>
                                        <option value="Laki-laki">Laki-laki</option>
                                        <option value="Perempuan">Perempuan</option>
                                    </select>
                                </td>
                                <td style="border:1px solid #e1e5e9; padding:4px;"><input type="date" name="members[new][birth_date]"></td>
                                <td style="border:1px solid #e1e5e9; padding:4px;"><input type="text" name="members[new][phone]"></td>
                                <td style="border:1px solid #e1e5e9; padding:4px;"><input type="text" name="members[new][occupation]"></td>
                                <td style="border:1px solid #e1e5e9; padding:4px;"><input type="text" name="members[new][education]"></td>
                                <td style="border:1px solid #e1e5e9; padding:4px;">
                                    <select name="members[new][status]">
                                        <option value="Aktif">Aktif</option>
                                        <option value="Pasif">Pasif</option>
                                        <option value="Pindah">Pindah</option>
                                    </select>
                                </td>
                                <td style="border:1px solid #e1e5e9; padding:4px;"><input type="text" name="members[new][notes]"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <?php if ($role === 'admin'): ?>
                <div class="form-actions">
                    <button type="button" id="submitAllBtn" class="btn btn-primary">üíæ Simpan Pengajuan Data</button>
                </div>
                </div>
                <?php else: ?>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">üíæ Simpan Anggota</button>
                </div>
            </form>
                <?php endif; ?>
        </div>

        <div class="edit-card" style="margin-top:20px;">
            <div class="contributions-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h2 style="margin: 0 0 8px 0; font-size: 1.5em;">üí∞ Dana Bakti Tahunan</h2>
                <p style="margin: 0; opacity: 0.9;">Input nominal per keluarga per tahun. Perubahan disimpan otomatis.</p>
            </div>

            <?php
            $current_year = (int)date('Y');
            $years = range($current_year - 5, $current_year + 2);

            // Ambil kontribusi keluarga dari family_annual_contributions
            $familyContribs = [];
            try {
                $stmt = $conn->prepare("SELECT year, amount FROM family_annual_contributions WHERE family_id = ?");
                $stmt->execute([$family_id]);
                foreach ($stmt->fetchAll(PDO::FETCH_ASSOC) as $r) {
                    $familyContribs[(int)$r['year']] = (int)$r['amount'];
                }
            } catch (Throwable $e) {}
            ?>

            <div class="contributions-container" style="background: #f8fafc; border-radius: 12px; padding: 20px; border: 1px solid #e2e8f0;">
                <div class="family-info-card" style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">
                            <?php echo substr($family['register_number'], -2); ?>
                        </div>
                        <div>
                            <h3 style="margin: 0; color: #1e293b; font-size: 1.2em;"><?php echo htmlspecialchars($family['register_number']); ?></h3>
                            <p style="margin: 4px 0 0 0; color: #64748b; font-size: 0.9em;">Keluarga</p>
                        </div>
                    </div>
                </div>

                <div class="contributions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                    <?php 
                    $rowTotal = 0;
                    foreach ($years as $yy): 
                        $amt = isset($familyContribs[$yy]) ? (int)$familyContribs[$yy] : '';
                        if (is_int($amt)) { $rowTotal += $amt; }
                        $is_current = ($yy === $current_year);
                        $is_past = ($yy < $current_year);
                        $is_future = ($yy > $current_year);
                    ?>
                        <div class="year-card contrib-cell" data-family-id="<?php echo (int)$family_id; ?>" data-year="<?php echo $yy; ?>" 
                             style="background: white; border-radius: 12px; padding: 16px; border: 2px solid <?php echo $is_current ? '#3b82f6' : ($is_past ? '#e5e7eb' : '#f3f4f6'); ?>; 
                                    box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease; <?php echo $is_current ? 'border-color: #3b82f6; background: #eff6ff;' : ''; ?>">
                            
                            <div class="year-header" style="text-align: center; margin-bottom: 12px;">
                                <div style="font-size: 1.1em; font-weight: 600; color: #1e293b; margin-bottom: 4px;">
                                    <?php echo $yy; ?>
                                    <?php if ($is_current): ?>
                                        <span style="background: #3b82f6; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7em; margin-left: 4px;">Tahun Ini</span>
                                    <?php endif; ?>
                                </div>
                                <div style="font-size: 0.8em; color: #64748b;">
                                    <?php echo $is_past ? 'Tahun Lalu' : ($is_future ? 'Tahun Depan' : 'Tahun Berjalan'); ?>
                                </div>
                            </div>

                            <div class="input-container" style="margin-bottom: 12px;">
                                <input type="number" min="0" step="1000" value="<?php echo htmlspecialchars($amt); ?>" 
                                       style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; 
                                              font-size: 1em; text-align: center; transition: all 0.3s ease;
                                              <?php echo $is_current ? 'border-color: #3b82f6; background: #f8fafc;' : ''; ?>"
                                       placeholder="0">
                            </div>

                            <div class="status-container" style="text-align: center;">
                                <div class="status" style="font-size: 0.85em; font-weight: 500;">
                                    <?php if ($amt !== '' && (int)$amt > 0): ?>
                                        <span class="status-paid" style="color: #16a34a; background: #dcfce7; padding: 4px 8px; border-radius: 6px; display: inline-block;">
                                            ‚úÖ Sudah Dibayar
                                        </span>
                                        <div style="margin-top: 4px; font-size: 0.9em; font-weight: 600; color: #16a34a;">
                                            Rp <?php echo number_format($amt, 0, ',', '.'); ?>
                                        </div>
                                    <?php else: ?>
                                        <span class="status-unpaid" style="color: #dc2626; background: #fef2f2; padding: 4px 8px; border-radius: 6px; display: inline-block;">
                                            ‚ùå Belum Dibayar
                                        </span>
                                    <?php endif; ?>
                                </div>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>

                <div class="total-summary" style="background: linear-gradient(135deg, #10b981, #059669); color: white; border-radius: 12px; padding: 20px; margin-top: 20px; text-align: center;">
                    <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 4px;">Total Kontribusi</div>
                    <div style="font-size: 1.8em; font-weight: 700;">Rp <?php echo number_format($rowTotal, 0, ',', '.'); ?></div>
                </div>
            </div>

            <script>
            (function(){
                const cells = document.querySelectorAll('.contrib-cell');
                cells.forEach(function(cell){
                    const input = cell.querySelector('input[type="number"]');
                    const statusBox = cell.querySelector('.status');
                    if (!input) return;
                    
                    input.addEventListener('change', function(){
                        const familyId = parseInt(cell.getAttribute('data-family-id') || '0', 10);
                        const year = parseInt(cell.getAttribute('data-year') || '0', 10);
                        const amount = this.value;
                        if (!familyId || !year) return;

                        // Loading state
                        statusBox.innerHTML = '<span style="color: #6b7280;">‚è≥ Menyimpan...</span>';

                        fetch('save_contribution.php', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                            body: 'family_id=' + encodeURIComponent(familyId) + '&year=' + encodeURIComponent(year) + '&amount=' + encodeURIComponent(amount)
                        }).then(res => res.text()).then(txt => {
                            if (txt === 'Saved') {
                                if (amount && parseInt(amount,10) > 0) {
                                    statusBox.innerHTML = '<span class="status-paid" style="color: #16a34a; background: #dcfce7; padding: 4px 8px; border-radius: 6px; display: inline-block;">‚úÖ Sudah Dibayar</span>' +
                                                         '<div style="margin-top: 4px; font-size: 0.9em; font-weight: 600; color: #16a34a;">Rp ' + parseInt(amount).toLocaleString('id-ID') + '</div>';
                                } else {
                                    statusBox.innerHTML = '<span class="status-unpaid" style="color: #dc2626; background: #fef2f2; padding: 4px 8px; border-radius: 6px; display: inline-block;">‚ùå Belum Dibayar</span>';
                                }
                                
                                // Update total
                                updateTotal();
                            }
                        }).catch(()=>{
                            statusBox.innerHTML = '<span style="color: #dc2626;">‚ùå Error</span>';
                        });
                    });
                });
                
                function updateTotal() {
                    let total = 0;
                    document.querySelectorAll('.contrib-cell input[type="number"]').forEach(input => {
                        const val = parseInt(input.value) || 0;
                        total += val;
                    });
                    
                    const totalElement = document.querySelector('.total-summary div:last-child');
                    if (totalElement) {
                        totalElement.textContent = 'Rp ' + total.toLocaleString('id-ID');
                    }
                }
            })();
            </script>
        </div>

    <?php endif; ?>
</div>

<script>
// Auto-update head of family options when names change
document.getElementById('father_name').addEventListener('input', updateHeadOptions);
document.getElementById('mother_name').addEventListener('input', updateHeadOptions);

function updateHeadOptions() {
    const fatherName = document.getElementById('father_name').value;
    const motherName = document.getElementById('mother_name').value;
    const headSelect = document.getElementById('head_of_family');
    const currentValue = headSelect.value;
    
    headSelect.innerHTML = `
        <option value="">-- Pilih Kepala Keluarga --</option>
        <option value="${fatherName}" ${currentValue === fatherName ? 'selected' : ''}>${fatherName} (Ayah)</option>
        <option value="${motherName}" ${currentValue === motherName ? 'selected' : ''}>${motherName} (Ibu)</option>
    `;
}

// Handle manual neighborhood input
document.getElementById('neighborhood').addEventListener('change', function() {
    const manualGroup = document.getElementById('manual_neighborhood_group');
    const manualInput = document.getElementById('manual_neighborhood');
    
    if (this.value === 'other') {
        manualGroup.style.display = 'block';
        manualInput.required = true;
    } else {
        manualGroup.style.display = 'none';
        manualInput.required = false;
    }
});

// Update neighborhood value before submit if manual input is used
document.querySelector('form').addEventListener('submit', function(e) {
    const neighborhoodSelect = document.getElementById('neighborhood');
    const manualInput = document.getElementById('manual_neighborhood');
    
    if (neighborhoodSelect.value === 'other' && manualInput.value) {
        // Create a hidden input with the manual neighborhood value
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'neighborhood';
        hiddenInput.value = manualInput.value;
        this.appendChild(hiddenInput);
        
        // Disable the select so it doesn't submit
        neighborhoodSelect.disabled = true;
    }
});
</script>

<?php
include 'footer.php';
?>

<script>
// Admin: gabungkan isian anggota ke form utama sebelum submit
(function(){
    var submitBtn = document.getElementById('submitAllBtn');
    if (!submitBtn) return;
    submitBtn.addEventListener('click', function(){
        try {
            var familyForm = document.getElementById('familyForm');
            var membersContainer = document.getElementById('membersForm');
            if (!familyForm || !membersContainer) { familyForm.submit(); return; }

            // Pastikan flag submit_all ikut
            var flag = familyForm.querySelector('input[name="submit_all"]');
            if (!flag) {
                flag = document.createElement('input');
                flag.type = 'hidden';
                flag.name = 'submit_all';
                flag.value = '1';
                familyForm.appendChild(flag);
            } else {
                flag.value = '1';
            }

            // Ambil semua input/select/textarea dalam tabel anggota dan replikasikan ke familyForm
            var fields = membersContainer.querySelectorAll('input, select, textarea');
            fields.forEach(function(el){
                if (!el.name) return;
                // Lewati tombol/hidden yang bukan anggota
                if (el.type === 'button' || el.type === 'submit') return;
                var clone = document.createElement('input');
                clone.type = 'hidden';
                clone.name = el.name;
                clone.value = (el.type === 'checkbox') ? (el.checked ? (el.value || '1') : '') : el.value;
                familyForm.appendChild(clone);
            });

            familyForm.submit();
        } catch (e) {
            console.error('Submit gabungan gagal:', e);
            document.getElementById('familyForm').submit();
        }
    });
})();
</script>



================================================================================
===== C:/xampp/htdocs/jemaat\item_detail.php =====
================================================================================

<?php
session_start();
require_once 'config/config.php';
require_once 'config/url_helper.php';
require_once 'config/multi_tenant.php';

// Initialize multi-tenant
MultiTenant::initialize();

$page_title = 'Detail Anggota Keluarga - Jemaat App';

// Get family ID from URL
$family_id = isset($_GET['id']) ? (int)$_GET['id'] : 0;

if (!$family_id) {
    header("Location: index.php");
    exit();
}

try {
    $conn = getDB();

// Age calculation functions
function getAgeFromBirthDate($birth_date) {
    if (!$birth_date) return 'Tidak diketahui';

    $birth = new DateTime($birth_date);
    $today = new DateTime();
    $age = $today->diff($birth)->y;

    return $age;
}

function getAgeGroup($age) {
    if ($age === 'Tidak diketahui') return $age;

    if ($age <= 12) return 'Anak (0-12)';
    if ($age <= 17) return 'Remaja (13-17)';
    if ($age <= 25) return 'Pemuda (18-25)';
    if ($age <= 45) return 'Dewasa Muda (26-45)';
    if ($age <= 65) return 'Dewasa (46-65)';
    return 'Lansia (65+)';
}

// Get family information from families table
$family_sql = "SELECT * FROM families WHERE id = ?";
    
    $stmt = $conn->prepare($family_sql);
    $stmt->execute([$family_id]);
    $member = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$member) {
        throw new Exception('Data keluarga tidak ditemukan');
    }

    // Get all family members from different tables
    $family_members = [];
    
    // Add father if exists (from families table - simplified)
    if (!empty($member['father_name'])) {
        $family_members[] = [
            'relation' => 'Bapa',
            'sort_order' => 1,
            'name' => $member['father_name'],
            'gender' => 'Laki-laki',
            'birth_date' => null,
            'baptism_date' => null,
            'confirmation_date' => null,
            'marriage_date' => null,
            'death_date' => null,
            'phone' => null,
            'occupation' => null,
            'education' => null,
            'notes' => 'Detail dapat ditambahkan melalui form edit',
            'status' => 'active',
            'is_alive' => 1
        ];
    }
    
    // Add mother if exists (from families table - simplified)
    if (!empty($member['mother_name'])) {
        $family_members[] = [
            'relation' => 'Ibu',
            'sort_order' => 2,
            'name' => $member['mother_name'],
            'gender' => 'Perempuan',
            'birth_date' => null,
            'baptism_date' => null,
            'confirmation_date' => null,
            'marriage_date' => null,
            'death_date' => null,
            'phone' => null,
            'occupation' => null,
            'education' => null,
            'notes' => 'Detail dapat ditambahkan melalui form edit',
            'status' => 'active',
            'is_alive' => 1
        ];
    }

    // Get children from children table
    $children_query = "SELECT name, birth_date, gender, phone, occupation, education, death_date 
                       FROM children 
                       WHERE family_id = ? 
                       ORDER BY birth_date";
    $stmt = $conn->prepare($children_query);
    $stmt->execute([$family_id]);
    $children = $stmt->fetchAll(PDO::FETCH_ASSOC);
    
    foreach ($children as $child) {
        $family_members[] = [
            'relation' => 'Anak',
            'sort_order' => 3,
            'name' => $child['name'],
            'gender' => $child['gender'] ?? 'Tidak diketahui',
            'birth_date' => $child['birth_date'],
            'baptism_date' => null,
            'confirmation_date' => null,
            'marriage_date' => null,
            'death_date' => $child['death_date'],
            'phone' => $child['phone'],
            'occupation' => $child['occupation'],
            'education' => $child['education'],
            'notes' => null,
            'status' => 'active',
            'is_alive' => empty($child['death_date']) || $child['death_date'] > date('Y-m-d') ? 1 : 0
        ];
    }

    // Get dependents/guardians from guardians table
    $dependents_query = "SELECT name, birth_date, gender, phone, occupation, education, death_date 
                         FROM guardians 
                         WHERE family_id = ? 
                         ORDER BY birth_date";
    $stmt = $conn->prepare($dependents_query);
    $stmt->execute([$family_id]);
    $dependents = $stmt->fetchAll(PDO::FETCH_ASSOC);
    
    foreach ($dependents as $dependent) {
        $family_members[] = [
            'relation' => 'Tanggungan',
            'sort_order' => 4,
            'name' => $dependent['name'],
            'gender' => $dependent['gender'] ?? 'Tidak diketahui',
            'birth_date' => $dependent['birth_date'],
            'baptism_date' => null,
            'confirmation_date' => null,
            'marriage_date' => null,
            'death_date' => $dependent['death_date'],
            'phone' => $dependent['phone'],
            'occupation' => $dependent['occupation'],
            'education' => $dependent['education'],
            'notes' => null,
            'status' => 'active',
            'is_alive' => empty($dependent['death_date']) || $dependent['death_date'] > date('Y-m-d') ? 1 : 0
        ];
    }

    // Get contributions (contributions may not exist for all families)
    $contributions = [];
    // Skip contributions for now as we're using simplified structure

    // Determine head of family
    if (!empty($member['head_of_family'])) {
        $is_father = ($member['head_of_family'] == $member['father_name']);
        $head_family = [
            'name' => $member['head_of_family'],
            'relationship' => $is_father ? 'Ayah' : 'Ibu',
            'is_alive' => true
        ];
    } elseif (!empty($member['father_name'])) {
        $head_family = [
            'name' => $member['father_name'],
            'relationship' => 'Ayah',
            'is_alive' => true
        ];
    } else {
        $head_family = [
            'name' => $member['mother_name'] ?? 'Tidak diketahui',
            'relationship' => 'Ibu',
            'is_alive' => true
        ];
    }

} catch (Exception $e) {
    error_log("Error in item_detail.php: " . $e->getMessage());
    die("Terjadi kesalahan: " . $e->getMessage());
}

include 'header.php';
?>

<div class="form-container">
    <h1>Detail Anggota Keluarga</h1>

    <!-- Search Box -->
    <div class="search-box" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 20px;">
        <div style="display: flex; gap: 15px; align-items: center;">
            <input type="text" id="searchInput" placeholder="üîç Cari nama, pekerjaan, pendidikan, tanggal, atau informasi lainnya..." 
                   style="flex: 1; padding: 12px 20px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 16px; transition: all 0.3s ease;"
                   onkeyup="searchMemberDetails()"
                   onfocus="this.style.borderColor='#11998e'; this.style.boxShadow='0 0 0 3px rgba(17, 153, 142, 0.1)';"
                   onblur="this.style.borderColor='#e1e5e9'; this.style.boxShadow='none';">
            <button onclick="clearSearch()" style="padding: 12px 20px; background: #6c757d; color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600;">
                ‚ùå Clear
            </button>
        </div>
        <div id="searchInfo" style="margin-top: 10px; color: #666; font-size: 0.9em; display: none;"></div>
    </div>

    <!-- Family Info Card -->
    <div class="form-card">
        <div class="card-header">
            <h4>üìã Informasi Keluarga</h4>
        </div>
        
        <div class="form-grid">
            <div class="form-group">
                <label>No Registrasi</label>
                <div class="info-display"><?php echo htmlspecialchars($member['register_number']); ?></div>
            </div>
            <div class="form-group">
                <label>Lingkungan</label>
                <div class="info-display"><?php echo htmlspecialchars($member['neighborhood']); ?></div>
            </div>
        </div>

        <div class="form-group">
            <label>Alamat Keluarga</label>
            <div class="info-display"><?php echo htmlspecialchars($member['family_address']); ?></div>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label>Kepala Keluarga</label>
                <div class="info-display <?php echo !$head_family['is_alive'] ? 'deceased' : ''; ?>">
                    <?php echo htmlspecialchars($head_family['name']); ?> (<?php echo $head_family['relationship']; ?>)
                    <?php if (!$head_family['is_alive']): ?>
                        <span class="status-deceased"> - Telah Meninggal</span>
                    <?php endif; ?>
                </div>
            </div>
            <div class="form-group">
                <label>Status Keluarga</label>
                <div class="info-display">
                    <span class="status-badge <?php echo $head_family['is_alive'] ? 'status-alive' : 'status-deceased'; ?>">
                        <?php echo $head_family['is_alive'] ? 'Aktif' : 'Tidak Aktif'; ?>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Family Members Card -->
    <div class="form-card">
        <div class="card-header">
            <h4>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Data Anggota Keluarga</h4>
        </div>

        <?php if (!empty($family_members)): ?>
            <div class="family-members-grid">
                <?php foreach ($family_members as $member_data): ?>
                    <?php
                    $is_deceased = !$member_data['is_alive'] || $member_data['death_date'];
                    $relation_class = strtolower(str_replace(' ', '-', $member_data['relation']));
                    ?>
                    <div class="member-card <?php echo $relation_class; ?> <?php echo $is_deceased ? 'deceased' : ''; ?>">
                        <div class="member-header">
                            <h5><?php echo htmlspecialchars($member_data['relation']); ?></h5>
                            <?php if ($is_deceased): ?>
                                <span class="status-deceased">Meninggal</span>
                            <?php endif; ?>
                        </div>
                        
                        <div class="member-info">
                            <div class="member-name"><?php echo htmlspecialchars($member_data['name']); ?></div>
                            
                            <div class="member-details">
                                <div class="detail-item">
                                    <span class="detail-label">Jenis Kelamin:</span>
                                    <span class="detail-value"><?php echo htmlspecialchars($member_data['gender']); ?></span>
                                </div>
                                
                                <?php if ($member_data['birth_date']): ?>
                                <div class="detail-item">
                                    <span class="detail-label">Tanggal Lahir:</span>
                                    <span class="detail-value"><?php echo date('d/m/Y', strtotime($member_data['birth_date'])); ?></span>
                                </div>
                                <?php endif; ?>

                                <?php if ($member_data['phone']): ?>
                                <div class="detail-item">
                                    <span class="detail-label">No HP:</span>
                                    <span class="detail-value"><?php echo htmlspecialchars($member_data['phone']); ?></span>
                                </div>
                                <?php endif; ?>

                                <?php if ($member_data['occupation']): ?>
                                <div class="detail-item">
                                    <span class="detail-label">Pekerjaan:</span>
                                    <span class="detail-value"><?php echo htmlspecialchars($member_data['occupation']); ?></span>
                                </div>
                                <?php endif; ?>

                                <?php if ($member_data['education']): ?>
                                <div class="detail-item">
                                    <span class="detail-label">Pendidikan:</span>
                                    <span class="detail-value"><?php echo htmlspecialchars($member_data['education']); ?></span>
                                </div>
                                <?php endif; ?>
                            </div>

                            <!-- Religious Events -->
                            <div class="religious-events">
                                <?php if ($member_data['baptism_date']): ?>
                                <div class="event-item">
                                    <span class="event-icon">üíí</span>
                                    <span class="event-text">Baptis: <?php echo date('d/m/Y', strtotime($member_data['baptism_date'])); ?></span>
                                </div>
                                <?php endif; ?>

                                <?php if ($member_data['confirmation_date']): ?>
                                <div class="event-item">
                                    <span class="event-icon">‚õ™</span>
                                    <span class="event-text">Sidi: <?php echo date('d/m/Y', strtotime($member_data['confirmation_date'])); ?></span>
                                </div>
                                <?php endif; ?>

                                <?php if ($member_data['marriage_date']): ?>
                                <div class="event-item">
                                    <span class="event-icon">üíç</span>
                                    <span class="event-text">Menikah: <?php echo date('d/m/Y', strtotime($member_data['marriage_date'])); ?></span>
                                </div>
                                <?php endif; ?>

                                <?php if ($member_data['death_date']): ?>
                                <div class="event-item">
                                    <span class="event-icon">üïäÔ∏è</span>
                                    <span class="event-text">Meninggal: <?php echo date('d/m/Y', strtotime($member_data['death_date'])); ?></span>
                                </div>
                                <?php endif; ?>
                            </div>

                            <?php if ($member_data['notes']): ?>
                            <div class="member-notes">
                                <strong>Keterangan:</strong> <?php echo nl2br(htmlspecialchars($member_data['notes'])); ?>
                            </div>
                            <?php endif; ?>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>
        <?php else: ?>
            <div class="empty-state">
                <p>Tidak ada data anggota keluarga</p>
            </div>
        <?php endif; ?>
    </div>

    <!-- Contributions Card -->
    <div class="form-card">
        <div class="card-header">
            <h4>üí∞ Data Bakti Tahunan</h4>
        </div>

        <div class="contributions-summary">
            <div class="summary-item">
                <span class="summary-label">Total Dibayar:</span>
                <span class="summary-value">Rp <?php echo number_format(array_sum(array_filter($contributions)), 0, ',', '.'); ?></span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Tahun Aktif:</span>
                <span class="summary-value"><?php echo count(array_filter($contributions)); ?> tahun</span>
            </div>
        </div>

        <div class="contributions-table-container">
            <table class="contributions-table">
                <thead>
                    <tr>
                        <th>Tahun</th>
                        <th>Jumlah (Rp)</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <?php
                    $current_year = date('Y');
                    for ($year = $current_year - 5; $year <= $current_year + 2; $year++) {
                        $amount = isset($contributions[$year]) ? $contributions[$year] : '';
                        $is_paid = !empty($amount);
                        $is_current_year = $year == $current_year;
                        ?>
                        <tr class="<?php echo $is_current_year ? 'current-year' : ''; ?>">
                            <td class="year-cell">
                                <?php echo $year; ?>
                                <?php if ($is_current_year): ?>
                                    <span class="current-year-label">Tahun Ini</span>
                                <?php endif; ?>
                            </td>
                            <td class="amount-cell">
                                <input type="number"
                                       step="0.01"
                                       value="<?php echo $amount; ?>"
                                       data-year="<?php echo $year; ?>"
                                       onchange="saveContribution(<?php echo $member_id; ?>, <?php echo $year; ?>, this.value)"
                                       placeholder="0"
                                       class="amount-input">
                            </td>
                            <td class="status-cell">
                                <?php if ($is_paid): ?>
                                    <span class="status-paid">Sudah Dibayar</span>
                                <?php else: ?>
                                    <span class="status-unpaid">Belum Dibayar</span>
                                <?php endif; ?>
                            </td>
                        </tr>
                    <?php } ?>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="step-buttons">
        <a href="<?php echo url('member_detail'); ?>" class="btn btn-primary">Kembali ke Daftar Keluarga</a>
    </div>
</div>

<style>
/* Form Container Styles */
.form-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    font-family: "Google Sans", "Roboto", Arial, sans-serif;
}

.form-container h1 {
    text-align: center;
    color: #202124;
    margin-bottom: 30px;
    font-size: 2.5em;
    font-weight: 700;
}

/* Form Card Styles */
.form-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 25px;
    overflow: hidden;
    border: 1px solid #dadce0;
}

.card-header {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 20px;
    border-bottom: none;
}

.card-header h4 {
    margin: 0;
    font-size: 1.3em;
    font-weight: 600;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    padding: 25px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    font-weight: 600;
    color: #555;
    margin-bottom: 8px;
    font-size: 0.9em;
}

.info-display {
    background: #f8f9fa;
    padding: 12px 15px;
    border-radius: 8px;
    border: 1px solid #e1e5e9;
    color: #333;
    font-size: 1em;
}

.info-display.deceased {
    color: #dc3545;
    text-decoration: line-through;
}

.status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 600;
}

.status-alive {
    background: #d4edda;
    color: #155724;
}

.status-deceased {
    background: #f8d7da;
    color: #721c24;
}

/* Family Members Grid */
.family-members-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    padding: 25px;
}

.member-card {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    border: 2px solid #e1e5e9;
    transition: all 0.3s ease;
}

.member-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.member-card.deceased {
    background: #f8f9fa;
    color: #6c757d;
    border-color: #dee2e6;
}

.member-card.bapa {
    border-left: 4px solid #11998e;
}

.member-card.ibu {
    border-left: 4px solid #e83e8c;
}

.member-card.anak {
    border-left: 4px solid #6f42c1;
}

.member-card.tanggungan {
    border-left: 4px solid #ffc107;
}

.member-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.member-header h5 {
    margin: 0;
    color: #11998e;
    font-size: 1.1em;
    font-weight: 600;
}

.member-name {
    font-size: 1.2em;
    font-weight: 700;
    color: #333;
    margin-bottom: 15px;
}

.member-details {
    margin-bottom: 15px;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    padding: 5px 0;
    border-bottom: 1px solid #e9ecef;
}

.detail-label {
    font-weight: 600;
    color: #555;
    font-size: 0.9em;
}

.detail-value {
    color: #333;
    text-align: right;
}

.religious-events {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
}

.event-item {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    font-size: 0.9em;
}

.event-icon {
    margin-right: 10px;
    font-size: 1.2em;
}

.event-text {
    color: #555;
}

.member-notes {
    background: #e3f2fd;
    padding: 12px;
    border-radius: 8px;
    border-left: 4px solid #2196f3;
    font-size: 0.9em;
    color: #555;
}

/* Contributions Styles */
.contributions-summary {
    display: flex;
    justify-content: space-around;
    background: #f8f9fa;
    padding: 20px;
    margin: 25px;
    border-radius: 10px;
    border-left: 4px solid #11998e;
}

.summary-item {
    text-align: center;
}

.summary-label {
    display: block;
    font-size: 0.9em;
    color: #666;
    margin-bottom: 5px;
}

.summary-value {
    display: block;
    font-size: 1.5em;
    font-weight: 700;
    color: #11998e;
}

.contributions-table-container {
    padding: 0 25px 25px;
    overflow-x: auto;
}

.contributions-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.contributions-table th {
    background: #11998e;
    color: white;
    padding: 15px;
    text-align: center;
    font-weight: 600;
}

.contributions-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #e9ecef;
    text-align: center;
}

.contributions-table tr.current-year {
    background: #fff3cd;
}

.year-cell {
    font-weight: 600;
}

.current-year-label {
    display: block;
    font-size: 0.7em;
    color: #856404;
    margin-top: 2px;
}

.amount-input {
    width: 120px;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    text-align: center;
}

.status-paid {
    color: #28a745;
    font-weight: 600;
}

.status-unpaid {
    color: #dc3545;
    font-weight: 600;
}

/* Step Buttons */
.step-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 30px;
}

.btn {
    padding: 12px 25px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: #11998e;
    color: white;
    border: 1px solid #11998e;
}

.btn-primary:hover {
    background: #0d7d73;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 40px;
    color: #666;
}

.empty-state p {
    margin: 0;
    font-size: 1.1em;
}

/* Responsive Design */
@media (max-width: 768px) {
    .form-container {
        padding: 10px;
    }

    .form-grid {
        grid-template-columns: 1fr;
        padding: 15px;
    }

    .family-members-grid {
        grid-template-columns: 1fr;
        padding: 15px;
    }

    .contributions-summary {
        flex-direction: column;
        gap: 15px;
    }

    .step-buttons {
        flex-direction: column;
    }

    .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
function saveContribution(memberId, year, amount) {
    fetch('save_contribution.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'member_id=' + memberId + '&year=' + year + '&amount=' + amount
    })
    .then(response => response.text())
    .then(data => {
        console.log('Contribution saved:', data);
        if (data === 'Saved') {
            const statusCell = document.querySelector(`[data-year="${year}"]`).closest('tr').querySelector('.status-cell');
            if (amount && amount !== '') {
                statusCell.innerHTML = '<span class="status-paid">Sudah Dibayar</span>';
            } else {
                statusCell.innerHTML = '<span class="status-unpaid">Belum Dibayar</span>';
            }
        }
    })
    .catch(error => console.error('Error:', error));
}

// Search functionality
function searchMemberDetails() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const searchInfo = document.getElementById('searchInfo');
    
    // Get all searchable elements
    const searchableElements = document.querySelectorAll('.info-display, .detail-value, .member-name, .detail-item');
    
    let foundCount = 0;
    let visibleCards = new Set();
    
    // Reset all highlights and visibility
    searchableElements.forEach(element => {
        element.style.backgroundColor = '';
        element.style.transition = 'background-color 0.3s ease';
    });
    
    // Get all member cards
    const memberCards = document.querySelectorAll('.member-card');
    
    if (searchTerm === '') {
        // Show all if search is empty
        memberCards.forEach(card => {
            card.style.display = '';
        });
        searchInfo.style.display = 'none';
        return;
    }
    
    // Search and highlight
    searchableElements.forEach(element => {
        const text = element.textContent.toLowerCase();
        const card = element.closest('.member-card, .form-card');
        
        if (text.includes(searchTerm)) {
            // Highlight found text
            element.style.backgroundColor = '#fff3cd';
            foundCount++;
            
            // Mark card as visible
            if (card) {
                visibleCards.add(card);
            }
        }
    });
    
    // Show/hide member cards based on search
    memberCards.forEach(card => {
        if (visibleCards.has(card)) {
            card.style.display = '';
            // Scroll to first result
            if (foundCount === 1) {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        } else {
            card.style.display = 'none';
        }
    });
    
    // Update search info
    if (foundCount > 0) {
        searchInfo.textContent = `‚úÖ Ditemukan ${foundCount} hasil untuk "${document.getElementById('searchInput').value}"`;
        searchInfo.style.color = '#28a745';
    } else {
        searchInfo.textContent = `‚ùå Tidak ada hasil untuk "${document.getElementById('searchInput').value}"`;
        searchInfo.style.color = '#dc3545';
    }
    searchInfo.style.display = 'block';
}

// Clear search
function clearSearch() {
    document.getElementById('searchInput').value = '';
    searchMemberDetails();
}

// Add keyboard shortcut (Ctrl+F or Cmd+F to focus search)
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault();
        document.getElementById('searchInput').focus();
    }
    
    // ESC to clear search
    if (e.key === 'Escape') {
        clearSearch();
    }
});
</script>

<style>
/* Search highlight animation */
@keyframes highlightPulse {
    0%, 100% { background-color: #fff3cd; }
    50% { background-color: #ffeaa7; }
}

.info-display[style*="background-color: rgb(255, 243, 205)"],
.detail-value[style*="background-color: rgb(255, 243, 205)"] {
    animation: highlightPulse 2s ease-in-out infinite;
    padding: 4px 8px;
    border-radius: 4px;
}

/* Search box responsive */
@media (max-width: 768px) {
    .search-box > div {
        flex-direction: column !important;
    }
    
    .search-box button {
        width: 100%;
    }
}
</style>

<?php include 'footer.php'; ?>

================================================================================
===== C:/xampp/htdocs/jemaat\save_contribution.php =====
================================================================================

<?php
require_once __DIR__ . '/config/config.php';

// Hanya izinkan POST (AJAX/non-AJAX)
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    http_response_code(405);
    echo 'Method Not Allowed';
    exit;
}

// Cek sesi login
if (!isset($_SESSION['user_id'])) {
    http_response_code(401);
    echo 'Unauthorized';
    exit;
}

// Ambil input
$familyId = isset($_POST['family_id']) ? (int)$_POST['family_id'] : 0;
$year     = isset($_POST['year']) ? (int)$_POST['year'] : 0;
$amount   = isset($_POST['amount']) && $_POST['amount'] !== '' ? (int)$_POST['amount'] : null;

if ($familyId <= 0 || $year <= 0) {
    http_response_code(400);
    echo 'Bad Request';
    exit;
}

try {
    $conn = getDB();

    // Pastikan family ada
    $chk = $conn->prepare('SELECT id FROM families WHERE id = ? LIMIT 1');
    $chk->execute([$familyId]);
    if (!$chk->fetchColumn()) {
        http_response_code(404);
        echo 'Family Not Found';
        exit;
    }

    if ($amount === null || $amount <= 0) {
        // Hapus jika amount kosong/0
        $del = $conn->prepare('DELETE FROM family_annual_contributions WHERE family_id = ? AND year = ?');
        $del->execute([$familyId, $year]);
    } else {
        // Upsert
        $up = $conn->prepare('INSERT INTO family_annual_contributions (family_id, year, amount) VALUES (?, ?, ?) 
                              ON DUPLICATE KEY UPDATE amount = VALUES(amount)');
        $up->execute([$familyId, $year, $amount]);
    }

    header('Content-Type: text/plain; charset=utf-8');
    echo 'Saved';
} catch (Throwable $e) {
    http_response_code(500);
    echo 'Error';
}
?>



================================================================================
===== C:/xampp/htdocs/jemaat\config\config.php =====
================================================================================

<?php
/**
 * Main Application Configuration
 * Includes all configuration files and defines global constants
 */

// Define application constants
define('APP_NAME', 'Jemaat App');
define('APP_VERSION', '2.0.0');
define('APP_ENV', getenv('APP_ENV') ?: 'development');

// Define paths
define('ROOT_DIR', dirname(__DIR__));
define('CONFIG_DIR', __DIR__);
define('LOGS_DIR', ROOT_DIR . '/logs');
define('UPLOADS_DIR', ROOT_DIR . '/uploads');
define('BACKUPS_DIR', ROOT_DIR . '/backups');

// Define security constants
define('CSRF_TOKEN_LENGTH', 32);
define('SESSION_LIFETIME', 7200); // 2 hours (increased from 1 hour)
define('RATE_LIMIT_WINDOW', 900); // 15 minutes
define('MAX_LOGIN_ATTEMPTS', 5);
define('BLOCK_DURATION', 1800); // 30 minutes

// Session settings will be configured in session_start() calls

// Define file upload constants
define('MAX_FILE_SIZE', 5 * 1024 * 1024); // 5MB
define('ALLOWED_FILE_TYPES', ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf']);
define('ALLOWED_EXTENSIONS', ['jpg', 'jpeg', 'png', 'gif', 'pdf']);

// Define database constants
define('DB_HOST', getenv('DB_HOST') ?: 'localhost');
define('DB_NAME', getenv('DB_NAME') ?: 'jemaat_db');
define('DB_USER', getenv('DB_USER') ?: 'jemaat_user');
define('DB_PASS', getenv('DB_PASS') ?: 'secure_password_2024');
define('DB_CHARSET', 'utf8mb4');

// Define email constants (for future use)
define('SMTP_HOST', getenv('SMTP_HOST') ?: 'smtp.gmail.com');
define('SMTP_PORT', getenv('SMTP_PORT') ?: 587);
define('SMTP_USER', getenv('SMTP_USER') ?: '');
define('SMTP_PASS', getenv('SMTP_PASS') ?: '');
define('FROM_EMAIL', getenv('FROM_EMAIL') ?: 'noreply@jemaatapp.com');
define('FROM_NAME', getenv('FROM_NAME') ?: 'Jemaat App');

// Include all configuration files in the correct order
require_once CONFIG_DIR . '/error_handler.php';     // Must be first for error handling
require_once CONFIG_DIR . '/session_config.php';    // Session management
require_once CONFIG_DIR . '/database.php';          // Database connection
require_once CONFIG_DIR . '/rate_limiter.php';      // Rate limiting
require_once CONFIG_DIR . '/logger.php';            // Logging system
require_once CONFIG_DIR . '/multi_tenant.php';      // Multi-tenant configuration
require_once ROOT_DIR . '/backup.php';            // Database backup functionality

/**
 * Initialize application
 * This function should be called at the beginning of every PHP script
 */
function initApplication() {
    // Start secure session
    if (function_exists('startSecureSession')) {
        startSecureSession();
    }

    // Log application start
    LogManager::info('Application initialized', [
        'version' => APP_VERSION,
        'environment' => APP_ENV,
        'user_agent' => $_SERVER['HTTP_USER_AGENT'] ?? 'unknown',
        'request_uri' => $_SERVER['REQUEST_URI'] ?? 'unknown'
    ]);
}

/**
 * Get application configuration
 * @return array Application configuration array
 */
function getAppConfig() {
    return [
        'name' => APP_NAME,
        'version' => APP_VERSION,
        'environment' => APP_ENV,
        'paths' => [
            'root' => ROOT_DIR,
            'config' => CONFIG_DIR,
            'logs' => LOGS_DIR,
            'uploads' => UPLOADS_DIR,
            'backups' => BACKUPS_DIR
        ],
        'security' => [
            'csrf_token_length' => CSRF_TOKEN_LENGTH,
            'session_lifetime' => SESSION_LIFETIME,
            'rate_limit_window' => RATE_LIMIT_WINDOW,
            'max_login_attempts' => MAX_LOGIN_ATTEMPTS,
            'block_duration' => BLOCK_DURATION
        ],
        'uploads' => [
            'max_file_size' => MAX_FILE_SIZE,
            'allowed_types' => ALLOWED_FILE_TYPES,
            'allowed_extensions' => ALLOWED_EXTENSIONS
        ],
        'database' => [
            'host' => DB_HOST,
            'name' => DB_NAME,
            'user' => DB_USER,
            'charset' => DB_CHARSET
        ],
        'email' => [
            'smtp_host' => SMTP_HOST,
            'smtp_port' => SMTP_PORT,
            'from_email' => FROM_EMAIL,
            'from_name' => FROM_NAME
        ]
    ];
}

/**
 * Check if application is in production mode
 * @return bool True if in production
 */
function isProduction() {
    return APP_ENV === 'production';
}

/**
 * Check if application is in development mode
 * @return bool True if in development
 */
function isDevelopment() {
    return APP_ENV === 'development';
}

/**
 * Get current timestamp in MySQL format
 * @return string Current timestamp
 */
function now() {
    return date('Y-m-d H:i:s');
}

/**
 * Generate a secure random string
 * @param int $length Length of the string
 * @return string Random string
 */
function generateSecureToken($length = 32) {
    return bin2hex(random_bytes($length / 2));
}

/**
 * Clean and validate input data
 * @param mixed $data Input data
 * @param string $type Validation type (email, url, int, float, string)
 * @return mixed Cleaned data or false on validation failure
 */
function cleanInput($data, $type = 'string') {
    switch ($type) {
        case 'email':
            $cleaned = filter_var($data, FILTER_SANITIZE_EMAIL);
            return filter_var($cleaned, FILTER_VALIDATE_EMAIL) ? $cleaned : false;

        case 'url':
            $cleaned = filter_var($data, FILTER_SANITIZE_URL);
            return filter_var($cleaned, FILTER_VALIDATE_URL) ? $cleaned : false;

        case 'int':
            $cleaned = filter_var($data, FILTER_SANITIZE_NUMBER_INT);
            return filter_var($cleaned, FILTER_VALIDATE_INT) ? (int)$cleaned : false;

        case 'float':
            $cleaned = filter_var($data, FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
            return filter_var($cleaned, FILTER_VALIDATE_FLOAT) ? (float)$cleaned : false;

        case 'string':
        default:
            return htmlspecialchars(trim($data), ENT_QUOTES, 'UTF-8');
    }
}

/**
 * Check if request is AJAX
 * @return bool True if AJAX request
 */
function isAjaxRequest() {
    return !empty($_SERVER['HTTP_X_REQUESTED_WITH']) &&
           strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) === 'xmlhttprequest';
}

/**
 * Get request method
 * @return string Request method
 */
function getRequestMethod() {
    return $_SERVER['REQUEST_METHOD'] ?? 'GET';
}

/**
 * Check if request is POST
 * @return bool True if POST request
 */
function isPostRequest() {
    return getRequestMethod() === 'POST';
}

/**
 * Check if request is GET
 * @return bool True if GET request
 */
function isGetRequest() {
    return getRequestMethod() === 'GET';
}

/**
 * Redirect to URL
 * @param string $url URL to redirect to
 * @param int $status_code HTTP status code
 */
function redirect($url, $status_code = 302) {
    if (!headers_sent()) {
        http_response_code($status_code);
        header("Location: $url");
    } else {
        echo "<script>window.location.href='$url';</script>";
    }
    exit;
}

/**
 * Display a user-friendly error message
 * @param string $message Error message
 * @param int $code HTTP status code
 */
function showError($message, $code = 500) {
    if (!headers_sent()) {
        http_response_code($code);
    }

    if (isAjaxRequest()) {
        header('Content-Type: application/json');
        echo json_encode([
            'success' => false,
            'message' => $message,
            'code' => $code
        ]);
    } else {
        echo "<!DOCTYPE html>
        <html>
        <head>
            <title>Error - " . APP_NAME . "</title>
            <style>
                body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
                .error { color: #d32f2f; }
            </style>
        </head>
        <body>
            <h1 class='error'>Error $code</h1>
            <p>$message</p>
            <p><a href='" . (isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '/') . "'>Go Back</a></p>
        </body>
        </html>";
    }
    exit;
}

/**
 * Display a success message
 * @param string $message Success message
 * @param string $redirect_url Optional redirect URL
 */
function showSuccess($message, $redirect_url = null) {
    if (isAjaxRequest()) {
        header('Content-Type: application/json');
        echo json_encode([
            'success' => true,
            'message' => $message,
            'redirect' => $redirect_url
        ]);
    } else {
        echo "<!DOCTYPE html>
        <html>
        <head>
            <title>Success - " . APP_NAME . "</title>
            <style>
                body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
                .success { color: #388e3c; }
            </style>
        </head>
        <body>
            <h1 class='success'>Success!</h1>
            <p>$message</p>";
        if ($redirect_url) {
            echo "<p>Redirecting...</p>
            <script>setTimeout(function(){ window.location.href='$redirect_url'; }, 2000);</script>";
        }
        echo "</body></html>";
    }
    exit;
}

// Initialize application on include
initApplication();
?>


================================================================================
===== C:/xampp/htdocs/jemaat\config\multi_tenant.php =====
================================================================================

<?php
// config/multi_tenant.php

class MultiTenant {
    private static $current_church = null;
    private static $current_role = null;
    private static $user_neighborhoods = null;
    
    public static function initialize() {
        if (isset($_SESSION['church_id'])) {
            self::$current_church = $_SESSION['church_id'];
        }
        if (isset($_SESSION['role'])) {
            self::$current_role = $_SESSION['role'];
        }
        
        // Load user neighborhoods for filtering
        self::loadUserNeighborhoods();
    }
    
    public static function getCurrentChurch() {
        return self::$current_church;
    }
    
    public static function getCurrentRole() {
        return self::$current_role;
    }
    
    public static function getUserNeighborhoods() {
        return self::$user_neighborhoods;
    }
    
    public static function setCurrentChurch($church_id) {
        $_SESSION['church_id'] = $church_id;
        self::$current_church = $church_id;
    }
    
    public static function checkChurchAccess($church_id) {
        // Superadmin bisa akses semua gereja tanpa batasan
        if (self::$current_role === 'superadmin') {
            return true;
        }

        // Pengelola Lingkungan hanya bisa akses gerejanya sendiri
        if (self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super') {
            return self::$current_church == $church_id;
        }

        // Admin dan regular hanya bisa akses gerejanya sendiri
        if (self::$current_role === 'admin' || self::$current_role === 'regular') {
            return self::$current_church == $church_id;
        }

        // Public access - tidak bisa akses data gereja manapun
        return false;
    }
    
    public static function requireChurchAccess($church_id) {
        if (!self::checkChurchAccess($church_id)) {
            throw new Exception('Access denied: You can only access your own church data');
        }
    }
    
    public static function getCurrentChurchName() {
        if (!self::$current_church) {
            return 'Jemaat App';
        }

        // Get church name from database (using churches table)
        try {
            $conn = getDB();
            $stmt = $conn->prepare("SELECT church_name FROM churches WHERE id = ?");
            $stmt->execute([self::$current_church]);
            $church = $stmt->fetch(PDO::FETCH_ASSOC);

            return $church ? $church['church_name'] : 'Jemaat App';
        } catch (Exception $e) {
            return 'Jemaat App';
        }
    }

    // Helper function untuk query dengan filter tenant
    public static function addChurchFilter($query, $tenant_field = 'tenant_id') {
        // Superadmin bisa akses semua data tanpa filter
        if (self::$current_role === 'superadmin') {
            return $query;
        }

        // Pengelola Lingkungan, Admin, dan Regular hanya bisa akses data gereja mereka sendiri
        if ((self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super' || self::$current_role === 'admin' || self::$current_role === 'regular') && self::$current_church) {
            if (stripos($query, 'WHERE') !== false) {
                $query .= " AND $tenant_field = " . self::$current_church;
            } else {
                $query .= " WHERE $tenant_field = " . self::$current_church;
            }
        }
        return $query;
    }

    // NEW METHOD: Add church filter with parameters array
    public static function addChurchFilterWithParams($query, $tenant_field = 'tenant_id', &$params = []) {
        // Superadmin bisa akses semua data tanpa filter
        if (self::$current_role === 'superadmin') {
            return $query;
        }

        // Pengelola Lingkungan, Admin, dan Regular hanya bisa akses data gereja mereka sendiri
        if ((self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super' || self::$current_role === 'admin' || self::$current_role === 'regular') && self::$current_church) {
            if (stripos($query, 'WHERE') !== false) {
                $query .= " AND $tenant_field = ?";
            } else {
                $query .= " WHERE $tenant_field = ?";
            }
            $params[] = self::$current_church;
        }
        return $query;
    }

    // NEW METHOD: Add church filter for prepared statements
    public static function addChurchCondition($conditions = [], $tenant_field = 'tenant_id') {
        // Superadmin bisa akses semua data tanpa filter
        if (self::$current_role === 'superadmin') {
            return $conditions;
        }

        // Pengelola Lingkungan, Admin, dan Regular hanya bisa akses data gereja mereka sendiri
        if ((self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super' || self::$current_role === 'admin' || self::$current_role === 'regular') && self::$current_church) {
            $conditions[] = "$tenant_field = ?";
        }
        return $conditions;
    }

    // NEW METHOD: Get church parameters for prepared statements
    public static function getChurchParams($params = [], $tenant_field = 'tenant_id') {
        // Superadmin bisa akses semua data tanpa filter
        if (self::$current_role === 'superadmin') {
            return $params;
        }
        
        // Pengelola Lingkungan, Admin, dan Regular hanya bisa akses data gereja mereka sendiri
        if ((self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super' || self::$current_role === 'admin' || self::$current_role === 'regular') && self::$current_church) {
            $params[] = self::$current_church;
        }
        return $params;
    }
    
    // Load user neighborhoods from database
    private static function loadUserNeighborhoods() {
        // Superadmin bisa akses semua lingkungan di semua gereja
        if (self::$current_role === 'superadmin') {
            self::$user_neighborhoods = null; // null means access to all
            return;
        }
        
        // Pengelola Lingkungan bisa akses semua lingkungan di gerejanya saja
        if (self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super') {
            self::$user_neighborhoods = null; // null means access to all in their church
            return;
        }
        
        // Load neighborhoods for other roles
        if (isset($_SESSION['user_id'])) {
            try {
                $conn = getDB();
                $stmt = $conn->prepare("
                    SELECT cn.id, cn.neighborhood_name 
                    FROM user_neighborhoods un
                    JOIN church_neighborhoods cn ON un.neighborhood_id = cn.id
                    WHERE un.user_id = ?
                ");
                $stmt->execute([$_SESSION['user_id']]);
                self::$user_neighborhoods = $stmt->fetchAll(PDO::FETCH_ASSOC);
            } catch (Exception $e) {
                self::$user_neighborhoods = [];
            }
        } else {
            self::$user_neighborhoods = [];
        }
    }
    
    // Check if user has access to a specific neighborhood
    public static function hasNeighborhoodAccess($neighborhood_id) {
        // Pendeta dan Ketua bisa akses semua lingkungan
        if (self::$current_role === 'pendeta' || self::$current_role === 'ketua') {
            return true;
        }
        
        // Check if user has access to this neighborhood
        if (self::$user_neighborhoods === null) {
            return true; // Access to all
        }
        
        foreach (self::$user_neighborhoods as $neighborhood) {
            if ($neighborhood['id'] == $neighborhood_id) {
                return true;
            }
        }
        
        return false;
    }
    
    // Add neighborhood filter to query
    public static function addNeighborhoodFilter($query, $neighborhood_field = 'neighborhood_id') {
        // Pendeta, Ketua, dan Pengelola Lingkungan bisa akses semua lingkungan
        if (self::$current_role === 'pendeta' || self::$current_role === 'ketua' || self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super') {
            return $query;
        }

        // Add neighborhood filter for other roles
        if (self::$user_neighborhoods && count(self::$user_neighborhoods) > 0) {
            $neighborhood_names = array_column(self::$user_neighborhoods, 'neighborhood_name');
            $neighborhood_list = "'" . implode("','", $neighborhood_names) . "'";

            if (stripos($query, 'WHERE') !== false) {
                $query .= " AND $neighborhood_field IN ($neighborhood_list)";
            } else {
                $query .= " WHERE $neighborhood_field IN ($neighborhood_list)";
            }
        }

        return $query;
    }
    
    // Add neighborhood filter with parameters
    public static function addNeighborhoodFilterWithParams($query, $neighborhood_field = 'neighborhood_id', &$params = []) {
        // Pendeta, Ketua, dan Pengelola Lingkungan bisa akses semua lingkungan
        if (self::$current_role === 'pendeta' || self::$current_role === 'ketua' || self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super') {
            return $query;
        }

        // Add neighborhood filter for other roles
        if (self::$user_neighborhoods && count(self::$user_neighborhoods) > 0) {
            $neighborhood_names = array_column(self::$user_neighborhoods, 'neighborhood_name');
            $placeholders = str_repeat('?,', count($neighborhood_names) - 1) . '?';

            if (stripos($query, 'WHERE') !== false) {
                $query .= " AND $neighborhood_field IN ($placeholders)";
            } else {
                $query .= " WHERE $neighborhood_field IN ($placeholders)";
            }

            $params = array_merge($params, $neighborhood_names);
        }

        return $query;
    }
    
    // Get neighborhood access summary
    public static function getNeighborhoodAccessSummary() {
        if (self::$current_role === 'pendeta' || self::$current_role === 'ketua' || self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super') {
            return [
                'has_full_access' => true,
                'neighborhoods' => [],
                'neighborhood_count' => 'All'
            ];
        }

        return [
            'has_full_access' => false,
            'neighborhoods' => self::$user_neighborhoods ?: [],
            'neighborhood_count' => count(self::$user_neighborhoods ?: [])
        ];
    }

    // NEW METHOD: Check neighborhood access by name
    public static function checkNeighborhoodAccess($neighborhood_name) {
        // Superadmin bisa akses semua
        if (self::$current_role === 'superadmin') {
            return true;
        }

        // Pengelola Lingkungan - akses semua lingkungan di gerejanya
        if (self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super') {
            return true; // Akses semua lingkungan dalam gereja yang sama
        }

        // Admin - hanya akses lingkungan tertentu
        if (self::$current_role === 'admin') {
            return self::hasAccessToNeighborhood($neighborhood_name);
        }

        return false;
    }

    // NEW METHOD: Check if user has access to specific neighborhood
    private static function hasAccessToNeighborhood($neighborhood_name) {
        if (!self::$user_neighborhoods) return false;

        foreach (self::$user_neighborhoods as $neighborhood) {
            if ($neighborhood['neighborhood_name'] === $neighborhood_name) {
                return true;
            }
        }
        return false;
    }

    // NEW METHOD: Get accessible neighborhoods for current user
    public static function getAccessibleNeighborhoods() {
        if (self::$current_role === 'superadmin') {
            return null; // null means all neighborhoods
        }

        if (self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super') {
            return null; // all neighborhoods in their church
        }

        return self::$user_neighborhoods ?: [];
    }

    // NEW METHOD: Add neighborhood filter for staging families
    public static function addNeighborhoodFilterForStaging($query, $neighborhood_field = 'neighborhood', &$params = []) {
        // Superadmin bisa akses semua
        if (self::$current_role === 'superadmin') {
            return $query;
        }

        // Pengelola Lingkungan - akses semua lingkungan di gerejanya
        if (self::$current_role === 'pengelola_lingkungan' || self::$current_role === 'super') {
            // Filter berdasarkan church_id jika ada
            if (self::$current_church) {
                // Get all neighborhoods for this church
                try {
                    $conn = getDB();
                    $stmt = $conn->prepare("SELECT neighborhood_name FROM church_neighborhoods WHERE church_id = ?");
                    $stmt->execute([self::$current_church]);
                    $neighborhoods = $stmt->fetchAll(PDO::FETCH_COLUMN);

                    if (count($neighborhoods) > 0) {
                        $placeholders = str_repeat('?,', count($neighborhoods) - 1) . '?';
                        if (stripos($query, 'WHERE') !== false) {
                            $query .= " AND $neighborhood_field IN ($placeholders)";
                        } else {
                            $query .= " WHERE $neighborhood_field IN ($placeholders)";
                        }
                        $params = array_merge($params, $neighborhoods);
                    }
                } catch (Exception $e) {
                    // If error, restrict access
                    if (stripos($query, 'WHERE') !== false) {
                        $query .= " AND 1=0";
                    } else {
                        $query .= " WHERE 1=0";
                    }
                }
            }
            return $query;
        }

        // Admin - hanya akses lingkungan tertentu
        if (self::$current_role === 'admin') {
            $accessible_neighborhoods = self::getAccessibleNeighborhoods();
            if ($accessible_neighborhoods && count($accessible_neighborhoods) > 0) {
                $neighborhood_names = array_column($accessible_neighborhoods, 'neighborhood_name');
                $placeholders = str_repeat('?,', count($neighborhood_names) - 1) . '?';

                if (stripos($query, 'WHERE') !== false) {
                    $query .= " AND $neighborhood_field IN ($placeholders)";
                } else {
                    $query .= " WHERE $neighborhood_field IN ($placeholders)";
                }

                $params = array_merge($params, $neighborhood_names);
            } else {
                // Jika admin tidak punya akses lingkungan, tampilkan kosong
                if (stripos($query, 'WHERE') !== false) {
                    $query .= " AND 1=0";
                } else {
                    $query .= " WHERE 1=0";
                }
            }
        }

        return $query;
    }
}
?>


================================================================================
===== C:/xampp/htdocs/jemaat\css\style.css =====
================================================================================

body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}



.disabled-link {
    opacity: 0.5;
    cursor: not-allowed;
}

.disabled-link:hover {
    background-color: transparent !important;
}

.login-body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 50%, #56ab2f 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    position: relative;
    overflow: hidden;
}

.login-body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
    opacity: 0.5;
    animation: float 20s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

.login-container {
    width: 100%;
    max-width: 350px;
    padding: 20px;
    z-index: 1;
}

.login-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 30px 25px;
    border-radius: 15px;
    box-shadow: 0 15px 45px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
    text-align: center;
    border: 1px solid rgba(255,255,255,0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.login-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.2);
}

.logo {
    font-size: 50px;
    margin-bottom: 15px;
    color: #11998e;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.login-card h1 {
    margin-bottom: 10px;
    color: #333;
    font-size: 24px;
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.login-card p {
    margin-bottom: 20px;
    color: #666;
    font-size: 14px;
    line-height: 1.4;
}

.input-group {
    margin-bottom: 15px;
    text-align: left;
    position: relative;
}

.input-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #444;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.input-group input {
    width: 100%;
    padding: 10px 15px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.8);
}

.input-group input:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
    background: white;
}

.login-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 3px 12px rgba(17, 153, 142, 0.3);
}

.login-btn:hover {
    background: linear-gradient(135deg, #0e7c6b 0%, #32d66b 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
}

.login-btn:active {
    transform: translateY(0);
}

.error {
    color: #e74c3c;
    margin-bottom: 15px;
    background: rgba(231, 76, 60, 0.1);
    padding: 8px;
    border-radius: 5px;
    border-left: 4px solid #e74c3c;
    font-weight: 500;
    font-size: 14px;
}

.container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h1, h2 {
    color: #333;
}

form {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
}

input[type="text"], input[type="password"], input[type="date"], textarea, select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

input[type="radio"] {
    margin-right: 5px;
}

button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
}

button:hover {
    background-color: #45a049;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

table, th, td {
    border: 1px solid #ddd;
}

th, td {
    padding: 8px;
    text-align: left;
}

th {
    background-color: #f2f2f2;
}

.error {
    color: red;
}

a {
    color: #007BFF;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

fieldset {
    border: 1px solid #ccc;
    padding: 10px;
    margin-top: 10px;
}

legend {
    font-weight: bold;
}

/* Form Card Styles */
.form-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 15px 45px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    margin-top: 20px;
}

.form-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.2);
}

.form-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 10px;
    border-left: 4px solid #11998e;
}

.form-section h3 {
    margin-top: 0;
    color: #11998e;
    font-size: 18px;
    margin-bottom: 15px;
}

.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.form-row .form-group {
    flex: 1;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #444;
    font-size: 14px;
}

.form-group input[type="text"],
.form-group input[type="password"],
.form-group input[type="date"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px 15px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.8);
}

.form-group input[type="file"] {
    margin-top: 5px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.1);
    background: white;
}

.radio-group {
    display: flex;
    gap: 15px;
    align-items: center;
}

.radio-group input[type="radio"] {
    margin: 0;
}

.submit-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 3px 12px rgba(17, 153, 142, 0.3);
}

.submit-btn:hover {
    background: linear-gradient(135deg, #0e7c6b 0%, #32d66b 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
}

.submit-btn:active {
    transform: translateY(0);
}

/* Mobile styles now handled by mobile-optimization.css */

@media (min-width: 769px) {
    .hamburger {
        display: none;
    }
}

/* Enhanced Table Styles */
.table-responsive {
    overflow-x: auto;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
}

th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 15px 10px;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 10;
}

td {
    padding: 12px 10px;
    border-bottom: 1px solid #e1e5e9;
    vertical-align: top;
}

tbody tr:nth-child(even) {
    background-color: #f9f9f9;
}

tbody tr:hover {
    background-color: rgba(17, 153, 142, 0.05);
    transform: scale(1.01);
    transition: all 0.2s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.family-details {
    max-height: 60px;
    overflow: hidden;
    transition: max-height 0.3s ease;
}

.family-details.expanded {
    max-height: 200px;
}

.toggle-btn {
    background: #11998e;
    color: white;
    text-decoration: none;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    margin-top: 5px;
    transition: background 0.3s ease;
    display: inline-block;
}

.toggle-btn:hover {
    background: #0e7c6b;
    color: white;
}

.action-links a {
    color: #11998e;
    text-decoration: none;
    margin-right: 10px;
    padding: 5px 10px;
    border-radius: 5px;
    transition: all 0.3s ease;
}

.action-links a:hover {
    background: #11998e;
    color: white;
}

/* Detail Table Styles */
.detail-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.detail-table th, .detail-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #e1e5e9;
}

.detail-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    font-weight: 600;
}

.detail-table tr:nth-child(even) {
    background-color: #f9f9f9;
}

/* Contributions Table Styles */
.contributions-section {
    margin-top: 20px;
}

.contributions-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.contributions-table th, .contributions-table td {
    padding: 8px;
    text-align: center;
    border: 1px solid #e1e5e9;
}

.contributions-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    font-weight: 600;
}

.contributions-table input {
    width: 100%;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
}

/* Contribution Table Styles (Legacy) */
.contribution-table {
    width: 100%;
    max-width: 100%;
    margin: 20px auto;
    border-collapse: collapse;
    background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
    animation: fadeIn 0.5s ease-in-out;
    table-layout: fixed;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.contribution-table th, .contribution-table td {
    padding: 8px 4px;
    text-align: center;
    border: 1px solid #e1e5e9;
    transition: all 0.3s ease;
    word-wrap: break-word;
}

.contribution-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;
    overflow: hidden;
    font-size: 10px;
}

.contribution-table th::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.contribution-table th:hover::before {
    left: 100%;
}

.contribution-table td {
    vertical-align: middle;
    background: rgba(255,255,255,0.8);
}

/* Tetapkan lebar kolom */
.contribution-table th:nth-child(1),
.contribution-table td:nth-child(1) { /* Nama Keluarga */
    width: 20%; /* Lebar lebih besar untuk daftar anggota */
    max-width: 200px;
    text-align: left;
}
.contribution-table th:nth-child(2),
.contribution-table td:nth-child(2) { /* Alamat */
    width: 15%;
    max-width: 150px;
}
.contribution-table th:nth-child(3),
.contribution-table td:nth-child(3) { /* No HP */
    width: 10%;
    max-width: 100px;
}
.contribution-table th:nth-child(4),
.contribution-table td:nth-child(4) { /* Pendidikan */
    width: 10%;
    max-width: 100px;
}
.contribution-table th:nth-child(5),
.contribution-table td:nth-child(5) { /* Keterangan */
    width: 15%;
    max-width: 150px;
}
.contribution-table th:nth-child(n+6),
.contribution-table td:nth-child(n+6) { /* Kolom tahun */
    width: 5%;
    max-width: 50px;
}

.family-members-list {
    max-height: 100px; /* Batasi tinggi */
    overflow-y: auto; /* Gulir jika terlalu panjang */
    padding: 5px;
}

.family-member {
    margin: 2px 0;
    font-size: 12px;
}

.contribution-table input {
    width: 60px;
    padding: 4px 6px;
    border: 2px solid #ddd;
    border-radius: 8px;
    text-align: center;
    font-size: 12px;
    font-weight: 500;
    background: white;
    transition: all 0.3s ease;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    -webkit-appearance: none;
    -moz-appearance: textfield;
}

.contribution-table input::-webkit-outer-spin-button,
.contribution-table input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

.contribution-table input:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 3px rgba(17, 153, 142, 0.2), inset 0 1px 3px rgba(0,0,0,0.1);
    transform: scale(1.05);
}

.contribution-table tbody tr:nth-child(even) {
    background: linear-gradient(135deg, #f9f9f9 0%, #f0f0f0 100%);
}

.contribution-table tbody tr:hover {
    background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(17, 153, 142, 0.05) 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.contribution-table tbody tr:hover td {
    color: #11998e;
}

/* Simple Contributions Section Styles */
.contributions-section {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.contributions-section h2 {
    color: #11998e;
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 20px;
}

.contributions-info {
    background: #f9f9f9;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
    border-left: 3px solid #11998e;
}

.contributions-info p {
    margin: 5px 0;
    font-size: 14px;
    color: #555;
}

.contributions-table-container {
    overflow-x: auto;
}

.contributions-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    margin: 0;
}

.contributions-table th,
.contributions-table td {
    padding: 12px 8px;
    text-align: left;
    border: 1px solid #ddd;
}

.contributions-table th {
    background: #11998e;
    color: white;
    font-weight: 600;
    font-size: 14px;
}

.contributions-table tbody tr:nth-child(even) {
    background: #f9f9f9;
}

.contributions-table tbody tr:hover {
    background: #f0f8ff;
}

.contributions-table tbody tr.current-year {
    background: #e8f5e8;
    font-weight: 600;
}

.year-cell {
    font-weight: 600;
    color: #333;
    position: relative;
}

.current-year-label {
    display: inline-block;
    background: #11998e;
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.amount-cell {
    width: 80px;
}

.amount-input {
    width: 100%;
    padding: 4px 6px;
    border: 1px solid #ccc;
    border-radius: 3px;
    text-align: right;
    font-size: 12px;
    background: white;
    box-sizing: border-box;
    height: 28px;
}

.amount-input:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 2px rgba(17, 153, 142, 0.1);
}

.status-cell {
    width: 120px;
}

.status-paid {
    color: #28a745;
    font-weight: 600;
    font-size: 13px;
}

.status-unpaid {
    color: #ffc107;
    font-weight: 600;
    font-size: 13px;
}

/* Responsive Design for Simple Contributions */
@media (max-width: 768px) {
    .contributions-section {
        padding: 15px;
    }

    .contributions-table-container {
        font-size: 14px;
    }

    .contributions-table th,
    .contributions-table td {
        padding: 8px 4px;
    }

    .amount-cell {
        width: 120px;
    }

    .status-cell {
        width: 100px;
    }

    .amount-input {
        font-size: 12px;
        padding: 6px;
    }
}

/* File cell hover styles */
.file-cell {
    position: relative;
    cursor: pointer;
    padding: 10px;
    border: 1px solid #e1e5e9;
    border-radius: 8px;
    background: rgba(255,255,255,0.8);
    transition: all 0.3s ease;
    min-height: 60px;
}

.file-cell:hover {
    background: rgba(17, 153, 142, 0.1);
    border-color: #11998e;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.file-options {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    border: 1px solid #ccc;
    padding: 5px;
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    border-radius: 5px;
    min-width: 100px;
    transform: translateY(-5px);
}

.file-cell:hover .file-options {
    display: block;
}

/* Pastikan tabel nggak memotong submenu */
.family-table {
    position: relative;
    overflow: visible;
    z-index: 1;
}

/* Tambah padding di bawah baris untuk ruang hover */
.family-table td {
    padding-bottom: 20px;
}

/* Family Members List Styles */
.family-members-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 8px;
    background: rgba(17, 153, 142, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(17, 153, 142, 0.1);
}

.main-member {
    font-weight: bold;
    font-size: 16px;
    color: #11998e;
    padding: 4px 0;
    border-bottom: 2px solid #11998e;
    margin-bottom: 8px;
}

.family-member {
    font-size: 14px;
    color: #555;
    padding: 2px 0;
    display: flex;
    align-items: center;
    gap: 8px;
}

.family-member::before {
    font-size: 12px;
    opacity: 0.7;
}

/* Detail container styles */
.detail-container {
    max-width: 900px;
    margin: 15px auto;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    animation: fadeIn 0.5s ease-in-out;
}

.family-info {
    background: linear-gradient(135deg, #f9f9f9 0%, #f0f0f0 100%);
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 3px solid #11998e;
}

.family-info h3 {
    margin-top: 0;
    color: #11998e;
    font-size: 18px;
}

.family-info p {
    margin: 10px 0;
    font-size: 16px;
    color: #555;
}

.family-table-section {
    margin-bottom: 25px;
}

.family-table-section h2 {
    color: #11998e;
    margin-bottom: 20px;
    text-align: center;
    font-size: 28px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Head of Family Selection Styles */
.head-of-family-section {
    background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    border: 1px solid rgba(17, 153, 142, 0.1);
}

.head-of-family-section h3 {
    color: #11998e;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 20px;
    text-align: center;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.head-selection {
    margin-bottom: 25px;
}

.head-selection p {
    font-size: 16px;
    color: #555;
    margin-bottom: 15px;
    text-align: center;
    font-weight: 500;
}

.head-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
    margin: 0 auto;
}

.head-option {
    display: flex;
    align-items: center;
    padding: 12px 15px;
    background: white;
    border: 2px solid #e1e5e9;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    color: #555;
}

.head-option:hover {
    border-color: #11998e;
    background: rgba(17, 153, 142, 0.05);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(17, 153, 142, 0.15);
}

.head-option input[type="radio"] {
    margin-right: 12px;
    width: 18px;
    height: 18px;
    accent-color: #11998e;
}

.head-option input[type="radio"]:checked + span {
    color: #11998e;
    font-weight: 600;
}

.head-option span {
    transition: color 0.3s ease;
}

.head-of-family-table {
    margin-top: 20px;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.head-of-family-table th {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: 15px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.head-of-family-table td {
    padding: 15px;
    text-align: center;
    font-size: 16px;
    font-weight: 500;
}

/* Auto-fill display styles */
.auto-fill-display {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    border: 1px solid rgba(17, 153, 142, 0.2);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.display-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
}

.display-row:last-child {
    border-bottom: none;
}

.display-row strong {
    color: #11998e;
    font-weight: 600;
    min-width: 150px;
}

.display-row span {
    color: #333;
    font-weight: 500;
    text-align: right;
    flex: 1;
}

/* Responsive adjustments for head selection */
@media (max-width: 768px) {
    .head-options {
        max-width: 100%;
    }

    .head-option {
        padding: 10px 12px;
        font-size: 13px;
    }

    .head-of-family-section {
        padding: 20px;
    }

    .auto-fill-display {
        padding: 15px;
    }

    .display-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }

    .display-row strong {
        min-width: auto;
    }

    .display-row span {
        text-align: left;
    }
}

/* Step-based Form Styles */
.form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    font-family: 'Google Sans', 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.form-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    position: relative;
}

.form-steps::before {
    content: '';
    position: absolute;
    top: 15px;
    left: 0;
    right: 0;
    height: 2px;
    background: #ddd;
    z-index: 1;
}

.step {
    position: relative;
    z-index: 2;
    background: white;
    padding: 10px 20px;
    border: 2px solid #ddd;
    border-radius: 20px;
    text-align: center;
    flex: 1;
    margin: 0 5px;
}

.step.active {
    border-color: #11998e;
    background: #11998e;
    color: white;
}

.step-number {
    display: block;
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 5px;
}

.step-title {
    display: block;
    font-size: 12px;
    font-weight: 500;
}

.form-step {
    display: none;
}

.form-step.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.family-section {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.family-member {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background: #f9f9f9;
}

.member-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.btn-remove {
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    cursor: pointer;
}

.step-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
}

.btn-next, .btn-prev, .btn-submit, .btn-add {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.btn-next, .btn-submit {
    background: #11998e;
    color: white;
}

.btn-prev {
    background: #95a5a6;
    color: white;
}

.btn-add {
    background: #27ae60;
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

.form-group input.error,
.form-group select.error,
.form-group textarea.error {
    border-color: #e74c3c;
}

.field-error {
    color: #e74c3c;
    font-size: 12px;
    margin-top: 5px;
}

.file-preview {
    font-size: 12px;
    margin-top: 5px;
    padding: 5px;
    background: #f8f9fa;
    border-radius: 3px;
}

/* Notification Styles */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 5px;
    color: white;
    font-weight: 500;
    z-index: 10000;
    transform: translateX(100%);
    transition: transform 0.3s ease;
}

.notification.show {
    transform: translateX(0);
}

.notification-success {
    background: #27ae60;
}

.notification-error {
    background: #e74c3c;
}

.notification-info {
    background: #3498db;
}

/* Responsive Design for Step Form */
@media (max-width: 768px) {
    .form-container {
        padding: 15px;
    }

    .form-steps {
        flex-direction: column;
        gap: 10px;
    }

    .step {
        margin: 0;
    }

    .form-grid {
        grid-template-columns: 1fr;
    }

    .step-buttons {
        flex-direction: column;
        gap: 10px;
    }

    .section-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
    }
}
/* Google Forms-like Step-based Form Styles */

/* Real-time feedback styles */
.head-option input:disabled + span {
    color: #ccc !important;
    cursor: not-allowed;
}

.auto-fill-display .display-row {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
    transition: all 0.3s ease;
}

.auto-fill-display .display-row:last-child {
    border-bottom: none;
}

/* Loading animation for real-time updates */
.auto-fill-display.updating {
    opacity: 0.7;
}

/* Success state when head is selected */
.auto-fill-display.valid .display-row {
    color: #27ae60;
}

/* Status Badges */
.status-badge {
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    text-align: center;
    display: inline-block;
}

.status-badge.pending {
    background-color: #ffc107;
    color: #000;
}

.status-badge.approved {
    background-color: #28a745;
    color: #fff;
}

.status-badge.rejected {
    background-color: #dc3545;
    color: #fff;
}

/* Member Badges */
.member-badge {
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
    text-align: center;
    display: inline-block;
    margin-right: 5px;
}

.member-badge.ayah {
    background-color: #007bff;
    color: #fff;
}

.member-badge.ibu {
    background-color: #e83e8c;
    color: #fff;
}

.member-badge.anak {
    background-color: #6f42c1;
    color: #fff;
}

.member-badge.tanggungan {
    background-color: #fd7e14;
    color: #fff;
}

/* Compact Table */
.compact-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    margin-bottom: 20px;
}

.compact-table th {
    background-color: #f8f9fa;
    padding: 8px;
    text-align: left;
    border-bottom: 2px solid #dee2e6;
    font-weight: bold;
}

.compact-table td {
    padding: 8px;
    border-bottom: 1px solid #dee2e6;
    vertical-align: middle;
}

.compact-table tr:hover {
    background-color: #f1f1f1;
}

.family-members {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

/* Notification Badge Styles */
.notification-badge {
    background: #e74c3c;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 10px;
    margin-left: 5px;
    vertical-align: super;
}

.nav-link.has-notification {
    font-weight: bold;
    color: #e74c3c !important;
}

/* Required field indicator */
.required {
    color: #e74c3c;
}

/* Card styles for forms */
.card {
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.card-body {
    padding: 20px;
}

.form-control {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

.form-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.btn-primary {
    background: #11998e;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.btn-secondary {
    background: #6c757d;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.btn-primary:hover {
    background: #0d7d73;
}

.btn-secondary:hover {
    background: #545b62;
}

/* Premium Header Styles */
.navbar {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    border-bottom: 2px solid #e74c3c;
    position: relative;
    overflow: hidden;
}

.navbar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.03)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.03)"/><circle cx="50" cy="50" r="0.5" fill="rgba(255,255,255,0.02)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>') repeat;
    opacity: 0.8;
    pointer-events: none;
}

.navbar::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(231, 76, 60, 0.1), transparent);
    animation: shimmer 3s ease-in-out infinite;
    pointer-events: none;
}

@keyframes shimmer {
    0% { left: -100%; }
    50% { left: 100%; }
    100% { left: -100%; }
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 2;
}

.nav-logo {
    color: #ffffff;
    text-decoration: none;
    font-size: 28px;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    letter-spacing: 1px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px 0;
}

.nav-logo:hover {
    color: #e74c3c;
    transform: translateY(-2px);
    text-shadow: 0 4px 8px rgba(231, 76, 60, 0.4);
}

.nav-logo::before {
    content: "‚õ™";
    font-size: 32px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    from { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
    to { filter: drop-shadow(0 2px 6px rgba(231, 76, 60, 0.3)); }
}

.hamburger {
    display: none;
    cursor: pointer;
    font-size: 28px;
    color: #ffffff;
    padding: 10px;
    border-radius: 8px;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.hamburger:hover {
    background: rgba(231, 76, 60, 0.2);
    color: #e74c3c;
    transform: scale(1.1);
}

.nav-menu {
    list-style: none;
    display: flex;
    margin: 0;
    padding: 0;
    align-items: center;
    gap: 5px;
}

.nav-menu li {
    position: relative;
}

.nav-menu a {
    color: #ffffff;
    text-decoration: none;
    padding: 15px 20px;
    display: block;
    transition: all 0.3s ease;
    font-weight: 500;
    font-size: 14px;
    letter-spacing: 0.5px;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
}

.nav-menu a::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(231, 76, 60, 0.2), transparent);
    transition: left 0.5s ease;
}

.nav-menu a:hover::before {
    left: 100%;
}

.nav-menu a:hover {
    background: rgba(231, 76, 60, 0.15);
    color: #ffffff;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
}

.nav-link.has-notification {
    position: relative;
}

.nav-link.has-notification::after {
    content: '';
    position: absolute;
    top: 8px;
    right: 8px;
    width: 8px;
    height: 8px;
    background: #e74c3c;
    border-radius: 50%;
    animation: pulse-notification 2s infinite;
}

@keyframes pulse-notification {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
}

.notification-badge {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    border-radius: 50%;
    padding: 3px 8px;
    font-size: 11px;
    font-weight: 700;
    margin-left: 8px;
    vertical-align: super;
    box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
    border: 2px solid rgba(255,255,255,0.2);
    animation: bounce-in 0.5s ease;
}

@keyframes bounce-in {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.user-info {
    color: #ecf0f1;
    font-size: 13px;
    padding: 12px 18px;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    border-radius: 25px;
    border: 1px solid rgba(255,255,255,0.2);
    margin-left: 15px;
    font-weight: 500;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.user-info:hover {
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.2) 0%, rgba(231, 76, 60, 0.1) 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
    color: #ffffff;
}

/* Responsive Design */
@media (max-width: 768px) {
    .nav-container {
        flex-direction: column;
        padding: 15px 20px;
        gap: 15px;
    }

    .nav-logo {
        font-size: 24px;
        padding: 10px 0;
    }

    .nav-logo::before {
        font-size: 28px;
    }

    .nav-menu {
        display: none;
        flex-direction: column;
        width: 100%;
        gap: 0;
        background: rgba(26, 26, 46, 0.95);
        backdrop-filter: blur(15px);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        border: 1px solid rgba(255,255,255,0.1);
    }

    .nav-menu.active {
        display: flex;
    }

    .nav-menu li {
        width: 100%;
        margin: 0;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .nav-menu li:last-child {
        border-bottom: none;
    }

    .nav-menu a {
        padding: 15px 20px;
        border-radius: 8px;
        margin: 2px 0;
    }

    .nav-menu a:hover {
        background: rgba(231, 76, 60, 0.2);
        transform: translateX(5px);
    }

    .hamburger {
        display: block;
        position: absolute;
        top: 15px;
        right: 20px;
    }

    .user-info {
        margin-left: 0;
        text-align: center;
        font-size: 12px;
        padding: 10px 15px;
    }
}

@media (max-width: 480px) {
    .nav-logo {
        font-size: 20px;
    }

    .nav-logo::before {
        font-size: 24px;
    }

    .nav-menu {
        padding: 15px;
    }

    .nav-menu a {
        padding: 12px 15px;
        font-size: 13px;
    }

    .notification-badge {
        font-size: 10px;
        padding: 2px 6px;
    }
}

Aku mau mengkoneksikan antara dua aplikasi, dua aplikasi jemaah dengan aplikasi laporan keuangan.Bagaimana caranya?Jadi nanti data dari wakti bulan lalu kemasuk nanti ke laporan aplikasi jemaah. Ketika nanti misalkan di input dari input transaksi pada aplikasi laporan keuangan dengan kategorinya 500.01.01. Tapi nanti dia bisa otomatis masuk ke aplikasi jemaah. Padahal aplikasi laporan keuangan itu dari lokal PC. Nanti dia ngirim melalui format data JSON atau apa gitu terserah secara online menuju ke server online Gkpi.com Jadi tugasmu adalah untuk membuatkan perubahan program antara aplikasi jokron keuangan dengan aplikasi jemaah ini. Gara-gara apa yang perlu ditambahkan gitu. Jadi misalkan ada input alshcd jurnal penerimaan jemaah dengan kode kategori 500.01.01 dengan urayan yang disebutkan misalkan bakti bulanan dengan nomor register Sekian-sekian nanti itu yang jadi foreign key masuk ke database aplikasi jemaat dengan nomor register yg sama berarti udah bayar untuk bakti bulanan pada waktu tertentu tadi. Jadi database laporan keuangan datanya sama mengirimkan ke database jemaat

ini solusinya 
Aku mau mengkoneksikan antara dua aplikasi, dua aplikasi jemaah dengan aplikasi laporan keuangan.Bagaimana caranya?Jadi nanti data dari wakti bulan lalu kemasuk nanti ke laporan aplikasi jemaah. Ketika nanti misalkan di input dari input transaksi pada aplikasi laporan keuangan dengan kategorinya 500.01.01. Tapi nanti dia bisa otomatis masuk ke aplikasi jemaah. Padahal aplikasi laporan keuangan itu dari lokal PC. Nanti dia ngirim melalui format data JSON atau apa gitu terserah secara online menuju ke server online Gkpi.com Jadi tugasmu adalah untuk membuatkan perubahan program antara aplikasi jokron keuangan dengan aplikasi jemaah ini. Gara-gara apa yang perlu ditambahkan gitu. Jadi misalkan ada input alshcd jurnal penerimaan jemaah dengan kode kategori 500.01.01 dengan urayan yang disebutkan misalkan bakti bulanan dengan nomor register Sekian-sekian nanti itu yang jadi foreign key masuk ke database aplikasi jemaat dengan nomor register yg sama berarti udah bayar untuk bakti bulanan pada waktu tertentu tadi. Jadi database laporan keuangan datanya sama mengirimkan ke database jemaat
Ah, saya paham! Jadi alurnya adalah:

**Aplikasi Keuangan (Lokal PC)** ‚Üí **Server Online GKPI.com** ‚Üí **Aplikasi Jemaat**

Mari saya perbaiki solusinya agar sesuai dengan kebutuhan Anda:


[1 tool called]

## **Solusi Integrasi yang Diperbaiki**

### **1. API Endpoint di Server GKPI.com (Bukan di aplikasi jemaat)**


[1 tool called]

### **2. Script Pengirim dari Aplikasi Keuangan Lokal**


[1 tool called]

### **3. Integrasi dengan Aplikasi Keuangan Lokal**


[1 tool called]

### **4. Trigger Database untuk Auto-Sync**


[1 tool called]

### **5. Script Auto-Sync Processor**


[1 tool called]

### **6. Dokumentasi Lengkap**


[2 tools called]

## **Ringkasan Solusi Integrasi yang Lengkap**

### **Alur Kerja yang Sudah Diperbaiki:**

1. **Input Transaksi** di aplikasi keuangan lokal dengan kategori `500.01.01`
2. **Trigger Database** otomatis menambahkan ke `sync_queue`
3. **Auto-Sync Processor** memproses queue dan mengirim ke **Server GKPI.com**
4. **Server GKPI.com** menerima data dan meneruskan ke **Aplikasi Jemaat**
5. **Aplikasi Jemaat** update tabel `monthly_contributions` berdasarkan nomor register

### **File yang Dibuat:**

#### **Di Aplikasi Keuangan (Lokal PC):**
- ‚úÖ `send_to_gkpi_server.php` - Kirim data ke server GKPI
- ‚úÖ `keuangan_integration.php` - Class integrasi lengkap
- ‚úÖ `auto_sync_processor.php` - Proses queue otomatis
- ‚úÖ `database/create_auto_sync_trigger.sql` - Trigger database
- ‚úÖ `database/create_integration_log.sql` - Tabel log

#### **Di Server GKPI.com:**
- ‚úÖ `api/gkpi_contribution_sync.php` - API endpoint

#### **Di Aplikasi Jemaat:**
- ‚úÖ `api/contribution_sync.php` - API endpoint (sudah ada sebelumnya)

### **Keunggulan Solusi Ini:**

1. **Real-time Sync** - Data tersinkronisasi otomatis
2. **Error Handling** - Penanganan error yang baik
3. **Logging** - Semua aktivitas tercatat
4. **Batch Processing** - Dapat memproses multiple transaksi
5. **Retry Mechanism** - Retry otomatis jika gagal
6. **Security** - API key authentication
7. **Monitoring** - Status tracking yang lengkap

### **Langkah Selanjutnya:**

1. **Setup database tables** di aplikasi keuangan
2. **Konfigurasi API key** dan URL server
3. **Test integrasi** dengan data sample
4. **Setup cron job** untuk auto-sync (opsional)

Saya memahami kebutuhan Anda! Anda ingin mengintegrasikan **2 aplikasi**:

1. **Aplikasi Laporan Keuangan** (lokal PC) ‚Üí **Server Online GKPI.com**
2. **Aplikasi Jemaat** (server online) ‚Üí **Menerima data** dari aplikasi keuangan

Mari saya buatkan solusi integrasi yang lengkap:


[1 tool called]

## **Solusi Integrasi Aplikasi Laporan Keuangan ‚Üî Aplikasi Jemaat**

### **1. API Endpoint di Aplikasi Jemaat (Server Online)**

Mari saya buat API endpoint untuk menerima data dari aplikasi keuangan:


[1 tool called]

### **2. Tabel Log untuk Sinkronisasi**


[1 tool called]

### **3. Script Pengirim dari Aplikasi Keuangan (Lokal PC)**


[1 tool called]

### **4. Webhook Handler untuk Sinkronisasi Otomatis**


[1 tool called]

### **5. Tabel Webhook Log**


[1 tool called]

### **6. Script Integrasi untuk Aplikasi Keuangan**


[1 tool called]

### **7. Tabel Integration Log untuk Aplikasi Keuangan**


[2 tools called]

## **Ringkasan Solusi Integrasi**

### **Arsitektur Integrasi:**

```
[Aplikasi Keuangan Lokal] 
    ‚Üì (JSON API)
[Server Online GKPI.com]
    ‚Üì (Database)
[Aplikasi Jemaat]
```

### **File yang Dibuat:**

1. **`api/contribution_sync.php`** - API endpoint di server jemaat
2. **`api/webhook_handler.php`** - Webhook handler untuk sinkronisasi otomatis
3. **`../teste/send_contribution_to_jemaat.php`** - Script pengirim dari aplikasi keuangan
4. **`../teste/integration_keuangan_jemaat.php`** - Class integrasi lengkap
5. **Database tables** - Tabel log untuk tracking

### **Cara Kerja:**

1. **Input di Aplikasi Keuangan** ‚Üí Transaksi dengan kategori `500.01.01`
2. **Script Integration** ‚Üí Mengirim data ke server via JSON API
3. **Server Jemaat** ‚Üí Menerima data dan update `monthly_contributions`
4. **Logging** ‚Üí Semua aktivitas tercatat untuk audit

### **Langkah Selanjutnya:**

1. **Setup database tables** di kedua aplikasi
2. **Konfigurasi API key** dan URL server
3. **Test integrasi** dengan data sample
4. **Setup webhook** untuk sinkronisasi otomatis 


# **Panduan Setup Integrasi untuk Orang Awam**

## **1. Setup API di Aplikasi Jemaat**

### **Apa itu API?**
API adalah "jembatan" yang memungkinkan aplikasi teste (lokal) berkomunikasi dengan aplikasi jemaat (server online) untuk mengambil data anggota.

### **Langkah-langkah:**

#### **Step 1: Upload File API**
```
1. Buka folder aplikasi jemaat di server online
2. Masuk ke folder "api"
3. Upload file: get_members_for_contribution.php
4. Pastikan file tersimpan dengan benar
```

#### **Step 2: Konfigurasi Database**
```
1. Buka file: config/config.php
2. Pastikan koneksi database sudah benar
3. Test koneksi database
```

#### **Step 3: Test API**
```
1. Buka browser
2. Ketik: https://jemaat.gkpi.com/api/get_members_for_contribution.php?api_key=test
3. Jika muncul data JSON, berarti API berhasil
```

---

## **2. Konfigurasi API Key di Aplikasi Teste**

### **Apa itu API Key?**
API Key adalah "kunci" yang memungkinkan aplikasi teste mengakses data dari aplikasi jemaat dengan aman.

### **Langkah-langkah:**

#### **Step 1: Buat API Key**
```
1. Buka file: api/get_members_for_contribution.php
2. Cari baris: $api_key = 'your_api_key_here';
3. Ganti dengan kunci yang aman, contoh: 'GKPI2024_SECURE_KEY_123'
4. Simpan file
```

#### **Step 2: Update Aplikasi Teste**
```
1. Buka file: js/transaction_form.js
2. Cari baris: this.apiKey = 'your_api_key_here';
3. Ganti dengan kunci yang sama: 'GKPI2024_SECURE_KEY_123'
4. Simpan file
```

#### **Step 3: Update URL Server**
```
1. Buka file: js/transaction_form.js
2. Cari baris: this.jemaatApiUrl = 'https://jemaat.gkpi.com/api/get_members_for_contribution.php';
3. Pastikan URL sesuai dengan server Anda
4. Simpan file
```

---

## **3. Test Integrasi dengan Data Sample**

### **Apa itu Test Integrasi?**
Test integrasi adalah cara untuk memastikan bahwa aplikasi teste dapat mengambil data dari aplikasi jemaat dengan benar.

### **Langkah-langkah:**

#### **Step 1: Test API Langsung**
```
1. Buka browser
2. Ketik: https://jemaat.gkpi.com/api/get_members_for_contribution.php?api_key=GKPI2024_SECURE_KEY_123
3. Harus muncul data anggota dalam format JSON
4. Jika error, cek API key dan koneksi database
```

#### **Step 2: Test Form Input Transaksi**
```
1. Buka aplikasi teste
2. Masuk ke halaman input transaksi
3. Pilih jurnal: "penerimaan jemaat"
4. Pilih kategori: "500.01.01"
5. Harus muncul dropdown anggota
6. Pilih salah satu anggota
7. Cek apakah uraian terisi otomatis
```

#### **Step 3: Test Simpan Transaksi**
```
1. Isi form transaksi lengkap
2. Klik "Simpan Transaksi"
3. Cek apakah transaksi tersimpan di database lokal
4. Cek apakah data ter-sync ke aplikasi jemaat
5. Cek tabel monthly_contributions di aplikasi jemaat
```

#### **Step 4: Test Error Handling**
```
1. Matikan koneksi internet
2. Coba input transaksi
3. Harus muncul pesan error yang jelas
4. Nyalakan kembali internet
5. Coba lagi, harus berhasil
```

---

## **4. Deploy ke Production**

### **Apa itu Deploy?**
Deploy adalah proses memindahkan aplikasi dari lingkungan testing ke lingkungan production (live) yang digunakan pengguna.

### **Langkah-langkah:**

#### **Step 1: Backup Data**
```
1. Backup database aplikasi jemaat
2. Backup database aplikasi teste
3. Simpan backup di tempat aman
4. Catat tanggal backup
```

#### **Step 2: Update Production Server**
```
1. Upload file API ke server production
2. Update konfigurasi database
3. Test koneksi database
4. Test API endpoint
```

#### **Step 3: Update Aplikasi Teste**
```
1. Upload file form transaksi ke aplikasi teste
2. Update konfigurasi API key
3. Update URL server
4. Test koneksi ke server production
```

#### **Step 4: Final Testing**
```
1. Test input transaksi dengan data real
2. Cek sinkronisasi data
3. Cek log error
4. Cek performa aplikasi
```

#### **Step 5: Monitoring**
```
1. Setup monitoring error
2. Setup log aktivitas
3. Cek koneksi database secara berkala
4. Backup data secara berkala
```

---

## **Troubleshooting Umum**

### **Error: "API key tidak valid"**
```
Solusi:
1. Cek API key di kedua aplikasi harus sama
2. Cek format API key (tidak ada spasi)
3. Restart aplikasi
```

### **Error: "Tidak bisa mengambil data anggota"**
```
Solusi:
1. Cek koneksi internet
2. Cek URL server
3. Cek koneksi database
4. Cek log error
```

### **Error: "Transaksi tidak ter-sync"**
```
Solusi:
1. Cek koneksi ke server jemaat
2. Cek format data yang dikirim
3. Cek log integrasi
4. Test manual sync
```

### **Error: "Form tidak muncul dropdown"**
```
Solusi:
1. Cek JavaScript console
2. Cek koneksi ke API
3. Cek format data response
4. Cek browser compatibility
```

---

## **Tips untuk Pemula**

### **1. Selalu Backup**
- Backup sebelum melakukan perubahan
- Simpan backup di tempat aman
- Test backup secara berkala

### **2. Test di Environment Terpisah**
- Jangan test langsung di production
- Gunakan environment testing terlebih dahulu
- Pastikan semua fitur berfungsi

### **3. Dokumentasi**
- Catat semua perubahan yang dilakukan
- Simpan konfigurasi API key
- Buat panduan untuk tim

### **4. Monitoring**
- Cek log error secara berkala
- Monitor performa aplikasi
- Cek koneksi database

### **5. Support**
- Siapkan kontak support
- Buat dokumentasi troubleshooting
- Training untuk pengguna

---

## **Checklist Deploy**

- [ ] API berhasil di-upload ke server jemaat
- [ ] API key dikonfigurasi dengan benar
- [ ] URL server sudah benar
- [ ] Test API berhasil
- [ ] Test form input transaksi
- [ ] Test simpan transaksi
- [ ] Test sinkronisasi data
- [ ] Test error handling
- [ ] Backup data
- [ ] Monitoring setup
- [ ] Dokumentasi lengkap
- [ ] Training pengguna

Dengan mengikuti panduan ini, Anda dapat mengintegrasikan aplikasi teste dengan aplikasi jemaat secara aman dan efektif.


Baik! Saya akan buatkan file-file yang sudah siap pakai dengan API key dummy. Anda tinggal copy-paste saja.

## **1. File API di Aplikasi Jemaat**

### **File: `api/get_members_for_contribution.php`**


[1 tool called]

## **2. File Form Transaksi di Aplikasi Teste**

### **File: `transaction_form.php`**


[1 tool called]

## **3. File Script Penyimpanan Transaksi**

### **File: `save_transaction.php`**


[1 tool called]

## **4. File Database Setup**

### **File: `database_setup.sql`**


[1 tool called]

## **5. File Konfigurasi Database**

### **File: `config.php`**


[1 tool called]

## **6. File README untuk Setup**

### **File: `README_SETUP.md`**


[1 tool called]

## **Ringkasan File yang Sudah Siap Pakai:**

### **‚úÖ File di Aplikasi Jemaat (Server Online):**
1. **`api/get_members_for_contribution.php`** - API untuk mengambil data anggota

### **‚úÖ File di Aplikasi Teste (Lokal PC):**
1. **`transaction_form.php`** - Form input transaksi dengan integrasi
2. **`save_transaction.php`** - Script penyimpanan dengan sync
3. **`config.php`** - Konfigurasi database
4. **`database_setup.sql`** - Setup database lengkap
5. **`README_SETUP.md`** - Panduan setup lengkap

### **‚úÖ Konfigurasi yang Sudah Siap:**
- **API Key**: `GKPI2024_DUMMY_KEY_12345`
- **URL Server**: `https://jemaat.gkpi.com/api/`
- **Database**: Setup lengkap dengan trigger

### **‚úÖ Fitur yang Tersedia:**
- ‚úÖ Auto-dropdown anggota saat jurnal = "penerimaan jemaat" + kategori = "500.01.01"
- ‚úÖ Auto-fill description dengan format yang ditentukan
- ‚úÖ Auto-sync ke server jemaat
- ‚úÖ Error handling yang baik
- ‚úÖ Logging lengkap

### **Langkah Setup:**
1. **Upload file API** ke server jemaat
2. **Upload file form** ke aplikasi teste
3. **Jalankan script SQL** untuk setup database
4. **Edit konfigurasi** database di `config.php`
5. **Test integrasi** dengan form transaksi

Semua file sudah siap pakai dengan API key dummy. Anda tinggal copy-paste dan sesuaikan konfigurasi database sesuai kebutuhan!